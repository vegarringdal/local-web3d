var QV=Object.defineProperty;var gL=n=>{throw TypeError(n)};var ZV=(n,e,t)=>e in n?QV(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Se=(n,e,t)=>ZV(n,typeof e!="symbol"?e+"":e,t),eT=(n,e,t)=>e.has(n)||gL("Cannot "+t);var Be=(n,e,t)=>(eT(n,e,"read from private field"),t?t.call(n):e.get(n)),ni=(n,e,t)=>e.has(n)?gL("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),hn=(n,e,t,r)=>(eT(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),jt=(n,e,t)=>(eT(n,e,"access private method"),t);var vL=(n,e,t,r)=>({set _(i){hn(n,e,i,t)},get _(){return Be(n,e,r)}});function JV(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function iF(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var oF={exports:{}},CE={},sF={exports:{}},Wt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qv=Symbol.for("react.element"),eG=Symbol.for("react.portal"),tG=Symbol.for("react.fragment"),nG=Symbol.for("react.strict_mode"),rG=Symbol.for("react.profiler"),iG=Symbol.for("react.provider"),oG=Symbol.for("react.context"),sG=Symbol.for("react.forward_ref"),aG=Symbol.for("react.suspense"),lG=Symbol.for("react.memo"),cG=Symbol.for("react.lazy"),_L=Symbol.iterator;function uG(n){return n===null||typeof n!="object"?null:(n=_L&&n[_L]||n["@@iterator"],typeof n=="function"?n:null)}var aF={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},lF=Object.assign,cF={};function Im(n,e,t){this.props=n,this.context=e,this.refs=cF,this.updater=t||aF}Im.prototype.isReactComponent={};Im.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Im.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function uF(){}uF.prototype=Im.prototype;function jN(n,e,t){this.props=n,this.context=e,this.refs=cF,this.updater=t||aF}var BN=jN.prototype=new uF;BN.constructor=jN;lF(BN,Im.prototype);BN.isPureReactComponent=!0;var xL=Array.isArray,dF=Object.prototype.hasOwnProperty,zN={current:null},hF={key:!0,ref:!0,__self:!0,__source:!0};function fF(n,e,t){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)dF.call(e,r)&&!hF.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Qv,type:n,key:o,ref:s,props:i,_owner:zN.current}}function dG(n,e){return{$$typeof:Qv,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function HN(n){return typeof n=="object"&&n!==null&&n.$$typeof===Qv}function hG(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var yL=/\/+/g;function tT(n,e){return typeof n=="object"&&n!==null&&n.key!=null?hG(""+n.key):e.toString(36)}function py(n,e,t,r,i){var o=typeof n;(o==="undefined"||o==="boolean")&&(n=null);var s=!1;if(n===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(n.$$typeof){case Qv:case eG:s=!0}}if(s)return s=n,i=i(s),n=r===""?"."+tT(s,0):r,xL(i)?(t="",n!=null&&(t=n.replace(yL,"$&/")+"/"),py(i,e,t,"",function(c){return c})):i!=null&&(HN(i)&&(i=dG(i,t+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(yL,"$&/")+"/")+n)),e.push(i)),1;if(s=0,r=r===""?".":r+":",xL(n))for(var a=0;a<n.length;a++){o=n[a];var l=r+tT(o,a);s+=py(o,e,t,l,i)}else if(l=uG(n),typeof l=="function")for(n=l.call(n),a=0;!(o=n.next()).done;)o=o.value,l=r+tT(o,a++),s+=py(o,e,t,l,i);else if(o==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function A_(n,e,t){if(n==null)return n;var r=[],i=0;return py(n,r,"","",function(o){return e.call(t,o,i++)}),r}function fG(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Di={current:null},my={transition:null},pG={ReactCurrentDispatcher:Di,ReactCurrentBatchConfig:my,ReactCurrentOwner:zN};function pF(){throw Error("act(...) is not supported in production builds of React.")}Wt.Children={map:A_,forEach:function(n,e,t){A_(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return A_(n,function(){e++}),e},toArray:function(n){return A_(n,function(e){return e})||[]},only:function(n){if(!HN(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Wt.Component=Im;Wt.Fragment=tG;Wt.Profiler=rG;Wt.PureComponent=jN;Wt.StrictMode=nG;Wt.Suspense=aG;Wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pG;Wt.act=pF;Wt.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=lF({},n.props),i=n.key,o=n.ref,s=n._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=zN.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)dF.call(e,l)&&!hF.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:Qv,type:n.type,key:i,ref:o,props:r,_owner:s}};Wt.createContext=function(n){return n={$$typeof:oG,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:iG,_context:n},n.Consumer=n};Wt.createElement=fF;Wt.createFactory=function(n){var e=fF.bind(null,n);return e.type=n,e};Wt.createRef=function(){return{current:null}};Wt.forwardRef=function(n){return{$$typeof:sG,render:n}};Wt.isValidElement=HN;Wt.lazy=function(n){return{$$typeof:cG,_payload:{_status:-1,_result:n},_init:fG}};Wt.memo=function(n,e){return{$$typeof:lG,type:n,compare:e===void 0?null:e}};Wt.startTransition=function(n){var e=my.transition;my.transition={};try{n()}finally{my.transition=e}};Wt.unstable_act=pF;Wt.useCallback=function(n,e){return Di.current.useCallback(n,e)};Wt.useContext=function(n){return Di.current.useContext(n)};Wt.useDebugValue=function(){};Wt.useDeferredValue=function(n){return Di.current.useDeferredValue(n)};Wt.useEffect=function(n,e){return Di.current.useEffect(n,e)};Wt.useId=function(){return Di.current.useId()};Wt.useImperativeHandle=function(n,e,t){return Di.current.useImperativeHandle(n,e,t)};Wt.useInsertionEffect=function(n,e){return Di.current.useInsertionEffect(n,e)};Wt.useLayoutEffect=function(n,e){return Di.current.useLayoutEffect(n,e)};Wt.useMemo=function(n,e){return Di.current.useMemo(n,e)};Wt.useReducer=function(n,e,t){return Di.current.useReducer(n,e,t)};Wt.useRef=function(n){return Di.current.useRef(n)};Wt.useState=function(n){return Di.current.useState(n)};Wt.useSyncExternalStore=function(n,e,t){return Di.current.useSyncExternalStore(n,e,t)};Wt.useTransition=function(){return Di.current.useTransition()};Wt.version="18.3.1";sF.exports=Wt;var O=sF.exports;const Rt=iF(O),H2=JV({__proto__:null,default:Rt},[O]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mG=O,gG=Symbol.for("react.element"),vG=Symbol.for("react.fragment"),_G=Object.prototype.hasOwnProperty,xG=mG.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yG={key:!0,ref:!0,__self:!0,__source:!0};function mF(n,e,t){var r,i={},o=null,s=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)_G.call(e,r)&&!yG.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:gG,type:n,key:o,ref:s,props:i,_owner:xG.current}}CE.Fragment=vG;CE.jsx=mF;CE.jsxs=mF;oF.exports=CE;var d=oF.exports;async function VN(){const n=await navigator.storage.getDirectory();async function e(r){const i=await r.entries();for await(const[,o]of i)(o==null?void 0:o.kind)==="directory"?(await e(o),await o.remove()):await o.remove()}await e(n),(await indexedDB.databases()).forEach(r=>{r.name&&indexedDB.deleteDatabase(r.name)})}const nT=new URLSearchParams(location.search).get("load-project"),wL=new URLSearchParams(location.search).get("use-layer"),wG=new URLSearchParams(location.search).get("load-model")!==null,rT=new URLSearchParams(location.search).get("load-set"),SL=new URLSearchParams(location.search).get("project-key"),V2=new URLSearchParams(location.search).get("skip-alias")!==null,SG=new URLSearchParams(location.search).get("single-side")!==null,EG=new URLSearchParams(location.search).get("skip-group-layer")!==null,TG=new URLSearchParams(location.search).get("use-set-layer")!==null,CG=new URLSearchParams(location.search).get("presentation-mode")!==null;var rF;const EL=((rF=location.hash)==null?void 0:rF.indexOf("external"))!==-1,GN=new URLSearchParams(location.search).get("dev-mode")!==null||location.href.includes("localhost"),gF=new URLSearchParams(location.search).get("hide-treeview")!==null;new URLSearchParams(location.search).get("container");new URLSearchParams(location.search).get("model-config");const G2=new URLSearchParams(location.search).get("validate"),bG=new URLSearchParams(location.search).get("clear-cache")!==null;bG&&(navigator.serviceWorker.getRegistrations(),localStorage.clear(),sessionStorage.clear(),history.pushState(null,"",location.origin+location.pathname),VN().then(()=>{location.reload()}));window.showOpenFilePicker||(window.showOpenFilePicker=function(n){return new Promise((e,t)=>{const r=document.createElement("input");r.type="file",r.multiple=n&&n.multiple,r.accept=n&&n.types?n.types.map(i=>i.accept).join(","):"*/*",r.style.display="none",document.body.appendChild(r),r.click(),r.onchange=function(){const o=Array.from(r.files).map(s=>({name:s.name,getFile:()=>Promise.resolve(s)}));document.body.removeChild(r),e(o)},r.oncancel=function(){document.body.removeChild(r),t(new DOMException("The user canceled the request","AbortError"))},r.onerror=function(){document.body.removeChild(r),t(new Error("An error occurred while opening the file picker."))}})});const AG={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},TL=n=>{let e;const t=new Set,r=(u,h)=>{const f=typeof u=="function"?u(e):u;if(!Object.is(f,e)){const m=e;e=h??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(g=>g(e,m))}},i=()=>e,l={setState:r,getState:i,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(AG?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},c=e=n(r,i,l);return l},MG=n=>n?TL(n):TL;var vF={exports:{}},_F={},xF={exports:{}},yF={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qp=O;function RG(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var NG=typeof Object.is=="function"?Object.is:RG,IG=Qp.useState,PG=Qp.useEffect,kG=Qp.useLayoutEffect,LG=Qp.useDebugValue;function OG(n,e){var t=e(),r=IG({inst:{value:t,getSnapshot:e}}),i=r[0].inst,o=r[1];return kG(function(){i.value=t,i.getSnapshot=e,iT(i)&&o({inst:i})},[n,t,e]),PG(function(){return iT(i)&&o({inst:i}),n(function(){iT(i)&&o({inst:i})})},[n]),LG(t),t}function iT(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!NG(n,t)}catch{return!0}}function DG(n,e){return e()}var UG=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?DG:OG;yF.useSyncExternalStore=Qp.useSyncExternalStore!==void 0?Qp.useSyncExternalStore:UG;xF.exports=yF;var FG=xF.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bE=O,jG=FG;function BG(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var zG=typeof Object.is=="function"?Object.is:BG,HG=jG.useSyncExternalStore,VG=bE.useRef,GG=bE.useEffect,WG=bE.useMemo,$G=bE.useDebugValue;_F.useSyncExternalStoreWithSelector=function(n,e,t,r,i){var o=VG(null);if(o.current===null){var s={hasValue:!1,value:null};o.current=s}else s=o.current;o=WG(function(){function l(m){if(!c){if(c=!0,u=m,m=r(m),i!==void 0&&s.hasValue){var g=s.value;if(i(g,m))return h=g}return h=m}if(g=h,zG(u,m))return g;var _=r(m);return i!==void 0&&i(g,_)?g:(u=m,h=_)}var c=!1,u,h,f=t===void 0?null:t;return[function(){return l(e())},f===null?void 0:function(){return l(f())}]},[e,t,r,i]);var a=HG(n,o[0],o[1]);return GG(function(){s.hasValue=!0,s.value=a},[a]),$G(a),a};vF.exports=_F;var YG=vF.exports;const KG=iF(YG),wF={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},{useDebugValue:XG}=Rt,{useSyncExternalStoreWithSelector:qG}=KG;let CL=!1;const QG=n=>n;function ZG(n,e=QG,t){(wF?"production":void 0)!=="production"&&t&&!CL&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),CL=!0);const r=qG(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return XG(r),r}const bL=n=>{(wF?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof n=="function"?MG(n):n,t=(r,i)=>ZG(e,r,i);return Object.assign(t,e),t},mr=n=>n?bL(n):bL;/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const AE="169",JG={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},eW=0,AL=1,tW=2,SF=1,nW=2,Xa=3,bl=0,Ki=1,vi=2,pl=0,xp=1,W2=2,ML=3,RL=4,rW=5,nd=100,iW=101,oW=102,sW=103,aW=104,lW=200,cW=201,uW=202,dW=203,$2=204,Y2=205,hW=206,fW=207,pW=208,mW=209,gW=210,vW=211,_W=212,xW=213,yW=214,K2=0,X2=1,q2=2,Zp=3,Q2=4,Z2=5,J2=6,eA=7,EF=0,wW=1,SW=2,zc=0,TF=1,CF=2,bF=3,AF=4,EW=5,MF=6,RF=7,NF=300,Jp=301,em=302,tA=303,nA=304,ME=306,dw=1e3,kc=1001,hw=1002,So=1003,IF=1004,e0=1005,qo=1006,gy=1007,Lc=1008,Al=1009,PF=1010,kF=1011,rv=1012,WN=1013,Yd=1014,il=1015,Ml=1016,$N=1017,YN=1018,tm=1020,LF=35902,OF=1021,DF=1022,Jo=1023,UF=1024,FF=1025,yp=1026,nm=1027,jF=1028,KN=1029,BF=1030,XN=1031,qN=1033,vy=33776,_y=33777,xy=33778,yy=33779,rA=35840,iA=35841,oA=35842,sA=35843,aA=36196,lA=37492,cA=37496,uA=37808,dA=37809,hA=37810,fA=37811,pA=37812,mA=37813,gA=37814,vA=37815,_A=37816,xA=37817,yA=37818,wA=37819,SA=37820,EA=37821,wy=36492,TA=36494,CA=36495,zF=36283,bA=36284,AA=36285,MA=36286,TW=2300,CW=2301,bW=3200,AW=3201,HF=0,MW=1,rl="",$o="srgb",Hl="srgb-linear",QN="display-p3",RE="display-p3-linear",fw="linear",Mn="srgb",pw="rec709",mw="p3",kh=7680,NL=519,RW=512,NW=513,IW=514,VF=515,PW=516,kW=517,LW=518,OW=519,IL=35044,PL="300 es",ol=2e3,gw=2001;let hh=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let o=0,s=i.length;o<s;o++)i[o].call(this,e);e.target=null}}};const ri=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let kL=1234567;const wp=Math.PI/180,iv=180/Math.PI;function Pm(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(ri[n&255]+ri[n>>8&255]+ri[n>>16&255]+ri[n>>24&255]+"-"+ri[e&255]+ri[e>>8&255]+"-"+ri[e>>16&15|64]+ri[e>>24&255]+"-"+ri[t&63|128]+ri[t>>8&255]+"-"+ri[t>>16&255]+ri[t>>24&255]+ri[r&255]+ri[r>>8&255]+ri[r>>16&255]+ri[r>>24&255]).toLowerCase()}function fi(n,e,t){return Math.max(e,Math.min(t,n))}function ZN(n,e){return(n%e+e)%e}function DW(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function UW(n,e,t){return n!==e?(t-n)/(e-n):0}function C0(n,e,t){return(1-t)*n+t*e}function FW(n,e,t,r){return C0(n,e,1-Math.exp(-t*r))}function jW(n,e=1){return e-Math.abs(ZN(n,e*2)-e)}function BW(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function zW(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function HW(n,e){return n+Math.floor(Math.random()*(e-n+1))}function VW(n,e){return n+Math.random()*(e-n)}function GW(n){return n*(.5-Math.random())}function WW(n){n!==void 0&&(kL=n);let e=kL+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function $W(n){return n*wp}function YW(n){return n*iv}function KW(n){return(n&n-1)===0&&n!==0}function XW(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function qW(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function QW(n,e,t,r,i){const o=Math.cos,s=Math.sin,a=o(t/2),l=s(t/2),c=o((e+r)/2),u=s((e+r)/2),h=o((e-r)/2),f=s((e-r)/2),m=o((r-e)/2),g=s((r-e)/2);switch(i){case"XYX":n.set(a*u,l*h,l*f,a*c);break;case"YZY":n.set(l*f,a*u,l*h,a*c);break;case"ZXZ":n.set(l*h,l*f,a*u,a*c);break;case"XZX":n.set(a*u,l*g,l*m,a*c);break;case"YXY":n.set(l*m,a*u,l*g,a*c);break;case"ZYZ":n.set(l*g,l*m,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Af(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Si(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const ov={DEG2RAD:wp,RAD2DEG:iv,generateUUID:Pm,clamp:fi,euclideanModulo:ZN,mapLinear:DW,inverseLerp:UW,lerp:C0,damp:FW,pingpong:jW,smoothstep:BW,smootherstep:zW,randInt:HW,randFloat:VW,randFloatSpread:GW,seededRandom:WW,degToRad:$W,radToDeg:YW,isPowerOfTwo:KW,ceilPowerOfTwo:XW,floorPowerOfTwo:qW,setQuaternionFromProperEuler:QW,normalize:Si,denormalize:Af};class Ut{constructor(e=0,t=0){Ut.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(fi(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),o=this.x-e.x,s=this.y-e.y;return this.x=o*r-s*i+e.x,this.y=o*i+s*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Nt{constructor(e,t,r,i,o,s,a,l,c){Nt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,s,a,l,c)}set(e,t,r,i,o,s,a,l,c){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=o,u[5]=l,u[6]=r,u[7]=s,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,s=r[0],a=r[3],l=r[6],c=r[1],u=r[4],h=r[7],f=r[2],m=r[5],g=r[8],_=i[0],v=i[3],p=i[6],x=i[1],y=i[4],w=i[7],C=i[2],T=i[5],S=i[8];return o[0]=s*_+a*x+l*C,o[3]=s*v+a*y+l*T,o[6]=s*p+a*w+l*S,o[1]=c*_+u*x+h*C,o[4]=c*v+u*y+h*T,o[7]=c*p+u*w+h*S,o[2]=f*_+m*x+g*C,o[5]=f*v+m*y+g*T,o[8]=f*p+m*w+g*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*s*u-t*a*c-r*o*u+r*a*l+i*o*c-i*s*l}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*s-a*c,f=a*l-u*o,m=c*o-s*l,g=t*h+r*f+i*m;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/g;return e[0]=h*_,e[1]=(i*c-u*r)*_,e[2]=(a*r-i*s)*_,e[3]=f*_,e[4]=(u*t-i*l)*_,e[5]=(i*o-a*t)*_,e[6]=m*_,e[7]=(r*l-c*t)*_,e[8]=(s*t-r*o)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,o,s,a){const l=Math.cos(o),c=Math.sin(o);return this.set(r*l,r*c,-r*(l*s+c*a)+s+e,-i*c,i*l,-i*(-c*s+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(oT.makeScale(e,t)),this}rotate(e){return this.premultiply(oT.makeRotation(-e)),this}translate(e,t){return this.premultiply(oT.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const oT=new Nt;function GF(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function vw(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function ZW(){const n=vw("canvas");return n.style.display="block",n}const LL={};function Sy(n){n in LL||(LL[n]=!0,console.warn(n))}function JW(n,e,t){return new Promise(function(r,i){function o(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:i();break;case n.TIMEOUT_EXPIRED:setTimeout(o,t);break;default:r()}}setTimeout(o,t)})}function e$(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function t$(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const OL=new Nt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),DL=new Nt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),tg={[Hl]:{transfer:fw,primaries:pw,luminanceCoefficients:[.2126,.7152,.0722],toReference:n=>n,fromReference:n=>n},[$o]:{transfer:Mn,primaries:pw,luminanceCoefficients:[.2126,.7152,.0722],toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[RE]:{transfer:fw,primaries:mw,luminanceCoefficients:[.2289,.6917,.0793],toReference:n=>n.applyMatrix3(DL),fromReference:n=>n.applyMatrix3(OL)},[QN]:{transfer:Mn,primaries:mw,luminanceCoefficients:[.2289,.6917,.0793],toReference:n=>n.convertSRGBToLinear().applyMatrix3(DL),fromReference:n=>n.applyMatrix3(OL).convertLinearToSRGB()}},n$=new Set([Hl,RE]),sn={enabled:!0,_workingColorSpace:Hl,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!n$.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const r=tg[e].toReference,i=tg[t].fromReference;return i(r(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return tg[n].primaries},getTransfer:function(n){return n===rl?fw:tg[n].transfer},getLuminanceCoefficients:function(n,e=this._workingColorSpace){return n.fromArray(tg[e].luminanceCoefficients)}};function Sp(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function sT(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Lh,r$=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Lh===void 0&&(Lh=vw("canvas")),Lh.width=e.width,Lh.height=e.height;const r=Lh.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Lh}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=vw("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),o=i.data;for(let s=0;s<o.length;s++)o[s]=Sp(o[s]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(Sp(t[r]/255)*255):t[r]=Sp(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},i$=0;class JN{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:i$++}),this.uuid=Pm(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let s=0,a=i.length;s<a;s++)i[s].isDataTexture?o.push(aT(i[s].image)):o.push(aT(i[s]))}else o=aT(i);r.url=o}return t||(e.images[this.uuid]=r),r}}function aT(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?r$.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let o$=0,ds=class Ey extends hh{constructor(e=Ey.DEFAULT_IMAGE,t=Ey.DEFAULT_MAPPING,r=kc,i=kc,o=qo,s=Lc,a=Jo,l=Al,c=Ey.DEFAULT_ANISOTROPY,u=rl){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:o$++}),this.uuid=Pm(),this.name="",this.source=new JN(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=o,this.minFilter=s,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Ut(0,0),this.repeat=new Ut(1,1),this.center=new Ut(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Nt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==NF)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case dw:e.x=e.x-Math.floor(e.x);break;case kc:e.x=e.x<0?0:1;break;case hw:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case dw:e.y=e.y-Math.floor(e.y);break;case kc:e.y=e.y<0?0:1;break;case hw:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};ds.DEFAULT_IMAGE=null;ds.DEFAULT_MAPPING=NF;ds.DEFAULT_ANISOTROPY=1;class gn{constructor(e=0,t=0,r=0,i=1){gn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=this.w,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i+s[12]*o,this.y=s[1]*t+s[5]*r+s[9]*i+s[13]*o,this.z=s[2]*t+s[6]*r+s[10]*i+s[14]*o,this.w=s[3]*t+s[7]*r+s[11]*i+s[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,o;const l=e.elements,c=l[0],u=l[4],h=l[8],f=l[1],m=l[5],g=l[9],_=l[2],v=l[6],p=l[10];if(Math.abs(u-f)<.01&&Math.abs(h-_)<.01&&Math.abs(g-v)<.01){if(Math.abs(u+f)<.1&&Math.abs(h+_)<.1&&Math.abs(g+v)<.1&&Math.abs(c+m+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(c+1)/2,w=(m+1)/2,C=(p+1)/2,T=(u+f)/4,S=(h+_)/4,b=(g+v)/4;return y>w&&y>C?y<.01?(r=0,i=.707106781,o=.707106781):(r=Math.sqrt(y),i=T/r,o=S/r):w>C?w<.01?(r=.707106781,i=0,o=.707106781):(i=Math.sqrt(w),r=T/i,o=b/i):C<.01?(r=.707106781,i=.707106781,o=0):(o=Math.sqrt(C),r=S/o,i=b/o),this.set(r,i,o,t),this}let x=Math.sqrt((v-g)*(v-g)+(h-_)*(h-_)+(f-u)*(f-u));return Math.abs(x)<.001&&(x=1),this.x=(v-g)/x,this.y=(h-_)/x,this.z=(f-u)/x,this.w=Math.acos((c+m+p-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class s$ extends hh{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new gn(0,0,e,t),this.scissorTest=!1,this.viewport=new gn(0,0,e,t);const i={width:e,height:t,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:qo,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const o=new ds(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);o.flipY=!1,o.generateMipmaps=r.generateMipmaps,o.internalFormat=r.internalFormat,this.textures=[];const s=r.count;for(let a=0;a<s;a++)this.textures[a]=o.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,o=this.textures.length;i<o;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,i=e.textures.length;r<i;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new JN(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class is extends s${constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class WF extends ds{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=So,this.minFilter=So,this.wrapR=kc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class a$ extends ds{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=So,this.minFilter=So,this.wrapR=kc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Hn{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,o,s,a){let l=r[i+0],c=r[i+1],u=r[i+2],h=r[i+3];const f=o[s+0],m=o[s+1],g=o[s+2],_=o[s+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=f,e[t+1]=m,e[t+2]=g,e[t+3]=_;return}if(h!==_||l!==f||c!==m||u!==g){let v=1-a;const p=l*f+c*m+u*g+h*_,x=p>=0?1:-1,y=1-p*p;if(y>Number.EPSILON){const C=Math.sqrt(y),T=Math.atan2(C,p*x);v=Math.sin(v*T)/C,a=Math.sin(a*T)/C}const w=a*x;if(l=l*v+f*w,c=c*v+m*w,u=u*v+g*w,h=h*v+_*w,v===1-a){const C=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=C,c*=C,u*=C,h*=C}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,i,o,s){const a=r[i],l=r[i+1],c=r[i+2],u=r[i+3],h=o[s],f=o[s+1],m=o[s+2],g=o[s+3];return e[t]=a*g+u*h+l*m-c*f,e[t+1]=l*g+u*f+c*h-a*m,e[t+2]=c*g+u*m+a*f-l*h,e[t+3]=u*g-a*h-l*f-c*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,o=e._z,s=e._order,a=Math.cos,l=Math.sin,c=a(r/2),u=a(i/2),h=a(o/2),f=l(r/2),m=l(i/2),g=l(o/2);switch(s){case"XYZ":this._x=f*u*h+c*m*g,this._y=c*m*h-f*u*g,this._z=c*u*g+f*m*h,this._w=c*u*h-f*m*g;break;case"YXZ":this._x=f*u*h+c*m*g,this._y=c*m*h-f*u*g,this._z=c*u*g-f*m*h,this._w=c*u*h+f*m*g;break;case"ZXY":this._x=f*u*h-c*m*g,this._y=c*m*h+f*u*g,this._z=c*u*g+f*m*h,this._w=c*u*h-f*m*g;break;case"ZYX":this._x=f*u*h-c*m*g,this._y=c*m*h+f*u*g,this._z=c*u*g-f*m*h,this._w=c*u*h+f*m*g;break;case"YZX":this._x=f*u*h+c*m*g,this._y=c*m*h+f*u*g,this._z=c*u*g-f*m*h,this._w=c*u*h-f*m*g;break;case"XZY":this._x=f*u*h-c*m*g,this._y=c*m*h-f*u*g,this._z=c*u*g+f*m*h,this._w=c*u*h+f*m*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],o=t[8],s=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],f=r+a+h;if(f>0){const m=.5/Math.sqrt(f+1);this._w=.25/m,this._x=(u-l)*m,this._y=(o-c)*m,this._z=(s-i)*m}else if(r>a&&r>h){const m=2*Math.sqrt(1+r-a-h);this._w=(u-l)/m,this._x=.25*m,this._y=(i+s)/m,this._z=(o+c)/m}else if(a>h){const m=2*Math.sqrt(1+a-r-h);this._w=(o-c)/m,this._x=(i+s)/m,this._y=.25*m,this._z=(l+u)/m}else{const m=2*Math.sqrt(1+h-r-a);this._w=(s-i)/m,this._x=(o+c)/m,this._y=(l+u)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(fi(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,o=e._z,s=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=r*u+s*a+i*c-o*l,this._y=i*u+s*l+o*a-r*c,this._z=o*u+s*c+r*l-i*a,this._w=s*u-r*a-i*l-o*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,o=this._z,s=this._w;let a=s*e._w+r*e._x+i*e._y+o*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=r,this._y=i,this._z=o,this;const l=1-a*a;if(l<=Number.EPSILON){const m=1-t;return this._w=m*s+t*this._w,this._x=m*r+t*this._x,this._y=m*i+t*this._y,this._z=m*o+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,f=Math.sin(t*u)/c;return this._w=s*h+this._w*f,this._x=r*h+this._x*f,this._y=i*h+this._y*f,this._z=o*h+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),o=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),o*Math.sin(t),o*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class N{constructor(e=0,t=0,r=0){N.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(UL.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(UL.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6]*i,this.y=o[1]*t+o[4]*r+o[7]*i,this.z=o[2]*t+o[5]*r+o[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=e.elements,s=1/(o[3]*t+o[7]*r+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*r+o[8]*i+o[12])*s,this.y=(o[1]*t+o[5]*r+o[9]*i+o[13])*s,this.z=(o[2]*t+o[6]*r+o[10]*i+o[14])*s,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,o=e.x,s=e.y,a=e.z,l=e.w,c=2*(s*i-a*r),u=2*(a*t-o*i),h=2*(o*r-s*t);return this.x=t+l*c+s*h-a*u,this.y=r+l*u+a*c-o*h,this.z=i+l*h+o*u-s*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i,this.y=o[1]*t+o[5]*r+o[9]*i,this.z=o[2]*t+o[6]*r+o[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,o=e.z,s=t.x,a=t.y,l=t.z;return this.x=i*l-o*a,this.y=o*s-r*l,this.z=r*a-i*s,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return lT.copy(this).projectOnVector(e),this.sub(lT)}reflect(e){return this.sub(lT.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(fi(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const lT=new N,UL=new Hn;class nt{constructor(e=new N(1/0,1/0,1/0),t=new N(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(ps.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(ps.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=ps.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const o=r.getAttribute("position");if(t===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let s=0,a=o.count;s<a;s++)e.isMesh===!0?e.getVertexPosition(s,ps):ps.fromBufferAttribute(o,s),ps.applyMatrix4(e.matrixWorld),this.expandByPoint(ps);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),M_.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),M_.copy(r.boundingBox)),M_.applyMatrix4(e.matrixWorld),this.union(M_)}const i=e.children;for(let o=0,s=i.length;o<s;o++)this.expandByObject(i[o],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,ps),ps.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ng),R_.subVectors(this.max,ng),Oh.subVectors(e.a,ng),Dh.subVectors(e.b,ng),Uh.subVectors(e.c,ng),ql.subVectors(Dh,Oh),Ql.subVectors(Uh,Dh),bu.subVectors(Oh,Uh);let t=[0,-ql.z,ql.y,0,-Ql.z,Ql.y,0,-bu.z,bu.y,ql.z,0,-ql.x,Ql.z,0,-Ql.x,bu.z,0,-bu.x,-ql.y,ql.x,0,-Ql.y,Ql.x,0,-bu.y,bu.x,0];return!cT(t,Oh,Dh,Uh,R_)||(t=[1,0,0,0,1,0,0,0,1],!cT(t,Oh,Dh,Uh,R_))?!1:(N_.crossVectors(ql,Ql),t=[N_.x,N_.y,N_.z],cT(t,Oh,Dh,Uh,R_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ps).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ps).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(za[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),za[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),za[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),za[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),za[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),za[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),za[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),za[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(za),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const za=[new N,new N,new N,new N,new N,new N,new N,new N],ps=new N,M_=new nt,Oh=new N,Dh=new N,Uh=new N,ql=new N,Ql=new N,bu=new N,ng=new N,R_=new N,N_=new N,Au=new N;function cT(n,e,t,r,i){for(let o=0,s=n.length-3;o<=s;o+=3){Au.fromArray(n,o);const a=i.x*Math.abs(Au.x)+i.y*Math.abs(Au.y)+i.z*Math.abs(Au.z),l=e.dot(Au),c=t.dot(Au),u=r.dot(Au);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const l$=new nt,rg=new N,uT=new N;class km{constructor(e=new N,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):l$.setFromPoints(e).getCenter(r);let i=0;for(let o=0,s=e.length;o<s;o++)i=Math.max(i,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;rg.subVectors(e,this.center);const t=rg.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(rg,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(uT.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(rg.copy(e.center).add(uT)),this.expandByPoint(rg.copy(e.center).sub(uT))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ha=new N,dT=new N,I_=new N,Zl=new N,hT=new N,P_=new N,fT=new N;class eI{constructor(e=new N,t=new N(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ha)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ha.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ha.copy(this.origin).addScaledVector(this.direction,t),Ha.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){dT.copy(e).add(t).multiplyScalar(.5),I_.copy(t).sub(e).normalize(),Zl.copy(this.origin).sub(dT);const o=e.distanceTo(t)*.5,s=-this.direction.dot(I_),a=Zl.dot(this.direction),l=-Zl.dot(I_),c=Zl.lengthSq(),u=Math.abs(1-s*s);let h,f,m,g;if(u>0)if(h=s*l-a,f=s*a-l,g=o*u,h>=0)if(f>=-g)if(f<=g){const _=1/u;h*=_,f*=_,m=h*(h+s*f+2*a)+f*(s*h+f+2*l)+c}else f=o,h=Math.max(0,-(s*f+a)),m=-h*h+f*(f+2*l)+c;else f=-o,h=Math.max(0,-(s*f+a)),m=-h*h+f*(f+2*l)+c;else f<=-g?(h=Math.max(0,-(-s*o+a)),f=h>0?-o:Math.min(Math.max(-o,-l),o),m=-h*h+f*(f+2*l)+c):f<=g?(h=0,f=Math.min(Math.max(-o,-l),o),m=f*(f+2*l)+c):(h=Math.max(0,-(s*o+a)),f=h>0?o:Math.min(Math.max(-o,-l),o),m=-h*h+f*(f+2*l)+c);else f=s>0?-o:o,h=Math.max(0,-(s*f+a)),m=-h*h+f*(f+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(dT).addScaledVector(I_,f),m}intersectSphere(e,t){Ha.subVectors(e.center,this.origin);const r=Ha.dot(this.direction),i=Ha.dot(Ha)-r*r,o=e.radius*e.radius;if(i>o)return null;const s=Math.sqrt(o-i),a=r-s,l=r+s;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,o,s,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,f=this.origin;return c>=0?(r=(e.min.x-f.x)*c,i=(e.max.x-f.x)*c):(r=(e.max.x-f.x)*c,i=(e.min.x-f.x)*c),u>=0?(o=(e.min.y-f.y)*u,s=(e.max.y-f.y)*u):(o=(e.max.y-f.y)*u,s=(e.min.y-f.y)*u),r>s||o>i||((o>r||isNaN(r))&&(r=o),(s<i||isNaN(i))&&(i=s),h>=0?(a=(e.min.z-f.z)*h,l=(e.max.z-f.z)*h):(a=(e.max.z-f.z)*h,l=(e.min.z-f.z)*h),r>l||a>i)||((a>r||r!==r)&&(r=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,Ha)!==null}intersectTriangle(e,t,r,i,o){hT.subVectors(t,e),P_.subVectors(r,e),fT.crossVectors(hT,P_);let s=this.direction.dot(fT),a;if(s>0){if(i)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Zl.subVectors(this.origin,e);const l=a*this.direction.dot(P_.crossVectors(Zl,P_));if(l<0)return null;const c=a*this.direction.dot(hT.cross(Zl));if(c<0||l+c>s)return null;const u=-a*Zl.dot(fT);return u<0?null:this.at(u/s,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class dt{constructor(e,t,r,i,o,s,a,l,c,u,h,f,m,g,_,v){dt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,s,a,l,c,u,h,f,m,g,_,v)}set(e,t,r,i,o,s,a,l,c,u,h,f,m,g,_,v){const p=this.elements;return p[0]=e,p[4]=t,p[8]=r,p[12]=i,p[1]=o,p[5]=s,p[9]=a,p[13]=l,p[2]=c,p[6]=u,p[10]=h,p[14]=f,p[3]=m,p[7]=g,p[11]=_,p[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new dt().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Fh.setFromMatrixColumn(e,0).length(),o=1/Fh.setFromMatrixColumn(e,1).length(),s=1/Fh.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=0,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,o=e.z,s=Math.cos(r),a=Math.sin(r),l=Math.cos(i),c=Math.sin(i),u=Math.cos(o),h=Math.sin(o);if(e.order==="XYZ"){const f=s*u,m=s*h,g=a*u,_=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=m+g*c,t[5]=f-_*c,t[9]=-a*l,t[2]=_-f*c,t[6]=g+m*c,t[10]=s*l}else if(e.order==="YXZ"){const f=l*u,m=l*h,g=c*u,_=c*h;t[0]=f+_*a,t[4]=g*a-m,t[8]=s*c,t[1]=s*h,t[5]=s*u,t[9]=-a,t[2]=m*a-g,t[6]=_+f*a,t[10]=s*l}else if(e.order==="ZXY"){const f=l*u,m=l*h,g=c*u,_=c*h;t[0]=f-_*a,t[4]=-s*h,t[8]=g+m*a,t[1]=m+g*a,t[5]=s*u,t[9]=_-f*a,t[2]=-s*c,t[6]=a,t[10]=s*l}else if(e.order==="ZYX"){const f=s*u,m=s*h,g=a*u,_=a*h;t[0]=l*u,t[4]=g*c-m,t[8]=f*c+_,t[1]=l*h,t[5]=_*c+f,t[9]=m*c-g,t[2]=-c,t[6]=a*l,t[10]=s*l}else if(e.order==="YZX"){const f=s*l,m=s*c,g=a*l,_=a*c;t[0]=l*u,t[4]=_-f*h,t[8]=g*h+m,t[1]=h,t[5]=s*u,t[9]=-a*u,t[2]=-c*u,t[6]=m*h+g,t[10]=f-_*h}else if(e.order==="XZY"){const f=s*l,m=s*c,g=a*l,_=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=f*h+_,t[5]=s*u,t[9]=m*h-g,t[2]=g*h-m,t[6]=a*u,t[10]=_*h+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(c$,e,u$)}lookAt(e,t,r){const i=this.elements;return ro.subVectors(e,t),ro.lengthSq()===0&&(ro.z=1),ro.normalize(),Jl.crossVectors(r,ro),Jl.lengthSq()===0&&(Math.abs(r.z)===1?ro.x+=1e-4:ro.z+=1e-4,ro.normalize(),Jl.crossVectors(r,ro)),Jl.normalize(),k_.crossVectors(ro,Jl),i[0]=Jl.x,i[4]=k_.x,i[8]=ro.x,i[1]=Jl.y,i[5]=k_.y,i[9]=ro.y,i[2]=Jl.z,i[6]=k_.z,i[10]=ro.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,s=r[0],a=r[4],l=r[8],c=r[12],u=r[1],h=r[5],f=r[9],m=r[13],g=r[2],_=r[6],v=r[10],p=r[14],x=r[3],y=r[7],w=r[11],C=r[15],T=i[0],S=i[4],b=i[8],R=i[12],E=i[1],A=i[5],F=i[9],D=i[13],M=i[2],k=i[6],z=i[10],P=i[14],U=i[3],Y=i[7],Z=i[11],j=i[15];return o[0]=s*T+a*E+l*M+c*U,o[4]=s*S+a*A+l*k+c*Y,o[8]=s*b+a*F+l*z+c*Z,o[12]=s*R+a*D+l*P+c*j,o[1]=u*T+h*E+f*M+m*U,o[5]=u*S+h*A+f*k+m*Y,o[9]=u*b+h*F+f*z+m*Z,o[13]=u*R+h*D+f*P+m*j,o[2]=g*T+_*E+v*M+p*U,o[6]=g*S+_*A+v*k+p*Y,o[10]=g*b+_*F+v*z+p*Z,o[14]=g*R+_*D+v*P+p*j,o[3]=x*T+y*E+w*M+C*U,o[7]=x*S+y*A+w*k+C*Y,o[11]=x*b+y*F+w*z+C*Z,o[15]=x*R+y*D+w*P+C*j,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],o=e[12],s=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],f=e[10],m=e[14],g=e[3],_=e[7],v=e[11],p=e[15];return g*(+o*l*h-i*c*h-o*a*f+r*c*f+i*a*m-r*l*m)+_*(+t*l*m-t*c*f+o*s*f-i*s*m+i*c*u-o*l*u)+v*(+t*c*h-t*a*m-o*s*h+r*s*m+o*a*u-r*c*u)+p*(-i*a*u-t*l*h+t*a*f+i*s*h-r*s*f+r*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],m=e[11],g=e[12],_=e[13],v=e[14],p=e[15],x=h*v*c-_*f*c+_*l*m-a*v*m-h*l*p+a*f*p,y=g*f*c-u*v*c-g*l*m+s*v*m+u*l*p-s*f*p,w=u*_*c-g*h*c+g*a*m-s*_*m-u*a*p+s*h*p,C=g*h*l-u*_*l-g*a*f+s*_*f+u*a*v-s*h*v,T=t*x+r*y+i*w+o*C;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/T;return e[0]=x*S,e[1]=(_*f*o-h*v*o-_*i*m+r*v*m+h*i*p-r*f*p)*S,e[2]=(a*v*o-_*l*o+_*i*c-r*v*c-a*i*p+r*l*p)*S,e[3]=(h*l*o-a*f*o-h*i*c+r*f*c+a*i*m-r*l*m)*S,e[4]=y*S,e[5]=(u*v*o-g*f*o+g*i*m-t*v*m-u*i*p+t*f*p)*S,e[6]=(g*l*o-s*v*o-g*i*c+t*v*c+s*i*p-t*l*p)*S,e[7]=(s*f*o-u*l*o+u*i*c-t*f*c-s*i*m+t*l*m)*S,e[8]=w*S,e[9]=(g*h*o-u*_*o-g*r*m+t*_*m+u*r*p-t*h*p)*S,e[10]=(s*_*o-g*a*o+g*r*c-t*_*c-s*r*p+t*a*p)*S,e[11]=(u*a*o-s*h*o-u*r*c+t*h*c+s*r*m-t*a*m)*S,e[12]=C*S,e[13]=(u*_*i-g*h*i+g*r*f-t*_*f-u*r*v+t*h*v)*S,e[14]=(g*a*i-s*_*i-g*r*l+t*_*l+s*r*v-t*a*v)*S,e[15]=(s*h*i-u*a*i+u*r*l-t*h*l-s*r*f+t*a*f)*S,this}scale(e){const t=this.elements,r=e.x,i=e.y,o=e.z;return t[0]*=r,t[4]*=i,t[8]*=o,t[1]*=r,t[5]*=i,t[9]*=o,t[2]*=r,t[6]*=i,t[10]*=o,t[3]*=r,t[7]*=i,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),o=1-r,s=e.x,a=e.y,l=e.z,c=o*s,u=o*a;return this.set(c*s+r,c*a-i*l,c*l+i*a,0,c*a+i*l,u*a+r,u*l-i*s,0,c*l-i*a,u*l+i*s,o*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,o,s){return this.set(1,r,o,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,o=t._x,s=t._y,a=t._z,l=t._w,c=o+o,u=s+s,h=a+a,f=o*c,m=o*u,g=o*h,_=s*u,v=s*h,p=a*h,x=l*c,y=l*u,w=l*h,C=r.x,T=r.y,S=r.z;return i[0]=(1-(_+p))*C,i[1]=(m+w)*C,i[2]=(g-y)*C,i[3]=0,i[4]=(m-w)*T,i[5]=(1-(f+p))*T,i[6]=(v+x)*T,i[7]=0,i[8]=(g+y)*S,i[9]=(v-x)*S,i[10]=(1-(f+_))*S,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let o=Fh.set(i[0],i[1],i[2]).length();const s=Fh.set(i[4],i[5],i[6]).length(),a=Fh.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],ms.copy(this);const c=1/o,u=1/s,h=1/a;return ms.elements[0]*=c,ms.elements[1]*=c,ms.elements[2]*=c,ms.elements[4]*=u,ms.elements[5]*=u,ms.elements[6]*=u,ms.elements[8]*=h,ms.elements[9]*=h,ms.elements[10]*=h,t.setFromRotationMatrix(ms),r.x=o,r.y=s,r.z=a,this}makePerspective(e,t,r,i,o,s,a=ol){const l=this.elements,c=2*o/(t-e),u=2*o/(r-i),h=(t+e)/(t-e),f=(r+i)/(r-i);let m,g;if(a===ol)m=-(s+o)/(s-o),g=-2*s*o/(s-o);else if(a===gw)m=-s/(s-o),g=-s*o/(s-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=g,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,r,i,o,s,a=ol){const l=this.elements,c=1/(t-e),u=1/(r-i),h=1/(s-o),f=(t+e)*c,m=(r+i)*u;let g,_;if(a===ol)g=(s+o)*h,_=-2*h;else if(a===gw)g=o*h,_=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=_,l[14]=-g,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Fh=new N,ms=new dt,c$=new N(0,0,0),u$=new N(1,1,1),Jl=new N,k_=new N,ro=new N,FL=new dt,jL=new Hn;class Bs{constructor(e=0,t=0,r=0,i=Bs.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,o=i[0],s=i[4],a=i[8],l=i[1],c=i[5],u=i[9],h=i[2],f=i[6],m=i[10];switch(t){case"XYZ":this._y=Math.asin(fi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,m),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-fi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(fi(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,m),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-fi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,m),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(fi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-fi(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return FL.makeRotationFromQuaternion(e),this.setFromRotationMatrix(FL,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return jL.setFromEuler(this),this.setFromQuaternion(jL,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Bs.DEFAULT_ORDER="XYZ";class tI{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let d$=0;const BL=new N,jh=new Hn,Va=new dt,L_=new N,ig=new N,h$=new N,f$=new Hn,zL=new N(1,0,0),HL=new N(0,1,0),VL=new N(0,0,1),GL={type:"added"},p$={type:"removed"},Bh={type:"childadded",child:null},pT={type:"childremoved",child:null};class Tr extends hh{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:d$++}),this.uuid=Pm(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Tr.DEFAULT_UP.clone();const e=new N,t=new Bs,r=new Hn,i=new N(1,1,1);function o(){r.setFromEuler(t,!1)}function s(){t.setFromQuaternion(r,void 0,!1)}t._onChange(o),r._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new dt},normalMatrix:{value:new Nt}}),this.matrix=new dt,this.matrixWorld=new dt,this.matrixAutoUpdate=Tr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Tr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new tI,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return jh.setFromAxisAngle(e,t),this.quaternion.multiply(jh),this}rotateOnWorldAxis(e,t){return jh.setFromAxisAngle(e,t),this.quaternion.premultiply(jh),this}rotateX(e){return this.rotateOnAxis(zL,e)}rotateY(e){return this.rotateOnAxis(HL,e)}rotateZ(e){return this.rotateOnAxis(VL,e)}translateOnAxis(e,t){return BL.copy(e).applyQuaternion(this.quaternion),this.position.add(BL.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(zL,e)}translateY(e){return this.translateOnAxis(HL,e)}translateZ(e){return this.translateOnAxis(VL,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Va.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?L_.copy(e):L_.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),ig.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Va.lookAt(ig,L_,this.up):Va.lookAt(L_,ig,this.up),this.quaternion.setFromRotationMatrix(Va),i&&(Va.extractRotation(i.matrixWorld),jh.setFromRotationMatrix(Va),this.quaternion.premultiply(jh.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(GL),Bh.child=e,this.dispatchEvent(Bh),Bh.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(p$),pT.child=e,this.dispatchEvent(pT),pT.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Va.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Va.multiply(e.parent.matrixWorld)),e.applyMatrix4(Va),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(GL),Bh.child=e,this.dispatchEvent(Bh),Bh.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const s=this.children[r].getObjectByProperty(e,t);if(s!==void 0)return s}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let o=0,s=i.length;o<s;o++)i[o].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ig,e,h$),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ig,f$,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let o=0,s=i.length;o<s;o++)i[o].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function o(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];o(e.shapes,h)}else o(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(o(e.materials,this.material[l]));i.material=a}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];i.animations.push(o(e.animations,l))}}if(t){const a=s(e.geometries),l=s(e.materials),c=s(e.textures),u=s(e.images),h=s(e.shapes),f=s(e.skeletons),m=s(e.animations),g=s(e.nodes);a.length>0&&(r.geometries=a),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),m.length>0&&(r.animations=m),g.length>0&&(r.nodes=g)}return r.object=i,r;function s(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}Tr.DEFAULT_UP=new N(0,1,0);Tr.DEFAULT_MATRIX_AUTO_UPDATE=!0;Tr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const gs=new N,Ga=new N,mT=new N,Wa=new N,zh=new N,Hh=new N,WL=new N,gT=new N,vT=new N,_T=new N,xT=new gn,yT=new gn,wT=new gn;class Qo{constructor(e=new N,t=new N,r=new N){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),gs.subVectors(e,t),i.cross(gs);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(e,t,r,i,o){gs.subVectors(i,t),Ga.subVectors(r,t),mT.subVectors(e,t);const s=gs.dot(gs),a=gs.dot(Ga),l=gs.dot(mT),c=Ga.dot(Ga),u=Ga.dot(mT),h=s*c-a*a;if(h===0)return o.set(0,0,0),null;const f=1/h,m=(c*l-a*u)*f,g=(s*u-a*l)*f;return o.set(1-m-g,g,m)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,Wa)===null?!1:Wa.x>=0&&Wa.y>=0&&Wa.x+Wa.y<=1}static getInterpolation(e,t,r,i,o,s,a,l){return this.getBarycoord(e,t,r,i,Wa)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(o,Wa.x),l.addScaledVector(s,Wa.y),l.addScaledVector(a,Wa.z),l)}static getInterpolatedAttribute(e,t,r,i,o,s){return xT.setScalar(0),yT.setScalar(0),wT.setScalar(0),xT.fromBufferAttribute(e,t),yT.fromBufferAttribute(e,r),wT.fromBufferAttribute(e,i),s.setScalar(0),s.addScaledVector(xT,o.x),s.addScaledVector(yT,o.y),s.addScaledVector(wT,o.z),s}static isFrontFacing(e,t,r,i){return gs.subVectors(r,t),Ga.subVectors(e,t),gs.cross(Ga).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return gs.subVectors(this.c,this.b),Ga.subVectors(this.a,this.b),gs.cross(Ga).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Qo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Qo.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,o){return Qo.getInterpolation(e,this.a,this.b,this.c,t,r,i,o)}containsPoint(e){return Qo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Qo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,o=this.c;let s,a;zh.subVectors(i,r),Hh.subVectors(o,r),gT.subVectors(e,r);const l=zh.dot(gT),c=Hh.dot(gT);if(l<=0&&c<=0)return t.copy(r);vT.subVectors(e,i);const u=zh.dot(vT),h=Hh.dot(vT);if(u>=0&&h<=u)return t.copy(i);const f=l*h-u*c;if(f<=0&&l>=0&&u<=0)return s=l/(l-u),t.copy(r).addScaledVector(zh,s);_T.subVectors(e,o);const m=zh.dot(_T),g=Hh.dot(_T);if(g>=0&&m<=g)return t.copy(o);const _=m*c-l*g;if(_<=0&&c>=0&&g<=0)return a=c/(c-g),t.copy(r).addScaledVector(Hh,a);const v=u*g-m*h;if(v<=0&&h-u>=0&&m-g>=0)return WL.subVectors(o,i),a=(h-u)/(h-u+(m-g)),t.copy(i).addScaledVector(WL,a);const p=1/(v+_+f);return s=_*p,a=f*p,t.copy(r).addScaledVector(zh,s).addScaledVector(Hh,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const $F={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ec={h:0,s:0,l:0},O_={h:0,s:0,l:0};function ST(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class rt{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=$o){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,sn.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=sn.workingColorSpace){return this.r=e,this.g=t,this.b=r,sn.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=sn.workingColorSpace){if(e=ZN(e,1),t=fi(t,0,1),r=fi(r,0,1),t===0)this.r=this.g=this.b=r;else{const o=r<=.5?r*(1+t):r+t-r*t,s=2*r-o;this.r=ST(s,o,e+1/3),this.g=ST(s,o,e),this.b=ST(s,o,e-1/3)}return sn.toWorkingColorSpace(this,i),this}setStyle(e,t=$o){function r(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=i[1],s=o.length;if(s===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(s===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=$o){const r=$F[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Sp(e.r),this.g=Sp(e.g),this.b=Sp(e.b),this}copyLinearToSRGB(e){return this.r=sT(e.r),this.g=sT(e.g),this.b=sT(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=$o){return sn.fromWorkingColorSpace(ii.copy(this),e),Math.round(fi(ii.r*255,0,255))*65536+Math.round(fi(ii.g*255,0,255))*256+Math.round(fi(ii.b*255,0,255))}getHexString(e=$o){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=sn.workingColorSpace){sn.fromWorkingColorSpace(ii.copy(this),t);const r=ii.r,i=ii.g,o=ii.b,s=Math.max(r,i,o),a=Math.min(r,i,o);let l,c;const u=(a+s)/2;if(a===s)l=0,c=0;else{const h=s-a;switch(c=u<=.5?h/(s+a):h/(2-s-a),s){case r:l=(i-o)/h+(i<o?6:0);break;case i:l=(o-r)/h+2;break;case o:l=(r-i)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=sn.workingColorSpace){return sn.fromWorkingColorSpace(ii.copy(this),t),e.r=ii.r,e.g=ii.g,e.b=ii.b,e}getStyle(e=$o){sn.fromWorkingColorSpace(ii.copy(this),e);const t=ii.r,r=ii.g,i=ii.b;return e!==$o?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(ec),this.setHSL(ec.h+e,ec.s+t,ec.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(ec),e.getHSL(O_);const r=C0(ec.h,O_.h,t),i=C0(ec.s,O_.s,t),o=C0(ec.l,O_.l,t);return this.setHSL(r,i,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,o=e.elements;return this.r=o[0]*t+o[3]*r+o[6]*i,this.g=o[1]*t+o[4]*r+o[7]*i,this.b=o[2]*t+o[5]*r+o[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ii=new rt;rt.NAMES=$F;let m$=0,Lm=class extends hh{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:m$++}),this.uuid=Pm(),this.name="",this.type="Material",this.blending=xp,this.side=bl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=$2,this.blendDst=Y2,this.blendEquation=nd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new rt(0,0,0),this.blendAlpha=0,this.depthFunc=Zp,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=NL,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=kh,this.stencilZFail=kh,this.stencilZPass=kh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==xp&&(r.blending=this.blending),this.side!==bl&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==$2&&(r.blendSrc=this.blendSrc),this.blendDst!==Y2&&(r.blendDst=this.blendDst),this.blendEquation!==nd&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==Zp&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==NL&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==kh&&(r.stencilFail=this.stencilFail),this.stencilZFail!==kh&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==kh&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(o){const s=[];for(const a in o){const l=o[a];delete l.metadata,s.push(l)}return s}if(t){const o=i(e.textures),s=i(e.images);o.length>0&&(r.textures=o),s.length>0&&(r.images=s)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let o=0;o!==i;++o)r[o]=t[o].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}};class vu extends Lm{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new rt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Bs,this.combine=EF,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const vr=new N,D_=new Ut;class $n{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=IL,this.updateRanges=[],this.gpuType=il,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)D_.fromBufferAttribute(this,t),D_.applyMatrix3(e),this.setXY(t,D_.x,D_.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)vr.fromBufferAttribute(this,t),vr.applyMatrix3(e),this.setXYZ(t,vr.x,vr.y,vr.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)vr.fromBufferAttribute(this,t),vr.applyMatrix4(e),this.setXYZ(t,vr.x,vr.y,vr.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)vr.fromBufferAttribute(this,t),vr.applyNormalMatrix(e),this.setXYZ(t,vr.x,vr.y,vr.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)vr.fromBufferAttribute(this,t),vr.transformDirection(e),this.setXYZ(t,vr.x,vr.y,vr.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=Af(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Si(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Af(t,this.array)),t}setX(e,t){return this.normalized&&(t=Si(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Af(t,this.array)),t}setY(e,t){return this.normalized&&(t=Si(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Af(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Si(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Af(t,this.array)),t}setW(e,t){return this.normalized&&(t=Si(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Si(t,this.array),r=Si(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Si(t,this.array),r=Si(r,this.array),i=Si(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,o){return e*=this.itemSize,this.normalized&&(t=Si(t,this.array),r=Si(r,this.array),i=Si(i,this.array),o=Si(o,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==IL&&(e.usage=this.usage),e}}class YF extends $n{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class KF extends $n{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class tn extends $n{constructor(e,t,r){super(new Float32Array(e),t,r)}}let g$=0;const jo=new dt,ET=new Tr,Vh=new N,io=new nt,og=new nt,Dr=new N;class Sn extends hh{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:g$++}),this.uuid=Pm(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(GF(e)?KF:YF)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const o=new Nt().getNormalMatrix(e);r.applyNormalMatrix(o),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return jo.makeRotationFromQuaternion(e),this.applyMatrix4(jo),this}rotateX(e){return jo.makeRotationX(e),this.applyMatrix4(jo),this}rotateY(e){return jo.makeRotationY(e),this.applyMatrix4(jo),this}rotateZ(e){return jo.makeRotationZ(e),this.applyMatrix4(jo),this}translate(e,t,r){return jo.makeTranslation(e,t,r),this.applyMatrix4(jo),this}scale(e,t,r){return jo.makeScale(e,t,r),this.applyMatrix4(jo),this}lookAt(e){return ET.lookAt(e),ET.updateMatrix(),this.applyMatrix4(ET.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Vh).negate(),this.translate(Vh.x,Vh.y,Vh.z),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const o=e[r];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new tn(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new nt);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new N(-1/0,-1/0,-1/0),new N(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const o=t[r];io.setFromBufferAttribute(o),this.morphTargetsRelative?(Dr.addVectors(this.boundingBox.min,io.min),this.boundingBox.expandByPoint(Dr),Dr.addVectors(this.boundingBox.max,io.max),this.boundingBox.expandByPoint(Dr)):(this.boundingBox.expandByPoint(io.min),this.boundingBox.expandByPoint(io.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new km);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new N,1/0);return}if(e){const r=this.boundingSphere.center;if(io.setFromBufferAttribute(e),t)for(let o=0,s=t.length;o<s;o++){const a=t[o];og.setFromBufferAttribute(a),this.morphTargetsRelative?(Dr.addVectors(io.min,og.min),io.expandByPoint(Dr),Dr.addVectors(io.max,og.max),io.expandByPoint(Dr)):(io.expandByPoint(og.min),io.expandByPoint(og.max))}io.getCenter(r);let i=0;for(let o=0,s=e.count;o<s;o++)Dr.fromBufferAttribute(e,o),i=Math.max(i,r.distanceToSquared(Dr));if(t)for(let o=0,s=t.length;o<s;o++){const a=t[o],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)Dr.fromBufferAttribute(a,c),l&&(Vh.fromBufferAttribute(e,c),Dr.add(Vh)),i=Math.max(i,r.distanceToSquared(Dr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,o=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new $n(new Float32Array(4*r.count),4));const s=this.getAttribute("tangent"),a=[],l=[];for(let b=0;b<r.count;b++)a[b]=new N,l[b]=new N;const c=new N,u=new N,h=new N,f=new Ut,m=new Ut,g=new Ut,_=new N,v=new N;function p(b,R,E){c.fromBufferAttribute(r,b),u.fromBufferAttribute(r,R),h.fromBufferAttribute(r,E),f.fromBufferAttribute(o,b),m.fromBufferAttribute(o,R),g.fromBufferAttribute(o,E),u.sub(c),h.sub(c),m.sub(f),g.sub(f);const A=1/(m.x*g.y-g.x*m.y);isFinite(A)&&(_.copy(u).multiplyScalar(g.y).addScaledVector(h,-m.y).multiplyScalar(A),v.copy(h).multiplyScalar(m.x).addScaledVector(u,-g.x).multiplyScalar(A),a[b].add(_),a[R].add(_),a[E].add(_),l[b].add(v),l[R].add(v),l[E].add(v))}let x=this.groups;x.length===0&&(x=[{start:0,count:e.count}]);for(let b=0,R=x.length;b<R;++b){const E=x[b],A=E.start,F=E.count;for(let D=A,M=A+F;D<M;D+=3)p(e.getX(D+0),e.getX(D+1),e.getX(D+2))}const y=new N,w=new N,C=new N,T=new N;function S(b){C.fromBufferAttribute(i,b),T.copy(C);const R=a[b];y.copy(R),y.sub(C.multiplyScalar(C.dot(R))).normalize(),w.crossVectors(T,R);const A=w.dot(l[b])<0?-1:1;s.setXYZW(b,y.x,y.y,y.z,A)}for(let b=0,R=x.length;b<R;++b){const E=x[b],A=E.start,F=E.count;for(let D=A,M=A+F;D<M;D+=3)S(e.getX(D+0)),S(e.getX(D+1)),S(e.getX(D+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new $n(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let f=0,m=r.count;f<m;f++)r.setXYZ(f,0,0,0);const i=new N,o=new N,s=new N,a=new N,l=new N,c=new N,u=new N,h=new N;if(e)for(let f=0,m=e.count;f<m;f+=3){const g=e.getX(f+0),_=e.getX(f+1),v=e.getX(f+2);i.fromBufferAttribute(t,g),o.fromBufferAttribute(t,_),s.fromBufferAttribute(t,v),u.subVectors(s,o),h.subVectors(i,o),u.cross(h),a.fromBufferAttribute(r,g),l.fromBufferAttribute(r,_),c.fromBufferAttribute(r,v),a.add(u),l.add(u),c.add(u),r.setXYZ(g,a.x,a.y,a.z),r.setXYZ(_,l.x,l.y,l.z),r.setXYZ(v,c.x,c.y,c.z)}else for(let f=0,m=t.count;f<m;f+=3)i.fromBufferAttribute(t,f+0),o.fromBufferAttribute(t,f+1),s.fromBufferAttribute(t,f+2),u.subVectors(s,o),h.subVectors(i,o),u.cross(h),r.setXYZ(f+0,u.x,u.y,u.z),r.setXYZ(f+1,u.x,u.y,u.z),r.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Dr.fromBufferAttribute(e,t),Dr.normalize(),e.setXYZ(t,Dr.x,Dr.y,Dr.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,f=new c.constructor(l.length*u);let m=0,g=0;for(let _=0,v=l.length;_<v;_++){a.isInterleavedBufferAttribute?m=l[_]*a.data.stride+a.offset:m=l[_]*u;for(let p=0;p<u;p++)f[g++]=c[m++]}return new $n(f,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Sn,r=this.index.array,i=this.attributes;for(const a in i){const l=i[a],c=e(l,r);t.setAttribute(a,c)}const o=this.morphAttributes;for(const a in o){const l=[],c=o[a];for(let u=0,h=c.length;u<h;u++){const f=c[u],m=e(f,r);l.push(m)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,l=s.length;a<l;a++){const c=s[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const i={};let o=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,f=c.length;h<f;h++){const m=c[h];u.push(m.toJSON(e.data))}u.length>0&&(i[l]=u,o=!0)}o&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const i=e.attributes;for(const c in i){const u=i[c];this.setAttribute(c,u.clone(t))}const o=e.morphAttributes;for(const c in o){const u=[],h=o[c];for(let f=0,m=h.length;f<m;f++)u.push(h[f].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let c=0,u=s.length;c<u;c++){const h=s[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const $L=new dt,Mu=new eI,U_=new km,YL=new N,F_=new N,j_=new N,B_=new N,TT=new N,z_=new N,KL=new N,H_=new N;let Ve=class extends Tr{constructor(e=new Sn,t=new vu){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=i.length;o<s;o++){const a=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,o=r.morphAttributes.position,s=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(o&&a){z_.set(0,0,0);for(let l=0,c=o.length;l<c;l++){const u=a[l],h=o[l];u!==0&&(TT.fromBufferAttribute(h,e),s?z_.addScaledVector(TT,u):z_.addScaledVector(TT.sub(t),u))}t.add(z_)}return t}raycast(e,t){const r=this.geometry,i=this.material,o=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),U_.copy(r.boundingSphere),U_.applyMatrix4(o),Mu.copy(e.ray).recast(e.near),!(U_.containsPoint(Mu.origin)===!1&&(Mu.intersectSphere(U_,YL)===null||Mu.origin.distanceToSquared(YL)>(e.far-e.near)**2))&&($L.copy(o).invert(),Mu.copy(e.ray).applyMatrix4($L),!(r.boundingBox!==null&&Mu.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,Mu)))}_computeIntersections(e,t,r){let i;const o=this.geometry,s=this.material,a=o.index,l=o.attributes.position,c=o.attributes.uv,u=o.attributes.uv1,h=o.attributes.normal,f=o.groups,m=o.drawRange;if(a!==null)if(Array.isArray(s))for(let g=0,_=f.length;g<_;g++){const v=f[g],p=s[v.materialIndex],x=Math.max(v.start,m.start),y=Math.min(a.count,Math.min(v.start+v.count,m.start+m.count));for(let w=x,C=y;w<C;w+=3){const T=a.getX(w),S=a.getX(w+1),b=a.getX(w+2);i=V_(this,p,e,r,c,u,h,T,S,b),i&&(i.faceIndex=Math.floor(w/3),i.face.materialIndex=v.materialIndex,t.push(i))}}else{const g=Math.max(0,m.start),_=Math.min(a.count,m.start+m.count);for(let v=g,p=_;v<p;v+=3){const x=a.getX(v),y=a.getX(v+1),w=a.getX(v+2);i=V_(this,s,e,r,c,u,h,x,y,w),i&&(i.faceIndex=Math.floor(v/3),t.push(i))}}else if(l!==void 0)if(Array.isArray(s))for(let g=0,_=f.length;g<_;g++){const v=f[g],p=s[v.materialIndex],x=Math.max(v.start,m.start),y=Math.min(l.count,Math.min(v.start+v.count,m.start+m.count));for(let w=x,C=y;w<C;w+=3){const T=w,S=w+1,b=w+2;i=V_(this,p,e,r,c,u,h,T,S,b),i&&(i.faceIndex=Math.floor(w/3),i.face.materialIndex=v.materialIndex,t.push(i))}}else{const g=Math.max(0,m.start),_=Math.min(l.count,m.start+m.count);for(let v=g,p=_;v<p;v+=3){const x=v,y=v+1,w=v+2;i=V_(this,s,e,r,c,u,h,x,y,w),i&&(i.faceIndex=Math.floor(v/3),t.push(i))}}}};function v$(n,e,t,r,i,o,s,a){let l;if(e.side===Ki?l=r.intersectTriangle(s,o,i,!0,a):l=r.intersectTriangle(i,o,s,e.side===bl,a),l===null)return null;H_.copy(a),H_.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(H_);return c<t.near||c>t.far?null:{distance:c,point:H_.clone(),object:n}}function V_(n,e,t,r,i,o,s,a,l,c){n.getVertexPosition(a,F_),n.getVertexPosition(l,j_),n.getVertexPosition(c,B_);const u=v$(n,e,t,r,F_,j_,B_,KL);if(u){const h=new N;Qo.getBarycoord(KL,F_,j_,B_,h),i&&(u.uv=Qo.getInterpolatedAttribute(i,a,l,c,h,new Ut)),o&&(u.uv1=Qo.getInterpolatedAttribute(o,a,l,c,h,new Ut)),s&&(u.normal=Qo.getInterpolatedAttribute(s,a,l,c,h,new N),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const f={a,b:l,c,normal:new N,materialIndex:0};Qo.getNormal(F_,j_,B_,f.normal),u.face=f,u.barycoord=h}return u}class Xn extends Sn{constructor(e=1,t=1,r=1,i=1,o=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:o,depthSegments:s};const a=this;i=Math.floor(i),o=Math.floor(o),s=Math.floor(s);const l=[],c=[],u=[],h=[];let f=0,m=0;g("z","y","x",-1,-1,r,t,e,s,o,0),g("z","y","x",1,-1,r,t,-e,s,o,1),g("x","z","y",1,1,e,r,t,i,s,2),g("x","z","y",1,-1,e,r,-t,i,s,3),g("x","y","z",1,-1,e,t,r,i,o,4),g("x","y","z",-1,-1,e,t,-r,i,o,5),this.setIndex(l),this.setAttribute("position",new tn(c,3)),this.setAttribute("normal",new tn(u,3)),this.setAttribute("uv",new tn(h,2));function g(_,v,p,x,y,w,C,T,S,b,R){const E=w/S,A=C/b,F=w/2,D=C/2,M=T/2,k=S+1,z=b+1;let P=0,U=0;const Y=new N;for(let Z=0;Z<z;Z++){const j=Z*A-D;for(let X=0;X<k;X++){const B=X*E-F;Y[_]=B*x,Y[v]=j*y,Y[p]=M,c.push(Y.x,Y.y,Y.z),Y[_]=0,Y[v]=0,Y[p]=T>0?1:-1,u.push(Y.x,Y.y,Y.z),h.push(X/S),h.push(1-Z/b),P+=1}}for(let Z=0;Z<b;Z++)for(let j=0;j<S;j++){const X=f+j+k*Z,B=f+j+k*(Z+1),K=f+(j+1)+k*(Z+1),ee=f+(j+1)+k*Z;l.push(X,B,ee),l.push(B,K,ee),U+=6}a.addGroup(m,U,R),m+=U,f+=P}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xn(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function rm(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function Ei(n){const e={};for(let t=0;t<n.length;t++){const r=rm(n[t]);for(const i in r)e[i]=r[i]}return e}function _$(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function XF(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:sn.workingColorSpace}const NE={clone:rm,merge:Ei};var x$=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,y$=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class No extends Lm{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=x$,this.fragmentShader=y$,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=rm(e.uniforms),this.uniformsGroups=_$(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const s=this.uniforms[i].value;s&&s.isTexture?t.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[i]={type:"m4",value:s.toArray()}:t.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}let qF=class extends Tr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new dt,this.projectionMatrix=new dt,this.projectionMatrixInverse=new dt,this.coordinateSystem=ol}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const tc=new N,XL=new Ut,qL=new Ut;class Vi extends qF{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=iv*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(wp*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return iv*2*Math.atan(Math.tan(wp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){tc.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(tc.x,tc.y).multiplyScalar(-e/tc.z),tc.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(tc.x,tc.y).multiplyScalar(-e/tc.z)}getViewSize(e,t){return this.getViewBounds(e,XL,qL),t.subVectors(qL,XL)}setViewOffset(e,t,r,i,o,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(wp*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,o=-.5*i;const s=this.view;if(this.view!==null&&this.view.enabled){const l=s.fullWidth,c=s.fullHeight;o+=s.offsetX*i/l,t-=s.offsetY*r/c,i*=s.width/l,r*=s.height/c}const a=this.filmOffset;a!==0&&(o+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Gh=-90,Wh=1;class w$ extends Tr{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Vi(Gh,Wh,e,t);i.layers=this.layers,this.add(i);const o=new Vi(Gh,Wh,e,t);o.layers=this.layers,this.add(o);const s=new Vi(Gh,Wh,e,t);s.layers=this.layers,this.add(s);const a=new Vi(Gh,Wh,e,t);a.layers=this.layers,this.add(a);const l=new Vi(Gh,Wh,e,t);l.layers=this.layers,this.add(l);const c=new Vi(Gh,Wh,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,o,s,a,l]=t;for(const c of t)this.remove(c);if(e===ol)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===gw)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,s,a,l,c,u]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),g=e.xr.enabled;e.xr.enabled=!1;const _=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,o),e.setRenderTarget(r,1,i),e.render(t,s),e.setRenderTarget(r,2,i),e.render(t,a),e.setRenderTarget(r,3,i),e.render(t,l),e.setRenderTarget(r,4,i),e.render(t,c),r.texture.generateMipmaps=_,e.setRenderTarget(r,5,i),e.render(t,u),e.setRenderTarget(h,f,m),e.xr.enabled=g,r.texture.needsPMREMUpdate=!0}}class QF extends ds{constructor(e,t,r,i,o,s,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:Jp,super(e,t,r,i,o,s,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class S$ extends is{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new QF(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:qo}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Xn(5,5,5),o=new No({name:"CubemapFromEquirect",uniforms:rm(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Ki,blending:pl});o.uniforms.tEquirect.value=t;const s=new Ve(i,o),a=t.minFilter;return t.minFilter===Lc&&(t.minFilter=qo),new w$(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,r,i){const o=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,r,i);e.setRenderTarget(o)}}const CT=new N,E$=new N,T$=new Nt;class da{constructor(e=new N(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=CT.subVectors(r,t).cross(E$.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(CT),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:t.copy(e.start).addScaledVector(r,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||T$.getNormalMatrix(e),i=this.coplanarPoint(CT).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Ru=new km,G_=new N;class nI{constructor(e=new da,t=new da,r=new da,i=new da,o=new da,s=new da){this.planes=[e,t,r,i,o,s]}set(e,t,r,i,o,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(o),a[5].copy(s),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=ol){const r=this.planes,i=e.elements,o=i[0],s=i[1],a=i[2],l=i[3],c=i[4],u=i[5],h=i[6],f=i[7],m=i[8],g=i[9],_=i[10],v=i[11],p=i[12],x=i[13],y=i[14],w=i[15];if(r[0].setComponents(l-o,f-c,v-m,w-p).normalize(),r[1].setComponents(l+o,f+c,v+m,w+p).normalize(),r[2].setComponents(l+s,f+u,v+g,w+x).normalize(),r[3].setComponents(l-s,f-u,v-g,w-x).normalize(),r[4].setComponents(l-a,f-h,v-_,w-y).normalize(),t===ol)r[5].setComponents(l+a,f+h,v+_,w+y).normalize();else if(t===gw)r[5].setComponents(a,h,_,y).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Ru.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Ru.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Ru)}intersectsSprite(e){return Ru.center.set(0,0,0),Ru.radius=.7071067811865476,Ru.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ru)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(G_.x=i.normal.x>0?e.max.x:e.min.x,G_.y=i.normal.y>0?e.max.y:e.min.y,G_.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(G_)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ZF(){let n=null,e=!1,t=null,r=null;function i(o,s){t(o,s),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function C$(n){const e=new WeakMap;function t(a,l){const c=a.array,u=a.usage,h=c.byteLength,f=n.createBuffer();n.bindBuffer(l,f),n.bufferData(l,c,u),a.onUploadCallback();let m;if(c instanceof Float32Array)m=n.FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?m=n.HALF_FLOAT:m=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)m=n.SHORT;else if(c instanceof Uint32Array)m=n.UNSIGNED_INT;else if(c instanceof Int32Array)m=n.INT;else if(c instanceof Int8Array)m=n.BYTE;else if(c instanceof Uint8Array)m=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)m=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:f,type:m,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:h}}function r(a,l,c){const u=l.array,h=l.updateRanges;if(n.bindBuffer(c,a),h.length===0)n.bufferSubData(c,0,u);else{h.sort((m,g)=>m.start-g.start);let f=0;for(let m=1;m<h.length;m++){const g=h[f],_=h[m];_.start<=g.start+g.count+1?g.count=Math.max(g.count,_.start+_.count-g.start):(++f,h[f]=_)}h.length=f+1;for(let m=0,g=h.length;m<g;m++){const _=h[m];n.bufferSubData(c,_.start*u.BYTES_PER_ELEMENT,u,_.start,_.count)}l.clearUpdateRanges()}l.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function o(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(n.deleteBuffer(l.buffer),e.delete(a))}function s(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=e.get(a);if(c===void 0)e.set(a,t(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(c.buffer,a,l),c.version=a.version}}return{get:i,remove:o,update:s}}class Om extends Sn{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const o=e/2,s=t/2,a=Math.floor(r),l=Math.floor(i),c=a+1,u=l+1,h=e/a,f=t/l,m=[],g=[],_=[],v=[];for(let p=0;p<u;p++){const x=p*f-s;for(let y=0;y<c;y++){const w=y*h-o;g.push(w,-x,0),_.push(0,0,1),v.push(y/a),v.push(1-p/l)}}for(let p=0;p<l;p++)for(let x=0;x<a;x++){const y=x+c*p,w=x+c*(p+1),C=x+1+c*(p+1),T=x+1+c*p;m.push(y,w,T),m.push(w,C,T)}this.setIndex(m),this.setAttribute("position",new tn(g,3)),this.setAttribute("normal",new tn(_,3)),this.setAttribute("uv",new tn(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Om(e.width,e.height,e.widthSegments,e.heightSegments)}}var b$=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,A$=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,M$=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,R$=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,N$=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,I$=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,P$=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,k$=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,L$=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,O$=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,D$=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,U$=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,F$=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,j$=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,B$=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,z$=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,H$=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,V$=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,G$=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,W$=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,$$=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Y$=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,K$=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,X$=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,q$=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Q$=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Z$=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,J$=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,eY=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,tY=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,nY="gl_FragColor = linearToOutputTexel( gl_FragColor );",rY=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,iY=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,oY=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,sY=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,aY=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,lY=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,cY=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,uY=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,dY=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,hY=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,fY=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,pY=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,mY=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,gY=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,vY=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,_Y=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,xY=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,yY=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,wY=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,SY=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,EY=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,TY=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,CY=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,bY=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,AY=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,MY=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,RY=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,NY=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,IY=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,PY=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,kY=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,LY=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,OY=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,DY=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,UY=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,FY=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,jY=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,BY=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,zY=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,HY=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,VY=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,GY=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,WY=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,$Y=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,YY=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,KY=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,XY=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,qY=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,QY=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,ZY=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,JY=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,eK=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,tK=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,nK=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,rK=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,iK=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,oK=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,sK=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,aK=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,lK=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,cK=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,uK=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,dK=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,hK=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,fK=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,pK=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,mK=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,gK=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,vK=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,_K=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,xK=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,yK=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,wK=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,SK=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,EK=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,TK=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const CK=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,bK=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,AK=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,MK=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,RK=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,NK=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,IK=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,PK=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,kK=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,LK=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,OK=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,DK=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,UK=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,FK=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,jK=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,BK=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zK=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,HK=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,VK=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,GK=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,WK=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,$K=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,YK=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,KK=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,XK=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,qK=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,QK=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ZK=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,JK=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,eX=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,tX=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,nX=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,rX=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,iX=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ot={alphahash_fragment:b$,alphahash_pars_fragment:A$,alphamap_fragment:M$,alphamap_pars_fragment:R$,alphatest_fragment:N$,alphatest_pars_fragment:I$,aomap_fragment:P$,aomap_pars_fragment:k$,batching_pars_vertex:L$,batching_vertex:O$,begin_vertex:D$,beginnormal_vertex:U$,bsdfs:F$,iridescence_fragment:j$,bumpmap_pars_fragment:B$,clipping_planes_fragment:z$,clipping_planes_pars_fragment:H$,clipping_planes_pars_vertex:V$,clipping_planes_vertex:G$,color_fragment:W$,color_pars_fragment:$$,color_pars_vertex:Y$,color_vertex:K$,common:X$,cube_uv_reflection_fragment:q$,defaultnormal_vertex:Q$,displacementmap_pars_vertex:Z$,displacementmap_vertex:J$,emissivemap_fragment:eY,emissivemap_pars_fragment:tY,colorspace_fragment:nY,colorspace_pars_fragment:rY,envmap_fragment:iY,envmap_common_pars_fragment:oY,envmap_pars_fragment:sY,envmap_pars_vertex:aY,envmap_physical_pars_fragment:_Y,envmap_vertex:lY,fog_vertex:cY,fog_pars_vertex:uY,fog_fragment:dY,fog_pars_fragment:hY,gradientmap_pars_fragment:fY,lightmap_pars_fragment:pY,lights_lambert_fragment:mY,lights_lambert_pars_fragment:gY,lights_pars_begin:vY,lights_toon_fragment:xY,lights_toon_pars_fragment:yY,lights_phong_fragment:wY,lights_phong_pars_fragment:SY,lights_physical_fragment:EY,lights_physical_pars_fragment:TY,lights_fragment_begin:CY,lights_fragment_maps:bY,lights_fragment_end:AY,logdepthbuf_fragment:MY,logdepthbuf_pars_fragment:RY,logdepthbuf_pars_vertex:NY,logdepthbuf_vertex:IY,map_fragment:PY,map_pars_fragment:kY,map_particle_fragment:LY,map_particle_pars_fragment:OY,metalnessmap_fragment:DY,metalnessmap_pars_fragment:UY,morphinstance_vertex:FY,morphcolor_vertex:jY,morphnormal_vertex:BY,morphtarget_pars_vertex:zY,morphtarget_vertex:HY,normal_fragment_begin:VY,normal_fragment_maps:GY,normal_pars_fragment:WY,normal_pars_vertex:$Y,normal_vertex:YY,normalmap_pars_fragment:KY,clearcoat_normal_fragment_begin:XY,clearcoat_normal_fragment_maps:qY,clearcoat_pars_fragment:QY,iridescence_pars_fragment:ZY,opaque_fragment:JY,packing:eK,premultiplied_alpha_fragment:tK,project_vertex:nK,dithering_fragment:rK,dithering_pars_fragment:iK,roughnessmap_fragment:oK,roughnessmap_pars_fragment:sK,shadowmap_pars_fragment:aK,shadowmap_pars_vertex:lK,shadowmap_vertex:cK,shadowmask_pars_fragment:uK,skinbase_vertex:dK,skinning_pars_vertex:hK,skinning_vertex:fK,skinnormal_vertex:pK,specularmap_fragment:mK,specularmap_pars_fragment:gK,tonemapping_fragment:vK,tonemapping_pars_fragment:_K,transmission_fragment:xK,transmission_pars_fragment:yK,uv_pars_fragment:wK,uv_pars_vertex:SK,uv_vertex:EK,worldpos_vertex:TK,background_vert:CK,background_frag:bK,backgroundCube_vert:AK,backgroundCube_frag:MK,cube_vert:RK,cube_frag:NK,depth_vert:IK,depth_frag:PK,distanceRGBA_vert:kK,distanceRGBA_frag:LK,equirect_vert:OK,equirect_frag:DK,linedashed_vert:UK,linedashed_frag:FK,meshbasic_vert:jK,meshbasic_frag:BK,meshlambert_vert:zK,meshlambert_frag:HK,meshmatcap_vert:VK,meshmatcap_frag:GK,meshnormal_vert:WK,meshnormal_frag:$K,meshphong_vert:YK,meshphong_frag:KK,meshphysical_vert:XK,meshphysical_frag:qK,meshtoon_vert:QK,meshtoon_frag:ZK,points_vert:JK,points_frag:eX,shadow_vert:tX,shadow_frag:nX,sprite_vert:rX,sprite_frag:iX},We={common:{diffuse:{value:new rt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Nt},alphaMap:{value:null},alphaMapTransform:{value:new Nt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Nt}},envmap:{envMap:{value:null},envMapRotation:{value:new Nt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Nt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Nt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Nt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Nt},normalScale:{value:new Ut(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Nt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Nt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Nt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Nt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new rt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new rt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Nt},alphaTest:{value:0},uvTransform:{value:new Nt}},sprite:{diffuse:{value:new rt(16777215)},opacity:{value:1},center:{value:new Ut(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Nt},alphaMap:{value:null},alphaMapTransform:{value:new Nt},alphaTest:{value:0}}},ha={basic:{uniforms:Ei([We.common,We.specularmap,We.envmap,We.aomap,We.lightmap,We.fog]),vertexShader:Ot.meshbasic_vert,fragmentShader:Ot.meshbasic_frag},lambert:{uniforms:Ei([We.common,We.specularmap,We.envmap,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.fog,We.lights,{emissive:{value:new rt(0)}}]),vertexShader:Ot.meshlambert_vert,fragmentShader:Ot.meshlambert_frag},phong:{uniforms:Ei([We.common,We.specularmap,We.envmap,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.fog,We.lights,{emissive:{value:new rt(0)},specular:{value:new rt(1118481)},shininess:{value:30}}]),vertexShader:Ot.meshphong_vert,fragmentShader:Ot.meshphong_frag},standard:{uniforms:Ei([We.common,We.envmap,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.roughnessmap,We.metalnessmap,We.fog,We.lights,{emissive:{value:new rt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ot.meshphysical_vert,fragmentShader:Ot.meshphysical_frag},toon:{uniforms:Ei([We.common,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.gradientmap,We.fog,We.lights,{emissive:{value:new rt(0)}}]),vertexShader:Ot.meshtoon_vert,fragmentShader:Ot.meshtoon_frag},matcap:{uniforms:Ei([We.common,We.bumpmap,We.normalmap,We.displacementmap,We.fog,{matcap:{value:null}}]),vertexShader:Ot.meshmatcap_vert,fragmentShader:Ot.meshmatcap_frag},points:{uniforms:Ei([We.points,We.fog]),vertexShader:Ot.points_vert,fragmentShader:Ot.points_frag},dashed:{uniforms:Ei([We.common,We.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ot.linedashed_vert,fragmentShader:Ot.linedashed_frag},depth:{uniforms:Ei([We.common,We.displacementmap]),vertexShader:Ot.depth_vert,fragmentShader:Ot.depth_frag},normal:{uniforms:Ei([We.common,We.bumpmap,We.normalmap,We.displacementmap,{opacity:{value:1}}]),vertexShader:Ot.meshnormal_vert,fragmentShader:Ot.meshnormal_frag},sprite:{uniforms:Ei([We.sprite,We.fog]),vertexShader:Ot.sprite_vert,fragmentShader:Ot.sprite_frag},background:{uniforms:{uvTransform:{value:new Nt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ot.background_vert,fragmentShader:Ot.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Nt}},vertexShader:Ot.backgroundCube_vert,fragmentShader:Ot.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ot.cube_vert,fragmentShader:Ot.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ot.equirect_vert,fragmentShader:Ot.equirect_frag},distanceRGBA:{uniforms:Ei([We.common,We.displacementmap,{referencePosition:{value:new N},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ot.distanceRGBA_vert,fragmentShader:Ot.distanceRGBA_frag},shadow:{uniforms:Ei([We.lights,We.fog,{color:{value:new rt(0)},opacity:{value:1}}]),vertexShader:Ot.shadow_vert,fragmentShader:Ot.shadow_frag}};ha.physical={uniforms:Ei([ha.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Nt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Nt},clearcoatNormalScale:{value:new Ut(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Nt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Nt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Nt},sheen:{value:0},sheenColor:{value:new rt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Nt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Nt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Nt},transmissionSamplerSize:{value:new Ut},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Nt},attenuationDistance:{value:0},attenuationColor:{value:new rt(0)},specularColor:{value:new rt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Nt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Nt},anisotropyVector:{value:new Ut},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Nt}}]),vertexShader:Ot.meshphysical_vert,fragmentShader:Ot.meshphysical_frag};const W_={r:0,b:0,g:0},Nu=new Bs,oX=new dt;function sX(n,e,t,r,i,o,s){const a=new rt(0);let l=o===!0?0:1,c,u,h=null,f=0,m=null;function g(x){let y=x.isScene===!0?x.background:null;return y&&y.isTexture&&(y=(x.backgroundBlurriness>0?t:e).get(y)),y}function _(x){let y=!1;const w=g(x);w===null?p(a,l):w&&w.isColor&&(p(w,1),y=!0);const C=n.xr.getEnvironmentBlendMode();C==="additive"?r.buffers.color.setClear(0,0,0,1,s):C==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,s),(n.autoClear||y)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function v(x,y){const w=g(y);w&&(w.isCubeTexture||w.mapping===ME)?(u===void 0&&(u=new Ve(new Xn(1,1,1),new No({name:"BackgroundCubeMaterial",uniforms:rm(ha.backgroundCube.uniforms),vertexShader:ha.backgroundCube.vertexShader,fragmentShader:ha.backgroundCube.fragmentShader,side:Ki,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(C,T,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),Nu.copy(y.backgroundRotation),Nu.x*=-1,Nu.y*=-1,Nu.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(Nu.y*=-1,Nu.z*=-1),u.material.uniforms.envMap.value=w,u.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(oX.makeRotationFromEuler(Nu)),u.material.toneMapped=sn.getTransfer(w.colorSpace)!==Mn,(h!==w||f!==w.version||m!==n.toneMapping)&&(u.material.needsUpdate=!0,h=w,f=w.version,m=n.toneMapping),u.layers.enableAll(),x.unshift(u,u.geometry,u.material,0,0,null)):w&&w.isTexture&&(c===void 0&&(c=new Ve(new Om(2,2),new No({name:"BackgroundMaterial",uniforms:rm(ha.background.uniforms),vertexShader:ha.background.vertexShader,fragmentShader:ha.background.fragmentShader,side:bl,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(c)),c.material.uniforms.t2D.value=w,c.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,c.material.toneMapped=sn.getTransfer(w.colorSpace)!==Mn,w.matrixAutoUpdate===!0&&w.updateMatrix(),c.material.uniforms.uvTransform.value.copy(w.matrix),(h!==w||f!==w.version||m!==n.toneMapping)&&(c.material.needsUpdate=!0,h=w,f=w.version,m=n.toneMapping),c.layers.enableAll(),x.unshift(c,c.geometry,c.material,0,0,null))}function p(x,y){x.getRGB(W_,XF(n)),r.buffers.color.setClear(W_.r,W_.g,W_.b,y,s)}return{getClearColor:function(){return a},setClearColor:function(x,y=1){a.set(x),l=y,p(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(x){l=x,p(a,l)},render:_,addToRenderList:v}}function aX(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},i=f(null);let o=i,s=!1;function a(E,A,F,D,M){let k=!1;const z=h(D,F,A);o!==z&&(o=z,c(o.object)),k=m(E,D,F,M),k&&g(E,D,F,M),M!==null&&e.update(M,n.ELEMENT_ARRAY_BUFFER),(k||s)&&(s=!1,w(E,A,F,D),M!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(M).buffer))}function l(){return n.createVertexArray()}function c(E){return n.bindVertexArray(E)}function u(E){return n.deleteVertexArray(E)}function h(E,A,F){const D=F.wireframe===!0;let M=r[E.id];M===void 0&&(M={},r[E.id]=M);let k=M[A.id];k===void 0&&(k={},M[A.id]=k);let z=k[D];return z===void 0&&(z=f(l()),k[D]=z),z}function f(E){const A=[],F=[],D=[];for(let M=0;M<t;M++)A[M]=0,F[M]=0,D[M]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:A,enabledAttributes:F,attributeDivisors:D,object:E,attributes:{},index:null}}function m(E,A,F,D){const M=o.attributes,k=A.attributes;let z=0;const P=F.getAttributes();for(const U in P)if(P[U].location>=0){const Z=M[U];let j=k[U];if(j===void 0&&(U==="instanceMatrix"&&E.instanceMatrix&&(j=E.instanceMatrix),U==="instanceColor"&&E.instanceColor&&(j=E.instanceColor)),Z===void 0||Z.attribute!==j||j&&Z.data!==j.data)return!0;z++}return o.attributesNum!==z||o.index!==D}function g(E,A,F,D){const M={},k=A.attributes;let z=0;const P=F.getAttributes();for(const U in P)if(P[U].location>=0){let Z=k[U];Z===void 0&&(U==="instanceMatrix"&&E.instanceMatrix&&(Z=E.instanceMatrix),U==="instanceColor"&&E.instanceColor&&(Z=E.instanceColor));const j={};j.attribute=Z,Z&&Z.data&&(j.data=Z.data),M[U]=j,z++}o.attributes=M,o.attributesNum=z,o.index=D}function _(){const E=o.newAttributes;for(let A=0,F=E.length;A<F;A++)E[A]=0}function v(E){p(E,0)}function p(E,A){const F=o.newAttributes,D=o.enabledAttributes,M=o.attributeDivisors;F[E]=1,D[E]===0&&(n.enableVertexAttribArray(E),D[E]=1),M[E]!==A&&(n.vertexAttribDivisor(E,A),M[E]=A)}function x(){const E=o.newAttributes,A=o.enabledAttributes;for(let F=0,D=A.length;F<D;F++)A[F]!==E[F]&&(n.disableVertexAttribArray(F),A[F]=0)}function y(E,A,F,D,M,k,z){z===!0?n.vertexAttribIPointer(E,A,F,M,k):n.vertexAttribPointer(E,A,F,D,M,k)}function w(E,A,F,D){_();const M=D.attributes,k=F.getAttributes(),z=A.defaultAttributeValues;for(const P in k){const U=k[P];if(U.location>=0){let Y=M[P];if(Y===void 0&&(P==="instanceMatrix"&&E.instanceMatrix&&(Y=E.instanceMatrix),P==="instanceColor"&&E.instanceColor&&(Y=E.instanceColor)),Y!==void 0){const Z=Y.normalized,j=Y.itemSize,X=e.get(Y);if(X===void 0)continue;const B=X.buffer,K=X.type,ee=X.bytesPerElement,fe=K===n.INT||K===n.UNSIGNED_INT||Y.gpuType===WN;if(Y.isInterleavedBufferAttribute){const ce=Y.data,we=ce.stride,Ie=Y.offset;if(ce.isInstancedInterleavedBuffer){for(let ft=0;ft<U.locationSize;ft++)p(U.location+ft,ce.meshPerAttribute);E.isInstancedMesh!==!0&&D._maxInstanceCount===void 0&&(D._maxInstanceCount=ce.meshPerAttribute*ce.count)}else for(let ft=0;ft<U.locationSize;ft++)v(U.location+ft);n.bindBuffer(n.ARRAY_BUFFER,B);for(let ft=0;ft<U.locationSize;ft++)y(U.location+ft,j/U.locationSize,K,Z,we*ee,(Ie+j/U.locationSize*ft)*ee,fe)}else{if(Y.isInstancedBufferAttribute){for(let ce=0;ce<U.locationSize;ce++)p(U.location+ce,Y.meshPerAttribute);E.isInstancedMesh!==!0&&D._maxInstanceCount===void 0&&(D._maxInstanceCount=Y.meshPerAttribute*Y.count)}else for(let ce=0;ce<U.locationSize;ce++)v(U.location+ce);n.bindBuffer(n.ARRAY_BUFFER,B);for(let ce=0;ce<U.locationSize;ce++)y(U.location+ce,j/U.locationSize,K,Z,j*ee,j/U.locationSize*ce*ee,fe)}}else if(z!==void 0){const Z=z[P];if(Z!==void 0)switch(Z.length){case 2:n.vertexAttrib2fv(U.location,Z);break;case 3:n.vertexAttrib3fv(U.location,Z);break;case 4:n.vertexAttrib4fv(U.location,Z);break;default:n.vertexAttrib1fv(U.location,Z)}}}}x()}function C(){b();for(const E in r){const A=r[E];for(const F in A){const D=A[F];for(const M in D)u(D[M].object),delete D[M];delete A[F]}delete r[E]}}function T(E){if(r[E.id]===void 0)return;const A=r[E.id];for(const F in A){const D=A[F];for(const M in D)u(D[M].object),delete D[M];delete A[F]}delete r[E.id]}function S(E){for(const A in r){const F=r[A];if(F[E.id]===void 0)continue;const D=F[E.id];for(const M in D)u(D[M].object),delete D[M];delete F[E.id]}}function b(){R(),s=!0,o!==i&&(o=i,c(o.object))}function R(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:b,resetDefaultState:R,dispose:C,releaseStatesOfGeometry:T,releaseStatesOfProgram:S,initAttributes:_,enableAttribute:v,disableUnusedAttributes:x}}function lX(n,e,t){let r;function i(c){r=c}function o(c,u){n.drawArrays(r,c,u),t.update(u,r,1)}function s(c,u,h){h!==0&&(n.drawArraysInstanced(r,c,u,h),t.update(u,r,h))}function a(c,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,c,0,u,0,h);let m=0;for(let g=0;g<h;g++)m+=u[g];t.update(m,r,1)}function l(c,u,h,f){if(h===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let g=0;g<c.length;g++)s(c[g],u[g],f[g]);else{m.multiDrawArraysInstancedWEBGL(r,c,0,u,0,f,0,h);let g=0;for(let _=0;_<h;_++)g+=u[_];for(let _=0;_<f.length;_++)t.update(g,r,f[_])}}this.setMode=i,this.render=o,this.renderInstances=s,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function cX(n,e,t,r){let i;function o(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const S=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(S.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(S){return!(S!==Jo&&r.convert(S)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(S){const b=S===Ml&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(S!==Al&&r.convert(S)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&S!==il&&!b)}function l(S){if(S==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";S="mediump"}return S==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const h=t.logarithmicDepthBuffer===!0,f=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control");if(f===!0){const S=e.get("EXT_clip_control");S.clipControlEXT(S.LOWER_LEFT_EXT,S.ZERO_TO_ONE_EXT)}const m=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),g=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_TEXTURE_SIZE),v=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),p=n.getParameter(n.MAX_VERTEX_ATTRIBS),x=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),y=n.getParameter(n.MAX_VARYING_VECTORS),w=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),C=g>0,T=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:l,textureFormatReadable:s,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:h,reverseDepthBuffer:f,maxTextures:m,maxVertexTextures:g,maxTextureSize:_,maxCubemapSize:v,maxAttributes:p,maxVertexUniforms:x,maxVaryings:y,maxFragmentUniforms:w,vertexTextures:C,maxSamples:T}}function uX(n){const e=this;let t=null,r=0,i=!1,o=!1;const s=new da,a=new Nt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const m=h.length!==0||f||r!==0||i;return i=f,r=h.length,m},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(h,f){t=u(h,f,0)},this.setState=function(h,f,m){const g=h.clippingPlanes,_=h.clipIntersection,v=h.clipShadows,p=n.get(h);if(!i||g===null||g.length===0||o&&!v)o?u(null):c();else{const x=o?0:r,y=x*4;let w=p.clippingState||null;l.value=w,w=u(g,f,y,m);for(let C=0;C!==y;++C)w[C]=t[C];p.clippingState=w,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=x}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,f,m,g){const _=h!==null?h.length:0;let v=null;if(_!==0){if(v=l.value,g!==!0||v===null){const p=m+_*4,x=f.matrixWorldInverse;a.getNormalMatrix(x),(v===null||v.length<p)&&(v=new Float32Array(p));for(let y=0,w=m;y!==_;++y,w+=4)s.copy(h[y]).applyMatrix4(x,a),s.normal.toArray(v,w),v[w+3]=s.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,v}}function dX(n){let e=new WeakMap;function t(s,a){return a===tA?s.mapping=Jp:a===nA&&(s.mapping=em),s}function r(s){if(s&&s.isTexture){const a=s.mapping;if(a===tA||a===nA)if(e.has(s)){const l=e.get(s).texture;return t(l,s.mapping)}else{const l=s.image;if(l&&l.height>0){const c=new S$(l.height);return c.fromEquirectangularTexture(n,s),e.set(s,c),s.addEventListener("dispose",i),t(c.texture,s.mapping)}else return null}}return s}function i(s){const a=s.target;a.removeEventListener("dispose",i);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function o(){e=new WeakMap}return{get:r,dispose:o}}class rI extends qF{constructor(e=-1,t=1,r=1,i=-1,o=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=o,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,o,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=r-e,s=r+e,a=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=c*this.view.offsetX,s=o+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(o,s,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Wf=4,QL=[.125,.215,.35,.446,.526,.582],rd=20,bT=new rI,ZL=new rt;let AT=null,MT=0,RT=0,NT=!1;const Wu=(1+Math.sqrt(5))/2,$h=1/Wu,JL=[new N(-Wu,$h,0),new N(Wu,$h,0),new N(-$h,0,Wu),new N($h,0,Wu),new N(0,Wu,-$h),new N(0,Wu,$h),new N(-1,1,-1),new N(1,1,-1),new N(-1,1,1),new N(1,1,1)];class eO{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){AT=this._renderer.getRenderTarget(),MT=this._renderer.getActiveCubeFace(),RT=this._renderer.getActiveMipmapLevel(),NT=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,r,i,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=rO(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=nO(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(AT,MT,RT),this._renderer.xr.enabled=NT,e.scissorTest=!1,$_(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Jp||e.mapping===em?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),AT=this._renderer.getRenderTarget(),MT=this._renderer.getActiveCubeFace(),RT=this._renderer.getActiveMipmapLevel(),NT=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:qo,minFilter:qo,generateMipmaps:!1,type:Ml,format:Jo,colorSpace:Hl,depthBuffer:!1},i=tO(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=tO(e,t,r);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=hX(o)),this._blurMaterial=fX(o,e,t)}return i}_compileMaterial(e){const t=new Ve(this._lodPlanes[0],e);this._renderer.compile(t,bT)}_sceneToCubeUV(e,t,r,i){const a=new Vi(90,1,t,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,f=u.toneMapping;u.getClearColor(ZL),u.toneMapping=zc,u.autoClear=!1;const m=new vu({name:"PMREM.Background",side:Ki,depthWrite:!1,depthTest:!1}),g=new Ve(new Xn,m);let _=!1;const v=e.background;v?v.isColor&&(m.color.copy(v),e.background=null,_=!0):(m.color.copy(ZL),_=!0);for(let p=0;p<6;p++){const x=p%3;x===0?(a.up.set(0,l[p],0),a.lookAt(c[p],0,0)):x===1?(a.up.set(0,0,l[p]),a.lookAt(0,c[p],0)):(a.up.set(0,l[p],0),a.lookAt(0,0,c[p]));const y=this._cubeSize;$_(i,x*y,p>2?y:0,y,y),u.setRenderTarget(i),_&&u.render(g,a),u.render(e,a)}g.geometry.dispose(),g.material.dispose(),u.toneMapping=f,u.autoClear=h,e.background=v}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===Jp||e.mapping===em;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=rO()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=nO());const o=i?this._cubemapMaterial:this._equirectMaterial,s=new Ve(this._lodPlanes[0],o),a=o.uniforms;a.envMap.value=e;const l=this._cubeSize;$_(t,0,0,3*l,2*l),r.setRenderTarget(t),r.render(s,bT)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let o=1;o<i;o++){const s=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),a=JL[(i-o-1)%JL.length];this._blur(e,o-1,o,s,a)}t.autoClear=r}_blur(e,t,r,i,o){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,r,i,"latitudinal",o),this._halfBlur(s,e,r,r,i,"longitudinal",o)}_halfBlur(e,t,r,i,o,s,a){const l=this._renderer,c=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new Ve(this._lodPlanes[i],c),f=c.uniforms,m=this._sizeLods[r]-1,g=isFinite(o)?Math.PI/(2*m):2*Math.PI/(2*rd-1),_=o/g,v=isFinite(o)?1+Math.floor(u*_):rd;v>rd&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${rd}`);const p=[];let x=0;for(let S=0;S<rd;++S){const b=S/_,R=Math.exp(-b*b/2);p.push(R),S===0?x+=R:S<v&&(x+=2*R)}for(let S=0;S<p.length;S++)p[S]=p[S]/x;f.envMap.value=e.texture,f.samples.value=v,f.weights.value=p,f.latitudinal.value=s==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:y}=this;f.dTheta.value=g,f.mipInt.value=y-r;const w=this._sizeLods[i],C=3*w*(i>y-Wf?i-y+Wf:0),T=4*(this._cubeSize-w);$_(t,C,T,3*w,2*w),l.setRenderTarget(t),l.render(h,bT)}}function hX(n){const e=[],t=[],r=[];let i=n;const o=n-Wf+1+QL.length;for(let s=0;s<o;s++){const a=Math.pow(2,i);t.push(a);let l=1/a;s>n-Wf?l=QL[s-n+Wf-1]:s===0&&(l=0),r.push(l);const c=1/(a-2),u=-c,h=1+c,f=[u,u,h,u,h,h,u,u,h,h,u,h],m=6,g=6,_=3,v=2,p=1,x=new Float32Array(_*g*m),y=new Float32Array(v*g*m),w=new Float32Array(p*g*m);for(let T=0;T<m;T++){const S=T%3*2/3-1,b=T>2?0:-1,R=[S,b,0,S+2/3,b,0,S+2/3,b+1,0,S,b,0,S+2/3,b+1,0,S,b+1,0];x.set(R,_*g*T),y.set(f,v*g*T);const E=[T,T,T,T,T,T];w.set(E,p*g*T)}const C=new Sn;C.setAttribute("position",new $n(x,_)),C.setAttribute("uv",new $n(y,v)),C.setAttribute("faceIndex",new $n(w,p)),e.push(C),i>Wf&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function tO(n,e,t){const r=new is(n,e,t);return r.texture.mapping=ME,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function $_(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function fX(n,e,t){const r=new Float32Array(rd),i=new N(0,1,0);return new No({name:"SphericalGaussianBlur",defines:{n:rd,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:iI(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:pl,depthTest:!1,depthWrite:!1})}function nO(){return new No({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:iI(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:pl,depthTest:!1,depthWrite:!1})}function rO(){return new No({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:iI(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:pl,depthTest:!1,depthWrite:!1})}function iI(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function pX(n){let e=new WeakMap,t=null;function r(a){if(a&&a.isTexture){const l=a.mapping,c=l===tA||l===nA,u=l===Jp||l===em;if(c||u){let h=e.get(a);const f=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==f)return t===null&&(t=new eO(n)),h=c?t.fromEquirectangular(a,h):t.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),h.texture;if(h!==void 0)return h.texture;{const m=a.image;return c&&m&&m.height>0||u&&m&&i(m)?(t===null&&(t=new eO(n)),h=c?t.fromEquirectangular(a):t.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),a.addEventListener("dispose",o),h.texture):null}}}return a}function i(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function o(a){const l=a.target;l.removeEventListener("dispose",o);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function s(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:s}}function mX(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const i=t(r);return i===null&&Sy("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function gX(n,e,t,r){const i={},o=new WeakMap;function s(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const g in f.attributes)e.remove(f.attributes[g]);for(const g in f.morphAttributes){const _=f.morphAttributes[g];for(let v=0,p=_.length;v<p;v++)e.remove(_[v])}f.removeEventListener("dispose",s),delete i[f.id];const m=o.get(f);m&&(e.remove(m),o.delete(f)),r.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(h,f){return i[f.id]===!0||(f.addEventListener("dispose",s),i[f.id]=!0,t.memory.geometries++),f}function l(h){const f=h.attributes;for(const g in f)e.update(f[g],n.ARRAY_BUFFER);const m=h.morphAttributes;for(const g in m){const _=m[g];for(let v=0,p=_.length;v<p;v++)e.update(_[v],n.ARRAY_BUFFER)}}function c(h){const f=[],m=h.index,g=h.attributes.position;let _=0;if(m!==null){const x=m.array;_=m.version;for(let y=0,w=x.length;y<w;y+=3){const C=x[y+0],T=x[y+1],S=x[y+2];f.push(C,T,T,S,S,C)}}else if(g!==void 0){const x=g.array;_=g.version;for(let y=0,w=x.length/3-1;y<w;y+=3){const C=y+0,T=y+1,S=y+2;f.push(C,T,T,S,S,C)}}else return;const v=new(GF(f)?KF:YF)(f,1);v.version=_;const p=o.get(h);p&&e.remove(p),o.set(h,v)}function u(h){const f=o.get(h);if(f){const m=h.index;m!==null&&f.version<m.version&&c(h)}else c(h);return o.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function vX(n,e,t){let r;function i(f){r=f}let o,s;function a(f){o=f.type,s=f.bytesPerElement}function l(f,m){n.drawElements(r,m,o,f*s),t.update(m,r,1)}function c(f,m,g){g!==0&&(n.drawElementsInstanced(r,m,o,f*s,g),t.update(m,r,g))}function u(f,m,g){if(g===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,m,0,o,f,0,g);let v=0;for(let p=0;p<g;p++)v+=m[p];t.update(v,r,1)}function h(f,m,g,_){if(g===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let p=0;p<f.length;p++)c(f[p]/s,m[p],_[p]);else{v.multiDrawElementsInstancedWEBGL(r,m,0,o,f,0,_,0,g);let p=0;for(let x=0;x<g;x++)p+=m[x];for(let x=0;x<_.length;x++)t.update(p,r,_[x])}}this.setMode=i,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function _X(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(o,s,a){switch(t.calls++,s){case n.TRIANGLES:t.triangles+=a*(o/3);break;case n.LINES:t.lines+=a*(o/2);break;case n.LINE_STRIP:t.lines+=a*(o-1);break;case n.LINE_LOOP:t.lines+=a*o;break;case n.POINTS:t.points+=a*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function xX(n,e,t){const r=new WeakMap,i=new gn;function o(s,a,l){const c=s.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=u!==void 0?u.length:0;let f=r.get(a);if(f===void 0||f.count!==h){let R=function(){S.dispose(),r.delete(a),a.removeEventListener("dispose",R)};f!==void 0&&f.texture.dispose();const m=a.morphAttributes.position!==void 0,g=a.morphAttributes.normal!==void 0,_=a.morphAttributes.color!==void 0,v=a.morphAttributes.position||[],p=a.morphAttributes.normal||[],x=a.morphAttributes.color||[];let y=0;m===!0&&(y=1),g===!0&&(y=2),_===!0&&(y=3);let w=a.attributes.position.count*y,C=1;w>e.maxTextureSize&&(C=Math.ceil(w/e.maxTextureSize),w=e.maxTextureSize);const T=new Float32Array(w*C*4*h),S=new WF(T,w,C,h);S.type=il,S.needsUpdate=!0;const b=y*4;for(let E=0;E<h;E++){const A=v[E],F=p[E],D=x[E],M=w*C*4*E;for(let k=0;k<A.count;k++){const z=k*b;m===!0&&(i.fromBufferAttribute(A,k),T[M+z+0]=i.x,T[M+z+1]=i.y,T[M+z+2]=i.z,T[M+z+3]=0),g===!0&&(i.fromBufferAttribute(F,k),T[M+z+4]=i.x,T[M+z+5]=i.y,T[M+z+6]=i.z,T[M+z+7]=0),_===!0&&(i.fromBufferAttribute(D,k),T[M+z+8]=i.x,T[M+z+9]=i.y,T[M+z+10]=i.z,T[M+z+11]=D.itemSize===4?i.w:1)}}f={count:h,texture:S,size:new Ut(w,C)},r.set(a,f),a.addEventListener("dispose",R)}if(s.isInstancedMesh===!0&&s.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",s.morphTexture,t);else{let m=0;for(let _=0;_<c.length;_++)m+=c[_];const g=a.morphTargetsRelative?1:1-m;l.getUniforms().setValue(n,"morphTargetBaseInfluence",g),l.getUniforms().setValue(n,"morphTargetInfluences",c)}l.getUniforms().setValue(n,"morphTargetsTexture",f.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",f.size)}return{update:o}}function yX(n,e,t,r){let i=new WeakMap;function o(l){const c=r.render.frame,u=l.geometry,h=e.get(l,u);if(i.get(h)!==c&&(e.update(h),i.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),i.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),i.set(l,c))),l.isSkinnedMesh){const f=l.skeleton;i.get(f)!==c&&(f.update(),i.set(f,c))}return h}function s(){i=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:o,dispose:s}}class JF extends ds{constructor(e,t,r,i,o,s,a,l,c,u=yp){if(u!==yp&&u!==nm)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===yp&&(r=Yd),r===void 0&&u===nm&&(r=tm),super(null,i,o,s,a,l,u,r,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:So,this.minFilter=l!==void 0?l:So,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const ej=new ds,iO=new JF(1,1),tj=new WF,nj=new a$,rj=new QF,oO=[],sO=[],aO=new Float32Array(16),lO=new Float32Array(9),cO=new Float32Array(4);function Dm(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let o=oO[i];if(o===void 0&&(o=new Float32Array(i),oO[i]=o),e!==0){r.toArray(o,0);for(let s=1,a=0;s!==e;++s)a+=t,n[s].toArray(o,a)}return o}function kr(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function Lr(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function IE(n,e){let t=sO[e];t===void 0&&(t=new Int32Array(e),sO[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function wX(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function SX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kr(t,e))return;n.uniform2fv(this.addr,e),Lr(t,e)}}function EX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(kr(t,e))return;n.uniform3fv(this.addr,e),Lr(t,e)}}function TX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kr(t,e))return;n.uniform4fv(this.addr,e),Lr(t,e)}}function CX(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(kr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Lr(t,e)}else{if(kr(t,r))return;cO.set(r),n.uniformMatrix2fv(this.addr,!1,cO),Lr(t,r)}}function bX(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(kr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Lr(t,e)}else{if(kr(t,r))return;lO.set(r),n.uniformMatrix3fv(this.addr,!1,lO),Lr(t,r)}}function AX(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(kr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Lr(t,e)}else{if(kr(t,r))return;aO.set(r),n.uniformMatrix4fv(this.addr,!1,aO),Lr(t,r)}}function MX(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function RX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kr(t,e))return;n.uniform2iv(this.addr,e),Lr(t,e)}}function NX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(kr(t,e))return;n.uniform3iv(this.addr,e),Lr(t,e)}}function IX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kr(t,e))return;n.uniform4iv(this.addr,e),Lr(t,e)}}function PX(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function kX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kr(t,e))return;n.uniform2uiv(this.addr,e),Lr(t,e)}}function LX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(kr(t,e))return;n.uniform3uiv(this.addr,e),Lr(t,e)}}function OX(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kr(t,e))return;n.uniform4uiv(this.addr,e),Lr(t,e)}}function DX(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);let o;this.type===n.SAMPLER_2D_SHADOW?(iO.compareFunction=VF,o=iO):o=ej,t.setTexture2D(e||o,i)}function UX(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||nj,i)}function FX(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||rj,i)}function jX(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||tj,i)}function BX(n){switch(n){case 5126:return wX;case 35664:return SX;case 35665:return EX;case 35666:return TX;case 35674:return CX;case 35675:return bX;case 35676:return AX;case 5124:case 35670:return MX;case 35667:case 35671:return RX;case 35668:case 35672:return NX;case 35669:case 35673:return IX;case 5125:return PX;case 36294:return kX;case 36295:return LX;case 36296:return OX;case 35678:case 36198:case 36298:case 36306:case 35682:return DX;case 35679:case 36299:case 36307:return UX;case 35680:case 36300:case 36308:case 36293:return FX;case 36289:case 36303:case 36311:case 36292:return jX}}function zX(n,e){n.uniform1fv(this.addr,e)}function HX(n,e){const t=Dm(e,this.size,2);n.uniform2fv(this.addr,t)}function VX(n,e){const t=Dm(e,this.size,3);n.uniform3fv(this.addr,t)}function GX(n,e){const t=Dm(e,this.size,4);n.uniform4fv(this.addr,t)}function WX(n,e){const t=Dm(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function $X(n,e){const t=Dm(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function YX(n,e){const t=Dm(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function KX(n,e){n.uniform1iv(this.addr,e)}function XX(n,e){n.uniform2iv(this.addr,e)}function qX(n,e){n.uniform3iv(this.addr,e)}function QX(n,e){n.uniform4iv(this.addr,e)}function ZX(n,e){n.uniform1uiv(this.addr,e)}function JX(n,e){n.uniform2uiv(this.addr,e)}function eq(n,e){n.uniform3uiv(this.addr,e)}function tq(n,e){n.uniform4uiv(this.addr,e)}function nq(n,e,t){const r=this.cache,i=e.length,o=IE(t,i);kr(r,o)||(n.uniform1iv(this.addr,o),Lr(r,o));for(let s=0;s!==i;++s)t.setTexture2D(e[s]||ej,o[s])}function rq(n,e,t){const r=this.cache,i=e.length,o=IE(t,i);kr(r,o)||(n.uniform1iv(this.addr,o),Lr(r,o));for(let s=0;s!==i;++s)t.setTexture3D(e[s]||nj,o[s])}function iq(n,e,t){const r=this.cache,i=e.length,o=IE(t,i);kr(r,o)||(n.uniform1iv(this.addr,o),Lr(r,o));for(let s=0;s!==i;++s)t.setTextureCube(e[s]||rj,o[s])}function oq(n,e,t){const r=this.cache,i=e.length,o=IE(t,i);kr(r,o)||(n.uniform1iv(this.addr,o),Lr(r,o));for(let s=0;s!==i;++s)t.setTexture2DArray(e[s]||tj,o[s])}function sq(n){switch(n){case 5126:return zX;case 35664:return HX;case 35665:return VX;case 35666:return GX;case 35674:return WX;case 35675:return $X;case 35676:return YX;case 5124:case 35670:return KX;case 35667:case 35671:return XX;case 35668:case 35672:return qX;case 35669:case 35673:return QX;case 5125:return ZX;case 36294:return JX;case 36295:return eq;case 36296:return tq;case 35678:case 36198:case 36298:case 36306:case 35682:return nq;case 35679:case 36299:case 36307:return rq;case 35680:case 36300:case 36308:case 36293:return iq;case 36289:case 36303:case 36311:case 36292:return oq}}class aq{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=BX(t.type)}}class lq{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=sq(t.type)}}class cq{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let o=0,s=i.length;o!==s;++o){const a=i[o];a.setValue(e,t[a.id],r)}}}const IT=/(\w+)(\])?(\[|\.)?/g;function uO(n,e){n.seq.push(e),n.map[e.id]=e}function uq(n,e,t){const r=n.name,i=r.length;for(IT.lastIndex=0;;){const o=IT.exec(r),s=IT.lastIndex;let a=o[1];const l=o[2]==="]",c=o[3];if(l&&(a=a|0),c===void 0||c==="["&&s+2===i){uO(t,c===void 0?new aq(a,n,e):new lq(a,n,e));break}else{let h=t.map[a];h===void 0&&(h=new cq(a),uO(t,h)),t=h}}}class Ty{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const o=e.getActiveUniform(t,i),s=e.getUniformLocation(t,o.name);uq(o,s,this)}}setValue(e,t,r,i){const o=this.map[t];o!==void 0&&o.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let o=0,s=t.length;o!==s;++o){const a=t[o],l=r[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,o=e.length;i!==o;++i){const s=e[i];s.id in t&&r.push(s)}return r}}function dO(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const dq=37297;let hq=0;function fq(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let s=i;s<o;s++){const a=s+1;r.push(`${a===e?">":" "} ${a}: ${t[s]}`)}return r.join(`
`)}function pq(n){const e=sn.getPrimaries(sn.workingColorSpace),t=sn.getPrimaries(n);let r;switch(e===t?r="":e===mw&&t===pw?r="LinearDisplayP3ToLinearSRGB":e===pw&&t===mw&&(r="LinearSRGBToLinearDisplayP3"),n){case Hl:case RE:return[r,"LinearTransferOETF"];case $o:case QN:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[r,"LinearTransferOETF"]}}function hO(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&i==="")return"";const o=/ERROR: 0:(\d+)/.exec(i);if(o){const s=parseInt(o[1]);return t.toUpperCase()+`

`+i+`

`+fq(n.getShaderSource(e),s)}else return i}function mq(n,e){const t=pq(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function gq(n,e){let t;switch(e){case TF:t="Linear";break;case CF:t="Reinhard";break;case bF:t="Cineon";break;case AF:t="ACESFilmic";break;case MF:t="AgX";break;case RF:t="Neutral";break;case EW:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Y_=new N;function vq(){sn.getLuminanceCoefficients(Y_);const n=Y_.x.toFixed(4),e=Y_.y.toFixed(4),t=Y_.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function _q(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(t0).join(`
`)}function xq(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function yq(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const o=n.getActiveAttrib(e,i),s=o.name;let a=1;o.type===n.FLOAT_MAT2&&(a=2),o.type===n.FLOAT_MAT3&&(a=3),o.type===n.FLOAT_MAT4&&(a=4),t[s]={type:o.type,location:n.getAttribLocation(e,s),locationSize:a}}return t}function t0(n){return n!==""}function fO(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function pO(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const wq=/^[ \t]*#include +<([\w\d./]+)>/gm;function RA(n){return n.replace(wq,Eq)}const Sq=new Map;function Eq(n,e){let t=Ot[e];if(t===void 0){const r=Sq.get(e);if(r!==void 0)t=Ot[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return RA(t)}const Tq=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function mO(n){return n.replace(Tq,Cq)}function Cq(n,e,t,r){let i="";for(let o=parseInt(e);o<parseInt(t);o++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function gO(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function bq(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===SF?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===nW?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Xa&&(e="SHADOWMAP_TYPE_VSM"),e}function Aq(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Jp:case em:e="ENVMAP_TYPE_CUBE";break;case ME:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Mq(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case em:e="ENVMAP_MODE_REFRACTION";break}return e}function Rq(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case EF:e="ENVMAP_BLENDING_MULTIPLY";break;case wW:e="ENVMAP_BLENDING_MIX";break;case SW:e="ENVMAP_BLENDING_ADD";break}return e}function Nq(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:r,maxMip:t}}function Iq(n,e,t,r){const i=n.getContext(),o=t.defines;let s=t.vertexShader,a=t.fragmentShader;const l=bq(t),c=Aq(t),u=Mq(t),h=Rq(t),f=Nq(t),m=_q(t),g=xq(o),_=i.createProgram();let v,p,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(t0).join(`
`),v.length>0&&(v+=`
`),p=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(t0).join(`
`),p.length>0&&(p+=`
`)):(v=[gO(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(t0).join(`
`),p=[gO(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==zc?"#define TONE_MAPPING":"",t.toneMapping!==zc?Ot.tonemapping_pars_fragment:"",t.toneMapping!==zc?gq("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ot.colorspace_pars_fragment,mq("linearToOutputTexel",t.outputColorSpace),vq(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(t0).join(`
`)),s=RA(s),s=fO(s,t),s=pO(s,t),a=RA(a),a=fO(a,t),a=pO(a,t),s=mO(s),a=mO(a),t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,v=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,p=["#define varying in",t.glslVersion===PL?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===PL?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+p);const y=x+v+s,w=x+p+a,C=dO(i,i.VERTEX_SHADER,y),T=dO(i,i.FRAGMENT_SHADER,w);i.attachShader(_,C),i.attachShader(_,T),t.index0AttributeName!==void 0?i.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(_,0,"position"),i.linkProgram(_);function S(A){if(n.debug.checkShaderErrors){const F=i.getProgramInfoLog(_).trim(),D=i.getShaderInfoLog(C).trim(),M=i.getShaderInfoLog(T).trim();let k=!0,z=!0;if(i.getProgramParameter(_,i.LINK_STATUS)===!1)if(k=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,_,C,T);else{const P=hO(i,C,"vertex"),U=hO(i,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(_,i.VALIDATE_STATUS)+`

Material Name: `+A.name+`
Material Type: `+A.type+`

Program Info Log: `+F+`
`+P+`
`+U)}else F!==""?console.warn("THREE.WebGLProgram: Program Info Log:",F):(D===""||M==="")&&(z=!1);z&&(A.diagnostics={runnable:k,programLog:F,vertexShader:{log:D,prefix:v},fragmentShader:{log:M,prefix:p}})}i.deleteShader(C),i.deleteShader(T),b=new Ty(i,_),R=yq(i,_)}let b;this.getUniforms=function(){return b===void 0&&S(this),b};let R;this.getAttributes=function(){return R===void 0&&S(this),R};let E=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return E===!1&&(E=i.getProgramParameter(_,dq)),E},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=hq++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=C,this.fragmentShader=T,this}let Pq=0;class kq{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),o=this._getShaderStage(r),s=this._getShaderCacheForMaterial(e);return s.has(i)===!1&&(s.add(i),i.usedTimes++),s.has(o)===!1&&(s.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new Lq(e),t.set(e,r)),r}}class Lq{constructor(e){this.id=Pq++,this.code=e,this.usedTimes=0}}function Oq(n,e,t,r,i,o,s){const a=new tI,l=new kq,c=new Set,u=[],h=i.logarithmicDepthBuffer,f=i.reverseDepthBuffer,m=i.vertexTextures;let g=i.precision;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(E){return c.add(E),E===0?"uv":`uv${E}`}function p(E,A,F,D,M){const k=D.fog,z=M.geometry,P=E.isMeshStandardMaterial?D.environment:null,U=(E.isMeshStandardMaterial?t:e).get(E.envMap||P),Y=U&&U.mapping===ME?U.image.height:null,Z=_[E.type];E.precision!==null&&(g=i.getMaxPrecision(E.precision),g!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",g,"instead."));const j=z.morphAttributes.position||z.morphAttributes.normal||z.morphAttributes.color,X=j!==void 0?j.length:0;let B=0;z.morphAttributes.position!==void 0&&(B=1),z.morphAttributes.normal!==void 0&&(B=2),z.morphAttributes.color!==void 0&&(B=3);let K,ee,fe,ce;if(Z){const Or=ha[Z];K=Or.vertexShader,ee=Or.fragmentShader}else K=E.vertexShader,ee=E.fragmentShader,l.update(E),fe=l.getVertexShaderID(E),ce=l.getFragmentShaderID(E);const we=n.getRenderTarget(),Ie=M.isInstancedMesh===!0,ft=M.isBatchedMesh===!0,_t=!!E.map,pt=!!E.matcap,$=!!U,ot=!!E.aoMap,se=!!E.lightMap,Ee=!!E.bumpMap,Te=!!E.normalMap,Le=!!E.displacementMap,be=!!E.emissiveMap,G=!!E.metalnessMap,I=!!E.roughnessMap,V=E.anisotropy>0,q=E.clearcoat>0,ne=E.dispersion>0,Q=E.iridescence>0,he=E.sheen>0,me=E.transmission>0,_e=V&&!!E.anisotropyMap,ze=q&&!!E.clearcoatMap,pe=q&&!!E.clearcoatNormalMap,Ce=q&&!!E.clearcoatRoughnessMap,je=Q&&!!E.iridescenceMap,Qe=Q&&!!E.iridescenceThicknessMap,He=he&&!!E.sheenColorMap,St=he&&!!E.sheenRoughnessMap,st=!!E.specularMap,qt=!!E.specularColorMap,L=!!E.specularIntensityMap,te=me&&!!E.transmissionMap,J=me&&!!E.thicknessMap,ie=!!E.gradientMap,ye=!!E.alphaMap,xe=E.alphaTest>0,$e=!!E.alphaHash,Et=!!E.extensions;let En=zc;E.toneMapped&&(we===null||we.isXRRenderTarget===!0)&&(En=n.toneMapping);const Ge={shaderID:Z,shaderType:E.type,shaderName:E.name,vertexShader:K,fragmentShader:ee,defines:E.defines,customVertexShaderID:fe,customFragmentShaderID:ce,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:g,batching:ft,batchingColor:ft&&M._colorsTexture!==null,instancing:Ie,instancingColor:Ie&&M.instanceColor!==null,instancingMorph:Ie&&M.morphTexture!==null,supportsVertexTextures:m,outputColorSpace:we===null?n.outputColorSpace:we.isXRRenderTarget===!0?we.texture.colorSpace:Hl,alphaToCoverage:!!E.alphaToCoverage,map:_t,matcap:pt,envMap:$,envMapMode:$&&U.mapping,envMapCubeUVHeight:Y,aoMap:ot,lightMap:se,bumpMap:Ee,normalMap:Te,displacementMap:m&&Le,emissiveMap:be,normalMapObjectSpace:Te&&E.normalMapType===MW,normalMapTangentSpace:Te&&E.normalMapType===HF,metalnessMap:G,roughnessMap:I,anisotropy:V,anisotropyMap:_e,clearcoat:q,clearcoatMap:ze,clearcoatNormalMap:pe,clearcoatRoughnessMap:Ce,dispersion:ne,iridescence:Q,iridescenceMap:je,iridescenceThicknessMap:Qe,sheen:he,sheenColorMap:He,sheenRoughnessMap:St,specularMap:st,specularColorMap:qt,specularIntensityMap:L,transmission:me,transmissionMap:te,thicknessMap:J,gradientMap:ie,opaque:E.transparent===!1&&E.blending===xp&&E.alphaToCoverage===!1,alphaMap:ye,alphaTest:xe,alphaHash:$e,combine:E.combine,mapUv:_t&&v(E.map.channel),aoMapUv:ot&&v(E.aoMap.channel),lightMapUv:se&&v(E.lightMap.channel),bumpMapUv:Ee&&v(E.bumpMap.channel),normalMapUv:Te&&v(E.normalMap.channel),displacementMapUv:Le&&v(E.displacementMap.channel),emissiveMapUv:be&&v(E.emissiveMap.channel),metalnessMapUv:G&&v(E.metalnessMap.channel),roughnessMapUv:I&&v(E.roughnessMap.channel),anisotropyMapUv:_e&&v(E.anisotropyMap.channel),clearcoatMapUv:ze&&v(E.clearcoatMap.channel),clearcoatNormalMapUv:pe&&v(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ce&&v(E.clearcoatRoughnessMap.channel),iridescenceMapUv:je&&v(E.iridescenceMap.channel),iridescenceThicknessMapUv:Qe&&v(E.iridescenceThicknessMap.channel),sheenColorMapUv:He&&v(E.sheenColorMap.channel),sheenRoughnessMapUv:St&&v(E.sheenRoughnessMap.channel),specularMapUv:st&&v(E.specularMap.channel),specularColorMapUv:qt&&v(E.specularColorMap.channel),specularIntensityMapUv:L&&v(E.specularIntensityMap.channel),transmissionMapUv:te&&v(E.transmissionMap.channel),thicknessMapUv:J&&v(E.thicknessMap.channel),alphaMapUv:ye&&v(E.alphaMap.channel),vertexTangents:!!z.attributes.tangent&&(Te||V),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!z.attributes.color&&z.attributes.color.itemSize===4,pointsUvs:M.isPoints===!0&&!!z.attributes.uv&&(_t||ye),fog:!!k,useFog:E.fog===!0,fogExp2:!!k&&k.isFogExp2,flatShading:E.flatShading===!0,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:f,skinning:M.isSkinnedMesh===!0,morphTargets:z.morphAttributes.position!==void 0,morphNormals:z.morphAttributes.normal!==void 0,morphColors:z.morphAttributes.color!==void 0,morphTargetsCount:X,morphTextureStride:B,numDirLights:A.directional.length,numPointLights:A.point.length,numSpotLights:A.spot.length,numSpotLightMaps:A.spotLightMap.length,numRectAreaLights:A.rectArea.length,numHemiLights:A.hemi.length,numDirLightShadows:A.directionalShadowMap.length,numPointLightShadows:A.pointShadowMap.length,numSpotLightShadows:A.spotShadowMap.length,numSpotLightShadowsWithMaps:A.numSpotLightShadowsWithMaps,numLightProbes:A.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:E.dithering,shadowMapEnabled:n.shadowMap.enabled&&F.length>0,shadowMapType:n.shadowMap.type,toneMapping:En,decodeVideoTexture:_t&&E.map.isVideoTexture===!0&&sn.getTransfer(E.map.colorSpace)===Mn,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===vi,flipSided:E.side===Ki,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionClipCullDistance:Et&&E.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Et&&E.extensions.multiDraw===!0||ft)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:E.customProgramCacheKey()};return Ge.vertexUv1s=c.has(1),Ge.vertexUv2s=c.has(2),Ge.vertexUv3s=c.has(3),c.clear(),Ge}function x(E){const A=[];if(E.shaderID?A.push(E.shaderID):(A.push(E.customVertexShaderID),A.push(E.customFragmentShaderID)),E.defines!==void 0)for(const F in E.defines)A.push(F),A.push(E.defines[F]);return E.isRawShaderMaterial===!1&&(y(A,E),w(A,E),A.push(n.outputColorSpace)),A.push(E.customProgramCacheKey),A.join()}function y(E,A){E.push(A.precision),E.push(A.outputColorSpace),E.push(A.envMapMode),E.push(A.envMapCubeUVHeight),E.push(A.mapUv),E.push(A.alphaMapUv),E.push(A.lightMapUv),E.push(A.aoMapUv),E.push(A.bumpMapUv),E.push(A.normalMapUv),E.push(A.displacementMapUv),E.push(A.emissiveMapUv),E.push(A.metalnessMapUv),E.push(A.roughnessMapUv),E.push(A.anisotropyMapUv),E.push(A.clearcoatMapUv),E.push(A.clearcoatNormalMapUv),E.push(A.clearcoatRoughnessMapUv),E.push(A.iridescenceMapUv),E.push(A.iridescenceThicknessMapUv),E.push(A.sheenColorMapUv),E.push(A.sheenRoughnessMapUv),E.push(A.specularMapUv),E.push(A.specularColorMapUv),E.push(A.specularIntensityMapUv),E.push(A.transmissionMapUv),E.push(A.thicknessMapUv),E.push(A.combine),E.push(A.fogExp2),E.push(A.sizeAttenuation),E.push(A.morphTargetsCount),E.push(A.morphAttributeCount),E.push(A.numDirLights),E.push(A.numPointLights),E.push(A.numSpotLights),E.push(A.numSpotLightMaps),E.push(A.numHemiLights),E.push(A.numRectAreaLights),E.push(A.numDirLightShadows),E.push(A.numPointLightShadows),E.push(A.numSpotLightShadows),E.push(A.numSpotLightShadowsWithMaps),E.push(A.numLightProbes),E.push(A.shadowMapType),E.push(A.toneMapping),E.push(A.numClippingPlanes),E.push(A.numClipIntersection),E.push(A.depthPacking)}function w(E,A){a.disableAll(),A.supportsVertexTextures&&a.enable(0),A.instancing&&a.enable(1),A.instancingColor&&a.enable(2),A.instancingMorph&&a.enable(3),A.matcap&&a.enable(4),A.envMap&&a.enable(5),A.normalMapObjectSpace&&a.enable(6),A.normalMapTangentSpace&&a.enable(7),A.clearcoat&&a.enable(8),A.iridescence&&a.enable(9),A.alphaTest&&a.enable(10),A.vertexColors&&a.enable(11),A.vertexAlphas&&a.enable(12),A.vertexUv1s&&a.enable(13),A.vertexUv2s&&a.enable(14),A.vertexUv3s&&a.enable(15),A.vertexTangents&&a.enable(16),A.anisotropy&&a.enable(17),A.alphaHash&&a.enable(18),A.batching&&a.enable(19),A.dispersion&&a.enable(20),A.batchingColor&&a.enable(21),E.push(a.mask),a.disableAll(),A.fog&&a.enable(0),A.useFog&&a.enable(1),A.flatShading&&a.enable(2),A.logarithmicDepthBuffer&&a.enable(3),A.reverseDepthBuffer&&a.enable(4),A.skinning&&a.enable(5),A.morphTargets&&a.enable(6),A.morphNormals&&a.enable(7),A.morphColors&&a.enable(8),A.premultipliedAlpha&&a.enable(9),A.shadowMapEnabled&&a.enable(10),A.doubleSided&&a.enable(11),A.flipSided&&a.enable(12),A.useDepthPacking&&a.enable(13),A.dithering&&a.enable(14),A.transmission&&a.enable(15),A.sheen&&a.enable(16),A.opaque&&a.enable(17),A.pointsUvs&&a.enable(18),A.decodeVideoTexture&&a.enable(19),A.alphaToCoverage&&a.enable(20),E.push(a.mask)}function C(E){const A=_[E.type];let F;if(A){const D=ha[A];F=NE.clone(D.uniforms)}else F=E.uniforms;return F}function T(E,A){let F;for(let D=0,M=u.length;D<M;D++){const k=u[D];if(k.cacheKey===A){F=k,++F.usedTimes;break}}return F===void 0&&(F=new Iq(n,A,E,o),u.push(F)),F}function S(E){if(--E.usedTimes===0){const A=u.indexOf(E);u[A]=u[u.length-1],u.pop(),E.destroy()}}function b(E){l.remove(E)}function R(){l.dispose()}return{getParameters:p,getProgramCacheKey:x,getUniforms:C,acquireProgram:T,releaseProgram:S,releaseShaderCache:b,programs:u,dispose:R}}function Dq(){let n=new WeakMap;function e(s){return n.has(s)}function t(s){let a=n.get(s);return a===void 0&&(a={},n.set(s,a)),a}function r(s){n.delete(s)}function i(s,a,l){n.get(s)[a]=l}function o(){n=new WeakMap}return{has:e,get:t,remove:r,update:i,dispose:o}}function Uq(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function vO(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function _O(){const n=[];let e=0;const t=[],r=[],i=[];function o(){e=0,t.length=0,r.length=0,i.length=0}function s(h,f,m,g,_,v){let p=n[e];return p===void 0?(p={id:h.id,object:h,geometry:f,material:m,groupOrder:g,renderOrder:h.renderOrder,z:_,group:v},n[e]=p):(p.id=h.id,p.object=h,p.geometry=f,p.material=m,p.groupOrder=g,p.renderOrder=h.renderOrder,p.z=_,p.group=v),e++,p}function a(h,f,m,g,_,v){const p=s(h,f,m,g,_,v);m.transmission>0?r.push(p):m.transparent===!0?i.push(p):t.push(p)}function l(h,f,m,g,_,v){const p=s(h,f,m,g,_,v);m.transmission>0?r.unshift(p):m.transparent===!0?i.unshift(p):t.unshift(p)}function c(h,f){t.length>1&&t.sort(h||Uq),r.length>1&&r.sort(f||vO),i.length>1&&i.sort(f||vO)}function u(){for(let h=e,f=n.length;h<f;h++){const m=n[h];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:t,transmissive:r,transparent:i,init:o,push:a,unshift:l,finish:u,sort:c}}function Fq(){let n=new WeakMap;function e(r,i){const o=n.get(r);let s;return o===void 0?(s=new _O,n.set(r,[s])):i>=o.length?(s=new _O,o.push(s)):s=o[i],s}function t(){n=new WeakMap}return{get:e,dispose:t}}function jq(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new N,color:new rt};break;case"SpotLight":t={position:new N,direction:new N,color:new rt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new N,color:new rt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new N,skyColor:new rt,groundColor:new rt};break;case"RectAreaLight":t={color:new rt,position:new N,halfWidth:new N,halfHeight:new N};break}return n[e.id]=t,t}}}function Bq(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ut};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ut};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ut,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let zq=0;function Hq(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function Vq(n){const e=new jq,t=Bq(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)r.probe.push(new N);const i=new N,o=new dt,s=new dt;function a(c){let u=0,h=0,f=0;for(let R=0;R<9;R++)r.probe[R].set(0,0,0);let m=0,g=0,_=0,v=0,p=0,x=0,y=0,w=0,C=0,T=0,S=0;c.sort(Hq);for(let R=0,E=c.length;R<E;R++){const A=c[R],F=A.color,D=A.intensity,M=A.distance,k=A.shadow&&A.shadow.map?A.shadow.map.texture:null;if(A.isAmbientLight)u+=F.r*D,h+=F.g*D,f+=F.b*D;else if(A.isLightProbe){for(let z=0;z<9;z++)r.probe[z].addScaledVector(A.sh.coefficients[z],D);S++}else if(A.isDirectionalLight){const z=e.get(A);if(z.color.copy(A.color).multiplyScalar(A.intensity),A.castShadow){const P=A.shadow,U=t.get(A);U.shadowIntensity=P.intensity,U.shadowBias=P.bias,U.shadowNormalBias=P.normalBias,U.shadowRadius=P.radius,U.shadowMapSize=P.mapSize,r.directionalShadow[m]=U,r.directionalShadowMap[m]=k,r.directionalShadowMatrix[m]=A.shadow.matrix,x++}r.directional[m]=z,m++}else if(A.isSpotLight){const z=e.get(A);z.position.setFromMatrixPosition(A.matrixWorld),z.color.copy(F).multiplyScalar(D),z.distance=M,z.coneCos=Math.cos(A.angle),z.penumbraCos=Math.cos(A.angle*(1-A.penumbra)),z.decay=A.decay,r.spot[_]=z;const P=A.shadow;if(A.map&&(r.spotLightMap[C]=A.map,C++,P.updateMatrices(A),A.castShadow&&T++),r.spotLightMatrix[_]=P.matrix,A.castShadow){const U=t.get(A);U.shadowIntensity=P.intensity,U.shadowBias=P.bias,U.shadowNormalBias=P.normalBias,U.shadowRadius=P.radius,U.shadowMapSize=P.mapSize,r.spotShadow[_]=U,r.spotShadowMap[_]=k,w++}_++}else if(A.isRectAreaLight){const z=e.get(A);z.color.copy(F).multiplyScalar(D),z.halfWidth.set(A.width*.5,0,0),z.halfHeight.set(0,A.height*.5,0),r.rectArea[v]=z,v++}else if(A.isPointLight){const z=e.get(A);if(z.color.copy(A.color).multiplyScalar(A.intensity),z.distance=A.distance,z.decay=A.decay,A.castShadow){const P=A.shadow,U=t.get(A);U.shadowIntensity=P.intensity,U.shadowBias=P.bias,U.shadowNormalBias=P.normalBias,U.shadowRadius=P.radius,U.shadowMapSize=P.mapSize,U.shadowCameraNear=P.camera.near,U.shadowCameraFar=P.camera.far,r.pointShadow[g]=U,r.pointShadowMap[g]=k,r.pointShadowMatrix[g]=A.shadow.matrix,y++}r.point[g]=z,g++}else if(A.isHemisphereLight){const z=e.get(A);z.skyColor.copy(A.color).multiplyScalar(D),z.groundColor.copy(A.groundColor).multiplyScalar(D),r.hemi[p]=z,p++}}v>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=We.LTC_FLOAT_1,r.rectAreaLTC2=We.LTC_FLOAT_2):(r.rectAreaLTC1=We.LTC_HALF_1,r.rectAreaLTC2=We.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=f;const b=r.hash;(b.directionalLength!==m||b.pointLength!==g||b.spotLength!==_||b.rectAreaLength!==v||b.hemiLength!==p||b.numDirectionalShadows!==x||b.numPointShadows!==y||b.numSpotShadows!==w||b.numSpotMaps!==C||b.numLightProbes!==S)&&(r.directional.length=m,r.spot.length=_,r.rectArea.length=v,r.point.length=g,r.hemi.length=p,r.directionalShadow.length=x,r.directionalShadowMap.length=x,r.pointShadow.length=y,r.pointShadowMap.length=y,r.spotShadow.length=w,r.spotShadowMap.length=w,r.directionalShadowMatrix.length=x,r.pointShadowMatrix.length=y,r.spotLightMatrix.length=w+C-T,r.spotLightMap.length=C,r.numSpotLightShadowsWithMaps=T,r.numLightProbes=S,b.directionalLength=m,b.pointLength=g,b.spotLength=_,b.rectAreaLength=v,b.hemiLength=p,b.numDirectionalShadows=x,b.numPointShadows=y,b.numSpotShadows=w,b.numSpotMaps=C,b.numLightProbes=S,r.version=zq++)}function l(c,u){let h=0,f=0,m=0,g=0,_=0;const v=u.matrixWorldInverse;for(let p=0,x=c.length;p<x;p++){const y=c[p];if(y.isDirectionalLight){const w=r.directional[h];w.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),w.direction.sub(i),w.direction.transformDirection(v),h++}else if(y.isSpotLight){const w=r.spot[m];w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(v),w.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),w.direction.sub(i),w.direction.transformDirection(v),m++}else if(y.isRectAreaLight){const w=r.rectArea[g];w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(v),s.identity(),o.copy(y.matrixWorld),o.premultiply(v),s.extractRotation(o),w.halfWidth.set(y.width*.5,0,0),w.halfHeight.set(0,y.height*.5,0),w.halfWidth.applyMatrix4(s),w.halfHeight.applyMatrix4(s),g++}else if(y.isPointLight){const w=r.point[f];w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(v),f++}else if(y.isHemisphereLight){const w=r.hemi[_];w.direction.setFromMatrixPosition(y.matrixWorld),w.direction.transformDirection(v),_++}}}return{setup:a,setupView:l,state:r}}function xO(n){const e=new Vq(n),t=[],r=[];function i(u){c.camera=u,t.length=0,r.length=0}function o(u){t.push(u)}function s(u){r.push(u)}function a(){e.setup(t)}function l(u){e.setupView(t,u)}const c={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:c,setupLights:a,setupLightsView:l,pushLight:o,pushShadow:s}}function Gq(n){let e=new WeakMap;function t(i,o=0){const s=e.get(i);let a;return s===void 0?(a=new xO(n),e.set(i,[a])):o>=s.length?(a=new xO(n),s.push(a)):a=s[o],a}function r(){e=new WeakMap}return{get:t,dispose:r}}class Wq extends Lm{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=bW,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class $q extends Lm{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Yq=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Kq=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Xq(n,e,t){let r=new nI;const i=new Ut,o=new Ut,s=new gn,a=new Wq({depthPacking:AW}),l=new $q,c={},u=t.maxTextureSize,h={[bl]:Ki,[Ki]:bl,[vi]:vi},f=new No({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ut},radius:{value:4}},vertexShader:Yq,fragmentShader:Kq}),m=f.clone();m.defines.HORIZONTAL_PASS=1;const g=new Sn;g.setAttribute("position",new $n(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new Ve(g,f),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=SF;let p=this.type;this.render=function(T,S,b){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||T.length===0)return;const R=n.getRenderTarget(),E=n.getActiveCubeFace(),A=n.getActiveMipmapLevel(),F=n.state;F.setBlending(pl),F.buffers.color.setClear(1,1,1,1),F.buffers.depth.setTest(!0),F.setScissorTest(!1);const D=p!==Xa&&this.type===Xa,M=p===Xa&&this.type!==Xa;for(let k=0,z=T.length;k<z;k++){const P=T[k],U=P.shadow;if(U===void 0){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(U.autoUpdate===!1&&U.needsUpdate===!1)continue;i.copy(U.mapSize);const Y=U.getFrameExtents();if(i.multiply(Y),o.copy(U.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(o.x=Math.floor(u/Y.x),i.x=o.x*Y.x,U.mapSize.x=o.x),i.y>u&&(o.y=Math.floor(u/Y.y),i.y=o.y*Y.y,U.mapSize.y=o.y)),U.map===null||D===!0||M===!0){const j=this.type!==Xa?{minFilter:So,magFilter:So}:{};U.map!==null&&U.map.dispose(),U.map=new is(i.x,i.y,j),U.map.texture.name=P.name+".shadowMap",U.camera.updateProjectionMatrix()}n.setRenderTarget(U.map),n.clear();const Z=U.getViewportCount();for(let j=0;j<Z;j++){const X=U.getViewport(j);s.set(o.x*X.x,o.y*X.y,o.x*X.z,o.y*X.w),F.viewport(s),U.updateMatrices(P,j),r=U.getFrustum(),w(S,b,U.camera,P,this.type)}U.isPointLightShadow!==!0&&this.type===Xa&&x(U,b),U.needsUpdate=!1}p=this.type,v.needsUpdate=!1,n.setRenderTarget(R,E,A)};function x(T,S){const b=e.update(_);f.defines.VSM_SAMPLES!==T.blurSamples&&(f.defines.VSM_SAMPLES=T.blurSamples,m.defines.VSM_SAMPLES=T.blurSamples,f.needsUpdate=!0,m.needsUpdate=!0),T.mapPass===null&&(T.mapPass=new is(i.x,i.y)),f.uniforms.shadow_pass.value=T.map.texture,f.uniforms.resolution.value=T.mapSize,f.uniforms.radius.value=T.radius,n.setRenderTarget(T.mapPass),n.clear(),n.renderBufferDirect(S,null,b,f,_,null),m.uniforms.shadow_pass.value=T.mapPass.texture,m.uniforms.resolution.value=T.mapSize,m.uniforms.radius.value=T.radius,n.setRenderTarget(T.map),n.clear(),n.renderBufferDirect(S,null,b,m,_,null)}function y(T,S,b,R){let E=null;const A=b.isPointLight===!0?T.customDistanceMaterial:T.customDepthMaterial;if(A!==void 0)E=A;else if(E=b.isPointLight===!0?l:a,n.localClippingEnabled&&S.clipShadows===!0&&Array.isArray(S.clippingPlanes)&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0||S.map&&S.alphaTest>0){const F=E.uuid,D=S.uuid;let M=c[F];M===void 0&&(M={},c[F]=M);let k=M[D];k===void 0&&(k=E.clone(),M[D]=k,S.addEventListener("dispose",C)),E=k}if(E.visible=S.visible,E.wireframe=S.wireframe,R===Xa?E.side=S.shadowSide!==null?S.shadowSide:S.side:E.side=S.shadowSide!==null?S.shadowSide:h[S.side],E.alphaMap=S.alphaMap,E.alphaTest=S.alphaTest,E.map=S.map,E.clipShadows=S.clipShadows,E.clippingPlanes=S.clippingPlanes,E.clipIntersection=S.clipIntersection,E.displacementMap=S.displacementMap,E.displacementScale=S.displacementScale,E.displacementBias=S.displacementBias,E.wireframeLinewidth=S.wireframeLinewidth,E.linewidth=S.linewidth,b.isPointLight===!0&&E.isMeshDistanceMaterial===!0){const F=n.properties.get(E);F.light=b}return E}function w(T,S,b,R,E){if(T.visible===!1)return;if(T.layers.test(S.layers)&&(T.isMesh||T.isLine||T.isPoints)&&(T.castShadow||T.receiveShadow&&E===Xa)&&(!T.frustumCulled||r.intersectsObject(T))){T.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,T.matrixWorld);const D=e.update(T),M=T.material;if(Array.isArray(M)){const k=D.groups;for(let z=0,P=k.length;z<P;z++){const U=k[z],Y=M[U.materialIndex];if(Y&&Y.visible){const Z=y(T,Y,R,E);T.onBeforeShadow(n,T,S,b,D,Z,U),n.renderBufferDirect(b,null,D,Z,T,U),T.onAfterShadow(n,T,S,b,D,Z,U)}}}else if(M.visible){const k=y(T,M,R,E);T.onBeforeShadow(n,T,S,b,D,k,null),n.renderBufferDirect(b,null,D,k,T,null),T.onAfterShadow(n,T,S,b,D,k,null)}}const F=T.children;for(let D=0,M=F.length;D<M;D++)w(F[D],S,b,R,E)}function C(T){T.target.removeEventListener("dispose",C);for(const b in c){const R=c[b],E=T.target.uuid;E in R&&(R[E].dispose(),delete R[E])}}}const qq={[K2]:X2,[q2]:J2,[Q2]:eA,[Zp]:Z2,[X2]:K2,[J2]:q2,[eA]:Q2,[Z2]:Zp};function Qq(n){function e(){let L=!1;const te=new gn;let J=null;const ie=new gn(0,0,0,0);return{setMask:function(ye){J!==ye&&!L&&(n.colorMask(ye,ye,ye,ye),J=ye)},setLocked:function(ye){L=ye},setClear:function(ye,xe,$e,Et,En){En===!0&&(ye*=Et,xe*=Et,$e*=Et),te.set(ye,xe,$e,Et),ie.equals(te)===!1&&(n.clearColor(ye,xe,$e,Et),ie.copy(te))},reset:function(){L=!1,J=null,ie.set(-1,0,0,0)}}}function t(){let L=!1,te=!1,J=null,ie=null,ye=null;return{setReversed:function(xe){te=xe},setTest:function(xe){xe?fe(n.DEPTH_TEST):ce(n.DEPTH_TEST)},setMask:function(xe){J!==xe&&!L&&(n.depthMask(xe),J=xe)},setFunc:function(xe){if(te&&(xe=qq[xe]),ie!==xe){switch(xe){case K2:n.depthFunc(n.NEVER);break;case X2:n.depthFunc(n.ALWAYS);break;case q2:n.depthFunc(n.LESS);break;case Zp:n.depthFunc(n.LEQUAL);break;case Q2:n.depthFunc(n.EQUAL);break;case Z2:n.depthFunc(n.GEQUAL);break;case J2:n.depthFunc(n.GREATER);break;case eA:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}ie=xe}},setLocked:function(xe){L=xe},setClear:function(xe){ye!==xe&&(n.clearDepth(xe),ye=xe)},reset:function(){L=!1,J=null,ie=null,ye=null}}}function r(){let L=!1,te=null,J=null,ie=null,ye=null,xe=null,$e=null,Et=null,En=null;return{setTest:function(Ge){L||(Ge?fe(n.STENCIL_TEST):ce(n.STENCIL_TEST))},setMask:function(Ge){te!==Ge&&!L&&(n.stencilMask(Ge),te=Ge)},setFunc:function(Ge,Or,ti){(J!==Ge||ie!==Or||ye!==ti)&&(n.stencilFunc(Ge,Or,ti),J=Ge,ie=Or,ye=ti)},setOp:function(Ge,Or,ti){(xe!==Ge||$e!==Or||Et!==ti)&&(n.stencilOp(Ge,Or,ti),xe=Ge,$e=Or,Et=ti)},setLocked:function(Ge){L=Ge},setClear:function(Ge){En!==Ge&&(n.clearStencil(Ge),En=Ge)},reset:function(){L=!1,te=null,J=null,ie=null,ye=null,xe=null,$e=null,Et=null,En=null}}}const i=new e,o=new t,s=new r,a=new WeakMap,l=new WeakMap;let c={},u={},h=new WeakMap,f=[],m=null,g=!1,_=null,v=null,p=null,x=null,y=null,w=null,C=null,T=new rt(0,0,0),S=0,b=!1,R=null,E=null,A=null,F=null,D=null;const M=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let k=!1,z=0;const P=n.getParameter(n.VERSION);P.indexOf("WebGL")!==-1?(z=parseFloat(/^WebGL (\d)/.exec(P)[1]),k=z>=1):P.indexOf("OpenGL ES")!==-1&&(z=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),k=z>=2);let U=null,Y={};const Z=n.getParameter(n.SCISSOR_BOX),j=n.getParameter(n.VIEWPORT),X=new gn().fromArray(Z),B=new gn().fromArray(j);function K(L,te,J,ie){const ye=new Uint8Array(4),xe=n.createTexture();n.bindTexture(L,xe),n.texParameteri(L,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(L,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let $e=0;$e<J;$e++)L===n.TEXTURE_3D||L===n.TEXTURE_2D_ARRAY?n.texImage3D(te,0,n.RGBA,1,1,ie,0,n.RGBA,n.UNSIGNED_BYTE,ye):n.texImage2D(te+$e,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ye);return xe}const ee={};ee[n.TEXTURE_2D]=K(n.TEXTURE_2D,n.TEXTURE_2D,1),ee[n.TEXTURE_CUBE_MAP]=K(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),ee[n.TEXTURE_2D_ARRAY]=K(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),ee[n.TEXTURE_3D]=K(n.TEXTURE_3D,n.TEXTURE_3D,1,1),i.setClear(0,0,0,1),o.setClear(1),s.setClear(0),fe(n.DEPTH_TEST),o.setFunc(Zp),se(!1),Ee(AL),fe(n.CULL_FACE),$(pl);function fe(L){c[L]!==!0&&(n.enable(L),c[L]=!0)}function ce(L){c[L]!==!1&&(n.disable(L),c[L]=!1)}function we(L,te){return u[L]!==te?(n.bindFramebuffer(L,te),u[L]=te,L===n.DRAW_FRAMEBUFFER&&(u[n.FRAMEBUFFER]=te),L===n.FRAMEBUFFER&&(u[n.DRAW_FRAMEBUFFER]=te),!0):!1}function Ie(L,te){let J=f,ie=!1;if(L){J=h.get(te),J===void 0&&(J=[],h.set(te,J));const ye=L.textures;if(J.length!==ye.length||J[0]!==n.COLOR_ATTACHMENT0){for(let xe=0,$e=ye.length;xe<$e;xe++)J[xe]=n.COLOR_ATTACHMENT0+xe;J.length=ye.length,ie=!0}}else J[0]!==n.BACK&&(J[0]=n.BACK,ie=!0);ie&&n.drawBuffers(J)}function ft(L){return m!==L?(n.useProgram(L),m=L,!0):!1}const _t={[nd]:n.FUNC_ADD,[iW]:n.FUNC_SUBTRACT,[oW]:n.FUNC_REVERSE_SUBTRACT};_t[sW]=n.MIN,_t[aW]=n.MAX;const pt={[lW]:n.ZERO,[cW]:n.ONE,[uW]:n.SRC_COLOR,[$2]:n.SRC_ALPHA,[gW]:n.SRC_ALPHA_SATURATE,[pW]:n.DST_COLOR,[hW]:n.DST_ALPHA,[dW]:n.ONE_MINUS_SRC_COLOR,[Y2]:n.ONE_MINUS_SRC_ALPHA,[mW]:n.ONE_MINUS_DST_COLOR,[fW]:n.ONE_MINUS_DST_ALPHA,[vW]:n.CONSTANT_COLOR,[_W]:n.ONE_MINUS_CONSTANT_COLOR,[xW]:n.CONSTANT_ALPHA,[yW]:n.ONE_MINUS_CONSTANT_ALPHA};function $(L,te,J,ie,ye,xe,$e,Et,En,Ge){if(L===pl){g===!0&&(ce(n.BLEND),g=!1);return}if(g===!1&&(fe(n.BLEND),g=!0),L!==rW){if(L!==_||Ge!==b){if((v!==nd||y!==nd)&&(n.blendEquation(n.FUNC_ADD),v=nd,y=nd),Ge)switch(L){case xp:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case W2:n.blendFunc(n.ONE,n.ONE);break;case ML:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case RL:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",L);break}else switch(L){case xp:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case W2:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case ML:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case RL:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",L);break}p=null,x=null,w=null,C=null,T.set(0,0,0),S=0,_=L,b=Ge}return}ye=ye||te,xe=xe||J,$e=$e||ie,(te!==v||ye!==y)&&(n.blendEquationSeparate(_t[te],_t[ye]),v=te,y=ye),(J!==p||ie!==x||xe!==w||$e!==C)&&(n.blendFuncSeparate(pt[J],pt[ie],pt[xe],pt[$e]),p=J,x=ie,w=xe,C=$e),(Et.equals(T)===!1||En!==S)&&(n.blendColor(Et.r,Et.g,Et.b,En),T.copy(Et),S=En),_=L,b=!1}function ot(L,te){L.side===vi?ce(n.CULL_FACE):fe(n.CULL_FACE);let J=L.side===Ki;te&&(J=!J),se(J),L.blending===xp&&L.transparent===!1?$(pl):$(L.blending,L.blendEquation,L.blendSrc,L.blendDst,L.blendEquationAlpha,L.blendSrcAlpha,L.blendDstAlpha,L.blendColor,L.blendAlpha,L.premultipliedAlpha),o.setFunc(L.depthFunc),o.setTest(L.depthTest),o.setMask(L.depthWrite),i.setMask(L.colorWrite);const ie=L.stencilWrite;s.setTest(ie),ie&&(s.setMask(L.stencilWriteMask),s.setFunc(L.stencilFunc,L.stencilRef,L.stencilFuncMask),s.setOp(L.stencilFail,L.stencilZFail,L.stencilZPass)),Le(L.polygonOffset,L.polygonOffsetFactor,L.polygonOffsetUnits),L.alphaToCoverage===!0?fe(n.SAMPLE_ALPHA_TO_COVERAGE):ce(n.SAMPLE_ALPHA_TO_COVERAGE)}function se(L){R!==L&&(L?n.frontFace(n.CW):n.frontFace(n.CCW),R=L)}function Ee(L){L!==eW?(fe(n.CULL_FACE),L!==E&&(L===AL?n.cullFace(n.BACK):L===tW?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):ce(n.CULL_FACE),E=L}function Te(L){L!==A&&(k&&n.lineWidth(L),A=L)}function Le(L,te,J){L?(fe(n.POLYGON_OFFSET_FILL),(F!==te||D!==J)&&(n.polygonOffset(te,J),F=te,D=J)):ce(n.POLYGON_OFFSET_FILL)}function be(L){L?fe(n.SCISSOR_TEST):ce(n.SCISSOR_TEST)}function G(L){L===void 0&&(L=n.TEXTURE0+M-1),U!==L&&(n.activeTexture(L),U=L)}function I(L,te,J){J===void 0&&(U===null?J=n.TEXTURE0+M-1:J=U);let ie=Y[J];ie===void 0&&(ie={type:void 0,texture:void 0},Y[J]=ie),(ie.type!==L||ie.texture!==te)&&(U!==J&&(n.activeTexture(J),U=J),n.bindTexture(L,te||ee[L]),ie.type=L,ie.texture=te)}function V(){const L=Y[U];L!==void 0&&L.type!==void 0&&(n.bindTexture(L.type,null),L.type=void 0,L.texture=void 0)}function q(){try{n.compressedTexImage2D.apply(n,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function ne(){try{n.compressedTexImage3D.apply(n,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function Q(){try{n.texSubImage2D.apply(n,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function he(){try{n.texSubImage3D.apply(n,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function me(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function _e(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function ze(){try{n.texStorage2D.apply(n,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function pe(){try{n.texStorage3D.apply(n,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function Ce(){try{n.texImage2D.apply(n,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function je(){try{n.texImage3D.apply(n,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function Qe(L){X.equals(L)===!1&&(n.scissor(L.x,L.y,L.z,L.w),X.copy(L))}function He(L){B.equals(L)===!1&&(n.viewport(L.x,L.y,L.z,L.w),B.copy(L))}function St(L,te){let J=l.get(te);J===void 0&&(J=new WeakMap,l.set(te,J));let ie=J.get(L);ie===void 0&&(ie=n.getUniformBlockIndex(te,L.name),J.set(L,ie))}function st(L,te){const ie=l.get(te).get(L);a.get(te)!==ie&&(n.uniformBlockBinding(te,ie,L.__bindingPointIndex),a.set(te,ie))}function qt(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},U=null,Y={},u={},h=new WeakMap,f=[],m=null,g=!1,_=null,v=null,p=null,x=null,y=null,w=null,C=null,T=new rt(0,0,0),S=0,b=!1,R=null,E=null,A=null,F=null,D=null,X.set(0,0,n.canvas.width,n.canvas.height),B.set(0,0,n.canvas.width,n.canvas.height),i.reset(),o.reset(),s.reset()}return{buffers:{color:i,depth:o,stencil:s},enable:fe,disable:ce,bindFramebuffer:we,drawBuffers:Ie,useProgram:ft,setBlending:$,setMaterial:ot,setFlipSided:se,setCullFace:Ee,setLineWidth:Te,setPolygonOffset:Le,setScissorTest:be,activeTexture:G,bindTexture:I,unbindTexture:V,compressedTexImage2D:q,compressedTexImage3D:ne,texImage2D:Ce,texImage3D:je,updateUBOMapping:St,uniformBlockBinding:st,texStorage2D:ze,texStorage3D:pe,texSubImage2D:Q,texSubImage3D:he,compressedTexSubImage2D:me,compressedTexSubImage3D:_e,scissor:Qe,viewport:He,reset:qt}}function yO(n,e,t,r){const i=Zq(r);switch(t){case OF:return n*e;case UF:return n*e;case FF:return n*e*2;case jF:return n*e/i.components*i.byteLength;case KN:return n*e/i.components*i.byteLength;case BF:return n*e*2/i.components*i.byteLength;case XN:return n*e*2/i.components*i.byteLength;case DF:return n*e*3/i.components*i.byteLength;case Jo:return n*e*4/i.components*i.byteLength;case qN:return n*e*4/i.components*i.byteLength;case vy:case _y:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case xy:case yy:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case iA:case sA:return Math.max(n,16)*Math.max(e,8)/4;case rA:case oA:return Math.max(n,8)*Math.max(e,8)/2;case aA:case lA:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case cA:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case uA:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case dA:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case hA:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case fA:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case pA:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case mA:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case gA:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case vA:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case _A:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case xA:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case yA:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case wA:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case SA:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case EA:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case wy:case TA:case CA:return Math.ceil(n/4)*Math.ceil(e/4)*16;case zF:case bA:return Math.ceil(n/4)*Math.ceil(e/4)*8;case AA:case MA:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function Zq(n){switch(n){case Al:case PF:return{byteLength:1,components:1};case rv:case kF:case Ml:return{byteLength:2,components:1};case $N:case YN:return{byteLength:2,components:4};case Yd:case WN:case il:return{byteLength:4,components:1};case LF:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}function Jq(n,e,t,r,i,o,s){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Ut,u=new WeakMap;let h;const f=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function g(G,I){return m?new OffscreenCanvas(G,I):vw("canvas")}function _(G,I,V){let q=1;const ne=be(G);if((ne.width>V||ne.height>V)&&(q=V/Math.max(ne.width,ne.height)),q<1)if(typeof HTMLImageElement<"u"&&G instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&G instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&G instanceof ImageBitmap||typeof VideoFrame<"u"&&G instanceof VideoFrame){const Q=Math.floor(q*ne.width),he=Math.floor(q*ne.height);h===void 0&&(h=g(Q,he));const me=I?g(Q,he):h;return me.width=Q,me.height=he,me.getContext("2d").drawImage(G,0,0,Q,he),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ne.width+"x"+ne.height+") to ("+Q+"x"+he+")."),me}else return"data"in G&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ne.width+"x"+ne.height+")."),G;return G}function v(G){return G.generateMipmaps&&G.minFilter!==So&&G.minFilter!==qo}function p(G){n.generateMipmap(G)}function x(G,I,V,q,ne=!1){if(G!==null){if(n[G]!==void 0)return n[G];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+G+"'")}let Q=I;if(I===n.RED&&(V===n.FLOAT&&(Q=n.R32F),V===n.HALF_FLOAT&&(Q=n.R16F),V===n.UNSIGNED_BYTE&&(Q=n.R8)),I===n.RED_INTEGER&&(V===n.UNSIGNED_BYTE&&(Q=n.R8UI),V===n.UNSIGNED_SHORT&&(Q=n.R16UI),V===n.UNSIGNED_INT&&(Q=n.R32UI),V===n.BYTE&&(Q=n.R8I),V===n.SHORT&&(Q=n.R16I),V===n.INT&&(Q=n.R32I)),I===n.RG&&(V===n.FLOAT&&(Q=n.RG32F),V===n.HALF_FLOAT&&(Q=n.RG16F),V===n.UNSIGNED_BYTE&&(Q=n.RG8)),I===n.RG_INTEGER&&(V===n.UNSIGNED_BYTE&&(Q=n.RG8UI),V===n.UNSIGNED_SHORT&&(Q=n.RG16UI),V===n.UNSIGNED_INT&&(Q=n.RG32UI),V===n.BYTE&&(Q=n.RG8I),V===n.SHORT&&(Q=n.RG16I),V===n.INT&&(Q=n.RG32I)),I===n.RGB_INTEGER&&(V===n.UNSIGNED_BYTE&&(Q=n.RGB8UI),V===n.UNSIGNED_SHORT&&(Q=n.RGB16UI),V===n.UNSIGNED_INT&&(Q=n.RGB32UI),V===n.BYTE&&(Q=n.RGB8I),V===n.SHORT&&(Q=n.RGB16I),V===n.INT&&(Q=n.RGB32I)),I===n.RGBA_INTEGER&&(V===n.UNSIGNED_BYTE&&(Q=n.RGBA8UI),V===n.UNSIGNED_SHORT&&(Q=n.RGBA16UI),V===n.UNSIGNED_INT&&(Q=n.RGBA32UI),V===n.BYTE&&(Q=n.RGBA8I),V===n.SHORT&&(Q=n.RGBA16I),V===n.INT&&(Q=n.RGBA32I)),I===n.RGB&&V===n.UNSIGNED_INT_5_9_9_9_REV&&(Q=n.RGB9_E5),I===n.RGBA){const he=ne?fw:sn.getTransfer(q);V===n.FLOAT&&(Q=n.RGBA32F),V===n.HALF_FLOAT&&(Q=n.RGBA16F),V===n.UNSIGNED_BYTE&&(Q=he===Mn?n.SRGB8_ALPHA8:n.RGBA8),V===n.UNSIGNED_SHORT_4_4_4_4&&(Q=n.RGBA4),V===n.UNSIGNED_SHORT_5_5_5_1&&(Q=n.RGB5_A1)}return(Q===n.R16F||Q===n.R32F||Q===n.RG16F||Q===n.RG32F||Q===n.RGBA16F||Q===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Q}function y(G,I){let V;return G?I===null||I===Yd||I===tm?V=n.DEPTH24_STENCIL8:I===il?V=n.DEPTH32F_STENCIL8:I===rv&&(V=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):I===null||I===Yd||I===tm?V=n.DEPTH_COMPONENT24:I===il?V=n.DEPTH_COMPONENT32F:I===rv&&(V=n.DEPTH_COMPONENT16),V}function w(G,I){return v(G)===!0||G.isFramebufferTexture&&G.minFilter!==So&&G.minFilter!==qo?Math.log2(Math.max(I.width,I.height))+1:G.mipmaps!==void 0&&G.mipmaps.length>0?G.mipmaps.length:G.isCompressedTexture&&Array.isArray(G.image)?I.mipmaps.length:1}function C(G){const I=G.target;I.removeEventListener("dispose",C),S(I),I.isVideoTexture&&u.delete(I)}function T(G){const I=G.target;I.removeEventListener("dispose",T),R(I)}function S(G){const I=r.get(G);if(I.__webglInit===void 0)return;const V=G.source,q=f.get(V);if(q){const ne=q[I.__cacheKey];ne.usedTimes--,ne.usedTimes===0&&b(G),Object.keys(q).length===0&&f.delete(V)}r.remove(G)}function b(G){const I=r.get(G);n.deleteTexture(I.__webglTexture);const V=G.source,q=f.get(V);delete q[I.__cacheKey],s.memory.textures--}function R(G){const I=r.get(G);if(G.depthTexture&&G.depthTexture.dispose(),G.isWebGLCubeRenderTarget)for(let q=0;q<6;q++){if(Array.isArray(I.__webglFramebuffer[q]))for(let ne=0;ne<I.__webglFramebuffer[q].length;ne++)n.deleteFramebuffer(I.__webglFramebuffer[q][ne]);else n.deleteFramebuffer(I.__webglFramebuffer[q]);I.__webglDepthbuffer&&n.deleteRenderbuffer(I.__webglDepthbuffer[q])}else{if(Array.isArray(I.__webglFramebuffer))for(let q=0;q<I.__webglFramebuffer.length;q++)n.deleteFramebuffer(I.__webglFramebuffer[q]);else n.deleteFramebuffer(I.__webglFramebuffer);if(I.__webglDepthbuffer&&n.deleteRenderbuffer(I.__webglDepthbuffer),I.__webglMultisampledFramebuffer&&n.deleteFramebuffer(I.__webglMultisampledFramebuffer),I.__webglColorRenderbuffer)for(let q=0;q<I.__webglColorRenderbuffer.length;q++)I.__webglColorRenderbuffer[q]&&n.deleteRenderbuffer(I.__webglColorRenderbuffer[q]);I.__webglDepthRenderbuffer&&n.deleteRenderbuffer(I.__webglDepthRenderbuffer)}const V=G.textures;for(let q=0,ne=V.length;q<ne;q++){const Q=r.get(V[q]);Q.__webglTexture&&(n.deleteTexture(Q.__webglTexture),s.memory.textures--),r.remove(V[q])}r.remove(G)}let E=0;function A(){E=0}function F(){const G=E;return G>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+G+" texture units while this GPU supports only "+i.maxTextures),E+=1,G}function D(G){const I=[];return I.push(G.wrapS),I.push(G.wrapT),I.push(G.wrapR||0),I.push(G.magFilter),I.push(G.minFilter),I.push(G.anisotropy),I.push(G.internalFormat),I.push(G.format),I.push(G.type),I.push(G.generateMipmaps),I.push(G.premultiplyAlpha),I.push(G.flipY),I.push(G.unpackAlignment),I.push(G.colorSpace),I.join()}function M(G,I){const V=r.get(G);if(G.isVideoTexture&&Te(G),G.isRenderTargetTexture===!1&&G.version>0&&V.__version!==G.version){const q=G.image;if(q===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(q.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{B(V,G,I);return}}t.bindTexture(n.TEXTURE_2D,V.__webglTexture,n.TEXTURE0+I)}function k(G,I){const V=r.get(G);if(G.version>0&&V.__version!==G.version){B(V,G,I);return}t.bindTexture(n.TEXTURE_2D_ARRAY,V.__webglTexture,n.TEXTURE0+I)}function z(G,I){const V=r.get(G);if(G.version>0&&V.__version!==G.version){B(V,G,I);return}t.bindTexture(n.TEXTURE_3D,V.__webglTexture,n.TEXTURE0+I)}function P(G,I){const V=r.get(G);if(G.version>0&&V.__version!==G.version){K(V,G,I);return}t.bindTexture(n.TEXTURE_CUBE_MAP,V.__webglTexture,n.TEXTURE0+I)}const U={[dw]:n.REPEAT,[kc]:n.CLAMP_TO_EDGE,[hw]:n.MIRRORED_REPEAT},Y={[So]:n.NEAREST,[IF]:n.NEAREST_MIPMAP_NEAREST,[e0]:n.NEAREST_MIPMAP_LINEAR,[qo]:n.LINEAR,[gy]:n.LINEAR_MIPMAP_NEAREST,[Lc]:n.LINEAR_MIPMAP_LINEAR},Z={[RW]:n.NEVER,[OW]:n.ALWAYS,[NW]:n.LESS,[VF]:n.LEQUAL,[IW]:n.EQUAL,[LW]:n.GEQUAL,[PW]:n.GREATER,[kW]:n.NOTEQUAL};function j(G,I){if(I.type===il&&e.has("OES_texture_float_linear")===!1&&(I.magFilter===qo||I.magFilter===gy||I.magFilter===e0||I.magFilter===Lc||I.minFilter===qo||I.minFilter===gy||I.minFilter===e0||I.minFilter===Lc)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(G,n.TEXTURE_WRAP_S,U[I.wrapS]),n.texParameteri(G,n.TEXTURE_WRAP_T,U[I.wrapT]),(G===n.TEXTURE_3D||G===n.TEXTURE_2D_ARRAY)&&n.texParameteri(G,n.TEXTURE_WRAP_R,U[I.wrapR]),n.texParameteri(G,n.TEXTURE_MAG_FILTER,Y[I.magFilter]),n.texParameteri(G,n.TEXTURE_MIN_FILTER,Y[I.minFilter]),I.compareFunction&&(n.texParameteri(G,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(G,n.TEXTURE_COMPARE_FUNC,Z[I.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(I.magFilter===So||I.minFilter!==e0&&I.minFilter!==Lc||I.type===il&&e.has("OES_texture_float_linear")===!1)return;if(I.anisotropy>1||r.get(I).__currentAnisotropy){const V=e.get("EXT_texture_filter_anisotropic");n.texParameterf(G,V.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(I.anisotropy,i.getMaxAnisotropy())),r.get(I).__currentAnisotropy=I.anisotropy}}}function X(G,I){let V=!1;G.__webglInit===void 0&&(G.__webglInit=!0,I.addEventListener("dispose",C));const q=I.source;let ne=f.get(q);ne===void 0&&(ne={},f.set(q,ne));const Q=D(I);if(Q!==G.__cacheKey){ne[Q]===void 0&&(ne[Q]={texture:n.createTexture(),usedTimes:0},s.memory.textures++,V=!0),ne[Q].usedTimes++;const he=ne[G.__cacheKey];he!==void 0&&(ne[G.__cacheKey].usedTimes--,he.usedTimes===0&&b(I)),G.__cacheKey=Q,G.__webglTexture=ne[Q].texture}return V}function B(G,I,V){let q=n.TEXTURE_2D;(I.isDataArrayTexture||I.isCompressedArrayTexture)&&(q=n.TEXTURE_2D_ARRAY),I.isData3DTexture&&(q=n.TEXTURE_3D);const ne=X(G,I),Q=I.source;t.bindTexture(q,G.__webglTexture,n.TEXTURE0+V);const he=r.get(Q);if(Q.version!==he.__version||ne===!0){t.activeTexture(n.TEXTURE0+V);const me=sn.getPrimaries(sn.workingColorSpace),_e=I.colorSpace===rl?null:sn.getPrimaries(I.colorSpace),ze=I.colorSpace===rl||me===_e?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,I.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,I.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,I.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,ze);let pe=_(I.image,!1,i.maxTextureSize);pe=Le(I,pe);const Ce=o.convert(I.format,I.colorSpace),je=o.convert(I.type);let Qe=x(I.internalFormat,Ce,je,I.colorSpace,I.isVideoTexture);j(q,I);let He;const St=I.mipmaps,st=I.isVideoTexture!==!0,qt=he.__version===void 0||ne===!0,L=Q.dataReady,te=w(I,pe);if(I.isDepthTexture)Qe=y(I.format===nm,I.type),qt&&(st?t.texStorage2D(n.TEXTURE_2D,1,Qe,pe.width,pe.height):t.texImage2D(n.TEXTURE_2D,0,Qe,pe.width,pe.height,0,Ce,je,null));else if(I.isDataTexture)if(St.length>0){st&&qt&&t.texStorage2D(n.TEXTURE_2D,te,Qe,St[0].width,St[0].height);for(let J=0,ie=St.length;J<ie;J++)He=St[J],st?L&&t.texSubImage2D(n.TEXTURE_2D,J,0,0,He.width,He.height,Ce,je,He.data):t.texImage2D(n.TEXTURE_2D,J,Qe,He.width,He.height,0,Ce,je,He.data);I.generateMipmaps=!1}else st?(qt&&t.texStorage2D(n.TEXTURE_2D,te,Qe,pe.width,pe.height),L&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,pe.width,pe.height,Ce,je,pe.data)):t.texImage2D(n.TEXTURE_2D,0,Qe,pe.width,pe.height,0,Ce,je,pe.data);else if(I.isCompressedTexture)if(I.isCompressedArrayTexture){st&&qt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,te,Qe,St[0].width,St[0].height,pe.depth);for(let J=0,ie=St.length;J<ie;J++)if(He=St[J],I.format!==Jo)if(Ce!==null)if(st){if(L)if(I.layerUpdates.size>0){const ye=yO(He.width,He.height,I.format,I.type);for(const xe of I.layerUpdates){const $e=He.data.subarray(xe*ye/He.data.BYTES_PER_ELEMENT,(xe+1)*ye/He.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,J,0,0,xe,He.width,He.height,1,Ce,$e,0,0)}I.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,J,0,0,0,He.width,He.height,pe.depth,Ce,He.data,0,0)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,J,Qe,He.width,He.height,pe.depth,0,He.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else st?L&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,J,0,0,0,He.width,He.height,pe.depth,Ce,je,He.data):t.texImage3D(n.TEXTURE_2D_ARRAY,J,Qe,He.width,He.height,pe.depth,0,Ce,je,He.data)}else{st&&qt&&t.texStorage2D(n.TEXTURE_2D,te,Qe,St[0].width,St[0].height);for(let J=0,ie=St.length;J<ie;J++)He=St[J],I.format!==Jo?Ce!==null?st?L&&t.compressedTexSubImage2D(n.TEXTURE_2D,J,0,0,He.width,He.height,Ce,He.data):t.compressedTexImage2D(n.TEXTURE_2D,J,Qe,He.width,He.height,0,He.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):st?L&&t.texSubImage2D(n.TEXTURE_2D,J,0,0,He.width,He.height,Ce,je,He.data):t.texImage2D(n.TEXTURE_2D,J,Qe,He.width,He.height,0,Ce,je,He.data)}else if(I.isDataArrayTexture)if(st){if(qt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,te,Qe,pe.width,pe.height,pe.depth),L)if(I.layerUpdates.size>0){const J=yO(pe.width,pe.height,I.format,I.type);for(const ie of I.layerUpdates){const ye=pe.data.subarray(ie*J/pe.data.BYTES_PER_ELEMENT,(ie+1)*J/pe.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,ie,pe.width,pe.height,1,Ce,je,ye)}I.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,pe.width,pe.height,pe.depth,Ce,je,pe.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Qe,pe.width,pe.height,pe.depth,0,Ce,je,pe.data);else if(I.isData3DTexture)st?(qt&&t.texStorage3D(n.TEXTURE_3D,te,Qe,pe.width,pe.height,pe.depth),L&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,pe.width,pe.height,pe.depth,Ce,je,pe.data)):t.texImage3D(n.TEXTURE_3D,0,Qe,pe.width,pe.height,pe.depth,0,Ce,je,pe.data);else if(I.isFramebufferTexture){if(qt)if(st)t.texStorage2D(n.TEXTURE_2D,te,Qe,pe.width,pe.height);else{let J=pe.width,ie=pe.height;for(let ye=0;ye<te;ye++)t.texImage2D(n.TEXTURE_2D,ye,Qe,J,ie,0,Ce,je,null),J>>=1,ie>>=1}}else if(St.length>0){if(st&&qt){const J=be(St[0]);t.texStorage2D(n.TEXTURE_2D,te,Qe,J.width,J.height)}for(let J=0,ie=St.length;J<ie;J++)He=St[J],st?L&&t.texSubImage2D(n.TEXTURE_2D,J,0,0,Ce,je,He):t.texImage2D(n.TEXTURE_2D,J,Qe,Ce,je,He);I.generateMipmaps=!1}else if(st){if(qt){const J=be(pe);t.texStorage2D(n.TEXTURE_2D,te,Qe,J.width,J.height)}L&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ce,je,pe)}else t.texImage2D(n.TEXTURE_2D,0,Qe,Ce,je,pe);v(I)&&p(q),he.__version=Q.version,I.onUpdate&&I.onUpdate(I)}G.__version=I.version}function K(G,I,V){if(I.image.length!==6)return;const q=X(G,I),ne=I.source;t.bindTexture(n.TEXTURE_CUBE_MAP,G.__webglTexture,n.TEXTURE0+V);const Q=r.get(ne);if(ne.version!==Q.__version||q===!0){t.activeTexture(n.TEXTURE0+V);const he=sn.getPrimaries(sn.workingColorSpace),me=I.colorSpace===rl?null:sn.getPrimaries(I.colorSpace),_e=I.colorSpace===rl||he===me?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,I.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,I.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,I.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,_e);const ze=I.isCompressedTexture||I.image[0].isCompressedTexture,pe=I.image[0]&&I.image[0].isDataTexture,Ce=[];for(let ie=0;ie<6;ie++)!ze&&!pe?Ce[ie]=_(I.image[ie],!0,i.maxCubemapSize):Ce[ie]=pe?I.image[ie].image:I.image[ie],Ce[ie]=Le(I,Ce[ie]);const je=Ce[0],Qe=o.convert(I.format,I.colorSpace),He=o.convert(I.type),St=x(I.internalFormat,Qe,He,I.colorSpace),st=I.isVideoTexture!==!0,qt=Q.__version===void 0||q===!0,L=ne.dataReady;let te=w(I,je);j(n.TEXTURE_CUBE_MAP,I);let J;if(ze){st&&qt&&t.texStorage2D(n.TEXTURE_CUBE_MAP,te,St,je.width,je.height);for(let ie=0;ie<6;ie++){J=Ce[ie].mipmaps;for(let ye=0;ye<J.length;ye++){const xe=J[ye];I.format!==Jo?Qe!==null?st?L&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,ye,0,0,xe.width,xe.height,Qe,xe.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,ye,St,xe.width,xe.height,0,xe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):st?L&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,ye,0,0,xe.width,xe.height,Qe,He,xe.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,ye,St,xe.width,xe.height,0,Qe,He,xe.data)}}}else{if(J=I.mipmaps,st&&qt){J.length>0&&te++;const ie=be(Ce[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,te,St,ie.width,ie.height)}for(let ie=0;ie<6;ie++)if(pe){st?L&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,0,0,Ce[ie].width,Ce[ie].height,Qe,He,Ce[ie].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,St,Ce[ie].width,Ce[ie].height,0,Qe,He,Ce[ie].data);for(let ye=0;ye<J.length;ye++){const $e=J[ye].image[ie].image;st?L&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,ye+1,0,0,$e.width,$e.height,Qe,He,$e.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,ye+1,St,$e.width,$e.height,0,Qe,He,$e.data)}}else{st?L&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,0,0,Qe,He,Ce[ie]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,St,Qe,He,Ce[ie]);for(let ye=0;ye<J.length;ye++){const xe=J[ye];st?L&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,ye+1,0,0,Qe,He,xe.image[ie]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ie,ye+1,St,Qe,He,xe.image[ie])}}}v(I)&&p(n.TEXTURE_CUBE_MAP),Q.__version=ne.version,I.onUpdate&&I.onUpdate(I)}G.__version=I.version}function ee(G,I,V,q,ne,Q){const he=o.convert(V.format,V.colorSpace),me=o.convert(V.type),_e=x(V.internalFormat,he,me,V.colorSpace);if(!r.get(I).__hasExternalTextures){const pe=Math.max(1,I.width>>Q),Ce=Math.max(1,I.height>>Q);ne===n.TEXTURE_3D||ne===n.TEXTURE_2D_ARRAY?t.texImage3D(ne,Q,_e,pe,Ce,I.depth,0,he,me,null):t.texImage2D(ne,Q,_e,pe,Ce,0,he,me,null)}t.bindFramebuffer(n.FRAMEBUFFER,G),Ee(I)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,q,ne,r.get(V).__webglTexture,0,se(I)):(ne===n.TEXTURE_2D||ne>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&ne<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,q,ne,r.get(V).__webglTexture,Q),t.bindFramebuffer(n.FRAMEBUFFER,null)}function fe(G,I,V){if(n.bindRenderbuffer(n.RENDERBUFFER,G),I.depthBuffer){const q=I.depthTexture,ne=q&&q.isDepthTexture?q.type:null,Q=y(I.stencilBuffer,ne),he=I.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,me=se(I);Ee(I)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,me,Q,I.width,I.height):V?n.renderbufferStorageMultisample(n.RENDERBUFFER,me,Q,I.width,I.height):n.renderbufferStorage(n.RENDERBUFFER,Q,I.width,I.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,he,n.RENDERBUFFER,G)}else{const q=I.textures;for(let ne=0;ne<q.length;ne++){const Q=q[ne],he=o.convert(Q.format,Q.colorSpace),me=o.convert(Q.type),_e=x(Q.internalFormat,he,me,Q.colorSpace),ze=se(I);V&&Ee(I)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,ze,_e,I.width,I.height):Ee(I)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ze,_e,I.width,I.height):n.renderbufferStorage(n.RENDERBUFFER,_e,I.width,I.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function ce(G,I){if(I&&I.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,G),!(I.depthTexture&&I.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(I.depthTexture).__webglTexture||I.depthTexture.image.width!==I.width||I.depthTexture.image.height!==I.height)&&(I.depthTexture.image.width=I.width,I.depthTexture.image.height=I.height,I.depthTexture.needsUpdate=!0),M(I.depthTexture,0);const q=r.get(I.depthTexture).__webglTexture,ne=se(I);if(I.depthTexture.format===yp)Ee(I)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,q,0,ne):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,q,0);else if(I.depthTexture.format===nm)Ee(I)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,q,0,ne):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,q,0);else throw new Error("Unknown depthTexture format")}function we(G){const I=r.get(G),V=G.isWebGLCubeRenderTarget===!0;if(I.__boundDepthTexture!==G.depthTexture){const q=G.depthTexture;if(I.__depthDisposeCallback&&I.__depthDisposeCallback(),q){const ne=()=>{delete I.__boundDepthTexture,delete I.__depthDisposeCallback,q.removeEventListener("dispose",ne)};q.addEventListener("dispose",ne),I.__depthDisposeCallback=ne}I.__boundDepthTexture=q}if(G.depthTexture&&!I.__autoAllocateDepthBuffer){if(V)throw new Error("target.depthTexture not supported in Cube render targets");ce(I.__webglFramebuffer,G)}else if(V){I.__webglDepthbuffer=[];for(let q=0;q<6;q++)if(t.bindFramebuffer(n.FRAMEBUFFER,I.__webglFramebuffer[q]),I.__webglDepthbuffer[q]===void 0)I.__webglDepthbuffer[q]=n.createRenderbuffer(),fe(I.__webglDepthbuffer[q],G,!1);else{const ne=G.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Q=I.__webglDepthbuffer[q];n.bindRenderbuffer(n.RENDERBUFFER,Q),n.framebufferRenderbuffer(n.FRAMEBUFFER,ne,n.RENDERBUFFER,Q)}}else if(t.bindFramebuffer(n.FRAMEBUFFER,I.__webglFramebuffer),I.__webglDepthbuffer===void 0)I.__webglDepthbuffer=n.createRenderbuffer(),fe(I.__webglDepthbuffer,G,!1);else{const q=G.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ne=I.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,ne),n.framebufferRenderbuffer(n.FRAMEBUFFER,q,n.RENDERBUFFER,ne)}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Ie(G,I,V){const q=r.get(G);I!==void 0&&ee(q.__webglFramebuffer,G,G.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),V!==void 0&&we(G)}function ft(G){const I=G.texture,V=r.get(G),q=r.get(I);G.addEventListener("dispose",T);const ne=G.textures,Q=G.isWebGLCubeRenderTarget===!0,he=ne.length>1;if(he||(q.__webglTexture===void 0&&(q.__webglTexture=n.createTexture()),q.__version=I.version,s.memory.textures++),Q){V.__webglFramebuffer=[];for(let me=0;me<6;me++)if(I.mipmaps&&I.mipmaps.length>0){V.__webglFramebuffer[me]=[];for(let _e=0;_e<I.mipmaps.length;_e++)V.__webglFramebuffer[me][_e]=n.createFramebuffer()}else V.__webglFramebuffer[me]=n.createFramebuffer()}else{if(I.mipmaps&&I.mipmaps.length>0){V.__webglFramebuffer=[];for(let me=0;me<I.mipmaps.length;me++)V.__webglFramebuffer[me]=n.createFramebuffer()}else V.__webglFramebuffer=n.createFramebuffer();if(he)for(let me=0,_e=ne.length;me<_e;me++){const ze=r.get(ne[me]);ze.__webglTexture===void 0&&(ze.__webglTexture=n.createTexture(),s.memory.textures++)}if(G.samples>0&&Ee(G)===!1){V.__webglMultisampledFramebuffer=n.createFramebuffer(),V.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,V.__webglMultisampledFramebuffer);for(let me=0;me<ne.length;me++){const _e=ne[me];V.__webglColorRenderbuffer[me]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,V.__webglColorRenderbuffer[me]);const ze=o.convert(_e.format,_e.colorSpace),pe=o.convert(_e.type),Ce=x(_e.internalFormat,ze,pe,_e.colorSpace,G.isXRRenderTarget===!0),je=se(G);n.renderbufferStorageMultisample(n.RENDERBUFFER,je,Ce,G.width,G.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+me,n.RENDERBUFFER,V.__webglColorRenderbuffer[me])}n.bindRenderbuffer(n.RENDERBUFFER,null),G.depthBuffer&&(V.__webglDepthRenderbuffer=n.createRenderbuffer(),fe(V.__webglDepthRenderbuffer,G,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(Q){t.bindTexture(n.TEXTURE_CUBE_MAP,q.__webglTexture),j(n.TEXTURE_CUBE_MAP,I);for(let me=0;me<6;me++)if(I.mipmaps&&I.mipmaps.length>0)for(let _e=0;_e<I.mipmaps.length;_e++)ee(V.__webglFramebuffer[me][_e],G,I,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+me,_e);else ee(V.__webglFramebuffer[me],G,I,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+me,0);v(I)&&p(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(he){for(let me=0,_e=ne.length;me<_e;me++){const ze=ne[me],pe=r.get(ze);t.bindTexture(n.TEXTURE_2D,pe.__webglTexture),j(n.TEXTURE_2D,ze),ee(V.__webglFramebuffer,G,ze,n.COLOR_ATTACHMENT0+me,n.TEXTURE_2D,0),v(ze)&&p(n.TEXTURE_2D)}t.unbindTexture()}else{let me=n.TEXTURE_2D;if((G.isWebGL3DRenderTarget||G.isWebGLArrayRenderTarget)&&(me=G.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(me,q.__webglTexture),j(me,I),I.mipmaps&&I.mipmaps.length>0)for(let _e=0;_e<I.mipmaps.length;_e++)ee(V.__webglFramebuffer[_e],G,I,n.COLOR_ATTACHMENT0,me,_e);else ee(V.__webglFramebuffer,G,I,n.COLOR_ATTACHMENT0,me,0);v(I)&&p(me),t.unbindTexture()}G.depthBuffer&&we(G)}function _t(G){const I=G.textures;for(let V=0,q=I.length;V<q;V++){const ne=I[V];if(v(ne)){const Q=G.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,he=r.get(ne).__webglTexture;t.bindTexture(Q,he),p(Q),t.unbindTexture()}}}const pt=[],$=[];function ot(G){if(G.samples>0){if(Ee(G)===!1){const I=G.textures,V=G.width,q=G.height;let ne=n.COLOR_BUFFER_BIT;const Q=G.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,he=r.get(G),me=I.length>1;if(me)for(let _e=0;_e<I.length;_e++)t.bindFramebuffer(n.FRAMEBUFFER,he.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+_e,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,he.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+_e,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,he.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,he.__webglFramebuffer);for(let _e=0;_e<I.length;_e++){if(G.resolveDepthBuffer&&(G.depthBuffer&&(ne|=n.DEPTH_BUFFER_BIT),G.stencilBuffer&&G.resolveStencilBuffer&&(ne|=n.STENCIL_BUFFER_BIT)),me){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,he.__webglColorRenderbuffer[_e]);const ze=r.get(I[_e]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,ze,0)}n.blitFramebuffer(0,0,V,q,0,0,V,q,ne,n.NEAREST),l===!0&&(pt.length=0,$.length=0,pt.push(n.COLOR_ATTACHMENT0+_e),G.depthBuffer&&G.resolveDepthBuffer===!1&&(pt.push(Q),$.push(Q),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,$)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,pt))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),me)for(let _e=0;_e<I.length;_e++){t.bindFramebuffer(n.FRAMEBUFFER,he.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+_e,n.RENDERBUFFER,he.__webglColorRenderbuffer[_e]);const ze=r.get(I[_e]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,he.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+_e,n.TEXTURE_2D,ze,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,he.__webglMultisampledFramebuffer)}else if(G.depthBuffer&&G.resolveDepthBuffer===!1&&l){const I=G.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[I])}}}function se(G){return Math.min(i.maxSamples,G.samples)}function Ee(G){const I=r.get(G);return G.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&I.__useRenderToTexture!==!1}function Te(G){const I=s.render.frame;u.get(G)!==I&&(u.set(G,I),G.update())}function Le(G,I){const V=G.colorSpace,q=G.format,ne=G.type;return G.isCompressedTexture===!0||G.isVideoTexture===!0||V!==Hl&&V!==rl&&(sn.getTransfer(V)===Mn?(q!==Jo||ne!==Al)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",V)),I}function be(G){return typeof HTMLImageElement<"u"&&G instanceof HTMLImageElement?(c.width=G.naturalWidth||G.width,c.height=G.naturalHeight||G.height):typeof VideoFrame<"u"&&G instanceof VideoFrame?(c.width=G.displayWidth,c.height=G.displayHeight):(c.width=G.width,c.height=G.height),c}this.allocateTextureUnit=F,this.resetTextureUnits=A,this.setTexture2D=M,this.setTexture2DArray=k,this.setTexture3D=z,this.setTextureCube=P,this.rebindTextures=Ie,this.setupRenderTarget=ft,this.updateRenderTargetMipmap=_t,this.updateMultisampleRenderTarget=ot,this.setupDepthRenderbuffer=we,this.setupFrameBufferTexture=ee,this.useMultisampledRTT=Ee}function eQ(n,e){function t(r,i=rl){let o;const s=sn.getTransfer(i);if(r===Al)return n.UNSIGNED_BYTE;if(r===$N)return n.UNSIGNED_SHORT_4_4_4_4;if(r===YN)return n.UNSIGNED_SHORT_5_5_5_1;if(r===LF)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===PF)return n.BYTE;if(r===kF)return n.SHORT;if(r===rv)return n.UNSIGNED_SHORT;if(r===WN)return n.INT;if(r===Yd)return n.UNSIGNED_INT;if(r===il)return n.FLOAT;if(r===Ml)return n.HALF_FLOAT;if(r===OF)return n.ALPHA;if(r===DF)return n.RGB;if(r===Jo)return n.RGBA;if(r===UF)return n.LUMINANCE;if(r===FF)return n.LUMINANCE_ALPHA;if(r===yp)return n.DEPTH_COMPONENT;if(r===nm)return n.DEPTH_STENCIL;if(r===jF)return n.RED;if(r===KN)return n.RED_INTEGER;if(r===BF)return n.RG;if(r===XN)return n.RG_INTEGER;if(r===qN)return n.RGBA_INTEGER;if(r===vy||r===_y||r===xy||r===yy)if(s===Mn)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(r===vy)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===_y)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===xy)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===yy)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(r===vy)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===_y)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===xy)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===yy)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===rA||r===iA||r===oA||r===sA)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(r===rA)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===iA)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===oA)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===sA)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===aA||r===lA||r===cA)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(r===aA||r===lA)return s===Mn?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(r===cA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===uA||r===dA||r===hA||r===fA||r===pA||r===mA||r===gA||r===vA||r===_A||r===xA||r===yA||r===wA||r===SA||r===EA)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(r===uA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===dA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===hA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===fA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===pA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===mA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===gA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===vA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===_A)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===xA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===yA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===wA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===SA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===EA)return s===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===wy||r===TA||r===CA)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(r===wy)return s===Mn?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===TA)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===CA)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===zF||r===bA||r===AA||r===MA)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(r===wy)return o.COMPRESSED_RED_RGTC1_EXT;if(r===bA)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===AA)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===MA)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===tm?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:t}}class tQ extends Vi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class sl extends Tr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const nQ={type:"move"};class PT{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new sl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new sl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new N,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new N),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new sl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new N,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new N),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,o=null,s=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){s=!0;for(const _ of e.hand.values()){const v=t.getJointPose(_,r),p=this._getHandJoint(c,_);v!==null&&(p.matrix.fromArray(v.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,p.jointRadius=v.radius),p.visible=v!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],f=u.position.distanceTo(h.position),m=.02,g=.005;c.inputState.pinching&&f>m+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=m-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,r),o!==null&&(l.matrix.fromArray(o.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,o.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(o.linearVelocity)):l.hasLinearVelocity=!1,o.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(o.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&o!==null&&(i=o),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(nQ)))}return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=o!==null),c!==null&&(c.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new sl;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}const rQ=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,iQ=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class oQ{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const i=new ds,o=e.properties.get(i);o.__webglTexture=t.texture,(t.depthNear!=r.depthNear||t.depthFar!=r.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new No({vertexShader:rQ,fragmentShader:iQ,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Ve(new Om(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class sQ extends hh{constructor(e,t){super();const r=this;let i=null,o=1,s=null,a="local-floor",l=1,c=null,u=null,h=null,f=null,m=null,g=null;const _=new oQ,v=t.getContextAttributes();let p=null,x=null;const y=[],w=[],C=new Ut;let T=null;const S=new Vi;S.layers.enable(1),S.viewport=new gn;const b=new Vi;b.layers.enable(2),b.viewport=new gn;const R=[S,b],E=new tQ;E.layers.enable(1),E.layers.enable(2);let A=null,F=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(K){let ee=y[K];return ee===void 0&&(ee=new PT,y[K]=ee),ee.getTargetRaySpace()},this.getControllerGrip=function(K){let ee=y[K];return ee===void 0&&(ee=new PT,y[K]=ee),ee.getGripSpace()},this.getHand=function(K){let ee=y[K];return ee===void 0&&(ee=new PT,y[K]=ee),ee.getHandSpace()};function D(K){const ee=w.indexOf(K.inputSource);if(ee===-1)return;const fe=y[ee];fe!==void 0&&(fe.update(K.inputSource,K.frame,c||s),fe.dispatchEvent({type:K.type,data:K.inputSource}))}function M(){i.removeEventListener("select",D),i.removeEventListener("selectstart",D),i.removeEventListener("selectend",D),i.removeEventListener("squeeze",D),i.removeEventListener("squeezestart",D),i.removeEventListener("squeezeend",D),i.removeEventListener("end",M),i.removeEventListener("inputsourceschange",k);for(let K=0;K<y.length;K++){const ee=w[K];ee!==null&&(w[K]=null,y[K].disconnect(ee))}A=null,F=null,_.reset(),e.setRenderTarget(p),m=null,f=null,h=null,i=null,x=null,B.stop(),r.isPresenting=!1,e.setPixelRatio(T),e.setSize(C.width,C.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(K){o=K,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(K){a=K,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||s},this.setReferenceSpace=function(K){c=K},this.getBaseLayer=function(){return f!==null?f:m},this.getBinding=function(){return h},this.getFrame=function(){return g},this.getSession=function(){return i},this.setSession=async function(K){if(i=K,i!==null){if(p=e.getRenderTarget(),i.addEventListener("select",D),i.addEventListener("selectstart",D),i.addEventListener("selectend",D),i.addEventListener("squeeze",D),i.addEventListener("squeezestart",D),i.addEventListener("squeezeend",D),i.addEventListener("end",M),i.addEventListener("inputsourceschange",k),v.xrCompatible!==!0&&await t.makeXRCompatible(),T=e.getPixelRatio(),e.getSize(C),i.renderState.layers===void 0){const ee={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:o};m=new XRWebGLLayer(i,t,ee),i.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),x=new is(m.framebufferWidth,m.framebufferHeight,{format:Jo,type:Al,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil})}else{let ee=null,fe=null,ce=null;v.depth&&(ce=v.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ee=v.stencil?nm:yp,fe=v.stencil?tm:Yd);const we={colorFormat:t.RGBA8,depthFormat:ce,scaleFactor:o};h=new XRWebGLBinding(i,t),f=h.createProjectionLayer(we),i.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),x=new is(f.textureWidth,f.textureHeight,{format:Jo,type:Al,depthTexture:new JF(f.textureWidth,f.textureHeight,fe,void 0,void 0,void 0,void 0,void 0,void 0,ee),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1})}x.isXRRenderTarget=!0,this.setFoveation(l),c=null,s=await i.requestReferenceSpace(a),B.setContext(i),B.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return _.getDepthTexture()};function k(K){for(let ee=0;ee<K.removed.length;ee++){const fe=K.removed[ee],ce=w.indexOf(fe);ce>=0&&(w[ce]=null,y[ce].disconnect(fe))}for(let ee=0;ee<K.added.length;ee++){const fe=K.added[ee];let ce=w.indexOf(fe);if(ce===-1){for(let Ie=0;Ie<y.length;Ie++)if(Ie>=w.length){w.push(fe),ce=Ie;break}else if(w[Ie]===null){w[Ie]=fe,ce=Ie;break}if(ce===-1)break}const we=y[ce];we&&we.connect(fe)}}const z=new N,P=new N;function U(K,ee,fe){z.setFromMatrixPosition(ee.matrixWorld),P.setFromMatrixPosition(fe.matrixWorld);const ce=z.distanceTo(P),we=ee.projectionMatrix.elements,Ie=fe.projectionMatrix.elements,ft=we[14]/(we[10]-1),_t=we[14]/(we[10]+1),pt=(we[9]+1)/we[5],$=(we[9]-1)/we[5],ot=(we[8]-1)/we[0],se=(Ie[8]+1)/Ie[0],Ee=ft*ot,Te=ft*se,Le=ce/(-ot+se),be=Le*-ot;if(ee.matrixWorld.decompose(K.position,K.quaternion,K.scale),K.translateX(be),K.translateZ(Le),K.matrixWorld.compose(K.position,K.quaternion,K.scale),K.matrixWorldInverse.copy(K.matrixWorld).invert(),we[10]===-1)K.projectionMatrix.copy(ee.projectionMatrix),K.projectionMatrixInverse.copy(ee.projectionMatrixInverse);else{const G=ft+Le,I=_t+Le,V=Ee-be,q=Te+(ce-be),ne=pt*_t/I*G,Q=$*_t/I*G;K.projectionMatrix.makePerspective(V,q,ne,Q,G,I),K.projectionMatrixInverse.copy(K.projectionMatrix).invert()}}function Y(K,ee){ee===null?K.matrixWorld.copy(K.matrix):K.matrixWorld.multiplyMatrices(ee.matrixWorld,K.matrix),K.matrixWorldInverse.copy(K.matrixWorld).invert()}this.updateCamera=function(K){if(i===null)return;let ee=K.near,fe=K.far;_.texture!==null&&(_.depthNear>0&&(ee=_.depthNear),_.depthFar>0&&(fe=_.depthFar)),E.near=b.near=S.near=ee,E.far=b.far=S.far=fe,(A!==E.near||F!==E.far)&&(i.updateRenderState({depthNear:E.near,depthFar:E.far}),A=E.near,F=E.far);const ce=K.parent,we=E.cameras;Y(E,ce);for(let Ie=0;Ie<we.length;Ie++)Y(we[Ie],ce);we.length===2?U(E,S,b):E.projectionMatrix.copy(S.projectionMatrix),Z(K,E,ce)};function Z(K,ee,fe){fe===null?K.matrix.copy(ee.matrixWorld):(K.matrix.copy(fe.matrixWorld),K.matrix.invert(),K.matrix.multiply(ee.matrixWorld)),K.matrix.decompose(K.position,K.quaternion,K.scale),K.updateMatrixWorld(!0),K.projectionMatrix.copy(ee.projectionMatrix),K.projectionMatrixInverse.copy(ee.projectionMatrixInverse),K.isPerspectiveCamera&&(K.fov=iv*2*Math.atan(1/K.projectionMatrix.elements[5]),K.zoom=1)}this.getCamera=function(){return E},this.getFoveation=function(){if(!(f===null&&m===null))return l},this.setFoveation=function(K){l=K,f!==null&&(f.fixedFoveation=K),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=K)},this.hasDepthSensing=function(){return _.texture!==null},this.getDepthSensingMesh=function(){return _.getMesh(E)};let j=null;function X(K,ee){if(u=ee.getViewerPose(c||s),g=ee,u!==null){const fe=u.views;m!==null&&(e.setRenderTargetFramebuffer(x,m.framebuffer),e.setRenderTarget(x));let ce=!1;fe.length!==E.cameras.length&&(E.cameras.length=0,ce=!0);for(let Ie=0;Ie<fe.length;Ie++){const ft=fe[Ie];let _t=null;if(m!==null)_t=m.getViewport(ft);else{const $=h.getViewSubImage(f,ft);_t=$.viewport,Ie===0&&(e.setRenderTargetTextures(x,$.colorTexture,f.ignoreDepthValues?void 0:$.depthStencilTexture),e.setRenderTarget(x))}let pt=R[Ie];pt===void 0&&(pt=new Vi,pt.layers.enable(Ie),pt.viewport=new gn,R[Ie]=pt),pt.matrix.fromArray(ft.transform.matrix),pt.matrix.decompose(pt.position,pt.quaternion,pt.scale),pt.projectionMatrix.fromArray(ft.projectionMatrix),pt.projectionMatrixInverse.copy(pt.projectionMatrix).invert(),pt.viewport.set(_t.x,_t.y,_t.width,_t.height),Ie===0&&(E.matrix.copy(pt.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),ce===!0&&E.cameras.push(pt)}const we=i.enabledFeatures;if(we&&we.includes("depth-sensing")){const Ie=h.getDepthInformation(fe[0]);Ie&&Ie.isValid&&Ie.texture&&_.init(e,Ie,i.renderState)}}for(let fe=0;fe<y.length;fe++){const ce=w[fe],we=y[fe];ce!==null&&we!==void 0&&we.update(ce,ee,c||s)}j&&j(K,ee),ee.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ee}),g=null}const B=new ZF;B.setAnimationLoop(X),this.setAnimationLoop=function(K){j=K},this.dispose=function(){}}}const Iu=new Bs,aQ=new dt;function lQ(n,e){function t(v,p){v.matrixAutoUpdate===!0&&v.updateMatrix(),p.value.copy(v.matrix)}function r(v,p){p.color.getRGB(v.fogColor.value,XF(n)),p.isFog?(v.fogNear.value=p.near,v.fogFar.value=p.far):p.isFogExp2&&(v.fogDensity.value=p.density)}function i(v,p,x,y,w){p.isMeshBasicMaterial||p.isMeshLambertMaterial?o(v,p):p.isMeshToonMaterial?(o(v,p),h(v,p)):p.isMeshPhongMaterial?(o(v,p),u(v,p)):p.isMeshStandardMaterial?(o(v,p),f(v,p),p.isMeshPhysicalMaterial&&m(v,p,w)):p.isMeshMatcapMaterial?(o(v,p),g(v,p)):p.isMeshDepthMaterial?o(v,p):p.isMeshDistanceMaterial?(o(v,p),_(v,p)):p.isMeshNormalMaterial?o(v,p):p.isLineBasicMaterial?(s(v,p),p.isLineDashedMaterial&&a(v,p)):p.isPointsMaterial?l(v,p,x,y):p.isSpriteMaterial?c(v,p):p.isShadowMaterial?(v.color.value.copy(p.color),v.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function o(v,p){v.opacity.value=p.opacity,p.color&&v.diffuse.value.copy(p.color),p.emissive&&v.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(v.map.value=p.map,t(p.map,v.mapTransform)),p.alphaMap&&(v.alphaMap.value=p.alphaMap,t(p.alphaMap,v.alphaMapTransform)),p.bumpMap&&(v.bumpMap.value=p.bumpMap,t(p.bumpMap,v.bumpMapTransform),v.bumpScale.value=p.bumpScale,p.side===Ki&&(v.bumpScale.value*=-1)),p.normalMap&&(v.normalMap.value=p.normalMap,t(p.normalMap,v.normalMapTransform),v.normalScale.value.copy(p.normalScale),p.side===Ki&&v.normalScale.value.negate()),p.displacementMap&&(v.displacementMap.value=p.displacementMap,t(p.displacementMap,v.displacementMapTransform),v.displacementScale.value=p.displacementScale,v.displacementBias.value=p.displacementBias),p.emissiveMap&&(v.emissiveMap.value=p.emissiveMap,t(p.emissiveMap,v.emissiveMapTransform)),p.specularMap&&(v.specularMap.value=p.specularMap,t(p.specularMap,v.specularMapTransform)),p.alphaTest>0&&(v.alphaTest.value=p.alphaTest);const x=e.get(p),y=x.envMap,w=x.envMapRotation;y&&(v.envMap.value=y,Iu.copy(w),Iu.x*=-1,Iu.y*=-1,Iu.z*=-1,y.isCubeTexture&&y.isRenderTargetTexture===!1&&(Iu.y*=-1,Iu.z*=-1),v.envMapRotation.value.setFromMatrix4(aQ.makeRotationFromEuler(Iu)),v.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=p.reflectivity,v.ior.value=p.ior,v.refractionRatio.value=p.refractionRatio),p.lightMap&&(v.lightMap.value=p.lightMap,v.lightMapIntensity.value=p.lightMapIntensity,t(p.lightMap,v.lightMapTransform)),p.aoMap&&(v.aoMap.value=p.aoMap,v.aoMapIntensity.value=p.aoMapIntensity,t(p.aoMap,v.aoMapTransform))}function s(v,p){v.diffuse.value.copy(p.color),v.opacity.value=p.opacity,p.map&&(v.map.value=p.map,t(p.map,v.mapTransform))}function a(v,p){v.dashSize.value=p.dashSize,v.totalSize.value=p.dashSize+p.gapSize,v.scale.value=p.scale}function l(v,p,x,y){v.diffuse.value.copy(p.color),v.opacity.value=p.opacity,v.size.value=p.size*x,v.scale.value=y*.5,p.map&&(v.map.value=p.map,t(p.map,v.uvTransform)),p.alphaMap&&(v.alphaMap.value=p.alphaMap,t(p.alphaMap,v.alphaMapTransform)),p.alphaTest>0&&(v.alphaTest.value=p.alphaTest)}function c(v,p){v.diffuse.value.copy(p.color),v.opacity.value=p.opacity,v.rotation.value=p.rotation,p.map&&(v.map.value=p.map,t(p.map,v.mapTransform)),p.alphaMap&&(v.alphaMap.value=p.alphaMap,t(p.alphaMap,v.alphaMapTransform)),p.alphaTest>0&&(v.alphaTest.value=p.alphaTest)}function u(v,p){v.specular.value.copy(p.specular),v.shininess.value=Math.max(p.shininess,1e-4)}function h(v,p){p.gradientMap&&(v.gradientMap.value=p.gradientMap)}function f(v,p){v.metalness.value=p.metalness,p.metalnessMap&&(v.metalnessMap.value=p.metalnessMap,t(p.metalnessMap,v.metalnessMapTransform)),v.roughness.value=p.roughness,p.roughnessMap&&(v.roughnessMap.value=p.roughnessMap,t(p.roughnessMap,v.roughnessMapTransform)),p.envMap&&(v.envMapIntensity.value=p.envMapIntensity)}function m(v,p,x){v.ior.value=p.ior,p.sheen>0&&(v.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),v.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(v.sheenColorMap.value=p.sheenColorMap,t(p.sheenColorMap,v.sheenColorMapTransform)),p.sheenRoughnessMap&&(v.sheenRoughnessMap.value=p.sheenRoughnessMap,t(p.sheenRoughnessMap,v.sheenRoughnessMapTransform))),p.clearcoat>0&&(v.clearcoat.value=p.clearcoat,v.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(v.clearcoatMap.value=p.clearcoatMap,t(p.clearcoatMap,v.clearcoatMapTransform)),p.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap,t(p.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),p.clearcoatNormalMap&&(v.clearcoatNormalMap.value=p.clearcoatNormalMap,t(p.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),p.side===Ki&&v.clearcoatNormalScale.value.negate())),p.dispersion>0&&(v.dispersion.value=p.dispersion),p.iridescence>0&&(v.iridescence.value=p.iridescence,v.iridescenceIOR.value=p.iridescenceIOR,v.iridescenceThicknessMinimum.value=p.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=p.iridescenceThicknessRange[1],p.iridescenceMap&&(v.iridescenceMap.value=p.iridescenceMap,t(p.iridescenceMap,v.iridescenceMapTransform)),p.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=p.iridescenceThicknessMap,t(p.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),p.transmission>0&&(v.transmission.value=p.transmission,v.transmissionSamplerMap.value=x.texture,v.transmissionSamplerSize.value.set(x.width,x.height),p.transmissionMap&&(v.transmissionMap.value=p.transmissionMap,t(p.transmissionMap,v.transmissionMapTransform)),v.thickness.value=p.thickness,p.thicknessMap&&(v.thicknessMap.value=p.thicknessMap,t(p.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=p.attenuationDistance,v.attenuationColor.value.copy(p.attenuationColor)),p.anisotropy>0&&(v.anisotropyVector.value.set(p.anisotropy*Math.cos(p.anisotropyRotation),p.anisotropy*Math.sin(p.anisotropyRotation)),p.anisotropyMap&&(v.anisotropyMap.value=p.anisotropyMap,t(p.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=p.specularIntensity,v.specularColor.value.copy(p.specularColor),p.specularColorMap&&(v.specularColorMap.value=p.specularColorMap,t(p.specularColorMap,v.specularColorMapTransform)),p.specularIntensityMap&&(v.specularIntensityMap.value=p.specularIntensityMap,t(p.specularIntensityMap,v.specularIntensityMapTransform))}function g(v,p){p.matcap&&(v.matcap.value=p.matcap)}function _(v,p){const x=e.get(p).light;v.referencePosition.value.setFromMatrixPosition(x.matrixWorld),v.nearDistance.value=x.shadow.camera.near,v.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function cQ(n,e,t,r){let i={},o={},s=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(x,y){const w=y.program;r.uniformBlockBinding(x,w)}function c(x,y){let w=i[x.id];w===void 0&&(g(x),w=u(x),i[x.id]=w,x.addEventListener("dispose",v));const C=y.program;r.updateUBOMapping(x,C);const T=e.render.frame;o[x.id]!==T&&(f(x),o[x.id]=T)}function u(x){const y=h();x.__bindingPointIndex=y;const w=n.createBuffer(),C=x.__size,T=x.usage;return n.bindBuffer(n.UNIFORM_BUFFER,w),n.bufferData(n.UNIFORM_BUFFER,C,T),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,y,w),w}function h(){for(let x=0;x<a;x++)if(s.indexOf(x)===-1)return s.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(x){const y=i[x.id],w=x.uniforms,C=x.__cache;n.bindBuffer(n.UNIFORM_BUFFER,y);for(let T=0,S=w.length;T<S;T++){const b=Array.isArray(w[T])?w[T]:[w[T]];for(let R=0,E=b.length;R<E;R++){const A=b[R];if(m(A,T,R,C)===!0){const F=A.__offset,D=Array.isArray(A.value)?A.value:[A.value];let M=0;for(let k=0;k<D.length;k++){const z=D[k],P=_(z);typeof z=="number"||typeof z=="boolean"?(A.__data[0]=z,n.bufferSubData(n.UNIFORM_BUFFER,F+M,A.__data)):z.isMatrix3?(A.__data[0]=z.elements[0],A.__data[1]=z.elements[1],A.__data[2]=z.elements[2],A.__data[3]=0,A.__data[4]=z.elements[3],A.__data[5]=z.elements[4],A.__data[6]=z.elements[5],A.__data[7]=0,A.__data[8]=z.elements[6],A.__data[9]=z.elements[7],A.__data[10]=z.elements[8],A.__data[11]=0):(z.toArray(A.__data,M),M+=P.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,F,A.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function m(x,y,w,C){const T=x.value,S=y+"_"+w;if(C[S]===void 0)return typeof T=="number"||typeof T=="boolean"?C[S]=T:C[S]=T.clone(),!0;{const b=C[S];if(typeof T=="number"||typeof T=="boolean"){if(b!==T)return C[S]=T,!0}else if(b.equals(T)===!1)return b.copy(T),!0}return!1}function g(x){const y=x.uniforms;let w=0;const C=16;for(let S=0,b=y.length;S<b;S++){const R=Array.isArray(y[S])?y[S]:[y[S]];for(let E=0,A=R.length;E<A;E++){const F=R[E],D=Array.isArray(F.value)?F.value:[F.value];for(let M=0,k=D.length;M<k;M++){const z=D[M],P=_(z),U=w%C,Y=U%P.boundary,Z=U+Y;w+=Y,Z!==0&&C-Z<P.storage&&(w+=C-Z),F.__data=new Float32Array(P.storage/Float32Array.BYTES_PER_ELEMENT),F.__offset=w,w+=P.storage}}}const T=w%C;return T>0&&(w+=C-T),x.__size=w,x.__cache={},this}function _(x){const y={boundary:0,storage:0};return typeof x=="number"||typeof x=="boolean"?(y.boundary=4,y.storage=4):x.isVector2?(y.boundary=8,y.storage=8):x.isVector3||x.isColor?(y.boundary=16,y.storage=12):x.isVector4?(y.boundary=16,y.storage=16):x.isMatrix3?(y.boundary=48,y.storage=48):x.isMatrix4?(y.boundary=64,y.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),y}function v(x){const y=x.target;y.removeEventListener("dispose",v);const w=s.indexOf(y.__bindingPointIndex);s.splice(w,1),n.deleteBuffer(i[y.id]),delete i[y.id],delete o[y.id]}function p(){for(const x in i)n.deleteBuffer(i[x]);s=[],i={},o={}}return{bind:l,update:c,dispose:p}}class NA{constructor(e={}){const{canvas:t=ZW(),context:r=null,depth:i=!0,stencil:o=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;this.isWebGLRenderer=!0;let f;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=r.getContextAttributes().alpha}else f=s;const m=new Uint32Array(4),g=new Int32Array(4);let _=null,v=null;const p=[],x=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=$o,this.toneMapping=zc,this.toneMappingExposure=1;const y=this;let w=!1,C=0,T=0,S=null,b=-1,R=null;const E=new gn,A=new gn;let F=null;const D=new rt(0);let M=0,k=t.width,z=t.height,P=1,U=null,Y=null;const Z=new gn(0,0,k,z),j=new gn(0,0,k,z);let X=!1;const B=new nI;let K=!1,ee=!1;const fe=new dt,ce=new dt,we=new N,Ie=new gn,ft={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let _t=!1;function pt(){return S===null?P:1}let $=r;function ot(H,re){return t.getContext(H,re)}try{const H={alpha:!0,depth:i,stencil:o,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${AE}`),t.addEventListener("webglcontextlost",ie,!1),t.addEventListener("webglcontextrestored",ye,!1),t.addEventListener("webglcontextcreationerror",xe,!1),$===null){const re="webgl2";if($=ot(re,H),$===null)throw ot(re)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(H){throw console.error("THREE.WebGLRenderer: "+H.message),H}let se,Ee,Te,Le,be,G,I,V,q,ne,Q,he,me,_e,ze,pe,Ce,je,Qe,He,St,st,qt,L;function te(){se=new mX($),se.init(),st=new eQ($,se),Ee=new cX($,se,e,st),Te=new Qq($),Ee.reverseDepthBuffer&&Te.buffers.depth.setReversed(!0),Le=new _X($),be=new Dq,G=new Jq($,se,Te,be,Ee,st,Le),I=new dX(y),V=new pX(y),q=new C$($),qt=new aX($,q),ne=new gX($,q,Le,qt),Q=new yX($,ne,q,Le),Qe=new xX($,Ee,G),pe=new uX(be),he=new Oq(y,I,V,se,Ee,qt,pe),me=new lQ(y,be),_e=new Fq,ze=new Gq(se),je=new sX(y,I,V,Te,Q,f,l),Ce=new Xq(y,Q,Ee),L=new cQ($,Le,Ee,Te),He=new lX($,se,Le),St=new vX($,se,Le),Le.programs=he.programs,y.capabilities=Ee,y.extensions=se,y.properties=be,y.renderLists=_e,y.shadowMap=Ce,y.state=Te,y.info=Le}te();const J=new sQ(y,$);this.xr=J,this.getContext=function(){return $},this.getContextAttributes=function(){return $.getContextAttributes()},this.forceContextLoss=function(){const H=se.get("WEBGL_lose_context");H&&H.loseContext()},this.forceContextRestore=function(){const H=se.get("WEBGL_lose_context");H&&H.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(H){H!==void 0&&(P=H,this.setSize(k,z,!1))},this.getSize=function(H){return H.set(k,z)},this.setSize=function(H,re,ue=!0){if(J.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}k=H,z=re,t.width=Math.floor(H*P),t.height=Math.floor(re*P),ue===!0&&(t.style.width=H+"px",t.style.height=re+"px"),this.setViewport(0,0,H,re)},this.getDrawingBufferSize=function(H){return H.set(k*P,z*P).floor()},this.setDrawingBufferSize=function(H,re,ue){k=H,z=re,P=ue,t.width=Math.floor(H*ue),t.height=Math.floor(re*ue),this.setViewport(0,0,H,re)},this.getCurrentViewport=function(H){return H.copy(E)},this.getViewport=function(H){return H.copy(Z)},this.setViewport=function(H,re,ue,de){H.isVector4?Z.set(H.x,H.y,H.z,H.w):Z.set(H,re,ue,de),Te.viewport(E.copy(Z).multiplyScalar(P).round())},this.getScissor=function(H){return H.copy(j)},this.setScissor=function(H,re,ue,de){H.isVector4?j.set(H.x,H.y,H.z,H.w):j.set(H,re,ue,de),Te.scissor(A.copy(j).multiplyScalar(P).round())},this.getScissorTest=function(){return X},this.setScissorTest=function(H){Te.setScissorTest(X=H)},this.setOpaqueSort=function(H){U=H},this.setTransparentSort=function(H){Y=H},this.getClearColor=function(H){return H.copy(je.getClearColor())},this.setClearColor=function(){je.setClearColor.apply(je,arguments)},this.getClearAlpha=function(){return je.getClearAlpha()},this.setClearAlpha=function(){je.setClearAlpha.apply(je,arguments)},this.clear=function(H=!0,re=!0,ue=!0){let de=0;if(H){let oe=!1;if(S!==null){const Oe=S.texture.format;oe=Oe===qN||Oe===XN||Oe===KN}if(oe){const Oe=S.texture.type,Ke=Oe===Al||Oe===Yd||Oe===rv||Oe===tm||Oe===$N||Oe===YN,et=je.getClearColor(),tt=je.getClearAlpha(),xt=et.r,Tt=et.g,at=et.b;Ke?(m[0]=xt,m[1]=Tt,m[2]=at,m[3]=tt,$.clearBufferuiv($.COLOR,0,m)):(g[0]=xt,g[1]=Tt,g[2]=at,g[3]=tt,$.clearBufferiv($.COLOR,0,g))}else de|=$.COLOR_BUFFER_BIT}re&&(de|=$.DEPTH_BUFFER_BIT,$.clearDepth(this.capabilities.reverseDepthBuffer?0:1)),ue&&(de|=$.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),$.clear(de)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ie,!1),t.removeEventListener("webglcontextrestored",ye,!1),t.removeEventListener("webglcontextcreationerror",xe,!1),_e.dispose(),ze.dispose(),be.dispose(),I.dispose(),V.dispose(),Q.dispose(),qt.dispose(),L.dispose(),he.dispose(),J.dispose(),J.removeEventListener("sessionstart",eg),J.removeEventListener("sessionend",b_),qs.stop()};function ie(H){H.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const H=Le.autoReset,re=Ce.enabled,ue=Ce.autoUpdate,de=Ce.needsUpdate,oe=Ce.type;te(),Le.autoReset=H,Ce.enabled=re,Ce.autoUpdate=ue,Ce.needsUpdate=de,Ce.type=oe}function xe(H){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",H.statusMessage)}function $e(H){const re=H.target;re.removeEventListener("dispose",$e),Et(re)}function Et(H){En(H),be.remove(H)}function En(H){const re=be.get(H).programs;re!==void 0&&(re.forEach(function(ue){he.releaseProgram(ue)}),H.isShaderMaterial&&he.releaseShaderCache(H))}this.renderBufferDirect=function(H,re,ue,de,oe,Oe){re===null&&(re=ft);const Ke=oe.isMesh&&oe.matrixWorld.determinant()<0,et=YV(H,re,ue,de,oe);Te.setMaterial(de,Ke);let tt=ue.index,xt=1;if(de.wireframe===!0){if(tt=ne.getWireframeAttribute(ue),tt===void 0)return;xt=2}const Tt=ue.drawRange,at=ue.attributes.position;let dn=Tt.start*xt,Pn=(Tt.start+Tt.count)*xt;Oe!==null&&(dn=Math.max(dn,Oe.start*xt),Pn=Math.min(Pn,(Oe.start+Oe.count)*xt)),tt!==null?(dn=Math.max(dn,0),Pn=Math.min(Pn,tt.count)):at!=null&&(dn=Math.max(dn,0),Pn=Math.min(Pn,at.count));const sr=Pn-dn;if(sr<0||sr===1/0)return;qt.setup(oe,de,et,ue,tt);let to,ln=He;if(tt!==null&&(to=q.get(tt),ln=St,ln.setIndex(to)),oe.isMesh)de.wireframe===!0?(Te.setLineWidth(de.wireframeLinewidth*pt()),ln.setMode($.LINES)):ln.setMode($.TRIANGLES);else if(oe.isLine){let lt=de.linewidth;lt===void 0&&(lt=1),Te.setLineWidth(lt*pt()),oe.isLineSegments?ln.setMode($.LINES):oe.isLineLoop?ln.setMode($.LINE_LOOP):ln.setMode($.LINE_STRIP)}else oe.isPoints?ln.setMode($.POINTS):oe.isSprite&&ln.setMode($.TRIANGLES);if(oe.isBatchedMesh)if(oe._multiDrawInstances!==null)ln.renderMultiDrawInstances(oe._multiDrawStarts,oe._multiDrawCounts,oe._multiDrawCount,oe._multiDrawInstances);else if(se.get("WEBGL_multi_draw"))ln.renderMultiDraw(oe._multiDrawStarts,oe._multiDrawCounts,oe._multiDrawCount);else{const lt=oe._multiDrawStarts,Wr=oe._multiDrawCounts,cn=oe._multiDrawCount,fs=tt?q.get(tt).bytesPerElement:1,Ph=be.get(de).currentProgram.getUniforms();for(let no=0;no<cn;no++)Ph.setValue($,"_gl_DrawID",no),ln.render(lt[no]/fs,Wr[no])}else if(oe.isInstancedMesh)ln.renderInstances(dn,sr,oe.count);else if(ue.isInstancedBufferGeometry){const lt=ue._maxInstanceCount!==void 0?ue._maxInstanceCount:1/0,Wr=Math.min(ue.instanceCount,lt);ln.renderInstances(dn,sr,Wr)}else ln.render(dn,sr)};function Ge(H,re,ue){H.transparent===!0&&H.side===vi&&H.forceSinglePass===!1?(H.side=Ki,H.needsUpdate=!0,Kl(H,re,ue),H.side=bl,H.needsUpdate=!0,Kl(H,re,ue),H.side=vi):Kl(H,re,ue)}this.compile=function(H,re,ue=null){ue===null&&(ue=H),v=ze.get(ue),v.init(re),x.push(v),ue.traverseVisible(function(oe){oe.isLight&&oe.layers.test(re.layers)&&(v.pushLight(oe),oe.castShadow&&v.pushShadow(oe))}),H!==ue&&H.traverseVisible(function(oe){oe.isLight&&oe.layers.test(re.layers)&&(v.pushLight(oe),oe.castShadow&&v.pushShadow(oe))}),v.setupLights();const de=new Set;return H.traverse(function(oe){if(!(oe.isMesh||oe.isPoints||oe.isLine||oe.isSprite))return;const Oe=oe.material;if(Oe)if(Array.isArray(Oe))for(let Ke=0;Ke<Oe.length;Ke++){const et=Oe[Ke];Ge(et,ue,oe),de.add(et)}else Ge(Oe,ue,oe),de.add(Oe)}),x.pop(),v=null,de},this.compileAsync=function(H,re,ue=null){const de=this.compile(H,re,ue);return new Promise(oe=>{function Oe(){if(de.forEach(function(Ke){be.get(Ke).currentProgram.isReady()&&de.delete(Ke)}),de.size===0){oe(H);return}setTimeout(Oe,10)}se.get("KHR_parallel_shader_compile")!==null?Oe():setTimeout(Oe,10)})};let Or=null;function ti(H){Or&&Or(H)}function eg(){qs.stop()}function b_(){qs.start()}const qs=new ZF;qs.setAnimationLoop(ti),typeof self<"u"&&qs.setContext(self),this.setAnimationLoop=function(H){Or=H,J.setAnimationLoop(H),H===null?qs.stop():qs.start()},J.addEventListener("sessionstart",eg),J.addEventListener("sessionend",b_),this.render=function(H,re){if(re!==void 0&&re.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(w===!0)return;if(H.matrixWorldAutoUpdate===!0&&H.updateMatrixWorld(),re.parent===null&&re.matrixWorldAutoUpdate===!0&&re.updateMatrixWorld(),J.enabled===!0&&J.isPresenting===!0&&(J.cameraAutoUpdate===!0&&J.updateCamera(re),re=J.getCamera()),H.isScene===!0&&H.onBeforeRender(y,H,re,S),v=ze.get(H,x.length),v.init(re),x.push(v),ce.multiplyMatrices(re.projectionMatrix,re.matrixWorldInverse),B.setFromProjectionMatrix(ce),ee=this.localClippingEnabled,K=pe.init(this.clippingPlanes,ee),_=_e.get(H,p.length),_.init(),p.push(_),J.enabled===!0&&J.isPresenting===!0){const Oe=y.xr.getDepthSensingMesh();Oe!==null&&$l(Oe,re,-1/0,y.sortObjects)}$l(H,re,0,y.sortObjects),_.finish(),y.sortObjects===!0&&_.sort(U,Y),_t=J.enabled===!1||J.isPresenting===!1||J.hasDepthSensing()===!1,_t&&je.addToRenderList(_,H),this.info.render.frame++,K===!0&&pe.beginShadows();const ue=v.state.shadowsArray;Ce.render(ue,H,re),K===!0&&pe.endShadows(),this.info.autoReset===!0&&this.info.reset();const de=_.opaque,oe=_.transmissive;if(v.setupLights(),re.isArrayCamera){const Oe=re.cameras;if(oe.length>0)for(let Ke=0,et=Oe.length;Ke<et;Ke++){const tt=Oe[Ke];Yl(de,oe,H,tt)}_t&&je.render(H);for(let Ke=0,et=Oe.length;Ke<et;Ke++){const tt=Oe[Ke];Cu(_,H,tt,tt.viewport)}}else oe.length>0&&Yl(de,oe,H,re),_t&&je.render(H),Cu(_,H,re);S!==null&&(G.updateMultisampleRenderTarget(S),G.updateRenderTargetMipmap(S)),H.isScene===!0&&H.onAfterRender(y,H,re),qt.resetDefaultState(),b=-1,R=null,x.pop(),x.length>0?(v=x[x.length-1],K===!0&&pe.setGlobalState(y.clippingPlanes,v.state.camera)):v=null,p.pop(),p.length>0?_=p[p.length-1]:_=null};function $l(H,re,ue,de){if(H.visible===!1)return;if(H.layers.test(re.layers)){if(H.isGroup)ue=H.renderOrder;else if(H.isLOD)H.autoUpdate===!0&&H.update(re);else if(H.isLight)v.pushLight(H),H.castShadow&&v.pushShadow(H);else if(H.isSprite){if(!H.frustumCulled||B.intersectsSprite(H)){de&&Ie.setFromMatrixPosition(H.matrixWorld).applyMatrix4(ce);const Ke=Q.update(H),et=H.material;et.visible&&_.push(H,Ke,et,ue,Ie.z,null)}}else if((H.isMesh||H.isLine||H.isPoints)&&(!H.frustumCulled||B.intersectsObject(H))){const Ke=Q.update(H),et=H.material;if(de&&(H.boundingSphere!==void 0?(H.boundingSphere===null&&H.computeBoundingSphere(),Ie.copy(H.boundingSphere.center)):(Ke.boundingSphere===null&&Ke.computeBoundingSphere(),Ie.copy(Ke.boundingSphere.center)),Ie.applyMatrix4(H.matrixWorld).applyMatrix4(ce)),Array.isArray(et)){const tt=Ke.groups;for(let xt=0,Tt=tt.length;xt<Tt;xt++){const at=tt[xt],dn=et[at.materialIndex];dn&&dn.visible&&_.push(H,Ke,dn,ue,Ie.z,at)}}else et.visible&&_.push(H,Ke,et,ue,Ie.z,null)}}const Oe=H.children;for(let Ke=0,et=Oe.length;Ke<et;Ke++)$l(Oe[Ke],re,ue,de)}function Cu(H,re,ue,de){const oe=H.opaque,Oe=H.transmissive,Ke=H.transparent;v.setupLightsView(ue),K===!0&&pe.setGlobalState(y.clippingPlanes,ue),de&&Te.viewport(E.copy(de)),oe.length>0&&Nh(oe,re,ue),Oe.length>0&&Nh(Oe,re,ue),Ke.length>0&&Nh(Ke,re,ue),Te.buffers.depth.setTest(!0),Te.buffers.depth.setMask(!0),Te.buffers.color.setMask(!0),Te.setPolygonOffset(!1)}function Yl(H,re,ue,de){if((ue.isScene===!0?ue.overrideMaterial:null)!==null)return;v.state.transmissionRenderTarget[de.id]===void 0&&(v.state.transmissionRenderTarget[de.id]=new is(1,1,{generateMipmaps:!0,type:se.has("EXT_color_buffer_half_float")||se.has("EXT_color_buffer_float")?Ml:Al,minFilter:Lc,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:sn.workingColorSpace}));const Oe=v.state.transmissionRenderTarget[de.id],Ke=de.viewport||E;Oe.setSize(Ke.z,Ke.w);const et=y.getRenderTarget();y.setRenderTarget(Oe),y.getClearColor(D),M=y.getClearAlpha(),M<1&&y.setClearColor(16777215,.5),y.clear(),_t&&je.render(ue);const tt=y.toneMapping;y.toneMapping=zc;const xt=de.viewport;if(de.viewport!==void 0&&(de.viewport=void 0),v.setupLightsView(de),K===!0&&pe.setGlobalState(y.clippingPlanes,de),Nh(H,ue,de),G.updateMultisampleRenderTarget(Oe),G.updateRenderTargetMipmap(Oe),se.has("WEBGL_multisampled_render_to_texture")===!1){let Tt=!1;for(let at=0,dn=re.length;at<dn;at++){const Pn=re[at],sr=Pn.object,to=Pn.geometry,ln=Pn.material,lt=Pn.group;if(ln.side===vi&&sr.layers.test(de.layers)){const Wr=ln.side;ln.side=Ki,ln.needsUpdate=!0,Ih(sr,ue,de,to,ln,lt),ln.side=Wr,ln.needsUpdate=!0,Tt=!0}}Tt===!0&&(G.updateMultisampleRenderTarget(Oe),G.updateRenderTargetMipmap(Oe))}y.setRenderTarget(et),y.setClearColor(D,M),xt!==void 0&&(de.viewport=xt),y.toneMapping=tt}function Nh(H,re,ue){const de=re.isScene===!0?re.overrideMaterial:null;for(let oe=0,Oe=H.length;oe<Oe;oe++){const Ke=H[oe],et=Ke.object,tt=Ke.geometry,xt=de===null?Ke.material:de,Tt=Ke.group;et.layers.test(ue.layers)&&Ih(et,re,ue,tt,xt,Tt)}}function Ih(H,re,ue,de,oe,Oe){H.onBeforeRender(y,re,ue,de,oe,Oe),H.modelViewMatrix.multiplyMatrices(ue.matrixWorldInverse,H.matrixWorld),H.normalMatrix.getNormalMatrix(H.modelViewMatrix),oe.onBeforeRender(y,re,ue,de,H,Oe),oe.transparent===!0&&oe.side===vi&&oe.forceSinglePass===!1?(oe.side=Ki,oe.needsUpdate=!0,y.renderBufferDirect(ue,re,de,oe,H,Oe),oe.side=bl,oe.needsUpdate=!0,y.renderBufferDirect(ue,re,de,oe,H,Oe),oe.side=vi):y.renderBufferDirect(ue,re,de,oe,H,Oe),H.onAfterRender(y,re,ue,de,oe,Oe)}function Kl(H,re,ue){re.isScene!==!0&&(re=ft);const de=be.get(H),oe=v.state.lights,Oe=v.state.shadowsArray,Ke=oe.state.version,et=he.getParameters(H,oe.state,Oe,re,ue),tt=he.getProgramCacheKey(et);let xt=de.programs;de.environment=H.isMeshStandardMaterial?re.environment:null,de.fog=re.fog,de.envMap=(H.isMeshStandardMaterial?V:I).get(H.envMap||de.environment),de.envMapRotation=de.environment!==null&&H.envMap===null?re.environmentRotation:H.envMapRotation,xt===void 0&&(H.addEventListener("dispose",$e),xt=new Map,de.programs=xt);let Tt=xt.get(tt);if(Tt!==void 0){if(de.currentProgram===Tt&&de.lightsStateVersion===Ke)return Qs(H,et),Tt}else et.uniforms=he.getUniforms(H),H.onBeforeCompile(et,y),Tt=he.acquireProgram(et,tt),xt.set(tt,Tt),de.uniforms=et.uniforms;const at=de.uniforms;return(!H.isShaderMaterial&&!H.isRawShaderMaterial||H.clipping===!0)&&(at.clippingPlanes=pe.uniform),Qs(H,et),de.needsLights=XV(H),de.lightsStateVersion=Ke,de.needsLights&&(at.ambientLightColor.value=oe.state.ambient,at.lightProbe.value=oe.state.probe,at.directionalLights.value=oe.state.directional,at.directionalLightShadows.value=oe.state.directionalShadow,at.spotLights.value=oe.state.spot,at.spotLightShadows.value=oe.state.spotShadow,at.rectAreaLights.value=oe.state.rectArea,at.ltc_1.value=oe.state.rectAreaLTC1,at.ltc_2.value=oe.state.rectAreaLTC2,at.pointLights.value=oe.state.point,at.pointLightShadows.value=oe.state.pointShadow,at.hemisphereLights.value=oe.state.hemi,at.directionalShadowMap.value=oe.state.directionalShadowMap,at.directionalShadowMatrix.value=oe.state.directionalShadowMatrix,at.spotShadowMap.value=oe.state.spotShadowMap,at.spotLightMatrix.value=oe.state.spotLightMatrix,at.spotLightMap.value=oe.state.spotLightMap,at.pointShadowMap.value=oe.state.pointShadowMap,at.pointShadowMatrix.value=oe.state.pointShadowMatrix),de.currentProgram=Tt,de.uniformsList=null,Tt}function gr(H){if(H.uniformsList===null){const re=H.currentProgram.getUniforms();H.uniformsList=Ty.seqWithValue(re.seq,H.uniforms)}return H.uniformsList}function Qs(H,re){const ue=be.get(H);ue.outputColorSpace=re.outputColorSpace,ue.batching=re.batching,ue.batchingColor=re.batchingColor,ue.instancing=re.instancing,ue.instancingColor=re.instancingColor,ue.instancingMorph=re.instancingMorph,ue.skinning=re.skinning,ue.morphTargets=re.morphTargets,ue.morphNormals=re.morphNormals,ue.morphColors=re.morphColors,ue.morphTargetsCount=re.morphTargetsCount,ue.numClippingPlanes=re.numClippingPlanes,ue.numIntersection=re.numClipIntersection,ue.vertexAlphas=re.vertexAlphas,ue.vertexTangents=re.vertexTangents,ue.toneMapping=re.toneMapping}function YV(H,re,ue,de,oe){re.isScene!==!0&&(re=ft),G.resetTextureUnits();const Oe=re.fog,Ke=de.isMeshStandardMaterial?re.environment:null,et=S===null?y.outputColorSpace:S.isXRRenderTarget===!0?S.texture.colorSpace:Hl,tt=(de.isMeshStandardMaterial?V:I).get(de.envMap||Ke),xt=de.vertexColors===!0&&!!ue.attributes.color&&ue.attributes.color.itemSize===4,Tt=!!ue.attributes.tangent&&(!!de.normalMap||de.anisotropy>0),at=!!ue.morphAttributes.position,dn=!!ue.morphAttributes.normal,Pn=!!ue.morphAttributes.color;let sr=zc;de.toneMapped&&(S===null||S.isXRRenderTarget===!0)&&(sr=y.toneMapping);const to=ue.morphAttributes.position||ue.morphAttributes.normal||ue.morphAttributes.color,ln=to!==void 0?to.length:0,lt=be.get(de),Wr=v.state.lights;if(K===!0&&(ee===!0||H!==R)){const Fo=H===R&&de.id===b;pe.setState(de,H,Fo)}let cn=!1;de.version===lt.__version?(lt.needsLights&&lt.lightsStateVersion!==Wr.state.version||lt.outputColorSpace!==et||oe.isBatchedMesh&&lt.batching===!1||!oe.isBatchedMesh&&lt.batching===!0||oe.isBatchedMesh&&lt.batchingColor===!0&&oe.colorTexture===null||oe.isBatchedMesh&&lt.batchingColor===!1&&oe.colorTexture!==null||oe.isInstancedMesh&&lt.instancing===!1||!oe.isInstancedMesh&&lt.instancing===!0||oe.isSkinnedMesh&&lt.skinning===!1||!oe.isSkinnedMesh&&lt.skinning===!0||oe.isInstancedMesh&&lt.instancingColor===!0&&oe.instanceColor===null||oe.isInstancedMesh&&lt.instancingColor===!1&&oe.instanceColor!==null||oe.isInstancedMesh&&lt.instancingMorph===!0&&oe.morphTexture===null||oe.isInstancedMesh&&lt.instancingMorph===!1&&oe.morphTexture!==null||lt.envMap!==tt||de.fog===!0&&lt.fog!==Oe||lt.numClippingPlanes!==void 0&&(lt.numClippingPlanes!==pe.numPlanes||lt.numIntersection!==pe.numIntersection)||lt.vertexAlphas!==xt||lt.vertexTangents!==Tt||lt.morphTargets!==at||lt.morphNormals!==dn||lt.morphColors!==Pn||lt.toneMapping!==sr||lt.morphTargetsCount!==ln)&&(cn=!0):(cn=!0,lt.__version=de.version);let fs=lt.currentProgram;cn===!0&&(fs=Kl(de,re,oe));let Ph=!1,no=!1,Q1=!1;const cr=fs.getUniforms(),Xl=lt.uniforms;if(Te.useProgram(fs.program)&&(Ph=!0,no=!0,Q1=!0),de.id!==b&&(b=de.id,no=!0),Ph||R!==H){Ee.reverseDepthBuffer?(fe.copy(H.projectionMatrix),e$(fe),t$(fe),cr.setValue($,"projectionMatrix",fe)):cr.setValue($,"projectionMatrix",H.projectionMatrix),cr.setValue($,"viewMatrix",H.matrixWorldInverse);const Fo=cr.map.cameraPosition;Fo!==void 0&&Fo.setValue($,we.setFromMatrixPosition(H.matrixWorld)),Ee.logarithmicDepthBuffer&&cr.setValue($,"logDepthBufFC",2/(Math.log(H.far+1)/Math.LN2)),(de.isMeshPhongMaterial||de.isMeshToonMaterial||de.isMeshLambertMaterial||de.isMeshBasicMaterial||de.isMeshStandardMaterial||de.isShaderMaterial)&&cr.setValue($,"isOrthographic",H.isOrthographicCamera===!0),R!==H&&(R=H,no=!0,Q1=!0)}if(oe.isSkinnedMesh){cr.setOptional($,oe,"bindMatrix"),cr.setOptional($,oe,"bindMatrixInverse");const Fo=oe.skeleton;Fo&&(Fo.boneTexture===null&&Fo.computeBoneTexture(),cr.setValue($,"boneTexture",Fo.boneTexture,G))}oe.isBatchedMesh&&(cr.setOptional($,oe,"batchingTexture"),cr.setValue($,"batchingTexture",oe._matricesTexture,G),cr.setOptional($,oe,"batchingIdTexture"),cr.setValue($,"batchingIdTexture",oe._indirectTexture,G),cr.setOptional($,oe,"batchingColorTexture"),oe._colorsTexture!==null&&cr.setValue($,"batchingColorTexture",oe._colorsTexture,G));const Z1=ue.morphAttributes;if((Z1.position!==void 0||Z1.normal!==void 0||Z1.color!==void 0)&&Qe.update(oe,ue,fs),(no||lt.receiveShadow!==oe.receiveShadow)&&(lt.receiveShadow=oe.receiveShadow,cr.setValue($,"receiveShadow",oe.receiveShadow)),de.isMeshGouraudMaterial&&de.envMap!==null&&(Xl.envMap.value=tt,Xl.flipEnvMap.value=tt.isCubeTexture&&tt.isRenderTargetTexture===!1?-1:1),de.isMeshStandardMaterial&&de.envMap===null&&re.environment!==null&&(Xl.envMapIntensity.value=re.environmentIntensity),no&&(cr.setValue($,"toneMappingExposure",y.toneMappingExposure),lt.needsLights&&KV(Xl,Q1),Oe&&de.fog===!0&&me.refreshFogUniforms(Xl,Oe),me.refreshMaterialUniforms(Xl,de,P,z,v.state.transmissionRenderTarget[H.id]),Ty.upload($,gr(lt),Xl,G)),de.isShaderMaterial&&de.uniformsNeedUpdate===!0&&(Ty.upload($,gr(lt),Xl,G),de.uniformsNeedUpdate=!1),de.isSpriteMaterial&&cr.setValue($,"center",oe.center),cr.setValue($,"modelViewMatrix",oe.modelViewMatrix),cr.setValue($,"normalMatrix",oe.normalMatrix),cr.setValue($,"modelMatrix",oe.matrixWorld),de.isShaderMaterial||de.isRawShaderMaterial){const Fo=de.uniformsGroups;for(let J1=0,qV=Fo.length;J1<qV;J1++){const mL=Fo[J1];L.update(mL,fs),L.bind(mL,fs)}}return fs}function KV(H,re){H.ambientLightColor.needsUpdate=re,H.lightProbe.needsUpdate=re,H.directionalLights.needsUpdate=re,H.directionalLightShadows.needsUpdate=re,H.pointLights.needsUpdate=re,H.pointLightShadows.needsUpdate=re,H.spotLights.needsUpdate=re,H.spotLightShadows.needsUpdate=re,H.rectAreaLights.needsUpdate=re,H.hemisphereLights.needsUpdate=re}function XV(H){return H.isMeshLambertMaterial||H.isMeshToonMaterial||H.isMeshPhongMaterial||H.isMeshStandardMaterial||H.isShadowMaterial||H.isShaderMaterial&&H.lights===!0}this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(H,re,ue){be.get(H.texture).__webglTexture=re,be.get(H.depthTexture).__webglTexture=ue;const de=be.get(H);de.__hasExternalTextures=!0,de.__autoAllocateDepthBuffer=ue===void 0,de.__autoAllocateDepthBuffer||se.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),de.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(H,re){const ue=be.get(H);ue.__webglFramebuffer=re,ue.__useDefaultFramebuffer=re===void 0},this.setRenderTarget=function(H,re=0,ue=0){S=H,C=re,T=ue;let de=!0,oe=null,Oe=!1,Ke=!1;if(H){const tt=be.get(H);if(tt.__useDefaultFramebuffer!==void 0)Te.bindFramebuffer($.FRAMEBUFFER,null),de=!1;else if(tt.__webglFramebuffer===void 0)G.setupRenderTarget(H);else if(tt.__hasExternalTextures)G.rebindTextures(H,be.get(H.texture).__webglTexture,be.get(H.depthTexture).__webglTexture);else if(H.depthBuffer){const at=H.depthTexture;if(tt.__boundDepthTexture!==at){if(at!==null&&be.has(at)&&(H.width!==at.image.width||H.height!==at.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");G.setupDepthRenderbuffer(H)}}const xt=H.texture;(xt.isData3DTexture||xt.isDataArrayTexture||xt.isCompressedArrayTexture)&&(Ke=!0);const Tt=be.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget?(Array.isArray(Tt[re])?oe=Tt[re][ue]:oe=Tt[re],Oe=!0):H.samples>0&&G.useMultisampledRTT(H)===!1?oe=be.get(H).__webglMultisampledFramebuffer:Array.isArray(Tt)?oe=Tt[ue]:oe=Tt,E.copy(H.viewport),A.copy(H.scissor),F=H.scissorTest}else E.copy(Z).multiplyScalar(P).floor(),A.copy(j).multiplyScalar(P).floor(),F=X;if(Te.bindFramebuffer($.FRAMEBUFFER,oe)&&de&&Te.drawBuffers(H,oe),Te.viewport(E),Te.scissor(A),Te.setScissorTest(F),Oe){const tt=be.get(H.texture);$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_CUBE_MAP_POSITIVE_X+re,tt.__webglTexture,ue)}else if(Ke){const tt=be.get(H.texture),xt=re||0;$.framebufferTextureLayer($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,tt.__webglTexture,ue||0,xt)}b=-1},this.readRenderTargetPixels=function(H,re,ue,de,oe,Oe,Ke){if(!(H&&H.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let et=be.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&Ke!==void 0&&(et=et[Ke]),et){Te.bindFramebuffer($.FRAMEBUFFER,et);try{const tt=H.texture,xt=tt.format,Tt=tt.type;if(!Ee.textureFormatReadable(xt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ee.textureTypeReadable(Tt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}re>=0&&re<=H.width-de&&ue>=0&&ue<=H.height-oe&&$.readPixels(re,ue,de,oe,st.convert(xt),st.convert(Tt),Oe)}finally{const tt=S!==null?be.get(S).__webglFramebuffer:null;Te.bindFramebuffer($.FRAMEBUFFER,tt)}}},this.readRenderTargetPixelsAsync=async function(H,re,ue,de,oe,Oe,Ke){if(!(H&&H.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let et=be.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&Ke!==void 0&&(et=et[Ke]),et){const tt=H.texture,xt=tt.format,Tt=tt.type;if(!Ee.textureFormatReadable(xt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ee.textureTypeReadable(Tt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(re>=0&&re<=H.width-de&&ue>=0&&ue<=H.height-oe){Te.bindFramebuffer($.FRAMEBUFFER,et);const at=$.createBuffer();$.bindBuffer($.PIXEL_PACK_BUFFER,at),$.bufferData($.PIXEL_PACK_BUFFER,Oe.byteLength,$.STREAM_READ),$.readPixels(re,ue,de,oe,st.convert(xt),st.convert(Tt),0);const dn=S!==null?be.get(S).__webglFramebuffer:null;Te.bindFramebuffer($.FRAMEBUFFER,dn);const Pn=$.fenceSync($.SYNC_GPU_COMMANDS_COMPLETE,0);return $.flush(),await JW($,Pn,4),$.bindBuffer($.PIXEL_PACK_BUFFER,at),$.getBufferSubData($.PIXEL_PACK_BUFFER,0,Oe),$.deleteBuffer(at),$.deleteSync(Pn),Oe}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(H,re=null,ue=0){H.isTexture!==!0&&(Sy("WebGLRenderer: copyFramebufferToTexture function signature has changed."),re=arguments[0]||null,H=arguments[1]);const de=Math.pow(2,-ue),oe=Math.floor(H.image.width*de),Oe=Math.floor(H.image.height*de),Ke=re!==null?re.x:0,et=re!==null?re.y:0;G.setTexture2D(H,0),$.copyTexSubImage2D($.TEXTURE_2D,ue,0,0,Ke,et,oe,Oe),Te.unbindTexture()},this.copyTextureToTexture=function(H,re,ue=null,de=null,oe=0){H.isTexture!==!0&&(Sy("WebGLRenderer: copyTextureToTexture function signature has changed."),de=arguments[0]||null,H=arguments[1],re=arguments[2],oe=arguments[3]||0,ue=null);let Oe,Ke,et,tt,xt,Tt;ue!==null?(Oe=ue.max.x-ue.min.x,Ke=ue.max.y-ue.min.y,et=ue.min.x,tt=ue.min.y):(Oe=H.image.width,Ke=H.image.height,et=0,tt=0),de!==null?(xt=de.x,Tt=de.y):(xt=0,Tt=0);const at=st.convert(re.format),dn=st.convert(re.type);G.setTexture2D(re,0),$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,re.flipY),$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,re.premultiplyAlpha),$.pixelStorei($.UNPACK_ALIGNMENT,re.unpackAlignment);const Pn=$.getParameter($.UNPACK_ROW_LENGTH),sr=$.getParameter($.UNPACK_IMAGE_HEIGHT),to=$.getParameter($.UNPACK_SKIP_PIXELS),ln=$.getParameter($.UNPACK_SKIP_ROWS),lt=$.getParameter($.UNPACK_SKIP_IMAGES),Wr=H.isCompressedTexture?H.mipmaps[oe]:H.image;$.pixelStorei($.UNPACK_ROW_LENGTH,Wr.width),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,Wr.height),$.pixelStorei($.UNPACK_SKIP_PIXELS,et),$.pixelStorei($.UNPACK_SKIP_ROWS,tt),H.isDataTexture?$.texSubImage2D($.TEXTURE_2D,oe,xt,Tt,Oe,Ke,at,dn,Wr.data):H.isCompressedTexture?$.compressedTexSubImage2D($.TEXTURE_2D,oe,xt,Tt,Wr.width,Wr.height,at,Wr.data):$.texSubImage2D($.TEXTURE_2D,oe,xt,Tt,Oe,Ke,at,dn,Wr),$.pixelStorei($.UNPACK_ROW_LENGTH,Pn),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,sr),$.pixelStorei($.UNPACK_SKIP_PIXELS,to),$.pixelStorei($.UNPACK_SKIP_ROWS,ln),$.pixelStorei($.UNPACK_SKIP_IMAGES,lt),oe===0&&re.generateMipmaps&&$.generateMipmap($.TEXTURE_2D),Te.unbindTexture()},this.copyTextureToTexture3D=function(H,re,ue=null,de=null,oe=0){H.isTexture!==!0&&(Sy("WebGLRenderer: copyTextureToTexture3D function signature has changed."),ue=arguments[0]||null,de=arguments[1]||null,H=arguments[2],re=arguments[3],oe=arguments[4]||0);let Oe,Ke,et,tt,xt,Tt,at,dn,Pn;const sr=H.isCompressedTexture?H.mipmaps[oe]:H.image;ue!==null?(Oe=ue.max.x-ue.min.x,Ke=ue.max.y-ue.min.y,et=ue.max.z-ue.min.z,tt=ue.min.x,xt=ue.min.y,Tt=ue.min.z):(Oe=sr.width,Ke=sr.height,et=sr.depth,tt=0,xt=0,Tt=0),de!==null?(at=de.x,dn=de.y,Pn=de.z):(at=0,dn=0,Pn=0);const to=st.convert(re.format),ln=st.convert(re.type);let lt;if(re.isData3DTexture)G.setTexture3D(re,0),lt=$.TEXTURE_3D;else if(re.isDataArrayTexture||re.isCompressedArrayTexture)G.setTexture2DArray(re,0),lt=$.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,re.flipY),$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,re.premultiplyAlpha),$.pixelStorei($.UNPACK_ALIGNMENT,re.unpackAlignment);const Wr=$.getParameter($.UNPACK_ROW_LENGTH),cn=$.getParameter($.UNPACK_IMAGE_HEIGHT),fs=$.getParameter($.UNPACK_SKIP_PIXELS),Ph=$.getParameter($.UNPACK_SKIP_ROWS),no=$.getParameter($.UNPACK_SKIP_IMAGES);$.pixelStorei($.UNPACK_ROW_LENGTH,sr.width),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,sr.height),$.pixelStorei($.UNPACK_SKIP_PIXELS,tt),$.pixelStorei($.UNPACK_SKIP_ROWS,xt),$.pixelStorei($.UNPACK_SKIP_IMAGES,Tt),H.isDataTexture||H.isData3DTexture?$.texSubImage3D(lt,oe,at,dn,Pn,Oe,Ke,et,to,ln,sr.data):re.isCompressedArrayTexture?$.compressedTexSubImage3D(lt,oe,at,dn,Pn,Oe,Ke,et,to,sr.data):$.texSubImage3D(lt,oe,at,dn,Pn,Oe,Ke,et,to,ln,sr),$.pixelStorei($.UNPACK_ROW_LENGTH,Wr),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,cn),$.pixelStorei($.UNPACK_SKIP_PIXELS,fs),$.pixelStorei($.UNPACK_SKIP_ROWS,Ph),$.pixelStorei($.UNPACK_SKIP_IMAGES,no),oe===0&&re.generateMipmaps&&$.generateMipmap(lt),Te.unbindTexture()},this.initRenderTarget=function(H){be.get(H).__webglFramebuffer===void 0&&G.setupRenderTarget(H)},this.initTexture=function(H){H.isCubeTexture?G.setTextureCube(H,0):H.isData3DTexture?G.setTexture3D(H,0):H.isDataArrayTexture||H.isCompressedArrayTexture?G.setTexture2DArray(H,0):G.setTexture2D(H,0),Te.unbindTexture()},this.resetState=function(){C=0,T=0,S=null,Te.reset(),qt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ol}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===QN?"display-p3":"srgb",t.unpackColorSpace=sn.workingColorSpace===RE?"display-p3":"srgb"}}let _w=class extends Tr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Bs,this.environmentIntensity=1,this.environmentRotation=new Bs,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}};class Eo extends Lm{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new rt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const xw=new N,yw=new N,wO=new dt,sg=new eI,K_=new km,kT=new N,SO=new N;class Xr extends Tr{constructor(e=new Sn,t=new Eo){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[0];for(let i=1,o=t.count;i<o;i++)xw.fromBufferAttribute(t,i-1),yw.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=xw.distanceTo(yw);e.setAttribute("lineDistance",new tn(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,o=e.params.Line.threshold,s=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),K_.copy(r.boundingSphere),K_.applyMatrix4(i),K_.radius+=o,e.ray.intersectsSphere(K_)===!1)return;wO.copy(i).invert(),sg.copy(e.ray).applyMatrix4(wO);const a=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,u=r.index,f=r.attributes.position;if(u!==null){const m=Math.max(0,s.start),g=Math.min(u.count,s.start+s.count);for(let _=m,v=g-1;_<v;_+=c){const p=u.getX(_),x=u.getX(_+1),y=X_(this,e,sg,l,p,x);y&&t.push(y)}if(this.isLineLoop){const _=u.getX(g-1),v=u.getX(m),p=X_(this,e,sg,l,_,v);p&&t.push(p)}}else{const m=Math.max(0,s.start),g=Math.min(f.count,s.start+s.count);for(let _=m,v=g-1;_<v;_+=c){const p=X_(this,e,sg,l,_,_+1);p&&t.push(p)}if(this.isLineLoop){const _=X_(this,e,sg,l,g-1,m);_&&t.push(_)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=i.length;o<s;o++){const a=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}}function X_(n,e,t,r,i,o){const s=n.geometry.attributes.position;if(xw.fromBufferAttribute(s,i),yw.fromBufferAttribute(s,o),t.distanceSqToSegment(xw,yw,kT,SO)>r)return;kT.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(kT);if(!(l<e.near||l>e.far))return{distance:l,point:SO.clone().applyMatrix4(n.matrixWorld),index:i,face:null,faceIndex:null,barycoord:null,object:n}}const EO=new N,TO=new N;class Zv extends Xr{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[];for(let i=0,o=t.count;i<o;i+=2)EO.fromBufferAttribute(t,i),TO.fromBufferAttribute(t,i+1),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+EO.distanceTo(TO);e.setAttribute("lineDistance",new tn(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LT extends ds{constructor(e,t,r,i,o,s,a,l,c,u,h,f){super(null,s,a,l,c,u,i,o,h,f),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class uQ extends ds{constructor(e,t,r,i,o,s,a,l,c){super(e,t,r,i,o,s,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class ci extends Sn{constructor(e=1,t=1,r=1,i=32,o=1,s=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:l};const c=this;i=Math.floor(i),o=Math.floor(o);const u=[],h=[],f=[],m=[];let g=0;const _=[],v=r/2;let p=0;x(),s===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(u),this.setAttribute("position",new tn(h,3)),this.setAttribute("normal",new tn(f,3)),this.setAttribute("uv",new tn(m,2));function x(){const w=new N,C=new N;let T=0;const S=(t-e)/r;for(let b=0;b<=o;b++){const R=[],E=b/o,A=E*(t-e)+e;for(let F=0;F<=i;F++){const D=F/i,M=D*l+a,k=Math.sin(M),z=Math.cos(M);C.x=A*k,C.y=-E*r+v,C.z=A*z,h.push(C.x,C.y,C.z),w.set(k,S,z).normalize(),f.push(w.x,w.y,w.z),m.push(D,1-E),R.push(g++)}_.push(R)}for(let b=0;b<i;b++)for(let R=0;R<o;R++){const E=_[R][b],A=_[R+1][b],F=_[R+1][b+1],D=_[R][b+1];e>0&&(u.push(E,A,D),T+=3),t>0&&(u.push(A,F,D),T+=3)}c.addGroup(p,T,0),p+=T}function y(w){const C=g,T=new Ut,S=new N;let b=0;const R=w===!0?e:t,E=w===!0?1:-1;for(let F=1;F<=i;F++)h.push(0,v*E,0),f.push(0,E,0),m.push(.5,.5),g++;const A=g;for(let F=0;F<=i;F++){const M=F/i*l+a,k=Math.cos(M),z=Math.sin(M);S.x=R*z,S.y=v*E,S.z=R*k,h.push(S.x,S.y,S.z),f.push(0,E,0),T.x=k*.5+.5,T.y=z*.5*E+.5,m.push(T.x,T.y),g++}for(let F=0;F<i;F++){const D=C+F,M=A+F;w===!0?u.push(M,M+1,D):u.push(M+1,M,D),b+=3}c.addGroup(p,b,w===!0?1:2),p+=b}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ci(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class oI extends Sn{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};const o=[],s=[];a(i),c(r),u(),this.setAttribute("position",new tn(o,3)),this.setAttribute("normal",new tn(o.slice(),3)),this.setAttribute("uv",new tn(s,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(x){const y=new N,w=new N,C=new N;for(let T=0;T<t.length;T+=3)m(t[T+0],y),m(t[T+1],w),m(t[T+2],C),l(y,w,C,x)}function l(x,y,w,C){const T=C+1,S=[];for(let b=0;b<=T;b++){S[b]=[];const R=x.clone().lerp(w,b/T),E=y.clone().lerp(w,b/T),A=T-b;for(let F=0;F<=A;F++)F===0&&b===T?S[b][F]=R:S[b][F]=R.clone().lerp(E,F/A)}for(let b=0;b<T;b++)for(let R=0;R<2*(T-b)-1;R++){const E=Math.floor(R/2);R%2===0?(f(S[b][E+1]),f(S[b+1][E]),f(S[b][E])):(f(S[b][E+1]),f(S[b+1][E+1]),f(S[b+1][E]))}}function c(x){const y=new N;for(let w=0;w<o.length;w+=3)y.x=o[w+0],y.y=o[w+1],y.z=o[w+2],y.normalize().multiplyScalar(x),o[w+0]=y.x,o[w+1]=y.y,o[w+2]=y.z}function u(){const x=new N;for(let y=0;y<o.length;y+=3){x.x=o[y+0],x.y=o[y+1],x.z=o[y+2];const w=v(x)/2/Math.PI+.5,C=p(x)/Math.PI+.5;s.push(w,1-C)}g(),h()}function h(){for(let x=0;x<s.length;x+=6){const y=s[x+0],w=s[x+2],C=s[x+4],T=Math.max(y,w,C),S=Math.min(y,w,C);T>.9&&S<.1&&(y<.2&&(s[x+0]+=1),w<.2&&(s[x+2]+=1),C<.2&&(s[x+4]+=1))}}function f(x){o.push(x.x,x.y,x.z)}function m(x,y){const w=x*3;y.x=e[w+0],y.y=e[w+1],y.z=e[w+2]}function g(){const x=new N,y=new N,w=new N,C=new N,T=new Ut,S=new Ut,b=new Ut;for(let R=0,E=0;R<o.length;R+=9,E+=6){x.set(o[R+0],o[R+1],o[R+2]),y.set(o[R+3],o[R+4],o[R+5]),w.set(o[R+6],o[R+7],o[R+8]),T.set(s[E+0],s[E+1]),S.set(s[E+2],s[E+3]),b.set(s[E+4],s[E+5]),C.copy(x).add(y).add(w).divideScalar(3);const A=v(C);_(T,E+0,x,A),_(S,E+2,y,A),_(b,E+4,w,A)}}function _(x,y,w,C){C<0&&x.x===1&&(s[y]=x.x-1),w.x===0&&w.z===0&&(s[y]=C/2/Math.PI+.5)}function v(x){return Math.atan2(x.z,-x.x)}function p(x){return Math.atan2(-x.y,Math.sqrt(x.x*x.x+x.z*x.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oI(e.vertices,e.indices,e.radius,e.details)}}const q_=new N,Q_=new N,OT=new N,Z_=new Qo;class ij extends Sn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),o=Math.cos(wp*t),s=e.getIndex(),a=e.getAttribute("position"),l=s?s.count:a.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),f={},m=[];for(let g=0;g<l;g+=3){s?(c[0]=s.getX(g),c[1]=s.getX(g+1),c[2]=s.getX(g+2)):(c[0]=g,c[1]=g+1,c[2]=g+2);const{a:_,b:v,c:p}=Z_;if(_.fromBufferAttribute(a,c[0]),v.fromBufferAttribute(a,c[1]),p.fromBufferAttribute(a,c[2]),Z_.getNormal(OT),h[0]=`${Math.round(_.x*i)},${Math.round(_.y*i)},${Math.round(_.z*i)}`,h[1]=`${Math.round(v.x*i)},${Math.round(v.y*i)},${Math.round(v.z*i)}`,h[2]=`${Math.round(p.x*i)},${Math.round(p.y*i)},${Math.round(p.z*i)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let x=0;x<3;x++){const y=(x+1)%3,w=h[x],C=h[y],T=Z_[u[x]],S=Z_[u[y]],b=`${w}_${C}`,R=`${C}_${w}`;R in f&&f[R]?(OT.dot(f[R].normal)<=o&&(m.push(T.x,T.y,T.z),m.push(S.x,S.y,S.z)),f[R]=null):b in f||(f[b]={index0:c[x],index1:c[y],normal:OT.clone()})}}for(const g in f)if(f[g]){const{index0:_,index1:v}=f[g];q_.fromBufferAttribute(a,_),Q_.fromBufferAttribute(a,v),m.push(q_.x,q_.y,q_.z),m.push(Q_.x,Q_.y,Q_.z)}this.setAttribute("position",new tn(m,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class $f extends oI{constructor(e=1,t=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $f(e.radius,e.detail)}}class sv extends Sn{constructor(e=1,t=32,r=16,i=0,o=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:o,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const l=Math.min(s+a,Math.PI);let c=0;const u=[],h=new N,f=new N,m=[],g=[],_=[],v=[];for(let p=0;p<=r;p++){const x=[],y=p/r;let w=0;p===0&&s===0?w=.5/t:p===r&&l===Math.PI&&(w=-.5/t);for(let C=0;C<=t;C++){const T=C/t;h.x=-e*Math.cos(i+T*o)*Math.sin(s+y*a),h.y=e*Math.cos(s+y*a),h.z=e*Math.sin(i+T*o)*Math.sin(s+y*a),g.push(h.x,h.y,h.z),f.copy(h).normalize(),_.push(f.x,f.y,f.z),v.push(T+w,1-y),x.push(c++)}u.push(x)}for(let p=0;p<r;p++)for(let x=0;x<t;x++){const y=u[p][x+1],w=u[p][x],C=u[p+1][x],T=u[p+1][x+1];(p!==0||s>0)&&m.push(y,w,T),(p!==r-1||l<Math.PI)&&m.push(w,C,T)}this.setIndex(m),this.setAttribute("position",new tn(g,3)),this.setAttribute("normal",new tn(_,3)),this.setAttribute("uv",new tn(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sv(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class id extends Sn{constructor(e=1,t=.4,r=12,i=48,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:o},r=Math.floor(r),i=Math.floor(i);const s=[],a=[],l=[],c=[],u=new N,h=new N,f=new N;for(let m=0;m<=r;m++)for(let g=0;g<=i;g++){const _=g/i*o,v=m/r*Math.PI*2;h.x=(e+t*Math.cos(v))*Math.cos(_),h.y=(e+t*Math.cos(v))*Math.sin(_),h.z=t*Math.sin(v),a.push(h.x,h.y,h.z),u.x=e*Math.cos(_),u.y=e*Math.sin(_),f.subVectors(h,u).normalize(),l.push(f.x,f.y,f.z),c.push(g/i),c.push(m/r)}for(let m=1;m<=r;m++)for(let g=1;g<=i;g++){const _=(i+1)*m+g-1,v=(i+1)*(m-1)+g-1,p=(i+1)*(m-1)+g,x=(i+1)*m+g;s.push(_,v,x),s.push(v,p,x)}this.setIndex(s),this.setAttribute("position",new tn(a,3)),this.setAttribute("normal",new tn(l,3)),this.setAttribute("uv",new tn(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new id(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class dQ extends No{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class oj extends Lm{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new rt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=HF,this.normalScale=new Ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Bs,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class DT extends Eo{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}class sj extends Tr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new rt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}const UT=new dt,CO=new N,bO=new N;class hQ{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ut(512,512),this.map=null,this.mapPass=null,this.matrix=new dt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new nI,this._frameExtents=new Ut(1,1),this._viewportCount=1,this._viewports=[new gn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;CO.setFromMatrixPosition(e.matrixWorld),t.position.copy(CO),bO.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(bO),t.updateMatrixWorld(),UT.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(UT),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(UT)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}const AO=new dt,ag=new N,FT=new N;class fQ extends hQ{constructor(){super(new Vi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ut(4,2),this._viewportCount=6,this._viewports=[new gn(2,1,1,1),new gn(0,1,1,1),new gn(3,1,1,1),new gn(1,1,1,1),new gn(3,0,1,1),new gn(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,i=this.matrix,o=e.distance||r.far;o!==r.far&&(r.far=o,r.updateProjectionMatrix()),ag.setFromMatrixPosition(e.matrixWorld),r.position.copy(ag),FT.copy(r.position),FT.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(FT),r.updateMatrixWorld(),i.makeTranslation(-ag.x,-ag.y,-ag.z),AO.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(AO)}}class pQ extends sj{constructor(e,t,r=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new fQ}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class mQ extends sj{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class aj{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=MO(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=MO();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function MO(){return performance.now()}const sI="\\[\\]\\.:\\/",gQ=new RegExp("["+sI+"]","g"),aI="[^"+sI+"]",vQ="[^"+sI.replace("\\.","")+"]",_Q=/((?:WC+[\/:])*)/.source.replace("WC",aI),xQ=/(WCOD+)?/.source.replace("WCOD",vQ),yQ=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",aI),wQ=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",aI),SQ=new RegExp("^"+_Q+xQ+yQ+wQ+"$"),EQ=["material","materials","bones","map"];class TQ{constructor(e,t,r){const i=r||on.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,o=r.length;i!==o;++i)r[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}class on{constructor(e,t,r){this.path=t,this.parsedPath=r||on.parseTrackName(t),this.node=on.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new on.Composite(e,t,r):new on(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(gQ,"")}static parseTrackName(e){const t=SQ.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const o=r.nodeName.substring(i+1);EQ.indexOf(o)!==-1&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=o)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){const r=function(o){for(let s=0;s<o.length;s++){const a=o[s];if(a.name===t||a.uuid===t)return a;const l=r(a.children);if(l)return l}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let i=0,o=r.length;i!==o;++i)e[t++]=r[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let i=0,o=r.length;i!==o;++i)r[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,o=r.length;i!==o;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,o=r.length;i!==o;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,i=t.propertyName;let o=t.propertyIndex;if(e||(e=on.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let c=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const s=e[i];if(s===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(o!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=o}else s.fromArray!==void 0&&s.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}on.Composite=TQ;on.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};on.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};on.prototype.GetterByBindingType=[on.prototype._getValue_direct,on.prototype._getValue_array,on.prototype._getValue_arrayElement,on.prototype._getValue_toArray];on.prototype.SetterByBindingTypeAndVersioning=[[on.prototype._setValue_direct,on.prototype._setValue_direct_setNeedsUpdate,on.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[on.prototype._setValue_array,on.prototype._setValue_array_setNeedsUpdate,on.prototype._setValue_array_setMatrixWorldNeedsUpdate],[on.prototype._setValue_arrayElement,on.prototype._setValue_arrayElement_setNeedsUpdate,on.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[on.prototype._setValue_fromArray,on.prototype._setValue_fromArray_setNeedsUpdate,on.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ja{constructor(e){this.value=e}clone(){return new Ja(this.value.clone===void 0?this.value:this.value.clone())}}const RO=new dt;class lj{constructor(e,t,r=0,i=1/0){this.ray=new eI(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new tI,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return RO.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(RO),this}intersectObject(e,t=!0,r=[]){return IA(e,this,r,t),r.sort(NO),r}intersectObjects(e,t=!0,r=[]){for(let i=0,o=e.length;i<o;i++)IA(e[i],this,r,t);return r.sort(NO),r}}function NO(n,e){return n.distance-e.distance}function IA(n,e,t,r){let i=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(i=!1),i===!0&&r===!0){const o=n.children;for(let s=0,a=o.length;s<a;s++)IA(o[s],e,t,!0)}}class CQ{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(fi(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class bQ extends Zv{constructor(e=10,t=10,r=4473924,i=8947848){r=new rt(r),i=new rt(i);const o=t/2,s=e/t,a=e/2,l=[],c=[];for(let f=0,m=0,g=-a;f<=t;f++,g+=s){l.push(-a,0,g,a,0,g),l.push(g,0,-a,g,0,a);const _=f===o?r:i;_.toArray(c,m),m+=3,_.toArray(c,m),m+=3,_.toArray(c,m),m+=3,_.toArray(c,m),m+=3}const u=new Sn;u.setAttribute("position",new tn(l,3)),u.setAttribute("color",new tn(c,3));const h=new Eo({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PA extends Zv{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new Sn;o.setIndex(new $n(r,1)),o.setAttribute("position",new tn(i,3)),super(o,new Eo({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class AQ extends Zv{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Sn;i.setAttribute("position",new tn(t,3)),i.setAttribute("color",new tn(r,3));const o=new Eo({vertexColors:!0,toneMapped:!1});super(i,o),this.type="AxesHelper"}setColors(e,t,r){const i=new rt,o=this.geometry.attributes.color.array;return i.set(e),i.toArray(o,0),i.toArray(o,3),i.set(t),i.toArray(o,6),i.toArray(o,9),i.set(r),i.toArray(o,12),i.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class MQ extends hh{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:AE}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=AE);var b0=function(){var n=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(u){u.preventDefault(),r(++n%e.children.length)},!1);function t(u){return e.appendChild(u.dom),u}function r(u){for(var h=0;h<e.children.length;h++)e.children[h].style.display=h===u?"block":"none";n=u}var i=(performance||Date).now(),o=i,s=0,a=t(new b0.Panel("FPS","#0ff","#002")),l=t(new b0.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new b0.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:t,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){s++;var u=(performance||Date).now();if(l.update(u-i,200),u>o+1e3&&(a.update(s*1e3/(u-o),100),o=u,s=0,c)){var h=performance.memory;c.update(h.usedJSHeapSize/1048576,h.jsHeapSizeLimit/1048576)}return u},update:function(){i=this.end()},domElement:e,setMode:r}};b0.Panel=function(n,e,t){var r=1/0,i=0,o=Math.round,s=o(window.devicePixelRatio||1),a=80*s,l=48*s,c=3*s,u=2*s,h=3*s,f=15*s,m=74*s,g=30*s,_=document.createElement("canvas");_.width=a,_.height=l,_.style.cssText="width:80px;height:48px";var v=_.getContext("2d");return v.font="bold "+9*s+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=t,v.fillRect(0,0,a,l),v.fillStyle=e,v.fillText(n,c,u),v.fillRect(h,f,m,g),v.fillStyle=t,v.globalAlpha=.9,v.fillRect(h,f,m,g),{dom:_,update:function(p,x){r=Math.min(r,p),i=Math.max(i,p),v.fillStyle=t,v.globalAlpha=1,v.fillRect(0,0,a,f),v.fillStyle=e,v.fillText(o(p)+" "+n+" ("+o(r)+"-"+o(i)+")",c,u),v.drawImage(_,h+s,f,m-s,g,h,f,m-s,g),v.fillRect(h+m-s,f,s,g),v.fillStyle=t,v.globalAlpha=.9,v.fillRect(h+m-s,f,s,o((1-p/x)*g))}}};function RQ(n){return new Worker(""+new URL("storeWorker-Bj0sO6SI.js",import.meta.url).href,{name:n==null?void 0:n.name})}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const cj=Symbol("Comlink.proxy"),NQ=Symbol("Comlink.endpoint"),lI=Symbol("Comlink.releaseProxy"),jT=Symbol("Comlink.finalizer"),Cy=Symbol("Comlink.thrown"),uj=n=>typeof n=="object"&&n!==null||typeof n=="function",IQ={canHandle:n=>uj(n)&&n[cj],serialize(n){const{port1:e,port2:t}=new MessageChannel;return hj(n,e),[t,[t]]},deserialize(n){return n.start(),Um(n)}},PQ={canHandle:n=>uj(n)&&Cy in n,serialize({value:n}){let e;return n instanceof Error?e={isError:!0,value:{message:n.message,name:n.name,stack:n.stack}}:e={isError:!1,value:n},[e,[]]},deserialize(n){throw n.isError?Object.assign(new Error(n.value.message),n.value):n.value}},dj=new Map([["proxy",IQ],["throw",PQ]]);function kQ(n,e){for(const t of n)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function hj(n,e=globalThis,t=["*"]){e.addEventListener("message",function r(i){if(!i||!i.data)return;if(!kQ(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:s,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(od);let c;try{const u=a.slice(0,-1).reduce((f,m)=>f[m],n),h=a.reduce((f,m)=>f[m],n);switch(s){case"GET":c=h;break;case"SET":u[a.slice(-1)[0]]=od(i.data.value),c=!0;break;case"APPLY":c=h.apply(u,l);break;case"CONSTRUCT":{const f=new h(...l);c=jQ(f)}break;case"ENDPOINT":{const{port1:f,port2:m}=new MessageChannel;hj(n,m),c=FQ(f,[f])}break;case"RELEASE":c=void 0;break;default:return}}catch(u){c={value:u,[Cy]:0}}Promise.resolve(c).catch(u=>({value:u,[Cy]:0})).then(u=>{const[h,f]=Ew(u);e.postMessage(Object.assign(Object.assign({},h),{id:o}),f),s==="RELEASE"&&(e.removeEventListener("message",r),fj(e),jT in n&&typeof n[jT]=="function"&&n[jT]())}).catch(u=>{const[h,f]=Ew({value:new TypeError("Unserializable return value"),[Cy]:0});e.postMessage(Object.assign(Object.assign({},h),{id:o}),f)})}),e.start&&e.start()}function LQ(n){return n.constructor.name==="MessagePort"}function fj(n){LQ(n)&&n.close()}function Um(n,e){return kA(n,[],e)}function J_(n){if(n)throw new Error("Proxy has been released and is not useable")}function pj(n){return Mf(n,{type:"RELEASE"}).then(()=>{fj(n)})}const ww=new WeakMap,Sw="FinalizationRegistry"in globalThis&&new FinalizationRegistry(n=>{const e=(ww.get(n)||0)-1;ww.set(n,e),e===0&&pj(n)});function OQ(n,e){const t=(ww.get(e)||0)+1;ww.set(e,t),Sw&&Sw.register(n,e,n)}function DQ(n){Sw&&Sw.unregister(n)}function kA(n,e=[],t=function(){}){let r=!1;const i=new Proxy(t,{get(o,s){if(J_(r),s===lI)return()=>{DQ(i),pj(n),r=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const a=Mf(n,{type:"GET",path:e.map(l=>l.toString())}).then(od);return a.then.bind(a)}return kA(n,[...e,s])},set(o,s,a){J_(r);const[l,c]=Ew(a);return Mf(n,{type:"SET",path:[...e,s].map(u=>u.toString()),value:l},c).then(od)},apply(o,s,a){J_(r);const l=e[e.length-1];if(l===NQ)return Mf(n,{type:"ENDPOINT"}).then(od);if(l==="bind")return kA(n,e.slice(0,-1));const[c,u]=IO(a);return Mf(n,{type:"APPLY",path:e.map(h=>h.toString()),argumentList:c},u).then(od)},construct(o,s){J_(r);const[a,l]=IO(s);return Mf(n,{type:"CONSTRUCT",path:e.map(c=>c.toString()),argumentList:a},l).then(od)}});return OQ(i,n),i}function UQ(n){return Array.prototype.concat.apply([],n)}function IO(n){const e=n.map(Ew);return[e.map(t=>t[0]),UQ(e.map(t=>t[1]))]}const mj=new WeakMap;function FQ(n,e){return mj.set(n,e),n}function jQ(n){return Object.assign(n,{[cj]:!0})}function Ew(n){for(const[e,t]of dj)if(t.canHandle(n)){const[r,i]=t.serialize(n);return[{type:"HANDLER",name:e,value:r},i]}return[{type:"RAW",value:n},mj.get(n)||[]]}function od(n){switch(n.type){case"HANDLER":return dj.get(n.name).deserialize(n.value);case"RAW":return n.value}}function Mf(n,e,t){return new Promise(r=>{const i=BQ();n.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(n.removeEventListener("message",o),r(s.data))}),n.start&&n.start(),n.postMessage(Object.assign({id:i},e),t)})}function BQ(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var gj={exports:{}},Oo={},vj={exports:{}},_j={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(U,Y){var Z=U.length;U.push(Y);e:for(;0<Z;){var j=Z-1>>>1,X=U[j];if(0<i(X,Y))U[j]=Y,U[Z]=X,Z=j;else break e}}function t(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var Y=U[0],Z=U.pop();if(Z!==Y){U[0]=Z;e:for(var j=0,X=U.length,B=X>>>1;j<B;){var K=2*(j+1)-1,ee=U[K],fe=K+1,ce=U[fe];if(0>i(ee,Z))fe<X&&0>i(ce,ee)?(U[j]=ce,U[fe]=Z,j=fe):(U[j]=ee,U[K]=Z,j=K);else if(fe<X&&0>i(ce,Z))U[j]=ce,U[fe]=Z,j=fe;else break e}}return Y}function i(U,Y){var Z=U.sortIndex-Y.sortIndex;return Z!==0?Z:U.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();n.unstable_now=function(){return s.now()-a}}var l=[],c=[],u=1,h=null,f=3,m=!1,g=!1,_=!1,v=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(U){for(var Y=t(c);Y!==null;){if(Y.callback===null)r(c);else if(Y.startTime<=U)r(c),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=t(c)}}function w(U){if(_=!1,y(U),!g)if(t(l)!==null)g=!0,z(C);else{var Y=t(c);Y!==null&&P(w,Y.startTime-U)}}function C(U,Y){g=!1,_&&(_=!1,p(b),b=-1),m=!0;var Z=f;try{for(y(Y),h=t(l);h!==null&&(!(h.expirationTime>Y)||U&&!A());){var j=h.callback;if(typeof j=="function"){h.callback=null,f=h.priorityLevel;var X=j(h.expirationTime<=Y);Y=n.unstable_now(),typeof X=="function"?h.callback=X:h===t(l)&&r(l),y(Y)}else r(l);h=t(l)}if(h!==null)var B=!0;else{var K=t(c);K!==null&&P(w,K.startTime-Y),B=!1}return B}finally{h=null,f=Z,m=!1}}var T=!1,S=null,b=-1,R=5,E=-1;function A(){return!(n.unstable_now()-E<R)}function F(){if(S!==null){var U=n.unstable_now();E=U;var Y=!0;try{Y=S(!0,U)}finally{Y?D():(T=!1,S=null)}}else T=!1}var D;if(typeof x=="function")D=function(){x(F)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,k=M.port2;M.port1.onmessage=F,D=function(){k.postMessage(null)}}else D=function(){v(F,0)};function z(U){S=U,T||(T=!0,D())}function P(U,Y){b=v(function(){U(n.unstable_now())},Y)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(U){U.callback=null},n.unstable_continueExecution=function(){g||m||(g=!0,z(C))},n.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<U?Math.floor(1e3/U):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(U){switch(f){case 1:case 2:case 3:var Y=3;break;default:Y=f}var Z=f;f=Y;try{return U()}finally{f=Z}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(U,Y){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var Z=f;f=U;try{return Y()}finally{f=Z}},n.unstable_scheduleCallback=function(U,Y,Z){var j=n.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?j+Z:j):Z=j,U){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=Z+X,U={id:u++,callback:Y,priorityLevel:U,startTime:Z,expirationTime:X,sortIndex:-1},Z>j?(U.sortIndex=Z,e(c,U),t(l)===null&&U===t(c)&&(_?(p(b),b=-1):_=!0,P(w,Z-j))):(U.sortIndex=X,e(l,U),g||m||(g=!0,z(C))),U},n.unstable_shouldYield=A,n.unstable_wrapCallback=function(U){var Y=f;return function(){var Z=f;f=Y;try{return U.apply(this,arguments)}finally{f=Z}}}})(_j);vj.exports=_j;var zQ=vj.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HQ=O,Io=zQ;function Ne(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var xj=new Set,av={};function fh(n,e){im(n,e),im(n+"Capture",e)}function im(n,e){for(av[n]=e,n=0;n<e.length;n++)xj.add(e[n])}var Rl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),LA=Object.prototype.hasOwnProperty,VQ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,PO={},kO={};function GQ(n){return LA.call(kO,n)?!0:LA.call(PO,n)?!1:VQ.test(n)?kO[n]=!0:(PO[n]=!0,!1)}function WQ(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function $Q(n,e,t,r){if(e===null||typeof e>"u"||WQ(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ui(n,e,t,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var Jr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Jr[n]=new Ui(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Jr[e]=new Ui(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Jr[n]=new Ui(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Jr[n]=new Ui(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Jr[n]=new Ui(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Jr[n]=new Ui(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Jr[n]=new Ui(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Jr[n]=new Ui(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Jr[n]=new Ui(n,5,!1,n.toLowerCase(),null,!1,!1)});var cI=/[\-:]([a-z])/g;function uI(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(cI,uI);Jr[e]=new Ui(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(cI,uI);Jr[e]=new Ui(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(cI,uI);Jr[e]=new Ui(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Jr[n]=new Ui(n,1,!1,n.toLowerCase(),null,!1,!1)});Jr.xlinkHref=new Ui("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Jr[n]=new Ui(n,1,!1,n.toLowerCase(),null,!0,!0)});function dI(n,e,t,r){var i=Jr.hasOwnProperty(e)?Jr[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&($Q(e,t,i,r)&&(t=null),r||i===null?GQ(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Vl=HQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ex=Symbol.for("react.element"),Yf=Symbol.for("react.portal"),Kf=Symbol.for("react.fragment"),hI=Symbol.for("react.strict_mode"),OA=Symbol.for("react.profiler"),yj=Symbol.for("react.provider"),wj=Symbol.for("react.context"),fI=Symbol.for("react.forward_ref"),DA=Symbol.for("react.suspense"),UA=Symbol.for("react.suspense_list"),pI=Symbol.for("react.memo"),xc=Symbol.for("react.lazy"),Sj=Symbol.for("react.offscreen"),LO=Symbol.iterator;function lg(n){return n===null||typeof n!="object"?null:(n=LO&&n[LO]||n["@@iterator"],typeof n=="function"?n:null)}var ir=Object.assign,BT;function n0(n){if(BT===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);BT=e&&e[1]||""}return`
`+BT+n}var zT=!1;function HT(n,e){if(!n||zT)return"";zT=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var l=`
`+i[s].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=s&&0<=a);break}}}finally{zT=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?n0(n):""}function YQ(n){switch(n.tag){case 5:return n0(n.type);case 16:return n0("Lazy");case 13:return n0("Suspense");case 19:return n0("SuspenseList");case 0:case 2:case 15:return n=HT(n.type,!1),n;case 11:return n=HT(n.type.render,!1),n;case 1:return n=HT(n.type,!0),n;default:return""}}function FA(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Kf:return"Fragment";case Yf:return"Portal";case OA:return"Profiler";case hI:return"StrictMode";case DA:return"Suspense";case UA:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case wj:return(n.displayName||"Context")+".Consumer";case yj:return(n._context.displayName||"Context")+".Provider";case fI:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case pI:return e=n.displayName||null,e!==null?e:FA(n.type)||"Memo";case xc:e=n._payload,n=n._init;try{return FA(n(e))}catch{}}return null}function KQ(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return FA(e);case 8:return e===hI?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function iu(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Ej(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function XQ(n){var e=Ej(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,o=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function tx(n){n._valueTracker||(n._valueTracker=XQ(n))}function Tj(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Ej(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function Tw(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function jA(n,e){var t=e.checked;return ir({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function OO(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=iu(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Cj(n,e){e=e.checked,e!=null&&dI(n,"checked",e,!1)}function BA(n,e){Cj(n,e);var t=iu(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?zA(n,e.type,t):e.hasOwnProperty("defaultValue")&&zA(n,e.type,iu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function DO(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function zA(n,e,t){(e!=="number"||Tw(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var r0=Array.isArray;function Ep(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+iu(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function HA(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ne(91));return ir({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function UO(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Ne(92));if(r0(t)){if(1<t.length)throw Error(Ne(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:iu(t)}}function bj(n,e){var t=iu(e.value),r=iu(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function FO(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Aj(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function VA(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Aj(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var nx,Mj=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(nx=nx||document.createElement("div"),nx.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=nx.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function lv(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var A0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qQ=["Webkit","ms","Moz","O"];Object.keys(A0).forEach(function(n){qQ.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),A0[e]=A0[n]})});function Rj(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||A0.hasOwnProperty(n)&&A0[n]?(""+e).trim():e+"px"}function Nj(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=Rj(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var QQ=ir({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function GA(n,e){if(e){if(QQ[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ne(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ne(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ne(62))}}function WA(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $A=null;function mI(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var YA=null,Tp=null,Cp=null;function jO(n){if(n=t_(n)){if(typeof YA!="function")throw Error(Ne(280));var e=n.stateNode;e&&(e=DE(e),YA(n.stateNode,n.type,e))}}function Ij(n){Tp?Cp?Cp.push(n):Cp=[n]:Tp=n}function Pj(){if(Tp){var n=Tp,e=Cp;if(Cp=Tp=null,jO(n),e)for(n=0;n<e.length;n++)jO(e[n])}}function kj(n,e){return n(e)}function Lj(){}var VT=!1;function Oj(n,e,t){if(VT)return n(e,t);VT=!0;try{return kj(n,e,t)}finally{VT=!1,(Tp!==null||Cp!==null)&&(Lj(),Pj())}}function cv(n,e){var t=n.stateNode;if(t===null)return null;var r=DE(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Ne(231,e,typeof t));return t}var KA=!1;if(Rl)try{var cg={};Object.defineProperty(cg,"passive",{get:function(){KA=!0}}),window.addEventListener("test",cg,cg),window.removeEventListener("test",cg,cg)}catch{KA=!1}function ZQ(n,e,t,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var M0=!1,Cw=null,bw=!1,XA=null,JQ={onError:function(n){M0=!0,Cw=n}};function eZ(n,e,t,r,i,o,s,a,l){M0=!1,Cw=null,ZQ.apply(JQ,arguments)}function tZ(n,e,t,r,i,o,s,a,l){if(eZ.apply(this,arguments),M0){if(M0){var c=Cw;M0=!1,Cw=null}else throw Error(Ne(198));bw||(bw=!0,XA=c)}}function ph(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Dj(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function BO(n){if(ph(n)!==n)throw Error(Ne(188))}function nZ(n){var e=n.alternate;if(!e){if(e=ph(n),e===null)throw Error(Ne(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===t)return BO(i),n;if(o===r)return BO(i),e;o=o.sibling}throw Error(Ne(188))}if(t.return!==r.return)t=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===t){s=!0,t=i,r=o;break}if(a===r){s=!0,r=i,t=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===t){s=!0,t=o,r=i;break}if(a===r){s=!0,r=o,t=i;break}a=a.sibling}if(!s)throw Error(Ne(189))}}if(t.alternate!==r)throw Error(Ne(190))}if(t.tag!==3)throw Error(Ne(188));return t.stateNode.current===t?n:e}function Uj(n){return n=nZ(n),n!==null?Fj(n):null}function Fj(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Fj(n);if(e!==null)return e;n=n.sibling}return null}var jj=Io.unstable_scheduleCallback,zO=Io.unstable_cancelCallback,rZ=Io.unstable_shouldYield,iZ=Io.unstable_requestPaint,hr=Io.unstable_now,oZ=Io.unstable_getCurrentPriorityLevel,gI=Io.unstable_ImmediatePriority,Bj=Io.unstable_UserBlockingPriority,Aw=Io.unstable_NormalPriority,sZ=Io.unstable_LowPriority,zj=Io.unstable_IdlePriority,PE=null,Ea=null;function aZ(n){if(Ea&&typeof Ea.onCommitFiberRoot=="function")try{Ea.onCommitFiberRoot(PE,n,void 0,(n.current.flags&128)===128)}catch{}}var Os=Math.clz32?Math.clz32:uZ,lZ=Math.log,cZ=Math.LN2;function uZ(n){return n>>>=0,n===0?32:31-(lZ(n)/cZ|0)|0}var rx=64,ix=4194304;function i0(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Mw(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,o=n.pingedLanes,s=t&268435455;if(s!==0){var a=s&~i;a!==0?r=i0(a):(o&=s,o!==0&&(r=i0(o)))}else s=t&~i,s!==0?r=i0(s):o!==0&&(r=i0(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Os(e),i=1<<t,r|=n[t],e&=~i;return r}function dZ(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hZ(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,o=n.pendingLanes;0<o;){var s=31-Os(o),a=1<<s,l=i[s];l===-1?(!(a&t)||a&r)&&(i[s]=dZ(a,e)):l<=e&&(n.expiredLanes|=a),o&=~a}}function qA(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Hj(){var n=rx;return rx<<=1,!(rx&4194240)&&(rx=64),n}function GT(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Jv(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Os(e),n[e]=t}function fZ(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Os(t),o=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~o}}function vI(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Os(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var vn=0;function Vj(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Gj,_I,Wj,$j,Yj,QA=!1,ox=[],Hc=null,Vc=null,Gc=null,uv=new Map,dv=new Map,Tc=[],pZ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function HO(n,e){switch(n){case"focusin":case"focusout":Hc=null;break;case"dragenter":case"dragleave":Vc=null;break;case"mouseover":case"mouseout":Gc=null;break;case"pointerover":case"pointerout":uv.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":dv.delete(e.pointerId)}}function ug(n,e,t,r,i,o){return n===null||n.nativeEvent!==o?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=t_(e),e!==null&&_I(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function mZ(n,e,t,r,i){switch(e){case"focusin":return Hc=ug(Hc,n,e,t,r,i),!0;case"dragenter":return Vc=ug(Vc,n,e,t,r,i),!0;case"mouseover":return Gc=ug(Gc,n,e,t,r,i),!0;case"pointerover":var o=i.pointerId;return uv.set(o,ug(uv.get(o)||null,n,e,t,r,i)),!0;case"gotpointercapture":return o=i.pointerId,dv.set(o,ug(dv.get(o)||null,n,e,t,r,i)),!0}return!1}function Kj(n){var e=fd(n.target);if(e!==null){var t=ph(e);if(t!==null){if(e=t.tag,e===13){if(e=Dj(t),e!==null){n.blockedOn=e,Yj(n.priority,function(){Wj(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function by(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=ZA(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);$A=r,t.target.dispatchEvent(r),$A=null}else return e=t_(t),e!==null&&_I(e),n.blockedOn=t,!1;e.shift()}return!0}function VO(n,e,t){by(n)&&t.delete(e)}function gZ(){QA=!1,Hc!==null&&by(Hc)&&(Hc=null),Vc!==null&&by(Vc)&&(Vc=null),Gc!==null&&by(Gc)&&(Gc=null),uv.forEach(VO),dv.forEach(VO)}function dg(n,e){n.blockedOn===e&&(n.blockedOn=null,QA||(QA=!0,Io.unstable_scheduleCallback(Io.unstable_NormalPriority,gZ)))}function hv(n){function e(i){return dg(i,n)}if(0<ox.length){dg(ox[0],n);for(var t=1;t<ox.length;t++){var r=ox[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Hc!==null&&dg(Hc,n),Vc!==null&&dg(Vc,n),Gc!==null&&dg(Gc,n),uv.forEach(e),dv.forEach(e),t=0;t<Tc.length;t++)r=Tc[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Tc.length&&(t=Tc[0],t.blockedOn===null);)Kj(t),t.blockedOn===null&&Tc.shift()}var bp=Vl.ReactCurrentBatchConfig,Rw=!0;function vZ(n,e,t,r){var i=vn,o=bp.transition;bp.transition=null;try{vn=1,xI(n,e,t,r)}finally{vn=i,bp.transition=o}}function _Z(n,e,t,r){var i=vn,o=bp.transition;bp.transition=null;try{vn=4,xI(n,e,t,r)}finally{vn=i,bp.transition=o}}function xI(n,e,t,r){if(Rw){var i=ZA(n,e,t,r);if(i===null)eC(n,e,r,Nw,t),HO(n,r);else if(mZ(i,n,e,t,r))r.stopPropagation();else if(HO(n,r),e&4&&-1<pZ.indexOf(n)){for(;i!==null;){var o=t_(i);if(o!==null&&Gj(o),o=ZA(n,e,t,r),o===null&&eC(n,e,r,Nw,t),o===i)break;i=o}i!==null&&r.stopPropagation()}else eC(n,e,r,null,t)}}var Nw=null;function ZA(n,e,t,r){if(Nw=null,n=mI(r),n=fd(n),n!==null)if(e=ph(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Dj(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Nw=n,null}function Xj(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(oZ()){case gI:return 1;case Bj:return 4;case Aw:case sZ:return 16;case zj:return 536870912;default:return 16}default:return 16}}var Oc=null,yI=null,Ay=null;function qj(){if(Ay)return Ay;var n,e=yI,t=e.length,r,i="value"in Oc?Oc.value:Oc.textContent,o=i.length;for(n=0;n<t&&e[n]===i[n];n++);var s=t-n;for(r=1;r<=s&&e[t-r]===i[o-r];r++);return Ay=i.slice(n,1<r?1-r:void 0)}function My(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function sx(){return!0}function GO(){return!1}function Do(n){function e(t,r,i,o,s){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?sx:GO,this.isPropagationStopped=GO,this}return ir(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=sx)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=sx)},persist:function(){},isPersistent:sx}),e}var Fm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wI=Do(Fm),e_=ir({},Fm,{view:0,detail:0}),xZ=Do(e_),WT,$T,hg,kE=ir({},e_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:SI,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==hg&&(hg&&n.type==="mousemove"?(WT=n.screenX-hg.screenX,$T=n.screenY-hg.screenY):$T=WT=0,hg=n),WT)},movementY:function(n){return"movementY"in n?n.movementY:$T}}),WO=Do(kE),yZ=ir({},kE,{dataTransfer:0}),wZ=Do(yZ),SZ=ir({},e_,{relatedTarget:0}),YT=Do(SZ),EZ=ir({},Fm,{animationName:0,elapsedTime:0,pseudoElement:0}),TZ=Do(EZ),CZ=ir({},Fm,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),bZ=Do(CZ),AZ=ir({},Fm,{data:0}),$O=Do(AZ),MZ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RZ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},NZ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function IZ(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=NZ[n])?!!e[n]:!1}function SI(){return IZ}var PZ=ir({},e_,{key:function(n){if(n.key){var e=MZ[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=My(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?RZ[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:SI,charCode:function(n){return n.type==="keypress"?My(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?My(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),kZ=Do(PZ),LZ=ir({},kE,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),YO=Do(LZ),OZ=ir({},e_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:SI}),DZ=Do(OZ),UZ=ir({},Fm,{propertyName:0,elapsedTime:0,pseudoElement:0}),FZ=Do(UZ),jZ=ir({},kE,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),BZ=Do(jZ),zZ=[9,13,27,32],EI=Rl&&"CompositionEvent"in window,R0=null;Rl&&"documentMode"in document&&(R0=document.documentMode);var HZ=Rl&&"TextEvent"in window&&!R0,Qj=Rl&&(!EI||R0&&8<R0&&11>=R0),KO=" ",XO=!1;function Zj(n,e){switch(n){case"keyup":return zZ.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jj(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Xf=!1;function VZ(n,e){switch(n){case"compositionend":return Jj(e);case"keypress":return e.which!==32?null:(XO=!0,KO);case"textInput":return n=e.data,n===KO&&XO?null:n;default:return null}}function GZ(n,e){if(Xf)return n==="compositionend"||!EI&&Zj(n,e)?(n=qj(),Ay=yI=Oc=null,Xf=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Qj&&e.locale!=="ko"?null:e.data;default:return null}}var WZ={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qO(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!WZ[n.type]:e==="textarea"}function eB(n,e,t,r){Ij(r),e=Iw(e,"onChange"),0<e.length&&(t=new wI("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var N0=null,fv=null;function $Z(n){dB(n,0)}function LE(n){var e=Zf(n);if(Tj(e))return n}function YZ(n,e){if(n==="change")return e}var tB=!1;if(Rl){var KT;if(Rl){var XT="oninput"in document;if(!XT){var QO=document.createElement("div");QO.setAttribute("oninput","return;"),XT=typeof QO.oninput=="function"}KT=XT}else KT=!1;tB=KT&&(!document.documentMode||9<document.documentMode)}function ZO(){N0&&(N0.detachEvent("onpropertychange",nB),fv=N0=null)}function nB(n){if(n.propertyName==="value"&&LE(fv)){var e=[];eB(e,fv,n,mI(n)),Oj($Z,e)}}function KZ(n,e,t){n==="focusin"?(ZO(),N0=e,fv=t,N0.attachEvent("onpropertychange",nB)):n==="focusout"&&ZO()}function XZ(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return LE(fv)}function qZ(n,e){if(n==="click")return LE(e)}function QZ(n,e){if(n==="input"||n==="change")return LE(e)}function ZZ(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var zs=typeof Object.is=="function"?Object.is:ZZ;function pv(n,e){if(zs(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!LA.call(e,i)||!zs(n[i],e[i]))return!1}return!0}function JO(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function e3(n,e){var t=JO(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=JO(t)}}function rB(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?rB(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function iB(){for(var n=window,e=Tw();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Tw(n.document)}return e}function TI(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function JZ(n){var e=iB(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&rB(t.ownerDocument.documentElement,t)){if(r!==null&&TI(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!n.extend&&o>r&&(i=r,r=o,o=i),i=e3(t,o);var s=e3(t,r);i&&s&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==s.node||n.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),o>r?(n.addRange(e),n.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var eJ=Rl&&"documentMode"in document&&11>=document.documentMode,qf=null,JA=null,I0=null,eM=!1;function t3(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;eM||qf==null||qf!==Tw(r)||(r=qf,"selectionStart"in r&&TI(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),I0&&pv(I0,r)||(I0=r,r=Iw(JA,"onSelect"),0<r.length&&(e=new wI("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=qf)))}function ax(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Qf={animationend:ax("Animation","AnimationEnd"),animationiteration:ax("Animation","AnimationIteration"),animationstart:ax("Animation","AnimationStart"),transitionend:ax("Transition","TransitionEnd")},qT={},oB={};Rl&&(oB=document.createElement("div").style,"AnimationEvent"in window||(delete Qf.animationend.animation,delete Qf.animationiteration.animation,delete Qf.animationstart.animation),"TransitionEvent"in window||delete Qf.transitionend.transition);function OE(n){if(qT[n])return qT[n];if(!Qf[n])return n;var e=Qf[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in oB)return qT[n]=e[t];return n}var sB=OE("animationend"),aB=OE("animationiteration"),lB=OE("animationstart"),cB=OE("transitionend"),uB=new Map,n3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _u(n,e){uB.set(n,e),fh(e,[n])}for(var QT=0;QT<n3.length;QT++){var ZT=n3[QT],tJ=ZT.toLowerCase(),nJ=ZT[0].toUpperCase()+ZT.slice(1);_u(tJ,"on"+nJ)}_u(sB,"onAnimationEnd");_u(aB,"onAnimationIteration");_u(lB,"onAnimationStart");_u("dblclick","onDoubleClick");_u("focusin","onFocus");_u("focusout","onBlur");_u(cB,"onTransitionEnd");im("onMouseEnter",["mouseout","mouseover"]);im("onMouseLeave",["mouseout","mouseover"]);im("onPointerEnter",["pointerout","pointerover"]);im("onPointerLeave",["pointerout","pointerover"]);fh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fh("onBeforeInput",["compositionend","keypress","textInput","paste"]);fh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var o0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rJ=new Set("cancel close invalid load scroll toggle".split(" ").concat(o0));function r3(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,tZ(r,e,void 0,n),n.currentTarget=null}function dB(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;r3(i,a,c),o=l}else for(s=0;s<r.length;s++){if(a=r[s],l=a.instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;r3(i,a,c),o=l}}}if(bw)throw n=XA,bw=!1,XA=null,n}function Ln(n,e){var t=e[oM];t===void 0&&(t=e[oM]=new Set);var r=n+"__bubble";t.has(r)||(hB(e,n,2,!1),t.add(r))}function JT(n,e,t){var r=0;e&&(r|=4),hB(t,n,r,e)}var lx="_reactListening"+Math.random().toString(36).slice(2);function mv(n){if(!n[lx]){n[lx]=!0,xj.forEach(function(t){t!=="selectionchange"&&(rJ.has(t)||JT(t,!1,n),JT(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[lx]||(e[lx]=!0,JT("selectionchange",!1,e))}}function hB(n,e,t,r){switch(Xj(e)){case 1:var i=vZ;break;case 4:i=_Z;break;default:i=xI}t=i.bind(null,e,t,n),i=void 0,!KA||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function eC(n,e,t,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;s=s.return}for(;a!==null;){if(s=fd(a),s===null)return;if(l=s.tag,l===5||l===6){r=o=s;continue e}a=a.parentNode}}r=r.return}Oj(function(){var c=o,u=mI(t),h=[];e:{var f=uB.get(n);if(f!==void 0){var m=wI,g=n;switch(n){case"keypress":if(My(t)===0)break e;case"keydown":case"keyup":m=kZ;break;case"focusin":g="focus",m=YT;break;case"focusout":g="blur",m=YT;break;case"beforeblur":case"afterblur":m=YT;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=WO;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=wZ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=DZ;break;case sB:case aB:case lB:m=TZ;break;case cB:m=FZ;break;case"scroll":m=xZ;break;case"wheel":m=BZ;break;case"copy":case"cut":case"paste":m=bZ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=YO}var _=(e&4)!==0,v=!_&&n==="scroll",p=_?f!==null?f+"Capture":null:f;_=[];for(var x=c,y;x!==null;){y=x;var w=y.stateNode;if(y.tag===5&&w!==null&&(y=w,p!==null&&(w=cv(x,p),w!=null&&_.push(gv(x,w,y)))),v)break;x=x.return}0<_.length&&(f=new m(f,g,null,t,u),h.push({event:f,listeners:_}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",f&&t!==$A&&(g=t.relatedTarget||t.fromElement)&&(fd(g)||g[Nl]))break e;if((m||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,m?(g=t.relatedTarget||t.toElement,m=c,g=g?fd(g):null,g!==null&&(v=ph(g),g!==v||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=c),m!==g)){if(_=WO,w="onMouseLeave",p="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(_=YO,w="onPointerLeave",p="onPointerEnter",x="pointer"),v=m==null?f:Zf(m),y=g==null?f:Zf(g),f=new _(w,x+"leave",m,t,u),f.target=v,f.relatedTarget=y,w=null,fd(u)===c&&(_=new _(p,x+"enter",g,t,u),_.target=y,_.relatedTarget=v,w=_),v=w,m&&g)t:{for(_=m,p=g,x=0,y=_;y;y=Yh(y))x++;for(y=0,w=p;w;w=Yh(w))y++;for(;0<x-y;)_=Yh(_),x--;for(;0<y-x;)p=Yh(p),y--;for(;x--;){if(_===p||p!==null&&_===p.alternate)break t;_=Yh(_),p=Yh(p)}_=null}else _=null;m!==null&&i3(h,f,m,_,!1),g!==null&&v!==null&&i3(h,v,g,_,!0)}}e:{if(f=c?Zf(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var C=YZ;else if(qO(f))if(tB)C=QZ;else{C=XZ;var T=KZ}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=qZ);if(C&&(C=C(n,c))){eB(h,C,t,u);break e}T&&T(n,f,c),n==="focusout"&&(T=f._wrapperState)&&T.controlled&&f.type==="number"&&zA(f,"number",f.value)}switch(T=c?Zf(c):window,n){case"focusin":(qO(T)||T.contentEditable==="true")&&(qf=T,JA=c,I0=null);break;case"focusout":I0=JA=qf=null;break;case"mousedown":eM=!0;break;case"contextmenu":case"mouseup":case"dragend":eM=!1,t3(h,t,u);break;case"selectionchange":if(eJ)break;case"keydown":case"keyup":t3(h,t,u)}var S;if(EI)e:{switch(n){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Xf?Zj(n,t)&&(b="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(b="onCompositionStart");b&&(Qj&&t.locale!=="ko"&&(Xf||b!=="onCompositionStart"?b==="onCompositionEnd"&&Xf&&(S=qj()):(Oc=u,yI="value"in Oc?Oc.value:Oc.textContent,Xf=!0)),T=Iw(c,b),0<T.length&&(b=new $O(b,n,null,t,u),h.push({event:b,listeners:T}),S?b.data=S:(S=Jj(t),S!==null&&(b.data=S)))),(S=HZ?VZ(n,t):GZ(n,t))&&(c=Iw(c,"onBeforeInput"),0<c.length&&(u=new $O("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:c}),u.data=S))}dB(h,e)})}function gv(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Iw(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=cv(n,t),o!=null&&r.unshift(gv(n,o,i)),o=cv(n,e),o!=null&&r.push(gv(n,o,i))),n=n.return}return r}function Yh(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function i3(n,e,t,r,i){for(var o=e._reactName,s=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=cv(t,o),l!=null&&s.unshift(gv(t,l,a))):i||(l=cv(t,o),l!=null&&s.push(gv(t,l,a)))),t=t.return}s.length!==0&&n.push({event:e,listeners:s})}var iJ=/\r\n?/g,oJ=/\u0000|\uFFFD/g;function o3(n){return(typeof n=="string"?n:""+n).replace(iJ,`
`).replace(oJ,"")}function cx(n,e,t){if(e=o3(e),o3(n)!==e&&t)throw Error(Ne(425))}function Pw(){}var tM=null,nM=null;function rM(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var iM=typeof setTimeout=="function"?setTimeout:void 0,sJ=typeof clearTimeout=="function"?clearTimeout:void 0,s3=typeof Promise=="function"?Promise:void 0,aJ=typeof queueMicrotask=="function"?queueMicrotask:typeof s3<"u"?function(n){return s3.resolve(null).then(n).catch(lJ)}:iM;function lJ(n){setTimeout(function(){throw n})}function tC(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),hv(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);hv(e)}function Wc(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function a3(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var jm=Math.random().toString(36).slice(2),pa="__reactFiber$"+jm,vv="__reactProps$"+jm,Nl="__reactContainer$"+jm,oM="__reactEvents$"+jm,cJ="__reactListeners$"+jm,uJ="__reactHandles$"+jm;function fd(n){var e=n[pa];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Nl]||t[pa]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=a3(n);n!==null;){if(t=n[pa])return t;n=a3(n)}return e}n=t,t=n.parentNode}return null}function t_(n){return n=n[pa]||n[Nl],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Zf(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Ne(33))}function DE(n){return n[vv]||null}var sM=[],Jf=-1;function xu(n){return{current:n}}function Un(n){0>Jf||(n.current=sM[Jf],sM[Jf]=null,Jf--)}function Nn(n,e){Jf++,sM[Jf]=n.current,n.current=e}var ou={},_i=xu(ou),Xi=xu(!1),Kd=ou;function om(n,e){var t=n.type.contextTypes;if(!t)return ou;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in t)i[o]=e[o];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function qi(n){return n=n.childContextTypes,n!=null}function kw(){Un(Xi),Un(_i)}function l3(n,e,t){if(_i.current!==ou)throw Error(Ne(168));Nn(_i,e),Nn(Xi,t)}function fB(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Ne(108,KQ(n)||"Unknown",i));return ir({},t,r)}function Lw(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||ou,Kd=_i.current,Nn(_i,n),Nn(Xi,Xi.current),!0}function c3(n,e,t){var r=n.stateNode;if(!r)throw Error(Ne(169));t?(n=fB(n,e,Kd),r.__reactInternalMemoizedMergedChildContext=n,Un(Xi),Un(_i),Nn(_i,n)):Un(Xi),Nn(Xi,t)}var el=null,UE=!1,nC=!1;function pB(n){el===null?el=[n]:el.push(n)}function dJ(n){UE=!0,pB(n)}function yu(){if(!nC&&el!==null){nC=!0;var n=0,e=vn;try{var t=el;for(vn=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}el=null,UE=!1}catch(i){throw el!==null&&(el=el.slice(n+1)),jj(gI,yu),i}finally{vn=e,nC=!1}}return null}var ep=[],tp=0,Ow=null,Dw=0,Yo=[],Ko=0,Xd=null,al=1,ll="";function $u(n,e){ep[tp++]=Dw,ep[tp++]=Ow,Ow=n,Dw=e}function mB(n,e,t){Yo[Ko++]=al,Yo[Ko++]=ll,Yo[Ko++]=Xd,Xd=n;var r=al;n=ll;var i=32-Os(r)-1;r&=~(1<<i),t+=1;var o=32-Os(e)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,al=1<<32-Os(e)+i|t<<i|r,ll=o+n}else al=1<<o|t<<i|r,ll=n}function CI(n){n.return!==null&&($u(n,1),mB(n,1,0))}function bI(n){for(;n===Ow;)Ow=ep[--tp],ep[tp]=null,Dw=ep[--tp],ep[tp]=null;for(;n===Xd;)Xd=Yo[--Ko],Yo[Ko]=null,ll=Yo[--Ko],Yo[Ko]=null,al=Yo[--Ko],Yo[Ko]=null}var Ao=null,To=null,Gn=!1,As=null;function gB(n,e){var t=es(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function u3(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Ao=n,To=Wc(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Ao=n,To=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Xd!==null?{id:al,overflow:ll}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=es(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Ao=n,To=null,!0):!1;default:return!1}}function aM(n){return(n.mode&1)!==0&&(n.flags&128)===0}function lM(n){if(Gn){var e=To;if(e){var t=e;if(!u3(n,e)){if(aM(n))throw Error(Ne(418));e=Wc(t.nextSibling);var r=Ao;e&&u3(n,e)?gB(r,t):(n.flags=n.flags&-4097|2,Gn=!1,Ao=n)}}else{if(aM(n))throw Error(Ne(418));n.flags=n.flags&-4097|2,Gn=!1,Ao=n}}}function d3(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Ao=n}function ux(n){if(n!==Ao)return!1;if(!Gn)return d3(n),Gn=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!rM(n.type,n.memoizedProps)),e&&(e=To)){if(aM(n))throw vB(),Error(Ne(418));for(;e;)gB(n,e),e=Wc(e.nextSibling)}if(d3(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Ne(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){To=Wc(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}To=null}}else To=Ao?Wc(n.stateNode.nextSibling):null;return!0}function vB(){for(var n=To;n;)n=Wc(n.nextSibling)}function sm(){To=Ao=null,Gn=!1}function AI(n){As===null?As=[n]:As.push(n)}var hJ=Vl.ReactCurrentBatchConfig;function fg(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Ne(309));var r=t.stateNode}if(!r)throw Error(Ne(147,n));var i=r,o=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var a=i.refs;s===null?delete a[o]:a[o]=s},e._stringRef=o,e)}if(typeof n!="string")throw Error(Ne(284));if(!t._owner)throw Error(Ne(290,n))}return n}function dx(n,e){throw n=Object.prototype.toString.call(e),Error(Ne(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function h3(n){var e=n._init;return e(n._payload)}function _B(n){function e(p,x){if(n){var y=p.deletions;y===null?(p.deletions=[x],p.flags|=16):y.push(x)}}function t(p,x){if(!n)return null;for(;x!==null;)e(p,x),x=x.sibling;return null}function r(p,x){for(p=new Map;x!==null;)x.key!==null?p.set(x.key,x):p.set(x.index,x),x=x.sibling;return p}function i(p,x){return p=Xc(p,x),p.index=0,p.sibling=null,p}function o(p,x,y){return p.index=y,n?(y=p.alternate,y!==null?(y=y.index,y<x?(p.flags|=2,x):y):(p.flags|=2,x)):(p.flags|=1048576,x)}function s(p){return n&&p.alternate===null&&(p.flags|=2),p}function a(p,x,y,w){return x===null||x.tag!==6?(x=cC(y,p.mode,w),x.return=p,x):(x=i(x,y),x.return=p,x)}function l(p,x,y,w){var C=y.type;return C===Kf?u(p,x,y.props.children,w,y.key):x!==null&&(x.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===xc&&h3(C)===x.type)?(w=i(x,y.props),w.ref=fg(p,x,y),w.return=p,w):(w=Oy(y.type,y.key,y.props,null,p.mode,w),w.ref=fg(p,x,y),w.return=p,w)}function c(p,x,y,w){return x===null||x.tag!==4||x.stateNode.containerInfo!==y.containerInfo||x.stateNode.implementation!==y.implementation?(x=uC(y,p.mode,w),x.return=p,x):(x=i(x,y.children||[]),x.return=p,x)}function u(p,x,y,w,C){return x===null||x.tag!==7?(x=Nd(y,p.mode,w,C),x.return=p,x):(x=i(x,y),x.return=p,x)}function h(p,x,y){if(typeof x=="string"&&x!==""||typeof x=="number")return x=cC(""+x,p.mode,y),x.return=p,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ex:return y=Oy(x.type,x.key,x.props,null,p.mode,y),y.ref=fg(p,null,x),y.return=p,y;case Yf:return x=uC(x,p.mode,y),x.return=p,x;case xc:var w=x._init;return h(p,w(x._payload),y)}if(r0(x)||lg(x))return x=Nd(x,p.mode,y,null),x.return=p,x;dx(p,x)}return null}function f(p,x,y,w){var C=x!==null?x.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return C!==null?null:a(p,x,""+y,w);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case ex:return y.key===C?l(p,x,y,w):null;case Yf:return y.key===C?c(p,x,y,w):null;case xc:return C=y._init,f(p,x,C(y._payload),w)}if(r0(y)||lg(y))return C!==null?null:u(p,x,y,w,null);dx(p,y)}return null}function m(p,x,y,w,C){if(typeof w=="string"&&w!==""||typeof w=="number")return p=p.get(y)||null,a(x,p,""+w,C);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ex:return p=p.get(w.key===null?y:w.key)||null,l(x,p,w,C);case Yf:return p=p.get(w.key===null?y:w.key)||null,c(x,p,w,C);case xc:var T=w._init;return m(p,x,y,T(w._payload),C)}if(r0(w)||lg(w))return p=p.get(y)||null,u(x,p,w,C,null);dx(x,w)}return null}function g(p,x,y,w){for(var C=null,T=null,S=x,b=x=0,R=null;S!==null&&b<y.length;b++){S.index>b?(R=S,S=null):R=S.sibling;var E=f(p,S,y[b],w);if(E===null){S===null&&(S=R);break}n&&S&&E.alternate===null&&e(p,S),x=o(E,x,b),T===null?C=E:T.sibling=E,T=E,S=R}if(b===y.length)return t(p,S),Gn&&$u(p,b),C;if(S===null){for(;b<y.length;b++)S=h(p,y[b],w),S!==null&&(x=o(S,x,b),T===null?C=S:T.sibling=S,T=S);return Gn&&$u(p,b),C}for(S=r(p,S);b<y.length;b++)R=m(S,p,b,y[b],w),R!==null&&(n&&R.alternate!==null&&S.delete(R.key===null?b:R.key),x=o(R,x,b),T===null?C=R:T.sibling=R,T=R);return n&&S.forEach(function(A){return e(p,A)}),Gn&&$u(p,b),C}function _(p,x,y,w){var C=lg(y);if(typeof C!="function")throw Error(Ne(150));if(y=C.call(y),y==null)throw Error(Ne(151));for(var T=C=null,S=x,b=x=0,R=null,E=y.next();S!==null&&!E.done;b++,E=y.next()){S.index>b?(R=S,S=null):R=S.sibling;var A=f(p,S,E.value,w);if(A===null){S===null&&(S=R);break}n&&S&&A.alternate===null&&e(p,S),x=o(A,x,b),T===null?C=A:T.sibling=A,T=A,S=R}if(E.done)return t(p,S),Gn&&$u(p,b),C;if(S===null){for(;!E.done;b++,E=y.next())E=h(p,E.value,w),E!==null&&(x=o(E,x,b),T===null?C=E:T.sibling=E,T=E);return Gn&&$u(p,b),C}for(S=r(p,S);!E.done;b++,E=y.next())E=m(S,p,b,E.value,w),E!==null&&(n&&E.alternate!==null&&S.delete(E.key===null?b:E.key),x=o(E,x,b),T===null?C=E:T.sibling=E,T=E);return n&&S.forEach(function(F){return e(p,F)}),Gn&&$u(p,b),C}function v(p,x,y,w){if(typeof y=="object"&&y!==null&&y.type===Kf&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case ex:e:{for(var C=y.key,T=x;T!==null;){if(T.key===C){if(C=y.type,C===Kf){if(T.tag===7){t(p,T.sibling),x=i(T,y.props.children),x.return=p,p=x;break e}}else if(T.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===xc&&h3(C)===T.type){t(p,T.sibling),x=i(T,y.props),x.ref=fg(p,T,y),x.return=p,p=x;break e}t(p,T);break}else e(p,T);T=T.sibling}y.type===Kf?(x=Nd(y.props.children,p.mode,w,y.key),x.return=p,p=x):(w=Oy(y.type,y.key,y.props,null,p.mode,w),w.ref=fg(p,x,y),w.return=p,p=w)}return s(p);case Yf:e:{for(T=y.key;x!==null;){if(x.key===T)if(x.tag===4&&x.stateNode.containerInfo===y.containerInfo&&x.stateNode.implementation===y.implementation){t(p,x.sibling),x=i(x,y.children||[]),x.return=p,p=x;break e}else{t(p,x);break}else e(p,x);x=x.sibling}x=uC(y,p.mode,w),x.return=p,p=x}return s(p);case xc:return T=y._init,v(p,x,T(y._payload),w)}if(r0(y))return g(p,x,y,w);if(lg(y))return _(p,x,y,w);dx(p,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,x!==null&&x.tag===6?(t(p,x.sibling),x=i(x,y),x.return=p,p=x):(t(p,x),x=cC(y,p.mode,w),x.return=p,p=x),s(p)):t(p,x)}return v}var am=_B(!0),xB=_B(!1),Uw=xu(null),Fw=null,np=null,MI=null;function RI(){MI=np=Fw=null}function NI(n){var e=Uw.current;Un(Uw),n._currentValue=e}function cM(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Ap(n,e){Fw=n,MI=np=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Wi=!0),n.firstContext=null)}function os(n){var e=n._currentValue;if(MI!==n)if(n={context:n,memoizedValue:e,next:null},np===null){if(Fw===null)throw Error(Ne(308));np=n,Fw.dependencies={lanes:0,firstContext:n}}else np=np.next=n;return e}var pd=null;function II(n){pd===null?pd=[n]:pd.push(n)}function yB(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,II(e)):(t.next=i.next,i.next=t),e.interleaved=t,Il(n,r)}function Il(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var yc=!1;function PI(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function wB(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ml(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function $c(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Jt&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Il(n,t)}return i=r.interleaved,i===null?(e.next=e,II(r)):(e.next=i.next,i.next=e),r.interleaved=e,Il(n,t)}function Ry(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,vI(n,t)}}function f3(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var s={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?i=o=s:o=o.next=s,t=t.next}while(t!==null);o===null?i=o=e:o=o.next=e}else i=o=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function jw(n,e,t,r){var i=n.updateQueue;yc=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,s===null?o=c:s.next=c,s=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==s&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(o!==null){var h=i.baseState;s=0,u=c=l=null,a=o;do{var f=a.lane,m=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=n,_=a;switch(f=e,m=t,_.tag){case 1:if(g=_.payload,typeof g=="function"){h=g.call(m,h,f);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=_.payload,f=typeof g=="function"?g.call(m,h,f):g,f==null)break e;h=ir({},h,f);break e;case 2:yc=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=m,l=h):u=u.next=m,s|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(u===null&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Qd|=s,n.lanes=s,n.memoizedState=h}}function p3(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(Ne(191,i));i.call(r)}}}var n_={},Ta=xu(n_),_v=xu(n_),xv=xu(n_);function md(n){if(n===n_)throw Error(Ne(174));return n}function kI(n,e){switch(Nn(xv,e),Nn(_v,n),Nn(Ta,n_),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:VA(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=VA(e,n)}Un(Ta),Nn(Ta,e)}function lm(){Un(Ta),Un(_v),Un(xv)}function SB(n){md(xv.current);var e=md(Ta.current),t=VA(e,n.type);e!==t&&(Nn(_v,n),Nn(Ta,t))}function LI(n){_v.current===n&&(Un(Ta),Un(_v))}var Qn=xu(0);function Bw(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var rC=[];function OI(){for(var n=0;n<rC.length;n++)rC[n]._workInProgressVersionPrimary=null;rC.length=0}var Ny=Vl.ReactCurrentDispatcher,iC=Vl.ReactCurrentBatchConfig,qd=0,nr=null,Ar=null,Br=null,zw=!1,P0=!1,yv=0,fJ=0;function oi(){throw Error(Ne(321))}function DI(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!zs(n[t],e[t]))return!1;return!0}function UI(n,e,t,r,i,o){if(qd=o,nr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ny.current=n===null||n.memoizedState===null?vJ:_J,n=t(r,i),P0){o=0;do{if(P0=!1,yv=0,25<=o)throw Error(Ne(301));o+=1,Br=Ar=null,e.updateQueue=null,Ny.current=xJ,n=t(r,i)}while(P0)}if(Ny.current=Hw,e=Ar!==null&&Ar.next!==null,qd=0,Br=Ar=nr=null,zw=!1,e)throw Error(Ne(300));return n}function FI(){var n=yv!==0;return yv=0,n}function aa(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Br===null?nr.memoizedState=Br=n:Br=Br.next=n,Br}function ss(){if(Ar===null){var n=nr.alternate;n=n!==null?n.memoizedState:null}else n=Ar.next;var e=Br===null?nr.memoizedState:Br.next;if(e!==null)Br=e,Ar=n;else{if(n===null)throw Error(Ne(310));Ar=n,n={memoizedState:Ar.memoizedState,baseState:Ar.baseState,baseQueue:Ar.baseQueue,queue:Ar.queue,next:null},Br===null?nr.memoizedState=Br=n:Br=Br.next=n}return Br}function wv(n,e){return typeof e=="function"?e(n):e}function oC(n){var e=ss(),t=e.queue;if(t===null)throw Error(Ne(311));t.lastRenderedReducer=n;var r=Ar,i=r.baseQueue,o=t.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,t.pending=null}if(i!==null){o=i.next,r=r.baseState;var a=s=null,l=null,c=o;do{var u=c.lane;if((qd&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,s=r):l=l.next=h,nr.lanes|=u,Qd|=u}c=c.next}while(c!==null&&c!==o);l===null?s=r:l.next=a,zs(r,e.memoizedState)||(Wi=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do o=i.lane,nr.lanes|=o,Qd|=o,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function sC(n){var e=ss(),t=e.queue;if(t===null)throw Error(Ne(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,o=e.memoizedState;if(i!==null){t.pending=null;var s=i=i.next;do o=n(o,s.action),s=s.next;while(s!==i);zs(o,e.memoizedState)||(Wi=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),t.lastRenderedState=o}return[o,r]}function EB(){}function TB(n,e){var t=nr,r=ss(),i=e(),o=!zs(r.memoizedState,i);if(o&&(r.memoizedState=i,Wi=!0),r=r.queue,jI(AB.bind(null,t,r,n),[n]),r.getSnapshot!==e||o||Br!==null&&Br.memoizedState.tag&1){if(t.flags|=2048,Sv(9,bB.bind(null,t,r,i,e),void 0,null),Vr===null)throw Error(Ne(349));qd&30||CB(t,e,i)}return i}function CB(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=nr.updateQueue,e===null?(e={lastEffect:null,stores:null},nr.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function bB(n,e,t,r){e.value=t,e.getSnapshot=r,MB(e)&&RB(n)}function AB(n,e,t){return t(function(){MB(e)&&RB(n)})}function MB(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!zs(n,t)}catch{return!0}}function RB(n){var e=Il(n,1);e!==null&&Ds(e,n,1,-1)}function m3(n){var e=aa();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wv,lastRenderedState:n},e.queue=n,n=n.dispatch=gJ.bind(null,nr,n),[e.memoizedState,n]}function Sv(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=nr.updateQueue,e===null?(e={lastEffect:null,stores:null},nr.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function NB(){return ss().memoizedState}function Iy(n,e,t,r){var i=aa();nr.flags|=n,i.memoizedState=Sv(1|e,t,void 0,r===void 0?null:r)}function FE(n,e,t,r){var i=ss();r=r===void 0?null:r;var o=void 0;if(Ar!==null){var s=Ar.memoizedState;if(o=s.destroy,r!==null&&DI(r,s.deps)){i.memoizedState=Sv(e,t,o,r);return}}nr.flags|=n,i.memoizedState=Sv(1|e,t,o,r)}function g3(n,e){return Iy(8390656,8,n,e)}function jI(n,e){return FE(2048,8,n,e)}function IB(n,e){return FE(4,2,n,e)}function PB(n,e){return FE(4,4,n,e)}function kB(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function LB(n,e,t){return t=t!=null?t.concat([n]):null,FE(4,4,kB.bind(null,e,n),t)}function BI(){}function OB(n,e){var t=ss();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&DI(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function DB(n,e){var t=ss();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&DI(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function UB(n,e,t){return qd&21?(zs(t,e)||(t=Hj(),nr.lanes|=t,Qd|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Wi=!0),n.memoizedState=t)}function pJ(n,e){var t=vn;vn=t!==0&&4>t?t:4,n(!0);var r=iC.transition;iC.transition={};try{n(!1),e()}finally{vn=t,iC.transition=r}}function FB(){return ss().memoizedState}function mJ(n,e,t){var r=Kc(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},jB(n))BB(e,t);else if(t=yB(n,e,t,r),t!==null){var i=Li();Ds(t,n,r,i),zB(t,e,r)}}function gJ(n,e,t){var r=Kc(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(jB(n))BB(e,i);else{var o=n.alternate;if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,a=o(s,t);if(i.hasEagerState=!0,i.eagerState=a,zs(a,s)){var l=e.interleaved;l===null?(i.next=i,II(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=yB(n,e,i,r),t!==null&&(i=Li(),Ds(t,n,r,i),zB(t,e,r))}}function jB(n){var e=n.alternate;return n===nr||e!==null&&e===nr}function BB(n,e){P0=zw=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function zB(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,vI(n,t)}}var Hw={readContext:os,useCallback:oi,useContext:oi,useEffect:oi,useImperativeHandle:oi,useInsertionEffect:oi,useLayoutEffect:oi,useMemo:oi,useReducer:oi,useRef:oi,useState:oi,useDebugValue:oi,useDeferredValue:oi,useTransition:oi,useMutableSource:oi,useSyncExternalStore:oi,useId:oi,unstable_isNewReconciler:!1},vJ={readContext:os,useCallback:function(n,e){return aa().memoizedState=[n,e===void 0?null:e],n},useContext:os,useEffect:g3,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Iy(4194308,4,kB.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Iy(4194308,4,n,e)},useInsertionEffect:function(n,e){return Iy(4,2,n,e)},useMemo:function(n,e){var t=aa();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=aa();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=mJ.bind(null,nr,n),[r.memoizedState,n]},useRef:function(n){var e=aa();return n={current:n},e.memoizedState=n},useState:m3,useDebugValue:BI,useDeferredValue:function(n){return aa().memoizedState=n},useTransition:function(){var n=m3(!1),e=n[0];return n=pJ.bind(null,n[1]),aa().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=nr,i=aa();if(Gn){if(t===void 0)throw Error(Ne(407));t=t()}else{if(t=e(),Vr===null)throw Error(Ne(349));qd&30||CB(r,e,t)}i.memoizedState=t;var o={value:t,getSnapshot:e};return i.queue=o,g3(AB.bind(null,r,o,n),[n]),r.flags|=2048,Sv(9,bB.bind(null,r,o,t,e),void 0,null),t},useId:function(){var n=aa(),e=Vr.identifierPrefix;if(Gn){var t=ll,r=al;t=(r&~(1<<32-Os(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=yv++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=fJ++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},_J={readContext:os,useCallback:OB,useContext:os,useEffect:jI,useImperativeHandle:LB,useInsertionEffect:IB,useLayoutEffect:PB,useMemo:DB,useReducer:oC,useRef:NB,useState:function(){return oC(wv)},useDebugValue:BI,useDeferredValue:function(n){var e=ss();return UB(e,Ar.memoizedState,n)},useTransition:function(){var n=oC(wv)[0],e=ss().memoizedState;return[n,e]},useMutableSource:EB,useSyncExternalStore:TB,useId:FB,unstable_isNewReconciler:!1},xJ={readContext:os,useCallback:OB,useContext:os,useEffect:jI,useImperativeHandle:LB,useInsertionEffect:IB,useLayoutEffect:PB,useMemo:DB,useReducer:sC,useRef:NB,useState:function(){return sC(wv)},useDebugValue:BI,useDeferredValue:function(n){var e=ss();return Ar===null?e.memoizedState=n:UB(e,Ar.memoizedState,n)},useTransition:function(){var n=sC(wv)[0],e=ss().memoizedState;return[n,e]},useMutableSource:EB,useSyncExternalStore:TB,useId:FB,unstable_isNewReconciler:!1};function Es(n,e){if(n&&n.defaultProps){e=ir({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function uM(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:ir({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var jE={isMounted:function(n){return(n=n._reactInternals)?ph(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Li(),i=Kc(n),o=ml(r,i);o.payload=e,t!=null&&(o.callback=t),e=$c(n,o,i),e!==null&&(Ds(e,n,i,r),Ry(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Li(),i=Kc(n),o=ml(r,i);o.tag=1,o.payload=e,t!=null&&(o.callback=t),e=$c(n,o,i),e!==null&&(Ds(e,n,i,r),Ry(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Li(),r=Kc(n),i=ml(t,r);i.tag=2,e!=null&&(i.callback=e),e=$c(n,i,r),e!==null&&(Ds(e,n,r,t),Ry(e,n,r))}};function v3(n,e,t,r,i,o,s){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!pv(t,r)||!pv(i,o):!0}function HB(n,e,t){var r=!1,i=ou,o=e.contextType;return typeof o=="object"&&o!==null?o=os(o):(i=qi(e)?Kd:_i.current,r=e.contextTypes,o=(r=r!=null)?om(n,i):ou),e=new e(t,o),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=jE,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=o),e}function _3(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&jE.enqueueReplaceState(e,e.state,null)}function dM(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},PI(n);var o=e.contextType;typeof o=="object"&&o!==null?i.context=os(o):(o=qi(e)?Kd:_i.current,i.context=om(n,o)),i.state=n.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(uM(n,e,o,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&jE.enqueueReplaceState(i,i.state,null),jw(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function cm(n,e){try{var t="",r=e;do t+=YQ(r),r=r.return;while(r);var i=t}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:n,source:e,stack:i,digest:null}}function aC(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function hM(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var yJ=typeof WeakMap=="function"?WeakMap:Map;function VB(n,e,t){t=ml(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Gw||(Gw=!0,SM=r),hM(n,e)},t}function GB(n,e,t){t=ml(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){hM(n,e)}}var o=n.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){hM(n,e),typeof r!="function"&&(Yc===null?Yc=new Set([this]):Yc.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),t}function x3(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new yJ;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=LJ.bind(null,n,e,t),e.then(n,n))}function y3(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function w3(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ml(-1,1),e.tag=2,$c(t,e,1))),t.lanes|=1),n)}var wJ=Vl.ReactCurrentOwner,Wi=!1;function Ci(n,e,t,r){e.child=n===null?xB(e,null,t,r):am(e,n.child,t,r)}function S3(n,e,t,r,i){t=t.render;var o=e.ref;return Ap(e,i),r=UI(n,e,t,r,o,i),t=FI(),n!==null&&!Wi?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Pl(n,e,i)):(Gn&&t&&CI(e),e.flags|=1,Ci(n,e,r,i),e.child)}function E3(n,e,t,r,i){if(n===null){var o=t.type;return typeof o=="function"&&!KI(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,WB(n,e,o,r,i)):(n=Oy(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(o=n.child,!(n.lanes&i)){var s=o.memoizedProps;if(t=t.compare,t=t!==null?t:pv,t(s,r)&&n.ref===e.ref)return Pl(n,e,i)}return e.flags|=1,n=Xc(o,r),n.ref=e.ref,n.return=e,e.child=n}function WB(n,e,t,r,i){if(n!==null){var o=n.memoizedProps;if(pv(o,r)&&n.ref===e.ref)if(Wi=!1,e.pendingProps=r=o,(n.lanes&i)!==0)n.flags&131072&&(Wi=!0);else return e.lanes=n.lanes,Pl(n,e,i)}return fM(n,e,t,r,i)}function $B(n,e,t){var r=e.pendingProps,i=r.children,o=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Nn(ip,_o),_o|=t;else{if(!(t&1073741824))return n=o!==null?o.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Nn(ip,_o),_o|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:t,Nn(ip,_o),_o|=r}else o!==null?(r=o.baseLanes|t,e.memoizedState=null):r=t,Nn(ip,_o),_o|=r;return Ci(n,e,i,t),e.child}function YB(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function fM(n,e,t,r,i){var o=qi(t)?Kd:_i.current;return o=om(e,o),Ap(e,i),t=UI(n,e,t,r,o,i),r=FI(),n!==null&&!Wi?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Pl(n,e,i)):(Gn&&r&&CI(e),e.flags|=1,Ci(n,e,t,i),e.child)}function T3(n,e,t,r,i){if(qi(t)){var o=!0;Lw(e)}else o=!1;if(Ap(e,i),e.stateNode===null)Py(n,e),HB(e,t,r),dM(e,t,r,i),r=!0;else if(n===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var l=s.context,c=t.contextType;typeof c=="object"&&c!==null?c=os(c):(c=qi(t)?Kd:_i.current,c=om(e,c));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof s.getSnapshotBeforeUpdate=="function";h||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||l!==c)&&_3(e,s,r,c),yc=!1;var f=e.memoizedState;s.state=f,jw(e,r,s,i),l=e.memoizedState,a!==r||f!==l||Xi.current||yc?(typeof u=="function"&&(uM(e,t,u,r),l=e.memoizedState),(a=yc||v3(e,t,a,r,f,l,c))?(h||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,wB(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:Es(e.type,a),s.props=c,h=e.pendingProps,f=s.context,l=t.contextType,typeof l=="object"&&l!==null?l=os(l):(l=qi(t)?Kd:_i.current,l=om(e,l));var m=t.getDerivedStateFromProps;(u=typeof m=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==h||f!==l)&&_3(e,s,r,l),yc=!1,f=e.memoizedState,s.state=f,jw(e,r,s,i);var g=e.memoizedState;a!==h||f!==g||Xi.current||yc?(typeof m=="function"&&(uM(e,t,m,r),g=e.memoizedState),(c=yc||v3(e,t,c,r,f,g,l)||!1)?(u||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,g,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,g,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),s.props=r,s.state=g,s.context=l,r=c):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return pM(n,e,t,r,o,i)}function pM(n,e,t,r,i,o){YB(n,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&c3(e,t,!1),Pl(n,e,o);r=e.stateNode,wJ.current=e;var a=s&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&s?(e.child=am(e,n.child,null,o),e.child=am(e,null,a,o)):Ci(n,e,a,o),e.memoizedState=r.state,i&&c3(e,t,!0),e.child}function KB(n){var e=n.stateNode;e.pendingContext?l3(n,e.pendingContext,e.pendingContext!==e.context):e.context&&l3(n,e.context,!1),kI(n,e.containerInfo)}function C3(n,e,t,r,i){return sm(),AI(i),e.flags|=256,Ci(n,e,t,r),e.child}var mM={dehydrated:null,treeContext:null,retryLane:0};function gM(n){return{baseLanes:n,cachePool:null,transitions:null}}function XB(n,e,t){var r=e.pendingProps,i=Qn.current,o=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(o=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Nn(Qn,i&1),n===null)return lM(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,n=r.fallback,o?(r=e.mode,o=e.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=HE(s,r,0,null),n=Nd(n,r,t,null),o.return=e,n.return=e,o.sibling=n,e.child=o,e.child.memoizedState=gM(t),e.memoizedState=mM,n):zI(e,s));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return SJ(n,e,s,r,a,i,t);if(o){o=r.fallback,s=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Xc(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=Xc(a,o):(o=Nd(o,s,t,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,s=n.child.memoizedState,s=s===null?gM(t):{baseLanes:s.baseLanes|t,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=n.childLanes&~t,e.memoizedState=mM,r}return o=n.child,n=o.sibling,r=Xc(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function zI(n,e){return e=HE({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function hx(n,e,t,r){return r!==null&&AI(r),am(e,n.child,null,t),n=zI(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function SJ(n,e,t,r,i,o,s){if(t)return e.flags&256?(e.flags&=-257,r=aC(Error(Ne(422))),hx(n,e,s,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=HE({mode:"visible",children:r.children},i,0,null),o=Nd(o,i,s,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&am(e,n.child,null,s),e.child.memoizedState=gM(s),e.memoizedState=mM,o);if(!(e.mode&1))return hx(n,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,o=Error(Ne(419)),r=aC(o,r,void 0),hx(n,e,s,r)}if(a=(s&n.childLanes)!==0,Wi||a){if(r=Vr,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Il(n,i),Ds(r,n,i,-1))}return YI(),r=aC(Error(Ne(421))),hx(n,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=OJ.bind(null,n),i._reactRetry=e,null):(n=o.treeContext,To=Wc(i.nextSibling),Ao=e,Gn=!0,As=null,n!==null&&(Yo[Ko++]=al,Yo[Ko++]=ll,Yo[Ko++]=Xd,al=n.id,ll=n.overflow,Xd=e),e=zI(e,r.children),e.flags|=4096,e)}function b3(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),cM(n.return,e,t)}function lC(n,e,t,r,i){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i)}function qB(n,e,t){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Ci(n,e,r.children,t),r=Qn.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&b3(n,t,e);else if(n.tag===19)b3(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Nn(Qn,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Bw(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),lC(e,!1,i,t,o);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Bw(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}lC(e,!0,t,null,o);break;case"together":lC(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Py(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Pl(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Qd|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Ne(153));if(e.child!==null){for(n=e.child,t=Xc(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Xc(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function EJ(n,e,t){switch(e.tag){case 3:KB(e),sm();break;case 5:SB(e);break;case 1:qi(e.type)&&Lw(e);break;case 4:kI(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Nn(Uw,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Nn(Qn,Qn.current&1),e.flags|=128,null):t&e.child.childLanes?XB(n,e,t):(Nn(Qn,Qn.current&1),n=Pl(n,e,t),n!==null?n.sibling:null);Nn(Qn,Qn.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return qB(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Nn(Qn,Qn.current),r)break;return null;case 22:case 23:return e.lanes=0,$B(n,e,t)}return Pl(n,e,t)}var QB,vM,ZB,JB;QB=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};vM=function(){};ZB=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,md(Ta.current);var o=null;switch(t){case"input":i=jA(n,i),r=jA(n,r),o=[];break;case"select":i=ir({},i,{value:void 0}),r=ir({},r,{value:void 0}),o=[];break;case"textarea":i=HA(n,i),r=HA(n,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Pw)}GA(t,r);var s;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(s in a)a.hasOwnProperty(s)&&(t||(t={}),t[s]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(av.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(s in a)!a.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(t||(t={}),t[s]="");for(s in l)l.hasOwnProperty(s)&&a[s]!==l[s]&&(t||(t={}),t[s]=l[s])}else t||(o||(o=[]),o.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(av.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Ln("scroll",n),o||a===l||(o=[])):(o=o||[]).push(c,l))}t&&(o=o||[]).push("style",t);var c=o;(e.updateQueue=c)&&(e.flags|=4)}};JB=function(n,e,t,r){t!==r&&(e.flags|=4)};function pg(n,e){if(!Gn)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function si(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function TJ(n,e,t){var r=e.pendingProps;switch(bI(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return si(e),null;case 1:return qi(e.type)&&kw(),si(e),null;case 3:return r=e.stateNode,lm(),Un(Xi),Un(_i),OI(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(ux(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,As!==null&&(CM(As),As=null))),vM(n,e),si(e),null;case 5:LI(e);var i=md(xv.current);if(t=e.type,n!==null&&e.stateNode!=null)ZB(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Ne(166));return si(e),null}if(n=md(Ta.current),ux(e)){r=e.stateNode,t=e.type;var o=e.memoizedProps;switch(r[pa]=e,r[vv]=o,n=(e.mode&1)!==0,t){case"dialog":Ln("cancel",r),Ln("close",r);break;case"iframe":case"object":case"embed":Ln("load",r);break;case"video":case"audio":for(i=0;i<o0.length;i++)Ln(o0[i],r);break;case"source":Ln("error",r);break;case"img":case"image":case"link":Ln("error",r),Ln("load",r);break;case"details":Ln("toggle",r);break;case"input":OO(r,o),Ln("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Ln("invalid",r);break;case"textarea":UO(r,o),Ln("invalid",r)}GA(t,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?r.textContent!==a&&(o.suppressHydrationWarning!==!0&&cx(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&cx(r.textContent,a,n),i=["children",""+a]):av.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&Ln("scroll",r)}switch(t){case"input":tx(r),DO(r,o,!0);break;case"textarea":tx(r),FO(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Pw)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Aj(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=s.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=s.createElement(t,{is:r.is}):(n=s.createElement(t),t==="select"&&(s=n,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):n=s.createElementNS(n,t),n[pa]=e,n[vv]=r,QB(n,e,!1,!1),e.stateNode=n;e:{switch(s=WA(t,r),t){case"dialog":Ln("cancel",n),Ln("close",n),i=r;break;case"iframe":case"object":case"embed":Ln("load",n),i=r;break;case"video":case"audio":for(i=0;i<o0.length;i++)Ln(o0[i],n);i=r;break;case"source":Ln("error",n),i=r;break;case"img":case"image":case"link":Ln("error",n),Ln("load",n),i=r;break;case"details":Ln("toggle",n),i=r;break;case"input":OO(n,r),i=jA(n,r),Ln("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=ir({},r,{value:void 0}),Ln("invalid",n);break;case"textarea":UO(n,r),i=HA(n,r),Ln("invalid",n);break;default:i=r}GA(t,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?Nj(n,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Mj(n,l)):o==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&lv(n,l):typeof l=="number"&&lv(n,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(av.hasOwnProperty(o)?l!=null&&o==="onScroll"&&Ln("scroll",n):l!=null&&dI(n,o,l,s))}switch(t){case"input":tx(n),DO(n,r,!1);break;case"textarea":tx(n),FO(n);break;case"option":r.value!=null&&n.setAttribute("value",""+iu(r.value));break;case"select":n.multiple=!!r.multiple,o=r.value,o!=null?Ep(n,!!r.multiple,o,!1):r.defaultValue!=null&&Ep(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Pw)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return si(e),null;case 6:if(n&&e.stateNode!=null)JB(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Ne(166));if(t=md(xv.current),md(Ta.current),ux(e)){if(r=e.stateNode,t=e.memoizedProps,r[pa]=e,(o=r.nodeValue!==t)&&(n=Ao,n!==null))switch(n.tag){case 3:cx(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&cx(r.nodeValue,t,(n.mode&1)!==0)}o&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[pa]=e,e.stateNode=r}return si(e),null;case 13:if(Un(Qn),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Gn&&To!==null&&e.mode&1&&!(e.flags&128))vB(),sm(),e.flags|=98560,o=!1;else if(o=ux(e),r!==null&&r.dehydrated!==null){if(n===null){if(!o)throw Error(Ne(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Ne(317));o[pa]=e}else sm(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;si(e),o=!1}else As!==null&&(CM(As),As=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Qn.current&1?Nr===0&&(Nr=3):YI())),e.updateQueue!==null&&(e.flags|=4),si(e),null);case 4:return lm(),vM(n,e),n===null&&mv(e.stateNode.containerInfo),si(e),null;case 10:return NI(e.type._context),si(e),null;case 17:return qi(e.type)&&kw(),si(e),null;case 19:if(Un(Qn),o=e.memoizedState,o===null)return si(e),null;if(r=(e.flags&128)!==0,s=o.rendering,s===null)if(r)pg(o,!1);else{if(Nr!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(s=Bw(n),s!==null){for(e.flags|=128,pg(o,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)o=t,n=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=n,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,n=s.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Nn(Qn,Qn.current&1|2),e.child}n=n.sibling}o.tail!==null&&hr()>um&&(e.flags|=128,r=!0,pg(o,!1),e.lanes=4194304)}else{if(!r)if(n=Bw(s),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),pg(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!Gn)return si(e),null}else 2*hr()-o.renderingStartTime>um&&t!==1073741824&&(e.flags|=128,r=!0,pg(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(t=o.last,t!==null?t.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=hr(),e.sibling=null,t=Qn.current,Nn(Qn,r?t&1|2:t&1),e):(si(e),null);case 22:case 23:return $I(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?_o&1073741824&&(si(e),e.subtreeFlags&6&&(e.flags|=8192)):si(e),null;case 24:return null;case 25:return null}throw Error(Ne(156,e.tag))}function CJ(n,e){switch(bI(e),e.tag){case 1:return qi(e.type)&&kw(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return lm(),Un(Xi),Un(_i),OI(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return LI(e),null;case 13:if(Un(Qn),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Ne(340));sm()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Un(Qn),null;case 4:return lm(),null;case 10:return NI(e.type._context),null;case 22:case 23:return $I(),null;case 24:return null;default:return null}}var fx=!1,pi=!1,bJ=typeof WeakSet=="function"?WeakSet:Set,Ze=null;function rp(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){lr(n,e,r)}else t.current=null}function _M(n,e,t){try{t()}catch(r){lr(n,e,r)}}var A3=!1;function AJ(n,e){if(tM=Rw,n=iB(),TI(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var s=0,a=-1,l=-1,c=0,u=0,h=n,f=null;t:for(;;){for(var m;h!==t||i!==0&&h.nodeType!==3||(a=s+i),h!==o||r!==0&&h.nodeType!==3||(l=s+r),h.nodeType===3&&(s+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===n)break t;if(f===t&&++c===i&&(a=s),f===o&&++u===r&&(l=s),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(nM={focusedElem:n,selectionRange:t},Rw=!1,Ze=e;Ze!==null;)if(e=Ze,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Ze=n;else for(;Ze!==null;){e=Ze;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var _=g.memoizedProps,v=g.memoizedState,p=e.stateNode,x=p.getSnapshotBeforeUpdate(e.elementType===e.type?_:Es(e.type,_),v);p.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ne(163))}}catch(w){lr(e,e.return,w)}if(n=e.sibling,n!==null){n.return=e.return,Ze=n;break}Ze=e.return}return g=A3,A3=!1,g}function k0(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var o=i.destroy;i.destroy=void 0,o!==void 0&&_M(e,t,o)}i=i.next}while(i!==r)}}function BE(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function xM(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function ez(n){var e=n.alternate;e!==null&&(n.alternate=null,ez(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[pa],delete e[vv],delete e[oM],delete e[cJ],delete e[uJ])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function tz(n){return n.tag===5||n.tag===3||n.tag===4}function M3(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||tz(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function yM(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Pw));else if(r!==4&&(n=n.child,n!==null))for(yM(n,e,t),n=n.sibling;n!==null;)yM(n,e,t),n=n.sibling}function wM(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(wM(n,e,t),n=n.sibling;n!==null;)wM(n,e,t),n=n.sibling}var Kr=null,Ts=!1;function nc(n,e,t){for(t=t.child;t!==null;)nz(n,e,t),t=t.sibling}function nz(n,e,t){if(Ea&&typeof Ea.onCommitFiberUnmount=="function")try{Ea.onCommitFiberUnmount(PE,t)}catch{}switch(t.tag){case 5:pi||rp(t,e);case 6:var r=Kr,i=Ts;Kr=null,nc(n,e,t),Kr=r,Ts=i,Kr!==null&&(Ts?(n=Kr,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Kr.removeChild(t.stateNode));break;case 18:Kr!==null&&(Ts?(n=Kr,t=t.stateNode,n.nodeType===8?tC(n.parentNode,t):n.nodeType===1&&tC(n,t),hv(n)):tC(Kr,t.stateNode));break;case 4:r=Kr,i=Ts,Kr=t.stateNode.containerInfo,Ts=!0,nc(n,e,t),Kr=r,Ts=i;break;case 0:case 11:case 14:case 15:if(!pi&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&_M(t,e,s),i=i.next}while(i!==r)}nc(n,e,t);break;case 1:if(!pi&&(rp(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){lr(t,e,a)}nc(n,e,t);break;case 21:nc(n,e,t);break;case 22:t.mode&1?(pi=(r=pi)||t.memoizedState!==null,nc(n,e,t),pi=r):nc(n,e,t);break;default:nc(n,e,t)}}function R3(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new bJ),e.forEach(function(r){var i=DJ.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function vs(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var o=n,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:Kr=a.stateNode,Ts=!1;break e;case 3:Kr=a.stateNode.containerInfo,Ts=!0;break e;case 4:Kr=a.stateNode.containerInfo,Ts=!0;break e}a=a.return}if(Kr===null)throw Error(Ne(160));nz(o,s,i),Kr=null,Ts=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){lr(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)rz(e,n),e=e.sibling}function rz(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(vs(e,n),Zs(n),r&4){try{k0(3,n,n.return),BE(3,n)}catch(_){lr(n,n.return,_)}try{k0(5,n,n.return)}catch(_){lr(n,n.return,_)}}break;case 1:vs(e,n),Zs(n),r&512&&t!==null&&rp(t,t.return);break;case 5:if(vs(e,n),Zs(n),r&512&&t!==null&&rp(t,t.return),n.flags&32){var i=n.stateNode;try{lv(i,"")}catch(_){lr(n,n.return,_)}}if(r&4&&(i=n.stateNode,i!=null)){var o=n.memoizedProps,s=t!==null?t.memoizedProps:o,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&Cj(i,o),WA(a,s);var c=WA(a,o);for(s=0;s<l.length;s+=2){var u=l[s],h=l[s+1];u==="style"?Nj(i,h):u==="dangerouslySetInnerHTML"?Mj(i,h):u==="children"?lv(i,h):dI(i,u,h,c)}switch(a){case"input":BA(i,o);break;case"textarea":bj(i,o);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var m=o.value;m!=null?Ep(i,!!o.multiple,m,!1):f!==!!o.multiple&&(o.defaultValue!=null?Ep(i,!!o.multiple,o.defaultValue,!0):Ep(i,!!o.multiple,o.multiple?[]:"",!1))}i[vv]=o}catch(_){lr(n,n.return,_)}}break;case 6:if(vs(e,n),Zs(n),r&4){if(n.stateNode===null)throw Error(Ne(162));i=n.stateNode,o=n.memoizedProps;try{i.nodeValue=o}catch(_){lr(n,n.return,_)}}break;case 3:if(vs(e,n),Zs(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{hv(e.containerInfo)}catch(_){lr(n,n.return,_)}break;case 4:vs(e,n),Zs(n);break;case 13:vs(e,n),Zs(n),i=n.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(GI=hr())),r&4&&R3(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(pi=(c=pi)||u,vs(e,n),pi=c):vs(e,n),Zs(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(Ze=n,u=n.child;u!==null;){for(h=Ze=u;Ze!==null;){switch(f=Ze,m=f.child,f.tag){case 0:case 11:case 14:case 15:k0(4,f,f.return);break;case 1:rp(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(_){lr(r,t,_)}}break;case 5:rp(f,f.return);break;case 22:if(f.memoizedState!==null){I3(h);continue}}m!==null?(m.return=f,Ze=m):I3(h)}u=u.sibling}e:for(u=null,h=n;;){if(h.tag===5){if(u===null){u=h;try{i=h.stateNode,c?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=h.stateNode,l=h.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Rj("display",s))}catch(_){lr(n,n.return,_)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(_){lr(n,n.return,_)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:vs(e,n),Zs(n),r&4&&R3(n);break;case 21:break;default:vs(e,n),Zs(n)}}function Zs(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(tz(t)){var r=t;break e}t=t.return}throw Error(Ne(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(lv(i,""),r.flags&=-33);var o=M3(n);wM(n,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,a=M3(n);yM(n,a,s);break;default:throw Error(Ne(161))}}catch(l){lr(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function MJ(n,e,t){Ze=n,iz(n)}function iz(n,e,t){for(var r=(n.mode&1)!==0;Ze!==null;){var i=Ze,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||fx;if(!s){var a=i.alternate,l=a!==null&&a.memoizedState!==null||pi;a=fx;var c=pi;if(fx=s,(pi=l)&&!c)for(Ze=i;Ze!==null;)s=Ze,l=s.child,s.tag===22&&s.memoizedState!==null?P3(i):l!==null?(l.return=s,Ze=l):P3(i);for(;o!==null;)Ze=o,iz(o),o=o.sibling;Ze=i,fx=a,pi=c}N3(n)}else i.subtreeFlags&8772&&o!==null?(o.return=i,Ze=o):N3(n)}}function N3(n){for(;Ze!==null;){var e=Ze;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:pi||BE(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!pi)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Es(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&p3(e,o,r);break;case 3:var s=e.updateQueue;if(s!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}p3(e,s,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&hv(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ne(163))}pi||e.flags&512&&xM(e)}catch(f){lr(e,e.return,f)}}if(e===n){Ze=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ze=t;break}Ze=e.return}}function I3(n){for(;Ze!==null;){var e=Ze;if(e===n){Ze=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ze=t;break}Ze=e.return}}function P3(n){for(;Ze!==null;){var e=Ze;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{BE(4,e)}catch(l){lr(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){lr(e,i,l)}}var o=e.return;try{xM(e)}catch(l){lr(e,o,l)}break;case 5:var s=e.return;try{xM(e)}catch(l){lr(e,s,l)}}}catch(l){lr(e,e.return,l)}if(e===n){Ze=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ze=a;break}Ze=e.return}}var RJ=Math.ceil,Vw=Vl.ReactCurrentDispatcher,HI=Vl.ReactCurrentOwner,ns=Vl.ReactCurrentBatchConfig,Jt=0,Vr=null,wr=null,Zr=0,_o=0,ip=xu(0),Nr=0,Ev=null,Qd=0,zE=0,VI=0,L0=null,Gi=null,GI=0,um=1/0,Qa=null,Gw=!1,SM=null,Yc=null,px=!1,Dc=null,Ww=0,O0=0,EM=null,ky=-1,Ly=0;function Li(){return Jt&6?hr():ky!==-1?ky:ky=hr()}function Kc(n){return n.mode&1?Jt&2&&Zr!==0?Zr&-Zr:hJ.transition!==null?(Ly===0&&(Ly=Hj()),Ly):(n=vn,n!==0||(n=window.event,n=n===void 0?16:Xj(n.type)),n):1}function Ds(n,e,t,r){if(50<O0)throw O0=0,EM=null,Error(Ne(185));Jv(n,t,r),(!(Jt&2)||n!==Vr)&&(n===Vr&&(!(Jt&2)&&(zE|=t),Nr===4&&Cc(n,Zr)),Qi(n,r),t===1&&Jt===0&&!(e.mode&1)&&(um=hr()+500,UE&&yu()))}function Qi(n,e){var t=n.callbackNode;hZ(n,e);var r=Mw(n,n===Vr?Zr:0);if(r===0)t!==null&&zO(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&zO(t),e===1)n.tag===0?dJ(k3.bind(null,n)):pB(k3.bind(null,n)),aJ(function(){!(Jt&6)&&yu()}),t=null;else{switch(Vj(r)){case 1:t=gI;break;case 4:t=Bj;break;case 16:t=Aw;break;case 536870912:t=zj;break;default:t=Aw}t=hz(t,oz.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function oz(n,e){if(ky=-1,Ly=0,Jt&6)throw Error(Ne(327));var t=n.callbackNode;if(Mp()&&n.callbackNode!==t)return null;var r=Mw(n,n===Vr?Zr:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=$w(n,r);else{e=r;var i=Jt;Jt|=2;var o=az();(Vr!==n||Zr!==e)&&(Qa=null,um=hr()+500,Rd(n,e));do try{PJ();break}catch(a){sz(n,a)}while(!0);RI(),Vw.current=o,Jt=i,wr!==null?e=0:(Vr=null,Zr=0,e=Nr)}if(e!==0){if(e===2&&(i=qA(n),i!==0&&(r=i,e=TM(n,i))),e===1)throw t=Ev,Rd(n,0),Cc(n,r),Qi(n,hr()),t;if(e===6)Cc(n,r);else{if(i=n.current.alternate,!(r&30)&&!NJ(i)&&(e=$w(n,r),e===2&&(o=qA(n),o!==0&&(r=o,e=TM(n,o))),e===1))throw t=Ev,Rd(n,0),Cc(n,r),Qi(n,hr()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(Ne(345));case 2:Yu(n,Gi,Qa);break;case 3:if(Cc(n,r),(r&130023424)===r&&(e=GI+500-hr(),10<e)){if(Mw(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Li(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=iM(Yu.bind(null,n,Gi,Qa),e);break}Yu(n,Gi,Qa);break;case 4:if(Cc(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var s=31-Os(r);o=1<<s,s=e[s],s>i&&(i=s),r&=~o}if(r=i,r=hr()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*RJ(r/1960))-r,10<r){n.timeoutHandle=iM(Yu.bind(null,n,Gi,Qa),r);break}Yu(n,Gi,Qa);break;case 5:Yu(n,Gi,Qa);break;default:throw Error(Ne(329))}}}return Qi(n,hr()),n.callbackNode===t?oz.bind(null,n):null}function TM(n,e){var t=L0;return n.current.memoizedState.isDehydrated&&(Rd(n,e).flags|=256),n=$w(n,e),n!==2&&(e=Gi,Gi=t,e!==null&&CM(e)),n}function CM(n){Gi===null?Gi=n:Gi.push.apply(Gi,n)}function NJ(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],o=i.getSnapshot;i=i.value;try{if(!zs(o(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Cc(n,e){for(e&=~VI,e&=~zE,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Os(e),r=1<<t;n[t]=-1,e&=~r}}function k3(n){if(Jt&6)throw Error(Ne(327));Mp();var e=Mw(n,0);if(!(e&1))return Qi(n,hr()),null;var t=$w(n,e);if(n.tag!==0&&t===2){var r=qA(n);r!==0&&(e=r,t=TM(n,r))}if(t===1)throw t=Ev,Rd(n,0),Cc(n,e),Qi(n,hr()),t;if(t===6)throw Error(Ne(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Yu(n,Gi,Qa),Qi(n,hr()),null}function WI(n,e){var t=Jt;Jt|=1;try{return n(e)}finally{Jt=t,Jt===0&&(um=hr()+500,UE&&yu())}}function Zd(n){Dc!==null&&Dc.tag===0&&!(Jt&6)&&Mp();var e=Jt;Jt|=1;var t=ns.transition,r=vn;try{if(ns.transition=null,vn=1,n)return n()}finally{vn=r,ns.transition=t,Jt=e,!(Jt&6)&&yu()}}function $I(){_o=ip.current,Un(ip)}function Rd(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,sJ(t)),wr!==null)for(t=wr.return;t!==null;){var r=t;switch(bI(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&kw();break;case 3:lm(),Un(Xi),Un(_i),OI();break;case 5:LI(r);break;case 4:lm();break;case 13:Un(Qn);break;case 19:Un(Qn);break;case 10:NI(r.type._context);break;case 22:case 23:$I()}t=t.return}if(Vr=n,wr=n=Xc(n.current,null),Zr=_o=e,Nr=0,Ev=null,VI=zE=Qd=0,Gi=L0=null,pd!==null){for(e=0;e<pd.length;e++)if(t=pd[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,o=t.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}t.pending=r}pd=null}return n}function sz(n,e){do{var t=wr;try{if(RI(),Ny.current=Hw,zw){for(var r=nr.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}zw=!1}if(qd=0,Br=Ar=nr=null,P0=!1,yv=0,HI.current=null,t===null||t.return===null){Nr=1,Ev=e,wr=null;break}e:{var o=n,s=t.return,a=t,l=e;if(e=Zr,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=y3(s);if(m!==null){m.flags&=-257,w3(m,s,a,o,e),m.mode&1&&x3(o,c,e),e=m,l=c;var g=e.updateQueue;if(g===null){var _=new Set;_.add(l),e.updateQueue=_}else g.add(l);break e}else{if(!(e&1)){x3(o,c,e),YI();break e}l=Error(Ne(426))}}else if(Gn&&a.mode&1){var v=y3(s);if(v!==null){!(v.flags&65536)&&(v.flags|=256),w3(v,s,a,o,e),AI(cm(l,a));break e}}o=l=cm(l,a),Nr!==4&&(Nr=2),L0===null?L0=[o]:L0.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var p=VB(o,l,e);f3(o,p);break e;case 1:a=l;var x=o.type,y=o.stateNode;if(!(o.flags&128)&&(typeof x.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Yc===null||!Yc.has(y)))){o.flags|=65536,e&=-e,o.lanes|=e;var w=GB(o,a,e);f3(o,w);break e}}o=o.return}while(o!==null)}cz(t)}catch(C){e=C,wr===t&&t!==null&&(wr=t=t.return);continue}break}while(!0)}function az(){var n=Vw.current;return Vw.current=Hw,n===null?Hw:n}function YI(){(Nr===0||Nr===3||Nr===2)&&(Nr=4),Vr===null||!(Qd&268435455)&&!(zE&268435455)||Cc(Vr,Zr)}function $w(n,e){var t=Jt;Jt|=2;var r=az();(Vr!==n||Zr!==e)&&(Qa=null,Rd(n,e));do try{IJ();break}catch(i){sz(n,i)}while(!0);if(RI(),Jt=t,Vw.current=r,wr!==null)throw Error(Ne(261));return Vr=null,Zr=0,Nr}function IJ(){for(;wr!==null;)lz(wr)}function PJ(){for(;wr!==null&&!rZ();)lz(wr)}function lz(n){var e=dz(n.alternate,n,_o);n.memoizedProps=n.pendingProps,e===null?cz(n):wr=e,HI.current=null}function cz(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=CJ(t,e),t!==null){t.flags&=32767,wr=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Nr=6,wr=null;return}}else if(t=TJ(t,e,_o),t!==null){wr=t;return}if(e=e.sibling,e!==null){wr=e;return}wr=e=n}while(e!==null);Nr===0&&(Nr=5)}function Yu(n,e,t){var r=vn,i=ns.transition;try{ns.transition=null,vn=1,kJ(n,e,t,r)}finally{ns.transition=i,vn=r}return null}function kJ(n,e,t,r){do Mp();while(Dc!==null);if(Jt&6)throw Error(Ne(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Ne(177));n.callbackNode=null,n.callbackPriority=0;var o=t.lanes|t.childLanes;if(fZ(n,o),n===Vr&&(wr=Vr=null,Zr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||px||(px=!0,hz(Aw,function(){return Mp(),null})),o=(t.flags&15990)!==0,t.subtreeFlags&15990||o){o=ns.transition,ns.transition=null;var s=vn;vn=1;var a=Jt;Jt|=4,HI.current=null,AJ(n,t),rz(t,n),JZ(nM),Rw=!!tM,nM=tM=null,n.current=t,MJ(t),iZ(),Jt=a,vn=s,ns.transition=o}else n.current=t;if(px&&(px=!1,Dc=n,Ww=i),o=n.pendingLanes,o===0&&(Yc=null),aZ(t.stateNode),Qi(n,hr()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Gw)throw Gw=!1,n=SM,SM=null,n;return Ww&1&&n.tag!==0&&Mp(),o=n.pendingLanes,o&1?n===EM?O0++:(O0=0,EM=n):O0=0,yu(),null}function Mp(){if(Dc!==null){var n=Vj(Ww),e=ns.transition,t=vn;try{if(ns.transition=null,vn=16>n?16:n,Dc===null)var r=!1;else{if(n=Dc,Dc=null,Ww=0,Jt&6)throw Error(Ne(331));var i=Jt;for(Jt|=4,Ze=n.current;Ze!==null;){var o=Ze,s=o.child;if(Ze.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Ze=c;Ze!==null;){var u=Ze;switch(u.tag){case 0:case 11:case 15:k0(8,u,o)}var h=u.child;if(h!==null)h.return=u,Ze=h;else for(;Ze!==null;){u=Ze;var f=u.sibling,m=u.return;if(ez(u),u===c){Ze=null;break}if(f!==null){f.return=m,Ze=f;break}Ze=m}}}var g=o.alternate;if(g!==null){var _=g.child;if(_!==null){g.child=null;do{var v=_.sibling;_.sibling=null,_=v}while(_!==null)}}Ze=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,Ze=s;else e:for(;Ze!==null;){if(o=Ze,o.flags&2048)switch(o.tag){case 0:case 11:case 15:k0(9,o,o.return)}var p=o.sibling;if(p!==null){p.return=o.return,Ze=p;break e}Ze=o.return}}var x=n.current;for(Ze=x;Ze!==null;){s=Ze;var y=s.child;if(s.subtreeFlags&2064&&y!==null)y.return=s,Ze=y;else e:for(s=x;Ze!==null;){if(a=Ze,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:BE(9,a)}}catch(C){lr(a,a.return,C)}if(a===s){Ze=null;break e}var w=a.sibling;if(w!==null){w.return=a.return,Ze=w;break e}Ze=a.return}}if(Jt=i,yu(),Ea&&typeof Ea.onPostCommitFiberRoot=="function")try{Ea.onPostCommitFiberRoot(PE,n)}catch{}r=!0}return r}finally{vn=t,ns.transition=e}}return!1}function L3(n,e,t){e=cm(t,e),e=VB(n,e,1),n=$c(n,e,1),e=Li(),n!==null&&(Jv(n,1,e),Qi(n,e))}function lr(n,e,t){if(n.tag===3)L3(n,n,t);else for(;e!==null;){if(e.tag===3){L3(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Yc===null||!Yc.has(r))){n=cm(t,n),n=GB(e,n,1),e=$c(e,n,1),n=Li(),e!==null&&(Jv(e,1,n),Qi(e,n));break}}e=e.return}}function LJ(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Li(),n.pingedLanes|=n.suspendedLanes&t,Vr===n&&(Zr&t)===t&&(Nr===4||Nr===3&&(Zr&130023424)===Zr&&500>hr()-GI?Rd(n,0):VI|=t),Qi(n,e)}function uz(n,e){e===0&&(n.mode&1?(e=ix,ix<<=1,!(ix&130023424)&&(ix=4194304)):e=1);var t=Li();n=Il(n,e),n!==null&&(Jv(n,e,t),Qi(n,t))}function OJ(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),uz(n,t)}function DJ(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Ne(314))}r!==null&&r.delete(e),uz(n,t)}var dz;dz=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Xi.current)Wi=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Wi=!1,EJ(n,e,t);Wi=!!(n.flags&131072)}else Wi=!1,Gn&&e.flags&1048576&&mB(e,Dw,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Py(n,e),n=e.pendingProps;var i=om(e,_i.current);Ap(e,t),i=UI(null,e,r,n,i,t);var o=FI();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,qi(r)?(o=!0,Lw(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,PI(e),i.updater=jE,e.stateNode=i,i._reactInternals=e,dM(e,r,n,t),e=pM(null,e,r,!0,o,t)):(e.tag=0,Gn&&o&&CI(e),Ci(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Py(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=FJ(r),n=Es(r,n),i){case 0:e=fM(null,e,r,n,t);break e;case 1:e=T3(null,e,r,n,t);break e;case 11:e=S3(null,e,r,n,t);break e;case 14:e=E3(null,e,r,Es(r.type,n),t);break e}throw Error(Ne(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Es(r,i),fM(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Es(r,i),T3(n,e,r,i,t);case 3:e:{if(KB(e),n===null)throw Error(Ne(387));r=e.pendingProps,o=e.memoizedState,i=o.element,wB(n,e),jw(e,r,null,t);var s=e.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=cm(Error(Ne(423)),e),e=C3(n,e,r,t,i);break e}else if(r!==i){i=cm(Error(Ne(424)),e),e=C3(n,e,r,t,i);break e}else for(To=Wc(e.stateNode.containerInfo.firstChild),Ao=e,Gn=!0,As=null,t=xB(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(sm(),r===i){e=Pl(n,e,t);break e}Ci(n,e,r,t)}e=e.child}return e;case 5:return SB(e),n===null&&lM(e),r=e.type,i=e.pendingProps,o=n!==null?n.memoizedProps:null,s=i.children,rM(r,i)?s=null:o!==null&&rM(r,o)&&(e.flags|=32),YB(n,e),Ci(n,e,s,t),e.child;case 6:return n===null&&lM(e),null;case 13:return XB(n,e,t);case 4:return kI(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=am(e,null,r,t):Ci(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Es(r,i),S3(n,e,r,i,t);case 7:return Ci(n,e,e.pendingProps,t),e.child;case 8:return Ci(n,e,e.pendingProps.children,t),e.child;case 12:return Ci(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,Nn(Uw,r._currentValue),r._currentValue=s,o!==null)if(zs(o.value,s)){if(o.children===i.children&&!Xi.current){e=Pl(n,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(o.tag===1){l=ml(-1,t&-t),l.tag=2;var c=o.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),cM(o.return,t,e),a.lanes|=t;break}l=l.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(Ne(341));s.lanes|=t,a=s.alternate,a!==null&&(a.lanes|=t),cM(s,t,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}Ci(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Ap(e,t),i=os(i),r=r(i),e.flags|=1,Ci(n,e,r,t),e.child;case 14:return r=e.type,i=Es(r,e.pendingProps),i=Es(r.type,i),E3(n,e,r,i,t);case 15:return WB(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Es(r,i),Py(n,e),e.tag=1,qi(r)?(n=!0,Lw(e)):n=!1,Ap(e,t),HB(e,r,i),dM(e,r,i,t),pM(null,e,r,!0,n,t);case 19:return qB(n,e,t);case 22:return $B(n,e,t)}throw Error(Ne(156,e.tag))};function hz(n,e){return jj(n,e)}function UJ(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function es(n,e,t,r){return new UJ(n,e,t,r)}function KI(n){return n=n.prototype,!(!n||!n.isReactComponent)}function FJ(n){if(typeof n=="function")return KI(n)?1:0;if(n!=null){if(n=n.$$typeof,n===fI)return 11;if(n===pI)return 14}return 2}function Xc(n,e){var t=n.alternate;return t===null?(t=es(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Oy(n,e,t,r,i,o){var s=2;if(r=n,typeof n=="function")KI(n)&&(s=1);else if(typeof n=="string")s=5;else e:switch(n){case Kf:return Nd(t.children,i,o,e);case hI:s=8,i|=8;break;case OA:return n=es(12,t,e,i|2),n.elementType=OA,n.lanes=o,n;case DA:return n=es(13,t,e,i),n.elementType=DA,n.lanes=o,n;case UA:return n=es(19,t,e,i),n.elementType=UA,n.lanes=o,n;case Sj:return HE(t,i,o,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case yj:s=10;break e;case wj:s=9;break e;case fI:s=11;break e;case pI:s=14;break e;case xc:s=16,r=null;break e}throw Error(Ne(130,n==null?n:typeof n,""))}return e=es(s,t,e,i),e.elementType=n,e.type=r,e.lanes=o,e}function Nd(n,e,t,r){return n=es(7,n,r,e),n.lanes=t,n}function HE(n,e,t,r){return n=es(22,n,r,e),n.elementType=Sj,n.lanes=t,n.stateNode={isHidden:!1},n}function cC(n,e,t){return n=es(6,n,null,e),n.lanes=t,n}function uC(n,e,t){return e=es(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function jJ(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=GT(0),this.expirationTimes=GT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=GT(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function XI(n,e,t,r,i,o,s,a,l){return n=new jJ(n,e,t,a,l),e===1?(e=1,o===!0&&(e|=8)):e=0,o=es(3,null,null,e),n.current=o,o.stateNode=n,o.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},PI(o),n}function BJ(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Yf,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function fz(n){if(!n)return ou;n=n._reactInternals;e:{if(ph(n)!==n||n.tag!==1)throw Error(Ne(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(qi(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ne(171))}if(n.tag===1){var t=n.type;if(qi(t))return fB(n,t,e)}return e}function pz(n,e,t,r,i,o,s,a,l){return n=XI(t,r,!0,n,i,o,s,a,l),n.context=fz(null),t=n.current,r=Li(),i=Kc(t),o=ml(r,i),o.callback=e??null,$c(t,o,i),n.current.lanes=i,Jv(n,i,r),Qi(n,r),n}function VE(n,e,t,r){var i=e.current,o=Li(),s=Kc(i);return t=fz(t),e.context===null?e.context=t:e.pendingContext=t,e=ml(o,s),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=$c(i,e,s),n!==null&&(Ds(n,i,s,o),Ry(n,i,s)),s}function Yw(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function O3(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function qI(n,e){O3(n,e),(n=n.alternate)&&O3(n,e)}function zJ(){return null}var mz=typeof reportError=="function"?reportError:function(n){console.error(n)};function QI(n){this._internalRoot=n}GE.prototype.render=QI.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Ne(409));VE(n,e,null,null)};GE.prototype.unmount=QI.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Zd(function(){VE(null,n,null,null)}),e[Nl]=null}};function GE(n){this._internalRoot=n}GE.prototype.unstable_scheduleHydration=function(n){if(n){var e=$j();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Tc.length&&e!==0&&e<Tc[t].priority;t++);Tc.splice(t,0,n),t===0&&Kj(n)}};function ZI(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function WE(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function D3(){}function HJ(n,e,t,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var c=Yw(s);o.call(c)}}var s=pz(e,r,n,0,null,!1,!1,"",D3);return n._reactRootContainer=s,n[Nl]=s.current,mv(n.nodeType===8?n.parentNode:n),Zd(),s}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=Yw(l);a.call(c)}}var l=XI(n,0,!1,null,null,!1,!1,"",D3);return n._reactRootContainer=l,n[Nl]=l.current,mv(n.nodeType===8?n.parentNode:n),Zd(function(){VE(e,l,t,r)}),l}function $E(n,e,t,r,i){var o=t._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var l=Yw(s);a.call(l)}}VE(e,s,n,i)}else s=HJ(t,e,n,i,r);return Yw(s)}Gj=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=i0(e.pendingLanes);t!==0&&(vI(e,t|1),Qi(e,hr()),!(Jt&6)&&(um=hr()+500,yu()))}break;case 13:Zd(function(){var r=Il(n,1);if(r!==null){var i=Li();Ds(r,n,1,i)}}),qI(n,1)}};_I=function(n){if(n.tag===13){var e=Il(n,134217728);if(e!==null){var t=Li();Ds(e,n,134217728,t)}qI(n,134217728)}};Wj=function(n){if(n.tag===13){var e=Kc(n),t=Il(n,e);if(t!==null){var r=Li();Ds(t,n,e,r)}qI(n,e)}};$j=function(){return vn};Yj=function(n,e){var t=vn;try{return vn=n,e()}finally{vn=t}};YA=function(n,e,t){switch(e){case"input":if(BA(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=DE(r);if(!i)throw Error(Ne(90));Tj(r),BA(r,i)}}}break;case"textarea":bj(n,t);break;case"select":e=t.value,e!=null&&Ep(n,!!t.multiple,e,!1)}};kj=WI;Lj=Zd;var VJ={usingClientEntryPoint:!1,Events:[t_,Zf,DE,Ij,Pj,WI]},mg={findFiberByHostInstance:fd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},GJ={bundleType:mg.bundleType,version:mg.version,rendererPackageName:mg.rendererPackageName,rendererConfig:mg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Vl.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Uj(n),n===null?null:n.stateNode},findFiberByHostInstance:mg.findFiberByHostInstance||zJ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mx.isDisabled&&mx.supportsFiber)try{PE=mx.inject(GJ),Ea=mx}catch{}}Oo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VJ;Oo.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ZI(e))throw Error(Ne(200));return BJ(n,e,null,t)};Oo.createRoot=function(n,e){if(!ZI(n))throw Error(Ne(299));var t=!1,r="",i=mz;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=XI(n,1,!1,null,null,t,!1,r,i),n[Nl]=e.current,mv(n.nodeType===8?n.parentNode:n),new QI(e)};Oo.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Ne(188)):(n=Object.keys(n).join(","),Error(Ne(268,n)));return n=Uj(e),n=n===null?null:n.stateNode,n};Oo.flushSync=function(n){return Zd(n)};Oo.hydrate=function(n,e,t){if(!WE(e))throw Error(Ne(200));return $E(null,n,e,!0,t)};Oo.hydrateRoot=function(n,e,t){if(!ZI(n))throw Error(Ne(405));var r=t!=null&&t.hydratedSources||null,i=!1,o="",s=mz;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),e=pz(e,null,n,1,t??null,i,!1,o,s),n[Nl]=e.current,mv(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new GE(e)};Oo.render=function(n,e,t){if(!WE(e))throw Error(Ne(200));return $E(null,n,e,!1,t)};Oo.unmountComponentAtNode=function(n){if(!WE(n))throw Error(Ne(40));return n._reactRootContainer?(Zd(function(){$E(null,null,n,!1,function(){n._reactRootContainer=null,n[Nl]=null})}),!0):!1};Oo.unstable_batchedUpdates=WI;Oo.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!WE(t))throw Error(Ne(200));if(n==null||n._reactInternals===void 0)throw Error(Ne(38));return $E(n,e,t,!1,r)};Oo.version="18.3.1-next-f1338f8080-20240426";function gz(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(gz)}catch(n){console.error(n)}}gz(),gj.exports=Oo;var bt=gj.exports;const rr=mr(n=>({allowSelectionOfHidden:!1,isPresentationMode:CG,hideViewPointInPresentationMode:!1,selectedID:"",selectedName:"",selectedParentName:"",selectedData:[],clippingActive:!1,clippingToggle:()=>{n(e=>({clippingActive:!e.clippingActive}))},treeViewActive:!1,treeViewWidth:200,treeViewToggle:()=>{n(e=>({treeViewActive:!e.treeViewActive}))},treeViewSearchActive:!1,treeViewSearchToggle:()=>{n(e=>({treeViewSearchActive:!e.treeViewSearchActive}))},setActive:!1,setToggle:()=>{n(e=>({setActive:!e.setActive}))},canvasMode:"NORMAL"}));function WJ(){const n=[];for(let e=0;e<70;e++)n.push({key:e,no:e});return n}const gg=WJ();let rc=0,Ku=null;function $J(n){Ku=n}let U3=null;function YJ(n){const[e,t]=O.useState(!1),r=rr().treeViewWidth,[i,o]=O.useState(rc),s=n.rowheight,a=n.length;Ku!==null&&(clearTimeout(U3),U3=setTimeout(()=>{if(typeof Ku=="number"){rc=Ku*s;const u=document.getElementById("scroller");u&&(Ku===0&&(gg.forEach((h,f)=>{h.no=f}),t(!e)),rc>u.scrollTop+u.offsetHeight&&o(rc-u.offsetHeight/2),rc<u.scrollTop&&o(rc-u.offsetHeight/2)),Ku=null}})),O.useEffect(()=>{const u=document.getElementById("scroller");u&&(u.scrollTop=i,s*a<i&&(u.scrollTop=0,Ku=0,o(0),t(!e)))});function l(u){bt.flushSync(()=>{const h=u.target,f=Math.floor(h.scrollTop/s),m=h.scrollTop>rc;rc=h.scrollTop,m?gg.sort((g,_)=>g.no<_.no?-1:1):gg.sort((g,_)=>g.no<_.no?1:-1),gg.forEach((g,_)=>{g.no=f+_}),t(!e),o(h.scrollTop)})}function c(u){const h=u.clientX;function f(g){var p;let _=g.clientX;(p=g.changedTouches)!=null&&p[0]&&(_=g.changedTouches[0].clientX);const v=_-h;rr.setState({treeViewWidth:r+v})}function m(){window.removeEventListener("mouseup",m),window.removeEventListener("mousemove",f),window.removeEventListener("touchend",m),window.removeEventListener("touchmove",f)}window.addEventListener("mouseup",m),window.addEventListener("mousemove",f),window.addEventListener("touchend",m),window.addEventListener("touchmove",f)}return d.jsx("div",{id:"scroller",onScroll:l,className:"threeView-container scrollbar pointer-events-auto border-t border-gray-900 bg-gray-800 pt-1",style:{overflow:"auto",width:`${r}px`},children:d.jsxs("div",{className:"threeView-body",style:{height:`${a*s}px`,overflow:"hidden",position:"relative"},children:[d.jsx("div",{className:"pointer-events-auto absolute bottom-0 right-0 top-0 z-30 w-[10px] cursor-col-resize",onPointerDown:c}),gg.map(u=>{const h={position:"absolute",transform:`translate3d(0px, ${u.no*s}px, 0px)`,height:`${s}px`,display:"block",overflow:"hidden",width:"100%"};return d.jsx("div",{style:h,className:"threeView-row hover:bg-gray-700",children:n.addRowElements(u)},u.key)})]})})}const Pt=mr(n=>({update:!1,updateToggel:(e=null)=>{$J(e),n(t=>({update:!t.update}))}})),Kw=new Set;let vz;function KJ(){return vz}function XJ(n){return vz=n,new Promise(async e=>{Array.from(Kw).forEach(r=>{r.handleEvent&&(r.handleEvent(n)||Kw.delete(r))}),e(null)})}const Pu=new lj,ui=new N,ic=new N,jn=new Hn,F3={X:new N(1,0,0),Y:new N(0,1,0),Z:new N(0,0,1)},dC={type:"change"},j3={type:"mouseDown",mode:null},B3={type:"mouseUp",mode:null},z3={type:"objectChange"};class _z extends MQ{constructor(e,t=null){super(void 0,t);const r=new tee(this);this._root=r;const i=new nee;this._gizmo=i,r.add(i);const o=new ree;this._plane=o,r.add(o);const s=this;function a(y,w){let C=w;Object.defineProperty(s,y,{get:function(){return C!==void 0?C:w},set:function(T){C!==T&&(C=T,o[y]=T,i[y]=T,s.dispatchEvent({type:y+"-changed",value:T}),s.dispatchEvent(dC))}}),s[y]=w,o[y]=w,i[y]=w}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const l=new N,c=new N,u=new Hn,h=new Hn,f=new N,m=new Hn,g=new N,_=new N,v=new N,p=0,x=new N;a("worldPosition",l),a("worldPositionStart",c),a("worldQuaternion",u),a("worldQuaternionStart",h),a("cameraPosition",f),a("cameraQuaternion",m),a("pointStart",g),a("pointEnd",_),a("rotationAxis",v),a("rotationAngle",p),a("eye",x),this._offset=new N,this._startNorm=new N,this._endNorm=new N,this._cameraScale=new N,this._parentPosition=new N,this._parentQuaternion=new Hn,this._parentQuaternionInv=new Hn,this._parentScale=new N,this._worldScaleStart=new N,this._worldQuaternionInv=new Hn,this._worldScale=new N,this._positionStart=new N,this._quaternionStart=new Hn,this._scaleStart=new N,this._getPointer=qJ.bind(this),this._onPointerDown=ZJ.bind(this),this._onPointerHover=QJ.bind(this),this._onPointerMove=JJ.bind(this),this._onPointerUp=eee.bind(this),t!==null&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&Pu.setFromCamera(e,this.camera);const t=hC(this._gizmo.picker[this.mode],Pu);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&Pu.setFromCamera(e,this.camera);const t=hC(this._plane,Pu,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,j3.mode=this.mode,this.dispatchEvent(j3)}}pointerMove(e){const t=this.axis,r=this.mode,i=this.object;let o=this.space;if(r==="scale"?o="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(o="world"),i===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&Pu.setFromCamera(e,this.camera);const s=hC(this._plane,Pu,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),r==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(i.position.applyQuaternion(jn.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),o==="world"&&(i.parent&&i.position.add(ui.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(ui.setFromMatrixPosition(i.parent.matrixWorld))));else if(r==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),ic.set(a,a,a)}else ui.copy(this.pointStart),ic.copy(this.pointEnd),ui.applyQuaternion(this._worldQuaternionInv),ic.applyQuaternion(this._worldQuaternionInv),ic.divide(ui),t.search("X")===-1&&(ic.x=1),t.search("Y")===-1&&(ic.y=1),t.search("Z")===-1&&(ic.z=1);i.scale.copy(this._scaleStart).multiply(ic),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(r==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(ui.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(ui.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(F3[t]),ui.copy(F3[t]),o==="local"&&ui.applyQuaternion(this.worldQuaternion),ui.cross(this.eye),ui.length()===0?l=!0:this.rotationAngle=this._offset.dot(ui.normalize())*a),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(jn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(jn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(dC),this.dispatchEvent(z3)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(B3.mode=this.mode,this.dispatchEvent(B3)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(dC),this.dispatchEvent(z3),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Pu}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function qJ(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const e=this.domElement.getBoundingClientRect();return{x:(n.clientX-e.left)/e.width*2-1,y:-(n.clientY-e.top)/e.height*2+1,button:n.button}}}function QJ(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function ZJ(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function JJ(n){this.enabled&&this.pointerMove(this._getPointer(n))}function eee(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function hC(n,e,t){const r=e.intersectObject(n,!0);for(let i=0;i<r.length;i++)if(r[i].object.visible||t)return r[i];return!1}const gx=new Bs,Cn=new N(0,1,0),H3=new N(0,0,0),V3=new dt,vx=new Hn,Dy=new Hn,Js=new N,G3=new dt,s0=new N(1,0,0),Xu=new N(0,1,0),a0=new N(0,0,1),_x=new N,vg=new N,_g=new N;class tee extends Tr{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;t.object!==void 0&&(t.object.updateMatrixWorld(),t.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}}class nee extends Tr{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new vu({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Eo({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;const i=t.clone();i.opacity=.5;const o=e.clone();o.color.setHex(16711680);const s=e.clone();s.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const h=e.clone();h.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const g=e.clone();g.color.setHex(7895160);const _=new ci(0,.04,.1,12);_.translate(0,.05,0);const v=new Xn(.08,.08,.08);v.translate(0,.04,0);const p=new Sn;p.setAttribute("position",new tn([0,0,0,1,0,0],3));const x=new ci(.0075,.0075,.5,3);x.translate(0,.25,0);function y(k,z){const P=new id(k,.0075,3,64,z*Math.PI*2);return P.rotateY(Math.PI/2),P.rotateX(Math.PI/2),P}function w(){const k=new Sn;return k.setAttribute("position",new tn([0,0,0,1,1,1],3)),k}const C={X:[[new Ve(_,o),[.5,0,0],[0,0,-Math.PI/2]],[new Ve(_,o),[-.5,0,0],[0,0,Math.PI/2]],[new Ve(x,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Ve(_,s),[0,.5,0]],[new Ve(_,s),[0,-.5,0],[Math.PI,0,0]],[new Ve(x,s)]],Z:[[new Ve(_,a),[0,0,.5],[Math.PI/2,0,0]],[new Ve(_,a),[0,0,-.5],[-Math.PI/2,0,0]],[new Ve(x,a),null,[Math.PI/2,0,0]]],XYZ:[[new Ve(new $f(.1,0),h.clone()),[0,0,0]]],XY:[[new Ve(new Xn(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new Ve(new Xn(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ve(new Xn(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},T={X:[[new Ve(new ci(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new Ve(new ci(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Ve(new ci(.2,0,.6,4),r),[0,.3,0]],[new Ve(new ci(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Ve(new ci(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new Ve(new ci(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Ve(new $f(.2,0),r)]],XY:[[new Ve(new Xn(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new Ve(new Xn(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ve(new Xn(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},S={START:[[new Ve(new $f(.01,2),i),null,null,null,"helper"]],END:[[new Ve(new $f(.01,2),i),null,null,null,"helper"]],DELTA:[[new Xr(w(),i),null,null,null,"helper"]],X:[[new Xr(p,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Xr(p,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Xr(p,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},b={XYZE:[[new Ve(y(.5,1),g),null,[0,Math.PI/2,0]]],X:[[new Ve(y(.5,.5),o)]],Y:[[new Ve(y(.5,.5),s),null,[0,0,-Math.PI/2]]],Z:[[new Ve(y(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new Ve(y(.75,1),f),null,[0,Math.PI/2,0]]]},R={AXIS:[[new Xr(p,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},E={XYZE:[[new Ve(new sv(.25,10,8),r)]],X:[[new Ve(new id(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Ve(new id(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Ve(new id(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Ve(new id(.75,.1,2,24),r)]]},A={X:[[new Ve(v,o),[.5,0,0],[0,0,-Math.PI/2]],[new Ve(x,o),[0,0,0],[0,0,-Math.PI/2]],[new Ve(v,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Ve(v,s),[0,.5,0]],[new Ve(x,s)],[new Ve(v,s),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Ve(v,a),[0,0,.5],[Math.PI/2,0,0]],[new Ve(x,a),[0,0,0],[Math.PI/2,0,0]],[new Ve(v,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Ve(new Xn(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new Ve(new Xn(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ve(new Xn(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Ve(new Xn(.1,.1,.1),h.clone())]]},F={X:[[new Ve(new ci(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new Ve(new ci(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Ve(new ci(.2,0,.6,4),r),[0,.3,0]],[new Ve(new ci(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Ve(new ci(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new Ve(new ci(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Ve(new Xn(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new Ve(new Xn(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ve(new Xn(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Ve(new Xn(.2,.2,.2),r),[0,0,0]]]},D={X:[[new Xr(p,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Xr(p,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Xr(p,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function M(k){const z=new Tr;for(const P in k)for(let U=k[P].length;U--;){const Y=k[P][U][0].clone(),Z=k[P][U][1],j=k[P][U][2],X=k[P][U][3],B=k[P][U][4];Y.name=P,Y.tag=B,Z&&Y.position.set(Z[0],Z[1],Z[2]),j&&Y.rotation.set(j[0],j[1],j[2]),X&&Y.scale.set(X[0],X[1],X[2]),Y.updateMatrix();const K=Y.geometry.clone();K.applyMatrix4(Y.matrix),Y.geometry=K,Y.renderOrder=1/0,Y.position.set(0,0,0),Y.rotation.set(0,0,0),Y.scale.set(1,1,1),z.add(Y)}return z}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=M(C)),this.add(this.gizmo.rotate=M(b)),this.add(this.gizmo.scale=M(A)),this.add(this.picker.translate=M(T)),this.add(this.picker.rotate=M(E)),this.add(this.picker.scale=M(F)),this.add(this.helper.translate=M(S)),this.add(this.helper.rotate=M(R)),this.add(this.helper.scale=M(D)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const r=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Dy;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let o=0;o<i.length;o++){const s=i[o];s.visible=!0,s.rotation.set(0,0,0),s.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),s.scale.set(1,1,1).multiplyScalar(a*this.size/4),s.tag==="helper"){s.visible=!1,s.name==="AXIS"?(s.visible=!!this.axis,this.axis==="X"&&(jn.setFromEuler(gx.set(0,0,0)),s.quaternion.copy(r).multiply(jn),Math.abs(Cn.copy(s0).applyQuaternion(r).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Y"&&(jn.setFromEuler(gx.set(0,0,Math.PI/2)),s.quaternion.copy(r).multiply(jn),Math.abs(Cn.copy(Xu).applyQuaternion(r).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Z"&&(jn.setFromEuler(gx.set(0,Math.PI/2,0)),s.quaternion.copy(r).multiply(jn),Math.abs(Cn.copy(a0).applyQuaternion(r).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="XYZE"&&(jn.setFromEuler(gx.set(0,Math.PI/2,0)),Cn.copy(this.rotationAxis),s.quaternion.setFromRotationMatrix(V3.lookAt(H3,Cn,Xu)),s.quaternion.multiply(jn),s.visible=this.dragging),this.axis==="E"&&(s.visible=!1)):s.name==="START"?(s.position.copy(this.worldPositionStart),s.visible=this.dragging):s.name==="END"?(s.position.copy(this.worldPosition),s.visible=this.dragging):s.name==="DELTA"?(s.position.copy(this.worldPositionStart),s.quaternion.copy(this.worldQuaternionStart),ui.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ui.applyQuaternion(this.worldQuaternionStart.clone().invert()),s.scale.copy(ui),s.visible=this.dragging):(s.quaternion.copy(r),this.dragging?s.position.copy(this.worldPositionStart):s.position.copy(this.worldPosition),this.axis&&(s.visible=this.axis.search(s.name)!==-1));continue}s.quaternion.copy(r),this.mode==="translate"||this.mode==="scale"?(s.name==="X"&&Math.abs(Cn.copy(s0).applyQuaternion(r).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Y"&&Math.abs(Cn.copy(Xu).applyQuaternion(r).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Z"&&Math.abs(Cn.copy(a0).applyQuaternion(r).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XY"&&Math.abs(Cn.copy(a0).applyQuaternion(r).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="YZ"&&Math.abs(Cn.copy(s0).applyQuaternion(r).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XZ"&&Math.abs(Cn.copy(Xu).applyQuaternion(r).dot(this.eye))<.2&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1)):this.mode==="rotate"&&(vx.copy(r),Cn.copy(this.eye).applyQuaternion(jn.copy(r).invert()),s.name.search("E")!==-1&&s.quaternion.setFromRotationMatrix(V3.lookAt(this.eye,H3,Xu)),s.name==="X"&&(jn.setFromAxisAngle(s0,Math.atan2(-Cn.y,Cn.z)),jn.multiplyQuaternions(vx,jn),s.quaternion.copy(jn)),s.name==="Y"&&(jn.setFromAxisAngle(Xu,Math.atan2(Cn.x,Cn.z)),jn.multiplyQuaternions(vx,jn),s.quaternion.copy(jn)),s.name==="Z"&&(jn.setFromAxisAngle(a0,Math.atan2(Cn.y,Cn.x)),jn.multiplyQuaternions(vx,jn),s.quaternion.copy(jn))),s.visible=s.visible&&(s.name.indexOf("X")===-1||this.showX),s.visible=s.visible&&(s.name.indexOf("Y")===-1||this.showY),s.visible=s.visible&&(s.name.indexOf("Z")===-1||this.showZ),s.visible=s.visible&&(s.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),s.material._color=s.material._color||s.material.color.clone(),s.material._opacity=s.material._opacity||s.material.opacity,s.material.color.copy(s.material._color),s.material.opacity=s.material._opacity,this.enabled&&this.axis&&(s.name===this.axis||this.axis.split("").some(function(l){return s.name===l}))&&(s.material.color.setHex(16776960),s.material.opacity=1)}super.updateMatrixWorld(e)}}class ree extends Ve{constructor(){super(new Om(1e5,1e5,2,2),new vu({visible:!1,wireframe:!0,side:vi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),_x.copy(s0).applyQuaternion(t==="local"?this.worldQuaternion:Dy),vg.copy(Xu).applyQuaternion(t==="local"?this.worldQuaternion:Dy),_g.copy(a0).applyQuaternion(t==="local"?this.worldQuaternion:Dy),Cn.copy(vg),this.mode){case"translate":case"scale":switch(this.axis){case"X":Cn.copy(this.eye).cross(_x),Js.copy(_x).cross(Cn);break;case"Y":Cn.copy(this.eye).cross(vg),Js.copy(vg).cross(Cn);break;case"Z":Cn.copy(this.eye).cross(_g),Js.copy(_g).cross(Cn);break;case"XY":Js.copy(_g);break;case"YZ":Js.copy(_x);break;case"XZ":Cn.copy(_g),Js.copy(vg);break;case"XYZ":case"E":Js.set(0,0,0);break}break;case"rotate":default:Js.set(0,0,0)}Js.length()===0?this.quaternion.copy(this.cameraQuaternion):(G3.lookAt(ui.set(0,0,0),Js,Cn),this.quaternion.setFromRotationMatrix(G3)),super.updateMatrixWorld(e)}}const Vn=mr(()=>({mode:"translate",enabled:!1,helperEnabled:!0,transformOnNextClickEnabled:!1,minX:0,minY:0,minZ:0,maxX:0,maxY:0,maxZ:0}));function iee(n){Kw.delete(n)}function oee(n){Kw.add(n)}class see{constructor(){Se(this,"controls");Se(this,"selectionMap",new Map);Se(this,"originalPosition");Se(this,"originalRotation");Se(this,"transform");Se(this,"isProcessing",!1);Se(this,"originalScale");Se(this,"line")}toggleMode(e){this.controls&&this.controls.setMode(e)}async resizeToSelected(){const e=await ae.get_bounding_box_from_selection();Vn.setState({minX:e.x,minY:e.y,minZ:e.z,maxX:e.X,maxY:e.Y,maxZ:e.Z}),W().forceRenderNextFrame()}toggleHelper(){const t=!Vn.getState().helperEnabled;Vn.setState({helperEnabled:t}),this.updateClippingHelper()}handleEvent(e){return this.selectionMap=e,this.resizeToSelected().then(()=>{this.updateClippingHelper()}),!0}enable(){Vn.setState({enabled:!0}),oee(this),this.resizeToSelected().then(()=>{this.updateClippingHelper()}),this.handleEvent(KJ())}disable(){Vn.setState({enabled:!1,transformOnNextClickEnabled:!1}),iee(this),this.updateClippingHelper()}updateClippingHelper(){const e=Vn.getState(),t=e.enabled;if(W().getSceneController().clearModelGroup("ITEM_TRANSFORM"),W().getSceneController().clearModelGroup("ITEM_CONTROLS"),this.controls&&(this.controls.disconnect(),this.controls=null),t){const r=new nt(new N(e.minX,e.minY,e.minZ),new N(e.maxX,e.maxY,e.maxZ)),i=new Xn(Math.abs(e.maxX-e.minX),Math.abs(e.maxY-e.minY),Math.abs(e.maxZ-e.minZ)),o=new Eo({color:"yellow",linewidth:5,depthTest:!0,linecap:"round",linejoin:"round"}),s=new ij(i),a=new Zv(s,o);this.line=a,a.$setPicking=u=>{a.visible=!u},r.getCenter(a.position),this.originalPosition=a.position.clone();const l=new Hn;a.getWorldQuaternion(l),this.originalRotation=l,this.originalScale=a.scale.clone(),W().getSceneController().addMeshToScene(a,"ITEM_TRANSFORM"),this.controls=new _z(W().getActiveCamera(),W().getRender().domElement),this.controls.addEventListener("change",()=>{this.triggerOnChangeEvent()}),this.controls.setSize(.5),this.controls.addEventListener("mouseDown",function(){const u=W().getActiveControls();u.enabled=!1,u.saveState()}),this.controls.addEventListener("mouseUp",async()=>{this.updateTransforms()}),this.controls.attach(a),this.controls.setMode(e.mode),this.controls.enabled=!0;const c=this.controls.getHelper();W().getSceneController().addMeshToScene(c,"ITEM_CONTROLS")}W().forceRenderNextFrame()}triggerOnChangeEvent(){if(this.isProcessing)return;const e=new nt().setFromObject(this.line);Vn.setState({minX:e.min.x,minY:e.min.y,minZ:e.min.z,maxX:e.max.x,maxY:e.max.y,maxZ:e.max.z}),this.selectionMap.forEach((t,r)=>{const i=W().getSceneController().getIndexMesh(r);t[0].forEach(o=>{if(o.is_sel){const s=i==null?void 0:i.$getMeshMaterialFromRange(o.material_index,o.transformation,o.is_sel);if(s!=null&&s.$shader){const l=s.$shader.uniforms.transform.value,c=this.line.position.x-this.originalPosition.x,u=this.line.position.y-this.originalPosition.y,h=this.line.position.z-this.originalPosition.z,f=1+(this.line.scale.x-this.originalScale.x),m=1+(this.line.scale.y-this.originalScale.y),g=1+(this.line.scale.z-this.originalScale.z),_=new Hn;this.line.getWorldQuaternion(_),_.multiply(this.originalRotation.clone().conjugate());const v=new dt().makeTranslation(this.originalPosition),p=new dt().makeRotationFromQuaternion(_),x=new dt().makeTranslation(this.originalPosition.clone().negate()),y=new dt().makeScale(f,m,g),w=new dt().makeTranslation(new N(c,u,h)),C=new dt;C.multiply(v),C.multiply(y),C.multiply(x),C.multiply(v),C.multiply(p),C.multiply(x),C.multiply(w),C.elements.forEach((T,S)=>{l.elements[S]=T}),this.transform=C}}})}),W().forceRenderNextFrame()}async updateTransforms(){var o,s;const e=W().getActiveControls();e.enabled=!0,e.saveState();let t=!1;const r=new Hn;if(this.line.getWorldQuaternion(r),this.originalRotation.x!==r.x&&(t=!0),this.originalRotation.y!==r.y&&(t=!0),this.originalRotation.z!==r.z&&(t=!0),this.originalRotation.w!==r.w&&(t=!0),this.originalRotation=r,this.originalPosition.x!==this.line.position.x&&(t=!0),this.originalPosition.y!==this.line.position.y&&(t=!0),this.originalPosition.z!==this.line.position.z&&(t=!0),this.originalPosition.x=this.line.position.x,this.originalPosition.y=this.line.position.y,this.originalPosition.z=this.line.position.z,this.originalScale.x!==this.line.scale.x&&(t=!0),this.originalScale.y!==this.line.scale.y&&(t=!0),this.originalScale.z!==this.line.scale.z&&(t=!0),this.originalScale.x=this.line.scale.x,this.originalScale.y=this.line.scale.y,this.originalScale.z=this.line.scale.z,!t)return;(o=this.selectionMap)==null||o.forEach((a,l)=>{const c=W().getSceneController().getIndexMesh(l);a[0].forEach(u=>{if(u.is_sel){const h=c==null?void 0:c.$getMeshMaterialFromRange(u.material_index,u.transformation,u.is_sel);if(h!=null&&h.$shader){const f=h.$shader;f.uniforms.transform.value=new dt}}})});const i=this.transform.elements;this.isProcessing=!0,this.selectionMap=await ae.selection_save_transformation(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15]),((s=this.controls)==null?void 0:s.mode)==="scale"&&(Rr.disable(),Rr.enable()),this.isProcessing=!1}}const Rr=new see,Xe=mr(()=>({enabled:!1,transformHelperEnabled:!1,lineHelperEnabled:!0,axisHelperEnabled:!1,inverted:!1,minX:0,minY:0,minZ:0,maxX:0,maxY:0,maxZ:0}));async function YE(){const n=W();if(n){const e=Pe.getState(),t=n.getActiveCamera();if(e.freezeCurrentCulling)return;await ae.cull_items(t.projectionMatrix,t.matrixWorldInverse,e.cullingDistance,e.cullingSize,t.position.clone(),e.occlusionCulling?n.getSceneController().getOccludedVolume_IDs():new Uint32Array,e.skipFustrumCulling)}}function JI(n=20){return new Promise(e=>{setTimeout(()=>{e()},n)})}function W3(){return new Promise(n=>{requestAnimationFrame(()=>{n()})})}const su=mr(()=>({isPointToPointDialogActive:!1,update:!1}));class fC extends Tr{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Ut(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const Kh=new N,$3=new dt,Y3=new dt,K3=new N,X3=new N;class aee{constructor(e={}){const t=this;let r,i,o,s;const a={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:r,height:i}},this.render=function(g,_){g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),_.parent===null&&_.matrixWorldAutoUpdate===!0&&_.updateMatrixWorld(),$3.copy(_.matrixWorldInverse),Y3.multiplyMatrices(_.projectionMatrix,$3),u(g,g,_),m(g)},this.setSize=function(g,_){r=g,i=_,o=r/2,s=i/2,l.style.width=g+"px",l.style.height=_+"px"};function c(g){g.isCSS2DObject&&(g.element.style.display="none");for(let _=0,v=g.children.length;_<v;_++)c(g.children[_])}function u(g,_,v){if(g.visible===!1){c(g);return}if(g.isCSS2DObject){Kh.setFromMatrixPosition(g.matrixWorld),Kh.applyMatrix4(Y3);const p=Kh.z>=-1&&Kh.z<=1&&g.layers.test(v.layers)===!0,x=g.element;x.style.display=p===!0?"":"none",p===!0&&(g.onBeforeRender(t,_,v),x.style.transform="translate("+-100*g.center.x+"%,"+-100*g.center.y+"%)translate("+(Kh.x*o+o)+"px,"+(-Kh.y*s+s)+"px)",x.parentNode!==l&&l.appendChild(x),g.onAfterRender(t,_,v));const y={distanceToCameraSquared:h(v,g)};a.objects.set(g,y)}for(let p=0,x=g.children.length;p<x;p++)u(g.children[p],_,v)}function h(g,_){return K3.setFromMatrixPosition(g.matrixWorld),X3.setFromMatrixPosition(_.matrixWorld),K3.distanceToSquared(X3)}function f(g){const _=[];return g.traverseVisible(function(v){v.isCSS2DObject&&_.push(v)}),_}function m(g){const _=f(g).sort(function(p,x){if(p.renderOrder!==x.renderOrder)return x.renderOrder-p.renderOrder;const y=a.objects.get(p).distanceToCameraSquared,w=a.objects.get(x).distanceToCameraSquared;return y-w}),v=_.length;for(let p=0,x=_.length;p<x;p++)_[p].element.style.zIndex=v-p}}}function er(){return crypto.randomUUID()}const Fn=mr(n=>({activated:!1,activate:()=>n(()=>({activated:!0})),deactivate:()=>n(()=>({activated:!1})),message:"",header:""}));async function lee(n){if(typeof showSaveFilePicker!="function"){Fn.setState({header:"Error",message:"Your browser does not support filesystem Access Api, use newest Chrome/Edge "});return}const e=`Web_3D_linePath_${new Date().toLocaleDateString("no-NO").replace(".","-")}.Web3LP`,t={types:[{description:"WEB 3d Line Path",accept:{"web3d/web3d":[".Web3LP"]}}],suggestedName:e},i=await(await showSaveFilePicker(t)).createWritable();await i.write(n),await i.close()}async function cee(){if(typeof showOpenFilePicker!="function"){Fn.setState({header:"Error",message:"Your browser does not support filesystem Access Api, use newest Chrome/Edge "});return}const n={types:[{description:"WEB 3d Line Path",accept:{"web3d/web3d":[".Web3LP"]}}],excludeAcceptAllOption:!0,multiple:!1},e=await showOpenFilePicker(n);if((e==null?void 0:e.length)>0)return await(await e[0].getFile()).text()}function r_(){const n=W().__lastClick;if(W().__lastClick){const e=new N,t=W().getActiveControls();t.getPosition(e);const r=e.distanceTo(W().__lastClick);t.smoothTime=.5,t.saveState(),t.setTarget(n.x,n.y,n.z);const i=r-5;t.dolly(i,!0).then(()=>{t.smoothTime=1,t.saveState()})}}function uee(){const n=new Ve(new sv(.05,16,16),new oj({color:new rt("orange"),opacity:.6,transparent:!0,side:vi,depthTest:!0})),e=new Ve(new sv(.01,16,16),new vu({color:new rt("orange"),side:vi,depthTest:!0})),t=new sl;return t.add(n,e),t.$setPicking=r=>{t.visible=!r},t.$xray=r=>{n.material.depthTest=!r,e.material.depthTest=!r},t}const pC="MEASURE_TAG";var Xp,Ic,mo,nl,yn,Xv,go,Kn,Pc,bd,Ad,Md,wt,co,bM,Uy,Rf,xz,qu,Fy,Nf;class dee{constructor(){ni(this,wt);ni(this,Xp,!1);ni(this,Ic,!1);ni(this,mo,[]);ni(this,nl,[]);ni(this,yn,{});ni(this,Xv,!1);Se(this,"activeMeasurePoint","");ni(this,go,new sl);ni(this,Kn,[]);ni(this,Pc,!1);ni(this,bd,!1);ni(this,Ad,!1);ni(this,Md,!1)}isSnapEdgeActive(){return Be(this,bd)}disableSnapEdge(){hn(this,bd,!1),jt(this,wt,co).call(this)}toggleSnapEdge(){hn(this,bd,!Be(this,bd)),jt(this,wt,co).call(this)}isGotoActive(){return Be(this,Md)}disableGoto(){hn(this,Md,!1),jt(this,wt,co).call(this)}toggleGoto(){hn(this,Md,!Be(this,Md)),jt(this,wt,co).call(this)}isSnapCornorActive(){return Be(this,Ad)}disableSnapCornor(){hn(this,Ad,!1),jt(this,wt,co).call(this)}toggleSnapCornor(){hn(this,Ad,!Be(this,Ad)),jt(this,wt,co).call(this)}isActive(){return Be(this,Xv)}setHidden(){hn(this,Pc,!1),jt(this,wt,Rf).call(this),jt(this,wt,co).call(this),W().forceRenderNextFrame()}isHidden(){return Be(this,Pc)}toggleHidden(){hn(this,Pc,!Be(this,Pc)),Be(this,Pc)?jt(this,wt,Uy).call(this):jt(this,wt,Rf).call(this),W().forceRenderNextFrame(),jt(this,wt,co).call(this)}isMeasureMode(){return Be(this,Xp)}getPoints(){return Be(this,Kn)}async saveToFile(){const e={version:1,points:jt(this,wt,Nf).call(this)};await lee(JSON.stringify(e))}async loadFile(){const e=await cee();if(e&&e.length>5){const t=JSON.parse(e);t&&t.version&&t.points&&(hn(this,mo,[]),hn(this,nl,[]),hn(this,Kn,t.points),jt(this,wt,Rf).call(this))}}render(){if(Be(this,Kn).length){const e=W();if(Be(this,Kn).length&&e)for(const t in Be(this,yn)){const r=e.getActiveCamera().position.distanceTo(Be(this,yn)[t].position);r<15&&(Be(this,yn)[t].scale.x=1,Be(this,yn)[t].scale.y=1,Be(this,yn)[t].scale.z=1,Be(this,yn)[t].$xray(!1)),r>15&&(Be(this,yn)[t].scale.x=3,Be(this,yn)[t].scale.y=3,Be(this,yn)[t].scale.z=3,Be(this,yn)[t].$xray(!0)),r>40&&(Be(this,yn)[t].scale.x=5,Be(this,yn)[t].scale.y=5,Be(this,yn)[t].scale.z=5,Be(this,yn)[t].$xray(!0))}}}toggleResetTotal(e){this.saveState(),Be(this,Kn)[e].resetTotal=!Be(this,Kn)[e].resetTotal,jt(this,wt,qu).call(this)}toggleAsEnd(e){this.saveState(),Be(this,Kn)[e].isEnd=!Be(this,Kn)[e].isEnd,jt(this,wt,qu).call(this)}onSelect(e,t,r,i,o,s){this.saveState();const a=W().getSceneController(),l=Be(this,Kn).filter(c=>c.id===this.activeMeasurePoint)[0];if(l){l.px=e,l.py=t,l.pz=r,l.nx=i,l.ny=o,l.nz=s;const c=jt(this,wt,bM).call(this,l.id);a.addMeshToScene(c,pC),c.position.copy(new N(e,t,r));const u=new Nt().getNormalMatrix(c.matrixWorld),h=new N(i,o,s).applyMatrix3(u).normalize(),f=new Hn().setFromUnitVectors(new N(0,1,0),h);c.quaternion.copy(f),l.isSet=!0,jt(this,wt,co).call(this),jt(this,wt,qu).call(this)}}isPointLabelEnabled(){return Be(this,Ic)}togglePointLabel(){hn(this,Ic,!Be(this,Ic))}getUndoStackSize(){return Be(this,mo).length}getRedoStackSize(){return Be(this,nl).length}saveState(){Be(this,mo).length?JSON.stringify(Be(this,mo)[Be(this,mo).length-1])!==JSON.stringify(jt(this,wt,Nf).call(this))&&Be(this,mo).push(jt(this,wt,Nf).call(this)):Be(this,mo).push(jt(this,wt,Nf).call(this)),hn(this,nl,[])}undo(){Be(this,nl).push(jt(this,wt,Nf).call(this));const e=Be(this,mo).pop();e&&(hn(this,Kn,e),jt(this,wt,Rf).call(this))}redo(){const e=Be(this,nl).pop();e&&(Be(this,mo).push(structuredClone(e)),hn(this,Kn,e),jt(this,wt,Rf).call(this))}deleteAll(){jt(this,wt,Uy).call(this),hn(this,mo,[]),hn(this,nl,[]),hn(this,Kn,[]),hn(this,Xp,!1),jt(this,wt,co).call(this),W().forceRenderNextFrame()}addPoint(e){if(this.saveState(),this.setMeasureMode(!0),this.activeMeasurePoint=er(),e!==void 0){Be(this,Kn).splice(e,0,{id:this.activeMeasurePoint,px:0,py:0,pz:0,nx:0,ny:0,nz:0,length:0,xLength:0,yLength:0,zLength:0,isSet:!1,pointNo:0,xShowLine:!1,yShowLine:!1,zShowLine:!1,isEnd:!1,resetTotal:!1});return}Be(this,Kn).push({id:this.activeMeasurePoint,px:0,py:0,pz:0,nx:0,ny:0,nz:0,length:0,xLength:0,yLength:0,zLength:0,isSet:!1,pointNo:0,xShowLine:!1,yShowLine:!1,zShowLine:!1,isEnd:!1,resetTotal:!1})}removePoint(e){this.saveState();const t=Be(this,Kn).filter(i=>i.id!=e);W().getSceneController().currentScene().remove(Be(this,yn)[e]),delete Be(this,yn)[e],hn(this,Kn,t),this.activeMeasurePoint===e&&(this.activeMeasurePoint="",this.setMeasureMode(!1))}setMeasureMode(e=!1){hn(this,Xp,e)}toggleAxis(e,t){this.saveState(),t==="X"&&(e.xShowLine=!e.xShowLine),t==="Y"&&(e.yShowLine=!e.yShowLine),t==="Z"&&(e.zShowLine=!e.zShowLine),jt(this,wt,qu).call(this)}updateLine(){jt(this,wt,qu).call(this)}clickCallback(e,t){if(t.ctrlKey&&(e!=null&&e.face)&&this.onSelect!==null&&this.addPoint(),e!=null&&e.face&&this.onSelect!==null){const r=new N(e.point.x,e.point.y,e.point.z);if(this.isGotoActive()){W().__lastClick=r,r_(),this.toggleGoto();return}if(this.isSnapEdgeActive()||this.isSnapCornorActive()){const i=new N(e.facePosition[0].x,e.facePosition[0].y,e.facePosition[0].z),o=new N(e.facePosition[1].x,e.facePosition[1].y,e.facePosition[1].z),s=new N(e.facePosition[2].x,e.facePosition[2].y,e.facePosition[2].z),a=new dt().fromArray(e.worldMatrix);i.applyMatrix4(a),o.applyMatrix4(a),s.applyMatrix4(a);const l=r.distanceTo(i),c=r.distanceTo(o),u=r.distanceTo(s),h=.1,f=l<h||c<h||u<h,m=jt(this,wt,Fy).call(this,r,i,o),g=jt(this,wt,Fy).call(this,r,o,s),_=jt(this,wt,Fy).call(this,r,s,i),v=.1,p=m.distance<v||g.distance<v||_.distance<v;let x;if(this.isSnapCornorActive()&&f){l<c&&l<u?x=i:c<u?x=o:x=s,this.onSelect(x.x,x.y,x.z,e.face.normal.x,e.face.normal.y,e.face.normal.z);return}this.isSnapEdgeActive()&&p?(m.distance<g.distance&&m.distance<_.distance?x=m.closestPoint:g.distance<_.distance?x=g.closestPoint:x=_.closestPoint,this.onSelect(x.x,x.y,x.z,e.face.normal.x,e.face.normal.y,e.face.normal.z)):this.onSelect(e.point.x,e.point.y,e.point.z,e.face.normal.x,e.face.normal.y,e.face.normal.z)}else this.onSelect(e.point.x,e.point.y,e.point.z,e.face.normal.x,e.face.normal.y,e.face.normal.z)}}}Xp=new WeakMap,Ic=new WeakMap,mo=new WeakMap,nl=new WeakMap,yn=new WeakMap,Xv=new WeakMap,go=new WeakMap,Kn=new WeakMap,Pc=new WeakMap,bd=new WeakMap,Ad=new WeakMap,Md=new WeakMap,wt=new WeakSet,co=function(){su.setState({update:!su.getState().update})},bM=function(e){return Be(this,yn)[e]||(Be(this,yn)[e]=uee()),Be(this,yn)[e]},Uy=function(){var t;const e=W().getSceneController().currentScene();for(const r in Be(this,yn))e.remove(Be(this,yn)[r]),delete Be(this,yn)[r];for(;Be(this,go).children.length;){const r=Be(this,go).children[0];r&&((t=r.element)!=null&&t.remove)&&(r.removeFromParent(),r.element.remove()),r&&Be(this,go).remove(r)}e.remove(Be(this,go)),hn(this,yn,{}),hn(this,go,new sl)},Rf=function(){jt(this,wt,Uy).call(this);const e=Be(this,Kn).filter(r=>r.isSet),t=W().getSceneController();e.forEach(r=>{const i=jt(this,wt,bM).call(this,r.id);Be(this,yn)[r.id]||(Be(this,yn)[r.id]=i),t.addMeshToScene(i,pC),i.position.copy(new N(r.px,r.py,r.pz));const o=new Nt().getNormalMatrix(i.matrixWorld),s=new N(r.nx,r.ny,r.nz).applyMatrix3(o).normalize(),a=new Hn().setFromUnitVectors(new N(0,1,0),s);i.quaternion.copy(a)}),jt(this,wt,qu).call(this),jt(this,wt,co).call(this)},xz=function(e,t){let r=t.clone().sub(e);const i=r.length()*.5;return r=r.normalize().multiplyScalar(i),e.clone().add(r)},qu=function(){var o;Be(this,Kn).map((s,a)=>{s.pointNo=a,s.xLength=0,s.yLength=0,s.zLength=0});const e=Be(this,Kn).filter(s=>s.isSet),t=W().getSceneController(),r=t.currentScene();for(;Be(this,go).children.length;){const s=Be(this,go).children[0];s&&((o=s.element)!=null&&o.remove)&&(s.removeFromParent(),s.element.remove()),s&&Be(this,go).remove(s)}r.remove(Be(this,go));const i=new sl;if(e.length>1){hn(this,Xv,!0);let s=0;for(let a=0;a<e.length-1;a++){const l=e[a],c=e[a+1];let u=!1,h=!1,f=!1;const m=e[a-1],g=e[a+2];switch(!0){case(m===void 0&&g===void 0):u=!0;break;case(m===void 0&&c.isEnd):u=!0;break;case(m===void 0&&c.resetTotal):u=!0;break;case(l.resetTotal&&c.resetTotal):u=!0;break;case(l.resetTotal&&g===void 0):u=!0;break;case((m==null?void 0:m.isEnd)&&g===void 0):u=!0;break;case((m==null?void 0:m.isEnd)&&c.resetTotal):u=!0;break;case((l.isEnd||l.resetTotal)&&(c.resetTotal||c.isEnd)):u=!0;break;case(!l.resetTotal&&(c.resetTotal||c.isEnd)):f=!0;break;case(m!==void 0&&g===void 0):f=!0;break;default:h=!0}if(l.xLength=l.px-c.px,l.yLength=l.py-c.py,l.zLength=l.pz-c.pz,l.xShowLine){const _=new Sn().setFromPoints([new N(l.px,l.py,l.pz),new N(l.px-l.xLength,l.py,l.pz)]),v=new Xr(_,new Eo({color:new rt("red"),depthTest:!1}));v.frustumCulled=!1,i.add(v);const p=new Xr(_,new DT({color:new rt("black"),linewidth:2,depthTest:!1,dashSize:.05,gapSize:.05}));p.computeLineDistances(),p.frustumCulled=!1,i.add(p)}if(l.yShowLine){const _=new Sn().setFromPoints([new N(l.px-l.xLength,l.py,l.pz),new N(l.px-l.xLength,l.py-l.yLength,l.pz)]),v=new Xr(_,new Eo({color:new rt("green"),depthTest:!1}));v.frustumCulled=!1,i.add(v);const p=new Xr(_,new DT({color:new rt("black"),linewidth:2,depthTest:!1,dashSize:.05,gapSize:.05}));p.computeLineDistances(),p.frustumCulled=!1,i.add(p)}if(l.zShowLine){const _=new Sn().setFromPoints([new N(l.px-l.xLength,l.py-l.yLength,l.pz),new N(l.px-l.xLength,l.py-l.yLength,l.pz-l.zLength)]),v=new Xr(_,new Eo({color:new rt("blue"),depthTest:!1}));v.frustumCulled=!1,i.add(v);const p=new Xr(_,new DT({color:new rt("black"),linewidth:2,depthTest:!1,dashSize:.05,gapSize:.05}));p.computeLineDistances(),p.frustumCulled=!1,i.add(p)}if(!l.isEnd){const _=new Sn().setFromPoints([new N(l.px,l.py,l.pz),new N(c.px,c.py,c.pz)]),v=new Xr(_,new Eo({color:new rt("black"),depthTest:!1}));v.frustumCulled=!1,i.add(v)}if(l.resetTotal&&(s=0),!l.isEnd){const _=document.createElement("div");u&&(_.className="measure-label-single"),h&&(_.className="measure-label-half"),f&&(_.className="measure-label-total");const v=new N(l.px,l.py,l.pz).distanceTo(new N(c.px,c.py,c.pz));l.length=v,s=s+v,_.innerText=`${s.toFixed(2)}m`;const p=new fC(_),x=jt(this,wt,xz).call(this,new N(l.px,l.py,l.pz),new N(c.px,c.py,c.pz));p.position.set(x.x,x.y,x.z),i.add(p)}if(Be(this,Ic)){const _=document.createElement("div");_.className="measure-label",_.innerText=`P${e[a].pointNo+1}`;const v=new fC(_);v.position.set(l.px+.1,l.py,l.pz),i.add(v)}if(Be(this,Ic)&&a===e.length-2){const _=document.createElement("div");_.className="measure-label",_.innerText=`P${e[a+1].pointNo+1}`;const v=new fC(_);v.position.set(c.px+.1,c.py,c.pz),i.add(v)}l.isEnd&&(s=0)}hn(this,go,i),t.addMeshToScene(i,pC)}W().forceRenderNextFrame(),jt(this,wt,co).call(this)},Fy=function(e,t,r){const i=new N().subVectors(r,t),s=new N().subVectors(e,t).dot(i)/i.lengthSq();if(s<0)return{distance:e.distanceTo(t),closestPoint:t.clone()};if(s>1)return{distance:e.distanceTo(r),closestPoint:r.clone()};const a=new N().copy(i).multiplyScalar(s).add(t);return{distance:e.distanceTo(a),closestPoint:a}},Nf=function(){return structuredClone(Be(this,Kn))};const it=new dee;var qp;class hee{constructor(){Se(this,"dataStore");Se(this,"rows_local_cache",[]);Se(this,"isWorking",0);Se(this,"updateIndexes",new Set);ni(this,qp,!1);Se(this,"rows_selected_sites",new Set);Se(this,"lastCulling");this.getStore()}showSelectionColor(){return Be(this,qp)}async getStore(){if(!this.dataStore){const e=new RQ,t=Um(e);this.dataStore=await new t}return this.dataStore}async meshes_set_mesh_as_loaded(e,t,r){return await(await this.getStore()).meshes_set_mesh_as_loaded(e,t,r)}async getBoundingBoxFromName(e,t){return await(await this.getStore()).getBoundingBoxFromName(e,t)}async update_hidden_groups(){const t=await(await this.getStore()).update_hidden_groups();this.updateMaterial(t)}async get_fullnames_from_selection(e=!1,t=!1){return await(await this.getStore()).get_fullnames_from_selection(e,t)}async get_selected_fullnames_from_loaded(e=!1){return await(await this.getStore()).get_selected_fullnames_from_loaded(e)}async getBoundingBoxFromKey(e){return await(await this.getStore()).getBoundingBoxFromKey(e)}async getBoundingBoxFromKeys(e){return await(await this.getStore()).getBoundingBoxFromKeys(e)}async get_bounding_box_from_selection(e=!1){return await(await this.getStore()).get_bounding_box_from_selection(e)}async all_sites_loaded(){await(await this.getStore()).all_sites_loaded()}async selection_save_transformation(e,t,r,i,o,s,a,l,c,u,h,f,m,g,_,v){const x=await(await this.getStore()).selection_save_transformation(e,t,r,i,o,s,a,l,c,u,h,f,m,g,_,v);return this.updateMaterial(x,!0),x}async filterFullname(e,t=0,r=5){return await(await this.getStore()).filterFullname(e,t,r)}async add_model_groups(e,t){await(await this.getStore()).add_model_groups(e,t)}async getKeyChildrenFromItem(e){return await(await this.getStore()).get_all_ids_from_ids(e)}async clear(){await(await this.getStore()).clear(),this.rows_local_cache=[],this.rows_selected_sites.clear()}length(){return this.rows_local_cache.length}async selection_is_hidden(e){return await(await this.getStore()).selection_is_hidden(e)}async undo_transform(){const t=await(await this.getStore()).undo_transform();this.updateMaterial(t,!0)}async selection_is_selected(e){return await(await this.getStore()).selection_is_selected(e)}async selection_add(e,t=!1){return await(await this.getStore()).selection_add(e,t)}async selection_remove(e){return await(await this.getStore()).selection_remove(e)}async selection_clear(e=!1){return await(await this.getStore()).selection_clear(e)}async unhide_all(){const t=await(await this.getStore()).unhide_all();this.updateMaterial(t,!0),await this.updateTreeCache()}async selection_reset(e,t,r,i){const s=await(await this.getStore()).selection_reset(e,t,r,i);this.updateMaterial(s,t||r),await this.updateTreeCache()}async hide_not_selected(){const t=await(await this.getStore()).hide_not_selected();this.updateMaterial(t,!0),await this.updateTreeCache()}async reset_all_meshes(e,t,r,i){const s=await(await this.getStore()).reset_all_meshes(e,t,r,i);this.updateMaterial(s,!0),await this.updateTreeCache()}async selection_show_only_selected(e){const r=await(await this.getStore()).selection_show_only_selected(e);this.updateMaterial(r,!0)}async selection_allow_selection_of_hidden(e){await(await this.getStore()).selection_allow_selection_of_hidden(e)}async reset_culling_all_meshes(){if(!this.isWorking)try{this.isWorking=1;const t=await(await this.getStore()).reset_culling_all_meshes();hn(this,qp,!0),this.updateMaterial(t),this.isWorking=0}catch(e){console.log(e),this.isWorking=0}}async get_bounding_boxes_from_selection(){return await(await this.getStore()).get_bounding_boxes_from_selection()}async set_occlusion_boxes(e){(await this.getStore()).set_occlusion_boxes(e)}refreshCulling(){Pe.getState().enableItemCulling&&this.lastCulling&&this.updateMaterial(this.lastCulling)}async cull_items(e,t,r,i,o,s,a){if(this.isWorking===0)try{this.isWorking=1,await JI(100);const l=Xe.getState(),c=l.enabled&&new nt().setFromArray([l.minX,l.minY,l.minZ,l.maxX,l.maxY,l.maxZ]),h=await(await this.getStore()).cull_items(e,t,r,i,o,s,c,a);this.lastCulling=h,await this.updateMaterialAsync(h),this.isWorking>1?(this.isWorking=0,YE()):this.isWorking=0}catch(l){console.error(l),this.isWorking=0}else this.isWorking=this.isWorking+1}updateMaterial(e,t=!1){hn(this,qp,t),t&&XJ(e),Array.from(e.keys()).forEach(i=>this.updateIndexes.delete(i)),e.forEach(([i,o,s],a)=>{const c=W().getSceneController().getIndexMesh(a);c==null||c.$updateGroups(i,o,s)}),it.updateLine(),W().forceRenderNextFrame()}waitAnimation(){}updateMaterialAsyncInternal(e,t,r,i){const s=W().getSceneController().getIndexMesh(i);s==null||s.$updateGroups(e,t,r)}async updateMaterialAsync(e){const t=Array.from(e.keys()),r=Array.from(e.values());this.updateIndexes=new Set(t),await W3();let i=performance.now();for(let o=0;o<t.length;o++){const s=t[o],[a,l,c]=r[o];performance.now()-i>10&&(await W3(),i=performance.now()),this.updateIndexes.has(s)&&(this.updateIndexes.delete(s),this.updateMaterialAsyncInternal(a,l,c,s))}W().forceRenderNextFrame()}async selection_set_color(e){const r=await(await this.getStore()).selection_set_color(e);this.updateMaterial(r),await this.updateTreeCache()}async updateTreeCache(){const e=await this.getStore(),[t,r]=await e.treeview_get_local_cache();this.rows_local_cache=t,this.rows_selected_sites=r}async selection_invert(){const t=await(await this.getStore()).selection_invert();this.updateMaterial(t,!0),await this.updateTreeCache()}async selection_append(){const t=await(await this.getStore()).selection_append();this.updateMaterial(t,!0),await this.updateTreeCache()}async meta_find_key_from_face_index(e,t){return await(await this.getStore()).meta_find_key_from_face_index(e,t)}async treeview_collapse(){await(await this.getStore()).treeview_collapse(),await this.treeview_reset_rows(),Pt.getState().updateToggel()}async treeview_reset_rows(){await(await this.getStore()).treeview_reset_rows(),await this.updateTreeCache()}async get_ids_from_fullnames(e,t=!0){return await(await this.getStore()).get_ids_from_fullnames(e,t)}async get_fullname_from_keys(e,t=!1){return await(await this.getStore()).get_fullname_from_keys(e,t)}getRow(e){return this.rows_local_cache[e]?this.rows_local_cache[e]:null}getRowOfKey(e){let t=null;for(let r=0;r<this.rows_local_cache.length;r++)if(this.rows_local_cache[r].key===e){t=r;break}return t}async getDataExt(e){return await(await this.getStore()).getDataExt(e)}async treeview_toggle_id(e){await(await this.getStore()).treeview_toggle_id(e),await this.updateTreeCache()}async treeview_expand_from_id(e){await(await this.getStore()).treeview_expand_from_id(e),await this.updateTreeCache()}async filter_geometry(e,t){return Rr.disable(),await(await this.getStore()).filter_geometry(e,t)}}qp=new WeakMap;const ae=new hee;class fee{constructor(e){Se(this,"__scene");Se(this,"__ambientLight");Se(this,"__pointLight");Se(this,"__gridHelper");Se(this,"__mainObjects",[]);Se(this,"__occludeTesters",[]);Se(this,"__occludedVolumes",new Map);Se(this,"__meshes",[]);Se(this,"__meshesGroups",{});Se(this,"__meshIndexes",new Map);Se(this,"__planeHelpers",[]);Se(this,"__selectionListeners",new Set);Se(this,"sceneBoundingBox",{max:null,min:null});Se(this,"__occludeBoxes",[]);Se(this,"allwaysOcclude",!1);this.canvasController=e,this.__addScene(),this.__addLights(),this.__addPlane()}showOccludeVolumes(){this.__occludeTesters.forEach(e=>{Array.isArray(e.material)||(e.material.colorWrite=!0,e.material.depthWrite=!0)})}hideOccludeVolumes(){this.__occludeTesters.forEach(e=>{Array.isArray(e.material)||(e.material.colorWrite=!1,e.material.depthWrite=!1)})}getOccluders(){return this.__occludeBoxes}clearOccluders(){this.__occludeBoxes=[],this.__occludedVolumes.clear(),this.__occludeTesters.forEach(e=>{this.__scene.remove(e)})}forceOccludeOn(e){this.__occludedVolumes.clear(),this.allwaysOcclude=e,e&&this.__occludeBoxes.forEach((t,r)=>{this.__occludedVolumes.set(r,t)})}getOccludedVolume_IDs(){return new Uint32Array(this.__occludedVolumes.keys())}getOccludedVolumes(){const e=[];return this.__occludedVolumes.forEach(t=>{t.min.toArray().forEach(r=>{e.push(r)}),t.max.toArray().forEach(r=>{e.push(r)})}),new Float32Array(e)}getCurrentOccludeBoxes(){return this.__occludeBoxes}addOccludeTesters(e){this.__occludeBoxes=e;const t=[];e.forEach(r=>{t.push(r.min.x),t.push(r.min.y),t.push(r.min.z),t.push(r.max.x),t.push(r.max.y),t.push(r.max.z)}),ae.set_occlusion_boxes(t),this.__occludedVolumes.clear(),this.__occludeTesters.forEach(r=>{this.__scene.remove(r)}),this.__occludeTesters=[],e.forEach((r,i)=>{const o=new N;r.getCenter(o);const s=new N;r.getSize(s);const a=new Xn(s.x,s.y,s.z),l=new vu({color:new rt().setHex(Math.random()*16777215),visible:!0,side:vi,colorWrite:!1,depthWrite:!1}),c=new Ve(a,l);c.position.copy(o),c.renderOrder=10,c.onBeforeRender=(u,h,f,m)=>{const g=m;if(g.enabled=Pe.getState().occlusionCulling,g.enabled?g.drawRange.count=1/0:g.drawRange.count=0,this.allwaysOcclude)return;const _=u.getContext();if(g.enabled&&!g.query&&(g.query=_.createQuery()),g.enabled&&g.query&&g.queryInProgress&&_.getQueryParameter(g.query,_.QUERY_RESULT_AVAILABLE)){if(g.occluded=!_.getQueryParameter(g.query,_.QUERY_RESULT),g.occluded&&!this.__occludedVolumes.has(i)){const v=W().getActiveCamera();r.containsPoint(v.position)||this.__occludedVolumes.set(i,r)}g.occluded||this.__occludedVolumes.delete(i),g.queryInProgress=!1}g.enabled&&!g.queryInProgress&&g.query&&_.beginQuery(_.ANY_SAMPLES_PASSED_CONSERVATIVE,g.query)},c.onAfterRender=function(u,h,f,m){const g=m;if(g.allwaysOcclude)return;const _=u.getContext();g.enabled&&!g.queryInProgress&&(g.queryInProgress=!0,_.endQuery(_.ANY_SAMPLES_PASSED_CONSERVATIVE))},this.__occludeTesters.push(c),this.__scene.add(c)})}__addScene(){this.__scene=new _w,this.__scene.background=new rt(Pe.getState().backgroundColor)}__addLights(){const e=new pQ(14540287,Pe.getState().lightPoint,0,0);e.position.x=0,e.position.y=0,e.position.z=0,this.__scene.add(e),this.__pointLight=e,this.__ambientLight=new mQ(16777198,Pe.getState().lightAmbient),this.__mainObjects.push(this.__ambientLight),this.__scene.add(this.__ambientLight)}__addPlane(e=100,t=50){this.__gridHelper=new bQ(e,t),this.__gridHelper.rotateX(-Math.PI/2),this.__mainObjects.push(this.__gridHelper),this.__scene.add(this.__gridHelper),this.__gridHelper.visible=!1}clearScene(){this.__meshes.forEach(e=>{var t,r;(t=e==null?void 0:e.geometry)==null||t.dispose(),(r=e==null?void 0:e.$geometry)==null||r.dispose(),e.remove(),e.__modelDBKeyIndex&&this.__meshIndexes.delete(e.__modelDBKeyIndex),this.__scene.remove(e)}),this.__meshes=[],this.__meshesGroups={},this.updateBB()}clearModelGroup(e,t=!0){if(Array.isArray(this.__meshesGroups[e])){const r=this.__meshesGroups[e];this.__meshesGroups[e]=[],r.forEach(i=>{i.remove(),this.__scene.remove(i),i.__modelDBKeyIndex&&this.__meshIndexes.delete(i.__modelDBKeyIndex);const o=this.__meshes.indexOf(i);o!==-1&&this.__meshes.splice(o,1)})}t||this.updateBB()}getMeshes(e,t){if(e)return this.__meshesGroups[e];if(Array.isArray(t)){const r=Object.keys(this.__meshesGroups).filter(o=>!t.includes(o)),i=[];return r.forEach(o=>{this.__meshesGroups[o].forEach(s=>i.push(s))}),i}return this.__meshes}getIndexMesh(e){return this.__meshIndexes.get(e)}currentScene(){return this.__scene}updateBB(){this.sceneBoundingBox={max:null,min:null},this.__meshes.forEach(e=>{if(e.name==="BoundingBoxHelper")return;const t=e.$getGeometryBoundingBox&&e.$getGeometryBoundingBox();t?(this.sceneBoundingBox.max===null&&(this.sceneBoundingBox.max=new N,this.sceneBoundingBox.max.copy(t.max)),this.sceneBoundingBox.min===null&&(this.sceneBoundingBox.min=new N,this.sceneBoundingBox.min.copy(t.min)),this.sceneBoundingBox.max.x<t.max.x&&(this.sceneBoundingBox.max.x=t.max.x),this.sceneBoundingBox.max.y<t.max.y&&(this.sceneBoundingBox.max.y=t.max.y),this.sceneBoundingBox.max.z<t.max.z&&(this.sceneBoundingBox.max.z=t.max.z),this.sceneBoundingBox.min.x>t.min.x&&(this.sceneBoundingBox.min.x=t.min.x),this.sceneBoundingBox.min.y>t.min.y&&(this.sceneBoundingBox.min.y=t.min.y),this.sceneBoundingBox.min.z>t.min.z&&(this.sceneBoundingBox.min.z=t.min.z)):console.warn("some geometry is missing boundingbox")})}addMeshToScene(e,t){if(e.$updateClippingPlanes){const r=this.canvasController.getClipping();r&&e.$updateClippingPlanes(r.getClippingPlanes())}this.__meshes.push(e),this.__scene.add(e),e.__modelDBKeyIndex&&this.__meshIndexes.set(e.__modelDBKeyIndex,e),t&&(Array.isArray(this.__meshesGroups[t])||(this.__meshesGroups[t]=[]),this.__meshesGroups[t].push(e))}getMeshGroups(){return Object.keys(this.__meshesGroups)}enablePlane(){this.__gridHelper.visible=!0}disablePlane(){this.__gridHelper.visible=!1}togglePlane(){this.__gridHelper.visible=!this.__gridHelper.visible}}const De=mr(()=>({z_plane_visible:!1,y_plane_visible:!1,x_plane_visible:!1,z_plane_enable:!1,y_plane_enable:!1,x_plane_enable:!1,z_plane_neg:!0,y_plane_neg:!0,x_plane_neg:!0,z_plane_offset:0,y_plane_offset:0,x_plane_offset:0})),yi=[new da(new N(1,0,0),0),new da(new N(0,1,0),0),new da(new N(0,0,1),0)];class mC extends Xr{constructor(t,r=1,i=16776960){const o=i,s=[1,1,1],a=new Sn;a.setAttribute("position",new tn(s,3)),a.computeBoundingSphere();super(a,new Eo({color:o,toneMapped:!1}));Se(this,"plane");Se(this,"size");this.plane=t,this.size=r;const l=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],c=new Sn;c.setAttribute("position",new tn(l,3)),c.computeBoundingSphere(),this.add(new Ve(c,new vu({color:o,opacity:0,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let r=-this.plane.constant;Math.abs(r)<1e-8&&(r=1e-8),this.scale.set(.5*this.size,.5*this.size,r),this.children[0].material.side=vi,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}}class pee{constructor(){Se(this,"controls")}updateClipShader(e=!0){let t=Xe.getState();const r=t.enabled;if(t.minX===0&&t.minY===0&&t.minZ===0&&t.maxX===0&&t.maxY===0&&t.maxZ===0){const o=W().getSceneController().sceneBoundingBox;if(!o.max||!o.min)return;Xe.setState({minX:o.min.x,minY:o.min.y,minZ:o.min.z,maxX:o.max.x,maxY:o.max.y,maxZ:o.max.z}),t=Xe.getState()}W().getSceneController().getMeshes().forEach(o=>{const s=o.$getMaterials&&o.$getMaterials();Array.isArray(s)&&s.forEach(a=>{if(a!=null&&a.$shader){const l=a.$shader.uniforms;l.boxEnabled.value=r,l.boxmax.value=new N(t.maxX,t.maxY,t.maxZ),l.boxmin.value=new N(t.minX,t.minY,t.minZ)}})}),e&&t.transformHelperEnabled&&(this.toggleTransformHelper(),this.toggleTransformHelper())}toggleMode(){this.controls&&(this.controls.getMode()==="translate"?this.controls.setMode("scale"):this.controls.setMode("translate"))}filter(e){const t=Xe.getState(),r=t.enabled,i=new nt(new N(t.minX,t.minY,t.minZ),new N(t.maxX,t.maxY,t.maxZ)),o=s=>s.object.visible?r?i.containsPoint(s.point):!0:!1;return e.filter(o)}beforeRender(){const e=Xe.getState(),t=e.enabled,r=new nt(new N(e.minX,e.minY,e.minZ),new N(e.maxX,e.maxY,e.maxZ));t&&W().getSceneController().getMeshes().forEach(o=>{if(o.$getMaterials){const s=o.$getMaterials(),a=o.$getGeometryBoundingBox();a&&Array.isArray(s)&&(r.intersectsBox(a)||(o.visible=!1))}})}afterRender(){Xe.getState().enabled&&W().getSceneController().getMeshes().forEach(i=>{i.visible=!0})}async resizeToLoaded(){const e=W().getSceneController().sceneBoundingBox;Xe.setState({minX:e.min.x,minY:e.min.y,minZ:e.min.z,maxX:e.max.x,maxY:e.max.y,maxZ:e.max.z}),this.updateAxisGeometry(),this.updateLineGeometry(),this.updateClipShader(),W().forceRenderNextFrame()}async resizeToSelected(e=new N(0,0,0),t=new N(0,0,0)){const r=await ae.get_bounding_box_from_selection(),i=new nt(new N(r.x,r.y,r.z),new N(r.X,r.Y,r.Z));return i.expandByVector(e),i.translate(t),bt.flushSync(()=>{Xe.setState({minX:i.min.x,minY:i.min.y,minZ:i.min.z,maxX:i.max.x,maxY:i.max.y,maxZ:i.max.z})}),this.updateAxisGeometry(),this.updateLineGeometry(),this.updateClipShader(),W().forceRenderNextFrame(),i}toggleClipping(){const e=Xe.getState();e.enabled&&W().getSceneController().getMeshes().forEach(r=>{r.visible=!0}),Xe.setState({enabled:!e.enabled}),this.updateClipShader(),this.updateClippingHelper(),W().forceRenderNextFrame()}disable(){Xe.getState().enabled&&this.toggleClipping()}toggleTransformHelper(){const t=!Xe.getState().transformHelperEnabled;Xe.setState({transformHelperEnabled:t}),this.updateClippingHelper()}toggleLineHelper(){const t=!Xe.getState().lineHelperEnabled;Xe.setState({lineHelperEnabled:t}),this.updateClippingHelper()}toggleAxisHelper(){const t=!Xe.getState().axisHelperEnabled;Xe.setState({axisHelperEnabled:t}),this.updateAxisGeometry(),lE.forceRenderNextFrame()}updateAxisGeometry(){let e=Xe.getState();if(W().getSceneController().clearModelGroup("AXES_CLIPPING"),!e.enabled||!e.axisHelperEnabled||e.transformHelperEnabled)return;if(e.minX===0&&e.minY===0&&e.minZ===0&&e.maxX===0&&e.maxY===0&&e.maxZ===0){const o=W().getSceneController().sceneBoundingBox;Xe.setState({minX:o.min.x,minY:o.min.y,minZ:o.min.z,maxX:o.max.x,maxY:o.max.y,maxZ:o.max.z}),e=Xe.getState()}const t=new nt(new N(e.minX,e.minY,e.minZ),new N(e.maxX,e.maxY,e.maxZ)),r=new AQ(5);Array.isArray(r.material)||(r.material.depthTest=!1),t.getCenter(r.position),r.matrixWorldNeedsUpdate=!0;const i=r;return i.$setPicking=o=>{r.visible=!o},W().getSceneController().addMeshToScene(r,"AXES_CLIPPING"),r}updateLineGeometry(){let e=Xe.getState();const t=e.enabled;if(W().getSceneController().clearModelGroup("BOX_CLIPPING"),!t)return;if(e.minX===0&&e.minY===0&&e.minZ===0&&e.maxX===0&&e.maxY===0&&e.maxZ===0){const l=W().getSceneController().sceneBoundingBox;Xe.setState({minX:l.min.x,minY:l.min.y,minZ:l.min.z,maxX:l.max.x,maxY:l.max.y,maxZ:l.max.z}),e=Xe.getState()}const r=new nt(new N(e.minX,e.minY,e.minZ),new N(e.maxX,e.maxY,e.maxZ)),i=new Xn(Math.abs(e.maxX-e.minX),Math.abs(e.maxY-e.minY),Math.abs(e.maxZ-e.minZ)),o=new Eo({color:"yellow",linewidth:2,visible:e.lineHelperEnabled,depthTest:!0,linecap:"round",linejoin:"round"}),s=new ij(i),a=new Zv(s,o);return a.$setPicking=l=>{a.visible=!l},r.getCenter(a.position),W().getSceneController().addMeshToScene(a,"BOX_CLIPPING"),a}updateClippingHelper(){const e=Xe.getState(),t=e.transformHelperEnabled,r=e.enabled;W().getSceneController().clearModelGroup("BOX_CONTROLS"),this.controls&&(this.controls.disconnect(),this.controls=null);const i=this.updateLineGeometry();if(t&&r&&i){this.controls=new _z(W().getActiveCamera(),W().getRender().domElement),this.controls.addEventListener("change",()=>{let s=Xe.getState();const a=s.enabled,l=new nt().setFromObject(i);Xe.setState({minX:l.min.x,minY:l.min.y,minZ:l.min.z,maxX:l.max.x,maxY:l.max.y,maxZ:l.max.z}),s=Xe.getState(),a&&this.updateClipShader(!1),this.updateAxisGeometry(),Pe.getState().enableItemCulling&&YE(),W().forceRenderNextFrame()}),this.controls.setSize(.75),this.controls.addEventListener("mouseDown",function(){const s=W().getActiveControls();s.enabled=!1,s.saveState()}),this.controls.addEventListener("mouseUp",function(){const s=W().getActiveControls();s.enabled=!0,s.saveState()}),this.controls.attach(i),this.controls.setMode("translate"),this.controls.enabled=!0;const o=this.controls.getHelper();W().getSceneController().addMeshToScene(o,"BOX_CONTROLS")}W().forceRenderNextFrame()}}const Xt=new pee;class mee{constructor(e){Se(this,"__planeHelpers",[]);this.__canvasController=e,this.__planeHelpers.push(new mC(yi[0],500,16711680)),this.__planeHelpers.push(new mC(yi[1],500,65280)),this.__planeHelpers.push(new mC(yi[2],500,255)),this.__addClipping()}getClippingPlanes(){const e=De.getState(),t=[];return e.x_plane_enable&&t.push(yi[0]),e.y_plane_enable&&t.push(yi[1]),e.z_plane_enable&&t.push(yi[2]),t}filterClippingPlanes(e){const t=this.getClippingPlanes();function r(i){if(!i.object.visible)return!1;if(!t.length)return!0;let s=!1,a=0;return t.forEach(l=>{const c=parseFloat(l.distanceToPoint(i.point));s||c>0&&a++}),a===t.length&&(s=!0),s}return Xt.filter(e.filter(r))}__addClipping(){this.__canvasController.getRender().localClippingEnabled=!0,this.__planeHelpers.forEach(r=>{r.visible=!1,this.__canvasController.getSceneController().currentScene().add(r)});function e(r){return JSON.parse(JSON.stringify(r))}let t=e(De.getState());De.subscribe(()=>{const r=De.getState();if(r.x_plane_neg!==t.x_plane_neg&&yi[0].negate(),r.y_plane_neg!==t.y_plane_neg&&yi[1].negate(),r.z_plane_neg!==t.z_plane_neg&&yi[2].negate(),r.x_plane_visible!==t.x_plane_visible&&(this.__planeHelpers[0].visible=r.x_plane_visible),r.y_plane_visible!==t.y_plane_visible&&(this.__planeHelpers[1].visible=r.y_plane_visible),r.z_plane_visible!==t.z_plane_visible&&(this.__planeHelpers[2].visible=r.z_plane_visible),r.x_plane_offset!==t.x_plane_offset&&(yi[0].constant=r.x_plane_offset),r.y_plane_offset!==t.y_plane_offset&&(yi[1].constant=r.y_plane_offset),r.z_plane_offset!==t.z_plane_offset&&(yi[2].constant=r.z_plane_offset),r.x_plane_enable!==t.x_plane_enable||r.y_plane_enable!==t.y_plane_enable||r.z_plane_enable!==t.z_plane_enable){const i=[];r.x_plane_enable&&i.push(yi[0]),r.y_plane_enable&&i.push(yi[1]),r.z_plane_enable&&i.push(yi[2]),this.__canvasController.getSceneController().getMeshes().forEach(o=>{if(o.$getMaterials){const s=o.$getMaterials();Array.isArray(s)&&s.forEach(a=>{a.clippingPlanes=i})}})}t=e(De.getState()),this.__canvasController.forceRenderNextFrame()})}}const dm=mr(()=>({mode:"3D"}));function gee(n){return new Worker(""+new URL("rayCasterWorker-C42BFZ4j.js",import.meta.url).href,{name:n==null?void 0:n.name})}async function vee(){const n=new gee,e=Um(n);return[await new e,n]}class q3 extends HTMLElement{constructor(e,t){super(),this.camera=e,this.options=Object.assign({size:200,padding:8,bubbleSizePrimary:10,bubbleSizeSeconday:10,showSecondary:!0,lineWidth:2,fontSize:"10px",fontFamily:"arial",fontWeight:"bold",fontColor:"#151515",fontYAdjust:0,colors:{x:["#f73c3c","#942424"],y:["#6ccb26","#417a17"],z:["#178cf0","#0e5490"]}},t),this.onAxisSelected=null,this.bubbles=[{axis:"x",direction:new N(1,0,0),size:this.options.bubbleSizePrimary,color:this.options.colors.x,line:this.options.lineWidth,label:"E"},{axis:"y",direction:new N(0,1,0),size:this.options.bubbleSizePrimary,color:this.options.colors.y,line:this.options.lineWidth,label:"N"},{axis:"z",direction:new N(0,0,1),size:this.options.bubbleSizePrimary,color:this.options.colors.z,line:this.options.lineWidth,label:"U"},{axis:"-x",direction:new N(-1,0,0),size:this.options.bubbleSizeSeconday,color:this.options.colors.x,label:"W"},{axis:"-y",direction:new N(0,-1,0),size:this.options.bubbleSizeSeconday,color:this.options.colors.y,label:"S"},{axis:"-z",direction:new N(0,0,-1),size:this.options.bubbleSizeSeconday,color:this.options.colors.z,label:"D"}],this.center=new N(this.options.size/2,this.options.size/2,0),this.selectedAxis=null,this.innerHTML="<canvas width='"+this.options.size+"' height='"+this.options.size+"'></canvas>",this.onMouseMove=this.onMouseMove.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseClick=this.onMouseClick.bind(this)}connectedCallback(){this.canvas=this.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.addEventListener("mousemove",this.onMouseMove,!1),this.canvas.addEventListener("mouseout",this.onMouseOut,!1),this.canvas.addEventListener("click",this.onMouseClick,!1)}disconnectedCallback(){this.canvas.removeEventListener("mousemove",this.onMouseMove,!1),this.canvas.removeEventListener("mouseout",this.onMouseOut,!1),this.canvas.removeEventListener("click",this.onMouseClick,!1)}onMouseMove(e){const t=this.canvas.getBoundingClientRect();this.mouse=new N(e.clientX-t.left,e.clientY-t.top,0)}onMouseOut(){this.mouse=null}onMouseClick(){this.onAxisSelected&&typeof this.onAxisSelected=="function"&&this.onAxisSelected({axis:this.selectedAxis.axis,direction:this.selectedAxis.direction.clone()})}clear(){this.canvas&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}drawCircle(e,t=10,r="#FF0000"){this.context.beginPath(),this.context.arc(e.x,e.y,t,0,2*Math.PI,!1),this.context.fillStyle=r,this.context.fill(),this.context.closePath()}drawLine(e,t,r=1,i="#FF0000"){this.context.beginPath(),this.context.moveTo(e.x,e.y),this.context.lineTo(t.x,t.y),this.context.lineWidth=r,this.context.strokeStyle=i,this.context.stroke(),this.context.closePath()}update(){this.clear();const t=new dt().makeRotationFromEuler(this.camera.rotation).clone().invert();for(const i of this.bubbles)i.position=this.getBubblePosition(i.direction.clone().applyMatrix4(t));const r=[];for(const i in this.bubbles)(this.options.showSecondary===!0||i[0]!=="-")&&r.push(this.bubbles[i]);if(r.sort((i,o)=>i.position.z>o.position.z?1:-1),this.selectedAxis=null,this.mouse){let i=1/0;for(const o of r){const s=this.mouse.distanceTo(o.position);(s<i||s<o.size)&&(i=s,this.selectedAxis=o)}}this.drawLayers(r)}drawLayers(e){for(const t of e){let r=t.color;this.selectedAxis===t?r="#FFFFFF":t.position.z>=-.01?r=t.color[0]:r=t.color[1],this.drawCircle(t.position,t.size,r),t.line&&this.drawLine(this.center,t.position,t.line,r),t.label&&(this.context.font=[this.options.fontWeight,this.options.fontSize,this.options.fontFamily].join(" "),this.context.fillStyle=this.options.fontColor,this.context.textBaseline="middle",this.context.textAlign="center",this.context.fillText(t.label,t.position.x,t.position.y+this.options.fontYAdjust))}}getBubblePosition(e){return new N(e.x*(this.center.x-this.options.bubbleSizePrimary/2-this.options.padding)+this.center.x,this.center.y-e.y*(this.center.y-this.options.bubbleSizePrimary/2-this.options.padding),e.z)}}class Oi{constructor(e,t=1,r="DATA"){Se(this,"__name");Se(this,"__version");Se(this,"__storeName");Se(this,"__logEnabled");Se(this,"__db");this.__name=e,this.__version=t,this.__storeName=r,this.__logEnabled=!1}enableLog(){this.__logEnabled=!0}__logStart(e){this.__logEnabled&&console.time(`ModelStoreLog_${this.__name}_${this.__storeName}_${e}`)}__logEnd(e){this.__logEnabled&&console.timeEnd(`ModelStoreLog_${this.__name}_${this.__storeName}_${e}`)}close(){return new Promise(e=>{this.__db&&(this.__db.close(),e(!0))})}__open(){return new Promise((e,t)=>{if(this.__db)e(this.__db);else{const r=indexedDB.open(this.__name,this.__version);r.onupgradeneeded=()=>{const i=r.result;i.objectStoreNames.contains(this.__name)||i.createObjectStore(this.__storeName)},r.onblocked=i=>{this.__logEnd("getKey"),t({type:"onblocked",event:i})},r.onerror=i=>{this.__logEnd("getKey"),t({type:"onblocked",event:i})},r.onsuccess=()=>{this.__db=r.result,e(r.result)}}})}getUUID(){return crypto.randomUUID()}getJsonKey(e){return new Promise(async(t,r)=>{this.__logStart("getKey");try{const o=(await this.__open()).transaction(this.__storeName);o.onerror=l=>{this.__logEnd("getKey"),r({type:"store tx error",event:l})};const a=o.objectStore(this.__storeName).get(e);a.onsuccess=()=>{this.__logEnd("getKey"),t(a.result)}}catch(i){this.__logEnd("getKey"),r(i)}})}getBufferKey(e){return new Promise(async(t,r)=>{this.__logStart("getKey");try{const o=(await this.__open()).transaction(this.__storeName);o.onerror=l=>{this.__logEnd("getKey"),r({type:"store tx error",event:l})};const a=o.objectStore(this.__storeName).get(e);a.onsuccess=()=>{this.__logEnd("getKey"),t(a.result)}}catch(i){this.__logEnd("getKey"),r(i)}})}setJsonKey(e,t){return new Promise(async(r,i)=>{var o;this.__logStart("setKey");try{const a=(await this.__open()).transaction(this.__storeName,"readwrite");a.onerror=u=>{this.__logEnd("setKey"),i({type:"store tx error",event:u})};const c=a.objectStore(this.__storeName).put(t,e);c.onsuccess=()=>{this.__logEnd("setKey"),r(c.result)},(o=c.transaction)==null||o.commit()}catch(s){this.__logEnd("setKey"),i(s)}})}setBufferKey(e,t){return new Promise(async(r,i)=>{var o;this.__logStart("setKey");try{const a=(await this.__open()).transaction(this.__storeName,"readwrite");a.onerror=u=>{this.__logEnd("setKey"),i({type:"store tx error",event:u})};const c=a.objectStore(this.__storeName).put(t,e);c.onsuccess=()=>{this.__logEnd("setKey"),r(c.result)},(o=c.transaction)==null||o.commit()}catch(s){this.__logEnd("setKey"),i(s)}})}deleteKey(e){return new Promise(async(t,r)=>{this.__logStart("deleteKey");try{const o=(await this.__open()).transaction(this.__storeName,"readwrite");o.onerror=l=>{this.__logEnd("deleteKey"),r({type:"store tx error",event:l})};const a=o.objectStore(this.__storeName).delete(e);a.onsuccess=()=>{this.__logEnd("deleteKey"),t(a.result)}}catch(i){this.__logEnd("deleteKey"),r(i)}})}deleteDB(){return new Promise((e,t)=>{this.__logStart("deleteDB");const r=indexedDB.deleteDatabase(this.__name);r.onsuccess=()=>{this.__logEnd("deleteDB"),e(!0)},r.onerror=i=>{this.__logEnd("deleteDB"),t({type:"onblocked",event:i})}})}}const gC="APP_CONFIG";function eP(){var n;return window.__APP_DEV_ENV&&(window.__APP_ENV=window.__APP_DEV_ENV),((n=window.__APP_ENV)==null?void 0:n.ENV__AZURE_CLIENT_ID)!==void 0}async function Ua(n=!1){const e=new Oi(gC);if(n){window||console.error("update storage can only be used on main tread"),window.__APP_DEV_ENV&&(window.__APP_ENV=window.__APP_DEV_ENV);const t=window.__APP_ENV||{};return await e.setJsonKey(gC,t),t}return await e.getJsonKey(gC)}async function _ee(n,e,t,r=!1){const i=await Ua();return await fetch(`${i.ENV__AZURE_STORAGE_URL}/${e}/${t}?${n}`,{headers:{"cache-control":"no-cache"},method:r?"HEAD":"GET"})}var wo=Uint8Array,op=Uint16Array,xee=Int32Array,yz=new wo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wz=new wo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yee=new wo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Sz=function(n,e){for(var t=new op(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var i=new xee(t[30]),r=1;r<30;++r)for(var o=t[r];o<t[r+1];++o)i[o]=o-t[r]<<5|r;return{b:t,r:i}},Ez=Sz(yz,2),Tz=Ez.b,wee=Ez.r;Tz[28]=258,wee[258]=28;var See=Sz(wz,0),Eee=See.b,AM=new op(32768);for(var Dn=0;Dn<32768;++Dn){var oc=(Dn&43690)>>1|(Dn&21845)<<1;oc=(oc&52428)>>2|(oc&13107)<<2,oc=(oc&61680)>>4|(oc&3855)<<4,AM[Dn]=((oc&65280)>>8|(oc&255)<<8)>>1}var D0=function(n,e,t){for(var r=n.length,i=0,o=new op(e);i<r;++i)n[i]&&++o[n[i]-1];var s=new op(e);for(i=1;i<e;++i)s[i]=s[i-1]+o[i-1]<<1;var a;if(t){a=new op(1<<e);var l=15-e;for(i=0;i<r;++i)if(n[i])for(var c=i<<4|n[i],u=e-n[i],h=s[n[i]-1]++<<u,f=h|(1<<u)-1;h<=f;++h)a[AM[h]>>l]=c}else for(a=new op(r),i=0;i<r;++i)n[i]&&(a[i]=AM[s[n[i]-1]++]>>15-n[i]);return a},i_=new wo(288);for(var Dn=0;Dn<144;++Dn)i_[Dn]=8;for(var Dn=144;Dn<256;++Dn)i_[Dn]=9;for(var Dn=256;Dn<280;++Dn)i_[Dn]=7;for(var Dn=280;Dn<288;++Dn)i_[Dn]=8;var Cz=new wo(32);for(var Dn=0;Dn<32;++Dn)Cz[Dn]=5;var Tee=D0(i_,9,1),Cee=D0(Cz,5,1),vC=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},_s=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},_C=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},bee=function(n){return(n+7)/8|0},tP=function(n,e,t){return(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length),new wo(n.subarray(e,t))},Aee=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Go=function(n,e,t){var r=new Error(e||Aee[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,Go),!t)throw r;return r},Mee=function(n,e,t,r){var i=n.length,o=r?r.length:0;if(!i||e.f&&!e.l)return t||new wo(0);var s=!t,a=s||e.i!=2,l=e.i;s&&(t=new wo(i*3));var c=function(_t){var pt=t.length;if(_t>pt){var $=new wo(Math.max(pt*2,_t));$.set(t),t=$}},u=e.f||0,h=e.p||0,f=e.b||0,m=e.l,g=e.d,_=e.m,v=e.n,p=i*8;do{if(!m){u=_s(n,h,1);var x=_s(n,h+1,3);if(h+=3,x)if(x==1)m=Tee,g=Cee,_=9,v=5;else if(x==2){var T=_s(n,h,31)+257,S=_s(n,h+10,15)+4,b=T+_s(n,h+5,31)+1;h+=14;for(var R=new wo(b),E=new wo(19),A=0;A<S;++A)E[yee[A]]=_s(n,h+A*3,7);h+=S*3;for(var F=vC(E),D=(1<<F)-1,M=D0(E,F,1),A=0;A<b;){var k=M[_s(n,h,D)];h+=k&15;var y=k>>4;if(y<16)R[A++]=y;else{var z=0,P=0;for(y==16?(P=3+_s(n,h,3),h+=2,z=R[A-1]):y==17?(P=3+_s(n,h,7),h+=3):y==18&&(P=11+_s(n,h,127),h+=7);P--;)R[A++]=z}}var U=R.subarray(0,T),Y=R.subarray(T);_=vC(U),v=vC(Y),m=D0(U,_,1),g=D0(Y,v,1)}else Go(1);else{var y=bee(h)+4,w=n[y-4]|n[y-3]<<8,C=y+w;if(C>i){l&&Go(0);break}a&&c(f+w),t.set(n.subarray(y,C),f),e.b=f+=w,e.p=h=C*8,e.f=u;continue}if(h>p){l&&Go(0);break}}a&&c(f+131072);for(var Z=(1<<_)-1,j=(1<<v)-1,X=h;;X=h){var z=m[_C(n,h)&Z],B=z>>4;if(h+=z&15,h>p){l&&Go(0);break}if(z||Go(2),B<256)t[f++]=B;else if(B==256){X=h,m=null;break}else{var K=B-254;if(B>264){var A=B-257,ee=yz[A];K=_s(n,h,(1<<ee)-1)+Tz[A],h+=ee}var fe=g[_C(n,h)&j],ce=fe>>4;fe||Go(3),h+=fe&15;var Y=Eee[ce];if(ce>3){var ee=wz[ce];Y+=_C(n,h)&(1<<ee)-1,h+=ee}if(h>p){l&&Go(0);break}a&&c(f+131072);var we=f+K;if(f<Y){var Ie=o-Y,ft=Math.min(Y,we);for(Ie+f<0&&Go(3);f<ft;++f)t[f]=r[Ie+f]}for(;f<we;++f)t[f]=t[f-Y]}}e.l=m,e.p=X,e.b=f,e.f=u,m&&(u=1,e.m=_,e.d=g,e.n=v)}while(!u);return f!=t.length&&s?tP(t,0,f):t.subarray(0,f)},Ree=new wo(0),ma=function(n,e){return n[e]|n[e+1]<<8},Ms=function(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0},xC=function(n,e){return Ms(n,e)+Ms(n,e+4)*4294967296};function Nee(n,e){return Mee(n,{i:2},e&&e.out,e&&e.dictionary)}var MM=typeof TextDecoder<"u"&&new TextDecoder,Iee=0;try{MM.decode(Ree,{stream:!0}),Iee=1}catch{}var Pee=function(n){for(var e="",t=0;;){var r=n[t++],i=(r>127)+(r>223)+(r>239);if(t+i>n.length)return{s:e,r:tP(n,t-1)};i?i==3?(r=((r&15)<<18|(n[t++]&63)<<12|(n[t++]&63)<<6|n[t++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?e+=String.fromCharCode((r&31)<<6|n[t++]&63):e+=String.fromCharCode((r&15)<<12|(n[t++]&63)<<6|n[t++]&63):e+=String.fromCharCode(r)}};function bz(n,e){if(e){for(var t="",r=0;r<n.length;r+=16384)t+=String.fromCharCode.apply(null,n.subarray(r,r+16384));return t}else{if(MM)return MM.decode(n);var i=Pee(n),o=i.s,t=i.r;return t.length&&Go(8),o}}var kee=function(n,e){return e+30+ma(n,e+26)+ma(n,e+28)},Lee=function(n,e,t){var r=ma(n,e+28),i=bz(n.subarray(e+46,e+46+r),!(ma(n,e+8)&2048)),o=e+46+r,s=Ms(n,e+20),a=t&&s==4294967295?Oee(n,o):[s,Ms(n,e+24),Ms(n,e+42)],l=a[0],c=a[1],u=a[2];return[ma(n,e+10),l,c,i,o+ma(n,e+30)+ma(n,e+32),u]},Oee=function(n,e){for(;ma(n,e)!=1;e+=4+ma(n,e+2));return[xC(n,e+12),xC(n,e+4),xC(n,e+20)]};function Dee(n,e){for(var t={},r=n.length-22;Ms(n,r)!=101010256;--r)(!r||n.length-r>65558)&&Go(13);var i=ma(n,r+8);if(!i)return{};var o=Ms(n,r+16),s=o==4294967295||i==65535;if(s){var a=Ms(n,r-12);s=Ms(n,a)==101075792,s&&(i=Ms(n,a+32),o=Ms(n,a+48))}for(var l=0;l<i;++l){var c=Lee(n,o,s),u=c[0],h=c[1],f=c[2],m=c[3],g=c[4],_=c[5],v=kee(n,_);o=g,u?u==8?t[m]=Nee(n.subarray(v,v+h),{out:new wo(f)}):Go(14,"unknown compression type "+u):t[m]=tP(n,v,v+h)}return t}async function Uee(n){const e=new FileReader;return new Promise((t,r)=>{e.onloadend=i=>{var o;i.target?t((o=i.target)==null?void 0:o.result):t(null)},e.onerror=r,e.readAsArrayBuffer(n)})}async function Fee(n){const e=new FileReader;return new Promise((t,r)=>{e.onloadend=i=>{i.target?t(i.target.result):t(null)},e.onerror=r,e.readAsText(n)})}async function jee(n,e){if(e){const t=await Uee(n);if(t instanceof ArrayBuffer){const r=Dee(new Uint8Array(t)),i=Object.keys(r)[0];if(i){const o=bz(r[i]);if(o&&typeof o=="string")return JSON.parse(o)}}return null}else{const t=await Fee(n);return t&&typeof t=="string"?JSON.parse(t):null}}async function Id(n,e,t,r=!1){const i=await _ee(n,e,t);if(i.ok)return jee(await i.blob(),t.includes(".zip"));throw r||(console.warn("error"),console.warn(t)),i.statusText}let RM=!0;function Az(){const n=RM;return RM=!1,n}function Mz(n){RM=!0,n==="This request is not authorized to perform this operation using this permission."?Fn.setState({activated:!0,header:"Access error",message:"You do not have access, if you just recived access then try again in 1 minute"}):Fn.setState({activated:!0,header:"Nettwork error",message:n})}/*! @azure/msal-common v14.15.0 2024-09-20 */const ge={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},xx={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},Bm=[ge.OPENID_SCOPE,ge.PROFILE_SCOPE,ge.OFFLINE_ACCESS_SCOPE],Q3=[...Bm,ge.EMAIL_SCOPE],_a={CONTENT_TYPE:"Content-Type",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},Ur={ID_TOKEN:"idtoken",CLIENT_INFO:"client.info",ADAL_ID_TOKEN:"adal.idtoken",ERROR:"error",ERROR_DESC:"error.description",ACTIVE_ACCOUNT:"active-account",ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},qc={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},yx={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},Hr={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},Z3={PLAIN:"plain",S256:"S256"},o_={QUERY:"query",FRAGMENT:"fragment"},Bee={...o_,FORM_POST:"form_post"},Rz={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},wx={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},mi={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},vt={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},nP="appmetadata",zee="client_info",U0="1",Xw={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},fo={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},Yr={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},wn={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},F0={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},J3={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},eD={username:"username",password:"password"},Sx={httpSuccess:200,httpBadRequest:400},Xh={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},yC={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},pc={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},Hee={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},Vee=300;/*! @azure/msal-common v14.15.0 2024-09-20 */const rP="unexpected_error",Gee="post_request_failed";/*! @azure/msal-common v14.15.0 2024-09-20 */const tD={[rP]:"Unexpected error in authentication.",[Gee]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class tr extends Error{constructor(e,t,r){const i=t?`${e}: ${t}`:e;super(i),Object.setPrototypeOf(this,tr.prototype),this.errorCode=e||ge.EMPTY_STRING,this.errorMessage=t||ge.EMPTY_STRING,this.subError=r||ge.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function Nz(n,e){return new tr(n,e?`${tD[n]} ${e}`:tD[n])}/*! @azure/msal-common v14.15.0 2024-09-20 */const iP="client_info_decoding_error",Iz="client_info_empty_error",oP="token_parsing_error",Pz="null_or_empty_token",Za="endpoints_resolution_error",kz="network_error",Lz="openid_config_error",Oz="hash_not_deserialized",hm="invalid_state",Dz="state_mismatch",qw="state_not_found",Uz="nonce_mismatch",sP="auth_time_not_found",Fz="max_age_transpired",Wee="multiple_matching_tokens",$ee="multiple_matching_accounts",jz="multiple_matching_appMetadata",Bz="request_cannot_be_made",zz="cannot_remove_empty_scope",Hz="cannot_append_scopeset",NM="empty_input_scopeset",Yee="device_code_polling_cancelled",Kee="device_code_expired",Xee="device_code_unknown_error",aP="no_account_in_silent_request",Vz="invalid_cache_record",lP="invalid_cache_environment",IM="no_account_found",PM="no_crypto_object",kM="unexpected_credential_type",qee="invalid_assertion",Qee="invalid_client_credential",cl="token_refresh_required",Zee="user_timeout_reached",Gz="token_claims_cnf_required_for_signedjwt",Wz="authorization_code_missing_from_server_response",$z="binding_key_not_removed",Yz="end_session_endpoint_not_supported",cP="key_id_missing",Jee="no_network_connectivity",ete="user_canceled",tte="missing_tenant_id_error",Dt="method_not_implemented",nte="nested_app_auth_bridge_disabled";/*! @azure/msal-common v14.15.0 2024-09-20 */const nD={[iP]:"The client info could not be parsed/decoded correctly",[Iz]:"The client info was empty",[oP]:"Token cannot be parsed",[Pz]:"The token is null or empty",[Za]:"Endpoints cannot be resolved",[kz]:"Network request failed",[Lz]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[Oz]:"The hash parameters could not be deserialized",[hm]:"State was not the expected format",[Dz]:"State mismatch error",[qw]:"State not found",[Uz]:"Nonce mismatch error",[sP]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[Fz]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[Wee]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[$ee]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[jz]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[Bz]:"Token request cannot be made without authorization code or refresh token.",[zz]:"Cannot remove null or empty scope from ScopeSet",[Hz]:"Cannot append ScopeSet",[NM]:"Empty input ScopeSet cannot be processed",[Yee]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[Kee]:"Device code is expired.",[Xee]:"Device code stopped polling for unknown reasons.",[aP]:"Please pass an account object, silent flow is not supported without account information",[Vz]:"Cache record object was null or undefined.",[lP]:"Invalid environment when attempting to create cache entry",[IM]:"No account found in cache for given key.",[PM]:"No crypto object detected.",[kM]:"Unexpected credential type.",[qee]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[Qee]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[cl]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[Zee]:"User defined timeout for device code polling reached",[Gz]:"Cannot generate a POP jwt if the token_claims are not populated",[Wz]:"Server response does not contain an authorization code to proceed",[$z]:"Could not remove the credential's binding key from storage.",[Yz]:"The provided authority does not support logout",[cP]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[Jee]:"No network connectivity. Check your internet connection.",[ete]:"User cancelled the flow.",[tte]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[Dt]:"This method has not been implemented",[nte]:"The nested app auth bridge is disabled"};class KE extends tr{constructor(e,t){super(e,t?`${nD[e]}: ${t}`:nD[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,KE.prototype)}}function Ae(n,e){return new KE(n,e)}/*! @azure/msal-common v14.15.0 2024-09-20 */const Qw={createNewGuid:()=>{throw Ae(Dt)},base64Decode:()=>{throw Ae(Dt)},base64Encode:()=>{throw Ae(Dt)},base64UrlEncode:()=>{throw Ae(Dt)},encodeKid:()=>{throw Ae(Dt)},async getPublicKeyThumbprint(){throw Ae(Dt)},async removeTokenBindingKey(){throw Ae(Dt)},async clearKeystore(){throw Ae(Dt)},async signJwt(){throw Ae(Dt)},async hashString(){throw Ae(Dt)}};/*! @azure/msal-common v14.15.0 2024-09-20 */var Bn;(function(n){n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace"})(Bn||(Bn={}));let XE=class LM{constructor(e,t,r){this.level=Bn.Info;const i=()=>{},o=e||LM.createDefaultLoggerOptions();this.localCallback=o.loggerCallback||i,this.piiLoggingEnabled=o.piiLoggingEnabled||!1,this.level=typeof o.logLevel=="number"?o.logLevel:Bn.Info,this.correlationId=o.correlationId||ge.EMPTY_STRING,this.packageName=t||ge.EMPTY_STRING,this.packageVersion=r||ge.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Bn.Info}}clone(e,t,r){return new LM({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const o=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${Bn[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,o,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:Bn.Error,containsPii:!1,correlationId:t||ge.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:Bn.Error,containsPii:!0,correlationId:t||ge.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:Bn.Warning,containsPii:!1,correlationId:t||ge.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:Bn.Warning,containsPii:!0,correlationId:t||ge.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:Bn.Info,containsPii:!1,correlationId:t||ge.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:Bn.Info,containsPii:!0,correlationId:t||ge.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:Bn.Verbose,containsPii:!1,correlationId:t||ge.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:Bn.Verbose,containsPii:!0,correlationId:t||ge.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:Bn.Trace,containsPii:!1,correlationId:t||ge.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:Bn.Trace,containsPii:!0,correlationId:t||ge.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}};/*! @azure/msal-common v14.15.0 2024-09-20 */const Kz="@azure/msal-common",uP="14.15.0";/*! @azure/msal-common v14.15.0 2024-09-20 */const dP={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};/*! @azure/msal-common v14.15.0 2024-09-20 */function mh(n,e){const t=rte(n);try{const r=e(t);return JSON.parse(r)}catch{throw Ae(oP)}}function rte(n){if(!n)throw Ae(Pz);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(n);if(!t||t.length<4)throw Ae(oP);return t[2]}function Xz(n,e){if(e===0||Date.now()-3e5>n+e)throw Ae(Fz)}/*! @azure/msal-common v14.15.0 2024-09-20 */function Ia(){return Math.round(new Date().getTime()/1e3)}function OM(n,e){const t=Number(n)||0;return Ia()+e>t}function ite(n){return Number(n)>Ia()}/*! @azure/msal-common v14.15.0 2024-09-20 */function sp(n){return[ote(n),ste(n),ate(n),lte(n),cte(n)].join(mi.CACHE_KEY_SEPARATOR).toLowerCase()}function qE(n,e,t,r,i){return{credentialType:vt.ID_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t,realm:i}}function QE(n,e,t,r,i,o,s,a,l,c,u,h,f,m,g){var v,p;const _={homeAccountId:n,credentialType:vt.ACCESS_TOKEN,secret:t,cachedAt:Ia().toString(),expiresOn:s.toString(),extendedExpiresOn:a.toString(),environment:e,clientId:r,realm:i,target:o,tokenType:u||wn.BEARER};if(h&&(_.userAssertionHash=h),c&&(_.refreshOn=c.toString()),m&&(_.requestedClaims=m,_.requestedClaimsHash=g),((v=_.tokenType)==null?void 0:v.toLowerCase())!==wn.BEARER.toLowerCase())switch(_.credentialType=vt.ACCESS_TOKEN_WITH_AUTH_SCHEME,_.tokenType){case wn.POP:const x=mh(t,l);if(!((p=x==null?void 0:x.cnf)!=null&&p.kid))throw Ae(Gz);_.keyId=x.cnf.kid;break;case wn.SSH:_.keyId=f}return _}function qz(n,e,t,r,i,o,s){const a={credentialType:vt.REFRESH_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t};return o&&(a.userAssertionHash=o),i&&(a.familyId=i),s&&(a.expiresOn=s.toString()),a}function hP(n){return n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("credentialType")&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("secret")}function rD(n){return n?hP(n)&&n.hasOwnProperty("realm")&&n.hasOwnProperty("target")&&(n.credentialType===vt.ACCESS_TOKEN||n.credentialType===vt.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function iD(n){return n?hP(n)&&n.hasOwnProperty("realm")&&n.credentialType===vt.ID_TOKEN:!1}function oD(n){return n?hP(n)&&n.credentialType===vt.REFRESH_TOKEN:!1}function ote(n){return[n.homeAccountId,n.environment].join(mi.CACHE_KEY_SEPARATOR).toLowerCase()}function ste(n){const e=n.credentialType===vt.REFRESH_TOKEN&&n.familyId||n.clientId;return[n.credentialType,e,n.realm||""].join(mi.CACHE_KEY_SEPARATOR).toLowerCase()}function ate(n){return(n.target||"").toLowerCase()}function lte(n){return(n.requestedClaimsHash||"").toLowerCase()}function cte(n){return n.tokenType&&n.tokenType.toLowerCase()!==wn.BEARER.toLowerCase()?n.tokenType.toLowerCase():""}function ute(n,e){const t=n.indexOf(Yr.CACHE_KEY)===0;let r=!0;return e&&(r=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&r}function dte(n,e){let t=!1;n&&(t=n.indexOf(F0.THROTTLING_PREFIX)===0);let r=!0;return e&&(r=e.hasOwnProperty("throttleTime")),t&&r}function hte({environment:n,clientId:e}){return[nP,n,e].join(mi.CACHE_KEY_SEPARATOR).toLowerCase()}function fte(n,e){return e?n.indexOf(nP)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function pte(n,e){return e?n.indexOf(Xw.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function sD(){return Ia()+Xw.REFRESH_TIME_SECONDS}function Ex(n,e,t){n.authorization_endpoint=e.authorization_endpoint,n.token_endpoint=e.token_endpoint,n.end_session_endpoint=e.end_session_endpoint,n.issuer=e.issuer,n.endpointsFromNetwork=t,n.jwks_uri=e.jwks_uri}function wC(n,e,t){n.aliases=e.aliases,n.preferred_cache=e.preferred_cache,n.preferred_network=e.preferred_network,n.aliasesFromNetwork=t}function aD(n){return n.expiresAt<=Ia()}/*! @azure/msal-common v14.15.0 2024-09-20 */const Qz="redirect_uri_empty",mte="claims_request_parsing_error",Zz="authority_uri_insecure",l0="url_parse_error",Jz="empty_url_error",e6="empty_input_scopes_error",t6="invalid_prompt_value",fP="invalid_claims",n6="token_request_empty",r6="logout_request_empty",i6="invalid_code_challenge_method",pP="pkce_params_missing",mP="invalid_cloud_discovery_metadata",o6="invalid_authority_metadata",s6="untrusted_authority",ZE="missing_ssh_jwk",a6="missing_ssh_kid",gte="missing_nonce_authentication_header",vte="invalid_authentication_header",l6="cannot_set_OIDCOptions",c6="cannot_allow_native_broker",u6="authority_mismatch";/*! @azure/msal-common v14.15.0 2024-09-20 */const _te={[Qz]:"A redirect URI is required for all calls, and none has been set.",[mte]:"Could not parse the given claims request object.",[Zz]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[l0]:"URL could not be parsed into appropriate segments.",[Jz]:"URL was empty or null.",[e6]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[t6]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[fP]:"Given claims parameter must be a stringified JSON object.",[n6]:"Token request was empty and not found in cache.",[r6]:"The logout request was null or undefined.",[i6]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[pP]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[mP]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[o6]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[s6]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[ZE]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[a6]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[gte]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[vte]:"Invalid authentication header provided",[l6]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[c6]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[u6]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class gP extends tr{constructor(e){super(e,_te[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,gP.prototype)}}function bn(n){return new gP(n)}/*! @azure/msal-common v14.15.0 2024-09-20 */class Us{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},r=e.split("&"),i=o=>decodeURIComponent(o.replace(/\+/g," "));return r.forEach(o=>{if(o.trim()){const[s,a]=o.split(/=(.+)/g,2);s&&a&&(t[i(s)]=i(a))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class fr{constructor(e){const t=e?Us.trimArrayEntries([...e]):[],r=t?Us.removeEmptyStringsFromArray(t):[];this.validateInputScopes(r),this.scopes=new Set,r.forEach(i=>this.scopes.add(i))}static fromString(e){const r=(e||ge.EMPTY_STRING).split(" ");return new fr(r)}static createSearchScopes(e){const t=new fr(e);return t.containsOnlyOIDCScopes()?t.removeScope(ge.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw bn(e6)}containsScope(e){const t=this.printScopesLowerCase().split(" "),r=new fr(t);return e?r.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return Q3.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw Ae(Hz)}}removeScope(e){if(!e)throw Ae(zz);this.scopes.delete(e.trim())}removeOIDCScopes(){Q3.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw Ae(NM);const t=new Set;return e.scopes.forEach(r=>t.add(r.toLowerCase())),this.scopes.forEach(r=>t.add(r.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw Ae(NM);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),r=e.getScopeCount(),i=this.getScopeCount();return t.size<i+r}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):ge.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}/*! @azure/msal-common v14.15.0 2024-09-20 */function Zw(n,e){if(!n)throw Ae(Iz);try{const t=e(n);return JSON.parse(t)}catch{throw Ae(iP)}}function ap(n){if(!n)throw Ae(iP);const e=n.split(mi.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?ge.EMPTY_STRING:e[1]}}/*! @azure/msal-common v14.15.0 2024-09-20 */function Jw(n,e){return!!n&&!!e&&n===e.split(".")[1]}function vP(n,e,t,r){if(r){const{oid:i,sub:o,tid:s,name:a,tfp:l,acr:c}=r,u=s||l||c||"";return{tenantId:u,localAccountId:i||o||"",name:a,isHomeTenant:Jw(u,n)}}else return{tenantId:t,localAccountId:e,isHomeTenant:Jw(t,n)}}function _P(n,e,t,r){let i=n;if(e){const{isHomeTenant:o,...s}=e;i={...n,...s}}if(t){const{isHomeTenant:o,...s}=vP(n.homeAccountId,n.localAccountId,n.tenantId,t);return i={...i,...s,idTokenClaims:t,idToken:r},i}return i}/*! @azure/msal-common v14.15.0 2024-09-20 */const Cs={Default:0,Adfs:1,Dsts:2,Ciam:3};/*! @azure/msal-common v14.15.0 2024-09-20 */function d6(n){return n&&(n.tid||n.tfp||n.acr)||null}/*! @azure/msal-common v14.15.0 2024-09-20 */const gl={AAD:"AAD",OIDC:"OIDC"};/*! @azure/msal-common v14.15.0 2024-09-20 */class Pr{generateAccountId(){return[this.homeAccountId,this.environment].join(mi.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return Pr.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){const t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(mi.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,r){var c,u,h,f,m,g;const i=new Pr;t.authorityType===Cs.Adfs?i.authorityType=wx.ADFS_ACCOUNT_TYPE:t.protocolMode===gl.AAD?i.authorityType=wx.MSSTS_ACCOUNT_TYPE:i.authorityType=wx.GENERIC_ACCOUNT_TYPE;let o;e.clientInfo&&r&&(o=Zw(e.clientInfo,r)),i.clientInfo=e.clientInfo,i.homeAccountId=e.homeAccountId,i.nativeAccountId=e.nativeAccountId;const s=e.environment||t&&t.getPreferredCache();if(!s)throw Ae(lP);i.environment=s,i.realm=(o==null?void 0:o.utid)||d6(e.idTokenClaims)||"",i.localAccountId=(o==null?void 0:o.uid)||((c=e.idTokenClaims)==null?void 0:c.oid)||((u=e.idTokenClaims)==null?void 0:u.sub)||"";const a=((h=e.idTokenClaims)==null?void 0:h.preferred_username)||((f=e.idTokenClaims)==null?void 0:f.upn),l=(m=e.idTokenClaims)!=null&&m.emails?e.idTokenClaims.emails[0]:null;if(i.username=a||l||"",i.name=((g=e.idTokenClaims)==null?void 0:g.name)||"",i.cloudGraphHostName=e.cloudGraphHostName,i.msGraphHost=e.msGraphHost,e.tenantProfiles)i.tenantProfiles=e.tenantProfiles;else{const _=vP(e.homeAccountId,i.localAccountId,i.realm,e.idTokenClaims);i.tenantProfiles=[_]}return i}static createFromAccountInfo(e,t,r){var o;const i=new Pr;return i.authorityType=e.authorityType||wx.GENERIC_ACCOUNT_TYPE,i.homeAccountId=e.homeAccountId,i.localAccountId=e.localAccountId,i.nativeAccountId=e.nativeAccountId,i.realm=e.tenantId,i.environment=e.environment,i.username=e.username,i.name=e.name,i.cloudGraphHostName=t,i.msGraphHost=r,i.tenantProfiles=Array.from(((o=e.tenantProfiles)==null?void 0:o.values())||[]),i}static generateHomeAccountId(e,t,r,i,o){if(!(t===Cs.Adfs||t===Cs.Dsts)){if(e)try{const s=Zw(e,i.base64Decode);if(s.uid&&s.utid)return`${s.uid}.${s.utid}`}catch{}r.warning("No client info in response")}return(o==null?void 0:o.sub)||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;let i=!0;if(r){const o=e.idTokenClaims||{},s=t.idTokenClaims||{};i=o.iat===s.iat&&o.nonce===s.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&i}}/*! @azure/msal-common v14.15.0 2024-09-20 */function h6(n){return n.startsWith("#/")?n.substring(2):n.startsWith("#")||n.startsWith("?")?n.substring(1):n}function eS(n){if(!n||n.indexOf("=")<0)return null;try{const e=h6(n),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.error||t.error_description||t.state)return t}catch{throw Ae(Oz)}return null}/*! @azure/msal-common v14.15.0 2024-09-20 */class Qt{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw bn(Jz);e.includes("#")||(this._urlString=Qt.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return Us.endsWith(t,"?")?t=t.slice(0,-1):Us.endsWith(t,"?/")&&(t=t.slice(0,-2)),Us.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw bn(l0)}if(!e.HostNameAndPort||!e.PathSegments)throw bn(l0);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw bn(Zz)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return Qt.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),r=t.PathSegments;return e&&r.length!==0&&(r[0]===qc.COMMON||r[0]===qc.ORGANIZATIONS)&&(r[0]=e),Qt.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw bn(l0);const r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let i=r.AbsolutePath.split("/");return i=i.filter(o=>o&&o.length>0),r.PathSegments=i,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw bn(l0);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===ge.FORWARD_SLASH){const i=new Qt(t).getUrlComponents();return i.Protocol+"//"+i.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new Qt(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!eS(e)}}/*! @azure/msal-common v14.15.0 2024-09-20 */const f6={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},lD=f6.endpointMetadata,xP=f6.instanceDiscoveryMetadata,p6=new Set;xP.metadata.forEach(n=>{n.aliases.forEach(e=>{p6.add(e)})});function xte(n,e){var i;let t;const r=n.canonicalAuthority;if(r){const o=new Qt(r).getUrlComponents().HostNameAndPort;t=cD(o,(i=n.cloudDiscoveryMetadata)==null?void 0:i.metadata,fo.CONFIG,e)||cD(o,xP.metadata,fo.HARDCODED_VALUES,e)||n.knownAuthorities}return t||[]}function cD(n,e,t,r){if(r==null||r.trace(`getAliasesFromMetadata called with source: ${t}`),n&&e){const i=tS(e,n);if(i)return r==null||r.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),i.aliases;r==null||r.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function yte(n){return tS(xP.metadata,n)}function tS(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(r.aliases.includes(e))return r}return null}/*! @azure/msal-common v14.15.0 2024-09-20 */const m6="cache_quota_exceeded",yP="cache_error_unknown";/*! @azure/msal-common v14.15.0 2024-09-20 */const SC={[m6]:"Exceeded cache storage capacity.",[yP]:"Unexpected error occurred when using cache storage."};class Rp extends Error{constructor(e,t){const r=t||(SC[e]?SC[e]:SC[yP]);super(`${e}: ${r}`),Object.setPrototypeOf(this,Rp.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}}/*! @azure/msal-common v14.15.0 2024-09-20 */class fm{constructor(e,t,r,i){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(Kz,uP),this.staticAuthorityOptions=i}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){const t=this.getAllAccounts(e);return t.length>1?t.sort(i=>i.idTokenClaims?-1:1)[0]:t.length===1?t[0]:null}getBaseAccountInfo(e){const t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(r=>this.getTenantProfilesFromAccountEntity(r,t==null?void 0:t.tenantId,t))}getTenantedAccountInfoByFilter(e,t,r,i){let o=null,s;if(i&&!this.tenantProfileMatchesFilter(r,i))return null;const a=this.getIdToken(e,t,r.tenantId);return a&&(s=mh(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(s,i))?null:(o=_P(e,r,s,a==null?void 0:a.secret),o)}getTenantProfilesFromAccountEntity(e,t,r){const i=e.getAccountInfo();let o=i.tenantProfiles||new Map;const s=this.getTokenKeys();if(t){const l=o.get(t);if(l)o=new Map([[t,l]]);else return[]}const a=[];return o.forEach(l=>{const c=this.getTenantedAccountInfoByFilter(i,s,l,r);c&&a.push(c)}),a}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,r){var i,o,s,a;if(!e)throw Ae(Vz);try{e.account&&this.setAccount(e.account),e.idToken&&(t==null?void 0:t.idToken)!==!1&&this.setIdTokenCredential(e.idToken),e.accessToken&&(t==null?void 0:t.accessToken)!==!1&&await this.saveAccessToken(e.accessToken),e.refreshToken&&(t==null?void 0:t.refreshToken)!==!1&&this.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&this.setAppMetadata(e.appMetadata)}catch(l){throw(i=this.commonLogger)==null||i.error("CacheManager.saveCacheRecord: failed"),l instanceof Error?((o=this.commonLogger)==null||o.errorPii(`CacheManager.saveCacheRecord: ${l.message}`,r),l.name==="QuotaExceededError"||l.name==="NS_ERROR_DOM_QUOTA_REACHED"||l.message.includes("exceeded the quota")?((s=this.commonLogger)==null||s.error("CacheManager.saveCacheRecord: exceeded storage quota",r),new Rp(m6)):new Rp(l.name,l.message)):((a=this.commonLogger)==null||a.errorPii(`CacheManager.saveCacheRecord: ${l}`,r),new Rp(yP))}}async saveAccessToken(e){const t={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},r=this.getTokenKeys(),i=fr.fromString(e.target),o=[];r.accessToken.forEach(s=>{if(!this.accessTokenKeyMatchesFilter(s,t,!1))return;const a=this.getAccessTokenCredential(s);a&&this.credentialMatchesFilter(a,t)&&fr.fromString(a.target).intersectingScopeSets(i)&&o.push(this.removeAccessToken(s))}),await Promise.all(o),this.setAccessTokenCredential(e)}getAccountsFilteredBy(e){const t=this.getAccountKeys(),r=[];return t.forEach(i=>{var l;if(!this.isAccountKey(i,e.homeAccountId))return;const o=this.getAccount(i,this.commonLogger);if(!o||e.homeAccountId&&!this.matchHomeAccountId(o,e.homeAccountId)||e.username&&!this.matchUsername(o.username,e.username)||e.environment&&!this.matchEnvironment(o,e.environment)||e.realm&&!this.matchRealm(o,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(o,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(o,e.authorityType))return;const s={localAccountId:e==null?void 0:e.localAccountId,name:e==null?void 0:e.name},a=(l=o.tenantProfiles)==null?void 0:l.filter(c=>this.tenantProfileMatchesFilter(c,s));a&&a.length===0||r.push(o)}),r}isAccountKey(e,t,r){return!(e.split(mi.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||r&&!e.toLowerCase().includes(r.toLowerCase()))}isCredentialKey(e){if(e.split(mi.CACHE_KEY_SEPARATOR).length<6)return!1;const t=e.toLowerCase();if(t.indexOf(vt.ID_TOKEN.toLowerCase())===-1&&t.indexOf(vt.ACCESS_TOKEN.toLowerCase())===-1&&t.indexOf(vt.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&t.indexOf(vt.REFRESH_TOKEN.toLowerCase())===-1)return!1;if(t.indexOf(vt.REFRESH_TOKEN.toLowerCase())>-1){const r=`${vt.REFRESH_TOKEN}${mi.CACHE_KEY_SEPARATOR}${this.clientId}${mi.CACHE_KEY_SEPARATOR}`,i=`${vt.REFRESH_TOKEN}${mi.CACHE_KEY_SEPARATOR}${U0}${mi.CACHE_KEY_SEPARATOR}`;if(t.indexOf(r.toLowerCase())===-1&&t.indexOf(i.toLowerCase())===-1)return!1}else if(t.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===vt.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===wn.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),r={};return t.forEach(i=>{if(!this.isAppMetadata(i))return;const o=this.getAppMetadata(i);o&&(e.environment&&!this.matchEnvironment(o,e.environment)||e.clientId&&!this.matchClientId(o,e.clientId)||(r[i]=o))}),r}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let r=null;return t.forEach(i=>{if(!this.isAuthorityMetadata(i)||i.indexOf(this.clientId)===-1)return;const o=this.getAuthorityMetadata(i);o&&o.aliases.indexOf(e)!==-1&&(r=o)}),r}async removeAllAccounts(){const e=this.getAccountKeys(),t=[];e.forEach(r=>{t.push(this.removeAccount(r))}),await Promise.all(t)}async removeAccount(e){const t=this.getAccount(e,this.commonLogger);t&&(await this.removeAccountContext(t),this.removeItem(e))}async removeAccountContext(e){const t=this.getTokenKeys(),r=e.generateAccountId(),i=[];t.idToken.forEach(o=>{o.indexOf(r)===0&&this.removeIdToken(o)}),t.accessToken.forEach(o=>{o.indexOf(r)===0&&i.push(this.removeAccessToken(o))}),t.refreshToken.forEach(o=>{o.indexOf(r)===0&&this.removeRefreshToken(o)}),await Promise.all(i)}updateOutdatedCachedAccount(e,t,r){var i;if(t&&t.isSingleTenant()){(i=this.commonLogger)==null||i.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");const o=this.getAccountKeys().filter(u=>u.startsWith(t.homeAccountId)),s=[];o.forEach(u=>{const h=this.getCachedAccountEntity(u);h&&s.push(h)});const a=s.find(u=>Jw(u.realm,u.homeAccountId))||s[0];a.tenantProfiles=s.map(u=>({tenantId:u.realm,localAccountId:u.localAccountId,name:u.name,isHomeTenant:Jw(u.realm,u.homeAccountId)}));const l=fm.toObject(new Pr,{...a}),c=l.generateAccountKey();return o.forEach(u=>{u!==c&&this.removeOutdatedAccount(e)}),this.setAccount(l),r==null||r.verbose("Updated an outdated account entity in the cache"),l}return t}async removeAccessToken(e){const t=this.getAccessTokenCredential(e);if(t){if(t.credentialType.toLowerCase()===vt.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&t.tokenType===wn.POP){const i=t.keyId;if(i)try{await this.cryptoImpl.removeTokenBindingKey(i)}catch{throw Ae($z)}}return this.removeItem(e)}}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readAccountFromCache(e){const t=Pr.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,r,i,o){this.commonLogger.trace("CacheManager - getIdToken called");const s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:vt.ID_TOKEN,clientId:this.clientId,realm:r},a=this.getIdTokensByFilter(s,t),l=a.size;if(l<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(l>1){let c=a;if(!r){const u=new Map;a.forEach((f,m)=>{f.realm===e.tenantId&&u.set(m,f)});const h=u.size;if(h<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),a.values().next().value;if(h===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),u.values().next().value;c=u}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),c.forEach((u,h)=>{this.removeIdToken(h)}),i&&o&&i.addFields({multiMatchedID:a.size},o),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),a.values().next().value}getIdTokensByFilter(e,t){const r=t&&t.idToken||this.getTokenKeys().idToken,i=new Map;return r.forEach(o=>{if(!this.idTokenKeyMatchesFilter(o,{clientId:this.clientId,...e}))return;const s=this.getIdTokenCredential(o);s&&this.credentialMatchesFilter(s,e)&&i.set(o,s)}),i}idTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,r,i,o,s){this.commonLogger.trace("CacheManager - getAccessToken called");const a=fr.createSearchScopes(t.scopes),l=t.authenticationScheme||wn.BEARER,c=l&&l.toLowerCase()!==wn.BEARER.toLowerCase()?vt.ACCESS_TOKEN_WITH_AUTH_SCHEME:vt.ACCESS_TOKEN,u={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:c,clientId:this.clientId,realm:i||e.tenantId,target:a,tokenType:l,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=r&&r.accessToken||this.getTokenKeys().accessToken,f=[];h.forEach(g=>{if(this.accessTokenKeyMatchesFilter(g,u,!0)){const _=this.getAccessTokenCredential(g);_&&this.credentialMatchesFilter(_,u)&&f.push(_)}});const m=f.length;return m<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):m>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),f.forEach(g=>{this.removeAccessToken(sp(g))}),o&&s&&o.addFields({multiMatchedAT:f.length},s),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),f[0])}accessTokenKeyMatchesFilter(e,t,r){const i=e.toLowerCase();if(t.clientId&&i.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&i.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&i.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&i.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const o=t.target.asArray();for(let s=0;s<o.length;s++){if(r&&!i.includes(o[s].toLowerCase()))return!1;if(!r&&i.includes(o[s].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e){const t=this.getTokenKeys(),r=[];return t.accessToken.forEach(i=>{if(!this.accessTokenKeyMatchesFilter(i,e,!0))return;const o=this.getAccessTokenCredential(i);o&&this.credentialMatchesFilter(o,e)&&r.push(o)}),r}getRefreshToken(e,t,r,i,o){this.commonLogger.trace("CacheManager - getRefreshToken called");const s=t?U0:void 0,a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:vt.REFRESH_TOKEN,clientId:this.clientId,familyId:s},l=r&&r.refreshToken||this.getTokenKeys().refreshToken,c=[];l.forEach(h=>{if(this.refreshTokenKeyMatchesFilter(h,a)){const f=this.getRefreshTokenCredential(h);f&&this.credentialMatchesFilter(f,a)&&c.push(f)}});const u=c.length;return u<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(u>1&&i&&o&&i.addFields({multiMatchedRT:u},o),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),c[0])}refreshTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.familyId&&r.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(t),i=Object.keys(r).map(s=>r[s]),o=i.length;if(o<1)return null;if(o>1)throw Ae(jz);return i[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===U0)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const r=e.oid||e.sub;return t===r}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var r;return t.toLowerCase()===((r=e.name)==null?void 0:r.toLowerCase())}matchUsername(e,t){return!!(e&&typeof e=="string"&&(t==null?void 0:t.toLowerCase())===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const i=xte(this.staticAuthorityOptions,this.commonLogger);if(i.includes(t)&&i.includes(e.environment))return!0}const r=this.getAuthorityMetadataByAlias(t);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){var r;return((r=e.realm)==null?void 0:r.toLowerCase())===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==vt.ACCESS_TOKEN&&e.credentialType!==vt.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:fr.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(nP)!==-1}isAuthorityMetadata(e){return e.indexOf(Xw.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${Xw.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const r in t)e[r]=t[r];return e}}class wte extends fm{setAccount(){throw Ae(Dt)}getAccount(){throw Ae(Dt)}getCachedAccountEntity(){throw Ae(Dt)}setIdTokenCredential(){throw Ae(Dt)}getIdTokenCredential(){throw Ae(Dt)}setAccessTokenCredential(){throw Ae(Dt)}getAccessTokenCredential(){throw Ae(Dt)}setRefreshTokenCredential(){throw Ae(Dt)}getRefreshTokenCredential(){throw Ae(Dt)}setAppMetadata(){throw Ae(Dt)}getAppMetadata(){throw Ae(Dt)}setServerTelemetry(){throw Ae(Dt)}getServerTelemetry(){throw Ae(Dt)}setAuthorityMetadata(){throw Ae(Dt)}getAuthorityMetadata(){throw Ae(Dt)}getAuthorityMetadataKeys(){throw Ae(Dt)}setThrottlingCache(){throw Ae(Dt)}getThrottlingCache(){throw Ae(Dt)}removeItem(){throw Ae(Dt)}getKeys(){throw Ae(Dt)}getAccountKeys(){throw Ae(Dt)}getTokenKeys(){throw Ae(Dt)}async clear(){throw Ae(Dt)}updateCredentialCacheKey(){throw Ae(Dt)}removeOutdatedAccount(){throw Ae(Dt)}}/*! @azure/msal-common v14.15.0 2024-09-20 */const g6={tokenRenewalOffsetSeconds:Vee,preventCorsPreflight:!1},Ste={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Bn.Info,correlationId:ge.EMPTY_STRING},Ete={claimsBasedCachingEnabled:!1},Tte={async sendGetRequestAsync(){throw Ae(Dt)},async sendPostRequestAsync(){throw Ae(Dt)}},Cte={sku:ge.SKU,version:uP,cpu:ge.EMPTY_STRING,os:ge.EMPTY_STRING},bte={clientSecret:ge.EMPTY_STRING,clientAssertion:void 0},Ate={azureCloudInstance:dP.None,tenant:`${ge.DEFAULT_COMMON_TENANT}`},Mte={application:{appName:"",appVersion:""}};function Rte({authOptions:n,systemOptions:e,loggerOptions:t,cacheOptions:r,storageInterface:i,networkInterface:o,cryptoInterface:s,clientCredentials:a,libraryInfo:l,telemetry:c,serverTelemetryManager:u,persistencePlugin:h,serializableCache:f}){const m={...Ste,...t};return{authOptions:Nte(n),systemOptions:{...g6,...e},loggerOptions:m,cacheOptions:{...Ete,...r},storageInterface:i||new wte(n.clientId,Qw,new XE(m)),networkInterface:o||Tte,cryptoInterface:s||Qw,clientCredentials:a||bte,libraryInfo:{...Cte,...l},telemetry:{...Mte,...c},serverTelemetryManager:u||null,persistencePlugin:h||null,serializableCache:f||null}}function Nte(n){return{clientCapabilities:[],azureCloudOptions:Ate,skipAuthorityMetadataCache:!1,instanceAware:!1,...n}}function DM(n){return n.authOptions.authority.options.protocolMode===gl.OIDC}/*! @azure/msal-common v14.15.0 2024-09-20 */class au extends tr{constructor(e,t,r,i,o){super(e,t,r),this.name="ServerError",this.errorNo=i,this.status=o,Object.setPrototypeOf(this,au.prototype)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class ga{static generateThrottlingStorageKey(e){return`${F0.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){var o;const r=ga.generateThrottlingStorageKey(t),i=e.getThrottlingCache(r);if(i){if(i.throttleTime<Date.now()){e.removeItem(r);return}throw new au(((o=i.errorCodes)==null?void 0:o.join(" "))||ge.EMPTY_STRING,i.errorMessage,i.subError)}}static postProcess(e,t,r){if(ga.checkResponseStatus(r)||ga.checkResponseForRetryAfter(r)){const i={throttleTime:ga.calculateThrottleTime(parseInt(r.headers[_a.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(ga.generateThrottlingStorageKey(t),i)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(_a.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(Math.min(r+(t||F0.DEFAULT_THROTTLE_TIME_SECONDS),r+F0.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,r,i){const o={clientId:t,authority:r.authority,scopes:r.scopes,homeAccountIdentifier:i,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid},s=this.generateThrottlingStorageKey(o);e.removeItem(s)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class Ite{constructor(e,t){this.networkClient=e,this.cacheManager=t}async sendPostRequest(e,t,r){ga.preProcess(this.cacheManager,e);let i;try{i=await this.networkClient.sendPostRequestAsync(t,r)}catch(o){throw o instanceof tr?o:Ae(kz)}return ga.postProcess(this.cacheManager,e,i),i}}/*! @azure/msal-common v14.15.0 2024-09-20 */const Co={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};/*! @azure/msal-common v14.15.0 2024-09-20 */const pm="client_id",Pte="redirect_uri",uD="response_type",kte="response_mode",Lte="grant_type",Ote="claims",Dte="scope",Ute="refresh_token",Fte="state",jte="nonce",Bte="prompt",zte="code",Hte="code_challenge",Vte="code_challenge_method",Gte="code_verifier",Wte="client-request-id",$te="x-client-SKU",Yte="x-client-VER",Kte="x-client-OS",Xte="x-client-CPU",qte="x-client-current-telemetry",Qte="x-client-last-telemetry",Zte="x-ms-lib-capability",Jte="x-app-name",ene="x-app-ver",tne="post_logout_redirect_uri",nne="id_token_hint",rne="device_code",ine="client_secret",one="client_assertion",sne="client_assertion_type",dD="token_type",hD="req_cnf",ane="assertion",lne="requested_token_use",fD="return_spa_code",cne="nativebroker",une="logout_hint",dne="sid",hne="login_hint",fne="domain_hint",pne="x-client-xtra-sku";/*! @azure/msal-common v14.15.0 2024-09-20 */class If{static validateRedirectUri(e){if(!e)throw bn(Qz)}static validatePrompt(e){const t=[];for(const r in Hr)t.push(Hr[r]);if(t.indexOf(e)<0)throw bn(t6)}static validateClaims(e){try{JSON.parse(e)}catch{throw bn(fP)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw bn(pP);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([Z3.PLAIN,Z3.S256].indexOf(e)<0)throw bn(i6)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class j0{constructor(){this.parameters=new Map}addResponseTypeCode(){this.parameters.set(uD,encodeURIComponent(ge.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(uD,encodeURIComponent(`${ge.TOKEN_RESPONSE_TYPE} ${ge.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set(kte,encodeURIComponent(e||Bee.QUERY))}addNativeBroker(){this.parameters.set(cne,encodeURIComponent("1"))}addScopes(e,t=!0,r=Bm){t&&!r.includes("openid")&&!e.includes("openid")&&r.push("openid");const i=t?[...e||[],...r]:e||[],o=new fr(i);this.parameters.set(Dte,encodeURIComponent(o.printScopes()))}addClientId(e){this.parameters.set(pm,encodeURIComponent(e))}addRedirectUri(e){If.validateRedirectUri(e),this.parameters.set(Pte,encodeURIComponent(e))}addPostLogoutRedirectUri(e){If.validateRedirectUri(e),this.parameters.set(tne,encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set(nne,encodeURIComponent(e))}addDomainHint(e){this.parameters.set(fne,encodeURIComponent(e))}addLoginHint(e){this.parameters.set(hne,encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(_a.CCS_HEADER,encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set(_a.CCS_HEADER,encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set(dne,encodeURIComponent(e))}addClaims(e,t){const r=this.addClientCapabilitiesToClaims(e,t);If.validateClaims(r),this.parameters.set(Ote,encodeURIComponent(r))}addCorrelationId(e){this.parameters.set(Wte,encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set($te,e.sku),this.parameters.set(Yte,e.version),e.os&&this.parameters.set(Kte,e.os),e.cpu&&this.parameters.set(Xte,e.cpu)}addApplicationTelemetry(e){e!=null&&e.appName&&this.parameters.set(Jte,e.appName),e!=null&&e.appVersion&&this.parameters.set(ene,e.appVersion)}addPrompt(e){If.validatePrompt(e),this.parameters.set(`${Bte}`,encodeURIComponent(e))}addState(e){e&&this.parameters.set(Fte,encodeURIComponent(e))}addNonce(e){this.parameters.set(jte,encodeURIComponent(e))}addCodeChallengeParams(e,t){if(If.validateCodeChallengeParams(e,t),e&&t)this.parameters.set(Hte,encodeURIComponent(e)),this.parameters.set(Vte,encodeURIComponent(t));else throw bn(pP)}addAuthorizationCode(e){this.parameters.set(zte,encodeURIComponent(e))}addDeviceCode(e){this.parameters.set(rne,encodeURIComponent(e))}addRefreshToken(e){this.parameters.set(Ute,encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set(Gte,encodeURIComponent(e))}addClientSecret(e){this.parameters.set(ine,encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set(one,encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set(sne,encodeURIComponent(e))}addOboAssertion(e){this.parameters.set(ane,encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set(lne,encodeURIComponent(e))}addGrantType(e){this.parameters.set(Lte,encodeURIComponent(e))}addClientInfo(){this.parameters.set(zee,"1")}addExtraQueryParameters(e){Object.entries(e).forEach(([t,r])=>{!this.parameters.has(t)&&r&&this.parameters.set(t,r)})}addClientCapabilitiesToClaims(e,t){let r;if(!e)r={};else try{r=JSON.parse(e)}catch{throw bn(fP)}return t&&t.length>0&&(r.hasOwnProperty(yx.ACCESS_TOKEN)||(r[yx.ACCESS_TOKEN]={}),r[yx.ACCESS_TOKEN][yx.XMS_CC]={values:t}),JSON.stringify(r)}addUsername(e){this.parameters.set(eD.username,encodeURIComponent(e))}addPassword(e){this.parameters.set(eD.password,encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(dD,wn.POP),this.parameters.set(hD,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(dD,wn.SSH),this.parameters.set(hD,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set(qte,e.generateCurrentRequestHeaderValue()),this.parameters.set(Qte,e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set(Zte,F0.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(e){this.parameters.set(une,encodeURIComponent(e))}createQueryString(){const e=new Array;return this.parameters.forEach((t,r)=>{e.push(`${r}=${t}`)}),e.join("&")}}/*! @azure/msal-common v14.15.0 2024-09-20 */function mne(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}/*! @azure/msal-common v14.15.0 2024-09-20 */function gne(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}/*! @azure/msal-common v14.15.0 2024-09-20 */function vne(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}/*! @azure/msal-common v14.15.0 2024-09-20 */const le={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues"},_ne={NotStarted:0,InProgress:1,Completed:2};/*! @azure/msal-common v14.15.0 2024-09-20 */const gh=(n,e,t,r,i)=>(...o)=>{t.trace(`Executing function ${e}`);const s=r==null?void 0:r.startMeasurement(e,i);if(i){const a=e+"CallCount";r==null||r.incrementFields({[a]:1},i)}try{const a=n(...o);return s==null||s.end({success:!0}),t.trace(`Returning result from ${e}`),a}catch(a){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s==null||s.end({success:!1},a),a}},Ue=(n,e,t,r,i)=>(...o)=>{t.trace(`Executing function ${e}`);const s=r==null?void 0:r.startMeasurement(e,i);if(i){const a=e+"CallCount";r==null||r.incrementFields({[a]:1},i)}return r==null||r.setPreQueueTime(e,i),n(...o).then(a=>(t.trace(`Returning result from ${e}`),s==null||s.end({success:!0}),a)).catch(a=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s==null||s.end({success:!1},a),a})};/*! @azure/msal-common v14.15.0 2024-09-20 */class JE{constructor(e,t,r,i){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=i}async detectRegion(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(le.RegionDiscoveryDetectRegion,this.correlationId);let r=e;if(r)t.region_source=Xh.ENVIRONMENT_VARIABLE;else{const o=JE.IMDS_OPTIONS;try{const s=await Ue(this.getRegionFromIMDS.bind(this),le.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(ge.IMDS_VERSION,o);if(s.status===Sx.httpSuccess&&(r=s.body,t.region_source=Xh.IMDS),s.status===Sx.httpBadRequest){const a=await Ue(this.getCurrentVersion.bind(this),le.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(o);if(!a)return t.region_source=Xh.FAILED_AUTO_DETECTION,null;const l=await Ue(this.getRegionFromIMDS.bind(this),le.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(a,o);l.status===Sx.httpSuccess&&(r=l.body,t.region_source=Xh.IMDS)}}catch{return t.region_source=Xh.FAILED_AUTO_DETECTION,null}}return r||(t.region_source=Xh.FAILED_AUTO_DETECTION),r||null}async getRegionFromIMDS(e,t){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(le.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${ge.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,ge.IMDS_TIMEOUT)}async getCurrentVersion(e){var t;(t=this.performanceClient)==null||t.addQueueMeasurement(le.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const r=await this.networkInterface.sendGetRequestAsync(`${ge.IMDS_ENDPOINT}?format=json`,e);return r.status===Sx.httpBadRequest&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}}}JE.IMDS_OPTIONS={headers:{Metadata:"true"}};/*! @azure/msal-common v14.15.0 2024-09-20 */class hi{constructor(e,t,r,i,o,s,a,l){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=i,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=a,this.correlationId=s,this.managedIdentity=l||!1,this.regionDiscovery=new JE(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(ge.CIAM_AUTH_URL))return Cs.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case ge.ADFS:return Cs.Adfs;case ge.DSTS:return Cs.Dsts}return Cs.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new Qt(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw Ae(Za)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw Ae(Za)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw Ae(Za)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw Ae(Yz);return this.replacePath(this.metadata.end_session_endpoint)}else throw Ae(Za)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw Ae(Za)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw Ae(Za)}canReplaceTenant(e){return e.PathSegments.length===1&&!hi.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===Cs.Default&&this.protocolMode===gl.AAD}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const i=new Qt(this.metadata.canonical_authority).getUrlComponents(),o=i.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((a,l)=>{let c=o[l];if(l===0&&this.canReplaceTenant(i)){const u=new Qt(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];c!==u&&(this.logger.verbose(`Replacing tenant domain name ${c} with id ${u}`),c=u)}a!==c&&(t=t.replace(`/${c}/`,`/${a}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===Cs.Adfs||this.protocolMode!==gl.AAD&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){var i,o;(i=this.performanceClient)==null||i.addQueueMeasurement(le.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await Ue(this.updateCloudDiscoveryMetadata.bind(this),le.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const r=await Ue(this.updateEndpointMetadata.bind(this),le.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),(o=this.performanceClient)==null||o.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:sD(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==fo.CACHE&&(r==null?void 0:r.source)!==fo.CACHE&&(e.expiresAt=sD(),e.canonical_authority=this.canonicalAuthority);const i=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(i,e),this.metadata=e}async updateEndpointMetadata(e){var i,o,s;(i=this.performanceClient)==null||i.addQueueMeasurement(le.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===fo.HARDCODED_VALUES&&(o=this.authorityOptions.azureRegionConfiguration)!=null&&o.azureRegion&&t.metadata){const a=await Ue(this.updateMetadataWithRegionalInformation.bind(this),le.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);Ex(e,a,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let r=await Ue(this.getEndpointMetadataFromNetwork.bind(this),le.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return(s=this.authorityOptions.azureRegionConfiguration)!=null&&s.azureRegion&&(r=await Ue(this.updateMetadataWithRegionalInformation.bind(this),le.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(r)),Ex(e,r,!0),fo.NETWORK;throw Ae(Lz,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),Ex(e,t,!1),{source:fo.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const i=this.getEndpointMetadataFromHardcodedValues();if(i)return Ex(e,i,!1),{source:fo.HARDCODED_VALUES,metadata:i};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const r=aD(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!r?(this.logger.verbose("Found endpoint metadata in the cache."),{source:fo.CACHE}):(r&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new Qt(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw bn(o6)}return null}async getEndpointMetadataFromNetwork(){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(le.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const i=await this.networkInterface.sendGetRequestAsync(t,e);return mne(i.body)?i.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(i){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${i}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in lD?lD[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){var r,i,o;(r=this.performanceClient)==null||r.addQueueMeasurement(le.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=(i=this.authorityOptions.azureRegionConfiguration)==null?void 0:i.azureRegion;if(t){if(t!==ge.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=yC.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,hi.replaceWithRegionalInformation(e,t);const s=await Ue(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),le.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)((o=this.authorityOptions.azureRegionConfiguration)==null?void 0:o.environmentRegion,this.regionDiscoveryMetadata);if(s)return this.regionDiscoveryMetadata.region_outcome=yC.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=s,hi.replaceWithRegionalInformation(e,s);this.regionDiscoveryMetadata.region_outcome=yC.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(le.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const r=await Ue(this.getCloudDiscoveryMetadataFromNetwork.bind(this),le.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return wC(e,r,!0),fo.NETWORK;throw bn(s6)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||ge.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||ge.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||ge.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),wC(e,t,!1),fo.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const i=yte(this.hostnameAndPort);if(i)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),wC(e,i,!1),fo.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const r=aD(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!r?(this.logger.verbose("Found cloud discovery metadata in the cache."),fo.CACHE):(r&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===Cs.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),hi.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=tS(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),bn(mP)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),hi.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(le.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${ge.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let r=null;try{const o=await this.networkInterface.sendGetRequestAsync(e,t);let s,a;if(gne(o.body))s=o.body,a=s.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${s.tenant_discovery_endpoint}`);else if(vne(o.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${o.status}`),s=o.body,s.error===ge.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${s.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${s.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),a=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=tS(a,this.hostnameAndPort)}catch(o){if(o instanceof tr)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${o.errorCode}
Error Description: ${o.errorMessage}`);else{const s=o;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${s.name}
Error Description: ${s.message}`)}return null}return r||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),r=hi.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&Qt.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==dP.None){const i=t.tenant?t.tenant:ge.DEFAULT_COMMON_TENANT;r=`${t.azureCloudInstance}/${i}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return ge.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw Ae(Za)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return p6.has(e)}static isPublicCloudAuthority(e){return ge.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){const i=new Qt(e);i.validateAsUri();const o=i.getUrlComponents();let s=`${t}.${o.HostNameAndPort}`;this.isPublicCloudAuthority(o.HostNameAndPort)&&(s=`${t}.${ge.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const a=Qt.constructAuthorityUriFromObject({...i.getUrlComponents(),HostNameAndPort:s}).urlString;return r?`${a}?${r}`:a}static replaceWithRegionalInformation(e,t){const r={...e};return r.authorization_endpoint=hi.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=hi.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=hi.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e;const i=new Qt(e).getUrlComponents();if(i.PathSegments.length===0&&i.HostNameAndPort.endsWith(ge.CIAM_AUTH_URL)){const o=i.HostNameAndPort.split(".")[0];t=`${t}${o}${ge.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}hi.reservedTenantDomains=new Set(["{tenant}","{tenantid}",qc.COMMON,qc.CONSUMERS,qc.ORGANIZATIONS]);function xne(n){var i;const r=(i=new Qt(n).getUrlComponents().PathSegments.slice(-1)[0])==null?void 0:i.toLowerCase();switch(r){case qc.COMMON:case qc.ORGANIZATIONS:case qc.CONSUMERS:return;default:return r}}function v6(n){return n.endsWith(ge.FORWARD_SLASH)?n:`${n}${ge.FORWARD_SLASH}`}function yne(n){const e=n.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw bn(mP)}return{canonicalAuthority:n.authority?v6(n.authority):void 0,knownAuthorities:n.knownAuthorities,cloudDiscoveryMetadata:t}}/*! @azure/msal-common v14.15.0 2024-09-20 */async function _6(n,e,t,r,i,o,s){s==null||s.addQueueMeasurement(le.AuthorityFactoryCreateDiscoveredInstance,o);const a=hi.transformCIAMAuthority(v6(n)),l=new hi(a,e,t,r,i,o,s);try{return await Ue(l.resolveEndpointsAsync.bind(l),le.AuthorityResolveEndpointsAsync,i,s,o)(),l}catch{throw Ae(Za)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class wP{constructor(e,t){this.config=Rte(e),this.logger=new XE(this.config.loggerOptions,Kz,uP),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new Ite(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[_a.CONTENT_TYPE]=ge.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Co.HOME_ACCOUNT_ID:try{const r=ap(e.credential);t[_a.CCS_HEADER]=`Oid:${r.uid}@${r.utid}`}catch(r){this.logger.verbose("Could not parse home account ID for CCS Header: "+r)}break;case Co.UPN:t[_a.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,r,i,o,s){var l,c,u,h;s&&((l=this.performanceClient)==null||l.addQueueMeasurement(s,o));const a=await this.networkManager.sendPostRequest(i,e,{body:t,headers:r});return(h=this.performanceClient)==null||h.addFields({refreshTokenSize:((c=a.body.refresh_token)==null?void 0:c.length)||0,httpVerToken:((u=a.headers)==null?void 0:u[_a.X_MS_HTTP_VERSION])||""},o),this.config.serverTelemetryManager&&a.status<500&&a.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),a}async updateAuthority(e,t){var o;(o=this.performanceClient)==null||o.addQueueMeasurement(le.UpdateTokenEndpointAuthority,t);const r=`https://${e}/${this.authority.tenant}/`,i=await _6(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=i}createTokenQueryParameters(e){const t=new j0;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()}}/*! @azure/msal-common v14.15.0 2024-09-20 */const nS="no_tokens_found",x6="native_account_unavailable",SP="refresh_token_expired",wne="interaction_required",Sne="consent_required",Ene="login_required",e1="bad_token";/*! @azure/msal-common v14.15.0 2024-09-20 */const pD=[wne,Sne,Ene,e1],Tne=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],Cne={[nS]:"No refresh token found in the cache. Please sign-in.",[x6]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[SP]:"Refresh token has expired.",[e1]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class Hs extends tr{constructor(e,t,r,i,o,s,a,l){super(e,t,r),Object.setPrototypeOf(this,Hs.prototype),this.timestamp=i||ge.EMPTY_STRING,this.traceId=o||ge.EMPTY_STRING,this.correlationId=s||ge.EMPTY_STRING,this.claims=a||ge.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=l}}function mD(n,e,t){const r=!!n&&pD.indexOf(n)>-1,i=!!t&&Tne.indexOf(t)>-1,o=!!e&&pD.some(s=>e.indexOf(s)>-1);return r||o||i}function UM(n){return new Hs(n,Cne[n])}/*! @azure/msal-common v14.15.0 2024-09-20 */class Fs{static setRequestState(e,t,r){const i=Fs.generateLibraryState(e,r);return t?`${i}${ge.RESOURCE_DELIM}${t}`:i}static generateLibraryState(e,t){if(!e)throw Ae(PM);const r={id:e.createNewGuid()};t&&(r.meta=t);const i=JSON.stringify(r);return e.base64Encode(i)}static parseRequestState(e,t){if(!e)throw Ae(PM);if(!t)throw Ae(hm);try{const r=t.split(ge.RESOURCE_DELIM),i=r[0],o=r.length>1?r.slice(1).join(ge.RESOURCE_DELIM):ge.EMPTY_STRING,s=e.base64Decode(i),a=JSON.parse(s);return{userRequestState:o||ge.EMPTY_STRING,libraryState:a}}catch{throw Ae(hm)}}}/*! @azure/msal-common v14.15.0 2024-09-20 */const bne={SW:"sw",UHW:"uhw"};class mm{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){var o;(o=this.performanceClient)==null||o.addQueueMeasurement(le.PopTokenGenerateCnf,e.correlationId);const r=await Ue(this.generateKid.bind(this),le.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),i=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:i}}async generateKid(e){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(le.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:bne.SW}}async signPopToken(e,t,r){return this.signPayload(e,t,r)}async signPayload(e,t,r,i){const{resourceRequestMethod:o,resourceRequestUri:s,shrClaims:a,shrNonce:l,shrOptions:c}=r,u=s?new Qt(s):void 0,h=u==null?void 0:u.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:Ia(),m:o==null?void 0:o.toUpperCase(),u:h==null?void 0:h.HostNameAndPort,nonce:l||this.cryptoUtils.createNewGuid(),p:h==null?void 0:h.AbsolutePath,q:h!=null&&h.QueryString?[[],h.QueryString]:void 0,client_claims:a||void 0,...i},t,c,r.correlationId)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class Ane{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}/*! @azure/msal-common v14.15.0 2024-09-20 */function Mne(n){var r,i;const e="code=",t=(r=n.error_uri)==null?void 0:r.lastIndexOf(e);return t&&t>=0?(i=n.error_uri)==null?void 0:i.substring(t+e.length):void 0}class Jd{constructor(e,t,r,i,o,s,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=i,this.serializableCache=o,this.persistencePlugin=s,this.performanceClient=a}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw e.state?Ae(qw,"Cached State"):Ae(qw,"Server State");let r,i;try{r=decodeURIComponent(e.state)}catch{throw Ae(hm,e.state)}try{i=decodeURIComponent(t)}catch{throw Ae(hm,e.state)}if(r!==i)throw Ae(Dz);if(e.error||e.error_description||e.suberror){const o=Mne(e);throw mD(e.error,e.error_description,e.suberror)?new Hs(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",o):new au(e.error||"",e.error_description,e.suberror,o)}}validateTokenResponse(e,t){var r;if(e.error||e.error_description||e.suberror){const i=`Error(s): ${e.error_codes||ge.NOT_AVAILABLE} - Timestamp: ${e.timestamp||ge.NOT_AVAILABLE} - Description: ${e.error_description||ge.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||ge.NOT_AVAILABLE} - Trace ID: ${e.trace_id||ge.NOT_AVAILABLE}`,o=(r=e.error_codes)!=null&&r.length?e.error_codes[0]:void 0,s=new au(e.error,i,e.suberror,o,e.status);if(t&&e.status&&e.status>=xx.SERVER_ERROR_RANGE_START&&e.status<=xx.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${s}`);return}else if(t&&e.status&&e.status>=xx.CLIENT_ERROR_RANGE_START&&e.status<=xx.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${s}`);return}throw mD(e.error,e.error_description,e.suberror)?new Hs(e.error,e.error_description,e.suberror,e.timestamp||ge.EMPTY_STRING,e.trace_id||ge.EMPTY_STRING,e.correlation_id||ge.EMPTY_STRING,e.claims||ge.EMPTY_STRING,o):s}}async handleServerTokenResponse(e,t,r,i,o,s,a,l,c){var g;(g=this.performanceClient)==null||g.addQueueMeasurement(le.HandleServerTokenResponse,e.correlation_id);let u;if(e.id_token){if(u=mh(e.id_token||ge.EMPTY_STRING,this.cryptoObj.base64Decode),o&&o.nonce&&u.nonce!==o.nonce)throw Ae(Uz);if(i.maxAge||i.maxAge===0){const _=u.auth_time;if(!_)throw Ae(sP);Xz(_,i.maxAge)}}this.homeAccountIdentifier=Pr.generateHomeAccountId(e.client_info||ge.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,u);let h;o&&o.state&&(h=Fs.parseRequestState(this.cryptoObj,o.state)),e.key_id=e.key_id||i.sshKid||void 0;const f=this.generateCacheRecord(e,t,r,i,u,s,o);let m;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),m=new Ane(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(m)),a&&!l&&f.account){const _=f.account.generateAccountKey();if(!this.cacheStorage.getAccount(_,this.logger))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await Jd.generateAuthenticationResult(this.cryptoObj,t,f,!1,i,u,h,void 0,c)}await this.cacheStorage.saveCacheRecord(f,i.storeInCache,i.correlationId)}finally{this.persistencePlugin&&this.serializableCache&&m&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(m))}return Jd.generateAuthenticationResult(this.cryptoObj,t,f,!1,i,u,h,e,c)}generateCacheRecord(e,t,r,i,o,s,a){const l=t.getPreferredCache();if(!l)throw Ae(lP);const c=d6(o);let u,h;e.id_token&&o&&(u=qE(this.homeAccountIdentifier,l,e.id_token,this.clientId,c||""),h=EP(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,o,e.client_info,l,c,a,void 0,this.logger));let f=null;if(e.access_token){const _=e.scope?fr.fromString(e.scope):new fr(i.scopes||[]),v=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,p=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,x=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,y=r+v,w=y+p,C=x&&x>0?r+x:void 0;f=QE(this.homeAccountIdentifier,l,e.access_token,this.clientId,c||t.tenant||"",_.printScopes(),y,w,this.cryptoObj.base64Decode,C,e.token_type,s,e.key_id,i.claims,i.requestedClaimsHash)}let m=null;if(e.refresh_token){let _;if(e.refresh_token_expires_in){const v=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;_=r+v}m=qz(this.homeAccountIdentifier,l,e.refresh_token,this.clientId,e.foci,s,_)}let g=null;return e.foci&&(g={clientId:this.clientId,environment:l,familyId:e.foci}),{account:h,idToken:u,accessToken:f,refreshToken:m,appMetadata:g}}static async generateAuthenticationResult(e,t,r,i,o,s,a,l,c){var y,w,C,T,S;let u=ge.EMPTY_STRING,h=[],f=null,m,g,_=ge.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType===wn.POP&&!o.popKid){const b=new mm(e),{secret:R,keyId:E}=r.accessToken;if(!E)throw Ae(cP);u=await b.signPopToken(R,E,o)}else u=r.accessToken.secret;h=fr.fromString(r.accessToken.target).asArray(),f=new Date(Number(r.accessToken.expiresOn)*1e3),m=new Date(Number(r.accessToken.extendedExpiresOn)*1e3),r.accessToken.refreshOn&&(g=new Date(Number(r.accessToken.refreshOn)*1e3))}r.appMetadata&&(_=r.appMetadata.familyId===U0?U0:"");const v=(s==null?void 0:s.oid)||(s==null?void 0:s.sub)||"",p=(s==null?void 0:s.tid)||"";l!=null&&l.spa_accountid&&r.account&&(r.account.nativeAccountId=l==null?void 0:l.spa_accountid);const x=r.account?_P(r.account.getAccountInfo(),void 0,s,(y=r.idToken)==null?void 0:y.secret):null;return{authority:t.canonicalAuthority,uniqueId:v,tenantId:p,scopes:h,account:x,idToken:((w=r==null?void 0:r.idToken)==null?void 0:w.secret)||"",idTokenClaims:s||{},accessToken:u,fromCache:i,expiresOn:f,extExpiresOn:m,refreshOn:g,correlationId:o.correlationId,requestId:c||ge.EMPTY_STRING,familyId:_,tokenType:((C=r.accessToken)==null?void 0:C.tokenType)||ge.EMPTY_STRING,state:a?a.userRequestState:ge.EMPTY_STRING,cloudGraphHostName:((T=r.account)==null?void 0:T.cloudGraphHostName)||ge.EMPTY_STRING,msGraphHost:((S=r.account)==null?void 0:S.msGraphHost)||ge.EMPTY_STRING,code:l==null?void 0:l.spa_code,fromNativeBroker:!1}}}function EP(n,e,t,r,i,o,s,a,l,c,u){u==null||u.verbose("setCachedAccount called");const f=n.getAccountKeys().find(p=>p.startsWith(t));let m=null;f&&(m=n.getAccount(f,u));const g=m||Pr.createAccount({homeAccountId:t,idTokenClaims:i,clientInfo:o,environment:s,cloudGraphHostName:l==null?void 0:l.cloud_graph_host_name,msGraphHost:l==null?void 0:l.msgraph_host,nativeAccountId:c},e,r),_=g.tenantProfiles||[],v=a||g.realm;if(v&&!_.find(p=>p.tenantId===v)){const p=vP(t,g.localAccountId,v,i);_.push(p)}return g.tenantProfiles=_,g}/*! @azure/msal-common v14.15.0 2024-09-20 */async function y6(n,e,t){return typeof n=="string"?n:n({clientId:e,tokenEndpoint:t})}/*! @azure/msal-common v14.15.0 2024-09-20 */class w6 extends wP{constructor(e,t){var r;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=(r=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:r.defaultScopes}async getAuthCodeUrl(e){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(le.GetAuthCodeUrl,e.correlationId);const t=await Ue(this.createAuthCodeUrlQueryString.bind(this),le.AuthClientCreateQueryString,this.logger,this.performanceClient,e.correlationId)(e);return Qt.appendQueryString(this.authority.authorizationEndpoint,t)}async acquireToken(e,t){var a,l;if((a=this.performanceClient)==null||a.addQueueMeasurement(le.AuthClientAcquireToken,e.correlationId),!e.code)throw Ae(Bz);const r=Ia(),i=await Ue(this.executeTokenRequest.bind(this),le.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),o=(l=i.headers)==null?void 0:l[_a.X_MS_REQUEST_ID],s=new Jd(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return s.validateTokenResponse(i.body),Ue(s.handleServerTokenResponse.bind(s),le.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(i.body,this.authority,r,e,t,void 0,void 0,void 0,o)}handleFragmentResponse(e,t){if(new Jd(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw Ae(Wz);return e}getLogoutUri(e){if(!e)throw bn(r6);const t=this.createLogoutUrlQueryString(e);return Qt.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){var c,u;(c=this.performanceClient)==null||c.addQueueMeasurement(le.AuthClientExecuteTokenRequest,t.correlationId);const r=this.createTokenQueryParameters(t),i=Qt.appendQueryString(e.tokenEndpoint,r),o=await Ue(this.createTokenRequestBody.bind(this),le.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let s;if(t.clientInfo)try{const h=Zw(t.clientInfo,this.cryptoUtils.base64Decode);s={credential:`${h.uid}${mi.CLIENT_INFO_SEPARATOR}${h.utid}`,type:Co.HOME_ACCOUNT_ID}}catch(h){this.logger.verbose("Could not parse client info for CCS Header: "+h)}const a=this.createTokenRequestHeaders(s||t.ccsCredential),l={clientId:((u=t.tokenBodyParameters)==null?void 0:u.clientId)||this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return Ue(this.executePostToTokenEndpoint.bind(this),le.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(i,o,a,l,t.correlationId,le.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var o,s;(o=this.performanceClient)==null||o.addQueueMeasurement(le.AuthClientCreateTokenRequestBody,e.correlationId);const t=new j0;if(t.addClientId(((s=e.tokenBodyParameters)==null?void 0:s[pm])||this.config.authOptions.clientId),this.includeRedirectUri?t.addRedirectUri(e.redirectUri):If.validateRedirectUri(e.redirectUri),t.addScopes(e.scopes,!0,this.oidcDefaultScopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addThrottling(),this.serverTelemetryManager&&!DM(this.config)&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&t.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;t.addClientAssertion(await y6(a.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),t.addClientAssertionType(a.assertionType)}if(t.addGrantType(Rz.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),e.authenticationScheme===wn.POP){const a=new mm(this.cryptoUtils,this.performanceClient);let l;e.popKid?l=this.cryptoUtils.encodeKid(e.popKid):l=(await Ue(a.generateCnf.bind(a),le.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,t.addPopToken(l)}else if(e.authenticationScheme===wn.SSH)if(e.sshJwk)t.addSshJwk(e.sshJwk);else throw bn(ZE);const r=e.correlationId||this.config.cryptoInterface.createNewGuid();t.addCorrelationId(r),(!Us.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities);let i;if(e.clientInfo)try{const a=Zw(e.clientInfo,this.cryptoUtils.base64Decode);i={credential:`${a.uid}${mi.CLIENT_INFO_SEPARATOR}${a.utid}`,type:Co.HOME_ACCOUNT_ID}}catch(a){this.logger.verbose("Could not parse client info for CCS Header: "+a)}else i=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&i)switch(i.type){case Co.HOME_ACCOUNT_ID:try{const a=ap(i.credential);t.addCcsOid(a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case Co.UPN:t.addCcsUpn(i.credential);break}return e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[fD])&&t.addExtraQueryParameters({[fD]:"1"}),t.createQueryString()}async createAuthCodeUrlQueryString(e){var o,s;(o=this.performanceClient)==null||o.addQueueMeasurement(le.AuthClientCreateQueryString,e.correlationId);const t=new j0;t.addClientId(((s=e.extraQueryParameters)==null?void 0:s[pm])||this.config.authOptions.clientId);const r=[...e.scopes||[],...e.extraScopesToConsent||[]];t.addScopes(r,!0,this.oidcDefaultScopes),t.addRedirectUri(e.redirectUri);const i=e.correlationId||this.config.cryptoInterface.createNewGuid();if(t.addCorrelationId(i),t.addResponseMode(e.responseMode),t.addResponseTypeCode(),t.addLibraryInfo(this.config.libraryInfo),DM(this.config)||t.addApplicationTelemetry(this.config.telemetry.application),t.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&t.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&t.addPrompt(e.prompt),e.domainHint&&t.addDomainHint(e.domainHint),e.prompt!==Hr.SELECT_ACCOUNT)if(e.sid&&e.prompt===Hr.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),t.addSid(e.sid);else if(e.account){const a=this.extractAccountSid(e.account);let l=this.extractLoginHint(e.account);if(l&&e.domainHint&&(this.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),l=null),l){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),t.addLoginHint(l);try{const c=ap(e.account.homeAccountId);t.addCcsOid(c)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(a&&e.prompt===Hr.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),t.addSid(a);try{const c=ap(e.account.homeAccountId);t.addCcsOid(c)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),t.addLoginHint(e.account.username);try{const c=ap(e.account.homeAccountId);t.addCcsOid(c)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&t.addNonce(e.nonce),e.state&&t.addState(e.state),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.addExtraQueryParams(e,t),e.nativeBroker&&(t.addNativeBroker(),e.authenticationScheme===wn.POP)){const a=new mm(this.cryptoUtils);let l;e.popKid?l=this.cryptoUtils.encodeKid(e.popKid):l=(await Ue(a.generateCnf.bind(a),le.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,t.addPopToken(l)}return t.createQueryString()}createLogoutUrlQueryString(e){const t=new j0;return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),this.addExtraQueryParams(e,t),t.createQueryString()}addExtraQueryParams(e,t){!(e.extraQueryParameters&&e.extraQueryParameters.hasOwnProperty("instance_aware"))&&this.config.authOptions.instanceAware&&(e.extraQueryParameters=e.extraQueryParameters||{},e.extraQueryParameters.instance_aware="true"),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters)}extractAccountSid(e){var t;return((t=e.idTokenClaims)==null?void 0:t.sid)||null}extractLoginHint(e){var t;return((t=e.idTokenClaims)==null?void 0:t.login_hint)||null}}/*! @azure/msal-common v14.15.0 2024-09-20 */const Rne=300;class FM extends wP{constructor(e,t){super(e,t)}async acquireToken(e){var s,a;(s=this.performanceClient)==null||s.addQueueMeasurement(le.RefreshTokenClientAcquireToken,e.correlationId);const t=Ia(),r=await Ue(this.executeTokenRequest.bind(this),le.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),i=(a=r.headers)==null?void 0:a[_a.X_MS_REQUEST_ID],o=new Jd(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return o.validateTokenResponse(r.body),Ue(o.handleServerTokenResponse.bind(o),le.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,i)}async acquireTokenByRefreshToken(e){var r;if(!e)throw bn(n6);if((r=this.performanceClient)==null||r.addQueueMeasurement(le.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw Ae(aP);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await Ue(this.acquireTokenWithCachedRefreshToken.bind(this),le.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(i){const o=i instanceof Hs&&i.errorCode===nS,s=i instanceof au&&i.errorCode===J3.INVALID_GRANT_ERROR&&i.subError===J3.CLIENT_MISMATCH_ERROR;if(o||s)return Ue(this.acquireTokenWithCachedRefreshToken.bind(this),le.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw i}return Ue(this.acquireTokenWithCachedRefreshToken.bind(this),le.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){var o;(o=this.performanceClient)==null||o.addQueueMeasurement(le.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const r=gh(this.cacheManager.getRefreshToken.bind(this.cacheManager),le.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,void 0,this.performanceClient,e.correlationId);if(!r)throw UM(nS);if(r.expiresOn&&OM(r.expiresOn,e.refreshTokenExpirationOffsetSeconds||Rne))throw UM(SP);const i={...e,refreshToken:r.secret,authenticationScheme:e.authenticationScheme||wn.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Co.HOME_ACCOUNT_ID}};try{return await Ue(this.acquireToken.bind(this),le.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(i)}catch(s){if(s instanceof Hs&&s.subError===e1){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const a=sp(r);this.cacheManager.removeRefreshToken(a)}throw s}}async executeTokenRequest(e,t){var l,c;(l=this.performanceClient)==null||l.addQueueMeasurement(le.RefreshTokenClientExecuteTokenRequest,e.correlationId);const r=this.createTokenQueryParameters(e),i=Qt.appendQueryString(t.tokenEndpoint,r),o=await Ue(this.createTokenRequestBody.bind(this),le.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),s=this.createTokenRequestHeaders(e.ccsCredential),a={clientId:((c=e.tokenBodyParameters)==null?void 0:c.clientId)||this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return Ue(this.executePostToTokenEndpoint.bind(this),le.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(i,o,s,a,e.correlationId,le.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var i,o,s;(i=this.performanceClient)==null||i.addQueueMeasurement(le.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=e.correlationId,r=new j0;if(r.addClientId(((o=e.tokenBodyParameters)==null?void 0:o[pm])||this.config.authOptions.clientId),e.redirectUri&&r.addRedirectUri(e.redirectUri),r.addScopes(e.scopes,!0,(s=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:s.defaultScopes),r.addGrantType(Rz.REFRESH_TOKEN_GRANT),r.addClientInfo(),r.addLibraryInfo(this.config.libraryInfo),r.addApplicationTelemetry(this.config.telemetry.application),r.addThrottling(),this.serverTelemetryManager&&!DM(this.config)&&r.addServerTelemetry(this.serverTelemetryManager),r.addCorrelationId(t),r.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&r.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;r.addClientAssertion(await y6(a.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),r.addClientAssertionType(a.assertionType)}if(e.authenticationScheme===wn.POP){const a=new mm(this.cryptoUtils,this.performanceClient);let l;e.popKid?l=this.cryptoUtils.encodeKid(e.popKid):l=(await Ue(a.generateCnf.bind(a),le.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,r.addPopToken(l)}else if(e.authenticationScheme===wn.SSH)if(e.sshJwk)r.addSshJwk(e.sshJwk);else throw bn(ZE);if((!Us.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Co.HOME_ACCOUNT_ID:try{const a=ap(e.ccsCredential.credential);r.addCcsOid(a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case Co.UPN:r.addCcsUpn(e.ccsCredential.credential);break}return e.tokenBodyParameters&&r.addExtraQueryParameters(e.tokenBodyParameters),r.createQueryString()}}/*! @azure/msal-common v14.15.0 2024-09-20 */class Nne extends wP{constructor(e,t){super(e,t)}async acquireToken(e){var t;try{const[r,i]=await this.acquireCachedToken({...e,scopes:(t=e.scopes)!=null&&t.length?e.scopes:[...Bm]});return i===pc.PROACTIVELY_REFRESHED&&(this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new FM(this.config,this.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),r}catch(r){if(r instanceof KE&&r.errorCode===cl)return new FM(this.config,this.performanceClient).acquireTokenByRefreshToken(e);throw r}}async acquireCachedToken(e){var l;(l=this.performanceClient)==null||l.addQueueMeasurement(le.SilentFlowClientAcquireCachedToken,e.correlationId);let t=pc.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!Us.isEmptyObj(e.claims))throw this.setCacheOutcome(pc.FORCE_REFRESH_OR_CLAIMS,e.correlationId),Ae(cl);if(!e.account)throw Ae(aP);const r=e.account.tenantId||xne(e.authority),i=this.cacheManager.getTokenKeys(),o=this.cacheManager.getAccessToken(e.account,e,i,r,this.performanceClient,e.correlationId);if(o){if(ite(o.cachedAt)||OM(o.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(pc.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),Ae(cl);o.refreshOn&&OM(o.refreshOn,0)&&(t=pc.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(pc.NO_CACHED_ACCESS_TOKEN,e.correlationId),Ae(cl);const s=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.readAccountFromCache(e.account),accessToken:o,idToken:this.cacheManager.getIdToken(e.account,i,r,this.performanceClient,e.correlationId),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await Ue(this.generateResultFromCacheRecord.bind(this),le.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(a,e),t]}setCacheOutcome(e,t){var r,i;(r=this.serverTelemetryManager)==null||r.setCacheOutcome(e),(i=this.performanceClient)==null||i.addFields({cacheOutcome:e},t),e!==pc.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(le.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let r;if(e.idToken&&(r=mh(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const o=r==null?void 0:r.auth_time;if(!o)throw Ae(sP);Xz(o,t.maxAge)}return Jd.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)}}/*! @azure/msal-common v14.15.0 2024-09-20 */const Ine={sendGetRequestAsync:()=>Promise.reject(Ae(Dt)),sendPostRequestAsync:()=>Promise.reject(Ae(Dt))};/*! @azure/msal-common v14.15.0 2024-09-20 */const gD=",",S6="|";function Pne(n){const{skus:e,libraryName:t,libraryVersion:r,extensionName:i,extensionVersion:o}=n,s=new Map([[0,[t,r]],[2,[i,o]]]);let a=[];if(e!=null&&e.length){if(a=e.split(gD),a.length<4)return e}else a=Array.from({length:4},()=>S6);return s.forEach((l,c)=>{var u,h;l.length===2&&((u=l[0])!=null&&u.length)&&((h=l[1])!=null&&h.length)&&kne({skuArr:a,index:c,skuName:l[0],skuVersion:l[1]})}),a.join(gD)}function kne(n){const{skuArr:e,index:t,skuName:r,skuVersion:i}=n;t>=e.length||(e[t]=[r,i].join(S6))}class Tv{constructor(e,t){this.cacheOutcome=pc.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||ge.EMPTY_STRING,this.wrapperVer=e.wrapperVer||ge.EMPTY_STRING,this.telemetryCacheKey=Yr.CACHE_KEY+mi.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${Yr.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r!=null&&r.length&&t.push(`broker_error=${r}`);const i=t.join(Yr.VALUE_SEPARATOR),o=this.getRegionDiscoveryFields(),s=[e,o].join(Yr.VALUE_SEPARATOR);return[Yr.SCHEMA_VERSION,s,i].join(Yr.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Tv.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(Yr.VALUE_SEPARATOR),i=e.errors.slice(0,t).join(Yr.VALUE_SEPARATOR),o=e.errors.length,s=t<o?Yr.OVERFLOW_TRUE:Yr.OVERFLOW_FALSE,a=[o,s].join(Yr.VALUE_SEPARATOR);return[Yr.SCHEMA_VERSION,e.cacheHits,r,i,a].join(Yr.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=Yr.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof tr?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(Yr.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=Tv.maxErrorsToSend(e),r=e.errors.length;if(t===r)this.cacheManager.removeItem(this.telemetryCacheKey);else{const i={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,i)}}static maxErrorsToSend(e){let t,r=0,i=0;const o=e.errors.length;for(t=0;t<o;t++){const s=e.failedRequests[2*t]||ge.EMPTY_STRING,a=e.failedRequests[2*t+1]||ge.EMPTY_STRING,l=e.errors[t]||ge.EMPTY_STRING;if(i+=s.toString().length+a.toString().length+l.length+3,i<Yr.MAX_LAST_HEADER_BYTES)r+=1;else break}return r}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||ge.EMPTY_STRING),e.push(this.regionSource||ge.EMPTY_STRING),e.push(this.regionOutcome||ge.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e)}static makeExtraSkuString(e){return Pne(e)}}/*! @azure/msal-common v14.15.0 2024-09-20 */const E6="missing_kid_error",T6="missing_alg_error";/*! @azure/msal-common v14.15.0 2024-09-20 */const Lne={[E6]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[T6]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class TP extends tr{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,TP.prototype)}}function vD(n){return new TP(n,Lne[n])}/*! @azure/msal-common v14.15.0 2024-09-20 */class CP{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw vD(E6);if(!e.alg)throw vD(T6);const t=new CP({typ:e.typ||Hee.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}/*! @azure/msal-common v14.15.0 2024-09-20 */class _D{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class One{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:_ne.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new _D}}startPerformanceMeasurement(){return new _D}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}/*! @azure/msal-browser v3.24.0 2024-09-20 */const bP="pkce_not_created",C6="crypto_nonexistent",t1="empty_navigate_uri",b6="hash_empty_error",AP="no_state_in_hash",A6="hash_does_not_contain_known_properties",M6="unable_to_parse_state",R6="state_interaction_type_mismatch",N6="interaction_in_progress",I6="popup_window_error",P6="empty_window_error",eh="user_cancelled",Dne="monitor_popup_timeout",k6="monitor_window_timeout",L6="redirect_in_iframe",O6="block_iframe_reload",D6="block_nested_popups",Une="iframe_closed_prematurely",n1="silent_logout_unsupported",U6="no_account_error",Fne="silent_prompt_value_error",F6="no_token_request_cache_error",j6="unable_to_parse_token_request_cache_error",MP="no_cached_authority_error",jne="auth_request_not_set_error",Bne="invalid_cache_type",RP="non_browser_environment",Pf="database_not_open",rS="no_network_connectivity",B6="post_request_failed",z6="get_request_failed",jM="failed_to_parse_response",H6="unable_to_load_token",NP="crypto_key_not_found",V6="auth_code_required",G6="auth_code_or_nativeAccountId_required",W6="spa_code_and_nativeAccountId_present",IP="database_unavailable",$6="unable_to_acquire_token_from_native_platform",Y6="native_handshake_timeout",K6="native_extension_not_installed",s_="native_connection_not_established",X6="uninitialized_public_client_application",q6="native_prompt_not_supported",Q6="invalid_base64_string",Z6="invalid_pop_token_request";/*! @azure/msal-browser v3.24.0 2024-09-20 */const $a="For more visit: aka.ms/msaljs/browser-errors",zne={[bP]:"The PKCE code challenge and verifier could not be generated.",[C6]:"The crypto object or function is not available.",[t1]:"Navigation URI is empty. Please check stack trace for more info.",[b6]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${$a}`,[AP]:"Hash does not contain state. Please verify that the request originated from msal.",[A6]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${$a}`,[M6]:"Unable to parse state. Please verify that the request originated from msal.",[R6]:"Hash contains state but the interaction type does not match the caller.",[N6]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${$a}`,[I6]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[P6]:"window.open returned null or undefined window object.",[eh]:"User cancelled the flow.",[Dne]:`Token acquisition in popup failed due to timeout.  ${$a}`,[k6]:`Token acquisition in iframe failed due to timeout.  ${$a}`,[L6]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[O6]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${$a}`,[D6]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[Une]:"The iframe being monitored was closed prematurely.",[n1]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[U6]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[Fne]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[F6]:"No token request found in cache.",[j6]:"The cached token request could not be parsed.",[MP]:"No cached authority found.",[jne]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[Bne]:"Invalid cache type",[RP]:"Login and token requests are not supported in non-browser environments.",[Pf]:"Database is not open!",[rS]:"No network connectivity. Check your internet connection.",[B6]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[z6]:"Network request failed. Please check the network trace to determine root cause.",[jM]:"Failed to parse network response. Check network trace.",[H6]:"Error loading token to cache.",[NP]:"Cryptographic Key or Keypair not found in browser storage.",[V6]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[G6]:"An authorization code or nativeAccountId must be provided to this flow.",[W6]:"Request cannot contain both spa code and native account id.",[IP]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[$6]:`Unable to acquire token from native platform.  ${$a}`,[Y6]:"Timed out while attempting to establish connection to browser extension",[K6]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[s_]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${$a}`,[X6]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${$a}`,[q6]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Q6]:"Invalid base64 encoded string.",[Z6]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true."};class a_ extends tr{constructor(e){super(e,zne[e]),Object.setPrototypeOf(this,a_.prototype),this.name="BrowserAuthError"}}function Je(n){return new a_(n)}/*! @azure/msal-browser v3.24.0 2024-09-20 */const xo={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},lp={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},gd={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},xr={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},xD={GET:"GET",POST:"POST"},fn={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},sc={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},Tx={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},On={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var ut;(function(n){n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none"})(ut||(ut={}));const yD={scopes:Bm},J6="jwk",BM="msal.db",Hne=1,Vne=`${BM}.keys`,po={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},Gne=[po.Default,po.Skip,po.RefreshTokenAndNetwork],Wne="msal.browser.log.level",$ne="msal.browser.log.pii";/*! @azure/msal-browser v3.24.0 2024-09-20 */function Cx(n){return encodeURIComponent(PP(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function r1(n){return eH(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function PP(n){return eH(new TextEncoder().encode(n))}function eH(n){const e=Array.from(n,t=>String.fromCodePoint(t)).join("");return btoa(e)}/*! @azure/msal-browser v3.24.0 2024-09-20 */const Yne="RSASSA-PKCS1-v1_5",tH="SHA-256",Kne=2048,Xne=new Uint8Array([1,0,1]),wD="0123456789abcdef",SD=new Uint32Array(1),kP={name:Yne,hash:tH,modulusLength:Kne,publicExponent:Xne};function qne(n){if("crypto"in window)n.verbose("BrowserCrypto: modern crypto interface available");else throw n.error("BrowserCrypto: crypto interface is unavailable"),Je(C6)}async function nH(n,e,t){e==null||e.addQueueMeasurement(le.Sha256Digest,t);const i=new TextEncoder().encode(n);return window.crypto.subtle.digest(tH,i)}function Qne(n){return window.crypto.getRandomValues(n)}function EC(){return window.crypto.getRandomValues(SD),SD[0]}function kl(){const n=Date.now(),e=EC()*1024+(EC()&1023),t=new Uint8Array(16),r=Math.trunc(e/2**30),i=e&2**30-1,o=EC();t[0]=n/2**40,t[1]=n/2**32,t[2]=n/2**24,t[3]=n/2**16,t[4]=n/2**8,t[5]=n,t[6]=112|r>>>8,t[7]=r,t[8]=128|i>>>24,t[9]=i>>>16,t[10]=i>>>8,t[11]=i,t[12]=o>>>24,t[13]=o>>>16,t[14]=o>>>8,t[15]=o;let s="";for(let a=0;a<t.length;a++)s+=wD.charAt(t[a]>>>4),s+=wD.charAt(t[a]&15),(a===3||a===5||a===7||a===9)&&(s+="-");return s}async function Zne(n,e){return window.crypto.subtle.generateKey(kP,n,e)}async function TC(n){return window.crypto.subtle.exportKey(J6,n)}async function Jne(n,e,t){return window.crypto.subtle.importKey(J6,n,kP,e,t)}async function ere(n,e){return window.crypto.subtle.sign(kP,n,e)}async function rH(n){const e=await nH(n),t=new Uint8Array(e);return r1(t)}/*! @azure/msal-browser v3.24.0 2024-09-20 */const iS="storage_not_supported",zM="stubbed_public_client_application_called",oS="in_mem_redirect_unavailable";/*! @azure/msal-browser v3.24.0 2024-09-20 */const jy={[iS]:"Given storage configuration option was not supported.",[zM]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[oS]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};jy[iS],jy[zM],jy[oS];class LP extends tr{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,LP.prototype)}}function iH(n){return new LP(n,jy[n])}/*! @azure/msal-browser v3.24.0 2024-09-20 */function tre(n){n.location.hash="",typeof n.history.replaceState=="function"&&n.history.replaceState(null,"",`${n.location.origin}${n.location.pathname}${n.location.search}`)}function nre(n){const e=n.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function OP(){return window.parent!==window}function rre(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${xo.POPUP_NAME_PREFIX}.`)===0}function ul(){return window.location.href.split("?")[0].split("#")[0]}function ire(){const e=new Qt(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function ore(){if(Qt.hashContainsKnownProperties(window.location.hash)&&OP())throw Je(O6)}function sre(n){if(OP()&&!n)throw Je(L6)}function are(){if(rre())throw Je(D6)}function lre(){if(typeof window>"u")throw Je(RP)}function oH(n){if(!n)throw Je(X6)}function DP(n){lre(),ore(),are(),oH(n)}function ED(n,e){if(DP(n),sre(e.system.allowRedirectInIframe),e.cache.cacheLocation===xr.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw iH(oS)}function sH(n){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(n).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}/*! @azure/msal-browser v3.24.0 2024-09-20 */class sS{navigateInternal(e,t){return sS.defaultNavigateWindow(e,t)}navigateExternal(e,t){return sS.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(r=>{setTimeout(()=>{r(!0)},t.timeout)})}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class cre{async sendGetRequestAsync(e,t){let r;try{r=await fetch(e,{method:xD.GET,headers:this.getFetchHeaders(t)})}catch{throw window.navigator.onLine?Je(z6):Je(rS)}try{return{headers:this.getHeaderDict(r.headers),body:await r.json(),status:r.status}}catch{throw Je(jM)}}async sendPostRequestAsync(e,t){const r=t&&t.body||ge.EMPTY_STRING;let i;try{i=await fetch(e,{method:xD.POST,headers:this.getFetchHeaders(t),body:r})}catch{throw window.navigator.onLine?Je(B6):Je(rS)}try{return{headers:this.getHeaderDict(i.headers),body:await i.json(),status:i.status}}catch{throw Je(jM)}}getFetchHeaders(e){const t=new Headers;if(!(e&&e.headers))return t;const r=e.headers;return Object.keys(r).forEach(i=>{t.append(i,r[i])}),t}getHeaderDict(e){const t={};return e.forEach((r,i)=>{t[i]=r}),t}}/*! @azure/msal-browser v3.24.0 2024-09-20 */const ure=6e4,HM=1e4,dre=3e4,hre=2e3;function fre({auth:n,cache:e,system:t,telemetry:r},i){const o={clientId:ge.EMPTY_STRING,authority:`${ge.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:ge.EMPTY_STRING,authorityMetadata:ge.EMPTY_STRING,redirectUri:ge.EMPTY_STRING,postLogoutRedirectUri:ge.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:gl.AAD,OIDCOptions:{serverResponseType:o_.FRAGMENT,defaultScopes:[ge.OPENID_SCOPE,ge.PROFILE_SCOPE,ge.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:dP.None,tenant:ge.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},s={cacheLocation:xr.SessionStorage,temporaryCacheLocation:xr.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===xr.LocalStorage),claimsBasedCachingEnabled:!1},a={loggerCallback:()=>{},logLevel:Bn.Info,piiLoggingEnabled:!1},c={...{...g6,loggerOptions:a,networkClient:i?new cre:Ine,navigationClient:new sS,loadFrameTimeout:0,windowHashTimeout:(t==null?void 0:t.loadFrameTimeout)||ure,iframeHashTimeout:(t==null?void 0:t.loadFrameTimeout)||HM,navigateFrameWait:0,redirectNavigationTimeout:dre,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:(t==null?void 0:t.nativeBrokerHandshakeTimeout)||hre,pollIntervalMilliseconds:xo.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:(t==null?void 0:t.loggerOptions)||a},u={application:{appName:ge.EMPTY_STRING,appVersion:ge.EMPTY_STRING},client:new One};if((n==null?void 0:n.protocolMode)!==gl.OIDC&&(n!=null&&n.OIDCOptions)&&new XE(c.loggerOptions).warning(JSON.stringify(bn(l6))),n!=null&&n.protocolMode&&n.protocolMode!==gl.AAD&&(c!=null&&c.allowNativeBroker))throw bn(c6);return{auth:{...o,...n,OIDCOptions:{...o.OIDCOptions,...n==null?void 0:n.OIDCOptions}},cache:{...s,...e},system:c,telemetry:{...u,...r}}}/*! @azure/msal-browser v3.24.0 2024-09-20 */const pre="@azure/msal-browser",i1="3.24.0";/*! @azure/msal-browser v3.24.0 2024-09-20 */class UP{static loggerCallback(e,t){switch(e){case Bn.Error:console.error(t);return;case Bn.Info:console.info(t);return;case Bn.Verbose:console.debug(t);return;case Bn.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){var l;this.browserEnvironment=typeof window<"u",this.config=fre(e,this.browserEnvironment);let t;try{t=window[xr.SessionStorage]}catch{}const r=t==null?void 0:t.getItem(Wne),i=(l=t==null?void 0:t.getItem($ne))==null?void 0:l.toLowerCase(),o=i==="true"?!0:i==="false"?!1:void 0,s={...this.config.system.loggerOptions},a=r&&Object.keys(Bn).includes(r)?Bn[r]:void 0;a&&(s.loggerCallback=UP.loggerCallback,s.logLevel=a),o!==void 0&&(s.piiLoggingEnabled=o),this.logger=new XE(s,pre,i1),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class th extends UP{getModuleName(){return th.MODULE_NAME}getId(){return th.ID}async initialize(){return this.available=typeof window<"u",this.available}}th.MODULE_NAME="";th.ID="StandardOperatingContext";/*! @azure/msal-browser v3.24.0 2024-09-20 */function Ca(n){return new TextDecoder().decode(mre(n))}function mre(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw Je(Q6)}const t=atob(e);return Uint8Array.from(t,r=>r.codePointAt(0)||0)}/*! @azure/msal-browser v3.24.0 2024-09-20 */class gre{constructor(){this.dbName=BM,this.version=Hne,this.tableName=Vne,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",i=>{i.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",i=>{const o=i;this.db=o.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t(Je(IP)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(Je(Pf));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);s.addEventListener("success",a=>{const l=a;this.closeConnection(),t(l.target.result)}),s.addEventListener("error",a=>{this.closeConnection(),r(a)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((r,i)=>{if(!this.db)return i(Je(Pf));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);a.addEventListener("success",()=>{this.closeConnection(),r()}),a.addEventListener("error",l=>{this.closeConnection(),i(l)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(Je(Pf));const s=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);s.addEventListener("success",()=>{this.closeConnection(),t()}),s.addEventListener("error",a=>{this.closeConnection(),r(a)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(Je(Pf));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();o.addEventListener("success",s=>{const a=s;this.closeConnection(),e(a.target.result)}),o.addEventListener("error",s=>{this.closeConnection(),t(s)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(Je(Pf));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);s.addEventListener("success",a=>{const l=a;this.closeConnection(),t(l.target.result===1)}),s.addEventListener("error",a=>{this.closeConnection(),r(a)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const r=window.indexedDB.deleteDatabase(BM),i=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(i),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(i),e(!0))),r.addEventListener("error",()=>(clearTimeout(i),t(!1)))})}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class VM{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class vre{constructor(e){this.inMemoryCache=new VM,this.indexedDBCache=new gre,this.logger=e}handleDatabaseAccessError(e){if(e instanceof a_&&e.errorCode===IP)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(r){this.handleDatabaseAccessError(r)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(r){this.handleDatabaseAccessError(r)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(r){this.handleDatabaseAccessError(r)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class gm{constructor(e,t){this.logger=e,qne(e),this.cache=new vre(this.logger),this.performanceClient=t}createNewGuid(){return kl()}base64Encode(e){return PP(e)}base64Decode(e){return Ca(e)}base64UrlEncode(e){return Cx(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){var u;const t=(u=this.performanceClient)==null?void 0:u.startMeasurement(le.CryptoOptsGetPublicKeyThumbprint,e.correlationId),r=await Zne(gm.EXTRACTABLE,gm.POP_KEY_USAGES),i=await TC(r.publicKey),o={e:i.e,kty:i.kty,n:i.n},s=TD(o),a=await this.hashString(s),l=await TC(r.privateKey),c=await Jne(l,!1,["sign"]);return await this.cache.setItem(a,{privateKey:c,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),a}async removeTokenBindingKey(e){return await this.cache.removeItem(e),!await this.cache.containsKey(e)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,r,i){var y;const o=(y=this.performanceClient)==null?void 0:y.startMeasurement(le.CryptoOptsSignJwt,i),s=await this.cache.getItem(t);if(!s)throw Je(NP);const a=await TC(s.publicKey),l=TD(a),c=Cx(JSON.stringify({kid:t})),u=CP.getShrHeaderString({...r==null?void 0:r.header,alg:a.alg,kid:c}),h=Cx(u);e.cnf={jwk:JSON.parse(l)};const f=Cx(JSON.stringify(e)),m=`${h}.${f}`,_=new TextEncoder().encode(m),v=await ere(s.privateKey,_),p=r1(new Uint8Array(v)),x=`${m}.${p}`;return o&&o.end({success:!0}),x}async hashString(e){return rH(e)}}gm.POP_KEY_USAGES=["sign","verify"];gm.EXTRACTABLE=!0;function TD(n){return JSON.stringify(n,Object.keys(n).sort())}/*! @azure/msal-browser v3.24.0 2024-09-20 */class CD{constructor(e){this.validateWindowStorage(e),this.windowStorage=window[e]}validateWindowStorage(e){if(e!==xr.LocalStorage&&e!==xr.SessionStorage||!window[e])throw iH(iS)}getItem(e){return this.windowStorage.getItem(e)}setItem(e,t){this.windowStorage.setItem(e,t)}removeItem(e){this.windowStorage.removeItem(e)}getKeys(){return Object.keys(this.windowStorage)}containsKey(e){return this.windowStorage.hasOwnProperty(e)}}/*! @azure/msal-browser v3.24.0 2024-09-20 */function aH(n,e){if(!e)return null;try{return Fs.parseRequestState(n,e).libraryState.meta}catch{throw Ae(hm)}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class GM extends fm{constructor(e,t,r,i,o,s){super(e,r,i,o),this.COOKIE_LIFE_MULTIPLIER=24*60*60*1e3,this.cacheConfig=t,this.logger=i,this.internalStorage=new VM,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupTemporaryCacheStorage(this.cacheConfig.temporaryCacheLocation,this.cacheConfig.cacheLocation),t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=s}setupBrowserStorage(e){switch(e){case xr.LocalStorage:case xr.SessionStorage:try{return new CD(e)}catch(t){this.logger.verbose(t);break}}return this.cacheConfig.cacheLocation=xr.MemoryStorage,new VM}setupTemporaryCacheStorage(e,t){switch(t){case xr.LocalStorage:case xr.SessionStorage:try{return new CD(e||xr.SessionStorage)}catch(r){return this.logger.verbose(r),this.internalStorage}case xr.MemoryStorage:default:return this.internalStorage}}migrateCacheEntries(){const e=`${ge.CACHE_PREFIX}.${Ur.ID_TOKEN}`,t=`${ge.CACHE_PREFIX}.${Ur.CLIENT_INFO}`,r=`${ge.CACHE_PREFIX}.${Ur.ERROR}`,i=`${ge.CACHE_PREFIX}.${Ur.ERROR_DESC}`,o=this.browserStorage.getItem(e),s=this.browserStorage.getItem(t),a=this.browserStorage.getItem(r),l=this.browserStorage.getItem(i),c=[o,s,a,l];[Ur.ID_TOKEN,Ur.CLIENT_INFO,Ur.ERROR,Ur.ERROR_DESC].forEach((h,f)=>{const m=c[f];m&&this.setTemporaryCache(h,m,!0)})}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");const e=this.getItem(sc.ACCOUNT_KEYS),t=this.getItem(`${sc.TOKEN_KEYS}.${this.clientId}`);if(e&&t){this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration.");return}this.browserStorage.getKeys().forEach(i=>{if(this.isCredentialKey(i)){const o=this.getItem(i);if(o){const s=this.validateAndParseJson(o);if(s&&s.hasOwnProperty("credentialType"))switch(s.credentialType){case vt.ID_TOKEN:if(iD(s)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${i} found, saving key to token key map`);const a=s,l=this.updateCredentialCacheKey(i,a);this.addTokenKey(l,vt.ID_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${i}`);break;case vt.ACCESS_TOKEN:case vt.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(rD(s)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${i} found, saving key to token key map`);const a=s,l=this.updateCredentialCacheKey(i,a);this.addTokenKey(l,vt.ACCESS_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${i}`);break;case vt.REFRESH_TOKEN:if(oD(s)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${i} found, saving key to token key map`);const a=s,l=this.updateCredentialCacheKey(i,a);this.addTokenKey(l,vt.REFRESH_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${i}`);break}}}if(this.isAccountKey(i)){const o=this.getItem(i);if(o){const s=this.validateAndParseJson(o);s&&Pr.isAccountEntity(s)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${i} found, saving key to account key map`),this.addAccountKeyToMap(i))}}})}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t){this.browserStorage.setItem(e,t)}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const r=this.getCachedAccountEntity(e);return this.updateOutdatedCachedAccount(e,r,t)}getCachedAccountEntity(e){const t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;const r=this.validateAndParseJson(t);return!r||!Pr.isAccountEntity(r)?(this.removeAccountKeyFromMap(e),null):fm.toObject(new Pr,r)}setAccount(e){this.logger.trace("BrowserCacheManager.setAccount called");const t=e.generateAccountKey();this.setItem(t,JSON.stringify(e)),this.addAccountKeyToMap(t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");const e=this.getItem(sc.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const t=this.getAccountKeys();t.indexOf(e)===-1?(t.push(e),this.setItem(sc.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const t=this.getAccountKeys(),r=t.indexOf(e);r>-1?(t.splice(r,1),this.setItem(sc.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}async removeAccount(e){super.removeAccount(e),this.removeAccountKeyFromMap(e)}removeOutdatedAccount(e){this.removeItem(e),this.removeAccountKeyFromMap(e)}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,vt.ID_TOKEN)}async removeAccessToken(e){super.removeAccessToken(e),this.removeTokenKey(e,vt.ACCESS_TOKEN)}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,vt.REFRESH_TOKEN)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");const e=this.getItem(`${sc.TOKEN_KEYS}.${this.clientId}`);if(e){const t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");const r=this.getTokenKeys();switch(t){case vt.ID_TOKEN:r.idToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),r.idToken.push(e));break;case vt.ACCESS_TOKEN:r.accessToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),r.accessToken.push(e));break;case vt.REFRESH_TOKEN:r.refreshToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),r.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),Ae(kM)}this.setItem(`${sc.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");const r=this.getTokenKeys();switch(t){case vt.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const i=r.idToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),r.idToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case vt.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const o=r.accessToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),r.accessToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case vt.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const s=r.refreshToken.indexOf(e);s>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),r.refreshToken.splice(s,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),Ae(kM)}this.setItem(`${sc.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}getIdTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,vt.ID_TOKEN),null;const r=this.validateAndParseJson(t);return!r||!iD(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,vt.ID_TOKEN),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),r)}setIdTokenCredential(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const t=sp(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,vt.ID_TOKEN)}getAccessTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,vt.ACCESS_TOKEN),null;const r=this.validateAndParseJson(t);return!r||!rD(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,vt.ACCESS_TOKEN),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),r)}setAccessTokenCredential(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const t=sp(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,vt.ACCESS_TOKEN)}getRefreshTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,vt.REFRESH_TOKEN),null;const r=this.validateAndParseJson(t);return!r||!oD(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,vt.REFRESH_TOKEN),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),r)}setRefreshTokenCredential(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const t=sp(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,vt.REFRESH_TOKEN)}getAppMetadata(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!fte(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");const t=hte(e);this.setItem(t,JSON.stringify(e))}getServerTelemetry(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!ute(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&pte(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(Tx.WRAPPER_SKU,e),this.internalStorage.setItem(Tx.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(Tx.WRAPPER_SKU)||ge.EMPTY_STRING,t=this.internalStorage.getItem(Tx.WRAPPER_VER)||ge.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){const e=this.generateCacheKey(Ur.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(e);if(!t){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");const i=this.generateCacheKey(Ur.ACTIVE_ACCOUNT),o=this.getItem(i);if(!o)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;const s=this.getAccountInfoFilteredBy({localAccountId:o});return s?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(s),s):null}const r=this.validateAndParseJson(t);return r?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:r.homeAccountId,localAccountId:r.localAccountId,tenantId:r.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){const t=this.generateCacheKey(Ur.ACTIVE_ACCOUNT_FILTERS),r=this.generateCacheKey(Ur.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");const i={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.browserStorage.setItem(t,JSON.stringify(i)),this.browserStorage.setItem(r,e.localAccountId)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(r)}getThrottlingCache(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!dte(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){const r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const o=this.getItemCookie(r);if(o)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),o}const i=this.temporaryCacheStorage.getItem(r);if(!i){if(this.cacheConfig.cacheLocation===xr.LocalStorage){const o=this.browserStorage.getItem(r);if(o)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),o}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),i}setTemporaryCache(e,t,r){const i=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(i,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(i,t))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(e))}getKeys(){return this.browserStorage.getKeys()}async clear(){await this.removeAllAccounts(),this.removeAppMetadata(),this.temporaryCacheStorage.getKeys().forEach(e=>{(e.indexOf(ge.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{(e.indexOf(ge.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(e)}),this.internalStorage.clear()}async clearTokensAndKeysWithClaims(e,t){e.addQueueMeasurement(le.ClearTokensAndKeysWithClaims,t);const r=this.getTokenKeys(),i=[];r.accessToken.forEach(o=>{const s=this.getAccessTokenCredential(o);s!=null&&s.requestedClaimsHash&&o.includes(s.requestedClaimsHash.toLowerCase())&&i.push(this.removeAccessToken(o))}),await Promise.all(i),i.length>0&&this.logger.warning(`${i.length} access tokens with claims in the cache keys have been removed from the cache.`)}setItemCookie(e,t,r){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;if(r){const o=this.getCookieExpirationTime(r);i+=`expires=${o};`}this.cacheConfig.secureCookies&&(i+="Secure;"),document.cookie=i}getItemCookie(e){const t=`${encodeURIComponent(e)}=`,r=document.cookie.split(";");for(let i=0;i<r.length;i++){let o=r[i];for(;o.charAt(0)===" ";)o=o.substring(1);if(o.indexOf(t)===0)return decodeURIComponent(o.substring(t.length,o.length))}return ge.EMPTY_STRING}clearMsalCookies(){const e=`${ge.CACHE_PREFIX}.${this.clientId}`;document.cookie.split(";").forEach(r=>{for(;r.charAt(0)===" ";)r=r.substring(1);if(r.indexOf(e)===0){const i=r.split("=")[0];this.clearItemCookie(i)}})}clearItemCookie(e){this.setItemCookie(e,ge.EMPTY_STRING,-1)}getCookieExpirationTime(e){const t=new Date;return new Date(t.getTime()+e*this.COOKIE_LIFE_MULTIPLIER).toUTCString()}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):Us.startsWith(e,ge.CACHE_PREFIX)||Us.startsWith(e,Ur.ADAL_ID_TOKEN)?e:`${ge.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=Fs.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${fn.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=Fs.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${fn.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=Fs.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${fn.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),r=this.getTemporaryCache(t);if(!r)return null;const i=this.generateAuthorityKey(r);return this.getTemporaryCache(i)}updateCacheEntries(e,t,r,i,o){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const s=this.generateStateKey(e);this.setTemporaryCache(s,e,!1);const a=this.generateNonceKey(e);this.setTemporaryCache(a,t,!1);const l=this.generateAuthorityKey(e);if(this.setTemporaryCache(l,r,!1),o){const c={credential:o.homeAccountId,type:Co.HOME_ACCOUNT_ID};this.setTemporaryCache(fn.CCS_CREDENTIAL,JSON.stringify(c),!0)}else if(i){const c={credential:i,type:Co.UPN};this.setTemporaryCache(fn.CCS_CREDENTIAL,JSON.stringify(c),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{t.indexOf(e)!==-1&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(fn.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(fn.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(fn.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(fn.CORRELATION_ID)),this.removeTemporaryItem(this.generateCacheKey(fn.CCS_CREDENTIAL)),this.removeTemporaryItem(this.generateCacheKey(fn.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),r=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r||ge.EMPTY_STRING)}this.clearMsalCookies()}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(t.indexOf(fn.REQUEST_STATE)===-1)return;const r=this.temporaryCacheStorage.getItem(t);if(!r)return;const i=aH(this.cryptoImpl,r);i&&i.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r))}),this.clearMsalCookies(),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=PP(JSON.stringify(e));this.setTemporaryCache(fn.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(fn.REQUEST_PARAMS,!0);if(!t)throw Je(F6);let r;try{r=JSON.parse(Ca(t))}catch(i){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${i}`),Je(j6)}if(this.removeTemporaryItem(this.generateCacheKey(fn.REQUEST_PARAMS)),!r.authority){const i=this.generateAuthorityKey(e),o=this.getTemporaryCache(i);if(!o)throw Je(MP);r.authority=o}return r}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(fn.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${ge.CACHE_PREFIX}.${fn.INTERACTION_STATUS_KEY}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){const t=`${ge.CACHE_PREFIX}.${fn.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw Je(N6);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}getLegacyLoginHint(){const e=this.getTemporaryCache(Ur.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(Ur.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));const t=this.getTemporaryCache(Ur.ID_TOKEN,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(Ur.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));const r=t||e;if(r){const i=mh(r,Ca);if(i.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),i.preferred_username;if(i.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),i.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t){const r=sp(t);if(e!==r){const i=this.getItem(e);if(i)return this.browserStorage.removeItem(e),this.setItem(r,i),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),r;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}async hydrateCache(e,t){var a,l,c;const r=qE((a=e.account)==null?void 0:a.homeAccountId,(l=e.account)==null?void 0:l.environment,e.idToken,this.clientId,e.tenantId);let i;t.claims&&(i=await this.cryptoImpl.hashString(t.claims));const o=QE((c=e.account)==null?void 0:c.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,Ca,void 0,e.tokenType,void 0,t.sshKid,t.claims,i),s={idToken:r,accessToken:o};return this.saveCacheRecord(s)}async saveCacheRecord(e,t,r){try{await super.saveCacheRecord(e,t,r)}catch(i){if(i instanceof Rp&&this.performanceClient&&r)try{const o=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:o.refreshToken.length,cacheIdCount:o.idToken.length,cacheAtCount:o.accessToken.length},r)}catch{}throw i}}}const _re=(n,e)=>{const t={cacheLocation:xr.MemoryStorage,temporaryCacheLocation:xr.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new GM(n,t,Qw,e)};/*! @azure/msal-browser v3.24.0 2024-09-20 */function xre(n,e,t,r){return n.verbose("getAllAccounts called"),t?e.getAllAccounts(r):[]}function yre(n,e,t){if(e.trace("getAccount called"),Object.keys(n).length===0)return e.warning("getAccount: No accountFilter provided"),null;const r=t.getAccountInfoFilteredBy(n);return r?(e.verbose("getAccount: Account matching provided filter found, returning"),r):(e.verbose("getAccount: No matching account found, returning null"),null)}function wre(n,e,t){if(e.trace("getAccountByUsername called"),!n)return e.warning("getAccountByUsername: No username provided"),null;const r=t.getAccountInfoFilteredBy({username:n});return r?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${n}`),r):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function Sre(n,e,t){if(e.trace("getAccountByHomeId called"),!n)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const r=t.getAccountInfoFilteredBy({homeAccountId:n});return r?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${n}`),r):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function Ere(n,e,t){if(e.trace("getAccountByLocalId called"),!n)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const r=t.getAccountInfoFilteredBy({localAccountId:n});return r?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${n}`),r):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function Tre(n,e){e.setActiveAccount(n)}function Cre(n){return n.getActiveAccount()}/*! @azure/msal-browser v3.24.0 2024-09-20 */const gt={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"};/*! @azure/msal-browser v3.24.0 2024-09-20 */class bre{constructor(e,t){this.eventCallbacks=new Map,this.logger=e,this.browserCrypto=t,this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}addEventCallback(e){if(typeof window<"u"){const t=kl();return this.eventCallbacks.set(t,e),this.logger.verbose(`Event callback registered with id: ${t}`),t}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}enableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}emitEvent(e,t,r,i){if(typeof window<"u"){const o={eventType:e,interactionType:t||null,payload:r||null,error:i||null,timestamp:Date.now()};this.logger.info(`Emitting event: ${e}`),this.eventCallbacks.forEach((s,a)=>{this.logger.verbose(`Emitting event to callback ${a}: ${e}`),s.apply(null,[o])})}}handleAccountCacheChange(e){var t;try{(t=e.key)!=null&&t.includes(Ur.ACTIVE_ACCOUNT_FILTERS)&&this.emitEvent(gt.ACTIVE_ACCOUNT_CHANGED);const r=e.newValue||e.oldValue;if(!r)return;const i=JSON.parse(r);if(typeof i!="object"||!Pr.isAccountEntity(i))return;const s=fm.toObject(new Pr,i).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.emitEvent(gt.ACCOUNT_ADDED,void 0,s)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.emitEvent(gt.ACCOUNT_REMOVED,void 0,s))}catch{return}}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class lH{constructor(e,t,r,i,o,s,a,l,c){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=s,this.nativeMessageHandler=l,this.correlationId=c||kl(),this.logger=i.clone(xo.MSAL_SKU,i1,this.correlationId),this.performanceClient=a}async clearCacheOnLogout(e){if(e){Pr.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null));try{await this.browserStorage.removeAccount(Pr.generateAccountCacheKey(e)),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),await this.browserStorage.clear(),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri||ul();return Qt.getAbsoluteUrl(t,ul())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Tv(r,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(le.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const i={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},o=e.requestAuthority||this.config.auth.authority,s=r!=null&&r.length?r==="true":this.config.auth.instanceAware,a=t&&s?this.config.auth.authority.replace(Qt.getDomainFromUrl(o),t.environment):o,l=hi.generateAuthority(a,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),c=await Ue(_6,le.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(l,this.config.system.networkClient,this.browserStorage,i,this.logger,this.correlationId,this.performanceClient);if(t&&!c.isAlias(t.environment))throw bn(u6);return c}}/*! @azure/msal-browser v3.24.0 2024-09-20 */const Are=32;async function Mre(n,e,t){n.addQueueMeasurement(le.GeneratePkceCodes,t);const r=gh(Rre,le.GenerateCodeVerifier,e,n,t)(n,e,t),i=await Ue(Nre,le.GenerateCodeChallengeFromVerifier,e,n,t)(r,n,e,t);return{verifier:r,challenge:i}}function Rre(n,e,t){try{const r=new Uint8Array(Are);return gh(Qne,le.GetRandomValues,e,n,t)(r),r1(r)}catch{throw Je(bP)}}async function Nre(n,e,t,r){e.addQueueMeasurement(le.GenerateCodeChallengeFromVerifier,r);try{const i=await Ue(nH,le.Sha256Digest,t,e,r)(n,e,r);return r1(new Uint8Array(i))}catch{throw Je(bP)}}/*! @azure/msal-browser v3.24.0 2024-09-20 */async function FP(n,e,t,r){t.addQueueMeasurement(le.InitializeBaseRequest,n.correlationId);const i=n.authority||e.auth.authority,o=[...n&&n.scopes||[]],s={...n,correlationId:n.correlationId,authority:i,scopes:o};if(!s.authenticationScheme)s.authenticationScheme=wn.BEARER,r.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(s.authenticationScheme===wn.SSH){if(!n.sshJwk)throw bn(ZE);if(!n.sshKid)throw bn(a6)}r.verbose(`Authentication Scheme set to "${s.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&n.claims&&!Us.isEmptyObj(n.claims)&&(s.requestedClaimsHash=await rH(n.claims)),s}async function Ire(n,e,t,r,i){r.addQueueMeasurement(le.InitializeSilentRequest,n.correlationId);const o=await Ue(FP,le.InitializeBaseRequest,i,r,n.correlationId)(n,t,r,i);return{...n,...o,account:e,forceRefresh:n.forceRefresh||!1}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class zm extends lH{async initializeAuthorizationCodeRequest(e){this.performanceClient.addQueueMeasurement(le.StandardInteractionClientInitializeAuthorizationCodeRequest,this.correlationId);const t=await Ue(Mre,le.GeneratePkceCodes,this.logger,this.performanceClient,this.correlationId)(this.performanceClient,this.logger,this.correlationId),r={...e,redirectUri:e.redirectUri,code:ge.EMPTY_STRING,codeVerifier:t.verifier};return e.codeChallenge=t.challenge,e.codeChallengeMethod=ge.S256_CODE_CHALLENGE_METHOD,r}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e==null?void 0:e.correlationId);const t={correlationId:this.correlationId||kl(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=Qt.getAbsoluteUrl(e.postLogoutRedirectUri,ul())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=Qt.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,ul())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=Qt.getAbsoluteUrl(ul(),ul())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(le.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await Ue(this.getClientConfiguration.bind(this),le.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new w6(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:o,account:s}=e;this.performanceClient.addQueueMeasurement(le.StandardInteractionClientGetClientConfiguration,this.correlationId);const a=await Ue(this.getDiscoveredAuthority.bind(this),le.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:r,requestAzureCloudOptions:i,requestExtraQueryParameters:o,account:s}),l=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:a,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:l.loggerCallback,piiLoggingEnabled:l.piiLoggingEnabled,logLevel:l.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:xo.MSAL_SKU,version:i1,cpu:ge.EMPTY_STRING,os:ge.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(le.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const r=this.getRedirectUri(e.redirectUri),i={interactionType:t},o=Fs.setRequestState(this.browserCrypto,e&&e.state||ge.EMPTY_STRING,i),a={...await Ue(FP,le.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:r,state:o,nonce:e.nonce||kl(),responseMode:this.config.auth.OIDCOptions.serverResponseType},l=e.account||this.browserStorage.getActiveAccount();if(l&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${l.homeAccountId}`,this.correlationId),a.account=l),!a.loginHint&&!l){const c=this.browserStorage.getLegacyLoginHint();c&&(a.loginHint=c)}return a}}/*! @azure/msal-browser v3.24.0 2024-09-20 */const Pre="ContentError",cH="user_switch";/*! @azure/msal-browser v3.24.0 2024-09-20 */const kre="USER_INTERACTION_REQUIRED",Lre="USER_CANCEL",Ore="NO_NETWORK",Dre="PERSISTENT_ERROR",Ure="DISABLED",Fre="ACCOUNT_UNAVAILABLE";/*! @azure/msal-browser v3.24.0 2024-09-20 */const jre=-2147186943,Bre={[cH]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class va extends tr{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,va.prototype),this.name="NativeAuthError",this.ext=r}}function kf(n){if(n.ext&&n.ext.status&&(n.ext.status===Dre||n.ext.status===Ure)||n.ext&&n.ext.error&&n.ext.error===jre)return!0;switch(n.errorCode){case Pre:return!0;default:return!1}}function WM(n,e,t){if(t&&t.status)switch(t.status){case Fre:return UM(x6);case kre:return new Hs(n,e);case Lre:return Je(eh);case Ore:return Je(rS)}return new va(n,Bre[n]||e,t)}/*! @azure/msal-browser v3.24.0 2024-09-20 */class uH extends zm{async acquireToken(e){this.performanceClient.addQueueMeasurement(le.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(On.acquireTokenSilent_silentFlow),r=await Ue(this.getClientConfiguration.bind(this),le.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),i=new Nne(r,this.performanceClient);this.logger.verbose("Silent auth client created");try{const s=(await Ue(i.acquireCachedToken.bind(i),le.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),s}catch(o){throw o instanceof a_&&o.errorCode===NP&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),o}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t==null?void 0:t.account)}}/*! @azure/msal-browser v3.24.0 2024-09-20 */const CC={BROKER_CLIENT_ID:"brk_client_id",BROKER_REDIRECT_URI:"brk_redirect_uri"};class Np extends lH{constructor(e,t,r,i,o,s,a,l,c,u,h,f){var g;super(e,t,r,i,o,s,l,c,f),this.apiId=a,this.accountId=u,this.nativeMessageHandler=c,this.nativeStorageManager=h,this.silentCacheClient=new uH(e,this.nativeStorageManager,r,i,o,s,l,c,f),this.serverTelemetryManager=this.initializeServerTelemetryManager(this.apiId);const m=this.nativeMessageHandler.getExtensionId()===lp.PREFERRED_EXTENSION_ID?"chrome":(g=this.nativeMessageHandler.getExtensionId())!=null&&g.length?"unknown":void 0;this.skus=Tv.makeExtraSkuString({libraryName:xo.MSAL_SKU,libraryVersion:i1,extensionName:m,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[pne]:this.skus}}async acquireToken(e){this.performanceClient.addQueueMeasurement(le.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const t=this.performanceClient.startMeasurement(le.NativeInteractionClientAcquireToken,e.correlationId),r=Ia();try{const i=await this.initializeNativeRequest(e);try{const c=await this.acquireTokensFromCache(this.accountId,i);return t.end({success:!0,isNativeBroker:!1,fromCache:!0}),c}catch{this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const{...o}=i,s={method:gd.GetToken,request:o},a=await this.nativeMessageHandler.sendMessage(s),l=this.validateNativeResponse(a);return await this.handleNativeResponse(l,i,r).then(c=>(t.end({success:!0,isNativeBroker:!0,requestId:c.requestId}),this.serverTelemetryManager.clearNativeBrokerErrorCode(),c)).catch(c=>{throw t.end({success:!1,errorCode:c.errorCode,subErrorCode:c.subError,isNativeBroker:!0}),c})}catch(i){throw i instanceof va&&this.serverTelemetryManager.setNativeBrokerErrorCode(i.errorCode),i}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:fr.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),Ae(IM);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!r)throw Ae(IM);try{const i=this.createSilentCacheRequest(t,r),o=await this.silentCacheClient.acquireToken(i),s={...r,idTokenClaims:o==null?void 0:o.idTokenClaims,idToken:o==null?void 0:o.idToken};return{...o,account:s}}catch(i){throw i}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...r}=e;delete r.onRedirectNavigate;const i=await this.initializeNativeRequest(r),o={method:gd.GetToken,request:i};try{const l=await this.nativeMessageHandler.sendMessage(o);this.validateNativeResponse(l)}catch(l){if(l instanceof va&&(this.serverTelemetryManager.setNativeBrokerErrorCode(l.errorCode),kf(l)))throw l}this.browserStorage.setTemporaryCache(fn.NATIVE_REQUEST,JSON.stringify(i),!0);const s={apiId:On.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(a,s)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(e==null||e.addFields({errorCode:"no_cached_request"},t)),null;const{prompt:i,...o}=r;i&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(fn.NATIVE_REQUEST));const s={method:gd.GetToken,request:o},a=Ia();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const l=await this.nativeMessageHandler.sendMessage(s);this.validateNativeResponse(l);const c=this.handleNativeResponse(l,o,a);this.browserStorage.setInteractionInProgress(!1);const u=await c;return this.serverTelemetryManager.clearNativeBrokerErrorCode(),u}catch(l){throw this.browserStorage.setInteractionInProgress(!1),l}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){var u;this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const i=mh(e.id_token,Ca),o=this.createHomeAccountIdentifier(e,i),s=(u=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId}))==null?void 0:u.homeAccountId;if(o!==s&&e.account.id!==t.accountId)throw WM(cH);const a=await this.getDiscoveredAuthority({requestAuthority:t.authority}),l=EP(this.browserStorage,a,o,Ca,i,e.client_info,void 0,i.tid,void 0,e.account.id,this.logger),c=await this.generateAuthenticationResult(e,t,i,l,a.canonicalAuthority,r);return this.cacheAccount(l),this.cacheNativeTokens(e,t,o,i,e.access_token,c.tenantId,r),c}createHomeAccountIdentifier(e,t){return Pr.generateHomeAccountId(e.client_info||ge.EMPTY_STRING,Cs.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?fr.fromString(e.scope):fr.fromString(t.scope)}async generatePopAccessToken(e,t){if(t.tokenType===wn.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const r=new mm(this.browserCrypto),i={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw Ae(cP);return r.signPopToken(e.access_token,t.keyId,i)}else return e.access_token}async generateAuthenticationResult(e,t,r,i,o,s){const a=this.addTelemetryFromNativeResponse(e),l=e.scope?fr.fromString(e.scope):fr.fromString(t.scope),c=e.account.properties||{},u=c.UID||r.oid||r.sub||ge.EMPTY_STRING,h=c.TenantId||r.tid||ge.EMPTY_STRING,f=_P(i.getAccountInfo(),void 0,r,e.id_token);f.nativeAccountId!==e.account.id&&(f.nativeAccountId=e.account.id);const m=await this.generatePopAccessToken(e,t),g=t.tokenType===wn.POP?wn.POP:wn.BEARER;return{authority:o,uniqueId:u,tenantId:h,scopes:l.asArray(),account:f,idToken:e.id_token,idTokenClaims:r,accessToken:m,fromCache:a?this.isResponseFromCache(a):!1,expiresOn:new Date(Number(s+e.expires_in)*1e3),tokenType:g,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}cacheAccount(e){this.browserStorage.setAccount(e),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,r,i,o,s,a){const l=qE(r,t.authority,e.id_token||"",t.clientId,i.tid||""),c=t.tokenType===wn.POP?ge.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,u=a+c,h=this.generateScopes(e,t),f=QE(r,t.authority,o,t.clientId,i.tid||s,h.printScopes(),u,0,Ca,void 0,t.tokenType,void 0,t.keyId),m={idToken:l,accessToken:f};this.nativeStorageManager.saveCacheRecord(m,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw Nz(rP,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const r=new Qt(t);r.validateAsUri();const{scopes:i,...o}=e,s=new fr(i||[]);s.appendScopes(Bm);const a=()=>{switch(this.apiId){case On.ssoSilent:case On.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),Hr.NONE}if(!e.prompt){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e.prompt){case Hr.NONE:case Hr.CONSENT:case Hr.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),Je(q6)}},l={...o,accountId:this.accountId,clientId:this.config.auth.clientId,authority:r.urlString,scope:s.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:a(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(l.signPopToken&&e.popKid)throw Je(Z6);if(this.handleExtraBrokerParams(l),l.extraParameters=l.extraParameters||{},l.extraParameters.telemetry=lp.MATS_TELEMETRY,e.authenticationScheme===wn.POP){const c={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},u=new mm(this.browserCrypto);let h;if(l.keyId)h=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:l.keyId})),l.signPopToken=!1;else{const f=await Ue(u.generateCnf.bind(u),le.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(c,this.logger);h=f.reqCnfString,l.keyId=f.kid,l.signPopToken=!0}l.reqCnf=h}return this.addRequestSKUs(l),l}handleExtraBrokerParams(e){if(e.extraParameters&&e.extraParameters.hasOwnProperty(CC.BROKER_CLIENT_ID)&&e.extraParameters.hasOwnProperty(CC.BROKER_REDIRECT_URI)&&e.extraParameters.hasOwnProperty(pm)){const t=e.extraParameters[pm],r=e.redirectUri,i=e.extraParameters[CC.BROKER_REDIRECT_URI];e.extraParameters={child_client_id:t,child_redirect_uri:r},e.redirectUri=i}}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class xa{constructor(e,t,r,i){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=i,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(le.NativeMessageHandlerHandshake)}async sendMessage(e){this.logger.trace("NativeMessageHandler - sendMessage called.");const t={channel:lp.CHANNEL_ID,extensionId:this.extensionId,responseId:kl(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise((r,i)=>{this.resolvers.set(t.responseId,{resolve:r,reject:i})})}static async createProvider(e,t,r){e.trace("NativeMessageHandler - createProvider called.");try{const i=new xa(e,t,r,lp.PREFERRED_EXTENSION_ID);return await i.sendHandshakeRequest(),i}catch{const o=new xa(e,t,r);return await o.sendHandshakeRequest(),o}}async sendHandshakeRequest(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:lp.CHANNEL_ID,extensionId:this.extensionId,responseId:kl(),body:{method:gd.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(Je(Y6)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==lp.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===gd.HandshakeRequest){const r=this.handshakeResolvers.get(t.responseId);if(!r){this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),r.reject(Je(K6))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,r=this.resolvers.get(t.responseId),i=this.handshakeResolvers.get(t.responseId);try{const o=t.body.method;if(o===gd.Response){if(!r)return;const s=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(s)}`),s.status!=="Success")r.reject(WM(s.code,s.description,s.ext));else if(s.result)s.result.code&&s.result.description?r.reject(WM(s.result.code,s.result.description,s.result.ext)):r.resolve(s.result);else throw Nz(rP,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(o===gd.HandshakeResponse){if(!i){this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(o){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${o}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(o):i&&i.reject(o)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,r,i){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!r)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(i)switch(i){case wn.BEARER:case wn.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class jP{constructor(e,t,r,i,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=o}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(le.HandleCodeResponse,t.correlationId);let r;try{r=this.authModule.handleFragmentResponse(e,t.state)}catch(i){throw i instanceof au&&i.subError===eh?Je(eh):i}return Ue(this.handleCodeResponseFromServer.bind(this),le.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(r,t)}async handleCodeResponseFromServer(e,t,r=!0){if(this.performanceClient.addQueueMeasurement(le.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await Ue(this.authModule.updateAuthority.bind(this.authModule),le.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const o=this.createCcsCredentials(t);o&&(this.authCodeRequest.ccsCredential=o)}return await Ue(this.authModule.acquireToken.bind(this.authModule),le.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Co.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:Co.UPN}:null}}/*! @azure/msal-browser v3.24.0 2024-09-20 */function dH(n,e,t){const r=eS(n);if(!r)throw h6(n)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${n}`),Je(A6)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),Je(b6));return r}function zre(n,e,t){if(!n.state)throw Je(AP);const r=aH(e,n.state);if(!r)throw Je(M6);if(r.interactionType!==t)throw Je(R6)}/*! @azure/msal-browser v3.24.0 2024-09-20 */class Hre extends zm{constructor(e,t,r,i,o,s,a,l,c,u){super(e,t,r,i,o,s,a,c,u),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=l}acquireToken(e){try{const r={popupName:this.generatePopupName(e.scopes||Bm,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(e,r))}catch(t){return Promise.reject(t)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:(e==null?void 0:e.popupWindowAttributes)||{},popupWindowParent:(e==null?void 0:e.popupWindowParent)??window},i=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,i,o)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,i,o))}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t){var o;this.logger.verbose("acquireTokenPopupAsync called");const r=this.initializeServerTelemetryManager(On.acquireTokenPopup),i=await Ue(this.initializeAuthorizationRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,ut.Popup);sH(i.authority);try{const s=await Ue(this.initializeAuthorizationCodeRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(i),a=await Ue(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account}),l=xa.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let c;l&&(c=this.performanceClient.startMeasurement(le.FetchAccountIdWithNativeBroker,e.correlationId));const u=await a.getAuthCodeUrl({...i,nativeBroker:l}),h=new jP(a,this.browserStorage,s,this.logger,this.performanceClient),f=this.initiateAuthRequest(u,t);this.eventHandler.emitEvent(gt.POPUP_OPENED,ut.Popup,{popupWindow:f},null);const m=await this.monitorPopupForHash(f,t.popupWindowParent),g=gh(dH,le.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(m,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(ga.removeThrottle(this.browserStorage,this.config.auth.clientId,s),g.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),c&&c.end({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw Je(s_);const v=new Np(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,On.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,g.accountId,this.nativeStorage,i.correlationId),{userRequestState:p}=Fs.parseRequestState(this.browserCrypto,i.state);return await v.acquireToken({...i,state:p,prompt:void 0})}return await h.handleCodeResponse(g,i)}catch(s){throw(o=t.popup)==null||o.close(),s instanceof tr&&(s.setCorrelationId(this.correlationId),r.cacheFailedRequest(s)),s}}async logoutPopupAsync(e,t,r,i){var s,a,l,c;this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(gt.LOGOUT_START,ut.Popup,e);const o=this.initializeServerTelemetryManager(On.logoutPopup);try{await this.clearCacheOnLogout(e.account);const u=await Ue(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:r,account:e.account||void 0});try{u.authority.endSessionEndpoint}catch{if((s=e.account)!=null&&s.homeAccountId&&e.postLogoutRedirectUri&&u.authority.protocolMode===gl.OIDC){if(this.browserStorage.removeAccount((a=e.account)==null?void 0:a.homeAccountId),this.eventHandler.emitEvent(gt.LOGOUT_SUCCESS,ut.Popup,e),i){const m={apiId:On.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},g=Qt.getAbsoluteUrl(i,ul());await this.navigationClient.navigateInternal(g,m)}(l=t.popup)==null||l.close();return}}const h=u.getLogoutUri(e);this.eventHandler.emitEvent(gt.LOGOUT_SUCCESS,ut.Popup,e);const f=this.openPopup(h,t);if(this.eventHandler.emitEvent(gt.POPUP_OPENED,ut.Popup,{popupWindow:f},null),await this.monitorPopupForHash(f,t.popupWindowParent).catch(()=>{}),i){const m={apiId:On.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},g=Qt.getAbsoluteUrl(i,ul());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${g}`),await this.navigationClient.navigateInternal(g,m)}else this.logger.verbose("No main window navigation requested")}catch(u){throw(c=t.popup)==null||c.close(),u instanceof tr&&(u.setCorrelationId(this.correlationId),o.cacheFailedRequest(u)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(gt.LOGOUT_FAILURE,ut.Popup,null,u),this.eventHandler.emitEvent(gt.LOGOUT_END,ut.Popup),u}this.eventHandler.emitEvent(gt.LOGOUT_END,ut.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),Je(t1)}monitorPopupForHash(e,t){return new Promise((r,i)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const o=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(o),i(Je(eh));return}let s="";try{s=e.location.href}catch{}if(!s||s==="about:blank")return;clearInterval(o);let a="";const l=this.config.auth.OIDCOptions.serverResponseType;e&&(l===o_.QUERY?a=e.location.search:a=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),r(a)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw Je(P6);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(r){throw this.logger.error("error opening popup "+r.message),this.browserStorage.setInteractionInProgress(!1),Je(I6)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:i}){var m,g,_,v;const o=i.screenLeft?i.screenLeft:i.screenX,s=i.screenTop?i.screenTop:i.screenY,a=i.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=i.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=(m=r.popupSize)==null?void 0:m.width,u=(g=r.popupSize)==null?void 0:g.height,h=(_=r.popupPosition)==null?void 0:_.top,f=(v=r.popupPosition)==null?void 0:v.left;return(!c||c<0||c>a)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),c=xo.POPUP_WIDTH),(!u||u<0||u>l)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),u=xo.POPUP_HEIGHT),(!h||h<0||h>l)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),h=Math.max(0,l/2-xo.POPUP_HEIGHT/2+s)),(!f||f<0||f>a)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),f=Math.max(0,a/2-xo.POPUP_WIDTH/2+o)),i.open(e,t,`width=${c}, height=${u}, top=${h}, left=${f}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(ut.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${xo.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${xo.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class bD{constructor(e,t,r,i,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=o}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(fn.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(fn.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const r={apiId:On.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};if(typeof t.onRedirectNavigate=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),t.onRedirectNavigate(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await t.navigationClient.navigateExternal(e,r);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await t.navigationClient.navigateExternal(e,r);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),Je(t1)}async handleCodeResponse(e,t){this.logger.verbose("RedirectHandler.handleCodeResponse called"),this.browserStorage.setInteractionInProgress(!1);const r=this.browserStorage.generateStateKey(t),i=this.browserStorage.getTemporaryCache(r);if(!i)throw Ae(qw,"Cached State");let o;try{o=this.authModule.handleFragmentResponse(e,i)}catch(c){throw c instanceof au&&c.subError===eh?Je(eh):c}const s=this.browserStorage.generateNonceKey(i),a=this.browserStorage.getTemporaryCache(s);if(this.authCodeRequest.code=o.code,o.cloud_instance_host_name&&await Ue(this.authModule.updateAuthority.bind(this.authModule),le.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,this.authCodeRequest.correlationId)(o.cloud_instance_host_name,this.authCodeRequest.correlationId),o.nonce=a||void 0,o.state=i,o.client_info)this.authCodeRequest.clientInfo=o.client_info;else{const c=this.checkCcsCredentials();c&&(this.authCodeRequest.ccsCredential=c)}const l=await this.authModule.acquireToken(this.authCodeRequest,o);return this.browserStorage.cleanRequestByState(t),l}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(fn.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class Vre extends zm{constructor(e,t,r,i,o,s,a,l,c,u){super(e,t,r,i,o,s,a,c,u),this.nativeStorage=l}async acquireToken(e){const t=await Ue(this.initializeAuthorizationRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,ut.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null);const r=this.initializeServerTelemetryManager(On.acquireTokenRedirect),i=o=>{o.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent(gt.RESTORE_FROM_BFCACHE,ut.Redirect))};try{const o=await Ue(this.initializeAuthorizationCodeRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(t),s=await Ue(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),a=new bD(s,this.browserStorage,o,this.logger,this.performanceClient),l=await s.getAuthCodeUrl({...t,nativeBroker:xa.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}),c=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${c}`),window.addEventListener("pageshow",i),await a.initiateAuthRequest(l,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:c,onRedirectNavigate:e.onRedirectNavigate||this.config.auth.onRedirectNavigate})}catch(o){throw o instanceof tr&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),window.removeEventListener("pageshow",i),this.browserStorage.cleanRequestByState(t.state),o}}async handleRedirectPromise(e="",t){const r=this.initializeServerTelemetryManager(On.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[i,o]=this.getRedirectResponse(e||"");if(!i)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(ut.Redirect),t.event.errorCode="no_server_response",null;const s=this.browserStorage.getTemporaryCache(fn.ORIGIN_URI,!0)||ge.EMPTY_STRING,a=Qt.removeHashFromUrl(s),l=Qt.removeHashFromUrl(window.location.href);if(a===l&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),s.indexOf("#")>-1&&nre(s),await this.handleResponse(i,r);if(this.config.auth.navigateToLoginRequestUrl){if(!OP()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(fn.URL_HASH,o,!0);const c={apiId:On.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let u=!0;if(!s||s==="null"){const h=ire();this.browserStorage.setTemporaryCache(fn.ORIGIN_URI,h,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),u=await this.navigationClient.navigateInternal(h,c)}else this.logger.verbose(`Navigating to loginRequestUrl: ${s}`),u=await this.navigationClient.navigateInternal(s,c);if(!u)return await this.handleResponse(i,r)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(i,r);return null}catch(i){throw i instanceof tr&&(i.setCorrelationId(this.correlationId),r.cacheFailedRequest(i)),this.browserStorage.cleanRequestByInteractionType(ut.Redirect),i}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===o_.QUERY?t=window.location.search:t=window.location.hash);let r=eS(t);if(r){try{zre(r,this.browserCrypto,ut.Redirect)}catch(o){return o instanceof tr&&this.logger.error(`Interaction type validation failed due to ${o.errorCode}: ${o.errorMessage}`),[null,""]}return tre(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}const i=this.browserStorage.getTemporaryCache(fn.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(fn.URL_HASH)),i&&(r=eS(i),r)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,i]):[null,""]}async handleResponse(e,t){const r=e.state;if(!r)throw Je(AP);const i=this.browserStorage.getCachedRequest(r);if(this.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw Je(s_);const l=new Np(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,On.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,e.accountId,this.nativeStorage,i.correlationId),{userRequestState:c}=Fs.parseRequestState(this.browserCrypto,r);return l.acquireToken({...i,state:c,prompt:void 0}).finally(()=>{this.browserStorage.cleanRequestByState(r)})}const o=this.browserStorage.getCachedAuthority(r);if(!o)throw Je(MP);const s=await Ue(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:o});return ga.removeThrottle(this.browserStorage,this.config.auth.clientId,i),new bD(s,this.browserStorage,i,this.logger,this.performanceClient).handleCodeResponse(e,r)}async logout(e){var i,o;this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(On.logout);try{this.eventHandler.emitEvent(gt.LOGOUT_START,ut.Redirect,e),await this.clearCacheOnLogout(t.account);const s={apiId:On.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=await Ue(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e==null?void 0:e.extraQueryParameters,account:e&&e.account||void 0});if(a.authority.protocolMode===gl.OIDC)try{a.authority.endSessionEndpoint}catch{if((i=t.account)!=null&&i.homeAccountId){this.browserStorage.removeAccount((o=t.account)==null?void 0:o.homeAccountId),this.eventHandler.emitEvent(gt.LOGOUT_SUCCESS,ut.Redirect,t);return}}const l=a.getLogoutUri(t);if(this.eventHandler.emitEvent(gt.LOGOUT_SUCCESS,ut.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(l)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,s);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,s);return}}catch(s){throw s instanceof tr&&(s.setCorrelationId(this.correlationId),r.cacheFailedRequest(s)),this.eventHandler.emitEvent(gt.LOGOUT_FAILURE,ut.Redirect,null,s),this.eventHandler.emitEvent(gt.LOGOUT_END,ut.Redirect),s}this.eventHandler.emitEvent(gt.LOGOUT_END,ut.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return Qt.getAbsoluteUrl(t,ul())}}/*! @azure/msal-browser v3.24.0 2024-09-20 */async function Gre(n,e,t,r,i){if(e.addQueueMeasurement(le.SilentHandlerInitiateAuthRequest,r),!n)throw t.info("Navigate url is empty"),Je(t1);return i?Ue($re,le.SilentHandlerLoadFrame,t,e,r)(n,i,e,r):gh(Yre,le.SilentHandlerLoadFrameSync,t,e,r)(n)}async function Wre(n,e,t,r,i,o,s){return r.addQueueMeasurement(le.SilentHandlerMonitorIframeForHash,o),new Promise((a,l)=>{e<HM&&i.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${HM}ms). This may result in timeouts.`);const c=window.setTimeout(()=>{window.clearInterval(u),l(Je(k6))},e),u=window.setInterval(()=>{let h="";const f=n.contentWindow;try{h=f?f.location.href:""}catch{}if(!h||h==="about:blank")return;let m="";f&&(s===o_.QUERY?m=f.location.search:m=f.location.hash),window.clearTimeout(c),window.clearInterval(u),a(m)},t)}).finally(()=>{gh(Kre,le.RemoveHiddenIframe,i,r,o)(n)})}function $re(n,e,t,r){return t.addQueueMeasurement(le.SilentHandlerLoadFrame,r),new Promise((i,o)=>{const s=hH();window.setTimeout(()=>{if(!s){o("Unable to load iframe");return}s.src=n,i(s)},e)})}function Yre(n){const e=hH();return e.src=n,e}function hH(){const n=document.createElement("iframe");return n.className="msalSilentIframe",n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(n),n}function Kre(n){document.body===n.parentNode&&document.body.removeChild(n)}/*! @azure/msal-browser v3.24.0 2024-09-20 */class Xre extends zm{constructor(e,t,r,i,o,s,a,l,c,u,h){super(e,t,r,i,o,s,l,u,h),this.apiId=a,this.nativeStorage=c}async acquireToken(e){this.performanceClient.addQueueMeasurement(le.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==Hr.NONE&&t.prompt!==Hr.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${Hr.NONE}`),t.prompt=Hr.NONE):t.prompt=Hr.NONE;const r=await Ue(this.initializeAuthorizationRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,ut.Silent);sH(r.authority);const i=this.initializeServerTelemetryManager(this.apiId);let o;try{return o=await Ue(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:i,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),await Ue(this.silentTokenHelper.bind(this),le.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(o,r)}catch(s){if(s instanceof tr&&(s.setCorrelationId(this.correlationId),i.cacheFailedRequest(s)),!o||!(s instanceof tr)||s.errorCode!==xo.INVALID_GRANT_ERROR)throw s;this.performanceClient.addFields({retryError:s.errorCode},this.correlationId);const a=await Ue(this.initializeAuthorizationRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,ut.Silent);return await Ue(this.silentTokenHelper.bind(this),le.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(o,a)}}logout(){return Promise.reject(Je(n1))}async silentTokenHelper(e,t){const r=t.correlationId;this.performanceClient.addQueueMeasurement(le.SilentIframeClientTokenHelper,r);const i=await Ue(this.initializeAuthorizationCodeRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,r)(t),o=await Ue(e.getAuthCodeUrl.bind(e),le.GetAuthCodeUrl,this.logger,this.performanceClient,r)({...t,nativeBroker:xa.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}),s=new jP(e,this.browserStorage,i,this.logger,this.performanceClient),a=await Ue(Gre,le.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(o,this.performanceClient,this.logger,r,this.config.system.navigateFrameWait),l=this.config.auth.OIDCOptions.serverResponseType,c=await Ue(Wre,le.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,r,l),u=gh(dH,le.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(c,l,this.logger);if(u.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw Je(s_);const h=new Np(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,u.accountId,this.browserStorage,r),{userRequestState:f}=Fs.parseRequestState(this.browserCrypto,t.state);return Ue(h.acquireToken.bind(h),le.NativeInteractionClientAcquireToken,this.logger,this.performanceClient,r)({...t,state:f,prompt:t.prompt||Hr.NONE})}return Ue(s.handleCodeResponse.bind(s),le.HandleCodeResponse,this.logger,this.performanceClient,r)(u,t)}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class qre extends zm{async acquireToken(e){this.performanceClient.addQueueMeasurement(le.SilentRefreshClientAcquireToken,e.correlationId);const t=await Ue(FP,le.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),r={...e,...t};e.redirectUri&&(r.redirectUri=this.getRedirectUri(e.redirectUri));const i=this.initializeServerTelemetryManager(On.acquireTokenSilent_silentFlow),o=await this.createRefreshTokenClient({serverTelemetryManager:i,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return Ue(o.acquireTokenByRefreshToken.bind(o),le.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(r).catch(s=>{throw s.setCorrelationId(this.correlationId),i.cacheFailedRequest(s),s})}logout(){return Promise.reject(Je(n1))}async createRefreshTokenClient(e){const t=await Ue(this.getClientConfiguration.bind(this),le.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new FM(t,this.performanceClient)}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class Qre{constructor(e,t,r,i){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=i}loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw Je(RP);const i=t.id_token?mh(t.id_token,Ca):void 0,o={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},s=e.authority?new hi(hi.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,o,this.logger,e.correlationId||kl()):void 0,a=this.loadAccount(e,r.clientInfo||t.client_info||"",i,s),l=this.loadIdToken(t,a.homeAccountId,a.environment,a.realm),c=this.loadAccessToken(e,t,a.homeAccountId,a.environment,a.realm,r),u=this.loadRefreshToken(t,a.homeAccountId,a.environment);return this.generateAuthenticationResult(e,{account:a,idToken:l,accessToken:c,refreshToken:u},i,s)}loadAccount(e,t,r,i){if(this.logger.verbose("TokenCache - loading account"),e.account){const l=Pr.createFromAccountInfo(e.account);return this.storage.setAccount(l),l}else if(!i||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),Je(H6);const o=Pr.generateHomeAccountId(t,i.authorityType,this.logger,this.cryptoObj,r),s=r==null?void 0:r.tid,a=EP(this.storage,i,o,Ca,r,t,i.hostnameAndPort,s,void 0,void 0,this.logger);return this.storage.setAccount(a),a}loadIdToken(e,t,r,i){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const o=qE(t,r,e.id_token,this.config.auth.clientId,i);return this.storage.setIdTokenCredential(o),o}loadAccessToken(e,t,r,i,o,s){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");const a=t.scope?fr.fromString(t.scope):new fr(e.scopes),l=s.expiresOn||t.expires_in+new Date().getTime()/1e3,c=s.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+new Date().getTime()/1e3,u=QE(r,i,t.access_token,this.config.auth.clientId,o,a.printScopes(),l,c,Ca);return this.storage.setAccessTokenCredential(u),u}loadRefreshToken(e,t,r){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const i=qz(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return this.storage.setRefreshTokenCredential(i),i}generateAuthenticationResult(e,t,r,i){var u,h,f;let o="",s=[],a=null,l;t!=null&&t.accessToken&&(o=t.accessToken.secret,s=fr.fromString(t.accessToken.target).asArray(),a=new Date(Number(t.accessToken.expiresOn)*1e3),l=new Date(Number(t.accessToken.extendedExpiresOn)*1e3));const c=t.account;return{authority:i?i.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:s,account:c.getAccountInfo(),idToken:((u=t.idToken)==null?void 0:u.secret)||"",idTokenClaims:r||{},accessToken:o,fromCache:!0,expiresOn:a,correlationId:e.correlationId||"",requestId:"",extExpiresOn:l,familyId:((h=t.refreshToken)==null?void 0:h.familyId)||"",tokenType:((f=t==null?void 0:t.accessToken)==null?void 0:f.tokenType)||"",state:e.state||"",cloudGraphHostName:c.cloudGraphHostName||"",msGraphHost:c.msGraphHost||"",fromNativeBroker:!1}}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class Zre extends w6{constructor(e){super(e),this.includeRedirectUri=!1}}/*! @azure/msal-browser v3.24.0 2024-09-20 */class Jre extends zm{constructor(e,t,r,i,o,s,a,l,c,u){super(e,t,r,i,o,s,l,c,u),this.apiId=a}async acquireToken(e){if(!e.code)throw Je(V6);const t=await Ue(this.initializeAuthorizationRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,ut.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{const i={...t,code:e.code},o=await Ue(this.getClientConfiguration.bind(this),le.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),s=new Zre(o);this.logger.verbose("Auth code client created");const a=new jP(s,this.browserStorage,i,this.logger,this.performanceClient);return await Ue(a.handleCodeResponseFromServer.bind(a),le.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(i){throw i instanceof tr&&(i.setCorrelationId(this.correlationId),r.cacheFailedRequest(i)),i}}logout(){return Promise.reject(Je(n1))}}/*! @azure/msal-browser v3.24.0 2024-09-20 */function ea(n){const e=n==null?void 0:n.idTokenClaims;if(e!=null&&e.tfp||e!=null&&e.acr)return"B2C";if(e!=null&&e.tid){if((e==null?void 0:e.tid)==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}function bx(n,e){try{DP(n)}catch(t){throw e.end({success:!1},t),t}}class o1{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new gm(this.logger,this.performanceClient):Qw,this.eventHandler=new bre(this.logger,this.browserCrypto),this.browserStorage=this.isBrowserEnvironment?new GM(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,yne(this.config.auth),this.performanceClient):_re(this.config.auth.clientId,this.logger);const t={cacheLocation:xr.MemoryStorage,temporaryCacheLocation:xr.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new GM(this.config.auth.clientId,t,this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new Qre(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const r=new o1(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}const t=(e==null?void 0:e.correlationId)||this.getRequestCorrelationId(),r=this.config.system.allowNativeBroker,i=this.performanceClient.startMeasurement(le.InitializeClientApplication,t);if(this.eventHandler.emitEvent(gt.INITIALIZE_START),r)try{this.nativeExtensionProvider=await xa.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(o){this.logger.verbose(o)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),await Ue(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),le.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,t)(this.performanceClient,t)),this.initialized=!0,this.eventHandler.emitEvent(gt.INITIALIZE_END),i.end({allowNativeBroker:r,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),oH(this.initialized),this.isBrowserEnvironment){const t=e||"";let r=this.redirectResponse.get(t);return typeof r>"u"?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){const t=this.getAllAccounts(),r=this.browserStorage.getCachedNativeRequest(),i=r&&xa.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e,o=i?r==null?void 0:r.correlationId:this.browserStorage.getTemporaryCache(fn.CORRELATION_ID,!0)||"",s=this.performanceClient.startMeasurement(le.AcquireTokenRedirect,o);this.eventHandler.emitEvent(gt.HANDLE_REDIRECT_START,ut.Redirect);let a;if(i&&this.nativeExtensionProvider){this.logger.trace("handleRedirectPromise - acquiring token from native platform");const l=new Np(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,On.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,r.accountId,this.nativeInternalStorage,r.correlationId);a=Ue(l.handleRedirectPromise.bind(l),le.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,s.event.correlationId)(this.performanceClient,s.event.correlationId)}else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");const l=this.createRedirectClient(o);a=Ue(l.handleRedirectPromise.bind(l),le.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,s.event.correlationId)(e,s)}return a.then(l=>(l?(t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(gt.LOGIN_SUCCESS,ut.Redirect,l),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_SUCCESS,ut.Redirect,l),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),s.end({success:!0,accountType:ea(l.account)})):s.event.errorCode?s.end({success:!1}):s.discard(),this.eventHandler.emitEvent(gt.HANDLE_REDIRECT_END,ut.Redirect),l)).catch(l=>{const c=l;throw t.length>0?this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_FAILURE,ut.Redirect,null,c):this.eventHandler.emitEvent(gt.LOGIN_FAILURE,ut.Redirect,null,c),this.eventHandler.emitEvent(gt.HANDLE_REDIRECT_END,ut.Redirect),s.end({success:!1},c),l})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const r=this.performanceClient.startMeasurement(le.AcquireTokenPreRedirect,t);r.add({accountType:ea(e.account),scenarioId:e.scenarioId});const i=e.onRedirectNavigate;if(i)e.onRedirectNavigate=s=>{const a=typeof i=="function"?i(s):void 0;return a!==!1?r.end({success:!0}):r.discard(),a};else{const s=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=a=>{const l=typeof s=="function"?s(a):void 0;return l!==!1?r.end({success:!0}):r.discard(),l}}const o=this.getAllAccounts().length>0;try{ED(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),o?this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_START,ut.Redirect,e):this.eventHandler.emitEvent(gt.LOGIN_START,ut.Redirect,e);let s;return this.nativeExtensionProvider&&this.canUseNative(e)?s=new Np(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,On.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch(l=>{if(l instanceof va&&kf(l))return this.nativeExtensionProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(l instanceof Hs)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),l}):s=this.createRedirectClient(t).acquireToken(e),await s}catch(s){throw r.end({success:!1},s),o?this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_FAILURE,ut.Redirect,null,s):this.eventHandler.emitEvent(gt.LOGIN_FAILURE,ut.Redirect,null,s),s}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(le.AcquireTokenPopup,t);r.add({scenarioId:e.scenarioId,accountType:ea(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),bx(this.initialized,r),this.browserStorage.setInteractionInProgress(!0)}catch(s){return Promise.reject(s)}const i=this.getAllAccounts();i.length>0?this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_START,ut.Popup,e):this.eventHandler.emitEvent(gt.LOGIN_START,ut.Popup,e);let o;return this.canUseNative(e)?o=this.acquireTokenNative({...e,correlationId:t},On.acquireTokenPopup).then(s=>(this.browserStorage.setInteractionInProgress(!1),r.end({success:!0,isNativeBroker:!0,requestId:s.requestId,accountType:ea(s.account)}),s)).catch(s=>{if(s instanceof va&&kf(s))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(s instanceof Hs)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),s}):o=this.createPopupClient(t).acquireToken(e),o.then(s=>(i.length<this.getAllAccounts().length?this.eventHandler.emitEvent(gt.LOGIN_SUCCESS,ut.Popup,s):this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_SUCCESS,ut.Popup,s),r.end({success:!0,requestId:s.requestId,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:ea(s.account)}),s)).catch(s=>(i.length>0?this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_FAILURE,ut.Popup,null,s):this.eventHandler.emitEvent(gt.LOGIN_FAILURE,ut.Popup,null,s),r.end({success:!1},s),Promise.reject(s)))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){var o,s;const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(le.SsoSilent,t),(o=this.ssoSilentMeasurement)==null||o.add({scenarioId:e.scenarioId,accountType:ea(e.account)}),bx(this.initialized,this.ssoSilentMeasurement),(s=this.ssoSilentMeasurement)==null||s.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(gt.SSO_SILENT_START,ut.Silent,r);let i;return this.canUseNative(r)?i=this.acquireTokenNative(r,On.ssoSilent).catch(a=>{if(a instanceof va&&kf(a))return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw a}):i=this.createSilentIframeClient(r.correlationId).acquireToken(r),i.then(a=>{var l;return this.eventHandler.emitEvent(gt.SSO_SILENT_SUCCESS,ut.Silent,a),(l=this.ssoSilentMeasurement)==null||l.end({success:!0,isNativeBroker:a.fromNativeBroker,requestId:a.requestId,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:ea(a.account)}),a}).catch(a=>{var l;throw this.eventHandler.emitEvent(gt.SSO_SILENT_FAILURE,ut.Silent,null,a),(l=this.ssoSilentMeasurement)==null||l.end({success:!1},a),a}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const r=this.performanceClient.startMeasurement(le.AcquireTokenByCode,t);bx(this.initialized,r),this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_BY_CODE_START,ut.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw Je(W6);if(e.code){const i=e.code;let o=this.hybridAuthCodeResponses.get(i);return o?(this.logger.verbose("Existing acquireTokenByCode request found",t),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),o=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(s=>(this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_BY_CODE_SUCCESS,ut.Silent,s),this.hybridAuthCodeResponses.delete(i),r.end({success:!0,isNativeBroker:s.fromNativeBroker,requestId:s.requestId,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:ea(s.account)}),s)).catch(s=>{throw this.hybridAuthCodeResponses.delete(i),this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_BY_CODE_FAILURE,ut.Silent,null,s),r.end({success:!1},s),s}),this.hybridAuthCodeResponses.set(i,o)),await o}else if(e.nativeAccountId)if(this.canUseNative(e,e.nativeAccountId)){const i=await this.acquireTokenNative({...e,correlationId:t},On.acquireTokenByCode,e.nativeAccountId).catch(o=>{throw o instanceof va&&kf(o)&&(this.nativeExtensionProvider=void 0),o});return r.end({accountType:ea(i.account),success:!0}),i}else throw Je($6);else throw Je(G6)}catch(i){throw this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_BY_CODE_FAILURE,ut.Silent,null,i),r.end({success:!1},i),i}}async acquireTokenByCodeAsync(e){var i;return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(le.AcquireTokenByCodeAsync,e.correlationId),(i=this.acquireTokenByCodeAsyncMeasurement)==null||i.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(o=>{var s;return(s=this.acquireTokenByCodeAsyncMeasurement)==null||s.end({success:!0,fromCache:o.fromCache,isNativeBroker:o.fromNativeBroker,requestId:o.requestId}),o}).catch(o=>{var s;throw(s=this.acquireTokenByCodeAsyncMeasurement)==null||s.end({success:!1},o),o}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(le.AcquireTokenFromCache,e.correlationId),t){case po.Default:case po.AccessToken:case po.AccessTokenAndRefreshToken:const r=this.createSilentCacheClient(e.correlationId);return Ue(r.acquireToken.bind(r),le.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw Ae(cl)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(le.AcquireTokenByRefreshToken,e.correlationId),t){case po.Default:case po.AccessTokenAndRefreshToken:case po.RefreshToken:case po.RefreshTokenAndNetwork:const r=this.createSilentRefreshClient(e.correlationId);return Ue(r.acquireToken.bind(r),le.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw Ae(cl)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(le.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return Ue(t.acquireToken.bind(t),le.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return ED(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return DP(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(t){return Promise.reject(t)}}async clearCache(e){const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return xre(this.logger,this.browserStorage,this.isBrowserEnvironment,e)}getAccount(e){return yre(e,this.logger,this.browserStorage)}getAccountByUsername(e){return wre(e,this.logger,this.browserStorage)}getAccountByHomeId(e){return Sre(e,this.logger,this.browserStorage)}getAccountByLocalId(e){return Ere(e,this.logger,this.browserStorage)}setActiveAccount(e){Tre(e,this.browserStorage)}getActiveAccount(){return Cre(this.browserStorage)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=Pr.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return this.browserStorage.setAccount(r),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw Je(s_);return new Np(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!xa.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case Hr.NONE:case Hr.CONSENT:case Hr.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Hre(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new Vre(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new Xre(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,On.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new uH(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new qre(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new Jre(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,On.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e){return this.eventHandler.addEventCallback(e)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){this.eventHandler.enableAccountStorageEvents()}disableAccountStorageEvents(){this.eventHandler.disableAccountStorageEvents()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getEventHandler(){return this.eventHandler}getRequestCorrelationId(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?kl():ge.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||yD})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||yD})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(le.AcquireTokenSilent,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),bx(this.initialized,r),this.logger.verbose("acquireTokenSilent called",t);const i=e.account||this.getActiveAccount();if(!i)throw Je(U6);r.add({accountType:ea(i)});const o={clientId:this.config.auth.clientId,authority:e.authority||ge.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:i.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},s=JSON.stringify(o),a=this.activeSilentTokenRequests.get(s);if(typeof a>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t);const l=Ue(this.acquireTokenSilentAsync.bind(this),le.AcquireTokenSilentAsync,this.logger,this.performanceClient,t)({...e,correlationId:t},i).then(c=>(this.activeSilentTokenRequests.delete(s),r.end({success:!0,fromCache:c.fromCache,isNativeBroker:c.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,requestId:c.requestId,accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length}),c)).catch(c=>{throw this.activeSilentTokenRequests.delete(s),r.end({success:!1},c),c});return this.activeSilentTokenRequests.set(s,l),{...await l,state:e.state}}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),r.discard(),{...await a,state:e.state}}async acquireTokenSilentAsync(e,t){const r=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(le.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_START,ut.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const i=await Ue(Ire,le.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),o=e.cacheLookupPolicy||po.Default;return this.acquireTokenSilentNoIframe(i,o).catch(async a=>{if(eie(a,o))if(this.activeIframeRequest)if(o!==po.Skip){const[c,u]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${u}`,i.correlationId);const h=this.performanceClient.startMeasurement(le.AwaitConcurrentIframe,i.correlationId);h.add({awaitIframeCorrelationId:u});const f=await c;if(h.end({success:f}),f)return this.logger.verbose(`Parallel iframe request with correlationId: ${u} succeeded. Retrying cache and/or RT redemption`,i.correlationId),this.acquireTokenSilentNoIframe(i,o);throw this.logger.info(`Iframe request with correlationId: ${u} failed. Interaction is required.`),a}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",i.correlationId),Ue(this.acquireTokenBySilentIframe.bind(this),le.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i);else{let c;return this.activeIframeRequest=[new Promise(u=>{c=u}),i.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",i.correlationId),Ue(this.acquireTokenBySilentIframe.bind(this),le.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i).then(u=>(c(!0),u)).catch(u=>{throw c(!1),u}).finally(()=>{this.activeIframeRequest=void 0})}else throw a}).then(a=>(this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_SUCCESS,ut.Silent,a),e.correlationId&&this.performanceClient.addFields({fromCache:a.fromCache,isNativeBroker:a.fromNativeBroker,requestId:a.requestId},e.correlationId),a)).catch(a=>{throw this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_FAILURE,ut.Silent,null,a),a}).finally(()=>{document.removeEventListener("visibilitychange",r)})}async acquireTokenSilentNoIframe(e,t){return xa.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.acquireTokenNative(e,On.acquireTokenSilent_silentFlow).catch(async r=>{throw r instanceof va&&kf(r)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,Ae(cl)):r})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),Ue(this.acquireTokenFromCache.bind(this),le.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(r=>{if(t===po.AccessToken)throw r;return this.eventHandler.emitEvent(gt.ACQUIRE_TOKEN_NETWORK_START,ut.Silent,e),Ue(this.acquireTokenByRefreshToken.bind(this),le.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}}function eie(n,e){const t=!(n instanceof Hs&&n.subError!==e1),r=n.errorCode===xo.INVALID_GRANT_ERROR||n.errorCode===cl,i=t&&r||n.errorCode===nS||n.errorCode===SP,o=Gne.includes(e);return i&&o}/*! @azure/msal-browser v3.24.0 2024-09-20 */async function tie(n,e){const t=new th(n);return await t.initialize(),o1.createController(t,e)}/*! @azure/msal-browser v3.24.0 2024-09-20 */class BP{static async createPublicClientApplication(e){const t=await tie(e);return new BP(e,t)}constructor(e,t){this.controller=t||new o1(new th(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e){return this.controller.addEventCallback(e)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}async function s1(){return{scopes:[(await Ua()).ENV__AZURE_SCOPE]}}const By="MSAL_COUNT_ERROR";async function $M(n,e,t){console.log(n);const r=parseInt(localStorage.getItem(By)||"0");if(r>1){localStorage.setItem(By,"0"),console.error("ERROR MSAL CONFIG IN ENDLESS ERROR LOOP");return}else localStorage.setItem(By,(r+1).toString());if(n.errorCode==="invalid_grant"){await e.acquireTokenRedirect(t);return}if(n.errorCode==="no_tokens_found"&&await e.loginRedirect(t),n.errorCode==="monitor_window_timeout"){await e.loginRedirect(t);return}if(n.errorCode==="consent_required"){await e.loginRedirect(t);return}if(n.errorCode==="interaction_required"){await e.loginRedirect(t);return}if(n.errorCode==="login_required"){await e.loginRedirect(t);return}if(n.errorCode==="no_account_error"){await e.loginRedirect(t);return}console.error(n)}let bC,Bo;async function Ip(){return new Promise(async n=>{if(bC)n(Bo);else{const e=await s1(),t=await Ua(!0);bC={auth:{clientId:t.ENV__AZURE_CLIENT_ID,authority:`${t.ENV__AZURE_LOGIN_URL}/${t.ENV__AZURE_TENANT_ID}/`,redirectUri:"/",postLogoutRedirectUri:"/"},cache:{cacheLocation:xr.LocalStorage},system:{windowHashTimeout:1500,iframeHashTimeout:1500,loadFrameTimeout:1500}},Bo=new BP(bC),await Bo.initialize(),Bo.addEventCallback(i=>{if(i.eventType===gt.LOGIN_SUCCESS&&i.payload){const s=i.payload.account;Bo.setActiveAccount(s)}return null}),await Bo.handleRedirectPromise().then(()=>{Bo.getActiveAccount()||$M({errorCode:"no_account_error"},Bo,e)}).catch(async i=>{await $M(i,Bo,e)}),Bo.getActiveAccount()?n(Bo):Bo.loginRedirect(e)}})}async function fH(){try{const n=await Ip(),e=await s1(),t=await n.acquireTokenSilent({scopes:e.scopes,forceRefresh:Az()}).then(function(r){return localStorage.setItem(By,"0"),r}).catch(async r=>{await $M(r,n,e)});return t==null?void 0:t.accessToken}catch(n){Fn.setState({header:"login",message:n==null?void 0:n.errorMessage})}return""}const YM=new Map,nie=15*60*1e3;async function Ll(n){try{const e=YM.get(n);if(e){const s=new Date,a=new Date(s.valueOf()+nie);if(new Date(e.expire).getTime()>a.getTime())return{success:!0,data:e,message:""}}const t=await fH(),r=await Ua(),o=await(await fetch(`${r.ENV__SAS_GENERATOR_API_URL}/api/default_container/${n}`,{headers:{authorization:`Bearer ${t}`}})).json();return o.success&&o.data&&YM.set(n,o.data),o}catch(e){return{success:!1,data:null,message:e}}}function rie(){YM.clear()}async function zP(n,e,t,r,i){var l;const o=new Oi("ALL_PROJECTS"),s=await Ll(n),a=await Id(((l=s.data)==null?void 0:l.token)||"no-sas-access",n,e,!0).catch(c=>{console.log(`No access to ${e} in container ${n} - ${c}`)});if(a!=null&&a.model_data){if(a.plant_code=r,a.plant_name=i,a.project_key=t,a.container=n,a.model_layer||(a.model_layer=[{name:"ALL_SITES",description:"All sites",groups:[],loadGroups:[]}]),a.model_layer.sort((c,u)=>{const h=c.description+c.description,f=u.description+u.description;return h<f?-1:h>f?1:0}),GN&&location.origin.includes("localhost")){const c={dialogHeader:"localhost:2080 /tool-ext-detail/",tabButtonName:"localhost:2080 /tool-ext-detail/",right:0,width:600,height:500,bottom:170,url:"http://localhost:2080/tool-ext-detail/",urlProd:"http://localhost:2080/tool-ext-detail/",urlTest:"http://localhost:2080/tool-ext-detail/",urlBeta:"http://localhost:2080/tool-ext-detail/",allowExternal:!0},u={dialogHeader:"localhost:2080 /tool-ext-reports/",tabButtonName:"localhost:2080 /tool-ext-reports/",right:0,width:600,height:500,bottom:170,url:"http://localhost:2080/tool-ext-reports/",urlProd:"http://localhost:2080/tool-ext-reports/",urlTest:"http://localhost:2080/tool-ext-reports/",urlBeta:"http://localhost:2080/tool-ext-reports/",allowExternal:!0},h={dialogHeader:"localhost:2080 /tool-ext-dolwin-cable/",tabButtonName:"localhost:2080 /tool-ext-dolwin-cable/",right:0,width:600,height:500,bottom:170,url:"http://localhost:2080/tool-ext-dolwin-cable/",urlProd:"http://localhost:2080/tool-ext-dolwin-cable/",urlTest:"http://localhost:2080/tool-ext-dolwin-cable/",urlBeta:"http://localhost:2080/tool-ext-dolwin-cable/",allowExternal:!0},f={dialogHeader:"localhost:2080 /tool-ext-cable/",tabButtonName:"localhost:2080 /tool-ext-cable/",right:0,width:600,height:500,bottom:170,url:"http://localhost:2080/tool-ext-cable/",urlProd:"http://localhost:2080/tool-ext-cable/",urlTest:"http://localhost:2080/tool-ext-cable/",urlBeta:"http://localhost:2080/tool-ext-cable/",data:{routingData:"https://web-report.tapps.aibel.net/pacs/api/WEBREPORTADM/WEB_008089_ROUTE_MODULE",segmentData:""},allowExternal:!1};a.tools?(a.tools.dev1=c,a.tools.dev2=u,a.tools.dev3=h,a.tools.dev4=f):a.tools={dev1:c,dev2:u,dev3:h,dev4:f}}return await o.setJsonKey("PROJECT"+n+e,a),a}else return null}/*! https://github.com/nevware21/ts-utils v0.11.4 */function Gl(n,e){return n||e}function Ji(n,e){return n[e]}var yo=void 0,Ir=null,HP="",a1="function",l_="object",vl="prototype",KM="__proto__",vd="undefined",aS="constructor",VP="Symbol",iie="_polyfill",Pp="length",lS="name",ei="call",l1="toString",Ys=Gl(Object),GP=Ji(Ys,vl),pH=Gl(String),vh=Ji(pH,vl),oie=Gl(Math),mH=Gl(Array),c1=Ji(mH,vl),Ol=Ji(c1,"slice");function Gr(n,e){try{return{v:n.apply(this,e)}}catch(t){return{e:t}}}function sie(n,e){var t=Gr(n);return t.e?e:t.v}var AC;function u1(n){return function(e){return typeof e===n}}function gH(n){var e="[object "+n+"]";return function(t){return!!(t&&aie(t)===e)}}function aie(n){return GP[l1].call(n)}function Zn(n){return typeof n===vd||n===vd}function lie(n){return!WP(n)}function Me(n){return n===Ir||Zn(n)}function cie(n){return n===Ir||!WP(n)}function WP(n){return!!n||n!==yo}function uie(n){return!AC&&(AC=["string","number","boolean",vd,"symbol","bigint"]),n!==l_&&AC.indexOf(n)!==-1}var ht=u1("string"),Mt=u1(a1);function Zi(n){return!n&&Me(n)?!1:!!n&&typeof n===l_}var Ft=Ji(mH,"isArray"),die=gH("Date"),c_=u1("number"),vH=u1("boolean"),$P=gH("Error");function _l(n){return!!(n&&n.then&&Mt(n.then))}function cS(n){return!(!n||sie(function(){return!(n&&0+n)},!n))}var YP=Ji(Ys,"getOwnPropertyDescriptor");function as(n,e){return!!n&&GP.hasOwnProperty[ei](n,e)}var Qc=Gl(Ji(Ys,"hasOwn"),hie);function hie(n,e){return as(n,e)||!!YP(n,e)}function zt(n,e,t){if(n&&Zi(n)){for(var r in n)if(Qc(n,r)&&e[ei](n,r,n[r])===-1)break}}var Ax={e:"enumerable",c:"configurable",v:"value",w:"writable",g:"get",s:"set"};function fie(n){var e={};if(e[Ax.c]=!0,e[Ax.e]=!0,n.l){e.get=function(){return n.l.v};var t=YP(n.l,"v");t&&t.set&&(e.set=function(r){n.l.v=r})}return zt(n,function(r,i){e[Ax[r]]=lie(i)?e[Ax[r]]:i}),e}var Dl=Ji(Ys,"defineProperty");function en(n,e,t){return Dl(n,e,fie(t))}function _H(n,e,t,r,i){var o={};return zt(n,function(s,a){uS(o,s,e?a:s,i),uS(o,a,s,i)}),r?r(o):o}function uS(n,e,t,r){Dl(n,e,{value:t,enumerable:!0,writable:!!r})}var $i=Gl(pH),pie="[object Error]";function qe(n,e){var t=HP,r=GP[l1][ei](n);r===pie&&(n={stack:$i(n.stack),message:$i(n.message),name:$i(n.name)});try{t=JSON.stringify(n,Ir,e?typeof e=="number"?e:4:yo),t=(t?t.replace(/"(\w+)"\s*:\s{0,1}/g,"$1: "):Ir)||$i(n)}catch(i){t=" - "+qe(i,e)}return r+": "+t}function vo(n){throw new Error(n)}function Ks(n){throw new TypeError(n)}var xH=Ji(Ys,"freeze");function mie(n){return n}function gie(n){return n[KM]||Ir}var XM=Ji(Ys,"assign"),xl=Ji(Ys,"keys");function Hm(n){return xH&&zt(n,function(e,t){(Ft(t)||Zi(t))&&Hm(t)}),Ul(n)}var Ul=Gl(xH,mie),qM=Gl(Ji(Ys,"getPrototypeOf"),gie);function vie(n){return _H(n,1,0,Ul)}function _ie(n){return _H(n,0,0,Ul)}function xie(n){var e={};return zt(n,function(t,r){uS(e,t,r[1]),uS(e,r[0],r[1])}),Ul(e)}function yie(n){return xie(n)}var yH=_ie({asyncIterator:0,hasInstance:1,isConcatSpreadable:2,iterator:3,match:4,matchAll:5,replace:6,search:7,species:8,split:9,toPrimitive:10,toStringTag:11,unscopables:12}),AD="__tsUtils$gblCfg",MC;function wH(){var n;return typeof globalThis!==vd&&(n=globalThis),!n&&typeof self!==vd&&(n=self),!n&&typeof window!==vd&&(n=window),!n&&typeof global!==vd&&(n=global),n}function SH(){if(!MC){var n=Gr(wH).v||{};MC=n[AD]=n[AD]||{}}return MC}var _h=d1;function d1(n,e,t){var r=e?e[n]:Ir;return function(i){var o=(i?i[n]:Ir)||r;if(o||t){var s=arguments;return(o||t).apply(i,o?Ol[ei](s,1):s)}Ks('"'+$i(n)+'" not defined for '+qe(i))}}function wie(n){return function(e){return e[n]}}var Sie=Ji(oie,"max"),MD=_h("slice",vh),Fa=_h("substring",vh),bc=d1("substr",vh,Eie);function Eie(n,e,t){return Me(n)&&Ks("Invalid "+qe(n)),t<0?HP:(e=e||0,e<0&&(e=Sie(e+n[Pp],0)),Zn(t)?MD(n,e):MD(n,e,e+t))}function KP(n,e){return Fa(n,0,e)}var RD="_urid",RC;function Tie(){if(!RC){var n=SH();RC=n.gblSym=n.gblSym||{k:{},s:{}}}return RC}var Mx;function XP(n){var e={description:$i(n),toString:function(){return VP+"("+n+")"}};return e[iie]=!0,e}function Cie(n){var e=Tie();if(!Qc(e.k,n)){var t=XP(n),r=xl(e.s).length;t[RD]=function(){return r+"_"+t[l1]()},e.k[n]=t,e.s[t[RD]()]=$i(n)}return e.k[n]}function bie(n){!Mx&&(Mx={});var e,t=yH[n];return t&&(e=Mx[t]=Mx[t]||XP(VP+"."+t)),e}var Sr;function wu(){Sr=SH()}function Aie(n){var e={};return!Sr&&wu(),e.b=Sr.lzy,Dl(e,"v",{configurable:!0,get:function(){var t=n();return Sr.lzy||Dl(e,"v",{value:t}),e.b=Sr.lzy,t}}),e}function hs(n){return Dl({toJSON:function(){return n}},"v",{value:n})}var EH="window",B0;function Vm(n,e){var t;return function(){return!Sr&&wu(),(!t||Sr.lzy)&&(t=hs(Gr(n,e).v)),t.v}}function rs(n){return!Sr&&wu(),(!B0||n===!1||Sr.lzy)&&(B0=hs(Gr(wH).v||Ir)),B0.v}function or(n,e){var t;if(!B0||e===!1?t=rs(e):t=B0.v,t&&t[n])return t[n];if(n===EH)try{return window}catch{}return Ir}function TH(){return!!Qr()}var Qr=Vm(or,["document"]);function h1(){return!!Mo()}var Mo=Vm(or,[EH]);function Mie(){return!!ja()}var ja=Vm(or,["navigator"]);function Rie(){return!!CH()}var CH=Vm(or,["history"]),Nie=Vm(function(){return!!Gr(function(){return process&&(process.versions||{}).node}).v}),bH=Vm(function(){return!!Gr(function(){return self&&self instanceof WorkerGlobalScope}).v}),vm,NC;function f1(){return vm=hs(Gr(or,[VP]).v),vm}function Iie(n){var e=(Sr.lzy?0:vm)||f1();return e.v?e.v[n]:yo}function Pie(){return!!kie()}function kie(){return!Sr&&wu(),((Sr.lzy?0:vm)||f1()).v}function qP(n,e){var t=yH[n];!Sr&&wu();var r=(Sr.lzy?0:vm)||f1();return r.v?r.v[t||n]:bie(n)}function xg(n,e){!Sr&&wu();var t=(Sr.lzy?0:vm)||f1();return t.v?t.v(n):XP(n)}function QP(n){return!Sr&&wu(),NC=(Sr.lzy?0:NC)||hs(Gr(Iie,["for"]).v),(NC.v||Cie)(n)}function QM(n){return!!n&&Mt(n.next)}function AH(n){return!cie(n)&&Mt(n[qP(3)])}var Rx;function ZP(n,e,t){if(n&&(QM(n)||(!Rx&&(Rx=hs(qP(3))),n=n[Rx.v]?n[Rx.v]():Ir),QM(n))){var r=yo,i=yo;try{for(var o=0;!(i=n.next()).done&&e[ei](t||n,i.value,o,n)!==-1;)o++}catch(s){r={e:s},n.throw&&(i=Ir,n.throw(r))}finally{try{i&&!i.done&&n.return&&n.return(i)}finally{if(r)throw r.e}}}}function cp(n,e,t){return n.apply(e,t)}function up(n,e){return!Zn(e)&&n&&(Ft(e)?cp(n.push,n,e):QM(e)||AH(e)?ZP(e,function(t){n.push(t)}):n.push(e)),n}function Ye(n,e,t){if(n)for(var r=n[Pp]>>>0,i=0;i<r&&!(i in n&&e[ei](n,n[i],i,n)===-1);i++);}var xi=_h("indexOf",c1),z0=_h("map",c1);function p1(n,e,t){return((n?n.slice:Ir)||Ol).apply(n,Ol[ei](arguments,1))}var Lie=_h("reduce",c1),lu=Gl(Ji(Ys,"create"),Oie);function Oie(n){if(!n)return{};var e=typeof n;e!==l_&&e!==a1&&Ks("Prototype must be an Object or function: "+qe(n));function t(){}return t[vl]=n,new t}var IC;function MH(n,e){var t=Ys.setPrototypeOf||function(r,i){var o;!IC&&(IC=hs((o={},o[KM]=[],o instanceof Array))),IC.v?r[KM]=i:zt(i,function(s,a){return r[s]=a})};return t(n,e)}function Die(n,e,t){Gr(en,[e,lS,{v:n,c:!0,e:!1}]),e=MH(e,t);function r(){this[aS]=e,Gr(en,[this,lS,{v:n,c:!0,e:!1}])}return e[vl]=t===Ir?lu(t):(r[vl]=t[vl],new r),e}function ND(n,e){e&&(n[lS]=e)}function RH(n,e,t){var r=Error,i=r[vl][lS],o=Error.captureStackTrace;return Die(n,function(){var s=this,a=arguments;try{Gr(ND,[r,n]);var l=cp(r,s,Ol[ei](a))||s;if(l!==s){var c=qM(s);c!==qM(l)&&MH(l,c)}return o&&o(l,s[aS]),e&&e(l,a),l}finally{Gr(ND,[r,i])}},r)}var PC;function Uie(n){throw PC||(PC=RH("UnsupportedError")),new PC(n)}function Pa(){return(Date.now||Fie)()}function Fie(){return new Date().getTime()}function jie(n){return function(t){return Me(t)&&Ks("strTrim called ["+qe(t)+"]"),t&&t.replace&&(t=t.replace(n,HP)),t}}var Bie=jie(/^\s+|(?=\s)\s+$/g),Er=d1("trim",vh,Bie),kC,LC,OC;function Ni(n){if(!n||typeof n!==l_)return!1;OC||(OC=h1()?Mo():!0);var e=!1;if(n!==OC){LC||(kC=Function[vl][l1],LC=kC[ei](Ys));try{var t=qM(n);e=!t,e||(as(t,aS)&&(t=t[aS]),e=!!(t&&typeof t===a1&&kC[ei](t)===LC))}catch{}}return e}function zie(n){return n.value&&IH(n),!0}var ID=[Wie,IH,Yie,$ie];function Hie(n,e,t,r){var i;return Ye(n,function(o){if(o.k===e)return i=o,-1}),i||(i={k:e,v:e},n.push(i),r(i)),i.v}function JP(n,e,t,r){var i=t.handler,o=t.path?r?t.path.concat(r):t.path:[],s={handler:t.handler,src:t.src,path:o},a=typeof e,l=!1,c=e===Ir;c||(e&&a===l_?l=Ni(e):c=uie(a));var u={type:a,isPrim:c,isPlain:l,value:e,result:e,path:o,origin:t.src,copy:function(h,f){return JP(n,h,f?s:t,f)},copyTo:function(h,f){return NH(n,h,f,s)}};return u.isPrim?i&&i[ei](t,u)?u.result:e:Hie(n,e,o,function(h){en(u,"result",{g:function(){return h.v},s:function(g){h.v=g}});for(var f=0,m=i;!(m||(f<ID.length?ID[f++]:zie))[ei](t,u);)m=Ir})}function NH(n,e,t,r){if(!Me(t))for(var i in t)e[i]=JP(n,t[i],r,i);return e}function Vie(n,e,t){var r={handler:t,src:e,path:[]};return NH([],n,e,r)}function Gie(n,e){var t={handler:e,src:n};return JP([],n,t)}function Wie(n){var e=n.value;if(Ft(e)){var t=n.result=[];return t.length=e.length,n.copyTo(t,e),!0}return!1}function $ie(n){var e=n.value;return die(e)?(n.result=new Date(e.getTime()),!0):!1}function Yie(n){return n.type===a1}function IH(n){var e=n.value;if(e&&n.isPlain){var t=n.result={};return n.copyTo(t,e),!0}return!1}function PH(n,e){return Ye(e,function(t){Vie(n,t)}),n}function PD(n,e,t,r,i,o,s){return PH(Gie(n)||{},Ol[ei](arguments))}function Kie(n,e,t,r,i,o,s){return PH(n||{},Ol[ei](arguments))}var Xie=wie(Pp),DC;function Fl(){return!Sr&&wu(),(!DC||Sr.lzy)&&(DC=hs(Gr(or,["performance"]).v)),DC.v}var kH=_h("split",vh);function LH(n,e,t){if(n&&e){var r=kH(e,"."),i=r.pop();Ye(r,function(o){Me(n[o])&&(n[o]={}),n=n[o]}),n[i]=t}}var OH=d1("endsWith",vh,qie);function qie(n,e,t){ht(n)||Ks("'"+qe(n)+"' is not a string");var r=ht(e)?e:$i(e),i=!Zn(t)&&t<n[Pp]?t:n[Pp];return Fa(n,i-r[Pp],i)===r}var Yi=_h("indexOf",vh),UC="ref",FC="unref",jC="hasRef",Qie="enabled";function Zie(n,e,t){var r=!0,i=n?e(Ir):Ir,o;function s(){return r=!1,i&&i[FC]&&i[FC](),o}function a(){i&&t(i),i=Ir}function l(){return i=e(i),r||s(),o}function c(u){!u&&i&&a(),u&&!i&&l()}return o={cancel:a,refresh:l},o[jC]=function(){return i&&i[jC]?i[jC]():r},o[UC]=function(){return r=!0,i&&i[UC]&&i[UC](),o},o[FC]=s,o=Dl(o,Qie,{get:function(){return!!i},set:c}),{h:o,dn:function(){i=Ir}}}function DH(n,e,t){var r=Ft(e),i=r?e.length:0,o=(i>0?e[0]:r?yo:e)||setTimeout,s=(i>1?e[1]:yo)||clearTimeout,a=t[0];t[0]=function(){l.dn(),cp(a,yo,Ol[ei](arguments))};var l=Zie(n,function(c){if(c){if(c.refresh)return c.refresh(),c;cp(s,yo,[c])}return cp(o,yo,t)},function(c){cp(s,yo,[c])});return l.h}function ls(n,e){return DH(!0,yo,Ol[ei](arguments))}function Jie(n,e){return DH(!1,yo,Ol[ei](arguments))}var Nx,dS="constructor",jl="prototype",hS="function",fS="_dynInstFuncs",ZM="_isDynProxy",kp="_dynClass",eoe="_dynCls$",JM="_dynInstChk",Cv=JM,UH="_dfOpts",kD="_unknown_",ek="__proto__",Ix="_dyn"+ek,LD="__dynProto$Gbl",BC="_dynInstProto",zy="useBaseInst",eR="setInstFuncs",tk=Object,bv=tk.getPrototypeOf,OD=tk.getOwnPropertyNames,DD=rs(),tR=DD[LD]||(DD[LD]={o:(Nx={},Nx[eR]=!0,Nx[zy]=!0,Nx),n:1e3});function Hy(n){return n&&(n===tk[jl]||n===Array[jl])}function nk(n){return Hy(n)||n===Function[jl]}function nh(n){var e;if(n){if(bv)return bv(n);var t=n[ek]||n[jl]||(n[dS]?n[dS][jl]:null);e=n[Ix]||t,as(n,Ix)||(delete n[BC],e=n[Ix]=n[BC]||n[Ix],n[BC]=t)}return e}function pS(n,e){var t=[];if(OD)t=OD(n);else for(var r in n)typeof r=="string"&&as(n,r)&&t.push(r);if(t&&t.length>0)for(var i=0;i<t.length;i++)e(t[i])}function rk(n,e,t){return e!==dS&&typeof n[e]===hS&&(t||as(n,e))&&e!==ek&&e!==jl}function mS(n){Ks("DynamicProto: "+n)}function toe(n){var e=lu(null);return pS(n,function(t){!e[t]&&rk(n,t,!1)&&(e[t]=n[t])}),e}function ik(n,e){for(var t=n.length-1;t>=0;t--)if(n[t]===e)return!0;return!1}function noe(n,e,t,r){function i(l,c,u){var h=c[u];if(h[ZM]&&r){var f=l[fS]||{};f[Cv]!==!1&&(h=(f[c[kp]]||{})[u]||h)}return function(){return h.apply(l,arguments)}}var o=lu(null);pS(t,function(l){o[l]=i(e,t,l)});for(var s=nh(n),a=[];s&&!nk(s)&&!ik(a,s);)pS(s,function(l){!o[l]&&rk(s,l,!bv)&&(o[l]=i(e,s,l))}),a.push(s),s=nh(s);return o}function roe(n,e,t,r){var i=null;if(n&&as(t,kp)){var o=n[fS]||lu(null);if(i=(o[t[kp]]||lu(null))[e],i||mS("Missing ["+e+"] "+hS),!i[JM]&&o[Cv]!==!1){for(var s=!as(n,e),a=nh(n),l=[];s&&a&&!nk(a)&&!ik(l,a);){var c=a[e];if(c){s=c===r;break}l.push(a),a=nh(a)}try{s&&(n[e]=i),i[JM]=1}catch{o[Cv]=!1}}}return i}function ioe(n,e,t){var r=e[n];return r===t&&(r=nh(e)[n]),typeof r!==hS&&mS("["+n+"] is not a "+hS),r}function ooe(n,e,t,r,i){function o(l,c){var u=function(){var h=roe(this,c,l,u)||ioe(c,l,u);return h.apply(this,arguments)};return u[ZM]=1,u}if(!Hy(n)){var s=t[fS]=t[fS]||lu(null);if(!Hy(s)){var a=s[e]=s[e]||lu(null);s[Cv]!==!1&&(s[Cv]=!!i),Hy(a)||pS(t,function(l){rk(t,l,!1)&&t[l]!==r[l]&&(a[l]=t[l],delete t[l],(!as(n,l)||n[l]&&!n[l][ZM])&&(n[l]=o(n,l)))})}}}function soe(n,e){if(bv){for(var t=[],r=nh(e);r&&!nk(r)&&!ik(t,r);){if(r===n)return!0;t.push(r),r=nh(r)}return!1}return!0}function zC(n,e){return as(n,jl)?n.name||e||kD:((n||{})[dS]||{}).name||e||kD}function In(n,e,t,r){as(n,jl)||mS("theClass is an invalid class definition.");var i=n[jl];soe(i,e)||mS("["+zC(n)+"] not in hierarchy of ["+zC(e)+"]");var o=null;as(i,kp)?o=i[kp]:(o=eoe+zC(n,"_")+"$"+tR.n,tR.n++,i[kp]=o);var s=In[UH],a=!!s[zy];a&&r&&r[zy]!==void 0&&(a=!!r[zy]);var l=toe(e),c=noe(i,e,l,a);t(e,c);var u=!!bv&&!!s[eR];u&&r&&(u=!!r[eR]),ooe(i,o,e,l,u!==!1)}In[UH]=tR.o;var FH="function",jH="object",ok="undefined",ba="prototype",sk=Object,aoe=sk[ba];(rs()||{}).Symbol;(rs()||{}).Reflect;var BH="hasOwnProperty",loe=function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)aoe[BH].call(e,i)&&(n[i]=e[i])}return n},Ii=XM||loe,nR=function(n,e){return nR=sk.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r[BH](i)&&(t[i]=r[i])},nR(n,e)};function Wl(n,e){typeof e!==FH&&e!==null&&Ks("Class extends value "+String(e)+" is not a constructor or null"),nR(n,e);function t(){this.constructor=n}n[ba]=e===null?lu(e):(t[ba]=e[ba],new t)}function UD(n,e){for(var t=0,r=e.length,i=n.length;t<r;t++,i++)n[i]=e[t];return n}var zH=vie,coe=yie,wc=zH({NONE:0,PENDING:3,INACTIVE:1,ACTIVE:2}),_m="toLowerCase",gS="blkVal",Ct="length",vS="rdOnly",_S="notify",xS="warnToConsole",u_="throwInternal",Gm="setDf",Zc="watch",dr="logger",rh="apply",Zt="push",Wm="splice",HH="hdlr",dp="cancel",d_="initialize",Ac="identifier",yS="removeNotificationListener",wS="addNotificationListener",ya="isInitialized",FD="instrumentationKey",HC="INACTIVE",H0="value",Px="getNotifyMgr",Av="getPlugin",yl="name",yg="iKey",Lp="time",Ai="processNext",VH="getProcessTelContext",jD="pollInternalLogs",hp="enabled",BD="stopPollingInternalLogs",cu="unload",kx="onComplete",SS="version",GH="loggingLevelConsole",ih="createNew",tl="teardown",ES="messageId",Pd="message",xm="isAsync",wl="diagLog",TS="_doTeardown",Mv="update",Aa="getNext",Rv="setNextPlugin",WH="protocol",rR="userAgent",ym="split",VC="nodeType",kd="replace",$H="logInternalMessage",Sl="type",ak="handler",c0="status",zD="getResponseHeader",HD="getAllResponseHeaders",iR="isChildEvt",Lf="data",Op="getCtx",la="setCtx",oR="complete",VD="itemsReceived",wg="urlString",GD="sendPOST",GC="headers",qh="timeout",WD="setRequestHeader",sR="traceId",aR="spanId",lR="traceFlags",WC="getAttribute",$C;function uoe(n,e){$C||($C=RH("AggregationError",function(r,i){i[Ct]>1&&(r.errors=i[1])}));var t=n;throw Ye(e,function(r,i){t+=`
`.concat(i," > ").concat(qe(r))}),new $C(t,e||[])}/*!
 * NevWare21 Solutions LLC - ts-async, 0.5.2
 * https://github.com/nevware21/ts-async
 * Copyright (c) NevWare21 Solutions LLC and contributors. All rights reserved.
 * Licensed under the MIT license.
 */var CS="Promise",lk="rejected";function Bl(n,e){return YH(n,function(t){return e?e({status:"fulfilled",rejected:!1,value:t}):t},function(t){return e?e({status:lk,rejected:!0,reason:t}):t})}function YH(n,e,t,r){var i=n;try{if(_l(n))(e||t)&&(i=n.then(e,t));else try{e&&(i=e(n))}catch(o){if(t)i=t(o);else throw o}}finally{}return i}var KH=["pending","resolving","resolved",lk],$D="dispatchEvent",Lx;function doe(n){var e;return n&&n.createEvent&&(e=n.createEvent("Event")),!!e&&e.initEvent}function hoe(n,e,t,r){var i=Qr();!Lx&&(Lx=hs(!!Gr(doe,[i]).v));var o=Lx.v?i.createEvent("Event"):r?new Event(e):{};if(t&&t(o),Lx.v&&o.initEvent(e,!1,!0),o&&n[$D])n[$D](o);else{var s=n["on"+e];if(s)s(o);else{var a=or("console");a&&(a.error||a.log)(e,qe(o))}}}var XH="unhandledRejection",foe=XH.toLowerCase(),YD=[],poe=0,moe=10,YC;function KD(n){return Mt(n)?n.toString():qe(n)}function qH(n,e,t){var r=p1(arguments,3),i=0,o=!1,s,a=[],l=poe++,c=!1,u=null,h;function f(w,C){try{YD.push(l),c=!0,u&&u.cancel(),u=null;var T=n(function(S,b){a.push(function(){try{var R=i===2?w:C,E=Zn(R)?s:Mt(R)?R(s):R;_l(E)?E.then(S,b):R?S(E):i===3?b(E):S(E)}catch(A){b(A)}}),o&&v()},r);return T}finally{YD.pop()}}function m(w){return f(void 0,w)}function g(w){var C=w,T=w;return Mt(w)&&(C=function(S){return w&&w(),S},T=function(S){throw w&&w(),S}),f(C,T)}function _(){return KH[i]}function v(){if(a.length>0){var w=a.slice();a=[],c=!0,u&&u.cancel(),u=null,e(w)}}function p(w,C){return function(T){if(i===C){if(w===2&&_l(T)){i=1,T.then(p(2,1),p(3,1));return}i=w,o=!0,s=T,v(),!c&&w===3&&!u&&(u=ls(x,moe))}}}function x(){if(!c)if(c=!0,Nie())process.emit(XH,s,h);else{var w=Mo()||rs();!YC&&(YC=hs(Gr(or,[CS+"RejectionEvent"]).v)),hoe(w,foe,function(C){return en(C,"promise",{g:function(){return h}}),C.reason=s,C},!!YC.v)}}h={then:f,catch:m,finally:g},Dl(h,"state",{get:_}),Pie()&&(h[qP(11)]="IPromise");function y(){return"IPromise "+_()+(o?" - "+KD(s):"")}return h.toString=y,function(){Mt(t)||Ks(CS+": executor is not a function - "+KD(t));var C=p(3,0);try{t.call(h,p(2,0),C)}catch(T){C(T)}}(),h}function goe(n){return function(e){var t=p1(arguments,1);return n(function(r,i){try{var o=[],s=1;ZP(e,function(a,l){a&&(s++,YH(a,function(c){o[l]=c,--s===0&&r(o)},i))}),s--,s===0&&r(o)}catch(a){i(a)}},t)}}function voe(n){return hs(function(e){var t=p1(arguments,1);return n(function(r,i){var o=[],s=1;function a(l,c){s++,Bl(l,function(u){u.rejected?o[c]={status:lk,reason:u.reason}:o[c]={status:"fulfilled",value:u.value},--s===0&&r(o)})}try{Ft(e)?Ye(e,a):AH(e)?ZP(e,a):Ks("Input is not an iterable"),s--,s===0&&r(o)}catch(l){i(l)}},t)})}function QH(n){Ye(n,function(e){try{e()}catch{}})}function _oe(n){var e=c_(n)?n:0;return function(t){ls(function(){QH(t)},e)}}function ZH(n,e){return qH(ZH,_oe(e),n,e)}var KC;function xoe(n,e){!KC&&(KC=hs(Gr(or,[CS]).v||null));var t=KC.v;if(!t)return ZH(n);Mt(n)||Ks(CS+": executor is not a function - "+qe(n));var r=0;function i(){return KH[r]}var o=new t(function(s,a){function l(u){r=2,s(u)}function c(u){r=3,a(u)}n(l,c)});return Dl(o,"state",{get:i}),o}var XC;function V0(n){return qH(V0,QH,n)}function yoe(n,e){return!XC&&(XC=voe(V0)),XC.v(n,e)}var qC;function uu(n,e){return!qC&&(qC=hs(xoe)),qC.v.call(this,n,e)}var woe=goe(uu),fa=void 0,Kt="",sd="channels",Mr="core",cR="createPerfMgr",uR="disabled",Dp="extensionConfig",Of="extensions",ka="processTelemetry",bS="priority",Vy="eventsSent",G0="eventsDiscarded",Gy="eventsSendRequest",_d="perfEvent",QC="offlineEventsStored",ZC="offlineBatchSent",JC="offlineBatchDrop",AS="getPerfMgr",dR="domain",eb="path",Soe="Not dynamic - ",Eoe="getPrototypeOf",Toe=/-([a-z])/g,Coe=/([^\w\d_$])/g,boe=/^(\d+[\w\d_$])/,Aoe=Object[Eoe];function Ld(n){return!Me(n)}function MS(n){var e=n;return e&&ht(e)&&(e=e[kd](Toe,function(t,r){return r.toUpperCase()}),e=e[kd](Coe,"_"),e=e[kd](boe,function(t,r){return"_"+r})),e}function di(n,e){return n&&e?Yi(n,e)!==-1:!1}function wm(n){return n&&n.toISOString()||""}function an(n){return $P(n)?n[yl]:Kt}function Tn(n,e,t,r,i){var o=t;return n&&(o=n[e],o!==t&&(!i||i(o))&&(!r||r(t))&&(o=t,n[e]=o)),o}function Ti(n,e,t){var r;return n?(r=n[e],!r&&Me(r)&&(r=Zn(t)?{}:t,n[e]=r)):r=Zn(t)?{}:t,r}function JH(n,e){var t=null,r=null;return Mt(n)?t=n:r=n,function(){var i=arguments;if(t&&(r=t()),r)return r[e][rh](r,i)}}function Moe(n,e,t){if(n&&e&&Zi(n)&&Zi(e)){var r=function(o){if(ht(o)){var s=e[o];Mt(s)?(!t||t(o,!0,e,n))&&(n[o]=JH(e,o)):(!t||t(o,!1,e,n))&&(Qc(n,o)&&delete n[o],en(n,o,{g:function(){return e[o]},s:function(a){e[o]=a}}))}};for(var i in e)r(i)}return n}function RS(n,e,t,r,i){n&&e&&t&&(n[e]=JH(t,r))}function u0(n,e,t,r){return n&&e&&Zi(n)&&Ft(t)&&Ye(t,function(i){ht(i)&&RS(n,i,e,i)}),n}function Roe(n){return function(){function e(){var t=this;n&&zt(n,function(r,i){t[r]=i})}return e}()}function e8(n){return n&&XM&&(n=sk(XM({},n))),n}function t8(n,e,t,r,i,o){var s=arguments,a=s[0]||{},l=s[Ct],c=!1,u=1;for(l>0&&vH(a)&&(c=a,a=s[u]||{},u++),Zi(a)||(a={});u<l;u++){var h=s[u],f=Ft(h),m=Zi(h);for(var g in h){var _=f&&g in h||m&&Qc(h,g);if(_){var v=h[g],p=void 0;if(c&&v&&((p=Ft(v))||Ni(v))){var x=a[g];p?Ft(x)||(x=[]):Ni(x)||(x={}),v=t8(c,x,v)}v!==void 0&&(a[g]=v)}}}return a}function tb(n,e){var t=!1,r=e&&e.featureOptIn&&e.featureOptIn[n];if(n&&r){var i=r.mode;t=i==3||i==1}return t}function NS(n){try{return n.responseText}catch{}return null}function n8(n,e){return n?"XDomainRequest,Response:"+NS(n)||"":e}function IS(n,e){return n?"XMLHttpRequest,Status:"+n[c0]+",Response:"+NS(n)||n.response||"":e}function XD(n,e){return e&&(c_(e)?n=[e].concat(n):Ft(e)&&(n=e.concat(n))),n}var Noe="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",qD="withCredentials",Ioe="timeout";function Poe(n,e,t,r,i,o){i===void 0&&(i=!1);function s(l,c,u){try{l[c]=u}catch{}}var a=new XMLHttpRequest;return s(a,Noe,r),t&&s(a,qD,t),a.open(n,e,!i),t&&s(a,qD,t),!i&&o&&s(a,Ioe,o),a}function koe(n){var e={};if(ht(n)){var t=Er(n)[ym](/[\r\n]+/);Ye(t,function(r){if(r){var i=r.indexOf(": ");if(i!==-1){var o=Er(r.substring(0,i))[_m](),s=Er(r.substring(i+1));e[o]=s}else e[Er(r)]=1}})}return e}function nb(n,e,t){if(!n[t]&&e&&e[zD]){var r=e[zD](t);r&&(n[t]=Er(r))}return n}var Loe="kill-duration",Ooe="kill-duration-seconds",Doe="time-delta-millis";function rb(n,e){var t={};return n[HD]?t=koe(n[HD]()):e&&(t=nb(t,n,Doe),t=nb(t,n,Loe),t=nb(t,n,Ooe)),t}var Uoe="documentMode",Foe="location",joe="console",r8="JSON",Boe="crypto",zoe="msCrypto",Hoe="ReactNative",hR="msie",fR="trident/",i8="XMLHttpRequest",ib=null,ob=null,Voe=!1,Qh=null,sb=null;function o8(n,e){var t=!1;if(n){try{if(t=e in n,!t){var r=n[ba];r&&(t=e in r)}}catch{}if(!t)try{var i=new n;t=!Zn(i[e])}catch{}}return t}function wa(n){if(n&&Voe){var e=or("__mockLocation");if(e)return e}return typeof location===jH&&location?location:or(Foe)}function Goe(){return typeof console!==ok?console:or(joe)}function h_(){return!!(typeof JSON===jH&&JSON||or(r8)!==null)}function Vs(){return h_()?JSON||or(r8):null}function Woe(){return or(Boe)}function $oe(){return or(zoe)}function Yoe(){var n=ja();return n&&n.product?n.product===Hoe:!1}function pR(){var n=ja();if(n&&(n[rR]!==ob||ib===null)){ob=n[rR];var e=(ob||Kt)[_m]();ib=di(e,hR)||di(e,fR)}return ib}function s8(n){if(n===void 0&&(n=null),!n){var e=ja()||{};n=e?(e.userAgent||Kt)[_m]():Kt}var t=(n||Kt)[_m]();if(di(t,hR)){var r=Qr()||{};return Math.max(parseInt(t[ym](hR)[1]),r[Uoe]||0)}else if(di(t,fR)){var i=parseInt(t[ym](fR)[1]);if(i)return i+4}return null}function d0(n){return(sb===null||n===!1)&&(sb=Mie()&&!!ja().sendBeacon),sb}function ck(n){var e=!1;try{e=!!or("fetch");var t=or("Request");e&&n&&t&&(e=o8(t,"keepalive"))}catch{}return e}function Koe(){return Qh===null&&(Qh=typeof XDomainRequest!==ok,Qh&&m1()&&(Qh=Qh&&!o8(or(i8),"withCredentials"))),Qh}function m1(){var n=!1;try{var e=or(i8);n=!!e}catch{}return n}function Xoe(n,e){return n&&n.dispatchEvent&&e?(n.dispatchEvent(e),!0):!1}function qoe(n,e){var t=null,r={detail:e||null};if(Mt(CustomEvent))t=new CustomEvent(n,r);else{var i=Qr();i&&i.createEvent&&(t=i.createEvent("CustomEvent"),t.initCustomEvent(n,!0,!0,r))}return t}function Qoe(n,e,t){var r=rs();if(r&&r.CustomEvent)try{var i={cfg:e||null,customDetails:t||null};return Xoe(r,qoe(n,i))}catch{}return!1}var a8=4294967296,Jc=4294967295,l8=123456789,c8=987654321,u8=!1,h0=l8,f0=c8;function Zoe(n){n<0&&(n>>>=0),h0=l8+n&Jc,f0=c8-n&Jc,u8=!0}function Joe(){try{var n=Pa()&2147483647;Zoe((Math.random()*a8^n)+n)}catch{}}function ese(n){return Math.floor(Nv()/Jc*(n+1))>>>0}function Nv(n){var e=0,t=Woe()||$oe();return t&&t.getRandomValues&&(e=t.getRandomValues(new Uint32Array(1))[0]&Jc),e===0&&pR()&&(u8||Joe(),e=tse()&Jc),e===0&&(e=Math.floor(a8*Math.random()|0)),e>>>=0,e}function tse(n){f0=36969*(f0&65535)+(f0>>16)&Jc,h0=18e3*(h0&65535)+(h0>>16)&Jc;var e=(f0<<16)+(h0&65535)>>>0&Jc|0;return e>>>=0,e}function uk(n){n===void 0&&(n=22);for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=Nv()>>>0,r=0,i=Kt;i[Ct]<n;)r++,i+=e.charAt(t&63),t>>>=6,r===5&&(t=(Nv()<<2&4294967295|t&3)>>>0,r=0);return i}var d8="3.3.3",nse="."+uk(6),rse=0;function h8(n){return n[VC]===1||n[VC]===9||!+n[VC]}function ise(n,e){var t=e[n.id];if(!t){t={};try{h8(e)&&en(e,n.id,{e:!1,v:t})}catch{}}return t}function cs(n,e){return e===void 0&&(e=!1),MS(n+rse+++(e?"."+d8:Kt)+nse)}function f8(n){var e={id:cs("_aiData-"+(n||Kt)+"."+d8),accept:function(t){return h8(t)},get:function(t,r,i,o){var s=t[e.id];return s?s[MS(r)]:(o&&(s=ise(e,t),s[MS(r)]=i),i)},kill:function(t,r){if(t&&t[r])try{delete t[r]}catch{}}};return e}function Wy(n){return n&&Zi(n)&&(n.isVal||n.fb||Qc(n,"v")||Qc(n,"mrg")||Qc(n,"ref")||n.set)}function p8(n,e,t){var r,i=t.dfVal||WP;if(e&&t.fb){var o=t.fb;Ft(o)||(o=[o]);for(var s=0;s<o[Ct];s++){var a=o[s],l=e[a];if(i(l)?r=l:n&&(l=n.cfg[a],i(l)&&(r=l),n.set(n.cfg,$i(a),l)),i(r))break}}return!i(r)&&i(t.v)&&(r=t.v),r}function mR(n,e,t){var r=t;if(t&&Wy(t)&&(r=p8(n,e,t)),r){Wy(r)&&(r=mR(n,e,r));var i;Ft(r)?(i=[],i[Ct]=r[Ct]):Ni(r)&&(i={}),i&&(zt(r,function(o,s){s&&Wy(s)&&(s=mR(n,e,s)),i[o]=s}),r=i)}return r}function dk(n,e,t,r){var i,o,s,a=r,l,c,u,h;Wy(a)?(i=a.isVal,o=a.set,u=a[vS],h=a[gS],l=a.mrg,c=a.ref,!c&&Zn(c)&&(c=!!l),s=p8(n,e,a)):s=r,h&&n[gS](e,t);var f,m=!0,g=e[t];(g||!Me(g))&&(f=g,m=!1,i&&f!==s&&!i(f)&&(f=s,m=!0),o&&(f=o(f,s,e),m=f===s)),m?s?f=mR(n,e,s):f=s:(Ni(f)||Ft(s))&&l&&s&&(Ni(s)||Ft(s))&&zt(s,function(_,v){dk(n,f,_,v)}),n.set(e,t,f),c&&n.ref(e,t),u&&n[vS](e,t)}var du=QP("[[ai_dynCfg_1]]"),m8=QP("[[ai_blkDynCfg_1]]"),ose=QP("[[ai_frcDynCfg_1]]");function g8(n){if(n){var e;if(Ft(n)?(e=[],e[Ct]=n[Ct]):Ni(n)&&(e={}),e)return zt(n,function(t,r){e[t]=g8(r)}),e}return n}function sse(n){if(n){var e=n[du]||n;if(e.cfg&&(e.cfg===n||e.cfg[du]===e))return e}return null}function ase(n){if(n&&(Ni(n)||Ft(n)))try{n[m8]=!0}catch{}return n}function ab(n,e,t){var r=!1;return t&&!n[e.blkVal]&&(r=t[ose],!r&&!t[m8]&&(r=Ni(t)||Ft(t))),r}function v8(n){Ks("InvalidAccess:"+n)}var lse=["push","pop","shift","unshift","splice"],Iv=function(n,e,t,r){n&&n[u_](3,108,"".concat(t," [").concat(e,"] failed - ")+qe(r))};function cse(n,e,t){Ft(e)&&Ye(lse,function(r){var i=e[r];e[r]=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var a=i[rh](this,o);return kS(n,e,t,"Patching"),a}})}function PS(n,e){var t=YP(n,e);return t&&t.get}function use(n,e,t,r){var i={n:t,h:[],trk:function(c){c&&c.fn&&(xi(i.h,c)===-1&&i.h[Zt](c),n.trk(c,i))},clr:function(c){var u=xi(i.h,c);u!==-1&&i.h[Wm](u,1)}},o=!0,s=!1;function a(){o&&(s=s||ab(a,n,r),r&&!r[du]&&s&&(r=kS(n,r,t,"Converting")),o=!1);var c=n.act;return c&&i.trk(c),r}a[n.prop]={chng:function(){n.add(i)}};function l(c){if(r!==c){a[n.ro]&&!n.upd&&v8("["+t+"] is read-only:"+qe(e)),o&&(s=s||ab(a,n,r),o=!1);var u=s&&a[n.rf];if(s)if(u){zt(r,function(f){r[f]=c?c[f]:fa});try{zt(c,function(f,m){g1(n,r,f,m)}),c=r}catch(f){Iv((n.hdlr||{})[dr],t,"Assigning",f),s=!1}}else r&&r[du]&&zt(r,function(f){var m=PS(r,f);if(m){var g=m[n.prop];g&&g.chng()}});if(c!==r){var h=c&&ab(a,n,c);!u&&h&&(c=kS(n,c,t,"Converting")),r=c,s=h}n.add(i)}}en(e,i.n,{g:a,s:l})}function g1(n,e,t,r){if(e){var i=PS(e,t),o=i&&!!i[n.prop];o?e[t]=r:use(n,e,t,r)}return e}function lb(n,e,t,r){if(e){var i=PS(e,t),o=i&&!!i[n.prop],s=r&&r[0],a=r&&r[1],l=r&&r[2];if(!o){if(l)try{ase(e)}catch(c){Iv((n.hdlr||{})[dr],t,"Blocking",c)}try{g1(n,e,t,e[t]),i=PS(e,t)}catch(c){Iv((n.hdlr||{})[dr],t,"State",c)}}s&&(i[n.rf]=s),a&&(i[n.ro]=a),l&&(i[n.blkVal]=!0)}return e}function kS(n,e,t,r){try{zt(e,function(i,o){g1(n,e,i,o)}),e[du]||(Dl(e,du,{get:function(){return n[HH]}}),cse(n,e,t))}catch(i){Iv((n.hdlr||{})[dr],t,r,i)}return e}var Sg="[[ai_",Eg="]]";function dse(n){var e,t=xg(Sg+"get"+n.uid+Eg),r=xg(Sg+"ro"+n.uid+Eg),i=xg(Sg+"rf"+n.uid+Eg),o=xg(Sg+"blkVal"+n.uid+Eg),s=xg(Sg+"dtl"+n.uid+Eg),a=null,l=null,c;function u(g,_){var v=c.act;try{c.act=g,g&&g[s]&&(Ye(g[s],function(x){x.clr(g)}),g[s]=[]),_({cfg:n.cfg,set:n.set.bind(n),setDf:n[Gm].bind(n),ref:n.ref.bind(n),rdOnly:n[vS].bind(n)})}catch(x){var p=n[dr];throw p&&p[u_](1,107,qe(x)),x}finally{c.act=v||null}}function h(){if(a){var g=a;a=null,l&&l[dp](),l=null;var _=[];if(Ye(g,function(v){if(v&&(v[s]&&(Ye(v[s],function(p){p.clr(v)}),v[s]=null),v.fn))try{u(v,v.fn)}catch(p){_[Zt](p)}}),a)try{h()}catch(v){_[Zt](v)}_[Ct]>0&&uoe("Watcher error(s): ",_)}}function f(g){if(g&&g.h[Ct]>0){a||(a=[]),l||(l=ls(function(){l=null,h()},0));for(var _=0;_<g.h[Ct];_++){var v=g.h[_];v&&xi(a,v)===-1&&a[Zt](v)}}}function m(g,_){if(g){var v=g[s]=g[s]||[];xi(v,_)===-1&&v[Zt](_)}}return c=(e={prop:t,ro:r,rf:i},e[gS]=o,e[HH]=n,e.add=f,e[_S]=h,e.use=u,e.trk=m,e),c}function hse(n,e){var t={fn:e,rm:function(){t.fn=null,n=null,e=null}};return en(t,"toJSON",{v:function(){return"WatcherHandler"+(t.fn?"":"[X]")}}),n.use(t,e),t}function fse(n,e,t){var r,i=sse(e);if(i)return i;var o=cs("dyncfg",!0),s=e&&t!==!1?e:g8(e),a;function l(){a[_S]()}function c(p,x,y){try{p=g1(a,p,x,y)}catch(w){Iv(n,x,"Setting value",w)}return p[x]}function u(p){return hse(a,p)}function h(p,x){a.use(null,function(y){var w=a.upd;try{Zn(x)||(a.upd=x),p(y)}finally{a.upd=w}})}function f(p,x){var y;return lb(a,p,x,(y={},y[0]=!0,y))[x]}function m(p,x){var y;return lb(a,p,x,(y={},y[1]=!0,y))[x]}function g(p,x){var y;return lb(a,p,x,(y={},y[2]=!0,y))[x]}function _(p,x){return x&&zt(x,function(y,w){dk(v,p,y,w)}),p}var v=(r={uid:null,cfg:s},r[dr]=n,r[_S]=l,r.set=c,r[Gm]=_,r[Zc]=u,r.ref=f,r[vS]=m,r[gS]=g,r._block=h,r);return en(v,"uid",{c:!1,e:!1,w:!1,v:o}),a=dse(v),kS(a,s,"config","Creating"),v}function pse(n,e){n?(n[xS](e),n[u_](2,108,e)):v8(e)}function us(n,e,t,r){var i=fse(t,n||{},r);return e&&i[Gm](i.cfg,e),i}function pr(n,e,t){var r=n[du]||n;return r.cfg&&(r.cfg===n||r.cfg[du]===r)?r[Zc](e):(pse(t,Soe+qe(n)),us(n,null,t)[Zc](e))}function fp(n,e){if(n&&n[cu])return n[cu](e)}function _8(n,e,t){var r;return t||(r=uu(function(i){t=i})),n&&Xie(n)>0?Bl(fp(n[0],e),function(){_8(p1(n,1),e,t)}):t(),r}var mse=500,QD="Microsoft_ApplicationInsights_BypassAjaxInstrumentation";function gse(n,e,t){return!n&&Me(n)?e:vH(n)?n:$i(n)[_m]()==="true"}function bs(n){return{mrg:!0,v:n}}function ZD(n,e){return{set:n,v:e}}function LS(n,e,t){return{fb:t,isVal:n,v:e}}function _r(n,e){return{fb:e,set:gse,v:!!n}}function vse(n){return{isVal:ht,v:$i(Kt)}}var cb=[Vy,G0,Gy,_d],OS=null,Ox;function _se(n,e){return function(){var t=arguments,r=x8(e);if(r){var i=r.listener;i&&i[n]&&i[n][rh](i,t)}}}function xse(){var n=or("Microsoft");return n&&(OS=n.ApplicationInsights),OS}function x8(n){var e=OS;return!e&&n.disableDbgExt!==!0&&(e=OS||xse()),e?e.ChromeDbgExt:null}function yse(n){if(!Ox){Ox={};for(var e=0;e<cb[Ct];e++)Ox[cb[e]]=_se(cb[e],n)}return Ox}var Zh,y8="warnToConsole",wse="AI (Internal): ",Sse="AI: ",Ese="AITR_",Tse={loggingLevelConsole:0,loggingLevelTelemetry:1,maxMessageLimit:25,enableDebug:!1},Cse=(Zh={},Zh[0]=null,Zh[1]="errorToConsole",Zh[2]=y8,Zh[3]="debugToConsole",Zh);function JD(n){return n?'"'+n[kd](/\"/g,Kt)+'"':Kt}function ub(n,e){var t=Goe();if(t){var r="log";t[n]&&(r=n),Mt(t[r])&&t[r](e)}}var Pv=function(){function n(e,t,r,i){r===void 0&&(r=!1);var o=this;o[ES]=e,o[Pd]=(r?Sse:wse)+e;var s=Kt;h_()&&(s=Vs().stringify(i));var a=(t?" message:"+JD(t):Kt)+(i?" props:"+JD(s):Kt);o[Pd]+=a}return n.dataType="MessageData",n}();function xh(n,e){return(n||{})[dr]||new DS(e)}var DS=function(){function n(e){this.identifier="DiagnosticLogger",this.queue=[];var t=0,r={},i,o,s,a,l;In(n,this,function(c){l=h(e||{}),c.consoleLoggingLevel=function(){return i},c[u_]=function(g,_,v,p,x){x===void 0&&(x=!1);var y=new Pv(_,v,x,p);if(a)throw qe(y);var w=Cse[g]||y8;if(Zn(y[Pd]))m("throw"+(g===1?"Critical":"Warning"),y);else{if(x){var C=+y[ES];!r[C]&&i>=g&&(c[w](y[Pd]),r[C]=!0)}else i>=g&&c[w](y[Pd]);u(g,y)}},c.debugToConsole=function(g){ub("debug",g),m("warning",g)},c[xS]=function(g){ub("warn",g),m("warning",g)},c.errorToConsole=function(g){ub("error",g),m("error",g)},c.resetInternalMessageCount=function(){t=0,r={}},c[$H]=u,c[cu]=function(g){l&&l.rm(),l=null};function u(g,_){if(!f()){var v=!0,p=Ese+_[ES];if(r[p]?v=!1:r[p]=!0,v&&(g<=o&&(c.queue[Zt](_),t++,m(g===1?"error":"warn",_)),t===s)){var x="Internal events throttle limit per PageView reached for this app.",y=new Pv(23,x,!1);c.queue[Zt](y),g===1?c.errorToConsole(x):c[xS](x)}}}function h(g){return pr(us(g,Tse,c).cfg,function(_){var v=_.cfg;i=v[GH],o=v.loggingLevelTelemetry,s=v.maxMessageLimit,a=v.enableDebug})}function f(){return t>=s}function m(g,_){var v=x8(e||{});v&&v[wl]&&v[wl](g,_)}})}return n.__ieDyn=1,n}();function hk(n){return n||new DS}function Fe(n,e,t,r,i,o){o===void 0&&(o=!1),hk(n)[u_](e,t,r,i,o)}function Od(n,e){hk(n)[xS](e)}function bse(n,e,t){hk(n)[$H](e,t)}var db,ku,e5="toGMTString",t5="toUTCString",fk="cookie",hb="expires",n5="isCookieUseDisabled",gR="disableCookiesUsage",pp="_ckMgr",Dx=null,fb=null,r5=null,Ma,i5={},US={},Ase=(db={cookieCfg:bs((ku={},ku[dR]={fb:"cookieDomain",dfVal:Ld},ku.path={fb:"cookiePath",dfVal:Ld},ku.enabled=fa,ku.ignoreCookies=fa,ku.blockedCookies=fa,ku)),cookieDomain:fa,cookiePath:fa},db[gR]=fa,db);function pk(){!Ma&&(Ma=Aie(function(){return Qr()}))}function Mse(n,e){var t=$y[pp]||US[pp];return t||(t=$y[pp]=$y(n,e),US[pp]=t),t}function Ux(n){return n?n.isEnabled():!0}function w8(n,e){return e&&n&&Ft(n.ignoreCookies)?xi(n.ignoreCookies,e)!==-1:!1}function Rse(n,e){return e&&n&&Ft(n.blockedCookies)&&xi(n.blockedCookies,e)!==-1?!0:w8(n,e)}function o5(n,e){var t=e[hp];if(Me(t)){var r=void 0;Zn(n[n5])||(r=!n[n5]),Zn(n[gR])||(r=!n[gR]),t=r}return t}function mk(n,e){var t;return n&&(t=n.getCookieMgr()),t||(t=Mse(e,(n||{})[dr])),t}function $y(n,e){var t,r,i,o,s,a,l,c,u;n=us(n||US,null,e).cfg,s=pr(n,function(f){f[Gm](f.cfg,Ase),r=f.ref(f.cfg,"cookieCfg"),i=r[eb]||"/",o=r[dR],a=o5(n,r)!==!1,l=r.getCookie||Nse,c=r.setCookie||c5,u=r.delCookie||c5},e);var h=(t={isEnabled:function(){var f=o5(n,r)!==!1&&a&&s5(e),m=US[pp];return f&&m&&h!==m&&(f=Ux(m)),f},setEnabled:function(f){a=f!==!1,r[hp]=f},set:function(f,m,g,_,v){var p=!1;if(Ux(h)&&!Rse(r,f)){var x={},y=Er(m||Kt),w=Yi(y,";");if(w!==-1&&(y=Er(KP(m,w)),x=S8(Fa(m,w+1))),Tn(x,dR,_||o,cS,Zn),!Me(g)){var C=pR();if(Zn(x[hb])){var T=Pa(),S=T+g*1e3;if(S>0){var b=new Date;b.setTime(S),Tn(x,hb,a5(b,C?e5:t5)||a5(b,C?e5:t5)||Kt,cS)}}C||Tn(x,"max-age",Kt+g,null,Zn)}var R=wa();R&&R[WH]==="https:"&&(Tn(x,"secure",null,null,Zn),fb===null&&(fb=!Ise((ja()||{})[rR])),fb&&Tn(x,"SameSite","None",null,Zn)),Tn(x,eb,v||i,null,Zn),c(f,l5(y,x)),p=!0}return p},get:function(f){var m=Kt;return Ux(h)&&!w8(r,f)&&(m=l(f)),m},del:function(f,m){var g=!1;return Ux(h)&&(g=h.purge(f,m)),g},purge:function(f,m){var g,_=!1;if(s5(e)){var v=(g={},g[eb]=m||"/",g[hb]="Thu, 01 Jan 1970 00:00:01 GMT",g);pR()||(v["max-age"]="0"),u(f,l5(Kt,v)),_=!0}return _}},t[cu]=function(f){s&&s.rm(),s=null},t);return h[pp]=h,h}function s5(n){if(Dx===null){Dx=!1,!Ma&&pk();try{var e=Ma.v||{};Dx=e[fk]!==void 0}catch(t){Fe(n,2,68,"Cannot access document.cookie - "+an(t),{exception:qe(t)})}}return Dx}function S8(n){var e={};if(n&&n[Ct]){var t=Er(n)[ym](";");Ye(t,function(r){if(r=Er(r||Kt),r){var i=Yi(r,"=");i===-1?e[r]=null:e[Er(KP(r,i))]=Er(Fa(r,i+1))}})}return e}function a5(n,e){return Mt(n[e])?n[e]():null}function l5(n,e){var t=n||Kt;return zt(e,function(r,i){t+="; "+r+(Me(i)?Kt:"="+i)}),t}function Nse(n){var e=Kt;if(!Ma&&pk(),Ma.v){var t=Ma.v[fk]||Kt;r5!==t&&(i5=S8(t),r5=t),e=Er(i5[n]||Kt)}return e}function c5(n,e){!Ma&&pk(),Ma.v&&(Ma.v[fk]=n+"="+e)}function Ise(n){return ht(n)?!!(di(n,"CPU iPhone OS 12")||di(n,"iPad; CPU OS 12")||di(n,"Macintosh; Intel Mac OS X 10_14")&&di(n,"Version/")&&di(n,"Safari")||di(n,"Macintosh; Intel Mac OS X 10_14")&&OH(n,"AppleWebKit/605.1.15 (KHTML, like Gecko)")||di(n,"Chrome/5")||di(n,"Chrome/6")||di(n,"UnrealEngine")&&!di(n,"Chrome")||di(n,"UCBrowser/12")||di(n,"UCBrowser/11")):!1}var Pse={perfEvtsSendAll:!1};function kse(n){n.h=null;var e=n.cb;n.cb=[],Ye(e,function(t){Gr(t.fn,[t.arg])})}function ac(n,e,t,r){Ye(n,function(i){i&&i[e]&&(t?(t.cb[Zt]({fn:r,arg:i}),t.h=t.h||ls(kse,0,t)):Gr(r,[i]))})}var Lse=function(){function n(e){this.listeners=[];var t,r,i=[],o={h:null,cb:[]},s=us(e,Pse);r=s[Zc](function(a){t=!!a.cfg.perfEvtsSendAll}),In(n,this,function(a){en(a,"listeners",{g:function(){return i}}),a[wS]=function(l){i[Zt](l)},a[yS]=function(l){for(var c=xi(i,l);c>-1;)i[Wm](c,1),c=xi(i,l)},a[Vy]=function(l){ac(i,Vy,o,function(c){c[Vy](l)})},a[G0]=function(l,c){ac(i,G0,o,function(u){u[G0](l,c)})},a[Gy]=function(l,c){ac(i,Gy,c?o:null,function(u){u[Gy](l,c)})},a[_d]=function(l){l&&(t||!l[iR]())&&ac(i,_d,null,function(c){l[xm]?ls(function(){return c[_d](l)},0):c[_d](l)})},a[QC]=function(l){l&&l[Ct]&&ac(i,QC,o,function(c){c[QC](l)})},a[ZC]=function(l){l&&l[Lf]&&ac(i,ZC,o,function(c){c[ZC](l)})},a[JC]=function(l,c){if(l>0){var u=c||0;ac(i,JC,o,function(h){h[JC](l,u)})}},a[cu]=function(l){var c=function(){r&&r.rm(),r=null,i=[],o.h&&o.h[dp](),o.h=null,o.cb=[]},u;if(ac(i,"unload",null,function(h){var f=h[cu](l);f&&(u||(u=[]),u[Zt](f))}),u)return uu(function(h){return Bl(woe(u),function(){c(),h()})});c()}})}return n.__ieDyn=1,n}(),Up="ctx",vR="ParentContextKey",W0="ChildrenContextKey",Ose=null,Yy=function(){function n(e,t,r){var i=this;if(i.start=Pa(),i[yl]=e,i[xm]=r,i[iR]=function(){return!1},Mt(t)){var o;en(i,"payload",{g:function(){return!o&&Mt(t)&&(o=t(),t=null),o}})}i[Op]=function(s){return s?s===n[vR]||s===n[W0]?i[s]:(i[Up]||{})[s]:null},i[la]=function(s,a){if(s)if(s===n[vR])i[s]||(i[iR]=function(){return!0}),i[s]=a;else if(s===n[W0])i[s]=a;else{var l=i[Up]=i[Up]||{};l[s]=a}},i[oR]=function(){var s=0,a=i[Op](n[W0]);if(Ft(a))for(var l=0;l<a[Ct];l++){var c=a[l];c&&(s+=c[Lp])}i[Lp]=Pa()-i.start,i.exTime=i[Lp]-s,i[oR]=function(){}}}return n.ParentContextKey="parent",n.ChildrenContextKey="childEvts",n}(),Dse=function(){function n(e){this.ctx={},In(n,this,function(t){t.create=function(r,i,o){return new Yy(r,i,o)},t.fire=function(r){r&&(r[oR](),e&&Mt(e[_d])&&e[_d](r))},t[la]=function(r,i){if(r){var o=t[Up]=t[Up]||{};o[r]=i}},t[Op]=function(r){return(t[Up]||{})[r]}})}return n.__ieDyn=1,n}(),pb="CoreUtils.doPerf";function FS(n,e,t,r,i){if(n){var o=n;if(o[AS]&&(o=o[AS]()),o){var s=void 0,a=o[Op](pb);try{if(s=o.create(e(),r,i),s){if(a&&s[la]&&(s[la](Yy[vR],a),a[Op]&&a[la])){var l=a[Op](Yy[W0]);l||(l=[],a[la](Yy[W0],l)),l[Zt](s)}return o[la](pb,s),t(s)}}catch(c){s&&s[la]&&s[la]("exception",c)}finally{s&&o.fire(s),o[la](pb,a)}}}return t()}function Use(){return Ose}function Uc(){for(var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],e=Kt,t,r=0;r<4;r++)t=Nv(),e+=n[t&15]+n[t>>4&15]+n[t>>8&15]+n[t>>12&15]+n[t>>16&15]+n[t>>20&15]+n[t>>24&15]+n[t>>28&15];var i=n[8+(Nv()&3)|0];return bc(e,0,8)+bc(e,9,4)+"4"+bc(e,13,3)+i+bc(e,16,3)+bc(e,19,12)}var _R="00",Fse="ff",E8="00000000000000000000000000000000",T8="0000000000000000";function f_(n,e,t){return n&&n[Ct]===e&&n!==t?!!n.match(/^[\da-f]*$/i):!1}function u5(n,e,t){return f_(n,e)?n:t}function jse(n){(isNaN(n)||n<0||n>255)&&(n=1);for(var e=n.toString(16);e[Ct]<2;)e="0"+e;return e}function d5(n,e,t,r){var i;return i={},i[SS]=f_(r,2,Fse)?r:_R,i[sR]=gk(n)?n:Uc(),i[aR]=vk(e)?e:KP(Uc(),16),i.traceFlags=t>=0&&t<=255?t:1,i}function gk(n){return f_(n,32,E8)}function vk(n){return f_(n,16,T8)}function h5(n){if(n){var e=jse(n[lR]);f_(e,2)||(e="01");var t=n[SS]||_R;return t!=="00"&&t!=="ff"&&(t=_R),"".concat(t.toLowerCase(),"-").concat(u5(n.traceId,32,E8).toLowerCase(),"-").concat(u5(n.spanId,16,T8).toLowerCase(),"-").concat(e.toLowerCase())}return""}function Bse(n){var e=n.getElementsByTagName("script"),t=[];return Ye(e,function(r){var i=r[WC]("src");if(i){var o=r[WC]("crossorigin"),s=r.hasAttribute("async")===!0,a=r.hasAttribute("defer")===!0,l=r[WC]("referrerpolicy"),c={url:i};o&&(c.crossOrigin=o),s&&(c.async=s),a&&(c.defer=a),l&&(c.referrerPolicy=l),t[Zt](c)}}),t}var zse=f8("plugin");function Dd(n){return zse.get(n,"state",{},!0)}function f5(n,e){for(var t=[],r=null,i=n[Aa](),o;i;){var s=i[Av]();if(s){r&&r[Rv]&&s[ka]&&r[Rv](s),o=Dd(s);var a=!!o[ya];s[ya]&&(a=s[ya]()),a||t[Zt](s),r=s,i=i[Aa]()}}Ye(t,function(l){var c=n[Mr]();l[d_](n.getCfg(),c,e,n[Aa]()),o=Dd(l),!l[Mr]&&!o[Mr]&&(o[Mr]=c),o[ya]=!0,delete o[tl]})}function mb(n){return n.sort(function(e,t){var r=0;if(t){var i=t[ka];e[ka]?r=i?e[bS]-t[bS]:1:i&&(r=-1)}else r=e?1:-1;return r})}function Hse(n){var e={};return{getName:function(){return e[yl]},setName:function(t){e[yl]=t},getTraceId:function(){return e[sR]},setTraceId:function(t){gk(t)&&(e[sR]=t)},getSpanId:function(){return e[aR]},setSpanId:function(t){vk(t)&&(e[aR]=t)},getTraceFlags:function(){return e[lR]},setTraceFlags:function(t){e[lR]=t}}}var Vse="TelemetryPluginChain",p5="_hasRun",m5="_getTelCtx",g5=0;function Gse(n,e,t){for(;n;){if(n[Av]()===t)return n;n=n[Aa]()}return oh([t],e.config||{},e)}function _k(n,e,t,r){var i=null,o=[];e||(e=us({},null,t[dr])),r!==null&&(i=r?Gse(n,t,r):n);var s={_next:l,ctx:{core:function(){return t},diagLog:function(){return xh(t,e.cfg)},getCfg:function(){return e.cfg},getExtCfg:u,getConfig:h,hasNext:function(){return!!i},getNext:function(){return i},setNext:function(m){i=m},iterate:f,onComplete:a}};function a(m,g){for(var _=[],v=2;v<arguments.length;v++)_[v-2]=arguments[v];m&&o[Zt]({func:m,self:Zn(g)?s.ctx:g,args:_})}function l(){var m=i;if(i=m?m[Aa]():null,!m){var g=o;g&&g[Ct]>0&&(Ye(g,function(_){try{_.func.call(_.self,_.args)}catch(v){Fe(t[dr],2,73,"Unexpected Exception during onComplete - "+qe(v))}}),o=[])}return m}function c(m,g){var _=null,v=e.cfg;if(v&&m){var p=v[Dp];!p&&g&&(p={}),v[Dp]=p,p=e.ref(v,Dp),p&&(_=p[m],!_&&g&&(_={}),p[m]=_,_=e.ref(p,m))}return _}function u(m,g){var _=c(m,!0);return g&&zt(g,function(v,p){if(Me(_[v])){var x=e.cfg[v];(x||!Me(x))&&(_[v]=x)}dk(e,_,v,p)}),e[Gm](_,g)}function h(m,g,_){_===void 0&&(_=!1);var v,p=c(m,!1),x=e.cfg;return p&&(p[g]||!Me(p[g]))?v=p[g]:(x[g]||!Me(x[g]))&&(v=x[g]),v||!Me(v)?v:_}function f(m){for(var g;g=s._next();){var _=g[Av]();_&&m(_)}}return s}function Gs(n,e,t,r){var i=us(e),o=_k(n,i,t,r),s=o.ctx;function a(c){var u=o._next();return u&&u[ka](c,s),!u}function l(c,u){return c===void 0&&(c=null),Ft(c)&&(c=oh(c,i.cfg,t,u)),Gs(c||s[Aa](),i.cfg,t,u)}return s[Ai]=a,s[ih]=l,s}function jS(n,e,t){var r=us(e.config),i=_k(n,r,e,t),o=i.ctx;function s(l){var c=i._next();return c&&c[cu](o,l),!c}function a(l,c){return l===void 0&&(l=null),Ft(l)&&(l=oh(l,r.cfg,e,c)),jS(l||o[Aa](),e,c)}return o[Ai]=s,o[ih]=a,o}function xk(n,e,t){var r=us(e.config),i=_k(n,r,e,t),o=i.ctx;function s(l){return o.iterate(function(c){Mt(c[Mv])&&c[Mv](o,l)})}function a(l,c){return l===void 0&&(l=null),Ft(l)&&(l=oh(l,r.cfg,e,c)),xk(l||o[Aa](),e,c)}return o[Ai]=s,o[ih]=a,o}function oh(n,e,t,r){var i=null,o=!r;if(Ft(n)&&n[Ct]>0){var s=null;Ye(n,function(a){if(!o&&r===a&&(o=!0),o&&a&&Mt(a[ka])){var l=Wse(a,e,t);i||(i=l),s&&s._setNext(l),s=l}})}return r&&!i?oh([r],e,t):i}function Wse(n,e,t){var r=null,i=Mt(n[ka]),o=Mt(n[Rv]),s;n?s=n[Ac]+"-"+n[bS]+"-"+g5++:s="Unknown-0-"+g5++;var a={getPlugin:function(){return n},getNext:function(){return r},processTelemetry:u,unload:h,update:f,_id:s,_setNext:function(m){r=m}};function l(){var m;return n&&Mt(n[m5])&&(m=n[m5]()),m||(m=Gs(a,e,t)),m}function c(m,g,_,v,p){var x=!1,y=n?n[Ac]:Vse,w=m[p5];return w||(w=m[p5]={}),m.setNext(r),n&&FS(m[Mr](),function(){return y+":"+_},function(){w[s]=!0;try{var C=r?r._id:Kt;C&&(w[C]=!1),x=g(m)}catch(S){var T=r?w[r._id]:!0;T&&(x=!0),(!r||!T)&&Fe(m[wl](),1,73,"Plugin ["+y+"] failed during "+_+" - "+qe(S)+", run flags: "+qe(w))}},v,p),x}function u(m,g){g=g||l();function _(v){if(!n||!i)return!1;var p=Dd(n);return p[tl]||p[uR]?!1:(o&&n[Rv](r),n[ka](m,v),!0)}c(g,_,"processTelemetry",function(){return{item:m}},!m.sync)||g[Ai](m)}function h(m,g){function _(){var v=!1;if(n){var p=Dd(n),x=n[Mr]||p[Mr];n&&(!x||x===m.core())&&!p[tl]&&(p[Mr]=null,p[tl]=!0,p[ya]=!1,n[tl]&&n[tl](m,g)===!0&&(v=!0))}return v}c(m,_,"unload",function(){},g[xm])||m[Ai](g)}function f(m,g){function _(){var v=!1;if(n){var p=Dd(n),x=n[Mr]||p[Mr];n&&(!x||x===m.core())&&!p[tl]&&n[Mv]&&n[Mv](m,g)===!0&&(v=!0)}return v}c(m,_,"update",function(){},!1)||m[Ai](g)}return Ul(a)}function C8(){var n=[];function e(r){r&&n[Zt](r)}function t(r,i){Ye(n,function(o){try{o(r,i)}catch(s){Fe(r[wl](),2,73,"Unexpected error calling unload handler - "+qe(s))}}),n=[]}return{add:e,run:t}}function b8(){var n=[];function e(r){var i=n;n=[],Ye(i,function(o){try{(o.rm||o.remove).call(o)}catch(s){Fe(r,2,73,"Unloading:"+qe(s))}})}function t(r){r&&up(n,r)}return{run:e,add:t}}var gb,lc="getPlugin",$se=(gb={},gb[Dp]={isVal:Ld,v:{}},gb),$m=function(){function n(){var e=this,t,r,i,o,s;c(),In(n,e,function(u){u[d_]=function(h,f,m,g){l(h,f,g),t=!0},u[tl]=function(h,f){var m,g=u[Mr];if(!g||h&&g!==h[Mr]())return;var _,v=!1,p=h||jS(null,g,i&&i[lc]?i[lc]():i),x=f||(m={reason:0},m[xm]=!1,m);function y(){v||(v=!0,o.run(p,f),s.run(p[wl]()),_===!0&&p[Ai](x),c())}return!u[TS]||u[TS](p,x,y)!==!0?y():_=!0,_},u[Mv]=function(h,f){var m=u[Mr];if(!m||h&&m!==h[Mr]())return;var g,_=!1,v=h||xk(null,m,i&&i[lc]?i[lc]():i),p=f||{reason:0};function x(){_||(_=!0,l(v.getCfg(),v.core(),v[Aa]()))}return!u._doUpdate||u._doUpdate(v,p,x)!==!0?x():g=!0,g},RS(u,"_addUnloadCb",function(){return o},"add"),RS(u,"_addHook",function(){return s},"add"),en(u,"_unloadHooks",{g:function(){return s}})}),e[wl]=function(u){return a(u)[wl]()},e[ya]=function(){return t},e.setInitialized=function(u){t=u},e[Rv]=function(u){i=u},e[Ai]=function(u,h){h?h[Ai](u):i&&Mt(i[ka])&&i[ka](u,null)},e._getTelCtx=a;function a(u){u===void 0&&(u=null);var h=u;if(!h){var f=r||Gs(null,{},e[Mr]);i&&i[lc]?h=f[ih](null,i[lc]):h=f[ih](null,i)}return h}function l(u,h,f){us(u,$se,xh(h)),!f&&h&&(f=h[VH]()[Aa]());var m=i;i&&i[lc]&&(m=i[lc]()),e[Mr]=h,r=Gs(f,u,h,m)}function c(){t=!1,e[Mr]=null,r=null,i=null,s=b8(),o=C8()}}return n.__ieDyn=1,n}();function Yse(n,e,t){var r={id:e,fn:t};up(n,r);var i={remove:function(){Ye(n,function(o,s){if(o.id===r.id)return n[Wm](s,1),-1})}};return i}function Kse(n,e,t){for(var r=!1,i=n[Ct],o=0;o<i;++o){var s=n[o];if(s)try{if(s.fn[rh](null,[e])===!1){r=!0;break}}catch(a){Fe(t,2,64,"Telemetry initializer failed: "+an(a),{exception:qe(a)},!0)}}return!r}var Xse=function(n){Wl(e,n);function e(){var t=n.call(this)||this;t.identifier="TelemetryInitializerPlugin",t.priority=199;var r,i;o(),In(e,t,function(s,a){s.addTelemetryInitializer=function(l){return Yse(i,r++,l)},s[ka]=function(l,c){Kse(i,l,c?c[wl]():s[wl]())&&s[Ai](l,c)},s[TS]=function(){o()}});function o(){r=0,i=[]}return t}return e.__ieDyn=1,e}($m),cc,A8="Plugins must provide initialize method",qse="_notificationManager",v5="SDK is still unloading...",Qse="SDK is not initialized",Zse=100,Jse=5e4,vb=Hm((cc={cookieCfg:{}},cc[Of]={rdOnly:!0,ref:!0,v:[]},cc[sd]={rdOnly:!0,ref:!0,v:[]},cc[Dp]={ref:!0,v:{}},cc[cR]=fa,cc.loggingLevelConsole=0,cc.diagnosticLogInterval=fa,cc));function eae(n,e){return new Dse(e)}function tae(n,e,t){var r,i=[],o=[],s={};return Ye(t,function(a){(Me(a)||Me(a[d_]))&&vo(A8);var l=a[bS],c=a[Ac];a&&l&&(Me(s[l])?s[l]=c:Od(n,"Two extensions have same priority #"+l+" - "+s[l]+", "+c)),!l||l<e?i[Zt](a):o[Zt](a)}),r={},r[Mr]=i,r[sd]=o,r}function _5(n,e){var t=!1;return Ye(e,function(r){if(r===n)return t=!0,-1}),t}function xR(n,e,t,r){t&&zt(t,function(i,o){r&&Ni(o)&&Ni(e[i])&&xR(n,e[i],o,r),r&&Ni(o)&&Ni(e[i])?xR(n,e[i],o,r):n.set(e,i,o)})}function x5(n,e){var t=null,r=-1;return Ye(n,function(i,o){if(i.w===e)return t=i,r=o,-1}),{i:r,l:t}}function nae(n,e){var t=x5(n,e).l;return t||(t={w:e,rm:function(){var r=x5(n,e);r.i!==-1&&n[Wm](r.i,1)}},n[Zt](t)),t}function rae(n,e,t){Ye(e,function(r){var i=pr(n,r.w,t);delete r.w,r.rm=function(){i.rm()}})}function iae(n,e,t,r){return e.add(n[Zc](function(i){var o=i.cfg.disableDbgExt;o===!0&&r&&(t[yS](r),r=null),t&&!r&&o!==!0&&(r=yse(i.cfg),t[wS](r))})),r}function oae(n){return en({rm:function(){n.rm()}},"toJSON",{v:function(){return"aicore::onCfgChange<"+JSON.stringify(n)+">"}})}var sae=function(){function n(){var e,t,r,i,o,s,a,l,c,u,h,f,m,g,_,v,p,x,y,w,C,T,S,b,R,E,A,F,D,M,k,z;In(n,this,function(P){X(),P._getDbgPlgTargets=function(){return[S,i]},P[ya]=function(){return t},P.activeStatus=function(){return E},P._setPendingStatus=function(){E=3},P[d_]=function(se,Ee,Te,Le){m&&vo(v5),P[ya]()&&vo("Core cannot be initialized more than once"),e=us(se,vb,Te||P[dr],!1),se=e.cfg,ot(e[Zc](function(I){var V=I.cfg,q=E===3;if(!q){F=V.initInMemoMaxSize||Zse;var ne=V[FD],Q=V.endpointUrl;if(Me(ne)){C=null,E=wc[HC];var he="Please provide instrumentation key";t?(Fe(r,1,100,he),Y()):vo(he);return}var me=[];if(_l(ne)?(me[Zt](ne),C=null):C=ne,_l(Q)?(me[Zt](Q),A=null):A=Q,me[Ct]){D=!1,E=3;var _e=Ld(V.initTimeOut)?V.initTimeOut:Jse,ze=yoe(me);ls(function(){D||U()},_e),Bl(ze,function(Ce){try{if(D)return;if(!Ce.rejected){var je=Ce[H0];if(je&&je[Ct]){var Qe=je[0];if(C=Qe&&Qe[H0],je[Ct]>1){var He=je[1];A=He&&He[H0]}}C&&(se[FD]=C,se.endpointUrl=A)}U()}catch{D||U()}})}else U();var pe=I.ref(I.cfg,Dp);zt(pe,function(Ce){I.ref(pe,Ce)})}})),o=Le,y=iae(e,x,o&&P[Px](),y),ft(),P[dr]=Te;var be=se[Of];if(u=[],u[Zt].apply(u,UD(UD([],Ee,!1),be)),h=se[sd],K(null),(!f||f[Ct]===0)&&vo("No "+sd+" available"),h&&h[Ct]>1){var G=P[Av]("TeeChannelController");(!G||!G.plugin)&&Fe(r,1,28,"TeeChannel required")}rae(se,T,r),T=null,t=!0,E===wc.ACTIVE&&Y()},P.getChannels=function(){var se=[];return f&&Ye(f,function(Ee){se[Zt](Ee)}),Ul(se)},P.track=function(se){FS(P[AS](),function(){return"AppInsightsCore:track"},function(){se===null&&($(se),vo("Invalid telemetry item")),!se[yl]&&Me(se[yl])&&($(se),vo("telemetry name required")),se[yg]=se[yg]||C,se[Lp]=se[Lp]||wm(new Date),se.ver=se.ver||"4.0",!m&&P[ya]()&&E===wc.ACTIVE?B()[Ai](se):E!==wc[HC]&&i[Ct]<=F&&i[Zt](se)},function(){return{item:se}},!se.sync)},P[VH]=B,P[Px]=function(){return o||(o=new Lse(e.cfg),P[qse]=o),o},P[wS]=function(se){P.getNotifyMgr()[wS](se)},P[yS]=function(se){o&&o[yS](se)},P.getCookieMgr=function(){return l||(l=$y(e.cfg,P[dr])),l},P.setCookieMgr=function(se){l!==se&&(fp(l,!1),l=se)},P[AS]=function(){return s||a||Use()},P.setPerfMgr=function(se){s=se},P.eventCnt=function(){return i[Ct]},P.releaseQueue=function(){if(t&&i[Ct]>0){var se=i;i=[],E===2?Ye(se,function(Ee){Ee[yg]=Ee[yg]||C,B()[Ai](Ee)}):Fe(r,2,20,"core init status is not active")}},P[jD]=function(se){return _=se||null,z=!1,M&&M[dp](),Z(!0)};function U(){D=!0,Me(C)?(E=wc[HC],Fe(r,1,112,"ikey can't be resolved from promises")):E=wc.ACTIVE,Y()}function Y(){t&&(P.releaseQueue(),P[jD]())}function Z(se){if((!M||!M[hp])&&!z){var Ee=se||r&&r.queue[Ct]>0;Ee&&(k||(k=!0,ot(e[Zc](function(Te){var Le=Te.cfg.diagnosticLogInterval;(!Le||!(Le>0))&&(Le=1e4);var be=!1;M&&(be=M[hp],M[dp]()),M=Jie(we,Le),M.unref(),M[hp]=be}))),M[hp]=!0)}return M}P[BD]=function(){z=!0,M&&M[dp](),we()},u0(P,function(){return g},["addTelemetryInitializer"]),P[cu]=function(se,Ee,Te){var Le;se===void 0&&(se=!0),t||vo(Qse),m&&vo(v5);var be=(Le={reason:50},Le[xm]=se,Le.flushComplete=!1,Le),G;se&&!Ee&&(G=uu(function(q){Ee=q}));var I=jS(fe(),P);I[kx](function(){x.run(P[dr]),_8([l,o,r],se,function(){X(),Ee&&Ee(be)})},P);function V(q){be.flushComplete=q,m=!0,p.run(I,be),P[BD](),I[Ai](be)}return we(),Ie(se,V,6,Te),G},P[Av]=ee,P.addPlugin=function(se,Ee,Te,Le){if(!se){Le&&Le(!1),pt(A8);return}var be=ee(se[Ac]);if(be&&!Ee){Le&&Le(!1),pt("Plugin ["+se[Ac]+"] is already loaded!");return}var G={reason:16};function I(ne){u[Zt](se),G.added=[se],K(G),Le&&Le(!0)}if(be){var V=[be.plugin],q={reason:2,isAsync:!!Te};ce(V,q,function(ne){ne?(G.removed=V,G.reason|=32,I()):Le&&Le(!1)})}else I()},P.updateCfg=function(se,Ee){Ee===void 0&&(Ee=!0);var Te;if(P[ya]()){Te={reason:1,cfg:e.cfg,oldCfg:PD({},e.cfg),newConfig:PD({},se),merge:Ee},se=Te.newConfig;var Le=e.cfg;se[Of]=Le[Of],se[sd]=Le[sd]}e._block(function(be){var G=be.cfg;xR(be,G,se,Ee),Ee||zt(G,function(I){Qc(se,I)||be.set(G,I,fa)}),be[Gm](G,vb)},!0),e[_S](),Te&&_t(Te)},P.evtNamespace=function(){return v},P.flush=Ie,P.getTraceCtx=function(se){return w||(w=Hse()),w},P.setTraceCtx=function(se){w=se||null},P.addUnloadHook=ot,RS(P,"addUnloadCb",function(){return p},"add"),P.onCfgChange=function(se){var Ee;return t?Ee=pr(e.cfg,se,P[dr]):Ee=nae(T,se),oae(Ee)},P.getWParam=function(){return TH()||e.cfg.enableWParam?0:-1};function j(){var se={};b=[];var Ee=function(Te){Te&&Ye(Te,function(Le){if(Le[Ac]&&Le[SS]&&!se[Le.identifier]){var be=Le[Ac]+"="+Le[SS];b[Zt](be),se[Le.identifier]=Le}})};Ee(f),h&&Ye(h,function(Te){Ee(Te)}),Ee(u)}function X(){t=!1,e=us({},vb,P[dr]),e.cfg[GH]=1,en(P,"config",{g:function(){return e.cfg},s:function(Ee){P.updateCfg(Ee,!1)}}),en(P,"pluginVersionStringArr",{g:function(){return b||j(),b}}),en(P,"pluginVersionString",{g:function(){return R||(b||j(),R=b.join(";")),R||Kt}}),en(P,"logger",{g:function(){return r||(r=new DS(e.cfg),e[dr]=r),r},s:function(Ee){e[dr]=Ee,r!==Ee&&(fp(r,!1),r=Ee)}}),P[dr]=new DS(e.cfg),S=[];var se=P.config[Of]||[];se.splice(0,se[Ct]),up(se,S),g=new Xse,i=[],fp(o,!1),o=null,s=null,a=null,fp(l,!1),l=null,c=null,u=[],h=null,f=null,m=!1,_=null,v=cs("AIBaseCore",!0),p=C8(),w=null,C=null,x=b8(),T=[],R=null,b=null,z=!1,M=null,k=!1,E=0,A=null,F=null,D=!1}function B(){var se=Gs(fe(),e.cfg,P);return se[kx](Z),se}function K(se){var Ee=tae(P[dr],mse,u);c=null,R=null,b=null,f=(h||[])[0]||[],f=mb(up(f,Ee[sd]));var Te=up(mb(Ee[Mr]),f);S=Ul(Te);var Le=P.config[Of]||[];Le.splice(0,Le[Ct]),up(Le,S);var be=B();f&&f[Ct]>0&&f5(be[ih](f),Te),f5(be,Te),se&&_t(se)}function ee(se){var Ee=null,Te=null,Le=[];return Ye(S,function(be){if(be[Ac]===se&&be!==g)return Te=be,-1;be.getChannel&&Le[Zt](be)}),!Te&&Le[Ct]>0&&Ye(Le,function(be){if(Te=be.getChannel(se),!Te)return-1}),Te&&(Ee={plugin:Te,setEnabled:function(be){Dd(Te)[uR]=!be},isEnabled:function(){var be=Dd(Te);return!be[tl]&&!be[uR]},remove:function(be,G){var I;be===void 0&&(be=!0);var V=[Te],q=(I={reason:1},I[xm]=be,I);ce(V,q,function(ne){ne&&K({reason:32,removed:V}),G&&G(ne)})}}),Ee}function fe(){if(!c){var se=(S||[]).slice();xi(se,g)===-1&&se[Zt](g),c=oh(mb(se),e.cfg,P)}return c}function ce(se,Ee,Te){if(se&&se[Ct]>0){var Le=oh(se,e.cfg,P),be=jS(Le,P);be[kx](function(){var G=!1,I=[];Ye(u,function(q,ne){_5(q,se)?G=!0:I[Zt](q)}),u=I,R=null,b=null;var V=[];h&&(Ye(h,function(q,ne){var Q=[];Ye(q,function(he){_5(he,se)?G=!0:Q[Zt](he)}),V[Zt](Q)}),h=V),Te&&Te(G),Z()}),be[Ai](Ee)}else Te(!1)}function we(){if(r&&r.queue){var se=r.queue.slice(0);r.queue[Ct]=0,Ye(se,function(Ee){var Te,Le=(Te={},Te[yl]=_||"InternalMessageId: "+Ee[ES],Te[yg]=C,Te[Lp]=wm(new Date),Te.baseType=Pv.dataType,Te.baseData={message:Ee[Pd]},Te);P.track(Le)})}}function Ie(se,Ee,Te,Le){var be=1,G=!1,I=null;Le=Le||5e3;function V(){be--,G&&be===0&&(I&&I[dp](),I=null,Ee&&Ee(G),Ee=null)}if(f&&f[Ct]>0){var q=B()[ih](f);q.iterate(function(ne){if(ne.flush){be++;var Q=!1;ne.flush(se,function(){Q=!0,V()},Te)||Q||(se&&I==null?I=ls(function(){I=null,V()},Le):V())}})}return G=!0,V(),!0}function ft(){var se;ot(e[Zc](function(Ee){var Te=Ee.cfg.enablePerfMgr;if(Te){var Le=Ee.cfg[cR];se!==Le&&(Le||(Le=eae),Ti(Ee.cfg,cR,Le),se=Le,a=null),!s&&!a&&Mt(Le)&&(a=Le(P,P[Px]()))}else a=null,se=null}))}function _t(se){var Ee=xk(fe(),P);Ee[kx](Z),(!P._updateHook||P._updateHook(Ee,se)!==!0)&&Ee[Ai](se)}function pt(se){var Ee=P[dr];Ee?(Fe(Ee,2,73,se),Z()):vo(se)}function $(se){var Ee=P[Px]();Ee&&Ee[G0]([se],2)}function ot(se){x.add(se)}})}return n.__ieDyn=1,n}();function _b(n,e){try{if(n&&n!==""){var t=Vs().parse(n);if(t&&t[VD]&&t[VD]>=t.itemsAccepted&&t.itemsReceived-t.itemsAccepted===t.errors[Ct])return t}}catch(r){Fe(e,1,43,"Cannot parse the response. "+(r[yl]||qe(r)),{response:n})}return null}var ta="",aae="NoResponseBody",y5="&"+aae+"=true",xb="POST",lae=function(){function n(){var e=0,t,r,i,o,s,a,l,c,u,h,f,m,g,_;In(n,this,function(v,p){var x=!0;D(),v[d_]=function(M,k){i=k,r&&Fe(i,1,28,"Sender is already initialized"),v.SetConfig(M),r=!0},v._getDbgPlgTargets=function(){return[r,o,a,t]},v.SetConfig=function(M){try{if(s=M.senderOnCompleteCallBack||{},a=!!M.disableCredentials,l=M.fetchCredentials,o=!!M.isOneDs,t=!!M.enableSendPromise,u=!!M.disableXhr,h=!!M.disableBeacon,f=!!M.disableBeaconSync,_=M.timeWrapper,g=!!M.addNoResponse,m=!!M.disableFetchKeepAlive,c={sendPOST:E},o||(x=!1),a){var k=wa();k&&k.protocol&&k.protocol[_m]()==="file:"&&(x=!1)}return!0}catch{}return!1},v.getSyncFetchPayload=function(){return e},v.getSenderInst=function(M,k){return M&&M[Ct]?T(M,k):null},v.getFallbackInst=function(){return c},v[TS]=function(M,k){D()};function y(M,k){S(k,200,{},M)}function w(M,k){Fe(i,2,26,"Failed to send telemetry.",{message:M}),S(k,400,{})}function C(M){w("No endpoint url is provided for the batch",M)}function T(M,k){for(var z,P=0,U=null,Y=0;U==null&&Y<M[Ct];)P=M[Y],!u&&P===1?Koe()?U=F:m1()&&(U=E):P===2&&ck(k)&&(!k||!m)?U=A:P===3&&d0()&&(k?!f:!h)&&(U=R),Y++;return U?(z={_transport:P,_isSync:k},z[GD]=U,z):null}function S(M,k,z,P){try{M&&M(k,z,P)}catch{}}function b(M,k){var z=ja(),P=M[wg];if(!P)return C(k),!0;P=M[wg]+(g?y5:ta);var U=M[Lf],Y=o?U:new Blob([U],{type:"text/plain;charset=UTF-8"}),Z=z.sendBeacon(P,Y);return Z}function R(M,k,z){var P=M[Lf];try{if(P)if(b(M,k))y(ta,k);else{var U=s&&s.beaconOnRetry;U&&Mt(U)?U(M,k,b):(c&&c[GD](M,k,!0),Fe(i,2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}catch(Y){o&&Od(i,"Failed to send telemetry using sendBeacon API. Ex:"+qe(Y)),S(k,o?0:400,{},ta)}}function E(M,k,z){var P,U,Y,Z=M[GC]||{};!z&&t&&(P=uu(function(K,ee){U=K,Y=ee})),o&&z&&M.disableXhrSync&&(z=!1);var j=M[wg];if(!j){C(k),U&&U(!1);return}var X=Poe(xb,j,x,!0,z,M[qh]);o||X[WD]("Content-type","application/json"),Ye(xl(Z),function(K){X[WD](K,Z[K])}),X.onreadystatechange=function(){o||(B(X),X.readyState===4&&U&&U(!0))},X.onload=function(){o&&B(X)};function B(K){var ee=s&&s.xhrOnComplete,fe=ee&&Mt(ee);if(fe)ee(K,k,M);else{var ce=NS(K);S(k,K[c0],rb(K,o),ce)}}return X.onerror=function(K){S(k,o?X[c0]:400,rb(X,o),o?ta:IS(X)),Y&&Y(K)},X.ontimeout=function(){S(k,o?X[c0]:500,rb(X,o),o?ta:IS(X)),U&&U(!1)},X.send(M[Lf]),P}function A(M,k,z){var P,U=M[wg],Y=M[Lf],Z=o?Y:new Blob([Y],{type:"application/json"}),j,X,B,K=new Headers,ee=Y[Ct],fe=!1,ce=!1,we=M[GC]||{},Ie=(P={method:xb,body:Z},P[QD]=!0,P);M.headers&&xl(M.headers)[Ct]>0&&(Ye(xl(we),function($){K.append($,we[$])}),Ie[GC]=K),l?Ie.credentials=l:x&&o&&(Ie.credentials="include"),z&&(Ie.keepalive=!0,e+=ee,o?M._sendReason===2&&(fe=!0,g&&(U+=y5)):fe=!0);var ft=new Request(U,Ie);try{ft[QD]=!0}catch{}if(!z&&t&&(j=uu(function($,ot){X=$,B=ot})),!U){C(k),X&&X(!1);return}function _t($){S(k,o?0:400,{},o?ta:$)}function pt($,ot,se){var Ee=$[c0],Te=s.fetchOnComplete;Te&&Mt(Te)?Te($,k,se||ta,ot):S(k,Ee,{},se||ta)}try{Bl(fetch(o?U:ft,o?Ie:null),function($){if(z&&(e-=ee,ee=0),!ce)if(ce=!0,$.rejected)_t($.reason&&$.reason[Pd]),B&&B($.reason);else{var ot=$[H0];try{!o&&!ot.ok?(_t(ot.statusText),X&&X(!1)):o&&!ot.body?(pt(ot,null,ta),X&&X(!0)):Bl(ot.text(),function(se){pt(ot,M,se[H0]),X&&X(!0)})}catch(se){_t(qe(se)),B&&B(se)}}})}catch($){ce||(_t(qe($)),B&&B($))}return fe&&!ce&&(ce=!0,S(k,200,{}),X&&X(!0)),o&&!ce&&M[qh]>0&&_&&_.set(function(){ce||(ce=!0,S(k,500,{}),X&&X(!0))},M[qh]),j}function F(M,k,z){var P=Mo(),U=new XDomainRequest,Y=M[Lf];U.onload=function(){var K=NS(U),ee=s&&s.xdrOnComplete;ee&&Mt(ee)?ee(U,k,M):S(k,200,{},K)},U.onerror=function(){S(k,400,{},o?ta:n8(U))},U.ontimeout=function(){S(k,500,{})},U.onprogress=function(){};var Z=P&&P.location&&P.location[WH]||"",j=M[wg];if(!j){C(k);return}if(!o&&j.lastIndexOf(Z,0)!==0){var X="Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol.";Fe(i,2,40,". "+X),w(X,k);return}var B=o?j:j[kd](/^(https?:)/,"");U.open(xb,B),M[qh]&&(U[qh]=M[qh]),U.send(Y),o&&z?_&&_.set(function(){U.send(Y)},0):U.send(Y)}function D(){e=0,r=!1,t=!1,i=null,o=null,s=null,a=null,l=null,c=null,u=!1,h=!1,f=!1,m=!1,g=!1,_=null}})}return n.__ieDyn=1,n}(),M8="on",w5="attachEvent",S5="addEventListener",E5="detachEvent",T5="removeEventListener",yR="events",wR="visibilitychange",v1="pagehide",R8="unload",N8="beforeunload",I8=cs("aiEvtPageHide");cs("aiEvtPageShow");var cae=/\.[\.]+/g,uae=/[\.]+$/,dae=1,BS=f8("events"),hae=/^([^.]*)(?:\.(.+)|)/;function C5(n){return n&&n[kd]?n[kd](/^[\s\.]+|(?=[\s\.])[\.\s]+$/g,Kt):n}function yk(n,e){var t;if(e){var r=Kt;Ft(e)?(r=Kt,Ye(e,function(o){o=C5(o),o&&(o[0]!=="."&&(o="."+o),r+=o)})):r=C5(e),r&&(r[0]!=="."&&(r="."+r),n=(n||Kt)+r)}var i=hae.exec(n||Kt)||[];return t={},t[Sl]=i[1],t.ns=(i[2]||Kt).replace(cae,".").replace(uae,Kt)[ym](".").sort().join("."),t}function P8(n,e,t){t===void 0&&(t=!0);var r=BS.get(n,yR,{},t),i=r[e];return i||(i=r[e]=[]),i}function k8(n,e,t,r){n&&e&&e[Sl]&&(n[T5]?n[T5](e[Sl],t,r):n[E5]&&n[E5](M8+e[Sl],t))}function fae(n,e,t,r){var i=!1;return n&&e&&e[Sl]&&t&&(n[S5]?(n[S5](e[Sl],t,r),i=!0):n[w5]&&(n[w5](M8+e[Sl],t),i=!0)),i}function b5(n,e,t,r){for(var i=e[Ct];i--;){var o=e[i];o&&(!t.ns||t.ns===o.evtName.ns)&&(!r||r(o))&&(k8(n,o.evtName,o[ak],o.capture),e[Wm](i,1))}}function pae(n,e,t){if(e[Sl])b5(n,P8(n,e[Sl]),e,t);else{var r=BS.get(n,yR,{});zt(r,function(i,o){b5(n,o,e,t)}),xl(r)[Ct]===0&&BS.kill(n,yR)}}function Su(n,e){var t;return e?(Ft(e)?t=[n].concat(e):t=[n,e],t=yk("xx",t).ns[ym](".")):t=n,t}function El(n,e,t,r,i){var o;i===void 0&&(i=!1);var s=!1;if(n)try{var a=yk(e,r);if(s=fae(n,a,t,i),s&&BS.accept(n)){var l=(o={guid:dae++,evtName:a},o[ak]=t,o.capture=i,o);P8(n,a.type)[Zt](l)}}catch{}return s}function Fp(n,e,t,r,i){if(i===void 0&&(i=!1),n)try{var o=yk(e,r),s=!1;pae(n,o,function(a){return o.ns&&!t||a[ak]===t?(s=!0,!0):!1}),s||k8(n,o,t,i)}catch{}}function mae(n,e,t){var r=!1,i=Mo();i&&(r=El(i,n,e,t),r=El(i.body,n,e,t)||r);var o=Qr();return o&&(r=El(o,n,e,t)||r),r}function gae(n,e,t){var r=Mo();r&&(Fp(r,n,e,t),Fp(r.body,n,e,t));var i=Qr();i&&Fp(i,n,e,t)}function zS(n,e,t,r){var i=!1;return e&&n&&n[Ct]>0&&Ye(n,function(o){o&&(!t||xi(t,o)===-1)&&(i=mae(o,e,r)||i)}),i}function vae(n,e,t,r){var i=!1;return e&&n&&Ft(n)&&(i=zS(n,e,t,r),!i&&t&&t[Ct]>0&&(i=zS(n,e,null,r))),i}function SR(n,e,t){n&&Ft(n)&&Ye(n,function(r){r&&gae(r,e,t)})}function _ae(n,e,t){return vae([N8,R8,v1],n,e,t)}function xae(n,e){SR([N8,R8,v1],n,e)}function ER(n,e,t){function r(s){var a=Qr();n&&a&&a.visibilityState==="hidden"&&n(s)}var i=Su(I8,t),o=zS([v1],n,e,i);return(!e||xi(e,wR)===-1)&&(o=zS([wR],r,e,i)||o),!o&&e&&(o=ER(n,null,t)),o}function yae(n,e){var t=Su(I8,e);SR([v1],n,t),SR([wR],null,t)}var A5="_aiHooks",M5=["req","rsp","hkErr","fnErr"];function wk(n,e){if(n)for(var t=0;t<n[Ct]&&!e(n[t],t);t++);}function yb(n,e,t,r,i){i>=0&&i<=2&&wk(n,function(o,s){var a=o.cbks,l=a[M5[i]];if(l){e.ctx=function(){var h=r[s]=r[s]||{};return h};try{l[rh](e.inst,t)}catch(h){var c=e.err;try{var u=a[M5[2]];u&&(e.err=h,u[rh](e.inst,t))}catch{}finally{e.err=c}}}})}function wae(n){return function(){var e,t=this,r=arguments,i=n.h,o=(e={},e[yl]=n.n,e.inst=t,e.ctx=null,e.set=c,e),s=[],a=l([o],r);o.evt=or("event");function l(h,f){return wk(f,function(m){h[Zt](m)}),h}function c(h,f){r=l([],r),r[h]=f,a=l([o],r)}yb(i,o,a,s,0);var u=n.f;if(u)try{o.rslt=u[rh](t,r)}catch(h){throw o.err=h,yb(i,o,a,s,3),h}return yb(i,o,a,s,1),o.rslt}}function Sk(n,e,t,r){var i=null;return n&&(as(n,e)?i=n:t&&(i=Sk(Aoe(n),e,r,!1))),i}function Sae(n,e,t){return n?TR(n[ba],e,t,!1):null}function L8(n,e,t,r){var i=t&&t[A5];if(!i){i={i:0,n:e,f:t,h:[]};var o=wae(i);o[A5]=i,n[e]=o}var s={id:i.i,cbks:r,rm:function(){var a=this.id;wk(i.h,function(l,c){if(l.id===a)return i.h[Wm](c,1),1})}};return i.i++,i.h[Zt](s),s}function TR(n,e,t,r,i){if(r===void 0&&(r=!0),n&&e&&t){var o=Sk(n,e,r,i);if(o){var s=o[e];if(typeof s===FH)return L8(o,e,s,t)}}return null}function Fx(n,e,t,r,i){if(n&&e&&t){var o=Sk(n,e,r,i)||n;if(o)return L8(o,e,o[e],t)}return null}var jx="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",O8="sampleRate",wb="ProcessLegacy",R5="http.method",Ek="https://dc.services.visualstudio.com",jp="/v2/track",La="not_specified",Sb="iKey",xn=coe({requestContextHeader:[0,"Request-Context"],requestContextTargetKey:[1,"appId"],requestContextAppIdFormat:[2,"appId=cid-v1:"],requestIdHeader:[3,"Request-Id"],traceParentHeader:[4,"traceparent"],traceStateHeader:[5,"tracestate"],sdkContextHeader:[6,"Sdk-Context"],sdkContextHeaderAppIdRequest:[7,"appId"],requestContextHeaderLowerCase:[8,"request-context"]}),Sm="split",It="length",kv="toLowerCase",Lu="ingestionendpoint",Em="toString",_1="push",Tk="removeItem",Ws="name",Fc="message",Df="count",Eb="preTriggerDate",Tb="disabled",Cb="interval",N5="daysOfMonth",bb="date",Ab="getUTCDate",HS="stringify",Mb="pathname",I5="correlationHeaderExcludePatterns",Jh="exceptions",xs="parsedStack",Sa="properties",Tl="measurements",Bp="sizeInBytes",qa="typeName",p0="severityLevel",Rb="problemGroup",Nb="isManual",D8="CreateFromInterface",mp="assembly",ad="fileName",Ky="hasFullStack",Bx="level",ef="method",Tg="line",VS="duration",P5="receivedResponse";function U8(n,e,t){var r=e[It],i=Eae(n,e);if(i[It]!==r){for(var o=0,s=i;t[s]!==void 0;)o++,s=Fa(i,0,147)+bae(o);i=s}return i}function Eae(n,e){var t;return e&&(e=Er($i(e)),e[It]>150&&(t=Fa(e,0,150),Fe(n,2,57,"name is too long.  It has been truncated to 150 characters.",{name:e},!0))),t||e}function Cr(n,e,t){t===void 0&&(t=1024);var r;return e&&(t=t||1024,e=Er($i(e)),e[It]>t&&(r=Fa(e,0,t),Fe(n,2,61,"string value is too long. It has been truncated to "+t+" characters.",{value:e},!0))),r||e}function x1(n,e){return j8(n,e,2048,66)}function F8(n,e){var t;return e&&e[It]>32768&&(t=Fa(e,0,32768),Fe(n,2,56,"message is too long, it has been truncated to 32768 characters.",{message:e},!0)),t||e}function Tae(n,e){var t;if(e){var r=""+e;r[It]>32768&&(t=Fa(r,0,32768),Fe(n,2,52,"exception is too long, it has been truncated to 32768 characters.",{exception:e},!0))}return t||e}function yh(n,e){if(e){var t={};zt(e,function(r,i){if(Zi(i)&&h_())try{i=Vs()[HS](i)}catch(o){Fe(n,2,49,"custom property is not valid",{exception:o},!0)}i=Cr(n,i,8192),r=U8(n,r,t),t[r]=i}),e=t}return e}function wh(n,e){if(e){var t={};zt(e,function(r,i){r=U8(n,r,t),t[r]=i}),e=t}return e}function Cae(n,e){return e&&j8(n,e,128,69)[Em]()}function j8(n,e,t,r){var i;return e&&(e=Er($i(e)),e[It]>t&&(i=Fa(e,0,t),Fe(n,2,r,"input is too long, it has been truncated to "+t+" characters.",{data:e},!0))),i||e}function bae(n){var e="00"+n;return bc(e,e[It]-3)}var k5=Qr()||{},L5=0,Aae=[null,null,null,null,null];function Ck(n){var e=L5,t=Aae,r=t[e];return k5.createElement?t[e]||(r=t[e]=k5.createElement("a")):r={host:Nae(n)},r.href=n,e++,e>=t[It]&&(e=0),L5=e,r}function Mae(n){var e,t=Ck(n);return t&&(e=t.href),e}function Rae(n,e){return n?n.toUpperCase()+" "+e:e}function Nae(n,e){var t=B8(n)||"";if(t){var r=t.match(/(www\d{0,5}\.)?([^\/:]{1,256})(:\d{1,20})?/i);if(r!=null&&r[It]>3&&ht(r[2])&&r[2][It]>0)return r[2]+(r[3]||"")}return t}function B8(n,e){var t=null;if(n){var r=n.match(/(\w{1,150}):\/\/([^\/:]{1,256})(:\d{1,20})?/i);if(r!=null&&r[It]>2&&ht(r[2])&&r[2][It]>0&&(t=r[2]||"",r[It]>2)){var i=(r[1]||"")[kv](),o=r[3]||"";(i==="http"&&o===":80"||i==="https"&&o===":443")&&(o=""),t+=o}}return t}var Iae=[Ek+jp,"https://breeze.aimon.applicationinsights.io"+jp,"https://dc-int.services.visualstudio.com"+jp],Pae="cid-v1:";function CR(n){return xi(Iae,n[kv]())!==-1}function O5(n,e,t){if(!e||n&&n.disableCorrelationHeaders)return!1;if(n&&n[I5]){for(var r=0;r<n.correlationHeaderExcludePatterns[It];r++)if(n[I5][r].test(e))return!1}var i=Ck(e).host[kv]();if(i&&(Yi(i,":443")!==-1||Yi(i,":80")!==-1)&&(i=(B8(e)||"")[kv]()),(!n||!n.enableCorsCorrelation)&&i&&i!==t)return!1;var o=n&&n.correlationHeaderDomains;if(o){var s;if(Ye(o,function(c){var u=new RegExp(c.toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"));s=s||u.test(i)}),!s)return!1}var a=n&&n.correlationHeaderExcludedDomains;if(!a||a[It]===0)return!0;for(var r=0;r<a[It];r++){var l=new RegExp(a[r].toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"));if(l.test(i))return!1}return i&&i[It]>0}function D5(n){if(n){var e=kae(n,xn[1]);if(e&&e!==Pae)return e}}function kae(n,e){if(n)for(var t=n[Sm](","),r=0;r<t[It];++r){var i=t[r][Sm]("=");if(i[It]===2&&i[0]===e)return i[1]}}function Lae(n,e,t,r){var i,o=r,s=r;if(e&&e[It]>0){var a=Ck(e);if(i=a.host,!o)if(a[Mb]!=null){var l=a.pathname[It]===0?"/":a[Mb];l.charAt(0)!=="/"&&(l="/"+l),s=a[Mb],o=Cr(n,t?t+" "+l:l)}else o=Cr(n,e)}else i=r,o=r;return{target:i,name:o,data:s}}function zx(){var n=Fl();if(n&&n.now&&n.timing){var e=n.now()+n.timing.navigationStart;if(e>0)return e}return Pa()}function Bi(n,e){var t=null;return n!==0&&e!==0&&!Me(n)&&!Me(e)&&(t=e-n),t}function bk(n,e){var t=n||{};return{getName:function(){return t[Ws]},setName:function(r){e&&e.setName(r),t[Ws]=r},getTraceId:function(){return t.traceID},setTraceId:function(r){e&&e.setTraceId(r),gk(r)&&(t.traceID=r)},getSpanId:function(){return t.parentID},setSpanId:function(r){e&&e.setSpanId(r),vk(r)&&(t.parentID=r)},getTraceFlags:function(){return t.traceFlags},setTraceFlags:function(r){e&&e.setTraceFlags(r),t.traceFlags=r}}}var p_=zH({LocalStorage:0,SessionStorage:1}),eu=void 0,tu=void 0,z8="";function Ak(){return w1()?y1(p_.LocalStorage):null}function y1(n){try{if(Me(rs()))return null;var e=new Date()[Em](),t=or(n===p_.LocalStorage?"localStorage":"sessionStorage"),r=z8+e;t.setItem(r,e);var i=t.getItem(r)!==e;if(t[Tk](r),!i)return t}catch{}return null}function Mk(){return Lv()?y1(p_.SessionStorage):null}function Oae(){eu=!1,tu=!1}function Rk(n){z8=n||""}function Dae(){eu=w1(!0),tu=Lv(!0)}function w1(n){return(n||eu===void 0)&&(eu=!!y1(p_.LocalStorage)),eu}function H8(n,e){var t=Ak();if(t!==null)try{return t.getItem(e)}catch(r){eu=!1,Fe(n,2,1,"Browser failed read of local storage. "+an(r),{exception:qe(r)})}return null}function V8(n,e,t){var r=Ak();if(r!==null)try{return r.setItem(e,t),!0}catch(i){eu=!1,Fe(n,2,3,"Browser failed write to local storage. "+an(i),{exception:qe(i)})}return!1}function Uae(n,e){var t=Ak();if(t!==null)try{return t[Tk](e),!0}catch(r){eu=!1,Fe(n,2,5,"Browser failed removal of local storage item. "+an(r),{exception:qe(r)})}return!1}function Lv(n){return(n||tu===void 0)&&(tu=!!y1(p_.SessionStorage)),tu}function bR(n,e){var t=Mk();if(t!==null)try{return t.getItem(e)}catch(r){tu=!1,Fe(n,2,2,"Browser failed read of session storage. "+an(r),{exception:qe(r)})}return null}function G8(n,e,t){var r=Mk();if(r!==null)try{return r.setItem(e,t),!0}catch(i){tu=!1,Fe(n,2,4,"Browser failed write to session storage. "+an(i),{exception:qe(i)})}return!1}function W8(n,e){var t=Mk();if(t!==null)try{return t[Tk](e),!0}catch(r){tu=!1,Fe(n,2,6,"Browser failed removal of session storage item. "+an(r),{exception:qe(r)})}return!1}var Fae="appInsightsThrottle",jae=function(){function n(e,t){var r=this,i,o,s,a,l,c,u,h=!1,f=!1;g(),r._getDbgPlgTargets=function(){return[u]},r.getConfig=function(){return s},r.canThrottle=function(M){var k=A(M),z=_(M);return x(z,i,k)},r.isTriggered=function(M){return F(M)},r.isReady=function(){return h},r.flush=function(M){try{var k=D(M);if(k&&k[It]>0){var z=k.slice(0);return u[M]=[],Ye(z,function(P){m(P.msgID,P[Fc],P.severity,!1)}),!0}}catch{}return!1},r.flushAll=function(){try{if(u){var M=!0;return zt(u,function(k){var z=r.flush(parseInt(k));M=M&&z}),M}}catch{}return!1},r.onReadyState=function(M,k){return k===void 0&&(k=!0),h=Me(M)?!0:M,h&&k?r.flushAll():null},r.sendMessage=function(M,k,z){return m(M,k,z,!0)};function m(M,k,z,P){if(h){var U=E(M);if(!U)return;var Y=_(M),Z=A(M),j=x(Y,i,Z),X=!1,B=0,K=F(M);try{j&&!K?(B=Math.min(Y.limit.maxSendNumber,Z[Df]+1),Z[Df]=0,X=!0,l[M]=!0,Z[Eb]=new Date):(l[M]=j,Z[Df]+=1);var ee=y(M);S(o,ee,Z);for(var fe=0;fe<B;fe++)R(M,o,k,z)}catch{}return{isThrottled:X,throttleNum:B}}else if(P){var ce=D(M);ce[_1]({msgID:M,message:k,severity:z})}return null}function g(){o=xh(e),l={},a={},u={},s={},v(109),c=Ld(t)?t:"",e.addUnloadHook(pr(e.config,function(M){var k=M.cfg;i=w1();var z=k.throttleMgrCfg||{};zt(z,function(P,U){v(parseInt(P),U)})}))}function _(M){return s[M]||s[109]}function v(M,k){var z,P;try{var U=k||{},Y={};Y[Tb]=!!U[Tb];var Z=U[Cb]||{};f=(Z==null?void 0:Z.daysOfMonth)&&(Z==null?void 0:Z.daysOfMonth[It])>0,Y[Cb]=p(Z);var j={samplingRate:((z=U.limit)===null||z===void 0?void 0:z.samplingRate)||100,maxSendNumber:((P=U.limit)===null||P===void 0?void 0:P.maxSendNumber)||1};Y.limit=j,s[M]=Y}catch{}}function p(M){M=M||{};var k=M==null?void 0:M.monthInterval,z=M==null?void 0:M.dayInterval;return Me(k)&&Me(z)&&(M.monthInterval=3,f||(M[N5]=[28],f=!0)),M={monthInterval:M==null?void 0:M.monthInterval,dayInterval:M==null?void 0:M.dayInterval,daysOfMonth:M==null?void 0:M.daysOfMonth},M}function x(M,k,z){if(M&&!M[Tb]&&k&&Ld(z)){var P=T(),U=z[bb],Y=M[Cb],Z=1;if(Y!=null&&Y.monthInterval){var j=(P.getUTCFullYear()-U.getUTCFullYear())*12+P.getUTCMonth()-U.getUTCMonth();Z=b(Y.monthInterval,0,j)}var X=1;if(f)X=xi(Y[N5],P[Ab]());else if(Y!=null&&Y.dayInterval){var B=Math.floor((P.getTime()-U.getTime())/864e5);X=b(Y.dayInterval,0,B)}return Z>=0&&X>=0}return!1}function y(M,k){var z=Ld(k)?k:"";return M?Fae+z+"-"+M:null}function w(M){try{if(M){var k=new Date;return M.getUTCFullYear()===k.getUTCFullYear()&&M.getUTCMonth()===k.getUTCMonth()&&M[Ab]()===k[Ab]()}}catch{}return!1}function C(M,k,z){try{var P={date:T(),count:0};if(M){var U=JSON.parse(M),Y={date:T(U[bb])||P[bb],count:U[Df]||P[Df],preTriggerDate:U.preTriggerDate?T(U[Eb]):void 0};return Y}else return S(k,z,P),P}catch{}return null}function T(M){try{if(M){var k=new Date(M);if(!isNaN(k.getDate()))return k}else return new Date}catch{}return null}function S(M,k,z){try{return V8(M,k,Er(JSON[HS](z)))}catch{}return!1}function b(M,k,z){return M<=0?1:z>=k&&(z-k)%M==0?Math.floor((z-k)/M)+1:-1}function R(M,k,z,P){Fe(k,P||1,M,z)}function E(M){try{var k=_(M);return ese(1e6)<=k.limit.samplingRate}catch{}return!1}function A(M){try{var k=a[M];if(!k){var z=y(M,c);k=C(H8(o,z),o,z),a[M]=k}return a[M]}catch{}return null}function F(M){var k=l[M];if(Me(k)){k=!1;var z=A(M);z&&(k=w(z[Eb])),l[M]=k}return l[M]}function D(M){return u=u||{},Me(u[M])&&(u[M]=[]),u[M]}}return n}(),Bae=";",zae="=";function U5(n){if(!n)return{};var e=n[Sm](Bae),t=Lie(e,function(i,o){var s=o[Sm](zae);if(s[It]===2){var a=s[0][kv](),l=s[1];i[a]=l}return i},{});if(xl(t)[It]>0){if(t.endpointsuffix){var r=t.location?t.location+".":"";t[Lu]=t[Lu]||"https://"+r+"dc."+t.endpointsuffix}t[Lu]=t[Lu]||Ek,OH(t[Lu],"/")&&(t[Lu]=t[Lu].slice(0,-1))}return t}var Hae=function(){function n(e,t,r){var i=this,o=this;o.ver=1,o.sampleRate=100,o.tags={},o[Ws]=Cr(e,r)||La,o.data=t,o.time=wm(new Date),o.aiDataContract={time:1,iKey:1,name:1,sampleRate:function(){return i.sampleRate===100?4:1},tags:1,data:1}}return n}(),Mc=function(){function n(e,t,r,i){this.aiDataContract={ver:1,name:1,properties:0,measurements:0};var o=this;o.ver=2,o[Ws]=Cr(e,t)||La,o[Sa]=yh(e,r),o[Tl]=wh(e,i)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Event",n.dataType="EventData",n}(),Vae="<no_method>",zp="error",Hi="stack",AR="stackDetails",F5="errorSrc",MR="message",$8="description";function RR(n,e){var t=n;return t&&!ht(t)&&(JSON&&JSON[HS]?(t=JSON[HS](n),e&&(!t||t==="{}")&&(Mt(n[Em])?t=n[Em]():t=""+n)):t=""+n+" - (Missing JSON.stringify)"),t||""}function Y8(n,e){var t=n;return n&&(t&&!ht(t)&&(t=n[MR]||n[$8]||t),t&&!ht(t)&&(t=RR(t,!0)),n.filename&&(t=t+" @"+(n.filename||"")+":"+(n.lineno||"?")+":"+(n.colno||"?"))),e&&e!=="String"&&e!=="Object"&&e!=="Error"&&Yi(t||"",e)===-1&&(t=e+": "+t),t||""}function Gae(n){try{if(Zi(n))return"hasFullStack"in n&&"typeName"in n}catch{}return!1}function Wae(n){try{if(Zi(n))return"ver"in n&&"exceptions"in n&&"properties"in n}catch{}return!1}function j5(n){return n&&n.src&&ht(n.src)&&n.obj&&Ft(n.obj)}function Ou(n){var e=n||"";ht(e)||(ht(e[Hi])?e=e[Hi]:e=""+e);var t=e[Sm](`
`);return{src:e,obj:t}}function $ae(n){for(var e=[],t=n[Sm](`
`),r=0;r<t[It];r++){var i=t[r];t[r+1]&&(i+="@"+t[r+1],r++),e[_1](i)}return{src:n,obj:e}}function K8(n){var e=null;if(n)try{if(n[Hi])e=Ou(n[Hi]);else if(n[zp]&&n[zp][Hi])e=Ou(n[zp][Hi]);else if(n.exception&&n.exception[Hi])e=Ou(n.exception[Hi]);else if(j5(n))e=n;else if(j5(n[AR]))e=n[AR];else if(Mo()&&Mo().opera&&n[MR])e=$ae(n[Fc]);else if(n.reason&&n.reason[Hi])e=Ou(n.reason[Hi]);else if(ht(n))e=Ou(n);else{var t=n[MR]||n[$8]||"";ht(n[F5])&&(t&&(t+=`
`),t+=" from "+n[F5]),t&&(e=Ou(t))}}catch(r){e=Ou(r)}return e||{src:"",obj:null}}function Yae(n){var e="";return n&&(n.obj?Ye(n.obj,function(t){e+=t+`
`}):e=n.src||""),e}function Kae(n){var e,t=n.obj;if(t&&t[It]>0){e=[];var r=0,i=0;Ye(t,function(g){var _=g[Em]();if(NR.regex.test(_)){var v=new NR(_,r++);i+=v[Bp],e[_1](v)}});var o=32*1024;if(i>o)for(var s=0,a=e[It]-1,l=0,c=s,u=a;s<a;){var h=e[s][Bp],f=e[a][Bp];if(l+=h+f,l>o){var m=u-c+1;e.splice(c,m);break}c=s,u=a,s++,a--}}return e}function GS(n){var e="";if(n&&(e=n.typeName||n[Ws]||"",!e))try{var t=/function (.{1,200})\(/,r=t.exec(n.constructor[Em]());e=r&&r[It]>1?r[1]:""}catch{}return e}function Ib(n){if(n)try{if(!ht(n)){var e=GS(n),t=RR(n,!1);return(!t||t==="{}")&&(n[zp]&&(n=n[zp],e=GS(n)),t=RR(n,!0)),Yi(t,e)!==0&&e!=="String"?e+":"+t:t}}catch{}return""+(n||"")}var Wo=function(){function n(e,t,r,i,o,s){this.aiDataContract={ver:1,exceptions:1,severityLevel:0,properties:0,measurements:0};var a=this;a.ver=2,Wae(t)?(a[Jh]=t[Jh]||[],a[Sa]=t[Sa],a[Tl]=t[Tl],t[p0]&&(a[p0]=t[p0]),t.id&&(a.id=t.id,t[Sa].id=t.id),t[Rb]&&(a[Rb]=t[Rb]),Me(t[Nb])||(a[Nb]=t[Nb])):(r||(r={}),s&&(r.id=s),a[Jh]=[new B5(e,t,r)],a[Sa]=yh(e,r),a[Tl]=wh(e,i),o&&(a[p0]=o),s&&(a.id=s))}return n.CreateAutoException=function(e,t,r,i,o,s,a,l){var c,u=GS(o||s||e);return c={},c[Fc]=Y8(e,u),c.url=t,c.lineNumber=r,c.columnNumber=i,c.error=Ib(o||s||e),c.evt=Ib(s||e),c[qa]=u,c.stackDetails=K8(a||o||s),c.errorSrc=l,c},n.CreateFromInterface=function(e,t,r,i){var o=t[Jh]&&z0(t[Jh],function(a){return B5[D8](e,a)}),s=new n(e,Ii(Ii({},t),{exceptions:o}),r,i);return s},n.prototype.toInterface=function(){var e,t=this,r=t.exceptions,i=t.properties,o=t.measurements,s=t.severityLevel,a=t.problemGroup,l=t.id,c=t.isManual,u=r instanceof Array&&z0(r,function(h){return h.toInterface()})||void 0;return e={ver:"4.0"},e[Jh]=u,e.severityLevel=s,e.properties=i,e.measurements=o,e.problemGroup=a,e.id=l,e.isManual=c,e},n.CreateSimpleException=function(e,t,r,i,o,s){var a;return{exceptions:[(a={},a[Ky]=!0,a.message=e,a.stack=o,a.typeName=t,a)]}},n.envelopeType="Microsoft.ApplicationInsights.{0}.Exception",n.dataType="ExceptionData",n.formatError=Ib,n}(),B5=function(){function n(e,t,r){this.aiDataContract={id:0,outerId:0,typeName:1,message:1,hasFullStack:0,stack:0,parsedStack:2};var i=this;if(Gae(t))i[qa]=t[qa],i[Fc]=t[Fc],i[Hi]=t[Hi],i[xs]=t[xs]||[],i[Ky]=t[Ky];else{var o=t,s=o&&o.evt;$P(o)||(o=o[zp]||s||o),i[qa]=Cr(e,GS(o))||La,i[Fc]=F8(e,Y8(t||o,i[qa]))||La;var a=t[AR]||K8(t);i[xs]=Kae(a),Ft(i[xs])&&z0(i[xs],function(l){l[mp]=Cr(e,l[mp]),l[ad]=Cr(e,l[ad])}),i[Hi]=Tae(e,Yae(a)),i.hasFullStack=Ft(i.parsedStack)&&i.parsedStack[It]>0,r&&(r[qa]=r[qa]||i[qa])}}return n.prototype.toInterface=function(){var e,t=this,r=t[xs]instanceof Array&&z0(t[xs],function(o){return o.toInterface()}),i=(e={id:t.id,outerId:t.outerId,typeName:t[qa],message:t[Fc],hasFullStack:t[Ky],stack:t[Hi]},e[xs]=r||void 0,e);return i},n.CreateFromInterface=function(e,t){var r=t[xs]instanceof Array&&z0(t[xs],function(o){return NR[D8](o)})||t[xs],i=new n(e,Ii(Ii({},t),{parsedStack:r}));return i},n}(),NR=function(){function n(e,t){this.aiDataContract={level:1,method:1,assembly:0,fileName:0,line:0};var r=this;if(r[Bp]=0,typeof e=="string"){var i=e;r[Bx]=t,r[ef]=Vae,r[mp]=Er(i),r[ad]="",r[Tg]=0;var o=i.match(n.regex);o&&o[It]>=5&&(r[ef]=Er(o[2])||r[ef],r[ad]=Er(o[4]),r[Tg]=parseInt(o[5])||0)}else r[Bx]=e[Bx],r[ef]=e[ef],r[mp]=e[mp],r[ad]=e[ad],r[Tg]=e[Tg],r[Bp]=0;r.sizeInBytes+=r.method[It],r.sizeInBytes+=r.fileName[It],r.sizeInBytes+=r.assembly[It],r[Bp]+=n.baseSize,r.sizeInBytes+=r.level.toString()[It],r.sizeInBytes+=r.line.toString()[It]}return n.CreateFromInterface=function(e){return new n(e,null)},n.prototype.toInterface=function(){var e=this;return{level:e[Bx],method:e[ef],assembly:e[mp],fileName:e[ad],line:e[Tg]}},n.regex=/^([\s]+at)?[\s]{0,50}([^\@\()]+?)[\s]{0,50}(\@|\()([^\(\n]+):([0-9]+):([0-9]+)(\)?)$/,n.baseSize=58,n}(),Xae=function(){function n(){this.aiDataContract={name:1,kind:0,value:1,count:0,min:0,max:0,stdDev:0},this.kind=0}return n}(),Ud=function(){function n(e,t,r,i,o,s,a,l,c){this.aiDataContract={ver:1,metrics:1,properties:0};var u=this;u.ver=2;var h=new Xae;h[Df]=i>0?i:void 0,h.max=isNaN(s)||s===null?void 0:s,h.min=isNaN(o)||o===null?void 0:o,h[Ws]=Cr(e,t)||La,h.value=r,h.stdDev=isNaN(a)||a===null?void 0:a,u.metrics=[h],u[Sa]=yh(e,l),u[Tl]=wh(e,c)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Metric",n.dataType="MetricData",n}(),Cg="";function Rc(n){(isNaN(n)||n<0)&&(n=0),n=Math.round(n);var e=Cg+n%1e3,t=Cg+Math.floor(n/1e3)%60,r=Cg+Math.floor(n/(1e3*60))%60,i=Cg+Math.floor(n/(1e3*60*60))%24,o=Math.floor(n/(1e3*60*60*24));return e=e[It]===1?"00"+e:e[It]===2?"0"+e:e,t=t[It]<2?"0"+t:t,r=r[It]<2?"0"+r:r,i=i[It]<2?"0"+i:i,(o>0?o+".":Cg)+i+":"+r+":"+t+"."+e}function qae(n,e,t,r,i){return!i&&ht(n)&&(n==="Script error."||n==="Script error")}var nu=function(){function n(e,t,r,i,o,s,a){this.aiDataContract={ver:1,name:0,url:0,duration:0,properties:0,measurements:0,id:0};var l=this;l.ver=2,l.id=Cae(e,a),l.url=x1(e,r),l[Ws]=Cr(e,t)||La,isNaN(i)||(l[VS]=Rc(i)),l[Sa]=yh(e,o),l[Tl]=wh(e,s)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Pageview",n.dataType="PageviewData",n}(),Fd=function(){function n(e,t,r,i,o,s,a,l,c,u,h,f){c===void 0&&(c="Ajax"),this.aiDataContract={id:1,ver:1,name:0,resultCode:0,duration:0,success:0,data:0,target:0,type:0,properties:0,measurements:0,kind:0,value:0,count:0,min:0,max:0,stdDev:0,dependencyKind:0,dependencySource:0,commandName:0,dependencyTypeName:0};var m=this;m.ver=2,m.id=t,m[VS]=Rc(o),m.success=s,m.resultCode=a+"",m.type=Cr(e,c);var g=Lae(e,r,l,i);m.data=x1(e,i)||g.data,m.target=Cr(e,g.target),u&&(m.target="".concat(m.target," | ").concat(u)),m[Ws]=Cr(e,g[Ws]),m[Sa]=yh(e,h),m[Tl]=wh(e,f)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.RemoteDependency",n.dataType="RemoteDependencyData",n}(),Hp=function(){function n(e,t,r,i,o){this.aiDataContract={ver:1,message:1,severityLevel:0,properties:0};var s=this;s.ver=2,t=t||La,s[Fc]=F8(e,t),s[Sa]=yh(e,i),s[Tl]=wh(e,o),r&&(s[p0]=r)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Message",n.dataType="MessageData",n}(),Vp=function(){function n(e,t,r,i,o,s,a){this.aiDataContract={ver:1,name:0,url:0,duration:0,perfTotal:0,networkConnect:0,sentRequest:0,receivedResponse:0,domProcessing:0,properties:0,measurements:0};var l=this;l.ver=2,l.url=x1(e,r),l[Ws]=Cr(e,t)||La,l[Sa]=yh(e,o),l[Tl]=wh(e,s),a&&(l.domProcessing=a.domProcessing,l[VS]=a[VS],l.networkConnect=a.networkConnect,l.perfTotal=a.perfTotal,l[P5]=a[P5],l.sentRequest=a.sentRequest)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.PageviewPerformance",n.dataType="PageviewPerformanceData",n}(),Sh=function(){function n(e,t){this.aiDataContract={baseType:1,baseData:1},this.baseType=e,this.baseData=t}return n}();function Eu(n){var e="ai."+n+".";return function(t){return e+t}}var bg=Eu("application"),br=Eu("device"),Hx=Eu("location"),tf=Eu("operation"),Pb=Eu("session"),uc=Eu("user"),Du=Eu("cloud"),Ag=Eu("internal"),X8=function(n){Wl(e,n);function e(){return n.call(this)||this}return e}(Roe({applicationVersion:bg("ver"),applicationBuild:bg("build"),applicationTypeId:bg("typeId"),applicationId:bg("applicationId"),applicationLayer:bg("layer"),deviceId:br("id"),deviceIp:br("ip"),deviceLanguage:br("language"),deviceLocale:br("locale"),deviceModel:br("model"),deviceFriendlyName:br("friendlyName"),deviceNetwork:br("network"),deviceNetworkName:br("networkName"),deviceOEMName:br("oemName"),deviceOS:br("os"),deviceOSVersion:br("osVersion"),deviceRoleInstance:br("roleInstance"),deviceRoleName:br("roleName"),deviceScreenResolution:br("screenResolution"),deviceType:br("type"),deviceMachineName:br("machineName"),deviceVMName:br("vmName"),deviceBrowser:br("browser"),deviceBrowserVersion:br("browserVersion"),locationIp:Hx("ip"),locationCountry:Hx("country"),locationProvince:Hx("province"),locationCity:Hx("city"),operationId:tf("id"),operationName:tf("name"),operationParentId:tf("parentId"),operationRootId:tf("rootId"),operationSyntheticSource:tf("syntheticSource"),operationCorrelationVector:tf("correlationVector"),sessionId:Pb("id"),sessionIsFirst:Pb("isFirst"),sessionIsNew:Pb("isNew"),userAccountAcquisitionDate:uc("accountAcquisitionDate"),userAccountId:uc("accountId"),userAgent:uc("userAgent"),userId:uc("id"),userStoreRegion:uc("storeRegion"),userAuthUserId:uc("authUserId"),userAnonymousUserAcquisitionDate:uc("anonUserAcquisitionDate"),userAuthenticatedUserAcquisitionDate:uc("authUserAcquisitionDate"),cloudName:Du("name"),cloudRole:Du("role"),cloudRoleVer:Du("roleVer"),cloudRoleInstance:Du("roleInstance"),cloudEnvironment:Du("environment"),cloudLocation:Du("location"),cloudDeploymentUnit:Du("deploymentUnit"),internalNodeName:Ag("nodeName"),internalSdkVersion:Ag("sdkVersion"),internalAgentVersion:Ag("agentVersion"),internalSnippet:Ag("snippet"),internalSdkSrc:Ag("sdkSrc")}));function mc(n,e,t,r,i,o){var s;t=Cr(r,t)||La,(Me(n)||Me(e)||Me(t))&&vo("Input doesn't contain all required fields");var a="";n[Sb]&&(a=n[Sb],delete n[Sb]);var l=(s={},s[Ws]=t,s.time=wm(new Date),s.iKey=a,s.ext=o||{},s.tags=[],s.data={},s.baseType=e,s.baseData=n,s);return Me(i)||zt(i,function(c,u){l.data[c]=u}),l}var uo={UserExt:"user",DeviceExt:"device",TraceExt:"trace",WebExt:"web",AppExt:"app",OSExt:"os",SessionExt:"ses",SDKExt:"sdk"},Rn=new X8;function Mg(n){var e=null;if(Mt(Event))e=new Event(n);else{var t=Qr();t&&t.createEvent&&(e=t.createEvent("Event"),e.initEvent(n,!0,!0))}return e}function z5(n,e){Fp(n,null,null,e)}function Qae(n){var e=Qr(),t=ja(),r=!1,i=[],o=1;t&&!Me(t.onLine)&&!t.onLine&&(o=2);var s=0,a=f(),l=Su(cs("OfflineListener"),n);try{if(u(Mo())&&(r=!0),e){var c=e.body||e;c.ononline&&u(c)&&(r=!0)}}catch{r=!1}function u(y){var w=!1;return y&&(w=El(y,"online",_,l),w&&El(y,"offline",v,l)),w}function h(){return a}function f(){return!(s===2||o===2)}function m(){var y=f();a!==y&&(a=y,Ye(i,function(w){var C={isOnline:a,rState:o,uState:s};try{w(C)}catch{}}))}function g(y){s=y,m()}function _(){o=1,m()}function v(){o=2,m()}function p(){var y=Mo();if(y&&r){if(z5(y,l),e){var w=e.body||e;Zn(w.ononline)||z5(w,l)}r=!1}}function x(y){return i[_1](y),{rm:function(){var w=i.indexOf(y);if(w>-1)return i.splice(w,1)}}}return{isOnline:h,isListening:function(){return r},unload:p,addListener:x,setOnlineState:g}}var S1="AppInsightsPropertiesPlugin",q8="AppInsightsChannelPlugin",Q8="ApplicationInsightsAnalytics",WS="toString",IR="isStorageUseDisabled",nf="_addHook",$r="core",dc="dataType",Uu="envelopeType",oo="diagLog",Fu="track",Xy="trackPageView",PR="trackPreviousPageVisit",ld="sendPageViewInternal",Tm="startTime",m0="properties",ca="duration",kR="sendPageViewPerformanceInternal",Nk="populatePageViewPerformanceEvent",Uf="href",H5="sendExceptionInternal",kb="exception",Rg="error",Lb="_onerror",Ob="errorSrc",Db="lineNumber",Ub="columnNumber",V5="message",Fb="CreateAutoException",Vx="addTelemetryInitializer",Zae="overridePageViewDuration",Z8="autoTrackPageVisitTime",J8="isBrowserLinkTrackingEnabled",Ov="length",e9="enableAutoRouteTracking",t9="enableUnhandledPromiseRejectionTracking",LR="autoUnhandledPromiseInstrumented",OR="getEntriesByType",n9="isPerformanceTimingSupported",r9="getPerformanceTiming",$S="navigationStart",DR="shouldCollectDuration",i9="isPerformanceTimingDataReady",g0="responseStart",Jae="requestStart",qy="loadEventEnd",UR="responseEnd",Qy="connectEnd",o9="pageVisitStartTime",ele=function(){function n(e,t,r,i){In(n,this,function(o){var s=null,a=[],l=!1,c=!1,u;r&&(u=r.logger);function h(g){r&&r.flush(g,function(){})}function f(){s||(s=ls(function(){s=null;var g=a.slice(0),_=!1;a=[],Ye(g,function(v){v()?_=!0:a.push(v)}),a[Ov]>0&&f(),_&&h(!0)},100))}function m(g){a.push(g),f()}o[Xy]=function(g,_){var v=g.name;if(Me(v)||typeof v!="string"){var p=Qr();v=g.name=p&&p.title||""}var x=g.uri;if(Me(x)||typeof x!="string"){var y=wa();x=g.uri=y&&y[Uf]||""}if(!c){var w=Fl(),C=w&&w[OR]&&w[OR]("navigation");if(C&&C[0]&&!Zn(w.timeOrigin)){var T=C[0].loadEventStart;g[Tm]=new Date(w.timeOrigin+T)}else{var S=(_||g[m0]||{})[ca]||0;g[Tm]=new Date(new Date().getTime()-S)}c=!0}if(!i[n9]()){e[ld](g,_),h(!0),bH()||Fe(u,2,25,"trackPageView: navigation timing API used for calculation of page duration is not supported in this browser. This page view will be collected without duration and timing info.");return}var b=!1,R,E=i[r9]()[$S];E>0&&(R=Bi(E,+new Date),i[DR](R)||(R=void 0));var A;!Me(_)&&!Me(_[ca])&&(A=_[ca]),(t||!isNaN(A))&&(isNaN(A)&&(_||(_={}),_[ca]=R),e[ld](g,_),h(!0),b=!0);var F=6e4;_||(_={}),m(function(){var D=!1;try{if(i[i9]()){D=!0;var M={name:v,uri:x};i[Nk](M),!M.isValid&&!b?(_[ca]=R,e[ld](g,_)):(b||(_[ca]=M.durationMs,e[ld](g,_)),l||(e[kR](M,_),l=!0))}else E>0&&Bi(E,+new Date)>F&&(D=!0,b||(_[ca]=F,e[ld](g,_)))}catch(k){Fe(u,1,38,"trackPageView failed on page load calculation: "+an(k),{exception:qe(k)})}return D})},o.teardown=function(g,_){if(s){s.cancel(),s=null;var v=a.slice(0);a=[],Ye(v,function(p){p()})}}})}return n.__ieDyn=1,n}(),tle=36e5,G5=["googlebot","adsbot-google","apis-google","mediapartners-google"];function s9(){var n=Fl();return n&&!!n.timing}function nle(){var n=Fl();return n&&n.getEntriesByType&&n.getEntriesByType("navigation")[Ov]>0}function rle(){var n=Fl(),e=n?n.timing:0;return e&&e.domainLookupStart>0&&e[$S]>0&&e[g0]>0&&e[Jae]>0&&e[qy]>0&&e[UR]>0&&e[Qy]>0&&e.domLoading>0}function W5(){return s9()?Fl().timing:null}function ile(){return nle()?Fl()[OR]("navigation")[0]:null}function ole(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ja()||{},r=t.userAgent,i=!1;if(r)for(var o=0;o<G5[Ov];o++)i=i||Yi(r.toLowerCase(),G5[o])!==-1;if(i)return!1;for(var o=0;o<n[Ov];o++)if(n[o]<0||n[o]>=tle)return!1;return!0}var sle=function(){function n(e){var t=xh(e);In(n,this,function(r){r[Nk]=function(i){i.isValid=!1;var o=ile(),s=W5(),a=0,l=0,c=0,u=0,h=0;(o||s)&&(o?(a=o[ca],l=o[Tm]===0?o[Qy]:Bi(o[Tm],o[Qy]),c=Bi(o.requestStart,o[g0]),u=Bi(o[g0],o[UR]),h=Bi(o.responseEnd,o[qy])):(a=Bi(s[$S],s[qy]),l=Bi(s[$S],s[Qy]),c=Bi(s.requestStart,s[g0]),u=Bi(s[g0],s[UR]),h=Bi(s.responseEnd,s[qy])),a===0?Fe(t,2,10,"error calculating page view performance.",{total:a,network:l,request:c,response:u,dom:h}):r[DR](a,l,c,u,h)?a<Math.floor(l)+Math.floor(c)+Math.floor(u)+Math.floor(h)?Fe(t,2,8,"client performance math error.",{total:a,network:l,request:c,response:u,dom:h}):(i.durationMs=a,i.perfTotal=i[ca]=Rc(a),i.networkConnect=Rc(l),i.sentRequest=Rc(c),i.receivedResponse=Rc(u),i.domProcessing=Rc(h),i.isValid=!0):Fe(t,2,45,"Invalid page load duration value. Browser perf data won't be sent.",{total:a,network:l,request:c,response:u,dom:h}))},r[r9]=W5,r[n9]=s9,r[i9]=rle,r[DR]=ole})}return n.__ieDyn=1,n}(),ale=function(){function n(e,t){var r="prevPageVisitData";In(n,this,function(i){i[PR]=function(a,l){try{var c=o(a,l);c&&t(c.pageName,c.pageUrl,c.pageVisitTime)}catch(u){Od(e,"Auto track page visit time failed, metric will not be collected: "+qe(u))}};function o(a,l){var c=null;try{if(c=s(),Lv()){bR(e,r)!=null&&vo("Cannot call startPageVisit consecutively without first calling stopPageVisit");var u=Vs().stringify(new lle(a,l));G8(e,r,u)}}catch(h){Od(e,"Call to restart failed: "+qe(h)),c=null}return c}function s(){var a=null;try{if(Lv()){var l=Pa(),c=bR(e,r);c&&h_()&&(a=Vs().parse(c),a.pageVisitTime=l-a[o9],W8(e,r))}}catch(u){Od(e,"Stop page visit timer failed: "+qe(u)),a=null}return a}en(i,"_logger",{g:function(){return e}}),en(i,"pageVisitTimeTrackingHandler",{g:function(){return t}})})}return n.__ieDyn=1,n}(),lle=function(){function n(e,t){this[o9]=Pa(),this.pageName=e,this.pageUrl=t}return n}(),$5=function(){function n(e,t){var r=this,i={};r.start=function(o){typeof i[o]<"u"&&Fe(e,2,62,"start was called more than once for this event without calling stop.",{name:o,key:o},!0),i[o]=+new Date},r.stop=function(o,s,a,l){var c=i[o];if(isNaN(c))Fe(e,2,63,"stop was called without a corresponding start.",{name:o,key:o},!0);else{var u=+new Date,h=Bi(c,u);r.action(o,s,h,a,l)}delete i[o],i[o]=void 0}}return n}(),wi,cle="event";function Ng(n,e){n&&n.dispatchEvent&&e&&n.dispatchEvent(e)}function ule(n){if(n&&n.reason){var e=n.reason;return!ht(e)&&Mt(e[WS])?e[WS]():qe(e)}return n||""}var Y5=6e4,dle=Hm((wi={sessionRenewalMs:ZD(K5,30*60*1e3),sessionExpirationMs:ZD(K5,24*60*60*1e3),disableExceptionTracking:_r()},wi[Z8]=_r(),wi[Zae]=_r(),wi[t9]=_r(),wi[LR]=!1,wi.samplingPercentage=LS(hle,100),wi[IR]=_r(),wi[J8]=_r(),wi[e9]=_r(),wi.namePrefix=vse(),wi.enableDebug=_r(),wi.disableFlushOnBeforeUnload=_r(),wi.disableFlushOnUnload=_r(!1,"disableFlushOnBeforeUnload"),wi.expCfg=bs({inclScripts:!1,expLog:void 0,maxLogs:50}),wi));function K5(n,e){return n=n||e,n<Y5&&(n=Y5),+n}function hle(n){return!isNaN(n)&&n>0&&n<=100}function fle(n){Zn(n[IR])||(n[IR]?Oae():Dae())}var ple=function(n){Wl(e,n);function e(){var t=n.call(this)||this;t.identifier=Q8,t.priority=180,t.autoRoutePVDelay=500;var r,i,o,s,a,l,c,u,h,f,m,g,_,v,p,x,y,w,C,T;return In(e,t,function(S,b){var R=b[nf];Z(),S.getCookieMgr=function(){return mk(S[$r])},S.processTelemetry=function(j,X){S.processNext(j,X)},S.trackEvent=function(j,X){try{var B=mc(j,Mc[dc],Mc[Uu],S[oo](),X);S[$r][Fu](B)}catch(K){Y(2,39,"trackTrace failed, trace will not be collected: "+an(K),{exception:qe(K)})}},S.startTrackEvent=function(j){try{r.start(j)}catch(X){Y(1,29,"startTrackEvent failed, event will not be collected: "+an(X),{exception:qe(X)})}},S.stopTrackEvent=function(j,X,B){try{r.stop(j,void 0,X,B)}catch(K){Y(1,30,"stopTrackEvent failed, event will not be collected: "+an(K),{exception:qe(K)})}},S.trackTrace=function(j,X){try{var B=mc(j,Hp[dc],Hp[Uu],S[oo](),X);S[$r][Fu](B)}catch(K){Y(2,39,"trackTrace failed, trace will not be collected: "+an(K),{exception:qe(K)})}},S.trackMetric=function(j,X){try{var B=mc(j,Ud[dc],Ud[Uu],S[oo](),X);S[$r][Fu](B)}catch(K){Y(1,36,"trackMetric failed, metric will not be collected: "+an(K),{exception:qe(K)})}},S[Xy]=function(j,X){try{var B=j||{};o[Xy](B,Ii(Ii(Ii({},B.properties),B.measurements),X)),x&&a[PR](B.name,B.uri)}catch(K){Y(1,37,"trackPageView failed, page view will not be collected: "+an(K),{exception:qe(K)})}},S[ld]=function(j,X,B){var K=Qr();if(K&&(j.refUri=j.refUri===void 0?K.referrer:j.refUri),Me(j[Tm])){var ee=(X||j[m0]||{})[ca]||0;j[Tm]=new Date(new Date().getTime()-ee)}var fe=mc(j,nu[dc],nu[Uu],S[oo](),X,B);S[$r][Fu](fe)},S[kR]=function(j,X,B){var K=mc(j,Vp[dc],Vp[Uu],S[oo](),X,B);S[$r][Fu](K)},S.trackPageViewPerformance=function(j,X){var B=j||{};try{s[Nk](B),S[kR](B,X)}catch(K){Y(1,37,"trackPageViewPerformance failed, page view will not be collected: "+an(K),{exception:qe(K)})}},S.startTrackPage=function(j){try{if(typeof j!="string"){var X=Qr();j=X&&X.title||""}i.start(j)}catch(B){Y(1,31,"startTrackPage failed, page view may not be collected: "+an(B),{exception:qe(B)})}},S.stopTrackPage=function(j,X,B,K){try{if(typeof j!="string"){var ee=Qr();j=ee&&ee.title||""}if(typeof X!="string"){var fe=wa();X=fe&&fe[Uf]||""}i.stop(j,X,B,K),x&&a[PR](j,X)}catch(ce){Y(1,32,"stopTrackPage failed, page view will not be collected: "+an(ce),{exception:qe(ce)})}},S[H5]=function(j,X,B){var K=j&&(j[kb]||j[Rg])||$P(j)&&j||{name:j&&typeof j,message:j||La};j=j||{};var ee=new Wo(S[oo](),K,j[m0]||X,j.measurements,j.severityLevel,j.id).toInterface(),fe=Qr();if(fe&&(y!=null&&y.inclScripts)){var ce=Bse(fe);ee[m0].exceptionScripts=JSON.stringify(ce)}if(y!=null&&y.expLog){var we=y.expLog();we&&we.logs&&Ft(we.logs)&&(ee[m0].exceptionLog=we.logs.slice(0,y.maxLogs).join(`
`))}var Ie=mc(ee,Wo[dc],Wo[Uu],S[oo](),X,B);S[$r][Fu](Ie)},S.trackException=function(j,X){j&&!j[kb]&&j[Rg]&&(j[kb]=j[Rg]);try{S[H5](j,X)}catch(B){Y(1,35,"trackException failed, exception will not be collected: "+an(B),{exception:qe(B)})}},S[Lb]=function(j){var X=j&&j[Rg],B=j&&j.evt;try{if(!B){var K=Mo();K&&(B=K[cle])}var ee=j&&j.url||(Qr()||{}).URL,fe=j[Ob]||"window.onerror@"+ee+":"+(j[Db]||0)+":"+(j[Ub]||0),ce={errorSrc:fe,url:ee,lineNumber:j[Db]||0,columnNumber:j[Ub]||0,message:j[V5]};qae(j.message,j.url,j.lineNumber,j.columnNumber,j[Rg])?D(Wo[Fb]("Script error: The browser's same-origin policy prevents us from getting the details of this exception. Consider using the 'crossorigin' attribute.",ee,j[Db]||0,j[Ub]||0,X,B,null,fe),ce):(j[Ob]||(j[Ob]=fe),S.trackException({exception:j,severityLevel:3},ce))}catch(Ie){var we=X?X.name+", "+X[V5]:"null";Y(1,11,"_onError threw exception while logging error, error will not be collected: "+an(Ie),{exception:qe(Ie),errorString:we})}},S[Vx]=function(j){if(S[$r])return S[$r][Vx](j);l||(l=[]),l.push(j)},S.initialize=function(j,X,B,K){if(!S.isInitialized()){Me(X)&&vo("Error initializing"),b.initialize(j,X,B,K);try{T=Su(cs(S.identifier),X.evtNamespace&&X.evtNamespace()),l&&(Ye(l,function(ee){X[Vx](ee)}),l=null),E(j),s=new sle(S[$r]),o=new ele(S,p.overridePageViewDuration,S[$r],s),a=new ale(S[oo](),function(ee,fe,ce){return A(ee,fe,ce)}),r=new $5(S[oo](),"trackEvent"),r.action=function(ee,fe,ce,we,Ie){we||(we={}),Ie||(Ie={}),we.duration=ce[WS](),S.trackEvent({name:ee,properties:we,measurements:Ie})},i=new $5(S[oo](),"trackPageView"),i.action=function(ee,fe,ce,we,Ie){Me(we)&&(we={}),we.duration=ce[WS]();var ft={name:ee,uri:fe,properties:we,measurements:Ie};S[ld](ft,we)},h1()&&(M(),k())}catch(ee){throw S.setInitialized(!1),ee}}},S._doTeardown=function(j,X){o&&o.teardown(j,X),Fp(window,null,null,T),Z()};function E(j){var X=S.identifier,B=S[$r];S[nf](pr(j,function(){var K=Gs(null,j,B);p=K.getExtCfg(X,dle),y=p.expCfg,x=p[Z8],j.storagePrefix&&Rk(j.storagePrefix),fle(p),c=p[J8],F()}))}function A(j,X,B){var K={PageName:j,PageUrl:X};S.trackMetric({name:"PageVisitTime",average:B,max:B,min:B,sampleCount:1},K)}function F(){if(!u&&c){var j=["/browserLinkSignalR/","/__browserLink/"],X=function(B){if(c&&B.baseType===Fd[dc]){var K=B.baseData;if(K){for(var ee=0;ee<j[Ov];ee++)if(K.target&&Yi(K.target,j[ee])>=0)return!1}}return!0};S[nf](S[Vx](X)),u=!0}}function D(j,X){var B=mc(j,Wo[dc],Wo[Uu],S[oo](),X);S[$r][Fu](B)}function M(){var j=Mo(),X=wa(!0);S[nf](pr(p,function(){m=p.disableExceptionTracking,!m&&!g&&!p.autoExceptionInstrumented&&(R(Fx(j,"onerror",{ns:T,rsp:function(B,K,ee,fe,ce,we){!m&&B.rslt!==!0&&S[Lb](Wo[Fb](K,ee,fe,ce,we,B.evt))}},!1)),g=!0)})),U(j,X)}function k(){var j=Mo(),X=wa(!0);S[nf](pr(p,function(){if(h=p[e9]===!0,j&&h&&!f&&Rie()){var B=CH();Mt(B.pushState)&&Mt(B.replaceState)&&typeof Event!==ok&&P(j,B,X)}}))}function z(){var j=null;if(S[$r]&&S[$r].getTraceCtx&&(j=S[$r].getTraceCtx(!1)),!j){var X=S[$r].getPlugin(S1);if(X){var B=X.plugin.context;B&&(j=bk(B.telemetryTrace))}}return j}function P(j,X,B){if(f)return;var K=p.namePrefix||"";function ee(){h&&Ng(j,Mg(K+"locationchange"))}function fe(){if(C&&(w=C),C=B&&B[Uf]||"",h){var ce=z();if(ce){ce.setTraceId(Uc());var we="_unknown_";B&&B.pathname&&(we=B.pathname+(B.hash||"")),ce.setName(Cr(S[oo](),we))}ls((function(Ie){S[Xy]({refUri:Ie,properties:{duration:0}})}).bind(S,w),S.autoRoutePVDelay)}}R(Fx(X,"pushState",{ns:T,rsp:function(){h&&(Ng(j,Mg(K+"pushState")),Ng(j,Mg(K+"locationchange")))}},!0)),R(Fx(X,"replaceState",{ns:T,rsp:function(){h&&(Ng(j,Mg(K+"replaceState")),Ng(j,Mg(K+"locationchange")))}},!0)),El(j,K+"popstate",ee,T),El(j,K+"locationchange",fe,T),f=!0}function U(j,X){S[nf](pr(p,function(){_=p[t9]===!0,g=g||p[LR],_&&!v&&(R(Fx(j,"onunhandledrejection",{ns:T,rsp:function(B,K){_&&B.rslt!==!0&&S[Lb](Wo[Fb](ule(K),X?X[Uf]:"",0,0,K,B.evt))}},!1)),p[LR]=v=!0)}))}function Y(j,X,B,K,ee){S[oo]().throwInternal(j,X,B,K,ee)}function Z(){r=null,i=null,o=null,s=null,a=null,l=null,c=!1,u=!1,h=!1,f=!1,m=!1,g=!1,_=!1,v=!1,x=!1;var j=wa(!0);w=j&&j[Uf]||"",C=null,T=null,p=null,en(S,"config",{g:function(){return p}})}en(S,"_pageViewManager",{g:function(){return o}}),en(S,"_pageViewPerformanceManager",{g:function(){return s}}),en(S,"_pageVisitTimeManager",{g:function(){return a}}),en(S,"_evtNamespace",{g:function(){return"."+T}})}),t}return e.Version="3.3.3",e}($m),Zy="featureOptIn",a9="onCfgChangeReceive",l9="nonOverrideConfigs",c9="scheduleFetchTimeout";function u9(n,e,t,r){try{var i=t>r;i&&(n=null);var o=t==0?Kie({},n):n;return o&&e&&!i&&zt(o,function(s){var a=e[s];a&&(Zi(o[s])&&Zi(a)?o[s]=u9(o[s],a,++t,r):delete o[s])}),o}catch{}return n}var Gp="featureOptIn.",d9=".mode",h9=".onCfg",f9=".offCfg";function mle(n,e,t){var r;if(!e||!e.enabled)return null;var i=(e[Zy]||{})[n]||{mode:1},o=i.mode,s=i.onCfg,a=i.offCfg,l=(t||{})[n]||{mode:2},c=l.mode,u=l.onCfg,h=l.offCfg,f=!!l.blockCdnCfg,m=Gp+n+d9,g=Gp+n+h9,_=Gp+n+f9,v=c,p=u,x=h;return f||(o===4||o===5?(v=o==4?3:2,p=s||u,x=a||h):o===2||c===2?(v=2,p=u||s,x=h||a):o===3?(v=3,p=u||s,x=h||a):o===1&&c===1&&(v=1)),r={},r[m]=v,r[g]=p,r[_]=x,r}function gle(n,e){try{if(!n||!n.enabled)return null;if(!n[Zy])return n.config;var t=n[Zy],r=n.config||{};return zt(t,function(i){var o=mle(i,n,e.config[Zy]);Me(o)||(zt(o,function(s,a){LH(r,s,a)}),vle(i,o,r))}),r}catch{}return null}function vle(n,e,t){var r=e[Gp+n+d9],i=e[Gp+n+h9],o=e[Gp+n+f9],s=null;r===3&&(s=i),r===2&&(s=o),s&&zt(s,function(a,l){LH(t,a,l)})}var Ig,_le="ai_cfgsync",X5="GET",xle=18e5,rf=void 0,yle={instrumentationKey:!0,connectionString:!0,endpointUrl:!0},wle=Hm((Ig={syncMode:1,blkCdnCfg:rf,customEvtName:rf,cfgUrl:rf,overrideSyncFn:rf,overrideFetchFn:rf},Ig[a9]=rf,Ig[c9]=xle,Ig[l9]=yle,Ig)),Sle=function(n){Wl(e,n);function e(){var t=n.call(this)||this;t.priority=198,t.identifier="AppInsightsCfgSyncPlugin";var r,i,o,s,a,l,c,u,h,f,m,g,_,v,p,x,y=!1;return In(e,t,function(w,C){T(),w.initialize=function(j,X,B,K){C.initialize(j,X,B,K),s=Su(cs(w.identifier),X.evtNamespace&&X.evtNamespace()),S(j)},w.getCfg=function(){return i},w.pause=function(){y=!0,Z()},w.resume=function(){y=!1,Y()},w.setCfg=function(j){return b(j)},w.sync=function(j){return E(j)},w.updateEventListenerName=function(j){return A(j)},w._doTeardown=function(j,X){R(),Z(),T()},w._getDbgPlgTargets=function(){return[u,c,o,h,_]};function T(){i=null,o=null,s=null,a=null,c=null,u=null,_=null,l=null,f=null,m=null,h=null,p=null,x=null,g=null}function S(j){var X=w.identifier,B=w.core;w._addHook(pr(j,function(){var K=Gs(null,j,B);r=K.getExtCfg(X,wle);var ee=h;h=!!r.blkCdnCfg,!Me(ee)&&ee!==h&&(!h&&a?v&&v(a,k,u):Z()),Me(c)&&(c=r.syncMode===2),Me(u)&&(u=r.syncMode===1);var fe=r.customEvtName||_le;o!==fe&&(c?A(fe):(R(),o=fe)),Me(a)&&(a=r.cfgUrl),a||(i=j,u&&E())})),x=r.overrideSyncFn,p=r.overrideFetchFn,g=r[a9],_=r[l9],f=r[c9],v=F(),m=0,a&&!h&&v&&v(a,k,u)}function b(j,X){if(j){if(i=j,X&&!y)return E();if(c&&!y)return w.core.updateCfg(j),!0}return!1}function R(){try{var j=rs();j&&Fp(j,null,null,s)}catch{}}function E(j){try{return x&&Mt(x)?x(i,j):Qoe(o,i,j)}catch{}return!1}function A(j){try{return R(),j&&(o=j,P()),!0}catch{}return!1}function F(){var j=p;return Me(j)&&(ck()?j=D:m1()&&(j=M)),j}function D(j,X,B){var K=rs(),ee=K&&K.fetch||null;if(j&&ee&&Mt(ee))try{var fe={method:X5},ce=new Request(j,fe);Bl(fetch(ce),function(we){var Ie=we.value;we.rejected?z(X,400):Ie.ok?Bl(Ie.text(),function(ft){z(X,Ie.status,ft.value,B)}):z(X,Ie.status,null,B)})}catch{}}function M(j,X,B){try{var K=new XMLHttpRequest;K.open(X5,j),K.onreadystatechange=function(){K.readyState===XMLHttpRequest.DONE&&z(X,K.status,K.responseText,B)},K.onerror=function(){z(X,400)},K.ontimeout=function(){z(X,400)},K.send()}catch{}}function k(j,X,B){try{if(j>=200&&j<400&&X){m=0;var K=Vs();if(K){var ee=K.parse(X),fe=gle(ee,w.core),ce=fe&&Ni(fe)&&U(fe);ce&&b(ce,B)}}else m++;m<3&&Y()}catch{}}function z(j,X,B,K){try{j(X,B,K)}catch{}}function P(){if(c){var j=rs();if(j)try{El(j,o,function(X){var B=X&&X.detail;if(g&&B)g(B);else{var K=B&&B.cfg,ee=K&&Ni(K)&&U(K);ee&&b(ee)}},s,!0)}catch{}}}function U(j,X){var B=null;try{j&&(B=u9(j,_,0,5))}catch{}return B}function Y(){!l&&f&&(l=ls(function(){l=null,v(a,k,u)},f),l.unref())}function Z(){l&&l.cancel(),l=null,m=0}w.processTelemetry=function(j,X){w.processNext(j,X)}}),t}return e.__ieDyn=1,e}($m),Qu="duration",qr="tags",jb="deviceType",Mi="data",zl="name",Dv="traceID",Bt="length",Uv="stringify",Eh="measurements",Ra="dataType",Th="envelopeType",Zu="toString",v0="_get",jd="enqueue",Bd="count",p9="eventsLimitInMem",Cl="push",YS="item",FR="emitLineDelimitedJson",Wp="clear",Ik="createNew",KS="markAsSent",$0="clearSent",Pk="bufferOverride",Bb="BUFFER_KEY",hc="SENT_BUFFER_KEY",Ff="concat",Pg="MAX_BUFFER_SIZE",kg="triggerSend",ai="diagLog",zb="initialize",Lg="_sender",Og="endpointUrl",_0="instrumentationKey",jR="customHeaders",m9="maxBatchSizeInBytes",BR="onunloadDisableBeacon",zR="isBeaconApiDisabled",g9="alwaysUseXhrOverride",HR="disableXhr",v9="enableSessionStorageBuffer",fc="_buffer",_9="onunloadDisableFetch",x9="disableSendBeaconSplit",q5="enableSendPromise",Gx="getSenderInst",Q5="unloadTransports",y9="convertUndefined",w9="maxBatchInterval",Jy="serialize",ju="_onError",Hb="_onPartialSuccess",Wx="_onSuccess",Vb="itemsReceived",Gb="itemsAccepted",Wb="oriPayload",$b="baseType",XS="sampleRate",Z5="eventsSendRequest",S9="getSamplingScore",Ele="getHashCodeScore",Yb="baseType",Wn="baseData",zr="properties",J5="true";function ur(n,e,t){return Tn(n,e,t,cS)}function Tle(n,e,t){var r=t[qr]=t[qr]||{},i=e.ext=e.ext||{},o=e[qr]=e[qr]||[],s=i.user;s&&(ur(r,Rn.userAuthUserId,s.authId),ur(r,Rn.userId,s.id||s.localId));var a=i.app;a&&ur(r,Rn.sessionId,a.sesId);var l=i.device;l&&(ur(r,Rn.deviceId,l.id||l.localId),ur(r,Rn[jb],l.deviceClass),ur(r,Rn.deviceIp,l.ip),ur(r,Rn.deviceModel,l.model),ur(r,Rn[jb],l[jb]));var c=e.ext.web;if(c){ur(r,Rn.deviceLanguage,c.browserLang),ur(r,Rn.deviceBrowserVersion,c.browserVer),ur(r,Rn.deviceBrowser,c.browser);var u=t[Mi]=t[Mi]||{},h=u[Wn]=u[Wn]||{},f=h[zr]=h[zr]||{};ur(f,"domain",c.domain),ur(f,"isManual",c.isManual?J5:null),ur(f,"screenRes",c.screenRes),ur(f,"userConsent",c.userConsent?J5:null)}var m=i.os;m&&(ur(r,Rn.deviceOS,m[zl]),ur(r,Rn.deviceOSVersion,m.osVer));var g=i.trace;g&&(ur(r,Rn.operationParentId,g.parentID),ur(r,Rn.operationName,Cr(n,g[zl])),ur(r,Rn.operationId,g[Dv]));for(var _={},v=o[Bt]-1;v>=0;v--){var p=o[v];zt(p,function(y,w){_[y]=w}),o.splice(v,1)}zt(o,function(y,w){_[y]=w});var x=Ii(Ii({},r),_);x[Rn.internalSdkVersion]||(x[Rn.internalSdkVersion]=Cr(n,"javascript:".concat(Cle.Version),64)),t[qr]=e8(x)}function hu(n,e,t){Me(n)||zt(n,function(r,i){c_(i)?t[r]=i:ht(i)?e[r]=i:h_()&&(e[r]=Vs()[Uv](i))})}function Ch(n,e){Me(n)||zt(n,function(t,r){n[t]=r||e})}function bh(n,e,t,r){var i=new Hae(n,r,e);ur(i,"sampleRate",t[O8]),(t[Wn]||{}).startTime&&(i.time=wm(t[Wn].startTime)),i.iKey=t.iKey;var o=t.iKey.replace(/-/g,"");return i[zl]=i[zl].replace("{0}",o),Tle(n,t,i),t[qr]=t[qr]||[],e8(i)}function Ah(n,e){Me(e[Wn])&&Fe(n,1,46,"telemetryItem.baseData cannot be null.")}var Cle={Version:"3.3.3"};function ble(n,e,t){Ah(n,e);var r=e[Wn][Eh]||{},i=e[Wn][zr]||{};hu(e[Mi],i,r),Me(t)||Ch(i,t);var o=e[Wn];if(Me(o))return Od(n,"Invalid input for dependency data"),null;var s=o[zr]&&o[zr][R5]?o[zr][R5]:"GET",a=new Fd(n,o.id,o.target,o[zl],o[Qu],o.success,o.responseCode,s,o.type,o.correlationContext,i,r),l=new Sh(Fd[Ra],a);return bh(n,Fd[Th],e,l)}function E9(n,e,t){Ah(n,e);var r={},i={};e[Yb]!==Mc[Ra]&&(r.baseTypeSource=e[Yb]),e[Yb]===Mc[Ra]?(r=e[Wn][zr]||{},i=e[Wn][Eh]||{}):e[Wn]&&hu(e[Wn],r,i),hu(e[Mi],r,i),Me(t)||Ch(r,t);var o=e[Wn][zl],s=new Mc(n,o,r,i),a=new Sh(Mc[Ra],s);return bh(n,Mc[Th],e,a)}function Ale(n,e,t){Ah(n,e);var r=e[Wn][Eh]||{},i=e[Wn][zr]||{};hu(e[Mi],i,r),Me(t)||Ch(i,t);var o=e[Wn],s=Wo.CreateFromInterface(n,o,i,r),a=new Sh(Wo[Ra],s);return bh(n,Wo[Th],e,a)}function Mle(n,e,t){Ah(n,e);var r=e[Wn],i=r[zr]||{},o=r[Eh]||{};hu(e[Mi],i,o),Me(t)||Ch(i,t);var s=new Ud(n,r[zl],r.average,r.sampleCount,r.min,r.max,r.stdDev,i,o),a=new Sh(Ud[Ra],s);return bh(n,Ud[Th],e,a)}function Rle(n,e,t){Ah(n,e);var r,i=e[Wn];!Me(i)&&!Me(i[zr])&&!Me(i[zr][Qu])?(r=i[zr][Qu],delete i[zr][Qu]):!Me(e[Mi])&&!Me(e[Mi][Qu])&&(r=e[Mi][Qu],delete e[Mi][Qu]);var o=e[Wn],s;((e.ext||{}).trace||{})[Dv]&&(s=e.ext.trace[Dv]);var a=o.id||s,l=o[zl],c=o.uri,u=o[zr]||{},h=o[Eh]||{};if(Me(o.refUri)||(u.refUri=o.refUri),Me(o.pageType)||(u.pageType=o.pageType),Me(o.isLoggedIn)||(u.isLoggedIn=o.isLoggedIn[Zu]()),!Me(o[zr])){var f=o[zr];zt(f,function(_,v){u[_]=v})}hu(e[Mi],u,h),Me(t)||Ch(u,t);var m=new nu(n,l,c,r,u,h,a),g=new Sh(nu[Ra],m);return bh(n,nu[Th],e,g)}function Nle(n,e,t){Ah(n,e);var r=e[Wn],i=r[zl],o=r.uri||r.url,s=r[zr]||{},a=r[Eh]||{};hu(e[Mi],s,a),Me(t)||Ch(s,t);var l=new Vp(n,i,o,void 0,s,a,r),c=new Sh(Vp[Ra],l);return bh(n,Vp[Th],e,c)}function Ile(n,e,t){Ah(n,e);var r=e[Wn].message,i=e[Wn].severityLevel,o=e[Wn][zr]||{},s=e[Wn][Eh]||{};hu(e[Mi],o,s),Me(t)||Ch(o,t);var a=new Hp(n,r,i,o,s),l=new Sh(Hp[Ra],a);return bh(n,Hp[Th],e,l)}var T9=function(){function n(e,t){var r=[],i=!1,o=t.maxRetryCnt;this[v0]=function(){return r},this._set=function(s){return r=s,r},In(n,this,function(s){s[jd]=function(a){if(s[Bd]()>=t[p9]){i||(Fe(e,2,105,"Maximum in-memory buffer size reached: "+s[Bd](),!0),i=!0);return}a.cnt=a.cnt||0,!(!Me(o)&&a.cnt>o)&&r[Cl](a)},s[Bd]=function(){return r[Bt]},s.size=function(){for(var a=r[Bt],l=0;l<r[Bt];l++)a+=r[l].item[Bt];return t[FR]||(a+=2),a},s[Wp]=function(){r=[],i=!1},s.getItems=function(){return r.slice(0)},s.batchPayloads=function(a){if(a&&a[Bt]>0){var l=[];Ye(a,function(u){l[Cl](u[YS])});var c=t[FR]?l.join(`
`):"["+l.join(",")+"]";return c}return null},s[Ik]=function(a,l,c){var u=r.slice(0);a=a||e,l=l||{};var h=c?new C9(a,l):new kk(a,l);return Ye(u,function(f){h[jd](f)}),h}})}return n.__ieDyn=1,n}(),kk=function(n){Wl(e,n);function e(t,r){var i=n.call(this,t,r)||this;return In(e,i,function(o,s){o[KS]=function(a){s[Wp]()},o[$0]=function(a){}}),i}return e.__ieDyn=1,e}(T9),Ple=["AI_buffer","AI_sentBuffer"],C9=function(n){Wl(e,n);function e(r,i){var o=n.call(this,r,i)||this,s=!1,a=i==null?void 0:i.namePrefix,l=i[Pk]||{getItem:bR,setItem:G8},c=l.getItem,u=l.setItem,h=i.maxRetryCnt;return In(e,o,function(f,m){var g=w(e[Bb]),_=w(e[hc]),v=S(),p=_[Ff](v),x=f._set(g[Ff](p));x[Bt]>e[Pg]&&(x[Bt]=e[Pg]),T(e[hc],[]),T(e[Bb],x),f[jd]=function(R){if(f[Bd]()>=e[Pg]){s||(Fe(r,2,67,"Maximum buffer size reached: "+f[Bd](),!0),s=!0);return}R.cnt=R.cnt||0,!(!Me(h)&&R.cnt>h)&&(m[jd](R),T(e.BUFFER_KEY,f[v0]()))},f[Wp]=function(){m[Wp](),T(e.BUFFER_KEY,f[v0]()),T(e[hc],[]),s=!1},f[KS]=function(R){T(e[Bb],f._set(y(R,f[v0]())));var E=w(e[hc]);E instanceof Array&&R instanceof Array&&(E=E[Ff](R),E[Bt]>e[Pg]&&(Fe(r,1,67,"Sent buffer reached its maximum size: "+E[Bt],!0),E[Bt]=e[Pg]),T(e[hc],E))},f[$0]=function(R){var E=w(e[hc]);E=y(R,E),T(e[hc],E)},f[Ik]=function(R,E,A){A=!!A;var F=f[v0]().slice(0),D=w(e[hc]).slice(0);R=R||r,E=E||{},f[Wp]();var M=A?new e(R,E):new kk(R,E);return Ye(F,function(k){M[jd](k)}),A&&M[KS](D),M};function y(R,E){var A=[],F=[];return Ye(R,function(D){F[Cl](D[YS])}),Ye(E,function(D){!Mt(D)&&xi(F,D[YS])===-1&&A[Cl](D)}),A}function w(R){var E=R;return E=a?a+"_"+E:E,C(E)}function C(R){try{var E=c(r,R);if(E){var A=Vs().parse(E);if(ht(A)&&(A=Vs().parse(A)),A&&Ft(A))return A}}catch(F){Fe(r,1,42," storage key: "+R+", "+an(F),{exception:qe(F)})}return[]}function T(R,E){var A=R;try{A=a?a+"_"+A:A;var F=JSON[Uv](E);u(r,A,F)}catch(D){u(r,A,JSON[Uv]([])),Fe(r,2,41," storage key: "+A+", "+an(D)+". Buffer cleared",{exception:qe(D)})}}function S(){var R=[];try{return Ye(Ple,function(E){var A=b(E);if(R=R[Ff](A),a){var F=a+"_"+E,D=b(F);R=R[Ff](D)}}),R}catch(E){Fe(r,2,41,"Transfer events from previous buffers: "+an(E)+". previous Buffer items can not be removed",{exception:qe(E)})}return[]}function b(R){try{var E=C(R),A=[];return Ye(E,function(F){var D={item:F,cnt:0};A[Cl](D)}),W8(r,R),A}catch{}return[]}}),o}var t;return t=e,e.VERSION="_1",e.BUFFER_KEY="AI_buffer"+t.VERSION,e.SENT_BUFFER_KEY="AI_sentBuffer"+t.VERSION,e.MAX_BUFFER_SIZE=2e3,e}(T9),kle=function(){function n(e){In(n,this,function(t){t[Jy]=function(s){var a=r(s,"root");try{return Vs()[Uv](a)}catch(l){Fe(e,1,48,l&&Mt(l[Zu])?l[Zu]():"Error serializing object",null,!0)}};function r(s,a){var l="__aiCircularRefCheck",c={};if(!s)return Fe(e,1,48,"cannot serialize object because it is null or undefined",{name:a},!0),c;if(s[l])return Fe(e,2,50,"Circular reference detected while serializing object",{name:a},!0),c;if(!s.aiDataContract){if(a==="measurements")c=o(s,"number",a);else if(a==="properties")c=o(s,"string",a);else if(a==="tags")c=o(s,"string",a);else if(Ft(s))c=i(s,a);else{Fe(e,2,49,"Attempting to serialize an object which does not implement ISerializable",{name:a},!0);try{Vs()[Uv](s),c=s}catch(u){Fe(e,1,48,u&&Mt(u[Zu])?u[Zu]():"Error serializing object",null,!0)}}return c}return s[l]=!0,zt(s.aiDataContract,function(u,h){var f=Mt(h)?h()&1:h&1,m=Mt(h)?h()&4:h&4,g=h&2,_=s[u]!==void 0,v=Zi(s[u])&&s[u]!==null;if(f&&!_&&!g)Fe(e,1,24,"Missing required field specification. The field is required but not present on source",{field:u,name:a});else if(!m){var p=void 0;v?g?p=i(s[u],u):p=r(s[u],u):p=s[u],p!==void 0&&(c[u]=p)}}),delete s[l],c}function i(s,a){var l;if(s)if(!Ft(s))Fe(e,1,54,`This field was specified as an array in the contract but the item is not an array.\r
`,{name:a},!0);else{l=[];for(var c=0;c<s[Bt];c++){var u=s[c],h=r(u,a+"["+c+"]");l[Cl](h)}}return l}function o(s,a,l){var c;return s&&(c={},zt(s,function(u,h){if(a==="string")h===void 0?c[u]="undefined":h===null?c[u]="null":h[Zu]?c[u]=h[Zu]():c[u]="invalid field: toString() is not defined.";else if(a==="number")if(h===void 0)c[u]="undefined";else if(h===null)c[u]="null";else{var f=parseFloat(h);c[u]=f}else c[u]="invalid field: "+l+" is of unknown type.",Fe(e,1,c[u],null,!0)})),c}})}return n.__ieDyn=1,n}(),Lle=8,Ole=function(){function n(){}return n.prototype.getHashCodeScore=function(e){var t=this.getHashCode(e)/n.INT_MAX_VALUE;return t*100},n.prototype.getHashCode=function(e){if(e==="")return 0;for(;e[Bt]<Lle;)e=e[Ff](e);for(var t=5381,r=0;r<e[Bt];++r)t=(t<<5)+t+e.charCodeAt(r),t=t&t;return Math.abs(t)},n.INT_MAX_VALUE=2147483647,n}(),Dle=function(){function n(){var e=this,t=new Ole,r=new X8;e[S9]=function(i){var o=0;return i[qr]&&i[qr][r.userId]?o=t.getHashCodeScore(i[qr][r.userId]):i.ext&&i.ext.user&&i.ext.user.id?o=t[Ele](i.ext.user.id):i[qr]&&i[qr][r.operationId]?o=t.getHashCodeScore(i[qr][r.operationId]):i.ext&&i.ext.telemetryTrace&&i.ext.telemetryTrace[Dv]?o=t.getHashCodeScore(i.ext.telemetryTrace[Dv]):o=Math.random()*100,o}}return n}(),Ule=function(){function n(e,t){this.INT_MAX_VALUE=2147483647;var r=t||xh(null);(e>100||e<0)&&(r.throwInternal(2,58,"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.",{samplingRate:e},!0),e=100),this[XS]=e,this.samplingScoreGenerator=new Dle}return n.prototype.isSampledIn=function(e){var t=this[XS],r=!1;return t==null||t>=100||e.baseType===Ud[Ra]?!0:(r=this.samplingScoreGenerator[S9](e)<t,r)},n}(),kn,Ya,ua=void 0,eU="",Fle=65e3;function tU(n){try{return n.responseText}catch{}return null}function jle(n){return n&&n.sendPOST}var nU=Hm((kn={endpointUrl:LS(cS,Ek+jp)},kn[FR]=_r(),kn[w9]=15e3,kn[m9]=102400,kn.disableTelemetry=_r(),kn[v9]=_r(!0),kn.isRetryDisabled=_r(),kn[zR]=_r(!0),kn[x9]=_r(!0),kn[HR]=_r(),kn[_9]=_r(),kn[BR]=_r(),kn[_0]=ua,kn.namePrefix=ua,kn.samplingPercentage=LS(Ble,100),kn[jR]=ua,kn[y9]=ua,kn[p9]=1e4,kn[Pk]=!1,kn.httpXHROverride={isVal:jle,v:ua},kn[g9]=_r(),kn.transports=ua,kn.retryCodes=ua,kn.maxRetryCnt={isVal:c_,v:10},kn));function Ble(n){return!isNaN(n)&&n>0&&n<=100}var zle=(Ya={},Ya[Mc.dataType]=E9,Ya[Hp.dataType]=Ile,Ya[nu.dataType]=Rle,Ya[Vp.dataType]=Nle,Ya[Wo.dataType]=Ale,Ya[Ud.dataType]=Mle,Ya[Fd.dataType]=ble,Ya),Hle=function(n){Wl(e,n);function e(){var t=n.call(this)||this;t.priority=1001,t.identifier=q8;var r,i,o,s,a,l,c,u,h=0,f,m,g,_,v,p,x,y,w,C,T,S,b,R,E,A,F,D,M,k,z,P,U,Y,Z,j,X;return In(e,t,function(B,K){qt(),B.pause=function(){je(),s=!0},B.resume=function(){s&&(s=!1,i=null,V(),Ce())},B.flush=function(L,te,J){if(L===void 0&&(L=!0),!s){je();try{return B[kg](L,null,J||1)}catch(ie){Fe(B[ai](),1,22,"flush failed, telemetry will not be collected: "+an(ie),{exception:qe(ie)})}}},B.onunloadFlush=function(){if(!s)if(x||k)try{return B[kg](!0,Q,2)}catch(L){Fe(B[ai](),1,20,"failed to flush with beacon sender on page unload, telemetry will not be collected: "+an(L),{exception:qe(L)})}else B.flush(!1)},B.addHeader=function(L,te){u[L]=te},B[zb]=function(L,te,J,ie){B.isInitialized()&&Fe(B[ai](),1,28,"Sender is already initialized"),K[zb](L,te,J,ie);var ye=B.identifier;l=new kle(te.logger),r=0,i=null,o=0,B[Lg]=null,c=0;var xe=B[ai]();g=Su(cs("Sender"),te.evtNamespace&&te.evtNamespace()),m=Qae(g),B._addHook(pr(L,function($e){var Et=$e.cfg;Et.storagePrefix&&Rk(Et.storagePrefix);var En=Gs(null,Et,te),Ge=En.getExtCfg(ye,nU);_l(Ge[Og])&&(Ge[Og]=Et[Og]),_l(Ge[_0])&&(Ge[_0]=Et[_0]),en(B,"_senderConfig",{g:function(){return Ge}}),v!==Ge[Og]&&(_=v=Ge[Og]),te.activeStatus()===wc.PENDING?B.pause():te.activeStatus()===wc.ACTIVE&&B.resume(),C&&C!==Ge[jR]&&Ye(C,function(gr){delete u[gr.header]}),p=Ge[m9],x=(Ge[BR]===!1||Ge[zR]===!1)&&d0(),y=Ge[BR]===!1&&d0(),w=Ge[zR]===!1&&d0(),k=Ge[g9],z=!!Ge[HR],X=Ge.retryCodes;var Or=Ge[Pk],ti=!!Ge[v9]&&(!!Or||Lv()),eg=Ge.namePrefix,b_=ti!==A||ti&&D!==eg||ti&&F!==Or;if(B[fc]){if(b_)try{B._buffer=B._buffer[Ik](xe,Ge,ti)}catch(gr){Fe(B[ai](),1,12,"failed to transfer telemetry to different buffer storage, telemetry will be lost: "+an(gr),{exception:qe(gr)})}V()}else B[fc]=ti?new C9(xe,Ge):new kk(xe,Ge);D=eg,A=ti,F=Or,P=!Ge[_9]&&ck(!0),Z=!!Ge[x9],B._sample=new Ule(Ge.samplingPercentage,xe),S=Ge[_0],!_l(S)&&!st(S,Et)&&Fe(xe,1,100,"Invalid Instrumentation key "+S),C=Ge[jR],ht(_)&&!CR(_)&&C&&C[Bt]>0?Ye(C,function(gr){t.addHeader(gr.header,gr.value)}):C=null,M=Ge[q5];var qs=fe();j?j.SetConfig(qs):(j=new lae,j[zb](qs,xe));var $l=Ge.httpXHROverride,Cu=null,Yl=null,Nh=XD([3,1,2],Ge.transports);Cu=j&&j[Gx](Nh,!1);var Ih=j&&j.getFallbackInst();U=function(gr,Qs){return be(Ih,gr,Qs)},Y=function(gr,Qs){return be(Ih,gr,Qs,!1)},Cu=k?$l:Cu||$l||Ih,B[Lg]=function(gr,Qs){return be(Cu,gr,Qs)},P&&(f=_e);var Kl=XD([3,1],Ge[Q5]);P||(Kl=Kl.filter(function(gr){return gr!==2})),Yl=j&&j[Gx](Kl,!0),Yl=k?$l:Yl||$l,(k||Ge[Q5]||!f)&&Yl&&(f=function(gr,Qs){return be(Yl,gr,Qs)}),f||(f=U),T=Ge.disableTelemetry,b=Ge[y9]||ua,R=Ge.isRetryDisabled,E=Ge[w9]}))},B.processTelemetry=function(L,te){var J;te=B._getTelCtx(te);var ie=te[ai]();try{var ye=pt(L,ie);if(!ye)return;var xe=$(L,ie);if(!xe)return;var $e=l[Jy](xe),Et=B[fc];V($e);var En=(J={},J[YS]=$e,J.cnt=0,J);Et[jd](En),Ce()}catch(Ge){Fe(ie,2,12,"Failed adding telemetry to the sender's buffer, some telemetry will be lost: "+an(Ge),{exception:qe(Ge)})}B.processNext(L,te)},B.isCompletelyIdle=function(){return!s&&h===0&&B._buffer[Bd]()===0},B._xhrReadyStateChange=function(L,te,J){if(!me(te))return ce(L,te,J)},B[kg]=function(L,te,J){L===void 0&&(L=!0);var ie;if(!s)try{var ye=B[fc];if(T)ye[Wp]();else{if(ye[Bd]()>0){var xe=ye.getItems();St(J||0,L),te?ie=te.call(B,xe,L):ie=B[Lg](xe,L)}o=+new Date}je()}catch(Et){var $e=s8();(!$e||$e>9)&&Fe(B[ai](),1,40,"Telemetry transmission failed, some telemetry will be lost: "+an(Et),{exception:qe(Et)})}return ie},B.getOfflineSupport=function(){var L;return L={getUrl:function(){return _},createPayload:Ee},L[Jy]=ot,L.batch=se,L.shouldProcess=function(te){return!!pt(te)},L},B._doTeardown=function(L,te){B.onunloadFlush(),fp(m,!1),qt()},B[ju]=function(L,te,J){if(!me(L))return we(L,te)},B[Hb]=function(L,te){if(!me(L))return Ie(L,te)},B[Wx]=function(L,te){if(!me(L))return ft(L)},B._xdrOnLoad=function(L,te){if(!me(te))return ee(L,te)};function ee(L,te){var J=tU(L);if(L&&(J+""=="200"||J===""))r=0,B[Wx](te,0);else{var ie=_b(J);ie&&ie[Vb]&&ie[Vb]>ie[Gb]&&!R?B[Hb](te,ie):B[ju](te,n8(L))}}function fe(){var L;try{var te={xdrOnComplete:function(ie,ye,xe){var $e=_t(xe);if($e)return ee(ie,$e)},fetchOnComplete:function(ie,ye,xe,$e){var Et=_t($e);if(Et)return q(ie.status,Et,ie.url,Et[Bt],ie.statusText,xe||"")},xhrOnComplete:function(ie,ye,xe){var $e=_t(xe);if($e)return ce(ie,$e,$e[Bt])},beaconOnRetry:function(ie,ye,xe){return he(ie,ye,xe)}},J=(L={},L[q5]=M,L.isOneDs=!1,L.disableCredentials=!1,L[HR]=z,L.disableBeacon=!w,L.disableBeaconSync=!y,L.senderOnCompleteCallBack=te,L);return J}catch{}return null}function ce(L,te,J){L.readyState===4&&q(L.status,te,L.responseURL,J,IS(L),tU(L)||L.response)}function we(L,te,J){Fe(B[ai](),2,26,"Failed to send telemetry.",{message:te}),B._buffer&&B._buffer[$0](L)}function Ie(L,te){for(var J=[],ie=[],ye=te.errors.reverse(),xe=0,$e=ye;xe<$e.length;xe++){var Et=$e[xe],En=L.splice(Et.index,1)[0];Qe(Et.statusCode)?ie[Cl](En):J[Cl](En)}L[Bt]>0&&B[Wx](L,te[Gb]),J[Bt]>0&&B[ju](J,IS(null,["partial success",te[Gb],"of",te.itemsReceived].join(" "))),ie[Bt]>0&&(ze(ie),Fe(B[ai](),2,40,"Partial success. Delivered: "+L[Bt]+", Failed: "+J[Bt]+". Will retry to send "+ie[Bt]+" our of "+te[Vb]+" items"))}function ft(L,te){B._buffer&&B._buffer[$0](L)}function _t(L){try{if(L){var te=L,J=te[Wb];return J&&J[Bt]?J:null}}catch{}return null}function pt(L,te){if(T)return!1;if(!L)return te&&Fe(te,1,7,"Cannot send empty telemetry"),!1;if(L.baseData&&!L[$b])return te&&Fe(te,1,70,"Cannot send telemetry without baseData and baseType"),!1;if(L[$b]||(L[$b]="EventData"),!B[Lg])return te&&Fe(te,1,28,"Sender was not initialized"),!1;if(Te(L))L[O8]=B._sample[XS];else return te&&Fe(te,2,33,"Telemetry item was sampled out and not sent",{SampleRate:B._sample[XS]}),!1;return!0}function $(L,te){var J=L.iKey||S,ie=e.constructEnvelope(L,J,te,b);if(!ie){Fe(te,1,47,"Unable to create an AppInsights envelope");return}var ye=!1;if(L[qr]&&L[qr][wb]&&(Ye(L[qr][wb],function(xe){try{xe&&xe(ie)===!1&&(ye=!0,Od(te,"Telemetry processor check returns false"))}catch($e){Fe(te,1,64,"One of telemetry initializers failed, telemetry item will not be sent: "+an($e),{exception:qe($e)},!0)}}),delete L[qr][wb]),!ye)return ie}function ot(L){var te=eU,J=B[ai]();try{var ie=pt(L,J),ye=null;ie&&(ye=$(L,J)),ye&&(te=l[Jy](ye))}catch{}return te}function se(L){var te=eU;return L&&L[Bt]&&(te="["+L.join(",")+"]"),te}function Ee(L){var te,J=I();return te={urlString:_},te[Mi]=L,te.headers=J,te}function Te(L){return B._sample.isSampledIn(L)}function Le(L,te,J,ie){te===200&&L?B._onSuccess(L,L[Bt]):ie&&B[ju](L,ie)}function be(L,te,J,ie){ie===void 0&&(ie=!0);var ye=function(Et,En,Ge){return Le(te,Et,En,Ge)},xe=G(te),$e=L&&L.sendPOST;return $e&&xe?(ie&&B._buffer[KS](te),$e(xe,ye,!J)):null}function G(L){var te;if(Ft(L)&&L[Bt]>0){var J=B[fc].batchPayloads(L),ie=I(),ye=(te={},te[Mi]=J,te.urlString=_,te.headers=ie,te.disableXhrSync=z,te.disableFetchKeepAlive=!P,te[Wb]=L,te);return ye}return null}function I(){try{var L=u||{};return CR(_)&&(L[xn[6]]=xn[7]),L}catch{}return null}function V(L){var te=L?L[Bt]:0;return B[fc].size()+te>p?((!m||m.isOnline())&&B[kg](!0,null,10),!0):!1}function q(L,te,J,ie,ye,xe){var $e=null;if(B._appId||($e=_b(xe),$e&&$e.appId&&(B._appId=$e.appId)),(L<200||L>=300)&&L!==0){if((L===301||L===307||L===308)&&!ne(J)){B[ju](te,ye);return}if(m&&!m.isOnline()){if(!R){var Et=10;ze(te,Et),Fe(B[ai](),2,40,". Offline - Response Code: ".concat(L,". Offline status: ").concat(!m.isOnline(),". Will retry to send ").concat(te.length," items."))}return}!R&&Qe(L)?(ze(te),Fe(B[ai](),2,40,". Response code "+L+". Will retry to send "+te[Bt]+" items.")):B[ju](te,ye)}else ne(J),L===206?($e||($e=_b(xe)),$e&&!R?B[Hb](te,$e):B[ju](te,ye)):(r=0,B[Wx](te,ie))}function ne(L){return c>=10?!1:!Me(L)&&L!==""&&L!==_?(_=L,++c,!0):!1}function Q(L,te){if(f)f(L,!1);else{var J=j&&j[Gx]([3],!0);return be(J,L,te)}}function he(L,te,J){var ie=L,ye=ie&&ie[Wb];if(Z)Y&&Y(ye,!0),Fe(B[ai](),2,40,". Failed to send telemetry with Beacon API, retried with normal sender.");else{for(var xe=[],$e=0;$e<ye[Bt];$e++){var Et=ye[$e],En=[Et],Ge=G(En);J(Ge,te)?B._onSuccess(En,En[Bt]):xe[Cl](Et)}xe[Bt]>0&&(Y&&Y(xe,!0),Fe(B[ai](),2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}function me(L){try{if(L&&L[Bt])return ht(L[0])}catch{}return null}function _e(L,te){var J=null;if(Ft(L)){for(var ie=L[Bt],ye=0;ye<L[Bt];ye++)ie+=L[ye].item[Bt];var xe=j.getSyncFetchPayload();xe+ie<=Fle?J=2:d0()?J=3:(J=1,Fe(B[ai](),2,40,". Failed to send telemetry with Beacon API, retried with xhrSender."));var $e=j&&j[Gx]([J],!0);return be($e,L,te)}return null}function ze(L,te){if(te===void 0&&(te=1),!(!L||L[Bt]===0)){var J=B[fc];J[$0](L),r++;for(var ie=0,ye=L;ie<ye.length;ie++){var xe=ye[ie];xe.cnt=xe.cnt||0,xe.cnt++,J[jd](xe)}pe(te),Ce()}}function pe(L){var te=10,J;if(r<=1)J=te;else{var ie=(Math.pow(2,r)-1)/2,ye=Math.floor(Math.random()*ie*te)+1;ye=L*ye,J=Math.max(Math.min(ye,3600),te)}var xe=Pa()+J*1e3;i=xe}function Ce(){if(!a&&!s){var L=i?Math.max(0,i-Pa()):0,te=Math.max(E,L);a=ls(function(){a=null,B[kg](!0,null,1)},te)}}function je(){a&&a.cancel(),a=null,i=null}function Qe(L){return Me(X)?L===401||L===408||L===429||L===500||L===502||L===503||L===504:X[Bt]&&X.indexOf(L)>-1}function He(){var L="getNotifyMgr";return B.core[L]?B.core[L]():B.core._notificationManager}function St(L,te){var J=He();if(J&&J[Z5])try{J[Z5](L,te)}catch(ie){Fe(B[ai](),1,74,"send request notification failed: "+an(ie),{exception:qe(ie)})}}function st(L,te){var J=te.disableInstrumentationKeyValidation,ie=Me(J)?!1:J;if(ie)return!0;var ye="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",xe=new RegExp(ye);return xe.test(L)}function qt(){B[Lg]=null,B[fc]=null,B._appId=null,B._sample=null,u={},m=null,r=0,i=null,o=null,s=!1,a=null,l=null,c=0,h=0,f=null,g=null,_=null,v=null,p=0,x=!1,C=null,T=!1,S=null,b=ua,R=!1,A=null,D=ua,z=!1,P=!1,Z=!1,U=null,Y=null,j=null,en(B,"_senderConfig",{g:function(){return t8({},nU)}})}}),t}return e.constructEnvelope=function(t,r,i,o){var s;r!==t.iKey&&!Me(r)?s=Ii(Ii({},t),{iKey:r}):s=t;var a=zle[s.baseType]||E9;return a(i,s,o)},e}($m),rU="duration",zd="properties",Ns="requestUrl",x0="inst",xd="length",dl="traceID",jc="spanID",Zo="traceFlags",Y0="context",$p="aborted",ew="traceId",tw="spanId",$x="_addHook",ys="core",Kb="includeCorrelationHeaders",VR="getAbsoluteUrl",Bu="headers",Vo="requestHeaders",Xb="setRequestHeader",iU="trackDependencyDataInternal",yd="startTime",of="toLowerCase",GR="enableRequestHeaderTracking",b9="enableAjaxErrorStatusText",A9="enableAjaxPerfTracking",M9="maxAjaxCallsPerView",R9="excludeRequestFromAutoTrackingPatterns",N9="addRequestContext",WR="disableAjaxTracking",I9="ajaxPerfLookupDelay",P9="disableFetchTracking",k9="enableResponseHeaderTracking",Rs="status",cd="statusText",gp="headerMap",$R="openDone",YR="sendDone",wd="requestSentTime",KR="abortDone",XR="getTraceId",qR="getTraceFlags",Nc="method",QR="errorStatusText",L9="stateChangeAttached",oU="responseText",y0="responseFinishedTime",ZR="CreateTrackItem",O9="response",sU="getAllResponseHeaders",JR="getPartAProps",qS="perfMark",jf="name",eN="perfTiming",K0="exception",aU="ajaxDiagnosticsMessage",tN="correlationContext",qb="ajaxTotalDuration",Qb="eventTraceCtx";function D9(n,e,t){var r=0,i=n[e],o=n[t];return i&&o&&(r=Bi(i,o)),r}function zu(n,e,t,r,i){var o=0,s=D9(t,r,i);return s&&(o=gc(n,e,Rc(s))),o}function gc(n,e,t){var r="ajaxPerf",i=0;if(n&&e&&t){var o=n[r]=n[r]||{};o[e]=t,i=1}return i}function Vle(n,e){var t=n[eN],r=e[zd]||{},i=0,o="name",s="Start",a="End",l="domainLookup",c="connect",u="redirect",h="request",f="response",m="startTime",g=l+s,_=l+a,v=c+s,p=c+a,x=h+s,y=h+a,w=f+s,C=f+a,T=u+s,S=u=a,b="transferSize",R="encodedBodySize",E="decodedBodySize",A="serverTiming";if(t){i|=zu(r,u,t,T,S),i|=zu(r,l,t,g,_),i|=zu(r,c,t,v,p),i|=zu(r,h,t,x,y),i|=zu(r,f,t,w,C),i|=zu(r,"networkConnect",t,m,p),i|=zu(r,"sentRequest",t,x,C);var F=t[rU];F||(F=D9(t,m,C)||0),i|=gc(r,rU,F),i|=gc(r,"perfTotal",F);var D=t[A];if(D){var M={};Ye(D,function(k,z){var P=MS(k[o]||""+z),U=M[P]||{};zt(k,function(Y,Z){(Y!==o&&ht(Z)||c_(Z))&&(U[Y]&&(Z=U[Y]+";"+Z),(Z||!ht(Z))&&(U[Y]=Z))}),M[P]=U}),i|=gc(r,A,M)}i|=gc(r,b,t[b]),i|=gc(r,R,t[R]),i|=gc(r,E,t[E])}else n[qS]&&(i|=gc(r,"missing",n.perfAttempts));i&&(e[zd]=r)}var Gle=function(){function n(){var e=this;e[$R]=!1,e.setRequestHeaderDone=!1,e[YR]=!1,e[KR]=!1,e[L9]=!1}return n}(),lU=function(){function n(e,t,r,i){var o,s=this,a=r,l="responseText";s[qS]=null,s.completed=!1,s.requestHeadersSize=null,s[Vo]=null,s.responseReceivingDuration=null,s.callbackDuration=null,s[qb]=null,s[$p]=0,s.pageUrl=null,s[Ns]=null,s.requestSize=0,s[Nc]=null,s[Rs]=null,s[wd]=null,s.responseStartedTime=null,s[y0]=null,s.callbackFinishedTime=null,s.endTime=null,s.xhrMonitoringState=new Gle,s.clientFailure=0,s[dl]=e,s[jc]=t,s[Zo]=i==null?void 0:i.getTraceFlags(),i?s[Qb]=(o={},o[ew]=i[XR](),o[tw]=i.getSpanId(),o[Zo]=i[qR](),o):s[Qb]=null,In(n,s,function(c){c.getAbsoluteUrl=function(){return c[Ns]?Mae(c[Ns]):null},c.getPathName=function(){return c[Ns]?x1(a,Rae(c[Nc],c[Ns])):null},c[ZR]=function(u,h,f){var m;if(c.ajaxTotalDuration=Math.round(Bi(c.requestSentTime,c.responseFinishedTime)*1e3)/1e3,c[qb]<0)return null;var g=(m={id:"|"+c[dl]+"."+c[jc],target:c[VR]()},m[jf]=c.getPathName(),m.type=u,m[yd]=null,m.duration=c[qb],m.success=+c[Rs]>=200&&+c[Rs]<400,m.responseCode=+c[Rs],m[zd]={HttpMethod:c[Nc]},m),_=g[zd];if(c[$p]&&(_[$p]=!0),c[wd]&&(g[yd]=new Date,g[yd].setTime(c[wd])),Vle(c,g),h&&xl(c.requestHeaders)[xd]>0&&(_[Vo]=c[Vo]),f){var v=f();if(v){var p=v[tN];if(p&&(g.correlationContext=p),v[gp]&&xl(v.headerMap)[xd]>0&&(_.responseHeaders=v[gp]),c[QR])if(c[Rs]>=400){var x=v.type;(x===""||x==="text")&&(_.responseText=v.responseText?v[cd]+" - "+v[l]:v[cd]),x==="json"&&(_.responseText=v.response?v[cd]+" - "+JSON.stringify(v[O9]):v[cd])}else c[Rs]===0&&(_.responseText=v[cd]||"")}}return g},c[JR]=function(){var u,h=null,f=c[Qb];if(f&&(f[ew]||f[tw])){h={};var m=h[uo.TraceExt]=(u={},u[dl]=f[ew],u.parentID=f[tw],u);Me(f[Zo])||(m[Zo]=f[Zo])}return h}})}return n.__ieDyn=1,n}(),ar,X0="diagLog",ru="_ajaxData",ud="fetch",Dg="Failed to monitor XMLHttpRequest",U9=", monitoring data for this ajax call ",sf=U9+"may be incorrect.",cU=U9+"won't be sent.",uU="Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",dU="Failed to add custom defined request context as configured call back may missing a null check.",hU="Failed to calculate the duration of the ",fU=0;function Wle(){var n=rs();return!n||Me(n.Request)||Me(n.Request[ba])||Me(n[ud])?null:n[ud]}function $le(n,e){var t,r,i=!1;if(m1()){var o=XMLHttpRequest[ba];i=!Me(o)&&!Me(o.open)&&!Me(o.send)&&!Me(o.abort)}var s=s8();if(s&&s<9&&(i=!1),i)try{var a=new XMLHttpRequest,l={xh:[],i:(t={},t[e]={},t)};a[ru]=l;var c=XMLHttpRequest[ba].open;XMLHttpRequest[ba].open=c}catch(u){i=!1,q0(n,15,"Failed to enable XMLHttpRequest monitoring, extension is not supported",(r={},r[K0]=qe(u),r))}return i}var Bf=function(n,e){return n&&e&&n[ru]?(n[ru].i||{})[e]:null},Yle=function(n,e,t){if(n){var r=(n[ru]||{}).xh;r&&r.push({n:e,v:t})}},Zb=function(n,e){var t=!1;if(n){var r=(n[ru]||{}).xh;r&&Ye(r,function(i){if(i.n===e)return t=!0,-1})}return t};function nw(n,e){var t="";try{var r=Bf(n,e);r&&r[Ns]&&(t+="(url: '"+r[Ns]+"')")}catch{}return t}function q0(n,e,t,r,i){Fe(n[X0](),1,e,t,r,i)}function Ka(n,e,t,r,i){Fe(n[X0](),2,e,t,r,i)}function Ug(n,e,t){return function(r){var i;q0(n,e,t,(i={ajaxDiagnosticsMessage:nw(r[x0],n._ajaxDataId)},i[K0]=qe(r.err),i))}}function af(n,e){return n&&e?Yi(n,e):-1}function pU(n,e,t){var r={id:e,fn:t};return n.push(r),{remove:function(){Ye(n,function(i,o){if(i.id===r.id)return n.splice(o,1),-1})}}}function F9(n,e,t,r){var i=!0;return Ye(e,function(o,s){try{o.fn.call(null,t)===!1&&(i=!1)}catch(a){Fe(n&&n.logger,1,64,"Dependency "+r+" [#"+s+"] failed: "+an(a),{exception:qe(a)},!0)}}),i}function Kle(n,e,t,r,i,o){var s,a=n[xd];if(a>0){var l=(s={},s[ys]=e,s.xhr=r,s.input=i,s.init=o,s.traceId=t[dl],s.spanId=t[jc],s.traceFlags=t[Zo],s.context=t[Y0]||{},s.aborted=!!t[$p],s);F9(e,n,l,"listener"),t[dl]=l[ew],t[jc]=l[tw],t[Zo]=l[Zo],t[Y0]=l[Y0]}}var Yx="*.blob.core.",Xle=Ul([Yx+"windows.net",Yx+"chinacloudapi.cn",Yx+"cloudapi.de",Yx+"usgovcloudapi.net"]),qle=[/https:\/\/[^\/]*(\.pipe\.aria|aria\.pipe|events\.data|collector\.azure)\.[^\/]+\/(OneCollector\/1|Collector\/3)\.0/i],Qle=Ul((ar={},ar[M9]=500,ar[WR]=!1,ar[P9]=!1,ar[R9]=void 0,ar.disableCorrelationHeaders=!1,ar.distributedTracingMode=1,ar.correlationHeaderExcludedDomains=Xle,ar.correlationHeaderDomains=void 0,ar.correlationHeaderExcludePatterns=void 0,ar.appId=void 0,ar.enableCorsCorrelation=!1,ar[GR]=!1,ar[k9]=!1,ar[b9]=!1,ar[A9]=!1,ar.maxAjaxPerfLookupAttempts=3,ar[I9]=25,ar.ignoreHeaders=["Authorization","X-API-Key","WWW-Authenticate"],ar[N9]=void 0,ar.addIntEndpoints=!0,ar)),Zle=function(n){Wl(e,n);function e(){var t=n.call(this)||this;t.identifier=e.identifier,t.priority=120;var r,i,o,s,a,l,c,u,h,f,m,g,_,v,p,x,y,w,C,T,S,b,R,E,A,F,D,M,k,z;return In(e,t,function(P,U){var Y=U[$x];Z(),P.initialize=function(V,q,ne,Q){P.isInitialized()||(U.initialize(V,q,ne,Q),T=Su(cs("ajax"),q&&q.evtNamespace&&q.evtNamespace()),j(V),fe(),K(),X())},P._doTeardown=function(){Z()},P.trackDependencyData=function(V,q){I(E,P[ys],null,V,q)},P[Kb]=function(V,q,ne,Q){var he=P._currentWindowHost||o;if(Kle(R,P[ys],V,Q,q,ne),q||q===""){if(O5(s,V[VR](),he)){ne||(ne={});var me=new Headers(ne[Bu]||(q instanceof Request?q[Bu]||{}:{}));if(f){var _e="|"+V[dl]+"."+V[jc];me.set(xn[3],_e),a&&(V[Vo][xn[3]]=_e)}var ze=k||u&&u.appId();if(ze&&(me.set(xn[0],xn[2]+ze),a&&(V[Vo][xn[0]]=xn[2]+ze)),h){var pe=V[Zo];Me(pe)&&(pe=1);var Ce=h5(d5(V[dl],V[jc],pe));me.set(xn[4],Ce),a&&(V[Vo][xn[4]]=Ce)}ne[Bu]=me}return ne}else if(Q){if(O5(s,V[VR](),he)){if(f)if(Zb(Q,xn[3]))Ka(P,71,"Unable to set ["+xn[3]+"] as it has already been set by another instance");else{var _e="|"+V[dl]+"."+V[jc];Q[Xb](xn[3],_e),a&&(V[Vo][xn[3]]=_e)}var ze=k||u&&u.appId();if(ze&&(Zb(Q,xn[0])?Ka(P,71,"Unable to set ["+xn[0]+"] as it has already been set by another instance"):(Q[Xb](xn[0],xn[2]+ze),a&&(V[Vo][xn[0]]=xn[2]+ze))),h){var pe=V[Zo];if(Me(pe)&&(pe=1),Zb(Q,xn[4]))Ka(P,71,"Unable to set ["+xn[4]+"] as it has already been set by another instance");else{var Ce=h5(d5(V[dl],V[jc],pe));Q[Xb](xn[4],Ce),a&&(V[Vo][xn[4]]=Ce)}}}return Q}},P[iU]=function(V,q,ne){if(_===-1||c<_){(M===2||M===1)&&typeof V.id=="string"&&V.id[V.id[xd]-1]!=="."&&(V.id+="."),Me(V[yd])&&(V[yd]=new Date);var Q=mc(V,Fd.dataType,Fd.envelopeType,P[X0](),q,ne);P[ys].track(Q)}else c===_&&q0(P,55,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0);++c},P.addDependencyListener=function(V){return pU(R,b++,V)},P.addDependencyInitializer=function(V){return pU(E,b++,V)};function Z(){var V=wa();r=!1,i=!1,z=!1,o=V&&V.host&&V.host[of](),s=null,a=!1,l=!1,c=0,u=null,h=!1,f=!1,m=null,g=!1,_=0,v=!1,p={},x=!1,y=!1,w=null,C=null,T=null,b=0,R=[],E=[],S=cs("ajaxData"),P._ajaxDataId=S,A=null,F=1,D=1,M=1,k=null}function j(V){P[$x](pr(V,function(q){var ne=q.cfg,Q=Gs(null,ne,P[ys]);s=Q.getExtCfg(e.identifier,Qle),M=s.distributedTracingMode,a=s[GR],l=s[b9],g=s[A9],_=s[M9],w=[].concat(s[R9]||[],s.addIntEndpoints!==!1?qle:[]),C=s[N9],f=M===0||M===1,h=M===1||M===2,g&&(m=S),x=!!s[WR],F=s.maxAjaxPerfLookupAttempts,D=s[I9],A=s.ignoreHeaders,k=s.appId}))}function X(){var V=P[ys].getPlugin(S1);V&&(u=V.plugin[Y0])}function B(V){var q=!0;return(V||A)&&Ye(A,function(ne){if(ne[of]()===V[of]())return q=!1,-1}),q}function K(){var V=Wle();if(V){var q=rs(),ne=V.polyfill;P[$x](pr(s,function(){y=!!s[P9],v=s[k9],!y&&!r?(Y(TR(q,ud,{ns:T,req:function(Q,he,me){var _e;if(!y&&r&&!ce(null,he,me)&&!(ne&&i)){var ze=Q.ctx();_e=Te(he,me);var pe=P[Kb](_e,he,me);pe!==me&&Q.set(1,pe),ze.data=_e}},rsp:function(Q,he){if(!y){var me=Q.ctx().data;me&&(Q.rslt=Q.rslt.then(function(_e){return be(Q,(_e||{})[Rs],he,_e,me,function(){var ze,pe=(ze={statusText:(_e||{})[cd]},ze[gp]=null,ze[tN]=G(_e),ze);if(v&&_e){var Ce={};_e.headers.forEach(function(je,Qe){B(Qe)&&(Ce[Qe]=je)}),pe[gp]=Ce}return pe}),_e}).catch(function(_e){throw be(Q,0,he,null,me,null,{error:_e.message||qe(_e)}),_e}))}},hkErr:Ug(P,15,"Failed to monitor Window.fetch"+sf)},!0,bH())),r=!0):ne&&!z&&(Y(TR(q,ud,{ns:T,req:function(Q,he,me){ce(null,he,me)}})),z=!0)})),ne&&(q[ud].polyfill=ne)}}function ee(V,q,ne){Y(Sae(V,q,ne))}function fe(){$le(P,S)&&P[$x](pr(s,function(){x=!!s[WR],a=s[GR],!x&&!i&&(ee(XMLHttpRequest,"open",{ns:T,req:function(V,q,ne,Q){if(!x){var he=V[x0],me=Bf(he,S);!ce(he,ne)&&we(he,me,!0)&&((!me||!me.xhrMonitoringState[$R])&&(me=ft(he,q,ne,Q)),_t(he,me))}},hkErr:Ug(P,15,Dg+".open"+sf)}),ee(XMLHttpRequest,"send",{ns:T,req:function(V,q){if(!x){var ne=V[x0],Q=Bf(ne,S);we(ne,Q)&&!Q.xhrMonitoringState[YR]&&(se("xhr",Q),Q[wd]=zx(),P[Kb](Q,void 0,void 0,ne),Q.xhrMonitoringState[YR]=!0)}},hkErr:Ug(P,17,Dg+sf)}),ee(XMLHttpRequest,"abort",{ns:T,req:function(V){if(!x){var q=V[x0],ne=Bf(q,S);we(q,ne)&&!ne.xhrMonitoringState[KR]&&(ne[$p]=1,ne.xhrMonitoringState[KR]=!0)}},hkErr:Ug(P,13,Dg+".abort"+sf)}),ee(XMLHttpRequest,"setRequestHeader",{ns:T,req:function(V,q,ne){if(!x){var Q=V[x0],he=Bf(Q,S);he&&we(Q,he)&&(Yle(Q,q,ne),a&&B(q)&&he&&(he[Vo][q]=ne))}},hkErr:Ug(P,71,Dg+".setRequestHeader"+sf)}),i=!0)}))}function ce(V,q,ne){var Q=!1,he=((ht(q)?q:(q||{}).url||"")||"")[of]();if(Ye(w,function(ze){var pe=ze;ht(ze)&&(pe=new RegExp(ze)),Q||(Q=pe.test(he))}),Q)return Q;var me=af(he,"?"),_e=af(he,"#");return(me===-1||_e!==-1&&_e<me)&&(me=_e),me!==-1&&(he=he.substring(0,me)),Me(V)?Me(q)||(Q=(typeof q=="object"?q[jx]===!0:!1)||(ne?ne[jx]===!0:!1)):Q=V[jx]===!0||he[jx]===!0,!Q&&he&&CR(he)&&(Q=!0),Q?p[he]||(p[he]=1):p[he]&&(Q=!0),Q}function we(V,q,ne){var Q=!0,he=i;return Me(V)||(Q=ne===!0||!Me(q)),he&&Q}function Ie(){var V=null;return P[ys]&&P[ys].getTraceCtx&&(V=P[ys].getTraceCtx(!1)),!V&&u&&u.telemetryTrace&&(V=bk(u.telemetryTrace)),V}function ft(V,q,ne,Q){var he,me=Ie(),_e=me&&me[XR]()||Uc(),ze=bc(Uc(),0,16),pe=V[ru]=V[ru]||{xh:[],i:{}},Ce=pe.i=pe.i||{},je=Ce[S]=Ce[S]||new lU(_e,ze,P[X0](),(he=P.core)===null||he===void 0?void 0:he.getTraceCtx());return je[Zo]=me&&me[qR](),je[Nc]=q,je[Ns]=ne,je.xhrMonitoringState[$R]=!0,je[Vo]={},je.async=Q,je[QR]=l,je}function _t(V,q){q.xhrMonitoringState[L9]=El(V,"readystatechange",function(){var ne;try{V&&V.readyState===4&&we(V,q)&&$(V)}catch(he){var Q=qe(he);(!Q||af(Q[of](),"c00c023f")===-1)&&q0(P,16,Dg+" 'readystatechange' event handler"+sf,(ne={},ne[aU]=nw(V,S),ne[K0]=Q,ne))}},T)}function pt(V){try{var q=V.responseType;if(q===""||q==="text")return V[oU]}catch{}return null}function $(V){var q=Bf(V,S);q[y0]=zx(),q[Rs]=V[Rs];function ne(Q,he){var me=he||{};me.ajaxDiagnosticsMessage=nw(V,S),Q&&(me.exception=qe(Q)),Ka(P,14,hU+"ajax call"+cU,me)}Ee("xmlhttprequest",q,function(){try{var Q=q[ZR]("Ajax",a,function(){var pe,Ce=(pe={statusText:V[cd]},pe[gp]=null,pe[tN]=ot(V),pe.type=V.responseType,pe[oU]=pt(V),pe.response=V[O9],pe);if(v){var je=V[sU]();if(je){var Qe=Er(je).split(/[\r\n]+/),He={};Ye(Qe,function(St){var st=St.split(": "),qt=st.shift(),L=st.join(": ");B(qt)&&(He[qt]=L)}),Ce[gp]=He}}return Ce}),he=void 0;try{C&&(he=C({status:V[Rs],xhr:V}))}catch{Ka(P,104,dU)}if(Q){he!==void 0&&(Q[zd]=Ii(Ii({},Q.properties),he));var me=q[JR]();I(E,P[ys],q,Q,null,me)}else ne(null,{requestSentTime:q[wd],responseFinishedTime:q[y0]})}finally{try{var _e=V[ru]||{i:{}},ze=_e.i||{};ze[S]&&(ze[S]=null)}catch{}}},function(Q){ne(Q,null)})}function ot(V){var q;try{var ne=V[sU]();if(ne!==null){var Q=af(ne[of](),xn[8]);if(Q!==-1){var he=V.getResponseHeader(xn[0]);return D5(he)}}}catch(me){Ka(P,18,uU,(q={},q[aU]=nw(V,S),q[K0]=qe(me),q))}}function se(V,q){if(q[Ns]&&m&&g){var ne=Fl();if(ne&&Mt(ne.mark)){fU++;var Q=m+V+"#"+fU;ne.mark(Q);var he=ne.getEntriesByName(Q);he&&he[xd]===1&&(q[qS]=he[0])}}}function Ee(V,q,ne,Q){var he=q[qS],me=Fl(),_e=F,ze=D,pe=q[Ns],Ce=0;(function je(){try{if(me&&he){Ce++;for(var Qe=null,He=me.getEntries(),St=He[xd]-1;St>=0;St--){var st=He[St];if(st){if(st.entryType==="resource")st.initiatorType===V&&(af(st[jf],pe)!==-1||af(pe,st[jf])!==-1)&&(Qe=st);else if(st.entryType==="mark"&&st[jf]===he[jf]){q[eN]=Qe;break}if(st[yd]<he[yd]-1e3)break}}}!he||q[eN]||Ce>=_e||q.async===!1?(he&&Mt(me.clearMarks)&&me.clearMarks(he[jf]),q.perfAttempts=Ce,ne()):ls(je,ze)}catch(qt){Q(qt)}})()}function Te(V,q){var ne,Q=Ie(),he=Q&&Q[XR]()||Uc(),me=bc(Uc(),0,16),_e=new lU(he,me,P[X0](),(ne=P.core)===null||ne===void 0?void 0:ne.getTraceCtx());_e[Zo]=Q&&Q[qR](),_e[wd]=zx(),_e[QR]=l;var ze;if(V instanceof Request?ze=(V||{}).url||"":ze=V,ze===""){var pe=wa();pe&&pe.href&&(ze=kH(pe.href,"#")[0])}_e[Ns]=ze;var Ce="GET";q&&q[Nc]?Ce=q[Nc]:V&&V instanceof Request&&(Ce=V[Nc]),_e[Nc]=Ce;var je={};if(a){var Qe=new Headers((q?q[Bu]:0)||(V instanceof Request?V[Bu]||{}:{}));Qe.forEach(function(He,St){B(St)&&(je[St]=He)})}return _e[Vo]=je,se(ud,_e),_e}function Le(V){var q="";try{Me(V)||(typeof V=="string"?q+="(url: '".concat(V,"')"):q+="(url: '".concat(V.url,"')"))}catch(ne){q0(P,15,"Failed to grab failed fetch diagnostics message",{exception:qe(ne)})}return q}function be(V,q,ne,Q,he,me,_e){if(!he)return;function ze(pe,Ce,je){var Qe=je||{};Qe.fetchDiagnosticsMessage=Le(ne),Ce&&(Qe.exception=qe(Ce)),Ka(P,pe,hU+"fetch call"+cU,Qe)}he[y0]=zx(),he[Rs]=q,Ee(ud,he,function(){var pe=he[ZR]("Fetch",a,me),Ce;try{C&&(Ce=C({status:q,request:ne,response:Q}))}catch{Ka(P,104,dU)}if(pe){Ce!==void 0&&(pe[zd]=Ii(Ii({},pe.properties),Ce));var je=he[JR]();I(E,P[ys],he,pe,null,je)}else ze(14,null,{requestSentTime:he[wd],responseFinishedTime:he[y0]})},function(pe){ze(18,pe,null)})}function G(V){var q;if(V&&V[Bu])try{var ne=V[Bu].get(xn[0]);return D5(ne)}catch(Q){Ka(P,18,uU,(q={fetchDiagnosticsMessage:Le(V)},q[K0]=qe(Q),q))}}function I(V,q,ne,Q,he,me){var _e,ze=!0,pe=V[xd];if(pe>0){var Ce=(_e={item:Q},_e[zd]=he,_e.sysProperties=me,_e.context=ne?ne[Y0]:null,_e.aborted=ne?!!ne[$p]:!1,_e);ze=F9(q,V,Ce,"initializer")}ze&&P[iU](Q,he,me)}}),t}return e.prototype.processTelemetry=function(t,r){this.processNext(t,r)},e.prototype.addDependencyInitializer=function(t){return null},e.identifier="AjaxDependencyPlugin",e}($m),Jle=function(){function n(){}return n}(),ece=function(){function n(){this.id="browser",this.deviceClass="Browser"}return n}(),tce="3.3.3",nce=function(){function n(e,t){var r=this,i=pr(e,function(){var o=e.sdkExtension;r.sdkVersion=(o?o+"_":"")+"javascript:"+tce});t&&t.add(i)}return n}(),rce=function(){function n(){}return n}(),QS="sessionManager",ZS="update",rw="isUserCookieSet",JS="isNewUser",Jb="getTraceCtx",nN="telemetryTrace",j9="applySessionContext",B9="applyApplicationContext",z9="applyDeviceContext",H9="applyOperationContext",V9="applyUserContext",G9="applyOperatingSystemContxt",W9="applyLocationContext",$9="applyInternalContext",dd="accountId",iw="getSessionId",Lk="namePrefix",ice="sessionCookiePostfix",Y9="userCookiePostfix",eE="idLength",Ok="getNewId",tE="length",zf="automaticSession",Hf="authenticatedId",Fg="acquisitionDate",Kx="renewalDate",Q0="join",jg="cookieSeparator",e2="authUserCookieName",oce="ai_session",sce=864e5,ace=18e5,lce=6e4,K9=function(){function n(){}return n}(),cce=function(){function n(e,t,r){var i=this,o,s,a=xh(t),l=mk(t),c,u;In(n,i,function(h){e||(e={});var f=pr(e,function(x){c=e.sessionExpirationMs||sce,u=e.sessionRenewalMs||ace;var y=e.sessionCookiePostfix||e[Lk]||"";o=oce+y});r&&r.add(f),h[zf]=new K9,h[ZS]=function(){var x=Pa(),y=!1,w=h[zf];if(w.id||(y=!m(w)),!y&&c>0){var C=x-w[Fg],T=x-w[Kx];y=C<0||T<0,y=y||C>c,y=y||T>u}y?_(x):(!s||x-s>lce)&&v(w,x)},h.backup=function(){var x=h[zf];p(x.id,x[Fg],x[Kx])};function m(x,y){var w=!1,C=l.get(o);if(C&&Mt(C.split))w=g(x,C);else{var T=H8(a,o);T&&(w=g(x,T))}return w||!!x.id}function g(x,y){var w=!1,C=", session will be reset",T=y.split("|");if(T[tE]>=2)try{var S=+T[1]||0,b=+T[2]||0;isNaN(S)||S<=0?Fe(a,2,27,"AI session acquisition date is 0"+C):isNaN(b)||b<=0?Fe(a,2,27,"AI session renewal date is 0"+C):T[0]&&(x.id=T[0],x[Fg]=S,x[Kx]=b,w=!0)}catch(R){Fe(a,1,9,"Error parsing ai_session value ["+(y||"")+"]"+C+" - "+an(R),{exception:qe(R)})}return w}function _(x){var y=e[Ok]||uk;h.automaticSession.id=y(e[eE]||22),h[zf][Fg]=x,v(h[zf],x),w1()||Fe(a,2,0,"Browser does not support local storage. Session durations will be inaccurate.")}function v(x,y){var w=x[Fg];x[Kx]=y;var C=u,T=w+c-y,S=[x.id,w,y],b=0;T<C?b=T/1e3:b=C/1e3;var R=e.cookieDomain||null;l.set(o,S[Q0]("|"),c>0?b:null,R),s=y}function p(x,y,w){V8(a,o,[x,y,w][Q0]("|"))}})}return n.__ieDyn=1,n}(),uce=function(){function n(e,t,r,i){var o=this;o.traceID=e||Uc(),o.parentID=t;var s=wa();!r&&s&&s.pathname&&(r=s.pathname),o.name=Cr(i,r)}return n}();function mU(n){return!(typeof n!="string"||!n||n.match(/,|;|=| |\|/))}var dce=function(){function n(e,t,r){this.isNewUser=!1,this.isUserCookieSet=!1;var i=xh(t),o=mk(t),s;In(n,this,function(a){en(a,"config",{g:function(){return e}});var l=pr(e,function(){var f=e[Y9]||"";s=n.userCookieName+f;var m=o.get(s);if(m){a[JS]=!1;var g=m.split(n[jg]);g[tE]>0&&(a.id=g[0],a[rw]=!!a.id)}if(!a.id){a.id=c();var _=u(a.id);h(_[Q0](n[jg]));var v=(e[Lk]||"")+"ai_session";Uae(i,v)}a[dd]=e[dd]||void 0;var p=o.get(n[e2]);if(p){p=decodeURI(p);var x=p.split(n[jg]);x[0]&&(a[Hf]=x[0]),x[tE]>1&&x[1]&&(a[dd]=x[1])}});r&&r.add(l);function c(){var f=e||{},m=f[Ok]||uk,g=m(f[eE]?e[eE]:22);return g}function u(f){var m=wm(new Date);a.accountAcquisitionDate=m,a[JS]=!0;var g=[f,m];return g}function h(f){var m=31536e3;a[rw]=o.set(s,f,m)}a.setAuthenticatedUserContext=function(f,m,g){g===void 0&&(g=!1);var _=!mU(f)||m&&!mU(m);if(_){Fe(i,2,60,"Setting auth user context failed. User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.",!0);return}a[Hf]=f;var v=a[Hf];m&&(a[dd]=m,v=[a[Hf],a.accountId][Q0](n[jg])),g&&o.set(n[e2],encodeURI(v))},a.clearAuthenticatedUserContext=function(){a[Hf]=null,a[dd]=null,o.del(n[e2])},a[ZS]=function(f){if(a.id!==f||!a[rw]){var m=f||c(),g=u(m);h(g[Q0](n[jg]))}}})}return n.cookieSeparator="|",n.userCookieName="ai_user",n.authUserCookieName="ai_authUser",n}(),Xx="ext",qx="tags";function lf(n,e){n&&n[e]&&xl(n[e])[tE]===0&&delete n[e]}function gU(){return null}var hce=function(){function n(e,t,r,i){var o=this,s=e.logger;In(n,this,function(a){if(a.appId=gU,a[iw]=gU,a.application=new Jle,a.internal=new nce(t,i),h1()){a[QS]=new cce(t,e,i),a.device=new ece,a.location=new rce,a.user=new dce(t,e,i);var l=void 0,c=void 0,u;r&&(l=r.getTraceId(),c=r.getSpanId(),u=r.getName()),a[nN]=new uce(l,c,u,s),a.session=new K9}a[iw]=function(){var h=a.session,f=null;if(h&&ht(h.id))f=h.id;else{var m=(a[QS]||{})[zf];f=m&&ht(m.id)?m.id:null}return f},a[j9]=function(h,f){Tn(Ti(h.ext,uo.AppExt),"sesId",a[iw](),ht)},a[G9]=function(h,f){Tn(h.ext,uo.OSExt,a.os)},a[B9]=function(h,f){var m=a.application;if(m){var g=Ti(h,qx);Tn(g,Rn.applicationVersion,m.ver,ht),Tn(g,Rn.applicationBuild,m.build,ht)}},a[z9]=function(h,f){var m=a.device;if(m){var g=Ti(Ti(h,Xx),uo.DeviceExt);Tn(g,"localId",m.id,ht),Tn(g,"ip",m.ip,ht),Tn(g,"model",m.model,ht),Tn(g,"deviceClass",m.deviceClass,ht)}},a[$9]=function(h,f){var m=a.internal;if(m){var g=Ti(h,qx);Tn(g,Rn.internalAgentVersion,m.agentVersion,ht),Tn(g,Rn.internalSdkVersion,Cr(s,m.sdkVersion,64),ht),(h.baseType===Pv.dataType||h.baseType===nu.dataType)&&(Tn(g,Rn.internalSnippet,m.snippetVer,ht),Tn(g,Rn.internalSdkSrc,m.sdkSrc,ht))}},a[W9]=function(h,f){var m=o.location;m&&Tn(Ti(h,qx,[]),Rn.locationIp,m.ip,ht)},a[H9]=function(h,f){var m=a[nN];if(m){var g=Ti(Ti(h,Xx),uo.TraceExt,{traceID:void 0,parentID:void 0});Tn(g,"traceID",m.traceID,ht,Me),Tn(g,"name",m.name,ht,Me),Tn(g,"parentID",m.parentID,ht,Me)}},a.applyWebContext=function(h,f){var m=o.web;m&&Tn(Ti(h,Xx),uo.WebExt,m)},a[V9]=function(h,f){var m=a.user;if(m){var g=Ti(h,qx,[]);Tn(g,Rn.userAccountId,m[dd],ht);var _=Ti(Ti(h,Xx),uo.UserExt);Tn(_,"id",m.id,ht),Tn(_,"authId",m[Hf],ht)}},a.cleanUp=function(h,f){var m=h.ext;m&&(lf(m,uo.DeviceExt),lf(m,uo.UserExt),lf(m,uo.WebExt),lf(m,uo.OSExt),lf(m,uo.AppExt),lf(m,uo.TraceExt))}})}return n.__ieDyn=1,n}(),li,t2,cf=null,fce=Hm((li={},li[dd]=cf,li.sessionRenewalMs=30*60*1e3,li.samplingPercentage=100,li.sessionExpirationMs=24*60*60*1e3,li.cookieDomain=cf,li.sdkExtension=cf,li.isBrowserLinkTrackingEnabled=!1,li.appId=cf,li[iw]=cf,li[Lk]=t2,li[ice]=t2,li[Y9]=t2,li[eE]=22,li[Ok]=cf,li)),pce=function(n){Wl(e,n);function e(){var t=n.call(this)||this;t.priority=110,t.identifier=S1;var r,i,o,s,a;return In(e,t,function(l,c){u(),en(l,"context",{g:function(){return s}}),l.initialize=function(m,g,_,v){c.initialize(m,g,_,v),h(m)},l.processTelemetry=function(m,g){if(!Me(m)){g=l._getTelCtx(g),m.name===nu.envelopeType&&g.diagLog().resetInternalMessageCount();var _=s||{};_.session&&typeof s.session.id!="string"&&_[QS]&&_[QS][ZS]();var v=_.user;if(v&&!v[rw]&&v[ZS](_.user.id),f(m,g),v&&v[JS]&&(v[JS]=!1,!a)){var p=new Pv(72,(ja()||{}).userAgent||"");bse(g.diagLog(),1,p)}l.processNext(m,g)}},l._doTeardown=function(m,g){var _=(m||{}).core();if(_&&_[Jb]){var v=_[Jb](!1);v===i&&_.setTraceCtx(o)}u()};function u(){r=null,i=null,o=null,s=null,a=!0}function h(m){var g=l.identifier,_=l.core;l._addHook(pr(m,function(){var v=Gs(null,m,_);m.storagePrefix&&Rk(m.storagePrefix),a=m.disableUserInitMessage!==!1,r=v.getExtCfg(g,fce),l._extConfig=r})),o=_[Jb](!1),s=new hce(_,r,o,l._unloadHooks),i=bk(l.context[nN],o),_.setTraceCtx(i),l.context.appId=function(){var v=_.getPlugin(q8);return v?v.plugin._appId:null}}function f(m,g){Ti(m,"tags",[]),Ti(m,"ext",{});var _=l.context;_[j9](m,g),_[B9](m,g),_[z9](m,g),_[H9](m,g),_[V9](m,g),_[G9](m,g),_.applyWebContext(m,g),_[W9](m,g),_[$9](m,g),_.cleanUp(m,g)}}),t}return e.__ieDyn=1,e}($m),X9="AuthenticatedUserContext",Ym="track",rN="snippet",mce="getCookieMgr",gce="startTrackPage",vce="stopTrackPage",n2="flush",_ce="startTrackEvent",xce="stopTrackEvent",yce="addTelemetryInitializer",vU="pollInternalLogs",r2="getPlugin",i2="evtNamespace",wce=Ym+"Event",Sce=Ym+"Trace",Ece=Ym+"Metric",Tce=Ym+"PageView",Cce=Ym+"Exception",bce=Ym+"DependencyData",Ace="set"+X9,Mce="clear"+X9,Rce="https://js.monitor.azure.com/scripts/b/ai.config.1.cfg.json",o2="version",Hu="queue",ow="connectionString",w0="instrumentationKey",_U="instrumentationkey",Vf="userOverrideEndpointUrl",sw="endpointUrl",xU="ingestionendpoint",Bg="onunloadFlush",zo="context",yU="addHousekeepingBeforeUnload",s2="sendMessage",Nce="updateSnippetDefinitions",na,zg,uf,a2,Hg,wU=[rN,"dependencies","properties","_snippetVersion","appInsightsNew","getSKUDefaults"],q9="iKeyUsage",Q9="CdnUsage",Z9="SdkLoaderVer",Qx=void 0,Ice={samplingRate:100,maxSendNumber:1},Pce={monthInterval:3,daysOfMonth:[28]},Zx={disabled:!0,limit:bs(Ice),interval:bs(Pce)},kce=(na={},na[ow]=Qx,na[sw]=Qx,na[w0]=Qx,na[Vf]=Qx,na.diagnosticLogInterval=LS(Lce,1e4),na.featureOptIn=(zg={},zg[q9]={mode:3},zg[Q9]={mode:2},zg[Z9]={mode:2},zg),na.throttleMgrCfg=bs((uf={},uf[109]=bs(Zx),uf[106]=bs(Zx),uf[111]=bs(Zx),uf[110]=bs(Zx),uf)),na.extensionConfig=bs((a2={},a2.AppInsightsCfgSyncPlugin=bs({cfgUrl:Rce,syncMode:2}),a2)),na);function Lce(n){return n&&n>0}var Oce=function(){function n(e){var t=this,r,i,o,s,a,l,c,u,h,f,m,g,_,v;In(n,this,function(p){w(),en(p,"config",{g:function(){return u}}),Ye(["pluginVersionStringArr","pluginVersionString"],function(S){en(p,S,{g:function(){return c?c[S]:null}})}),s=""+(e.sv||e[o2]||""),e[Hu]=e[Hu]||[],e[o2]=e[o2]||2;var x=us(e.config||{},kce);u=x.cfg,h=new ple,en(p,"appInsights",{g:function(){return h}}),i=new pce,r=new Zle,o=new Hle,c=new sae,en(p,"core",{g:function(){return c}}),T(pr(x,function(){var S=u[ow];function b(){return V0(function(D,M){Bl(S,function(k){var z=k&&k.value,P=null;!k.rejected&&z&&(u[ow]=z,P=U5(z)),D(P)})})}if(_l(S)){var R=V0(function(D,M){b().then(function(k){var z=u[w0];z=k&&k[_U]||z,D(z)}).catch(function(k){D(null)})}),E=u[Vf];Me(E)&&(E=V0(function(D,M){b().then(function(k){var z=u[sw],P=k&&k[xU];z=P?P+jp:z,D(z)}).catch(function(k){D(null)})})),u[w0]=R,u[sw]=E}if(ht(S)&&S){var A=U5(S),F=A[xU];u.endpointUrl=u[Vf]?u[Vf]:F+jp,u[w0]=A[_U]||u[w0]}u.endpointUrl=u[Vf]?u[Vf]:u[sw]})),p[rN]=e,p[n2]=function(S,b){S===void 0&&(S=!0);var R;return FS(c,function(){return"AISKU.flush"},function(){S&&!b&&(R=uu(function(F){b=F}));var E=1,A=function(){E--,E===0&&b()};Ye(c.getChannels(),function(F){F&&(E++,F[n2](S,A))}),A()},null,S),R},p[Bg]=function(S){S===void 0&&(S=!0),Ye(c.getChannels(),function(b){b[Bg]?b[Bg]():b[n2](S)})},p.loadAppInsights=function(S,b,R){S===void 0&&(S=!1),S&&Uie("Legacy Mode is no longer supported");function E(A){if(A){var F="";Me(s)||(F+=s),p[zo]&&p[zo].internal&&(p[zo].internal.snippetVer=F||"-"),zt(p,function(D,M){ht(D)&&!Mt(M)&&D&&D[0]!=="_"&&xi(wU,D)===-1&&A[D]!==M&&(A[D]=M)})}}return FS(p.core,function(){return"AISKU.loadAppInsights"},function(){c.initialize(u,[o,i,r,h,f],b,R),en(p,"context",{g:function(){return i[zo]}}),m||(m=new jae(c));var A=Dce();A&&p[zo]&&(p[zo].internal.sdkSrc=A),E(p[rN]),p.emptyQueue(),p[vU](),p[yU](p),T(pr(x,function(){var F=!1;u.throttleMgrCfg[109]&&(F=!u.throttleMgrCfg[109].disabled),!m.isReady()&&u.extensionConfig&&u.extensionConfig[f.identifier]&&F&&m.onReadyState(!0);var D;!g&&!u[ow]&&tb(q9,u)&&(D=m[s2](106,"See Instrumentation key support at aka.ms/IkeyMigrate"),g=!0),!_&&p[zo].internal.sdkSrc&&p[zo].internal.sdkSrc.indexOf("az416426")!=-1&&tb(Q9,u)&&(D=m[s2](110,"See Cdn support notice at aka.ms/JsActiveCdn"),_=!0),!v&&parseInt(s)<6&&tb(Z9,u)&&(D=m[s2](111,"An updated Sdk Loader is available, see aka.ms/SnippetVer"),v=!0)}))}),p},p[Nce]=function(S){Moe(S,p,function(b){return b&&xi(wU,b)===-1})},p.emptyQueue=function(){try{if(Ft(p.snippet[Hu])){for(var S=p.snippet[Hu].length,b=0;b<S;b++){var R=p.snippet[Hu][b];R()}p.snippet[Hu]=void 0,delete p.snippet[Hu]}}catch(A){var E={};A&&Mt(A.toString)&&(E.exception=A.toString())}},p[yU]=function(S){if(h1()||TH()){var b=function(){if(S[Bg](!1),Mt(p.core[r2])){var E=t.core[r2](S1);if(E){var A=E.plugin;A&&A[zo]&&A[zo]._sessionManager&&A[zo]._sessionManager.backup()}}},R=!1;l||(l=Su(a,c[i2]&&c[i2]())),T(pr(u,function(E){var A=E.cfg,F=S.appInsights,D=Gs(null,A,F.core),M=D.getExtCfg(F.identifier||Q8);C();var k=A.disablePageUnloadEvents;M.disableFlushOnBeforeUnload||(_ae(b,k,l)&&(R=!0),ER(b,k,l)&&(R=!0),!R&&!Yoe()&&Fe(c.logger,1,19,"Could not add handler for beforeunload and pagehide")),!R&&!M.disableFlushOnUnload&&ER(b,k,l)}))}},p.getSender=function(){return o},p.unload=function(S,b,R){var E=!1,A;S&&!b&&(A=uu(function(D){b=D}));function F(D){E||(E=!0,w(),b&&b(D))}return p[Bg](S),C(),c.unload&&c.unload(S,F,R),A},u0(p,h,[mce,wce,Tce,"trackPageViewPerformance",Cce,"_onerror",Sce,Ece,gce,vce,_ce,xce]),u0(p,y,[bce,"addDependencyListener","addDependencyInitializer"]),u0(p,c,[yce,vU,"stopPollingInternalLogs",r2,"addPlugin",i2,"addUnloadCb","getTraceCtx","updateCfg","onCfgChange"]),u0(p,function(){var S=i[zo];return S?S.user:null},[Ace,Mce]);function y(){return r}function w(){a=cs("AISKU"),l=null,r=null,i=null,o=null,s=null,m=null,g=!1,_=!1,v=!1,f=new Sle}function C(){l&&(xae(null,l),yae(null,l))}function T(S){c.addUnloadHook(S)}})}return n.prototype.addDependencyInitializer=function(e){return null},n}();function Dce(){if(Hg)return Hg;var n=null,e=!1,t=["://js.monitor.azure.com/","://az416426.vo.msecnd.net/"];try{var r=(document||{}).currentScript;r&&(n=r.src)}catch{}if(n){try{var i=n.toLowerCase();if(i){var o="";Ye(t,function(s,a){if(Yi(i,s)!==-1)return o="cdn"+(a+1),Yi(i,"/scripts/")===-1&&(Yi(i,"/next/")!==-1?o+="-next":Yi(i,"/beta/")!==-1&&(o+="-beta")),Hg=o+(e?".mod":""),-1})}}catch{}Hg=n}return Hg}function Uce(n){if(!n)return{};const e=n.split(".")[1];if(!e)return{};const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(window.atob(t).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(r)}let iN;async function Fce(){if(!eP()){console.warn("Not configured for blob storage, running local mode only"),document.title="WEB3d - local mode only",Re.setState({selectedLayerTitle:"WEB3d - local mode only",localMode:!0});return}try{const n=await Ua(!0),e=await fH();if(!e)return;const t=Uce(e),r=location.host.toLocaleLowerCase().includes("localhost");if(n.ENV__AZURE_APP_INSIGHT&&!r){const i=new Oce({config:{connectionString:n.ENV__AZURE_APP_INSIGHT}});i.loadAppInsights(),i.trackPageView(),i.setAuthenticatedUserContext(t.oid),i.addTelemetryInitializer(o=>{o.tags&&(o.tags["ai.cloud.role"]=location.host)}),iN=i}else console.error("Missing insight config")}catch(n){console.error("ApplicationInsights",n)}}class jce{static selectedProject(e,t,r){iN&&iN.trackEvent({name:"PROJECT_SELECTED",properties:{projectCode:e,projectLayer:`${e} - ${t}`,userOID:r,domain:location.host,atDate:new Date().toISOString()}})}}let ho;const J9="PROJECT_SELECTOR_STATE",SU=localStorage.getItem(J9);SU&&(ho=JSON.parse(SU));function e7(){const n=Re.getState();localStorage.setItem(J9,JSON.stringify({projectFilter:n.projectFilter,projectSelectedKey:n.projectSelectedKey,projectSelectedCode:n.projectSelectedCode,projectSelectedName:n.projectSelectedName}))}const Re=mr(n=>({allProjects:[],filteredProjects:[],projectFilter:(ho==null?void 0:ho.projectFilter)||"",projectSelectedKey:(ho==null?void 0:ho.projectSelectedKey)||null,projectSelectedCode:(ho==null?void 0:ho.projectSelectedCode)||null,projectSelectedName:(ho==null?void 0:ho.projectSelectedName)||null,selectedLayer:null,selectedLayerTitle:null,selectedProject:null,isOpen:!1,localMode:!1,setAllProjects:async e=>{const t=Re.getState(),r=e.filter(i=>i.unique_key===t.projectSelectedKey)[0];if(r){const i=await zP(r.container,r.config,r.unique_key,r.plant_code,r.plant_name);Re.setState({selectedProject:i,projectSelectedKey:r.unique_key,projectSelectedCode:r.plant_code,projectSelectedName:r.plant_name})}Re.setState({allProjects:e}),Re.getState().runFilter()},runFilter:()=>{const e=Re.getState();e7();const t=e.allProjects.filter(r=>{if(r.dev_only&&!GN)return!1;if(!e.projectFilter||r.plant_code.toUpperCase().includes(e.projectFilter.toUpperCase())||r.plant_name.toUpperCase().includes(e.projectFilter.toUpperCase()))return!0});t.sort((r,i)=>{const o=r.plant_code+r.plant_name,s=i.plant_code+i.plant_name;return o<s?-1:o>s?1:0}),n(r=>({...r,filteredProjects:t}))},activateProjectSelectDialog:()=>n(()=>({isOpen:!0})),deactivateProjectSelectDialog:()=>n(()=>({isOpen:!1}))}));let EU;Re.subscribe(async n=>{var t,r,i,o,s,a,l,c,u;if(!((t=n.selectedLayer)!=null&&t.name)||!((r=n.selectedProject)!=null&&r.plant_code))return;const e=`${((i=n.selectedProject)==null?void 0:i.plant_code)||"UNKNOWN"} - ${((o=n.selectedLayer)==null?void 0:o.name)||"UNKNOWN"}`;if(EU!==e){EU=e;const f=(await Ip()).getActiveAccount();f&&(console.log(`Project:${((s=n.selectedProject)==null?void 0:s.plant_code)||"UNKNOWN"} - ${((a=n.selectedLayer)==null?void 0:a.name)||"UNKNOWN"}`),jce.selectedProject(((l=n.selectedProject)==null?void 0:l.plant_code)||"UNKNOWN",((c=n.selectedLayer)==null?void 0:c.name)||"UNKNOWN",((u=f==null?void 0:f.idTokenClaims)==null?void 0:u.oid)||"UNKNOWN"))}});function TU(n){if(!window.customElements.get("orientation-gizmo"))window.customElements.define("orientation-gizmo",q3);else{const t=document.getElementById("gizmo");t&&document.body.removeChild(t)}n.__orientationGizmo=new q3(n.__activeCamera,{size:150,padding:8,bubbleSizePrimary:12,bubbleSizeSeconday:12,showSecondary:!0,lineWidth:2,fontSize:"11px",fontFamily:"arial",fontWeight:"bold",fontColor:"#151515",colors:{x:["#f73c3c","#942424"],y:["#6ccb26","#417a17"],z:["#178cf0","#0e5490"]}}),n.__orientationGizmo.id="gizmo";const e=n.__orientationGizmo;e.onAxisSelected=async t=>{var f,m,g,_,v,p,x,y,w,C,T,S,b,R;const r=n.getSceneController().sceneBoundingBox,i=Re.getState();(m=(f=i.selectedProject)==null?void 0:f.boundingbox)!=null&&m.length&&(r.min=new N((_=(g=i.selectedProject)==null?void 0:g.boundingbox)==null?void 0:_[0],(p=(v=i.selectedProject)==null?void 0:v.boundingbox)==null?void 0:p[1],(y=(x=i.selectedProject)==null?void 0:x.boundingbox)==null?void 0:y[2]),r.max=new N((C=(w=i.selectedProject)==null?void 0:w.boundingbox)==null?void 0:C[3],(S=(T=i.selectedProject)==null?void 0:T.boundingbox)==null?void 0:S[4],(R=(b=i.selectedProject)==null?void 0:b.boundingbox)==null?void 0:R[5]));const o=Xe.getState();if(o.enabled&&(r.max=new N(o.maxX,o.maxY,o.maxZ),r.min=new N(o.minX,o.minY,o.minZ)),!r.max)return;const s=new nt(r.min,r.max);if(!s.max)return;n.getActiveControls().smoothTime=.5,n.getActiveControls().saveState();const a=Math.PI*.5,l=Math.PI,c=E=>{switch(E){case"front":return n.getActiveControls().rotateTo(0,a,!0);case"back":return n.getActiveControls().rotateTo(l,a,!0);case"up":return n.getActiveControls().rotateTo(0,0,!0);case"down":return n.getActiveControls().rotateTo(0,l,!0);case"right":return n.getActiveControls().rotateTo(a,a,!0);case"left":return n.getActiveControls().rotateTo(-a,a,!0)}};let u;switch(t.axis){case"x":n.__lastmove==="right"&&!t.noSmartLogic?(u=c("left"),n.__lastmove="left"):(u=c("right"),n.__lastmove="right");break;case"-x":n.__lastmove==="left"&&!t.noSmartLogic?(u=c("right"),n.__lastmove="right"):(u=c("left"),n.__lastmove="left");break;case"z":n.__lastmove==="up"&&!t.noSmartLogic?(u=c("down"),n.__lastmove="down"):(u=c("up"),n.__lastmove="up");break;case"-z":n.__lastmove==="down"&&!t.noSmartLogic?(u=c("up"),n.__lastmove="up"):(u=c("down"),n.__lastmove="down");break;case"y":n.__lastmove==="back"&&!t.noSmartLogic?(u=c("front"),n.__lastmove="front"):(u=c("back"),n.__lastmove="back");break;case"-y":n.__lastmove==="front"&&!t.noSmartLogic?(u=c("back"),n.__lastmove="back"):(u=c("front"),n.__lastmove="front");break}const h=n.getActiveControls().fitToBox(s,!0,{paddingBottom:25,paddingLeft:25,paddingTop:25,paddingRight:25});Promise.all([u,h]).then(()=>{n.getActiveControls().smoothTime=1,n.getActiveControls().saveState()})},document.body.appendChild(n.__orientationGizmo)}/*!
 * hold-event
 * https://github.com/yomotsu/hold-event
 * (c) 2020 @yomotsu
 * Released under the MIT License.
 */var Lt;(function(n){n.HOLD_START="holdStart",n.HOLD_END="holdEnd",n.HOLDING="holding"})(Lt||(Lt={}));let Bce=class{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}removeEventListener(e,t){const i=this._listeners[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}dispatchEvent(e){const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let o=0,s=i.length;o<s;o++)i[o].call(this,e)}}};class t7 extends Bce{constructor(e){super(),this._enabled=!0,this._holding=!1,this._intervalId=-1,this._deltaTime=0,this._elapsedTime=0,this._lastTime=0,this._holdStart=t=>{if(!this._enabled||this._holding)return;this._deltaTime=0,this._elapsedTime=0,this._lastTime=performance.now(),this.dispatchEvent({type:Lt.HOLD_START,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:t}),this._holding=!0;const r=()=>{this._intervalId=this.holdIntervalDelay?window.setTimeout(r,this.holdIntervalDelay):window.requestAnimationFrame(r);const i=performance.now();this._deltaTime=i-this._lastTime,this._elapsedTime+=this._deltaTime,this._lastTime=performance.now(),this.dispatchEvent({type:Lt.HOLDING,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:t})};this._intervalId=this.holdIntervalDelay?window.setTimeout(r,this.holdIntervalDelay):window.requestAnimationFrame(r)},this._holdEnd=t=>{if(!this._enabled||!this._holding)return;const r=performance.now();this._deltaTime=r-this._lastTime,this._elapsedTime+=this._deltaTime,this._lastTime=performance.now(),this.dispatchEvent({type:Lt.HOLD_END,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:t}),window.clearTimeout(this._intervalId),window.cancelAnimationFrame(this._intervalId),this._holding=!1},this.holdIntervalDelay=e}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._enabled||this._holdEnd())}get holding(){return this._holding}}class df extends t7{constructor(e,t){super(t),this._activePointerIds=[];const r=a=>{this._holdStart(a)},i=a=>{this._activePointerIds.length=0,this._holdEnd(a)},o=a=>{this._activePointerIds.push(a.pointerId),r(a)},s=a=>{const l=this._activePointerIds.indexOf(a.pointerId);l!==-1&&(this._activePointerIds.splice(l,1),this._activePointerIds.length===0&&i(a))};e.addEventListener("pointerdown",o),document.addEventListener("pointerup",s),window.addEventListener("blur",i)}}class hf extends t7{constructor(e,t){if(typeof e!="string"){console.error("KeyboardKeyHold: the first argument has to be a KeyboardEvent.code string.");return}super(t),this._holdStart=this._holdStart.bind(this),this._holdEnd=this._holdEnd.bind(this);const r=o=>{zce(o)||o.code===e&&this._holdStart(o)},i=o=>{o.code===e&&this._holdEnd(o)};document.addEventListener("keydown",r),document.addEventListener("keyup",i),window.addEventListener("blur",this._holdEnd)}}function zce(n){const e=n.target;return e.tagName==="INPUT"||e.tagName==="SELECT"||e.tagName==="TEXTAREA"||e.isContentEditable}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Yn={LEFT:1,RIGHT:2,MIDDLE:4},ve=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),ff={NONE:0,IN:1,OUT:-1};function Vu(n){return n.isPerspectiveCamera}function vc(n){return n.isOrthographicCamera}const pf=Math.PI*2,CU=Math.PI/2,n7=1e-5,Vg=Math.PI/180;function ws(n,e,t){return Math.max(e,Math.min(t,n))}function An(n,e=n7){return Math.abs(n)<e}function un(n,e,t=n7){return An(n-e,t)}function bU(n,e){return Math.round(n/e)*e}function Gg(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Wg(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function Jx(n,e,t,r,i=1/0,o){r=Math.max(1e-4,r);const s=2/r,a=s*o,l=1/(1+a+.48*a*a+.235*a*a*a);let c=n-e;const u=e,h=i*r;c=ws(c,-h,h),e=n-c;const f=(t.value+s*c)*o;t.value=(t.value-s*f)*l;let m=e+(c+f)*l;return u-n>0==m>u&&(m=u,t.value=(m-u)/o),m}function AU(n,e,t,r,i=1/0,o,s){r=Math.max(1e-4,r);const a=2/r,l=a*o,c=1/(1+l+.48*l*l+.235*l*l*l);let u=e.x,h=e.y,f=e.z,m=n.x-u,g=n.y-h,_=n.z-f;const v=u,p=h,x=f,y=i*r,w=y*y,C=m*m+g*g+_*_;if(C>w){const k=Math.sqrt(C);m=m/k*y,g=g/k*y,_=_/k*y}u=n.x-m,h=n.y-g,f=n.z-_;const T=(t.x+a*m)*o,S=(t.y+a*g)*o,b=(t.z+a*_)*o;t.x=(t.x-a*T)*c,t.y=(t.y-a*S)*c,t.z=(t.z-a*b)*c,s.x=u+(m+T)*c,s.y=h+(g+S)*c,s.z=f+(_+b)*c;const R=v-n.x,E=p-n.y,A=x-n.z,F=s.x-v,D=s.y-p,M=s.z-x;return R*F+E*D+A*M>0&&(s.x=v,s.y=p,s.z=x,t.x=(s.x-v)/o,t.y=(s.y-p)/o,t.z=(s.z-x)/o),s}function l2(n,e){e.set(0,0),n.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=n.length,e.y/=n.length}function c2(n,e){return vc(n)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}let Hce=class{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let o=0,s=i.length;o<s;o++)i[o].call(this,e)}}};var u2;const Vce="2.9.0",ey=1/8,Gce=/Mac/.test((u2=globalThis==null?void 0:globalThis.navigator)===null||u2===void 0?void 0:u2.platform);let yt,MU,ty,d2,ji,kt,nn,mf,$g,ra,ia,Gu,RU,NU,Ho,Yg,gf,IU,h2,PU,f2,p2,ny;class Fr extends Hce{static install(e){yt=e.THREE,MU=Object.freeze(new yt.Vector3(0,0,0)),ty=Object.freeze(new yt.Vector3(0,1,0)),d2=Object.freeze(new yt.Vector3(0,0,1)),ji=new yt.Vector2,kt=new yt.Vector3,nn=new yt.Vector3,mf=new yt.Vector3,$g=new yt.Vector3,ra=new yt.Vector3,ia=new yt.Vector3,Gu=new yt.Vector3,RU=new yt.Vector3,NU=new yt.Vector3,Ho=new yt.Spherical,Yg=new yt.Spherical,gf=new yt.Box3,IU=new yt.Box3,h2=new yt.Sphere,PU=new yt.Quaternion,f2=new yt.Quaternion,p2=new yt.Matrix4,ny=new yt.Raycaster}static get ACTION(){return ve}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=ve.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=ff.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new yt.Vector3,this._focalOffsetVelocity=new yt.Vector3,this._zoomVelocity={value:0},this._truckInternal=(p,x,y)=>{let w,C;if(Vu(this._camera)){const T=kt.copy(this._camera.position).sub(this._target),S=this._camera.getEffectiveFOV()*Vg,b=T.length()*Math.tan(S*.5);w=this.truckSpeed*p*b/this._elementRect.height,C=this.truckSpeed*x*b/this._elementRect.height}else if(vc(this._camera)){const T=this._camera;w=p*(T.right-T.left)/T.zoom/this._elementRect.width,C=x*(T.top-T.bottom)/T.zoom/this._elementRect.height}else return;this.verticalDragToForward?(y?this.setFocalOffset(this._focalOffsetEnd.x+w,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(w,0,!0),this.forward(-C,!0)):y?this.setFocalOffset(this._focalOffsetEnd.x+w,this._focalOffsetEnd.y+C,this._focalOffsetEnd.z,!0):this.truck(w,C,!0)},this._rotateInternal=(p,x)=>{const y=pf*this.azimuthRotateSpeed*p/this._elementRect.height,w=pf*this.polarRotateSpeed*x/this._elementRect.height;this.rotate(y,w,!0)},this._dollyInternal=(p,x,y)=>{const w=Math.pow(.95,-p*this.dollySpeed),C=this._sphericalEnd.radius,T=this._sphericalEnd.radius*w,S=ws(T,this.minDistance,this.maxDistance),b=S-T;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(T,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(b,!0),this._dollyToNoClamp(S,!0)):this._dollyToNoClamp(S,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?T:S)-C,this._dollyControlCoord.set(x,y)),this._lastDollyDirection=Math.sign(-p)},this._zoomInternal=(p,x,y)=>{const w=Math.pow(.95,p*this.dollySpeed),C=this._zoom,T=this._zoom*w;this.zoomTo(T,!0),this.dollyToCursor&&(this._changedZoom+=T-C,this._dollyControlCoord.set(x,y))},typeof yt>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new yt.Quaternion().setFromUnitVectors(this._camera.up,ty),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=ve.NONE,this._target=new yt.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new yt.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new yt.Spherical().setFromVector3(kt.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new yt.Vector3,new yt.Vector3,new yt.Vector3,new yt.Vector3],this._updateNearPlaneCorners(),this._boundary=new yt.Box3(new yt.Vector3(-1/0,-1/0,-1/0),new yt.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new yt.Vector2,this.mouseButtons={left:ve.ROTATE,middle:ve.DOLLY,right:ve.TRUCK,wheel:Vu(this._camera)?ve.DOLLY:vc(this._camera)?ve.ZOOM:ve.NONE},this.touches={one:ve.TOUCH_ROTATE,two:Vu(this._camera)?ve.TOUCH_DOLLY_TRUCK:vc(this._camera)?ve.TOUCH_ZOOM_TRUCK:ve.NONE,three:ve.TOUCH_TRUCK};const r=new yt.Vector2,i=new yt.Vector2,o=new yt.Vector2,s=p=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const w=this._domElement.getBoundingClientRect(),C=p.clientX/w.width,T=p.clientY/w.height;if(C<this._interactiveArea.left||C>this._interactiveArea.right||T<this._interactiveArea.top||T>this._interactiveArea.bottom)return}const x=p.pointerType!=="mouse"?null:(p.buttons&Yn.LEFT)===Yn.LEFT?Yn.LEFT:(p.buttons&Yn.MIDDLE)===Yn.MIDDLE?Yn.MIDDLE:(p.buttons&Yn.RIGHT)===Yn.RIGHT?Yn.RIGHT:null;if(x!==null){const w=this._findPointerByMouseButton(x);w&&this._disposePointer(w)}if((p.buttons&Yn.LEFT)===Yn.LEFT&&this._lockedPointer)return;const y={pointerId:p.pointerId,clientX:p.clientX,clientY:p.clientY,deltaX:0,deltaY:0,mouseButton:x};this._activePointers.push(y),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,f(p)},a=p=>{p.cancelable&&p.preventDefault();const x=p.pointerId,y=this._lockedPointer||this._findPointerById(x);if(y){if(y.clientX=p.clientX,y.clientY=p.clientY,y.deltaX=p.movementX,y.deltaY=p.movementY,this._state=0,p.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(p.buttons&Yn.LEFT)===Yn.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(p.buttons&Yn.MIDDLE)===Yn.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(p.buttons&Yn.RIGHT)===Yn.RIGHT&&(this._state=this._state|this.mouseButtons.right);m()}},l=p=>{const x=this._findPointerById(p.pointerId);if(!(x&&x===this._lockedPointer)){if(x&&this._disposePointer(x),p.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=ve.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=ve.NONE;g()}};let c=-1;const u=p=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===ve.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const T=this._domElement.getBoundingClientRect(),S=p.clientX/T.width,b=p.clientY/T.height;if(S<this._interactiveArea.left||S>this._interactiveArea.right||b<this._interactiveArea.top||b>this._interactiveArea.bottom)return}if(p.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===ve.ROTATE||this.mouseButtons.wheel===ve.TRUCK){const T=performance.now();c-T<1e3&&this._getClientRect(this._elementRect),c=T}const x=Gce?-1:-3,y=p.deltaMode===1?p.deltaY/x:p.deltaY/(x*10),w=this.dollyToCursor?(p.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(p.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case ve.ROTATE:{this._rotateInternal(p.deltaX,p.deltaY),this._isUserControllingRotate=!0;break}case ve.TRUCK:{this._truckInternal(p.deltaX,p.deltaY,!1),this._isUserControllingTruck=!0;break}case ve.OFFSET:{this._truckInternal(p.deltaX,p.deltaY,!0),this._isUserControllingOffset=!0;break}case ve.DOLLY:{this._dollyInternal(-y,w,C),this._isUserControllingDolly=!0;break}case ve.ZOOM:{this._zoomInternal(-y,w,C),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},h=p=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Fr.ACTION.NONE){const x=p instanceof PointerEvent?p.pointerId:0,y=this._findPointerById(x);y&&this._disposePointer(y),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}p.preventDefault()}},f=p=>{if(!this._enabled)return;if(l2(this._activePointers,ji),this._getClientRect(this._elementRect),r.copy(ji),i.copy(ji),this._activePointers.length>=2){const y=ji.x-this._activePointers[1].clientX,w=ji.y-this._activePointers[1].clientY,C=Math.sqrt(y*y+w*w);o.set(0,C);const T=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,S=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(T,S)}if(this._state=0,!p)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in p&&p.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(p.buttons&Yn.LEFT)===Yn.LEFT&&(this._state=this._state|this.mouseButtons.left),(p.buttons&Yn.MIDDLE)===Yn.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(p.buttons&Yn.RIGHT)===Yn.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&ve.ROTATE)===ve.ROTATE||(this._state&ve.TOUCH_ROTATE)===ve.TOUCH_ROTATE||(this._state&ve.TOUCH_DOLLY_ROTATE)===ve.TOUCH_DOLLY_ROTATE||(this._state&ve.TOUCH_ZOOM_ROTATE)===ve.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&ve.TRUCK)===ve.TRUCK||(this._state&ve.TOUCH_TRUCK)===ve.TOUCH_TRUCK||(this._state&ve.TOUCH_DOLLY_TRUCK)===ve.TOUCH_DOLLY_TRUCK||(this._state&ve.TOUCH_ZOOM_TRUCK)===ve.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&ve.DOLLY)===ve.DOLLY||(this._state&ve.TOUCH_DOLLY)===ve.TOUCH_DOLLY||(this._state&ve.TOUCH_DOLLY_TRUCK)===ve.TOUCH_DOLLY_TRUCK||(this._state&ve.TOUCH_DOLLY_OFFSET)===ve.TOUCH_DOLLY_OFFSET||(this._state&ve.TOUCH_DOLLY_ROTATE)===ve.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&ve.ZOOM)===ve.ZOOM||(this._state&ve.TOUCH_ZOOM)===ve.TOUCH_ZOOM||(this._state&ve.TOUCH_ZOOM_TRUCK)===ve.TOUCH_ZOOM_TRUCK||(this._state&ve.TOUCH_ZOOM_OFFSET)===ve.TOUCH_ZOOM_OFFSET||(this._state&ve.TOUCH_ZOOM_ROTATE)===ve.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&ve.OFFSET)===ve.OFFSET||(this._state&ve.TOUCH_OFFSET)===ve.TOUCH_OFFSET||(this._state&ve.TOUCH_DOLLY_OFFSET)===ve.TOUCH_DOLLY_OFFSET||(this._state&ve.TOUCH_ZOOM_OFFSET)===ve.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},m=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,l2(this._activePointers,ji);const x=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,y=x?-x.deltaX:i.x-ji.x,w=x?-x.deltaY:i.y-ji.y;if(i.copy(ji),((this._state&ve.ROTATE)===ve.ROTATE||(this._state&ve.TOUCH_ROTATE)===ve.TOUCH_ROTATE||(this._state&ve.TOUCH_DOLLY_ROTATE)===ve.TOUCH_DOLLY_ROTATE||(this._state&ve.TOUCH_ZOOM_ROTATE)===ve.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(y,w),this._isUserControllingRotate=!0),(this._state&ve.DOLLY)===ve.DOLLY||(this._state&ve.ZOOM)===ve.ZOOM){const C=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,T=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0,S=this.dollyDragInverted?-1:1;(this._state&ve.DOLLY)===ve.DOLLY?(this._dollyInternal(S*w*ey,C,T),this._isUserControllingDolly=!0):(this._zoomInternal(S*w*ey,C,T),this._isUserControllingZoom=!0)}if((this._state&ve.TOUCH_DOLLY)===ve.TOUCH_DOLLY||(this._state&ve.TOUCH_ZOOM)===ve.TOUCH_ZOOM||(this._state&ve.TOUCH_DOLLY_TRUCK)===ve.TOUCH_DOLLY_TRUCK||(this._state&ve.TOUCH_ZOOM_TRUCK)===ve.TOUCH_ZOOM_TRUCK||(this._state&ve.TOUCH_DOLLY_OFFSET)===ve.TOUCH_DOLLY_OFFSET||(this._state&ve.TOUCH_ZOOM_OFFSET)===ve.TOUCH_ZOOM_OFFSET||(this._state&ve.TOUCH_DOLLY_ROTATE)===ve.TOUCH_DOLLY_ROTATE||(this._state&ve.TOUCH_ZOOM_ROTATE)===ve.TOUCH_ZOOM_ROTATE){const C=ji.x-this._activePointers[1].clientX,T=ji.y-this._activePointers[1].clientY,S=Math.sqrt(C*C+T*T),b=o.y-S;o.set(0,S);const R=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,E=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&ve.TOUCH_DOLLY)===ve.TOUCH_DOLLY||(this._state&ve.TOUCH_DOLLY_ROTATE)===ve.TOUCH_DOLLY_ROTATE||(this._state&ve.TOUCH_DOLLY_TRUCK)===ve.TOUCH_DOLLY_TRUCK||(this._state&ve.TOUCH_DOLLY_OFFSET)===ve.TOUCH_DOLLY_OFFSET?(this._dollyInternal(b*ey,R,E),this._isUserControllingDolly=!0):(this._zoomInternal(b*ey,R,E),this._isUserControllingZoom=!0)}((this._state&ve.TRUCK)===ve.TRUCK||(this._state&ve.TOUCH_TRUCK)===ve.TOUCH_TRUCK||(this._state&ve.TOUCH_DOLLY_TRUCK)===ve.TOUCH_DOLLY_TRUCK||(this._state&ve.TOUCH_ZOOM_TRUCK)===ve.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(y,w,!1),this._isUserControllingTruck=!0),((this._state&ve.OFFSET)===ve.OFFSET||(this._state&ve.TOUCH_OFFSET)===ve.TOUCH_OFFSET||(this._state&ve.TOUCH_DOLLY_OFFSET)===ve.TOUCH_DOLLY_OFFSET||(this._state&ve.TOUCH_ZOOM_OFFSET)===ve.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(y,w,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},g=()=>{l2(this._activePointers,ji),i.copy(ji),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",_),this._domElement.ownerDocument.addEventListener("pointerlockerror",v),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),f())},this.unlockPointer=()=>{var p,x,y;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(p=this._domElement)===null||p===void 0||p.ownerDocument.exitPointerLock(),(x=this._domElement)===null||x===void 0||x.ownerDocument.removeEventListener("pointerlockchange",_),(y=this._domElement)===null||y===void 0||y.ownerDocument.removeEventListener("pointerlockerror",v),this.cancel()};const _=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},v=()=>{this.unlockPointer()};this._addAllEventListeners=p=>{this._domElement=p,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",s),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",u,{passive:!1}),this._domElement.addEventListener("contextmenu",h)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",s),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",u,{passive:!1}),this._domElement.removeEventListener("contextmenu",h),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",_),this._domElement.ownerDocument.removeEventListener("pointerlockerror",v))},this.cancel=()=>{this._state!==ve.NONE&&(this._state=ve.NONE,this._activePointers.length=0,g())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=ws(e.width,0,1),this._interactiveArea.height=ws(e.height,0,1),this._interactiveArea.x=ws(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=ws(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,r=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,r)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,r=!1){this._isUserControllingRotate=!1;const i=ws(e,this.minAzimuthAngle,this.maxAzimuthAngle),o=ws(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=o,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,r||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const s=!r||un(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&un(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(s)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=ff.NONE,this._changedDolly=0,this._dollyToNoClamp(ws(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const r=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const s=this._collisionTest(),a=un(s,this._spherical.radius);if(!(r>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,s)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const o=!t||un(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(o)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection($g).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const r=!t||un(this._target.x,this._targetEnd.x,this.restThreshold)&&un(this._target.y,this._targetEnd.y,this.restThreshold)&&un(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=ws(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const r=!t||un(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(r)}pan(e,t,r=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,r)}truck(e,t,r=!1){this._camera.updateMatrix(),ra.setFromMatrixColumn(this._camera.matrix,0),ia.setFromMatrixColumn(this._camera.matrix,1),ra.multiplyScalar(e),ia.multiplyScalar(-t);const i=kt.copy(ra).add(ia),o=nn.copy(this._targetEnd).add(i);return this.moveTo(o.x,o.y,o.z,r)}forward(e,t=!1){kt.setFromMatrixColumn(this._camera.matrix,0),kt.crossVectors(this._camera.up,kt),kt.multiplyScalar(e);const r=nn.copy(this._targetEnd).add(kt);return this.moveTo(r.x,r.y,r.z,t)}elevate(e,t=!1){return kt.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+kt.x,this._targetEnd.y+kt.y,this._targetEnd.z+kt.z,t)}moveTo(e,t,r,i=!1){this._isUserControllingTruck=!1;const o=kt.set(e,t,r).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,o,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const s=!i||un(this._target.x,this._targetEnd.x,this.restThreshold)&&un(this._target.y,this._targetEnd.y,this.restThreshold)&&un(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}lookInDirectionOf(e,t,r,i=!1){const a=kt.set(e,t,r).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,i)}fitToBox(e,t,{cover:r=!1,paddingLeft:i=0,paddingRight:o=0,paddingBottom:s=0,paddingTop:a=0}={}){const l=[],c=e.isBox3?gf.copy(e):gf.setFromObject(e);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const u=bU(this._sphericalEnd.theta,CU),h=bU(this._sphericalEnd.phi,CU);l.push(this.rotateTo(u,h,t));const f=kt.setFromSpherical(this._sphericalEnd).normalize(),m=PU.setFromUnitVectors(f,d2),g=un(Math.abs(f.y),1);g&&m.multiply(f2.setFromAxisAngle(ty,u)),m.multiply(this._yAxisUpSpaceInverse);const _=IU.makeEmpty();nn.copy(c.min).applyQuaternion(m),_.expandByPoint(nn),nn.copy(c.min).setX(c.max.x).applyQuaternion(m),_.expandByPoint(nn),nn.copy(c.min).setY(c.max.y).applyQuaternion(m),_.expandByPoint(nn),nn.copy(c.max).setZ(c.min.z).applyQuaternion(m),_.expandByPoint(nn),nn.copy(c.min).setZ(c.max.z).applyQuaternion(m),_.expandByPoint(nn),nn.copy(c.max).setY(c.min.y).applyQuaternion(m),_.expandByPoint(nn),nn.copy(c.max).setX(c.min.x).applyQuaternion(m),_.expandByPoint(nn),nn.copy(c.max).applyQuaternion(m),_.expandByPoint(nn),_.min.x-=i,_.min.y-=s,_.max.x+=o,_.max.y+=a,m.setFromUnitVectors(d2,f),g&&m.premultiply(f2.invert()),m.premultiply(this._yAxisUpSpace);const v=_.getSize(kt),p=_.getCenter(nn).applyQuaternion(m);if(Vu(this._camera)){const x=this.getDistanceToFitBox(v.x,v.y,v.z,r);l.push(this.moveTo(p.x,p.y,p.z,t)),l.push(this.dollyTo(x,t)),l.push(this.setFocalOffset(0,0,0,t))}else if(vc(this._camera)){const x=this._camera,y=x.right-x.left,w=x.top-x.bottom,C=r?Math.max(y/v.x,w/v.y):Math.min(y/v.x,w/v.y);l.push(this.moveTo(p.x,p.y,p.z,t)),l.push(this.zoomTo(C,t)),l.push(this.setFocalOffset(0,0,0,t))}return Promise.all(l)}fitToSphere(e,t){const r=[],o="isObject3D"in e?Fr.createBoundingSphere(e,h2):h2.copy(e);if(r.push(this.moveTo(o.center.x,o.center.y,o.center.z,t)),Vu(this._camera)){const s=this.getDistanceToFitSphere(o.radius);r.push(this.dollyTo(s,t))}else if(vc(this._camera)){const s=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,l=2*o.radius,c=Math.min(s/l,a/l);r.push(this.zoomTo(c,t))}return r.push(this.setFocalOffset(0,0,0,t)),Promise.all(r)}setLookAt(e,t,r,i,o,s,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=ff.NONE,this._changedDolly=0;const l=nn.set(i,o,s),c=kt.set(e,t,r);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(c.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const u=!a||un(this._target.x,this._targetEnd.x,this.restThreshold)&&un(this._target.y,this._targetEnd.y,this.restThreshold)&&un(this._target.z,this._targetEnd.z,this.restThreshold)&&un(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&un(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&un(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(e,t,r,i,o,s,a,l,c,u,h,f,m,g=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=ff.NONE,this._changedDolly=0;const _=kt.set(i,o,s),v=nn.set(e,t,r);Ho.setFromVector3(v.sub(_).applyQuaternion(this._yAxisUpSpace));const p=mf.set(u,h,f),x=nn.set(a,l,c);Yg.setFromVector3(x.sub(p).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(_.lerp(p,m));const y=Yg.theta-Ho.theta,w=Yg.phi-Ho.phi,C=Yg.radius-Ho.radius;this._sphericalEnd.set(Ho.radius+C*m,Ho.phi+w*m,Ho.theta+y*m),this.normalizeRotations(),this._needsUpdate=!0,g||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const T=!g||un(this._target.x,this._targetEnd.x,this.restThreshold)&&un(this._target.y,this._targetEnd.y,this.restThreshold)&&un(this._target.z,this._targetEnd.z,this.restThreshold)&&un(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&un(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&un(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(T)}setPosition(e,t,r,i=!1){return this.setLookAt(e,t,r,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,r,i=!1){const o=this.getPosition(kt),s=this.setLookAt(o.x,o.y,o.z,e,t,r,i);return this._sphericalEnd.phi=ws(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),s}setFocalOffset(e,t,r,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,r),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const o=!i||un(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&un(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&un(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}setOrbitPoint(e,t,r){this._camera.updateMatrixWorld(),ra.setFromMatrixColumn(this._camera.matrixWorldInverse,0),ia.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Gu.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=kt.set(e,t,r),o=i.distanceTo(this._camera.position),s=i.sub(this._camera.position);ra.multiplyScalar(s.x),ia.multiplyScalar(s.y),Gu.multiplyScalar(s.z),kt.copy(ra).add(ia).add(Gu),kt.z=kt.z+o,this.dollyTo(o,!1),this.setFocalOffset(-kt.x,kt.y,-kt.z,!1),this.moveTo(e,t,r,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,r,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new yt.Vector4,typeof e=="number"?this._viewport.set(e,t,r,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,r,i=!1){if(c2(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const o=e/t,s=this._camera.getEffectiveFOV()*Vg,a=this._camera.aspect;return((i?o>a:o<a)?t:e/a)*.5/Math.tan(s*.5)+r*.5}getDistanceToFitSphere(e){if(c2(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Vg,r=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:r;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new yt.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new yt.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new yt.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new yt.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%pf,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=pf),this._spherical.theta+=pf*Math.round((this._sphericalEnd.theta-this._spherical.theta)/pf)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!un(this._camera.up.x,this._cameraUp0.x)||!un(this._camera.up.y,this._cameraUp0.y)||!un(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const r=this.getPosition(kt);this.updateCameraUp(),this.setPosition(r.x,r.y,r.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,ty),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=kt.subVectors(this._target,this._camera.position).normalize(),t=nn.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const r=this.getPosition(kt);this.updateCameraUp(),this.setPosition(r.x,r.y,r.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,r=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,o=RU.subVectors(this._targetEnd,this._target),s=NU.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(An(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Jx(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,e),this._needsUpdate=!0}if(An(r))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Jx(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,e),this._needsUpdate=!0}if(An(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Jx(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,e),this._needsUpdate=!0}if(An(o.x)&&An(o.y)&&An(o.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;AU(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(An(s.x)&&An(s.y)&&An(s.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;AU(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(An(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Jx(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,e)}if(this.dollyToCursor){if(Vu(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,f=this._camera,m=this._getCameraDirection($g),g=kt.copy(m).cross(f.up).normalize();g.lengthSq()===0&&(g.x=1);const _=nn.crossVectors(g,m),v=this._sphericalEnd.radius*Math.tan(f.getEffectiveFOV()*Vg*.5),x=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,y=mf.copy(this._targetEnd).add(g.multiplyScalar(this._dollyControlCoord.x*v*f.aspect)).add(_.multiplyScalar(this._dollyControlCoord.y*v)),w=kt.copy(this._targetEnd).lerp(y,x),C=this._lastDollyDirection===ff.IN&&this._spherical.radius<=this.minDistance,T=this._lastDollyDirection===ff.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(C||T)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const b=nn.copy(m).multiplyScalar(-h);w.add(b)}this._boundary.clampPoint(w,w);const S=nn.subVectors(w,this._targetEnd);this._targetEnd.copy(w),this._target.add(S),this._changedDolly-=h,An(this._changedDolly)&&(this._changedDolly=0)}else if(vc(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,f=this._camera,m=kt.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(f.near+f.far)/(f.near-f.far)).unproject(f),g=nn.set(0,0,-1).applyQuaternion(f.quaternion),_=mf.copy(m).add(g.multiplyScalar(-m.dot(f.up))),p=-(this._zoom-h-this._zoom)/this._zoom,x=this._getCameraDirection($g),y=this._targetEnd.dot(x),w=kt.copy(this._targetEnd).lerp(_,p),C=w.dot(x),T=x.multiplyScalar(C-y);w.sub(T),this._boundary.clampPoint(w,w);const S=nn.subVectors(w,this._targetEnd);this._targetEnd.copy(w),this._target.add(S),this._changedZoom-=h,An(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!An(this._focalOffset.x)||!An(this._focalOffset.y)||!An(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),ra.setFromMatrixColumn(this._camera.matrix,0),ia.setFromMatrixColumn(this._camera.matrix,1),Gu.setFromMatrixColumn(this._camera.matrix,2),ra.multiplyScalar(this._focalOffset.x),ia.multiplyScalar(-this._focalOffset.y),Gu.multiplyScalar(this._focalOffset.z),kt.copy(ra).add(ia).add(Gu),this._camera.position.add(kt)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),kt.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const u=this._needsUpdate;return u&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):u?(this.dispatchEvent({type:"update"}),An(t,this.restThreshold)&&An(r,this.restThreshold)&&An(i,this.restThreshold)&&An(o.x,this.restThreshold)&&An(o.y,this.restThreshold)&&An(o.z,this.restThreshold)&&An(s.x,this.restThreshold)&&An(s.y,this.restThreshold)&&An(s.z,this.restThreshold)&&An(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!u&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=u,this._needsUpdate=!1,u}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Gg(this.maxDistance),minZoom:this.minZoom,maxZoom:Gg(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Gg(this.maxPolarAngle),minAzimuthAngle:Gg(this.minAzimuthAngle),maxAzimuthAngle:Gg(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:kt.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const r=JSON.parse(e);this.enabled=r.enabled,this.minDistance=r.minDistance,this.maxDistance=Wg(r.maxDistance),this.minZoom=r.minZoom,this.maxZoom=Wg(r.maxZoom),this.minPolarAngle=r.minPolarAngle,this.maxPolarAngle=Wg(r.maxPolarAngle),this.minAzimuthAngle=Wg(r.minAzimuthAngle),this.maxAzimuthAngle=Wg(r.maxAzimuthAngle),this.smoothTime=r.smoothTime,this.draggingSmoothTime=r.draggingSmoothTime,this.dollySpeed=r.dollySpeed,this.truckSpeed=r.truckSpeed,this.dollyToCursor=r.dollyToCursor,this.verticalDragToForward=r.verticalDragToForward,this._target0.fromArray(r.target0),this._position0.fromArray(r.position0),this._zoom0=r.zoom0,this._focalOffset0.fromArray(r.focalOffset0),this.moveTo(r.target[0],r.target[1],r.target[2],t),Ho.setFromVector3(kt.fromArray(r.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Ho.theta,Ho.phi,t),this.dollyTo(Ho.radius,t),this.zoomTo(r.zoom,t),this.setFocalOffset(r.focalOffset[0],r.focalOffset[1],r.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Vce),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,r){const i=t.lengthSq();if(i===0)return e;const o=nn.copy(t).add(e),a=this._boundary.clampPoint(o,mf).sub(o),l=a.lengthSq();if(l===0)return e.add(t);if(l===i)return e;if(r===0)return e.add(t).add(a);{const c=1+r*l/t.dot(a);return e.add(nn.copy(t).multiplyScalar(c)).add(a.multiplyScalar(1-r))}}_updateNearPlaneCorners(){if(Vu(this._camera)){const e=this._camera,t=e.near,r=e.getEffectiveFOV()*Vg,i=Math.tan(r*.5)*t,o=i*e.aspect;this._nearPlaneCorners[0].set(-o,-i,0),this._nearPlaneCorners[1].set(o,-i,0),this._nearPlaneCorners[2].set(o,i,0),this._nearPlaneCorners[3].set(-o,i,0)}else if(vc(this._camera)){const e=this._camera,t=1/e.zoom,r=e.left*t,i=e.right*t,o=e.top*t,s=e.bottom*t;this._nearPlaneCorners[0].set(r,o,0),this._nearPlaneCorners[1].set(i,o,0),this._nearPlaneCorners[2].set(i,s,0),this._nearPlaneCorners[3].set(r,s,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||c2(this._camera,"_collisionTest"))return e;const r=this._getTargetDirection($g);p2.lookAt(MU,r,this._camera.up);for(let i=0;i<4;i++){const o=nn.copy(this._nearPlaneCorners[i]);o.applyMatrix4(p2);const s=mf.addVectors(this._target,o);ny.set(s,r),ny.far=this._spherical.radius+1;const a=ny.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const r=()=>{this.removeEventListener("rest",r),t()};this.addEventListener("rest",r)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new yt.Sphere){const r=t,i=r.center;gf.makeEmpty(),e.traverseVisible(s=>{s.isMesh&&gf.expandByObject(s)}),gf.getCenter(i);let o=0;return e.traverseVisible(s=>{if(!s.isMesh)return;const a=s,l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const u=l.attributes.position;for(let h=0,f=u.count;h<f;h++)kt.fromBufferAttribute(u,h),o=Math.max(o,i.distanceToSquared(kt))}),r.radius=Math.sqrt(o),r}}async function Ju(n=1e-4){const e=W().getActiveCamera(),t=W().getActiveControls(),r=t.azimuthAngle,i=t.polarAngle;e.position.set(e.position.x+n,e.position.y+n,e.position.z+n),await t.setTarget(e.position.x,e.position.y,e.position.z),t.azimuthAngle=r,t.polarAngle=i,e.position.set(e.position.x-n,e.position.y-n,e.position.z-n)}function Wce(){const n=W().getActiveCamera(),e=new N;W().getActiveControls().getPosition(e);const t=e.x.toFixed(1),r=e.y.toFixed(1),i=e.z.toFixed(1),o=n.position.x.toFixed(1),s=n.position.y.toFixed(1),a=n.position.z.toFixed(1);if(t===o&&r===s&&a===i){const l=new N;W().getActiveControls().getTarget(l);const c=new N;c.subVectors(l,e).normalize();const u=new N;u.copy(e).addScaledVector(c,3),W().getActiveControls().setTarget(u.x,u.y,u.z)}}function $ce(n){const e={MOUSE:JG,Vector2:Ut,Vector3:N,Vector4:gn,Quaternion:Hn,Matrix4:dt,Spherical:CQ,Box3:nt,Sphere:km,Raycaster:lj,MathUtils:{DEG2RAD:ov.DEG2RAD,clamp:ov.clamp}};Fr.install({THREE:e}),n.__controls3d=new Fr(n.__camera3d,n.__renderer.domElement),n.__controls3d.mouseButtons.wheel=Fr.ACTION.DOLLY,n.__controls3d.infinityDolly=!0,n.__controls3d.dollySpeed=Pe.getState().controllerDollySpeed,n.__controls3d.minDistance=Pe.getState().controllerDollyMinDistance,n.__controls3d.dollyToCursor=!0,n.__controls3d.boundaryFriction=0,n.__controls3d.truckSpeed=2,n.__controls3d.smoothTime=0,n.__controls3d.touches.one=Fr.ACTION.TOUCH_ROTATE,n.__controls3d.touches.two=Fr.ACTION.TOUCH_DOLLY_TRUCK,n.__controls3d.touches.three=Fr.ACTION.TOUCH_TRUCK,n.__controls3d.saveState(),document.addEventListener("mousewheel",g=>{var _;((_=g.target)==null?void 0:_.nodeName)==="CANVAS"&&n.__camera3d===n.__activeCamera&&Wce()}),n.__controls3d.setPosition(0,0,0,!0);const t=new hf("KeyW"),r=new hf("KeyA"),i=new hf("KeyS"),o=new hf("KeyD"),s=new hf("KeyE"),a=new hf("KeyQ");let l=!1,c=!1;const u=new Set;window.addEventListener("keydown",g=>{g.shiftKey&&(l=g.shiftKey),g.code==="Space"&&(c=!0),u.add(g.key)}),window.addEventListener("keyup",g=>{l=g.shiftKey,c=!1,u.delete(g.key)}),t.addEventListener(Lt.HOLD_START,()=>{Ju()}),s.addEventListener(Lt.HOLD_START,()=>{u.has("w")||Ju()}),a.addEventListener(Lt.HOLD_START,()=>{u.has("w")||Ju()}),r.addEventListener(Lt.HOLD_START,()=>{Ju()}),i.addEventListener(Lt.HOLD_START,()=>{Ju()}),o.addEventListener(Lt.HOLD_START,()=>{Ju()});const h=.002,f=.006,m=.006;r.addEventListener(Lt.HOLDING,g=>{const _=l?f:h;n.__controls3d.truck(-_*g.deltaTime,0,!1)}),o.addEventListener(Lt.HOLDING,g=>{const _=l?f:h;n.__controls3d.truck(_*g.deltaTime,0,!1)}),s.addEventListener(Lt.HOLDING,g=>{const v=(l?f:h)*g.deltaTime;n.__controls3d.elevate(-v,!1)}),a.addEventListener(Lt.HOLDING,g=>{const v=(l?f:h)*g.deltaTime;n.__controls3d.elevate(+v,!1)}),t.addEventListener(Lt.HOLDING,g=>{const _=l?f:h;c?(n.__controls3d.dollyInFixed(m*g.deltaTime,!1),n.forceRenderNextFrame()):n.__controls3d.forward(_*g.deltaTime,!1)}),i.addEventListener(Lt.HOLDING,g=>{const _=l?f:h;c?(n.__controls3d.dollyInFixed(-m*g.deltaTime,!1),n.forceRenderNextFrame()):n.__controls3d.forward(-_*g.deltaTime,!1)}),n.__controls3d.addEventListener("wake",()=>{n.__cameraMoving=!0,Pe.getState().showAllWhenStill&&ae.refreshCulling()}),n.__controls3d.addEventListener("sleep",()=>{n.__cameraMoving=!1,Pe.getState().showAllWhenStill&&(clearTimeout(n.__resetCullingTimer),n.__resetCullingTimer=setTimeout(()=>{ae.reset_culling_all_meshes()},400))}),n.__controls2d=new Fr(n.__camera2d,n.__renderer.domElement),n.__controls2d.mouseButtons.wheel=Fr.ACTION.ZOOM,n.__controls2d.mouseButtons.left=Fr.ACTION.TRUCK,n.__controls2d.minDistance=1,n.__controls2d.boundaryFriction=5,n.__controls2d.truckSpeed=2,n.__controls2d.smoothTime=1,n.__controls2d.enabled=!1,n.__controls2d.saveState(),n.__controls2d.addEventListener("controlend",()=>{n.__cameraMoving=!1}),n.__controlsActive=n.__controls3d}sn.enabled=!1;function Yce(n,e){typeof e=="string"?(n.__threeCanvas=document.getElementById(e),n.__renderer=new NA({antialias:!V2,canvas:n.__threeCanvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"})):(n.__threeCanvas=e,n.__renderer=new NA({antialias:!V2,canvas:e,logarithmicDepthBuffer:!1,powerPreference:"high-performance"})),n.__renderer.outputColorSpace=Hl,n.__renderer.setSize(window.innerWidth,window.innerHeight),n.__renderer.setPixelRatio(n.__pixelRatio),n.__renderer.localClippingEnabled=!0,n.__css2DRenderer=new aee,n.__css2DRenderer.domElement.style.position="absolute",n.__css2DRenderer.domElement.style.pointerEvents="none",document.body.appendChild(n.__css2DRenderer.domElement),n.__renderer.getContext().canvas.addEventListener("webglcontextlost",function(t){t.preventDefault(),Fn.setState({activated:!0,message:`Ohh no! Looks like we ran out of resources.
 This can happen if you load to big model for you hardware/or just to many open at the same time.
Refresh page and try and not have to many models open at the same time.`,header:"Lost context"})},!1)}function Yp(n=30,e){return Math.atan(Math.tan(n*Math.PI/360)/e)*360/Math.PI}function Kce(){const n=Pe();return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"sticky top-0 mb-1 ml-1 mt-1 flex border-b border-gray-700 bg-gray-800 text-yellow-500",children:["Info Camera",d.jsx("svg",{"data-tooltip":["Set setting for camera","None of these are parts of viewpoint data"].join(`
`),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:.5,stroke:"currentColor",className:"m-auto ml-2 h-3 w-3",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})})]}),d.jsxs("div",{className:"ml-2 flex flex-col p-1",children:[d.jsx("span",{className:"flex",children:"Perspective camera - Field of view:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"ml-2 mr-2 w-12 p-1 text-black",type:"number",step:1,value:n.cameraFov,onChange:e=>{if(e.currentTarget.valueAsNumber>=0&&e.currentTarget.valueAsNumber<=180){const t=e.currentTarget.valueAsNumber;Pe.setState({cameraFov:t});const r=W();r.__camera3d.fov=Yp(t,r.__camera3d.aspect),r.__camera3d.updateProjectionMatrix(),r.forceRenderNextFrame(),Yt()}}}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{if(n.cameraFov>=20){const e=parseFloat((n.cameraFov-1).toFixed(1));Pe.setState({cameraFov:e});const t=W();t.__camera3d.fov=Yp(e,t.__camera3d.aspect),t.__camera3d.updateProjectionMatrix(),t.forceRenderNextFrame(),Yt()}},children:"- 1"}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{if(n.cameraFov<=180){const e=parseFloat((n.cameraFov+1).toFixed(1));Pe.setState({cameraFov:e});const t=W();t.__camera3d.fov=Yp(e,t.__camera3d.aspect),t.__camera3d.updateProjectionMatrix(),t.forceRenderNextFrame(),Yt()}},children:"+ 1"}),d.jsx("button",{className:"ml-2 mr-2 bg-indigo-600 p-1 hover:bg-indigo-700","data-tooltip":["Move camera into center of selected","This also controller into 'head' mode, same way our AWSD keys work","To get out of it, scroll out"].join(`
`),onClick:async()=>{const e=W();if(e.getActiveCamera()===e.__camera3d){const t=await ae.get_bounding_box_from_selection(),r=new nt(new N(t.x,t.y,t.z),new N(t.X,t.Y,t.Z)),i=new N;r.getCenter(i),e.__controls3d.setTarget(i.x,i.y,i.z),e.__controls3d.setPosition(i.x+1e-4,i.y+1e-4,i.z+1e-4),e.forceRenderNextFrame(),Yt()}},children:"Center/sel"})]})]})]})}function Xce(n){const e=Yp(Pe.getState().cameraFov,window.innerWidth/window.innerHeight);n.__camera3d=new Vi(e,window.innerWidth/window.innerHeight,.1,1e4),n.__camera2d=new rI(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,.1,1e4),n.__camera2d.zoom=0,n.__activeCamera=n.__camera3d}const nE=new Set,ke=mr(n=>({loadingData:!1,activateLoadingData:()=>n(()=>({loadingData:!0})),deactivateLoadingData:()=>n(()=>({loadingData:!1})),dialogContent:"",dialogHeader:""}));var r7=Symbol.for("immer-nothing"),kU=Symbol.for("immer-draftable"),Po=Symbol.for("immer-state");function Is(n,...e){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var Cm=Object.getPrototypeOf;function bm(n){return!!n&&!!n[Po]}function sh(n){var e;return n?i7(n)||Array.isArray(n)||!!n[kU]||!!((e=n.constructor)!=null&&e[kU])||T1(n)||C1(n):!1}var qce=Object.prototype.constructor.toString();function i7(n){if(!n||typeof n!="object")return!1;const e=Cm(n);if(e===null)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===qce}function rE(n,e){E1(n)===0?Reflect.ownKeys(n).forEach(t=>{e(t,n[t],n)}):n.forEach((t,r)=>e(r,t,n))}function E1(n){const e=n[Po];return e?e.type_:Array.isArray(n)?1:T1(n)?2:C1(n)?3:0}function oN(n,e){return E1(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function o7(n,e,t){const r=E1(n);r===2?n.set(e,t):r===3?n.add(t):n[e]=t}function Qce(n,e){return n===e?n!==0||1/n===1/e:n!==n&&e!==e}function T1(n){return n instanceof Map}function C1(n){return n instanceof Set}function ed(n){return n.copy_||n.base_}function sN(n,e){if(T1(n))return new Map(n);if(C1(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);const t=i7(n);if(e===!0||e==="class_only"&&!t){const r=Object.getOwnPropertyDescriptors(n);delete r[Po];let i=Reflect.ownKeys(r);for(let o=0;o<i.length;o++){const s=i[o],a=r[s];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(r[s]={configurable:!0,writable:!0,enumerable:a.enumerable,value:n[s]})}return Object.create(Cm(n),r)}else{const r=Cm(n);if(r!==null&&t)return{...n};const i=Object.create(r);return Object.assign(i,n)}}function Dk(n,e=!1){return b1(n)||bm(n)||!sh(n)||(E1(n)>1&&(n.set=n.add=n.clear=n.delete=Zce),Object.freeze(n),e&&Object.entries(n).forEach(([t,r])=>Dk(r,!0))),n}function Zce(){Is(2)}function b1(n){return Object.isFrozen(n)}var Jce={};function ah(n){const e=Jce[n];return e||Is(0,n),e}var Fv;function s7(){return Fv}function eue(n,e){return{drafts_:[],parent_:n,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function LU(n,e){e&&(ah("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=e)}function aN(n){lN(n),n.drafts_.forEach(tue),n.drafts_=null}function lN(n){n===Fv&&(Fv=n.parent_)}function OU(n){return Fv=eue(Fv,n)}function tue(n){const e=n[Po];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function DU(n,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return n!==void 0&&n!==t?(t[Po].modified_&&(aN(e),Is(4)),sh(n)&&(n=iE(e,n),e.parent_||oE(e,n)),e.patches_&&ah("Patches").generateReplacementPatches_(t[Po].base_,n,e.patches_,e.inversePatches_)):n=iE(e,t,[]),aN(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),n!==r7?n:void 0}function iE(n,e,t){if(b1(e))return e;const r=e[Po];if(!r)return rE(e,(i,o)=>UU(n,r,e,i,o,t)),e;if(r.scope_!==n)return e;if(!r.modified_)return oE(n,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const i=r.copy_;let o=i,s=!1;r.type_===3&&(o=new Set(i),i.clear(),s=!0),rE(o,(a,l)=>UU(n,r,i,a,l,t,s)),oE(n,i,!1),t&&n.patches_&&ah("Patches").generatePatches_(r,t,n.patches_,n.inversePatches_)}return r.copy_}function UU(n,e,t,r,i,o,s){if(bm(i)){const a=o&&e&&e.type_!==3&&!oN(e.assigned_,r)?o.concat(r):void 0,l=iE(n,i,a);if(o7(t,r,l),bm(l))n.canAutoFreeze_=!1;else return}else s&&t.add(i);if(sh(i)&&!b1(i)){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1)return;iE(n,i),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&Object.prototype.propertyIsEnumerable.call(t,r)&&oE(n,i)}}function oE(n,e,t=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&Dk(e,t)}function nue(n,e){const t=Array.isArray(n),r={type_:t?1:0,scope_:e?e.scope_:s7(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,o=Uk;t&&(i=[r],o=jv);const{revoke:s,proxy:a}=Proxy.revocable(i,o);return r.draft_=a,r.revoke_=s,a}var Uk={get(n,e){if(e===Po)return n;const t=ed(n);if(!oN(t,e))return rue(n,t,e);const r=t[e];return n.finalized_||!sh(r)?r:r===m2(n.base_,e)?(g2(n),n.copy_[e]=uN(r,n)):r},has(n,e){return e in ed(n)},ownKeys(n){return Reflect.ownKeys(ed(n))},set(n,e,t){const r=a7(ed(n),e);if(r!=null&&r.set)return r.set.call(n.draft_,t),!0;if(!n.modified_){const i=m2(ed(n),e),o=i==null?void 0:i[Po];if(o&&o.base_===t)return n.copy_[e]=t,n.assigned_[e]=!1,!0;if(Qce(t,i)&&(t!==void 0||oN(n.base_,e)))return!0;g2(n),cN(n)}return n.copy_[e]===t&&(t!==void 0||e in n.copy_)||Number.isNaN(t)&&Number.isNaN(n.copy_[e])||(n.copy_[e]=t,n.assigned_[e]=!0),!0},deleteProperty(n,e){return m2(n.base_,e)!==void 0||e in n.base_?(n.assigned_[e]=!1,g2(n),cN(n)):delete n.assigned_[e],n.copy_&&delete n.copy_[e],!0},getOwnPropertyDescriptor(n,e){const t=ed(n),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:n.type_!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty(){Is(11)},getPrototypeOf(n){return Cm(n.base_)},setPrototypeOf(){Is(12)}},jv={};rE(Uk,(n,e)=>{jv[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});jv.deleteProperty=function(n,e){return jv.set.call(this,n,e,void 0)};jv.set=function(n,e,t){return Uk.set.call(this,n[0],e,t,n[0])};function m2(n,e){const t=n[Po];return(t?ed(t):n)[e]}function rue(n,e,t){var i;const r=a7(e,t);return r?"value"in r?r.value:(i=r.get)==null?void 0:i.call(n.draft_):void 0}function a7(n,e){if(!(e in n))return;let t=Cm(n);for(;t;){const r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=Cm(t)}}function cN(n){n.modified_||(n.modified_=!0,n.parent_&&cN(n.parent_))}function g2(n){n.copy_||(n.copy_=sN(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var iue=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if(typeof e=="function"&&typeof t!="function"){const o=t;t=e;const s=this;return function(l=o,...c){return s.produce(l,u=>t.call(this,u,...c))}}typeof t!="function"&&Is(6),r!==void 0&&typeof r!="function"&&Is(7);let i;if(sh(e)){const o=OU(this),s=uN(e,void 0);let a=!0;try{i=t(s),a=!1}finally{a?aN(o):lN(o)}return LU(o,r),DU(i,o)}else if(!e||typeof e!="object"){if(i=t(e),i===void 0&&(i=e),i===r7&&(i=void 0),this.autoFreeze_&&Dk(i,!0),r){const o=[],s=[];ah("Patches").generateReplacementPatches_(e,i,o,s),r(o,s)}return i}else Is(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(s,...a)=>this.produceWithPatches(s,l=>e(l,...a));let r,i;return[this.produce(e,t,(s,a)=>{r=s,i=a}),r,i]},typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof(n==null?void 0:n.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy)}createDraft(n){sh(n)||Is(8),bm(n)&&(n=oue(n));const e=OU(this),t=uN(n,void 0);return t[Po].isManual_=!0,lN(e),t}finishDraft(n,e){const t=n&&n[Po];(!t||!t.isManual_)&&Is(9);const{scope_:r}=t;return LU(r,e),DU(void 0,r)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}applyPatches(n,e){let t;for(t=e.length-1;t>=0;t--){const i=e[t];if(i.path.length===0&&i.op==="replace"){n=i.value;break}}t>-1&&(e=e.slice(t+1));const r=ah("Patches").applyPatches_;return bm(n)?r(n,e):this.produce(n,i=>r(i,e))}};function uN(n,e){const t=T1(n)?ah("MapSet").proxyMap_(n,e):C1(n)?ah("MapSet").proxySet_(n,e):nue(n,e);return(e?e.scope_:s7()).drafts_.push(t),t}function oue(n){return bm(n)||Is(10,n),l7(n)}function l7(n){if(!sh(n)||b1(n))return n;const e=n[Po];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=sN(n,e.scope_.immer_.useStrictShallowCopy_)}else t=sN(n,!0);return rE(t,(r,i)=>{o7(t,r,l7(i))}),e&&(e.finalized_=!1),t}var ko=new iue,Ht=ko.produce;ko.produceWithPatches.bind(ko);ko.setAutoFreeze.bind(ko);ko.setUseStrictShallowCopy.bind(ko);ko.applyPatches.bind(ko);ko.createDraft.bind(ko);ko.finishDraft.bind(ko);const sE=2,Gt=mr(n=>({isOpen:!1,viewModeListMode:!1,editMode:!0,activeTab:"FILTER",currentSet:{version:sE,name:"Default set",projectKey:"",UUID:er(),colorOverride:[],viewPoints:[],filter:[],layerFilter:null,setFilter:null},updateUUID:()=>n(Ht(e=>{e.currentSet.UUID=er()})),clearSet:()=>{n(Ht(e=>{e.currentSet={version:sE,name:"Default set",projectKey:"",UUID:er(),colorOverride:[],viewPoints:[],filter:[],layerFilter:null,setFilter:null}}))},setProjectKey:e=>n(Ht(t=>{t.currentSet.projectKey=e})),addLink:(e,t)=>n(Ht(r=>{r.currentSet.viewPoints[t].links.push(e)})),deleteLink:(e,t)=>n(Ht(r=>{r.currentSet.viewPoints[e].links.splice(t,1)})),updateLinkLabel:(e,t,r)=>n(Ht(i=>{i.currentSet.viewPoints[e].links[t].label=r})),updateLinkUrl:(e,t,r)=>n(Ht(i=>{i.currentSet.viewPoints[e].links[t].url=r})),addColor:e=>n(Ht(t=>{t.currentSet.colorOverride.push(e)})),updateColorItemName:(e,t)=>n(Ht(r=>{r.currentSet.colorOverride[e].name=t})),updateColorColorName:(e,t)=>n(Ht(r=>{r.currentSet.colorOverride[e].color=t})),updateColorOperator:(e,t)=>n(Ht(r=>{r.currentSet.colorOverride[e].operator=t})),deleteColor:e=>n(Ht(t=>{t.currentSet.colorOverride.splice(e,1)})),pushDownColor:e=>n(Ht(t=>{const r=t.currentSet.colorOverride.length-1;if(e<r){const i=t.currentSet.colorOverride.splice(e,1);t.currentSet.colorOverride.splice(e+1,0,i[0])}})),pushUpColor:e=>n(Ht(t=>{if(e>0){const r=t.currentSet.colorOverride.splice(e,1);t.currentSet.colorOverride.splice(e-1,0,r[0])}})),addViewPoint:e=>n(Ht(t=>{t.currentSet.viewPoints.push(e)})),updateViewpointName:(e,t)=>n(Ht(r=>{r.currentSet.viewPoints[e].name=t})),updateViewpointComment:(e,t)=>n(Ht(r=>{r.currentSet.viewPoints[e].comment=t})),updateViewpointSelect:(e,t)=>n(Ht(r=>{r.currentSet.viewPoints[e].selectedFullName=t})),deleteViewpoint:e=>n(Ht(t=>{t.currentSet.viewPoints.splice(e,1)})),updateViewpoint:(e,t)=>n(Ht(r=>{r.currentSet.viewPoints[e].controllerPosition=t.controllerPosition,r.currentSet.viewPoints[e].controllerTarget=t.controllerTarget,r.currentSet.viewPoints[e].z_plane_visible=t.z_plane_visible,r.currentSet.viewPoints[e].y_plane_visible=t.y_plane_visible,r.currentSet.viewPoints[e].x_plane_visible=t.x_plane_visible,r.currentSet.viewPoints[e].z_plane_enable=t.z_plane_enable,r.currentSet.viewPoints[e].y_plane_enable=t.y_plane_enable,r.currentSet.viewPoints[e].x_plane_enable=t.x_plane_enable,r.currentSet.viewPoints[e].z_plane_neg=t.z_plane_neg,r.currentSet.viewPoints[e].y_plane_neg=t.y_plane_neg,r.currentSet.viewPoints[e].x_plane_neg=t.x_plane_neg,r.currentSet.viewPoints[e].z_plane_offset=t.z_plane_offset,r.currentSet.viewPoints[e].x_plane_offset=t.x_plane_offset,r.currentSet.viewPoints[e].y_plane_offset=t.y_plane_offset,r.currentSet.viewPoints[e].boxClippingEnabled=t.boxClippingEnabled,r.currentSet.viewPoints[e].boxClippingMaxX=t.boxClippingMaxX,r.currentSet.viewPoints[e].boxClippingMaxY=t.boxClippingMaxY,r.currentSet.viewPoints[e].boxClippingMaxZ=t.boxClippingMaxZ,r.currentSet.viewPoints[e].boxClippingMinX=t.boxClippingMinX,r.currentSet.viewPoints[e].boxClippingMinY=t.boxClippingMinY,r.currentSet.viewPoints[e].boxClippingMinZ=t.boxClippingMinZ})),pushDownViewpoint:e=>n(Ht(t=>{const r=t.currentSet.viewPoints.length-1;if(e<r){const i=t.currentSet.viewPoints.splice(e,1);t.currentSet.viewPoints.splice(e+1,0,i[0])}})),pushUpViewpoint:e=>n(Ht(t=>{if(e>0){const r=t.currentSet.viewPoints.splice(e,1);t.currentSet.viewPoints.splice(e-1,0,r[0])}})),addFilter:e=>n(Ht(t=>{e?t.currentSet.filter.push([e]):t.currentSet.filter.push([{filtertype:"Append",max:{x:1,y:1,z:1},min:{x:1,y:1,z:1},type:"Standard",expression:[{input:"",operator:"Contains"}],uuid:er()}])})),removeAllFilters:()=>n(Ht(e=>{e.currentSet.filter=[]})),removeFilter:e=>n(Ht(t=>{t.currentSet.filter.splice(e,1)})),addSubFilter:(e,t)=>n(Ht(r=>{r.currentSet.filter[e].push(t)})),updateBoundingFilter:(e,t,r)=>n(Ht(i=>{i.currentSet.filter[e][t].max.x=r.max.x,i.currentSet.filter[e][t].max.y=r.max.y,i.currentSet.filter[e][t].max.z=r.max.z,i.currentSet.filter[e][t].min.x=r.min.x,i.currentSet.filter[e][t].min.y=r.min.y,i.currentSet.filter[e][t].min.z=r.min.z})),filterPushUp:(e,t)=>n(Ht(r=>{if(t>0){const i=r.currentSet.filter[e].splice(t,1);r.currentSet.filter[e].splice(t-1,0,i[0])}})),filterPushDown:(e,t)=>n(Ht(r=>{const i=r.currentSet.filter[t].length-1;if(t<i){const o=r.currentSet.filter[e].splice(t,1);r.currentSet.filter[e].splice(t+1,0,o[0])}})),addExpression:(e,t,r)=>n(Ht(i=>{i.currentSet.filter[e][t].expression.push(r)})),setFilterType:(e,t,r)=>n(Ht(i=>{i.currentSet.filter[e][t].filtertype=r})),setExpressionValue:(e,t,r,i)=>n(Ht(o=>{o.currentSet.filter[e][t].expression[r].input=i})),setExpressionOperator:(e,t,r,i)=>n(Ht(o=>{o.currentSet.filter[e][t].expression[r].operator=i})),removeExpression:(e,t,r)=>n(Ht(i=>{i.currentSet.filter[e][t].expression.splice(r,1),i.currentSet.filter[e][t].expression.length===0&&i.currentSet.filter[e].splice(t,1),i.currentSet.filter[e][0]||i.currentSet.filter.splice(e,1)})),removeBoundingFilter:(e,t)=>n(Ht(r=>{r.currentSet.filter[e].splice(t,1),r.currentSet.filter[e][0]||r.currentSet.filter.splice(e,1)})),setAsBoundingboxFilter:(e,t)=>n(Ht(r=>{r.currentSet.filter[e][t].type="Boundingbox"})),setAsStandardFilter:(e,t)=>n(Ht(r=>{r.currentSet.filter[e][t].type="Standard"}))}));let c7="no file opened";function sue(){return c7}async function aue(n,e,t){if(typeof showOpenFilePicker!="function"){Fn.setState({header:"error",message:"Your browser does not support filesystem Access Api, use newest Chrome/Edge"});return}const r={types:[{description:n,accept:{[e]:[t]}}],excludeAcceptAllOption:!0,multiple:!1},i=await showOpenFilePicker(r);if((i==null?void 0:i.length)>0){const o=await i[0].getFile();return c7=o==null?void 0:o.name,await o.arrayBuffer()}}const aE=new Set;function lue(n,e){return new Promise(async t=>{Array.from(aE).forEach(i=>{i.handleEvent&&(i.handleEvent(n,e)||aE.delete(i))}),t(null)})}async function u7(){Xe.getState().enabled||Xt.toggleClipping();const e=await Xt.resizeToSelected(new N(2,2,2)),t=new N;e.getCenter(t),W().setOrbitOn(t)}async function cue(){Xe.getState().enabled||Xt.toggleClipping();const e=await Xt.resizeToSelected(new N(2,2,2),new N(0,0,-1)),t=new N;e.getCenter(t),W().setOrbitOn(t)}async function uue(){Xe.getState().enabled||Xt.toggleClipping();const e=await Xt.resizeToSelected(new N(2,2,2),new N(0,0,1)),t=new N;e.getCenter(t),W().setOrbitOn(t)}async function d7(){Xe.getState().enabled||Xt.toggleClipping();const e=await Xt.resizeToSelected(new N(3,3,3)),t=new N;e.getCenter(t),W().setOrbitOn(t)}async function due(){Xe.getState().enabled||Xt.toggleClipping();const e=await Xt.resizeToSelected(new N(3,3,3),new N(0,0,-2)),t=new N;e.getCenter(t),W().setOrbitOn(t)}async function hue(){Xe.getState().enabled||Xt.toggleClipping();const e=await Xt.resizeToSelected(new N(3,3,3),new N(0,0,2)),t=new N;e.getCenter(t),W().setOrbitOn(t)}const A1=er(),fue=A1+"=CHILDREN";if(window.web3dEvent!==!0){window.web3dEvent=!0;const n=new BroadcastChannel(A1);n.onmessage=async function(e){Ss(e)},window.addEventListener("beforeunload",async function(){h7({type:"window-closed",data:null})})}function h7(n){const e=new BroadcastChannel(fue);e.postMessage(n),e.close()}async function Ss(n){var r,i,o,s,a,l,c,u,h,f,m;function e(g){if(typeof g=="string")try{return JSON.parse(g)}catch{return{}}else return(n==null?void 0:n.data)||{}}const t=e(n.data);if((t==null?void 0:t.type)==="web3d-goto-selected"&&Array.isArray(t==null?void 0:t.rows)){if((t==null?void 0:t.rows.length)<1){Fn.setState({activated:!0,message:"You need to select one row"});return}ke.setState({loadingData:!0,dialogContent:"please wait, collecting model data",dialogHeader:"Generating Model"}),await ae.selection_clear(!1);const g=t.rows[0],_=await ae.get_ids_from_fullnames([g]);if(_.length){const v=_[0];await ae.treeview_expand_from_id(v);const p=await ae.getKeyChildrenFromItem(v),x=await ae.getBoundingBoxFromName(g,!0);if(x){const w=new nt(new N(x.x,x.y,x.z),new N(x.X,x.Y,x.Z)),C=new N;w.getCenter(C);const T=new N,S=W().getActiveControls();S.getPosition(T);const b=T.distanceTo(C);S.saveState(),S.setTarget(C.x,C.y,C.z);const R=b-5;S.dolly(R,!0).then(()=>{S.smoothTime=.2,S.saveState()})}const y=[];(t.data==="box2x-transparent"||t.data==="box3x-transparent")&&y.push({uuid:"na",name:"",color:"gray:05",operator:"Contains"}),(t.data==="box2x-white"||t.data==="box3x-white")&&y.push({uuid:"na",name:"",color:"white",operator:"Contains"}),(r=t.data)!=null&&r.includes("normal-reset")&&(Xt.disable(),y.push({uuid:"na",name:"!RESET!",color:"white",operator:"Equal"})),y.length&&await ae.filter_geometry([],y),await ae.selection_add([v].concat(p)),await ae.selection_append(),(i=t.data)!=null&&i.startsWith("box")&&(t.data.includes("box2x")?u7():d7()),Pt.getState().updateToggel()}else Fn.setState({activated:!0,message:`Unable to find tag: ${g}`});ke.setState({loadingData:!1,dialogContent:"please wait, collecting model data",dialogHeader:"Generating Model"})}if((o=t==null?void 0:t.type)!=null&&o.includes("web3d-add-to-set")&&Array.isArray(t==null?void 0:t.rows)){await ae.selection_clear(!1);const g=[],_=[],v=((s=t==null?void 0:t.colors)==null?void 0:s.map(x=>x||"yellow:100"))||[];for(let x=0;x<t.rows.length;x++){const y=t.rows[x];if(y){g.push(y);const w=v[x];w&&_.push(`${y}	${w}`)}}const p=Gt.getState();Gt.setState({activeTab:"FILTER",isOpen:!0}),p.addFilter({filtertype:"Append",max:{x:1,y:1,z:1},min:{x:1,y:1,z:1},type:"Standard",expression:[{input:g.join(`
`),operator:"In"}],uuid:er()}),_.length&&p.addColor({uuid:er(),name:_.join(`
`),color:"",operator:"In"}),p.updateUUID(),Pt.getState().updateToggel()}if((a=t==null?void 0:t.type)!=null&&a.includes("web3d-add-selection")&&Array.isArray(t==null?void 0:t.rows)){const g=await ae.get_ids_from_fullnames(t==null?void 0:t.rows);await ae.selection_add(g),await ae.selection_append(),Pt.getState().updateToggel()}if((l=t==null?void 0:t.type)!=null&&l.includes("web3d-replace-selection")&&Array.isArray(t==null?void 0:t.rows)){await ae.selection_clear(!1);const g=await ae.get_ids_from_fullnames(t==null?void 0:t.rows);await ae.selection_add(g),await ae.selection_append(),Pt.getState().updateToggel()}if((c=t==null?void 0:t.type)!=null&&c.includes("web3d-set-color")&&Array.isArray(t==null?void 0:t.rows)){ke.setState({loadingData:!0,dialogHeader:"please wait",dialogContent:"searching for elements add color"}),await ae.selection_clear(!1);const g=Array.isArray(t==null?void 0:t.colors)?t==null?void 0:t.colors:[],_=t==null?void 0:t.rows.map((x,y)=>({uuid:"na",name:x,color:g[y]||"yellow",operator:"Equal"}));let v=[];t.data==="transparent"&&v.push({uuid:"na",name:"",color:"gray:05",operator:"Contains"}),t.data==="white"&&v.push({uuid:"na",name:"",color:"white",operator:"Contains"}),t.data==="hide"&&v.push({uuid:"na",name:"",color:"green:0",operator:"Contains"}),Array.isArray(t.extra)&&(v=v.concat(t.extra));const p=v.concat(_);await ae.filter_geometry([],p),await ae.selection_append(),Pt.getState().updateToggel(),ke.setState({loadingData:!1})}if((u=t==null?void 0:t.type)!=null&&u.includes("web3d-iframe-info")&&lue(t.name||"unknown",t.data),(h=t==null?void 0:t.type)!=null&&h.includes("web3d-treeview-toggle")&&rr.setState({treeViewActive:!rr.getState().treeViewActive}),(f=t==null?void 0:t.type)!=null&&f.includes("web3d-open-url")&&typeof(t==null?void 0:t.data)=="string"&&t!=null&&t.data.includes("http")&&window.open(t==null?void 0:t.data),(m=t==null?void 0:t.type)!=null&&m.includes("web3d-request-open-file")){const g=t==null?void 0:t.data;if(g&&t.responseChannel){const _=await aue(g.description||"Missing",g.mime||"missing",g.extension||".unknown"),v=new BroadcastChannel(t.responseChannel);v.postMessage({type:"web3d-response-open-file",data:_}),v.close()}}if((t==null?void 0:t.type)==="web3d-request-selected-fullname-without-parents"){const g=await ae.get_fullnames_from_selection();if(t.responseChannel){const _=new BroadcastChannel(t.responseChannel);_.postMessage({type:"web3d-response-selected-fullname-without-parents",data:g}),_.close()}}if((t==null?void 0:t.type)==="web3d-request-selected-fullname-include-parents"){const g=await ae.get_fullnames_from_selection(!0);if(t.responseChannel){const _=new BroadcastChannel(t.responseChannel);_.postMessage({type:"web3d-response-selected-fullname-include-parents",data:g}),_.close()}}if((t==null?void 0:t.type)==="ping"&&t.responseChannel){const g=new BroadcastChannel(t.responseChannel);g.postMessage({type:"pong",data:null}),g.close()}}function Km(n,e){return new Promise(async t=>{const r=Array.from(nE),i=await ae.getDataExt(n);i.append=e,r.forEach(o=>{o.handleEvent&&(o.handleEvent(i)||nE.delete(o))}),h7({type:"web3d-user-select",data:i}),t(null)})}async function dN(n,e){const t=W(),r=new Ut,i=t.__renderer.domElement.clientWidth,o=t.__renderer.domElement.clientHeight,s=n.clientX-t.__offsetLeft,a=n.clientY-t.__offsetTop;r.x=s/i*2-1,r.y=-(a/o)*2+1;{t.__sceneController.getMeshes().map(x=>x.$setPicking?x.$setPicking(!0,n.shiftKey):null),t.__activeCamera.setViewOffset(t.__renderer.domElement.width,t.__renderer.domElement.height,s*t.__pixelRatio|0,a*t.__pixelRatio|0,1,1);const l=new is(1,1),c=new Uint8Array(4);t.__renderer.setRenderTarget(l),t.__renderer.render(t.__sceneController.currentScene(),t.__activeCamera),t.__renderer.readRenderTargetPixels(l,0,0,1,1,c),t.__renderer.setRenderTarget(null);const u=c[0]<<16|c[1]<<8|c[2],h=t.__sceneController.getMeshes().filter(x=>x.$getMeshById?x.$getMeshById(u):!1)[0];if(t.__activeCamera.clearViewOffset(),t.__sceneController.getMeshes().map(x=>x.$setPicking?x.$setPicking(!1):null),!h)return null;const f=t.__activeCamera.toJSON(),m=await t.__rayWorker.raycast(r,f,h.__modelDBStore,h.__modelDBKeyIndex,h.__modelDBKeyPosition,h.$getGroupsRaycast()),g=h.$groupColors,_=h.$getGroups().filter(x=>{const y=g.get(x.material_index)||[1,1,1,1];return y[3]===0?!1:y[3]<.1001?!!n.shiftKey:!(y[3]<1&&n.shiftKey)}).map(x=>[x.start,x.start+x.count-1]),v=m.filter(x=>{for(let y=0;y<_.length;y++){const w=_[y][0],C=_[y][1],T=x.faceIndex*3;if(T>=w&&T<=C)return!0}return!1}).map(x=>(x.object=h,x.point=new N(x.point.x,x.point.y,x.point.z),x));return t.__clippingPlaneHelper.filterClippingPlanes(v)[0]}}const FU=new Set;function pue(n,e,t){return new Promise(async r=>{Array.from(FU).forEach(o=>{o&&(o("PointChange",n,e,t)||FU.delete(o))}),r(null)})}function mue(n){n.__activeCamera.updateProjectionMatrix(),n.__threeCanvas.onpointerdown=async e=>{if(e.button!=0)return;const t=e.ctrlKey;if(e.altKey){const i=await dN(e);if(i&&(n.__lastClick=new N(i.point.x,i.point.y,i.point.z),pue(e.altKey,e.shiftKey,n.__lastClick),e.altKey)){setTimeout(()=>{n.setOrbitOn()},20);return}}let r=!1;n.__transformOverrideClickEventCall&&(r=await n.__transformOverrideClickEventCall(e)),!r&&(setTimeout(()=>{n.__threeCanvas.onpointerup=null},300),n.__threeCanvas.onpointerup=async()=>{const i=await dN(e);if(i&&it.isMeasureMode()){it.clickCallback(i,e);return}if(i&&i.object.__modelDBKeyIndex){n.__lastClick=new N(i.point.x,i.point.y,i.point.z);const o=await ae.meta_find_key_from_face_index(i.object.__modelDBKeyIndex,i.faceIndex);if(o){t||await ae.selection_clear(!1),await ae.selection_is_selected(o)?await ae.selection_remove([o]):await ae.selection_add([o]),Km(o,t),await ae.selection_append(),await ae.treeview_expand_from_id(o);const s=ae.getRowOfKey(o);Pt.getState().updateToggel(s)}n.__forceRender=!0}})}}const f7=mr(()=>({calls:0,frame:0,lines:0,points:0,triangles:0}));function aw(n){if(n.__renderDisabled){requestAnimationFrame(()=>aw(n));return}const e=Rue.getDelta(),t=n.__controlsActive.update(e);let r=!0;if(n.__animationCallback&&(r=n.__animationCallback(e,n)),!r){requestAnimationFrame(()=>aw(n));return}if((t||n.__forceRender)&&it.isActive()&&n.__css2DRenderer.render(n.__sceneController.currentScene(),n.__activeCamera),t||n.__forceRender){clearTimeout(n.renderEffectTimer),n.__monitors&&n.__monitors.begin(),n.__forceRender=!1,it.render(),t&&Pe.getState().enableItemCulling&&n.__cameraMoving&&YE();const i=n.getActiveCamera().position.clone();n.__sceneController.__pointLight&&(n.__sceneController.__pointLight.position.x=i.x,n.__sceneController.__pointLight.position.y=i.y,n.__sceneController.__pointLight.position.z=i.z),Xt.beforeRender(),n.__renderer.render(n.__sceneController.currentScene(),n.__activeCamera),Xt.afterRender(),n.__monitors&&(f7.setState(n.__renderer.info.render),n.__monitors.end()),Pe.getState().enableAntiAliasing&&Pe.getState().enableAlphaHash&&(n.renderEffectTimer=setTimeout(()=>{n.renderEffect()},250))}n.__getGizmo().update(),requestAnimationFrame(()=>aw(n))}const p7={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Xm{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const gue=new rI(-1,1,1,-1,0,1);class vue extends Sn{constructor(){super(),this.setAttribute("position",new tn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new tn([0,2,0,0,2,0],2))}}const _ue=new vue;class Fk{constructor(e){this._mesh=new Ve(_ue,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,gue)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class xue extends Xm{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof No?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=NE.clone(e.uniforms),this.material=new No({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Fk(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class jU extends Xm{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const i=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0);let s,a;this.inverse?(s=0,a=1):(s=1,a=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),o.buffers.stencil.setFunc(i.ALWAYS,s,4294967295),o.buffers.stencil.setClear(a),o.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.color.setMask(!0),o.buffers.depth.setMask(!0),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(i.EQUAL,1,4294967295),o.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),o.buffers.stencil.setLocked(!0)}}class yue extends Xm{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class wue{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new Ut);this._width=r.width,this._height=r.height,t=new is(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Ml}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new xue(p7),this.copyPass.material.blending=pl,this.clock=new aj}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let i=0,o=this.passes.length;i<o;i++){const s=this.passes[i];if(s.enabled!==!1){if(s.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),s.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),s.needsSwap){if(r){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}jU!==void 0&&(s instanceof jU?r=!0:s instanceof yue&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Ut);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Sue extends Xm{constructor(e,t,r=null,i=null,o=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=o,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new rt}render(e,t,r){const i=e.autoClear;e.autoClear=!1;let o,s;this.overrideMaterial!==null&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(o=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(o),this.overrideMaterial!==null&&(this.scene.overrideMaterial=s),e.autoClear=i}}class Eue extends Xm{constructor(e,t,r,i){super(),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.stencilBuffer=!1,this.clearColor=r!==void 0?r:0,this.clearAlpha=i!==void 0?i:0,this._oldClearColor=new rt;const o=p7;this.copyUniforms=NE.clone(o.uniforms),this.copyMaterial=new No({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,premultipliedAlpha:!0,blending:W2}),this.fsQuad=new Fk(this.copyMaterial)}dispose(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null),this.copyMaterial.dispose(),this.fsQuad.dispose()}setSize(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)}render(e,t,r){this.sampleRenderTarget||(this.sampleRenderTarget=new is(r.width,r.height,{type:Ml,stencilBuffer:this.stencilBuffer}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");const i=Tue[Math.max(0,Math.min(this.sampleLevel,5))],o=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);const s=e.getClearAlpha(),a=1/i.length,l=1/32;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;const c={fullWidth:r.width,fullHeight:r.height,offsetX:0,offsetY:0,width:r.width,height:r.height},u=Object.assign({},this.camera.view);u.enabled&&Object.assign(c,u);for(let h=0;h<i.length;h++){const f=i[h];this.camera.setViewOffset&&this.camera.setViewOffset(c.fullWidth,c.fullHeight,c.offsetX+f[0]*.0625,c.offsetY+f[1]*.0625,c.width,c.height);let m=a;if(this.unbiased){const g=-.5+(h+.5)/i.length;m+=l*g}this.copyUniforms.opacity.value=m,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),h===0&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.setViewOffset&&u.enabled?this.camera.setViewOffset(u.fullWidth,u.fullHeight,u.offsetX,u.offsetY,u.width,u.height):this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=o,e.setClearColor(this._oldClearColor,s)}}const Tue=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];class Cue extends Eue{constructor(e,t,r,i){super(e,t,r,i),this.sampleLevel=0,this.accumulate=!1,this.accumulateIndex=-1}render(e,t,r,i){if(this.accumulate===!1){super.render(e,t,r,i),this.accumulateIndex=-1;return}const o=bue[5];this.sampleRenderTarget===void 0&&(this.sampleRenderTarget=new is(r.width,r.height,{type:Ml}),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget===void 0&&(this.holdRenderTarget=new is(r.width,r.height,{type:Ml}),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulateIndex===-1&&(super.render(e,this.holdRenderTarget,r,i),this.accumulateIndex=0);const s=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);const a=e.getClearAlpha(),l=1/o.length;if(this.accumulateIndex>=0&&this.accumulateIndex<o.length){this.copyUniforms.opacity.value=l,this.copyUniforms.tDiffuse.value=t.texture;const u=Math.pow(2,this.sampleLevel);for(let h=0;h<u;h++){const f=this.accumulateIndex,m=o[f];if(this.camera.setViewOffset&&this.camera.setViewOffset(r.width,r.height,m[0]*.0625,m[1]*.0625,r.width,r.height),e.setRenderTarget(t),e.setClearColor(this.clearColor,this.clearAlpha),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.sampleRenderTarget),this.accumulateIndex===0&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e),this.accumulateIndex++,this.accumulateIndex>=o.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}e.setClearColor(this.clearColor,this.clearAlpha);const c=this.accumulateIndex*l;c>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,e.setRenderTarget(t),e.clear(),this.fsQuad.render(e)),c<1&&(this.copyUniforms.opacity.value=1-c,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,e.setRenderTarget(t),this.fsQuad.render(e)),e.autoClear=s,e.setClearColor(this._oldClearColor,a)}dispose(){super.dispose(),this.holdRenderTarget&&this.holdRenderTarget.dispose()}}const bue=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]],Aue={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	
		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class Mue extends Xm{constructor(){super();const e=Aue;this.uniforms=NE.clone(e.uniforms),this.material=new dQ({name:e.name,uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fsQuad=new Fk(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,(this._outputColorSpace!==e.outputColorSpace||this._toneMapping!==e.toneMapping)&&(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},sn.getTransfer(this._outputColorSpace)===Mn&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===TF?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===CF?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===bF?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===AF?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===MF?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===RF&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const Rue=new aj;class Nue{constructor(e){Se(this,"__renderer");Se(this,"__activeCamera");Se(this,"__camera3d");Se(this,"__controlsActive");Se(this,"__monitors");Se(this,"__threeCanvas");Se(this,"__spaceNavigatorEnabled");Se(this,"__sceneController");Se(this,"__orientationGizmo");Se(this,"__forceRender",!1);Se(this,"__clippingPlaneHelper");Se(this,"__offsetLeft",0);Se(this,"__offsetTop",0);Se(this,"__camera2d");Se(this,"__controls2d");Se(this,"__controls3d");Se(this,"__lastClick",new N);Se(this,"__css2DRenderer");Se(this,"__cameraMoving",!1);Se(this,"__movementHelperTimer");Se(this,"__rayWorker");Se(this,"__pixelRatio");Se(this,"__renderDisabled",!1);Se(this,"__resetCullingTimer");Se(this,"__animationCallback");Se(this,"__lastmove");Se(this,"renderEffect");Se(this,"renderEffectTimer",null);vee().then(([t])=>{this.__rayWorker=t}),this.__pixelRatio=window.devicePixelRatio>1?1:window.devicePixelRatio,Yce(this,e),this.__sceneController=new fee(this),Xce(this),$ce(this),TU(this),mue(this),this.__clippingPlaneHelper=new mee(this),aw(this),this.setCameraMode("3D"),Pe.getState().isWebGlStatsActive&&this.__addStats(),this.renderEffect=()=>{const t=this.__renderer,r=this.__sceneController.currentScene(),i=this.__activeCamera,o=new wue(t),s=new Sue(r,i);s.enabled=!1;const a=new Cue(r,i),l=new Mue;o.addPass(s),o.addPass(a),o.addPass(l),a.enabled=!0,a.sampleLevel=Pe.getState().enableAntiAliasingSamples,o.render(),o.dispose(),s.dispose(),a.dispose(),l.dispose()}}async __transformOverrideClickEventCall(e){if(Vn.getState().transformOnNextClickEnabled&&Vn.getState().enabled){const t=await dN(e);if(t!=null&&t.point){const r=new N(t.point.x,t.point.y,t.point.z);Rr.line.position.x=r.x,Rr.line.position.y=r.y;const i=Vn.getState().maxZ-Vn.getState().minZ;return console.log(Vn.getState(),r.z,Rr.line.position.z,i),Rr.line.position.z=r.z+i/2,Rr.triggerOnChangeEvent(),Rr.updateTransforms(),Vn.setState({transformOnNextClickEnabled:!1}),!0}}return!1}disableRender(){this.__renderDisabled=!0}enableRender(){this.__renderDisabled=!1,this.forceRenderNextFrame()}getClipping(){if(this.__clippingPlaneHelper)return this.__clippingPlaneHelper}getCanvas(){return this.__threeCanvas}getActiveCamera(){return this.__activeCamera}setGizmoAxis(e){this.__orientationGizmo.onAxisSelected({axis:e,noSmartLogic:!0})}getActiveControls(){return this.__controlsActive}__getGizmo(){return this.__orientationGizmo}getRender(){return this.__renderer}async fitModelToCanvas(e=!1){const t=new N;if(this.getActiveControls().getTarget(t),e||t.x===0&&t.y===0&&t.y===0||isNaN(t.x)){const r=this.getSceneController().sceneBoundingBox;if(!r.max)return;const i=new nt(r.min,r.max);if(!i.max)return;const o=this.getActiveControls().setPosition(0,0,500,!1),s=this.getActiveControls().fitToBox(i,!1,{paddingBottom:25,paddingLeft:25,paddingTop:25,paddingRight:25});await Promise.all([o,s]).then(()=>{this.getActiveControls().smoothTime=1,this.getActiveControls().saveState(),this.__forceRender=!0})}else this.__forceRender=!0}cameraToggle(){this.getCameraMode()==="3D"?this.setCameraMode("2D"):this.setCameraMode("3D")}getCameraMode(){return this.__activeCamera===this.__camera2d?"2D":"3D"}setCameraMode(e){e==="3D"?(this.__activeCamera=this.__camera3d,this.__controlsActive=this.__controls3d,this.__controls2d.enabled=!1,this.__controls3d.enabled=!0,this.__controls2d.saveState(),this.__controls3d.saveState(),dm.setState({mode:"3D"})):(this.__activeCamera=this.__camera2d,this.__controlsActive=this.__controls2d,this.__controls3d.enabled=!1,this.__controls2d.enabled=!0,this.__controls2d.saveState(),this.__controls3d.saveState(),dm.setState({mode:"2D"})),TU(this)}forceRenderNextFrame(){this.__forceRender=!0}addAnimationCallback(e){this.__animationCallback=e}async setOrbitOn(e){(this.__lastClick||e)&&(this.getActiveControls().smoothTime=.2,this.getActiveControls().saveState(),e?await this.__controlsActive.setTarget(e.x,e.y,e.z,!0):await this.__controlsActive.setTarget(this.__lastClick.x,this.__lastClick.y,this.__lastClick.z,!0),this.getActiveControls().smoothTime=1,this.getActiveControls().saveState())}setSize(e,t,r,i){const o=Pe.getState().cameraFov;this.__camera3d.aspect=e/t,this.__camera3d.fov=Yp(o,e/t),this.__camera3d.updateProjectionMatrix(),this.__camera2d.left=window.innerWidth/-2,this.__camera2d.right=window.innerWidth/2,this.__camera2d.top=window.innerHeight/2,this.__camera2d.bottom=window.innerHeight/-2,this.__camera2d.updateProjectionMatrix(),this.__renderer.setSize(e,t),this.__renderer.domElement.style.left=r+"px",this.__renderer.domElement.style.top=i+"px",this.__css2DRenderer.setSize(e,t),this.__css2DRenderer.domElement.style.top=i+"px",this.__css2DRenderer.domElement.style.left=r+"px",this.__offsetLeft=r,this.__offsetTop=i,this.__forceRender=!0}__addStats(){this.__monitors||(this.__monitors=new b0,this.__monitors.showPanel(0),this.__monitors.dom.style.left=null,this.__monitors.dom.style.right="0px",this.__monitors.dom.style.top="125px",document.body.appendChild(this.__monitors.dom))}addStats(){this.__addStats()}removeStats(){this.__monitors&&(document.body.removeChild(this.__monitors.dom),this.__monitors=null)}getSceneController(){return this.__sceneController}enableSpaceNavigator(){this.__spaceNavigatorEnabled=!0}disableSpaceNavigator(){this.__spaceNavigatorEnabled=!1}toggleSpaceNavigator(){this.__spaceNavigatorEnabled=!this.__spaceNavigatorEnabled}}let lE;function Iue(n){lE||(lE=new Nue(n))}function W(){return lE}async function zi(n){Pe.getState().enableItemCulling||Pe.getState().enableGlbCulling?await YE():await ae.reset_culling_all_meshes(),n&&W().forceRenderNextFrame()}function Am(n,e,t,r=0,i=!1,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){n&&n.r===0&&n.g===0&&n.b===0&&e===1&&(n=new rt("gray"));let s=!0;e!==1&&(s=!1),Pe.getState().enableAlphaHash&&(s=!0);const a={transparent:e===1?!1:!Pe.getState().enableAlphaHash,depthWrite:s,wireframe:!1,alphaHash:e===1?!1:Pe.getState().enableAlphaHash,side:SG?bl:vi,color:n||void 0,vertexColors:t,opacity:e,polygonOffset:r!==0,polygonOffsetFactor:-r,polygonOffsetUnits:-r,flatShading:!0};delete a.vertexColors;let l;i?(delete a.flatShading,l=new vu(a)):l=new oj(a);const c=W().getClipping();return c&&(l.clippingPlanes=c.getClippingPlanes()),l.onBeforeCompile=u=>{const h=Xe.getState();u.batching=!1,u.uniforms.boxmin=new Ja(new N(h.minX,h.minY,h.minZ)),u.uniforms.boxmax=new Ja(new N(h.maxX,h.maxY,h.maxZ)),u.uniforms.boxEnabled=new Ja(h.enabled),u.uniforms.boxInverted=new Ja(h.inverted),u.uniforms.transformOverride=new Ja(new dt().fromArray(o)),u.uniforms.transform=new Ja(new dt),u.vertexShader=u.vertexShader.replace("#include <project_vertex>",`
            vec4 mvPosition = vec4( transformed, 1.0 );

            #ifdef USE_INSTANCING
            
                mvPosition = instanceMatrix * mvPosition;
            
            #endif
            
           mvPosition = transformOverride * mvPosition;

            mvPosition = transform * mvPosition;

            vPosition = mvPosition.xyz;

            mvPosition = modelViewMatrix * mvPosition;
            
            gl_Position = projectionMatrix * mvPosition;

            

            `),u.vertexShader=u.vertexShader.replace("void main() {",`
           
            uniform mat4 transform;
            uniform mat4 transformOverride;
            void main() {
            `),a.alphaHash?u.fragmentShader=u.fragmentShader.replace("void main() {",`
                uniform vec3 boxmin;
                uniform vec3 boxmax;
                uniform bool boxEnabled;
                uniform bool boxInverted;
             
                bool boxCheck = false;
                void main() {
                    if(boxEnabled){
                        if(vPosition.x<boxmin.x) {
                            boxCheck=true;
                        }
                        if(vPosition.x>boxmax.x) {
                            boxCheck=true;
                        }
                        if(vPosition.z<boxmin.z) {
                            boxCheck=true;
                        }
                        if(vPosition.z>boxmax.z) {
                            boxCheck=true;
                        }
                        if(vPosition.y<boxmin.y) {
                            boxCheck=true;
                        }
                        if(vPosition.y>boxmax.y) {
                            boxCheck=true;
                        }
    
                        if(boxInverted){
                            if(!boxCheck){
                                discard;
                            }
                        } else {
                            if(boxCheck){
                                discard;
                            }
                        }
                  
                    }
                    
            `):(u.vertexShader=u.vertexShader.replace("void main() {",`
                varying vec3 vPosition;
                void main() {
                    
                `),u.fragmentShader=u.fragmentShader.replace("void main() {",`
                uniform vec3 boxmin;
                uniform vec3 boxmax;
                uniform bool boxEnabled;
                uniform bool boxInverted;
                varying vec3 vPosition;
                bool boxCheck = false;
                void main() {
                    if(boxEnabled){
                        if(vPosition.x<boxmin.x) {
                            boxCheck=true;
                        }
                        if(vPosition.x>boxmax.x) {
                            boxCheck=true;
                        }
                        if(vPosition.z<boxmin.z) {
                            boxCheck=true;
                        }
                        if(vPosition.z>boxmax.z) {
                            boxCheck=true;
                        }
                        if(vPosition.y<boxmin.y) {
                            boxCheck=true;
                        }
                        if(vPosition.y>boxmax.y) {
                            boxCheck=true;
                        }
    
                        if(boxInverted){
                            if(!boxCheck){
                                discard;
                            }
                        } else {
                            if(boxCheck){
                                discard;
                            }
                        }
                  
                    }
                    
            `)),l.$shader=u},l}const m7="settingsStore_v5",hN=90;function Yt(){const n=JSON.parse(JSON.stringify(Pe.getState()));n.isOpen=!1,localStorage.setItem(m7,JSON.stringify(n))}async function Pue(){Pe.setState({isOpen:!0,lightAmbient:.8,lightPoint:2,backgroundColor:"#393939",selectionColor:"#0000FF",controllerDollySpeed:.7,controllerDollyMinDistance:5,isWebGlStatsActive:!1,enableAlphaHash:!1,enableAntiAliasing:!1,enableAntiAliasingSamples:6,skipFustrumCulling:!1,freezeCurrentCulling:!1,enableItemCulling:!1,enableGlbCulling:!1,showAllWhenStill:!1,cullingDistance:25,cullingSize:2,cameraFov:hN,occlusionCulling:!1}),Yt();const n=W(),e=n.getSceneController();Pe.getState().isWebGlStatsActive&&n.removeStats(),await zi(!0);const t=e.currentScene();t.background=new rt(Pe.getState().backgroundColor),e.__ambientLight.intensity=Pe.getState().lightAmbient,e.__pointLight.intensity=Pe.getState().lightPoint,e.getMeshGroups().forEach(i=>{e.getMeshes(i).forEach(s=>{s.children.forEach(a=>{const l=a;l.material.opacity<1&&(l.material=Am(l.material.color,l.material.opacity,!1),l.$backupMaterial=l.material)}),s.$refreshSelection!==void 0&&s.$refreshSelection()})}),n.__camera3d.fov=Yp(hN,n.__camera3d.aspect),n.__camera3d.updateProjectionMatrix(),n.forceRenderNextFrame()}const Pe=mr(n=>({isOpen:!1,backgroundColor:"#393939",selectionColor:"#0000FF",lightAmbient:.8,lightPoint:2,controllerDollySpeed:.7,controllerDollyMinDistance:5,isWebGlStatsActive:!1,enableAlphaHash:!1,enableAntiAliasing:!1,enableAntiAliasingSamples:6,enableItemCulling:!1,enableGlbCulling:!1,freezeCurrentCulling:!1,skipFustrumCulling:!1,occlusionCulling:!1,showAllWhenStill:!1,cullingSize:2,cameraFov:hN,cullingDistance:25,settingsToggle:()=>{n(e=>({isOpen:!e.isOpen}))}})),BU=localStorage.getItem(m7);if(BU){const n=JSON.parse(BU);n!=null&&n.selectionColor||(n.selectionColor="#0000FF"),Pe.setState(n)}const mn=mr(n=>({modelGroups:null,unsyncedCount:0,groupLoadInfo:"",isOpen:!1,activateSyncDialog:()=>n(()=>({isOpen:!0})),deactivateSyncDialog:()=>n(()=>({isOpen:!1}))}));function kue(){const n=f7(),e=mn();if(!Pe().isWebGlStatsActive)return null;function r(i){return new Intl.NumberFormat("de-DE",{style:"decimal"}).format(i).toString().replaceAll("."," ")}return d.jsx(d.Fragment,{children:d.jsx("div",{className:"fixed right-[120px] top-[120px] z-[90]",children:d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{children:[d.jsxs("span",{className:"m-2 text-white",children:["calls:",n.calls]}),d.jsxs("span",{className:"m-2 text-white",children:["triangles:",r(n.triangles)]})]}),e.groupLoadInfo?d.jsxs("span",{className:"m-2 text-white",children:["loading model: ",e.groupLoadInfo]}):null]})})})}function Lue(n,e,t){return n?e?d.jsx("div",{className:"flex items-center",onClick:async()=>{await ae.treeview_toggle_id(t),Pt.getState().updateToggel()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-5 text-gray-600 hover:text-gray-200",fill:"none","data-tooltip":"Collapse",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}):d.jsx("div",{className:"flex items-center",onClick:async()=>{await ae.treeview_toggle_id(t),Pt.getState().updateToggel()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-5 text-gray-600 hover:text-gray-200",fill:"none","data-tooltip":"Expand",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}):d.jsx("div",{className:"ml-5 flex items-center"})}function Oue(n){return new Worker(""+new URL("modelLoaderWorker-BCo0r1aI.js",import.meta.url).href,{name:n==null?void 0:n.name})}let ry=0;async function Due(n){if(ry>10)for(;ry>9;)await JI(2);ry++;const e=new Oue,t=Um(e);return[await new t(n),e,()=>{ry--}]}let zU=0;function Uue(){return zU++,zU}class HU extends Ve{constructor(t,r,i,o,s,a,l){super(t,r);Se(this,"isBatchedMesh");Se(this,"_multiDrawCounts");Se(this,"_multiDrawStarts");Se(this,"_multiDrawCount");Se(this,"_multiDrawInstances",null);Se(this,"material");Se(this,"boundingBox");Se(this,"boundingSphere");Se(this,"$pickingMaterial");Se(this,"$backupMaterial");Se(this,"$rgbId");Se(this,"$materialID");Se(this,"$isSelected");Se(this,"_matricesTexture");Se(this,"_indirectTexture");Se(this,"_colorsTexture");this.material=r,this.isBatchedMesh=!0,this.boundingBox=null,this.boundingSphere=null,this._multiDrawCounts=i,this._multiDrawStarts=o,this._multiDrawCount=s,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this.frustumCulled=!l;const c=new rt;this.$materialID=Uue(),this.$rgbId=c.setHex(this.$materialID),this.$pickingMaterial=Am(this.$rgbId,1,!1,0,!0),this.$backupMaterial=r,this.$isSelected=a}$setPicking(t,r=!1){var i,o;if(t){const s=Xe.getState(),a=s.enabled;this.material=this.$pickingMaterial,this.material.visible=!0;const l=this.$backupMaterial.opacity;let c=!1;if(l!==1&&(l>=.1001?c=r:c=!r),c){this.material.visible=!1;return}const u=(i=this.$backupMaterial)==null?void 0:i.$shader,h=(o=u==null?void 0:u.uniforms)==null?void 0:o.transformOverride;h&&(this.material=Am(this.$rgbId,1,!1,0,!0,h.value.elements));const f=W().getClipping();f&&(this.material.clippingPlanes=f.getClippingPlanes());const m=this.material;if(m!=null&&m.$shader){const g=m.$shader.uniforms;g.boxEnabled.value=a,g.boxmax.value=new N(s.maxX,s.maxY,s.maxZ),g.boxmin.value=new N(s.minX,s.minY,s.minZ)}}else this.material=this.$backupMaterial;this.material.needsUpdate=!0}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=this.geometry.boundingBox)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=this.geometry.boundingSphere)}dispose(){return this.geometry.dispose(),this}}class g7 extends sl{constructor(){super(...arguments);Se(this,"__modelGroupKey");Se(this,"__modelDBKey");Se(this,"__modelDBKeyIndex");Se(this,"__modelDBKeyPosition");Se(this,"__modelDBStore");Se(this,"_materialid");Se(this,"$groups");Se(this,"$groupColors");Se(this,"$groupTransforms");Se(this,"$geometry");Se(this,"$pickingMesh");Se(this,"$meshes")}$initMesh(t,r,i,o){this.$groupColors=r,this.$groups=i,this.$groupTransforms=new Map,this.$geometry=t,this.__modelGroupKey=o.modelGroupKey,this.__modelDBKey=o.modelDBKey,this.__modelDBKeyIndex=o.modelDBKeyIndex,this.__modelDBKeyPosition=o.modelDBKeyPosition,this.__modelDBStore=o.modelDBStore,i.forEach(s=>{const a=this.$groupColors.get(s.material_index)||[0,1,0,.5],l=this.$groupTransforms.get(s.transformation),c=new rt(a[0],a[1],a[2]),u=Am(c,a[3],!1,0,!1,l);s.transformation&&console.log(s.transformation);const h=new HU(t,u,new Int32Array([s.count]),new Int32Array([s.start]),1,!!s.is_sel,!!l);this.$meshes=new Map,this.$meshes.set(this.$getMeshKey(a,l,s.is_sel),h),this.add(h)})}$getMeshMaterialFromRange(t,r,i){var l;const o=this.$groupColors.get(t),s=this.$groupTransforms.get(r),a=this.$getMeshKey(o,s,i);return(l=this.$meshes.get(a))==null?void 0:l.material}$getMeshKey(t=[0,0,0,0],r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i){!t[0]&&!t[1]&&!t[2]&&(t[0]=.5019607843137255,t[1]=.5019607843137255,t[2]=.5019607843137255);const o=(t[0]*255).toFixed(),s=(t[1]*255).toFixed(),a=(t[2]*255).toFixed(),l=(t[3]*255).toFixed();return`${i}_${o}_${s}_${a}_${l}_${r.join("_")}`}$refreshSelection(){let t=!1;this.$groups.forEach(r=>{r.is_sel&&(t=!0)}),t&&this.$updateGroups(this.$groups,this.$groupColors,this.$groupTransforms,!0)}$updateGroups(t,r,i,o){if(this.$groups.length===0&&t.length===0)return;this.$groups=t,this.$groupColors=r,this.$groupTransforms=i;const s=new Map;if(o?!0:ae.showSelectionColor()){const c=new rt(Pe.getState().selectionColor);this.$groupColors.set(-1,[c.r,c.g,c.b,1]),this.$groups.forEach(u=>{u.is_sel&&(u.material_index=-1)})}t.forEach(c=>{const u=this.$getMeshKey(this.$groupColors.get(c.material_index),this.$groupTransforms.get(c.transformation),c.is_sel),h=s.get(u);h?h.push(c):s.set(u,[c])});const l=new Set(Array.from(this.$meshes.keys()));s.forEach((c,u)=>{const h=this.$meshes.get(u),f=c.filter(_=>_.count),m=new Int32Array(f.length),g=new Int32Array(f.length);if(f.forEach((_,v)=>{m[v]=_.start*4,g[v]=_.count}),h)l.delete(u),h._multiDrawCount=f.length,h._multiDrawCounts=g,h._multiDrawStarts=m,h.visible=!0;else{const _=this.$groupColors.get(f[0].material_index)||[0,1,0,.5],v=this.$groupTransforms.get(f[0].transformation),p=new rt(_[0],_[1],_[2]),x=Am(p,_[3],!1,0,!1,v),y=new HU(this.$geometry,x,g,m,f.length,!!f[0].is_sel,!!v);y.visible=f.length>0;const w=x.color.toArray().concat([x.opacity]);this.$meshes.set(this.$getMeshKey(w,v,f[0].is_sel),y),this.add(y)}}),l.forEach(c=>{const u=this.$meshes.get(c);u&&u._multiDrawCount>0&&(u._multiDrawCount=0,u._multiDrawCounts=new Int32Array,u._multiDrawStarts=new Int32Array,u.visible=!1)})}$updateClippingPlanes(t){}$getGeometryBoundingBox(){return this.$geometry.boundingBox}$getMaterials(){const t=[];return this.children.forEach(r=>{const i=r;t.push(i.material)}),t}$getMeshById(t){let r=!1;return this.children.forEach(i=>{i.$materialID===t&&(r=!0)}),r}$getGroups(){return this.$groups}$getGroupsRaycast(){return this.$groups.map(t=>({start:t.start,count:t.count,material_index:t.material_index,transformation:this.$groupTransforms.get(t.transformation),is_sel:0}))}$setPicking(t,r){this.children.forEach(i=>{const o=i;o.$setPicking&&o.$setPicking(t,r)})}}Tr.DEFAULT_UP=new N(0,0,1);async function cE(n,e,t){const i=await new Oi(n).getJsonKey(e),o=[];if(i&&i.length)for(let s=0;s<i.length;s++){const[a,l,c]=await Due(n),u=a.getModel(i[s]).then(async h=>{if(a[lI](),l.terminate(),c(),!h)return;const f=new Sn,m=new $n(h.index,1);m.onUploadCallback=function(){this.array=null},f.setIndex(m);const g=new $n(h.position,3,!1);g.onUploadCallback=function(){this.array=null},f.setAttribute("position",g),h.matrix&&f.applyMatrix4(new dt().fromArray(h.matrix));const _=new Float32Array(h.boundingBox),v=new Float32Array(h.boundingSphere);f.boundingBox=new nt(new N(_[0],_[1],_[2]),new N(_[3],_[4],_[5])),f.boundingSphere=new km(new N(v[0],v[1],v[2]),v[3]);const p=new g7,x=new Map;x.set(0,h.color),p.$initMesh(f,x,[{start:0,count:h.index.length,material_index:0,transformation:0,is_sel:0}],{modelGroupKey:h.groupKey||h.indexdbKey,modelDBKey:h.indexdbKey,modelDBKeyIndex:h.indexID,modelDBKeyPosition:h.positionID,modelDBStore:n});const y=W().getSceneController();ae.meshes_set_mesh_as_loaded(p.__modelDBKeyIndex,[h.color],p.$groups.map(w=>({start:w.start,count:w.count,material_index:w.material_index,transformation:0,is_sel:0}))),y.addMeshToScene(p,e)});o.push(u)}await Promise.all(o)}function m_(n){if(n)return n.project_key;throw"getActiveProjectModelGroupKey called without active prosjekt selected"}class Fue{clear(){ae.rows_selected_sites.clear()}has(e){return ae.rows_selected_sites.has(e.replace("/",""))||ae.rows_selected_sites.has(e)}}const fN=new Fue;function M1(n){return((n==null?void 0:n.project_key)||"unknown")+"_TEMP_FILE"}function VU(n){return n.loaded?d.jsx("div",{className:"flex items-center",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ml-2 h-4 w-4 text-yellow-600 hover:text-gray-200",fill:"none","data-tooltip":"Unloads Group",viewBox:"0 0 24 24",stroke:"currentColor",onClick:async()=>{var r;async function e(i){if(i.$loaded){W().getSceneController().clearModelGroup(i.name),i.$loaded=!1;const s=mn.getState().modelGroups;mn.setState({modelGroups:[]}),mn.setState({modelGroups:s})}}const t=(r=mn.getState().modelGroups)==null?void 0:r.filter(i=>fN.has(i.name));if(t!=null&&t.length){for(let i=0;i<t.length;i++)await e(t[i]);await e(n.modelGroupName)}else await e(n.modelGroupName);W().getSceneController().updateBB(),W().forceRenderNextFrame()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}):d.jsx("div",{className:"flex items-center",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ml-2 h-4 w-4 text-gray-600 hover:text-gray-200",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Load modelGroup from disk",stroke:"currentColor",onClick:async()=>{var o;ke.setState({loadingData:!0,dialogContent:"Please wait",dialogHeader:"Loading"});const e=W(),t=e.getSceneController().getMeshes().length===0;async function r(s){if(!s.$loaded){Re.getState().selectedProject&&(s.$isLocalFile?await cE(M1(Re.getState().selectedProject),s.name):await cE(m_(Re.getState().selectedProject),s.name)),e.forceRenderNextFrame(),s.$loaded=!0;const l=mn.getState().modelGroups;mn.setState({modelGroups:[]}),mn.setState({modelGroups:l})}}const i=(o=mn.getState().modelGroups)==null?void 0:o.filter(s=>fN.has(s.name));if(ke.setState({loadingData:!0,dialogContent:`Please wait, 0/${i==null?void 0:i.length}`,dialogHeader:"Loading"}),i!=null&&i.length)for(let s=0;s<i.length;s++)ke.setState({loadingData:!0,dialogContent:`Please wait, ${s+1}/${i==null?void 0:i.length}`,dialogHeader:"Loading"}),await r(i[s]),await r(n.modelGroupName);else await r(n.modelGroupName);e.getSceneController().updateBB(),t&&await e.fitModelToCanvas(!0),await ae.update_hidden_groups(),e.forceRenderNextFrame(),ke.setState({loadingData:!1,dialogContent:"",dialogHeader:""})},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})})}function jue(n,e){var t,r;if(e){const i=e.replace("/",""),o=(t=mn.getState().modelGroups)==null?void 0:t.filter(s=>s.name===i);if(o!=null&&o.length)return d.jsx(VU,{modelGroupName:o[0],loaded:o[0].$loaded});{const s=(r=mn.getState().modelGroups)==null?void 0:r.filter(a=>a.name===e);if(s!=null&&s.length)return d.jsx(VU,{modelGroupName:s[0],loaded:s[0].$loaded})}}return d.jsx("div",{className:"flex items-center",children:d.jsx("div",{className:"ml-2 h-4 w-4",children:" "})})}let Kg=null;function Bue(n){const e=O.useRef(null),t=ae.getRow(n),r="threeView-row hover:bg-gray-700 hover:text-white bg-indigo-500 text-black ";if(O.useEffect(()=>{const i=e.current;if(i!=null&&i.offsetParent){async function o(){if(t!=null&&t.data){const s=t==null?void 0:t.data[4],a=t==null?void 0:t.data[5],l=i==null?void 0:i.offsetParent;s&&l?l.className!==r&&(l.className=r):l&&l.className!=="threeView-row hover:bg-gray-700"&&(l.className="threeView-row hover:bg-gray-700"),a?l.style.opacity=.5:l.style.opacity=null}}t!=null&&t.key&&o()}}),t&&t.data){const i=t.data[3],o=t.data[2],s=t.data[6];return d.jsxs("div",{ref:e,className:"flex",style:{marginLeft:`${(t==null?void 0:t.lvl)*7}px`},children:[jue(t.lvl,s),Lue(o,i,t.key),d.jsx("div",{"data-copyvalue":!0,"data-raw-value":t.data[0],className:"flex-1",onClick:async a=>{if(a.preventDefault(),a.stopPropagation(),!a.ctrlKey&&!a.shiftKey&&await ae.selection_clear(!1),Km(t.key,a.ctrlKey),a.shiftKey&&Kg!==null)if(Kg>n)for(let l=n;l<Kg+1;l++){const c=ae.getRow(l);if(c)if((c==null?void 0:c.data)&&(c==null?void 0:c.data[2])){await ae.selection_add([c.key]);const h=await ae.getKeyChildrenFromItem(c.key);await ae.selection_add(h)}else await ae.selection_add([c.key])}else for(let l=Kg;l<n+1;l++){const c=ae.getRow(l);if(c)if((c==null?void 0:c.data)&&(c==null?void 0:c.data[2])){await ae.selection_add([c.key]);const h=await ae.getKeyChildrenFromItem(c.key);await ae.selection_add(h)}else await ae.selection_add([c.key])}else if(await ae.selection_is_selected(t.key)){if(await ae.selection_remove([t.key]),o){const l=await ae.getKeyChildrenFromItem(t.key);await ae.selection_remove(l)}}else if(await ae.selection_add([t.key]),o){const l=await ae.getKeyChildrenFromItem(t.key);await ae.selection_add(l)}await ae.selection_append(),Pt.getState().updateToggel(),Kg=n},children:d.jsx("div",{className:"flex",children:d.jsx("span",{className:t.lvl===0?"font-semibold text-yellow-500":"",children:t.data[0]})})})]})}else return null}function zue(){Pt();const n=rr(),e=mn(),t=Re(),r=ae.length();return n.treeViewActive?t.selectedProject?!Array.isArray(e.modelGroups)||!e.modelGroups.filter(i=>i.$synced).length||!r?null:d.jsx(YJ,{rowheight:17,length:r,addRowElements:i=>d.jsx("div",{className:"block w-full whitespace-nowrap border-b border-gray-700 text-xs",children:Bue(i.no)})}):d.jsx("div",{className:"m-2 flex flex-col bg-gray-800 p-2",children:"No project selected"}):null}const v7=mr(n=>({activeTab:"HOME",setActiveTab:e=>{n(()=>({activeTab:e}))}}));function $t(n){return d.jsxs("div",{className:"m-1 flex min-w-20 flex-col",children:[d.jsx("div",{className:"m-auto flex flex-1",children:n.children}),d.jsx("div",{className:"rounded bg-gray-700 pl-1 pr-1 text-center text-xs text-gray-200",children:n.name})]})}function Hue(){const n=rr();return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Opens/closes the treeview menu on the left",onClick:async()=>{Pt.getState().updateToggel(0),n.treeViewToggle()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5 rotate-90",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"TreeView"})]})}function Vue(){const n=Re();return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Opens project selector dialog",onClick:()=>{n.activateProjectSelectDialog()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5 rotate-90",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})}),d.jsx("span",{className:"text-center text-xs",children:"Project"})]})}function Gue(){const n=mn();return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Opens the sync dialog",onClick:()=>{Re.getState().selectedProject?n.activateSyncDialog():Re.getState().activateProjectSelectDialog()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-2m-4-1v8m0 0l3-3m-3 3L9 8m-5 5h2.586a1 1 0 01.707.293l2.414 2.414a1 1 0 00.707.293h3.172a1 1 0 00.707-.293l2.414-2.414a1 1 0 01.707-.293H20"})}),d.jsx("span",{className:"text-center text-xs",children:"Sync"})]})}function _7(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["Clears all local files. Useful for:","- Reducing disk space","- Reset after issues with syncing/unexpected issues"].join(`
`),onClick:async()=>{confirm(" Are you sure, you will need to resync")&&(ke.setState({loadingData:!0,dialogHeader:"cleanup",dialogContent:"Deleting all cached data in browser"}),await VN(),ke.setState({loadingData:!1}),window.location.reload())},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d.jsx("span",{className:"text-center text-xs",children:"Cache"})]})}class jk{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;return r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t),this}removeEventListener(e,t){if(this._listeners===void 0)return this;const i=this._listeners[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const r=this._listeners[e.type];if(r!==void 0){const i=r.slice(0);for(let o=0,s=i.length;o<s;o++)i[o].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class vp extends jk{constructor(e,t,r,i={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=r,this._attributes=i,!t.isOnGraph(r))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class Wue extends jk{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(t=>t.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(t=>t.getChild())}disconnectParents(e,t){let r=this.listParentEdges(e);return t&&(r=r.filter(i=>t(i.getParent()))),r.forEach(i=>i.dispose()),this}createEdge(e,t,r,i){return this._registerEdge(new vp(e,t,r,i))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const r=e.getChild();return this._childEdges.has(r)||this._childEdges.set(r,new Set),this._childEdges.get(r).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Z0(){return Z0=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Z0.apply(this,arguments)}class Sd{constructor(e){if(this.list=[],e)for(const t of e)this.list.push(t)}add(e){this.list.push(e)}remove(e){const t=this.list.indexOf(e);t>=0&&this.list.splice(t,1)}removeChild(e){const t=[];for(const r of this.list)r.getChild()===e&&t.push(r);for(const r of t)this.remove(r);return t}listRefsByChild(e){const t=[];for(const r of this.list)r.getChild()===e&&t.push(r);return t}values(){return this.list}}class qn{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const t of e)this.add(t)}add(e){const t=e.getChild();this.removeChild(t),this.set.add(e),this.map.set(t,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const t=this.map.get(e)||null;return t&&this.remove(t),t}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class hl{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,t){this.map[e]=t}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const zn=Symbol("attributes"),_p=Symbol("immutableKeys");class Bk extends jk{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[zn]=void 0,this[_p]=void 0,this.graph=e,this[_p]=new Set,this[zn]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const r in e){const i=e[r];if(i instanceof Bk){const o=this.graph.createEdge(r,this,i);o.addEventListener("dispose",()=>i.dispose()),this[_p].add(r),t[r]=o}else t[r]=i}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const r in this[zn]){const i=this[zn][r];if(i instanceof vp){const o=i;o.getChild()===e&&this.setRef(r,t,o.getAttributes())}else if(i instanceof Sd)for(const o of i.listRefsByChild(e)){const s=o.getAttributes();this.removeRef(r,e),this.addRef(r,t,s)}else if(i instanceof qn){const o=i.getRefByChild(e);if(o){const s=o.getAttributes();this.removeRef(r,e),this.addRef(r,t,s)}}else if(i instanceof hl)for(const o of i.keys()){const s=i.get(o);s.getChild()===e&&this.setRefMap(r,o,t,s.getAttributes())}}return this}get(e){return this[zn][e]}set(e,t){return this[zn][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[zn][e];return t?t.getChild():null}setRef(e,t,r){if(this[_p].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const i=this[zn][e];if(i&&i.dispose(),!t)return this;const o=this.graph.createEdge(e,this,t,r);return o.addEventListener("dispose",()=>{delete this[zn][e],this.dispatchEvent({type:"change",attribute:e})}),this[zn][e]=o,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(r=>r.getChild())}addRef(e,t,r){const i=this.graph.createEdge(e,this,t,r),o=this.assertRefList(e);return o.add(i),i.addEventListener("dispose",()=>{o.remove(i),this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){const r=this.assertRefList(e);if(r instanceof Sd)for(const i of r.removeChild(t))i.dispose();else{const i=r.removeChild(t);i&&i.dispose()}return this}assertRefList(e){const t=this[zn][e];if(t instanceof Sd||t instanceof qn)return t;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(t=>t.getChild())}getRefMap(e,t){const i=this.assertRefMap(e).get(t);return i?i.getChild():null}setRefMap(e,t,r,i){const o=this.assertRefMap(e),s=o.get(t);if(s&&s.dispose(),!r)return this;i=Object.assign(i||{},{key:t});const a=this.graph.createEdge(e,this,r,Z0({},i,{key:t}));return a.addEventListener("dispose",()=>{o.delete(t),this.dispatchEvent({type:"change",attribute:e,key:t})}),o.set(t,a),this.dispatchEvent({type:"change",attribute:e,key:t})}assertRefMap(e){const t=this[zn][e];if(t instanceof hl)return t;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(Z0({},e,{target:this})),this.graph.dispatchEvent(Z0({},e,{target:this,type:`node:${e.type}`})),this}}const x7="v4.0.8",uE="@glb.bin";var ct;(function(n){n.ACCESSOR="Accessor",n.ANIMATION="Animation",n.ANIMATION_CHANNEL="AnimationChannel",n.ANIMATION_SAMPLER="AnimationSampler",n.BUFFER="Buffer",n.CAMERA="Camera",n.MATERIAL="Material",n.MESH="Mesh",n.PRIMITIVE="Primitive",n.PRIMITIVE_TARGET="PrimitiveTarget",n.NODE="Node",n.ROOT="Root",n.SCENE="Scene",n.SKIN="Skin",n.TEXTURE="Texture",n.TEXTURE_INFO="TextureInfo"})(ct||(ct={}));var dE;(function(n){n.INTERLEAVED="interleaved",n.SEPARATE="separate"})(dE||(dE={}));var Lo;(function(n){n.ARRAY_BUFFER="ARRAY_BUFFER",n.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",n.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",n.OTHER="OTHER",n.SPARSE="SPARSE"})(Lo||(Lo={}));var pN;(function(n){n[n.R=4096]="R",n[n.G=256]="G",n[n.B=16]="B",n[n.A=1]="A"})(pN||(pN={}));var Hd;(function(n){n.GLTF="GLTF",n.GLB="GLB"})(Hd||(Hd={}));const R1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var mN=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function $ue(){var n=new mN(3);return mN!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function v2(n){var e=n[0],t=n[1],r=n[2];return Math.hypot(e,t,r)}(function(){var n=$ue();return function(e,t,r,i,o,s){var a,l;for(t||(t=3),r||(r=0),i?l=Math.min(i*t+r,e.length):l=e.length,a=r;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],o(n,n,s),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}})();class rn{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}else{const t=e.split(",")[1],r=e.indexOf("base64")>=0;return Buffer.from(t,r?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const o of e)t+=o.byteLength;const r=new Uint8Array(t);let i=0;for(const o of e)r.set(o,i),i+=o.byteLength;return r}static pad(e,t=0){const r=this.padNumber(e.byteLength);if(r===e.byteLength)return e;const i=new Uint8Array(r);if(i.set(e),t!==0)for(let o=e.byteLength;o<r;o++)i[o]=t;return i}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let r=e.byteLength;for(;r--;)if(e[r]!==t[r])return!1;return!0}static toView(e,t=0,r=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,r))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Yue{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let t=new DataView(e.buffer,e.byteOffset+4),r,i;for(;t.byteLength;){if(r=t.getUint16(0,!1),Kue(t,r),i=t.getUint8(r+1),i===192||i===193||i===194)return[t.getUint16(r+7,!1),t.getUint16(r+5,!1)];t=new DataView(e.buffer,t.byteOffset+r+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class N1{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return rn.decodeText(e.slice(12,16))===N1.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}N1.PNG_FRIED_CHUNK_NAME="CgBI";class Vd{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let r=0;const i=4,o=this.getSize(e,t);if(!o)return null;for(;o[0]>1||o[1]>1;)r+=o[0]*o[1]*i,o[0]=Math.max(Math.floor(o[0]/2),1),o[1]=Math.max(Math.floor(o[1]/2),1);return r+=1*1*i,r}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}Vd.impls={"image/jpeg":new Yue,"image/png":new N1};function Kue(n,e){if(e>n.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(n.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return n}class Mm{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return Vd.mimeTypeToExtension(t)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}function GU(n){return Object.prototype.toString.call(n)==="[object Object]"}function Ed(n){if(GU(n)===!1)return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(GU(t)===!1||Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")===!1)}var gN,vN;(function(n){n[n.SILENT=4]="SILENT",n[n.ERROR=3]="ERROR",n[n.WARN=2]="WARN",n[n.INFO=1]="INFO",n[n.DEBUG=0]="DEBUG"})(vN||(vN={}));class ts{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=ts.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=ts.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=ts.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=ts.Verbosity.ERROR&&console.error(e)}}gN=ts;ts.Verbosity=vN;ts.DEFAULT_INSTANCE=new gN(gN.Verbosity.INFO);function Xue(n){var e=n[0],t=n[1],r=n[2],i=n[3],o=n[4],s=n[5],a=n[6],l=n[7],c=n[8],u=n[9],h=n[10],f=n[11],m=n[12],g=n[13],_=n[14],v=n[15],p=e*s-t*o,x=e*a-r*o,y=e*l-i*o,w=t*a-r*s,C=t*l-i*s,T=r*l-i*a,S=c*g-u*m,b=c*_-h*m,R=c*v-f*m,E=u*_-h*g,A=u*v-f*g,F=h*v-f*_;return p*F-x*A+y*E+w*R-C*b+T*S}function que(n,e,t){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=e[9],m=e[10],g=e[11],_=e[12],v=e[13],p=e[14],x=e[15],y=t[0],w=t[1],C=t[2],T=t[3];return n[0]=y*r+w*a+C*h+T*_,n[1]=y*i+w*l+C*f+T*v,n[2]=y*o+w*c+C*m+T*p,n[3]=y*s+w*u+C*g+T*x,y=t[4],w=t[5],C=t[6],T=t[7],n[4]=y*r+w*a+C*h+T*_,n[5]=y*i+w*l+C*f+T*v,n[6]=y*o+w*c+C*m+T*p,n[7]=y*s+w*u+C*g+T*x,y=t[8],w=t[9],C=t[10],T=t[11],n[8]=y*r+w*a+C*h+T*_,n[9]=y*i+w*l+C*f+T*v,n[10]=y*o+w*c+C*m+T*p,n[11]=y*s+w*u+C*g+T*x,y=t[12],w=t[13],C=t[14],T=t[15],n[12]=y*r+w*a+C*h+T*_,n[13]=y*i+w*l+C*f+T*v,n[14]=y*o+w*c+C*m+T*p,n[15]=y*s+w*u+C*g+T*x,n}function Que(n,e){var t=e[0],r=e[1],i=e[2],o=e[4],s=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return n[0]=Math.hypot(t,r,i),n[1]=Math.hypot(o,s,a),n[2]=Math.hypot(l,c,u),n}function Zue(n,e){var t=new mN(3);Que(t,e);var r=1/t[0],i=1/t[1],o=1/t[2],s=e[0]*r,a=e[1]*i,l=e[2]*o,c=e[4]*r,u=e[5]*i,h=e[6]*o,f=e[8]*r,m=e[9]*i,g=e[10]*o,_=s+u+g,v=0;return _>0?(v=Math.sqrt(_+1)*2,n[3]=.25*v,n[0]=(h-m)/v,n[1]=(f-l)/v,n[2]=(a-c)/v):s>u&&s>g?(v=Math.sqrt(1+s-u-g)*2,n[3]=(h-m)/v,n[0]=.25*v,n[1]=(a+c)/v,n[2]=(f+l)/v):u>g?(v=Math.sqrt(1+u-s-g)*2,n[3]=(f-l)/v,n[0]=(a+c)/v,n[1]=.25*v,n[2]=(h+m)/v):(v=Math.sqrt(1+g-s-u)*2,n[3]=(a-c)/v,n[0]=(f+l)/v,n[1]=(h+m)/v,n[2]=.25*v),n}class Jn{static identity(e){return e}static eq(e,t,r=1e-5){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(Math.abs(e[i]-t[i])>r)return!1;return!0}static clamp(e,t,r){return e<t?t:e>r?r:e}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(Jn.clamp(e,0,1)*65535);case 5121:return Math.round(Jn.clamp(e,0,1)*255);case 5122:return Math.round(Jn.clamp(e,-1,1)*32767);case 5120:return Math.round(Jn.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,t,r,i){let o=v2([e[0],e[1],e[2]]);const s=v2([e[4],e[5],e[6]]),a=v2([e[8],e[9],e[10]]);Xue(e)<0&&(o=-o),t[0]=e[12],t[1]=e[13],t[2]=e[14];const c=e.slice(),u=1/o,h=1/s,f=1/a;c[0]*=u,c[1]*=u,c[2]*=u,c[4]*=h,c[5]*=h,c[6]*=h,c[8]*=f,c[9]*=f,c[10]*=f,Zue(r,c),i[0]=o,i[1]=s,i[2]=a}static compose(e,t,r,i){const o=i,s=t[0],a=t[1],l=t[2],c=t[3],u=s+s,h=a+a,f=l+l,m=s*u,g=s*h,_=s*f,v=a*h,p=a*f,x=l*f,y=c*u,w=c*h,C=c*f,T=r[0],S=r[1],b=r[2];return o[0]=(1-(v+x))*T,o[1]=(g+C)*T,o[2]=(_-w)*T,o[3]=0,o[4]=(g-C)*S,o[5]=(1-(m+x))*S,o[6]=(p+y)*S,o[7]=0,o[8]=(_+w)*b,o[9]=(p-y)*b,o[10]=(1-(m+v))*b,o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}}function Jue(n,e){if(!!n!=!!e)return!1;const t=n.getChild(),r=e.getChild();return t===r||t.equals(r)}function ede(n,e){if(!!n!=!!e)return!1;const t=n.values(),r=e.values();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++){const o=t[i],s=r[i];if(o.getChild()!==s.getChild()&&!o.getChild().equals(s.getChild()))return!1}return!0}function tde(n,e){if(!!n!=!!e)return!1;const t=n.keys(),r=e.keys();if(t.length!==r.length)return!1;for(const i of t){const o=n.get(i),s=e.get(i);if(!!o!=!!s)return!1;const a=o.getChild(),l=s.getChild();if(a!==l&&!a.equals(l))return!1}return!0}function y7(n,e){if(n===e)return!0;if(!!n!=!!e||!n||!e||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function w7(n,e){if(n===e)return!0;if(!!n!=!!e)return!1;if(!Ed(n)||!Ed(e))return n===e;const t=n,r=e;let i=0,o=0,s;for(s in t)i++;for(s in r)o++;if(i!==o)return!1;for(s in t){const a=t[s],l=r[s];if(hE(a)&&hE(l)){if(!y7(a,l))return!1}else if(Ed(a)&&Ed(l)){if(!w7(a,l))return!1}else if(a!==l)return!1}return!0}function hE(n){return Array.isArray(n)||ArrayBuffer.isView(n)}const WU="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",nde=999,rde=6,$U=new Set,ide=function(){let e="";for(let t=0;t<rde;t++)e+=WU.charAt(Math.floor(Math.random()*WU.length));return e},ode=function(){for(let e=0;e<nde;e++){const t=ide();if(!$U.has(t))return $U.add(t),t}return""},YU="https://null.example";class J0{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return Mm.basename(new URL(e,YU).pathname)}static extension(e){return Mm.extension(new URL(e,YU).pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const r=e.split("/"),i=t.split("/");r.pop();for(let o=0;o<i.length;o++)i[o]!=="."&&(i[o]===".."?r.pop():r.push(i[o]));return r.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}J0.DEFAULT_INIT={};J0.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const fu=n=>n,sde=new Set;class zk extends Bk{constructor(e,t=""){super(e),this[zn].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,fu)}copy(e,t=fu){for(const r in this[zn]){const i=this[zn][r];if(i instanceof vp)this[_p].has(r)||i.dispose();else if(i instanceof Sd||i instanceof qn)for(const o of i.values())o.dispose();else if(i instanceof hl)for(const o of i.values())o.dispose()}for(const r in e[zn]){const i=this[zn][r],o=e[zn][r];if(o instanceof vp)this[_p].has(r)?i.getChild().copy(t(o.getChild()),t):this.setRef(r,t(o.getChild()),o.getAttributes());else if(o instanceof qn||o instanceof Sd)for(const s of o.values())this.addRef(r,t(s.getChild()),s.getAttributes());else if(o instanceof hl)for(const s of o.keys()){const a=o.get(s);this.setRefMap(r,s,t(a.getChild()),a.getAttributes())}else Ed(o)?this[zn][r]=JSON.parse(JSON.stringify(o)):Array.isArray(o)||o instanceof ArrayBuffer||ArrayBuffer.isView(o)?this[zn][r]=o.slice():this[zn][r]=o}return this}equals(e,t=sde){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const r in this[zn]){if(t.has(r))continue;const i=this[zn][r],o=e[zn][r];if(i instanceof vp||o instanceof vp){if(!Jue(i,o))return!1}else if(i instanceof qn||o instanceof qn||i instanceof Sd||o instanceof Sd){if(!ede(i,o))return!1}else if(i instanceof hl||o instanceof hl){if(!tde(i,o))return!1}else if(Ed(i)||Ed(o)){if(!w7(i,o))return!1}else if(hE(i)||hE(o)){if(!y7(i,o))return!1}else if(i!==o)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Fi extends zk{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new hl})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t._validateParent(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class At extends Fi{init(){this.propertyType=ct.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:At.Type.SCALAR,componentType:At.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case At.Type.SCALAR:return 1;case At.Type.VEC2:return 2;case At.Type.VEC3:return 3;case At.Type.VEC4:return 4;case At.Type.MAT2:return 4;case At.Type.MAT3:return 9;case At.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case At.ComponentType.BYTE:return 1;case At.ComponentType.UNSIGNED_BYTE:return 1;case At.ComponentType.SHORT:return 2;case At.ComponentType.UNSIGNED_SHORT:return 2;case At.ComponentType.UNSIGNED_INT:return 4;case At.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getNormalized(),r=this.getElementSize(),i=this.getComponentType();if(this.getMin(e),t)for(let o=0;o<r;o++)e[o]=Jn.decodeNormalizedInt(e[o],i);return e}getMin(e){const t=this.getArray(),r=this.getCount(),i=this.getElementSize();for(let o=0;o<i;o++)e[o]=1/0;for(let o=0;o<r*i;o+=i)for(let s=0;s<i;s++){const a=t[o+s];Number.isFinite(a)&&(e[s]=Math.min(e[s],a))}return e}getMaxNormalized(e){const t=this.getNormalized(),r=this.getElementSize(),i=this.getComponentType();if(this.getMax(e),t)for(let o=0;o<r;o++)e[o]=Jn.decodeNormalizedInt(e[o],i);return e}getMax(e){const t=this.get("array"),r=this.getCount(),i=this.getElementSize();for(let o=0;o<i;o++)e[o]=-1/0;for(let o=0;o<r*i;o+=i)for(let s=0;s<i;s++){const a=t[o+s];Number.isFinite(a)&&(e[s]=Math.max(e[s],a))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return At.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const t=this.getElementSize(),r=this.getComponentType(),i=this.getArray();return this.getNormalized()?Jn.decodeNormalizedInt(i[e*t],r):i[e*t]}setScalar(e,t){const r=this.getElementSize(),i=this.getComponentType(),o=this.getArray();return this.getNormalized()?o[e*r]=Jn.encodeNormalizedInt(t,i):o[e*r]=t,this}getElement(e,t){const r=this.getNormalized(),i=this.getElementSize(),o=this.getComponentType(),s=this.getArray();for(let a=0;a<i;a++)r?t[a]=Jn.decodeNormalizedInt(s[e*i+a],o):t[a]=s[e*i+a];return t}setElement(e,t){const r=this.getNormalized(),i=this.getElementSize(),o=this.getComponentType(),s=this.getArray();for(let a=0;a<i;a++)r?s[e*i+a]=Jn.encodeNormalizedInt(t[a],o):s[e*i+a]=t[a];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?ade(e):At.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}At.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};At.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function ade(n){switch(n.constructor){case Float32Array:return At.ComponentType.FLOAT;case Uint32Array:return At.ComponentType.UNSIGNED_INT;case Uint16Array:return At.ComponentType.UNSIGNED_SHORT;case Uint8Array:return At.ComponentType.UNSIGNED_BYTE;case Int16Array:return At.ComponentType.SHORT;case Int8Array:return At.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class S7 extends Fi{init(){this.propertyType=ct.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new qn,samplers:new qn})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class E7 extends Fi{init(){this.propertyType=ct.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}E7.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class g_ extends Fi{init(){this.propertyType=ct.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:g_.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Lo.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Lo.OTHER})}}g_.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class T7 extends Fi{init(){this.propertyType=ct.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Mh extends Fi{init(){this.propertyType=ct.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Mh.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Mh.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class lde extends zk{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}lde.EXTENSION_NAME=void 0;class Ps extends Fi{init(){this.propertyType=ct.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Ps.WrapMode.REPEAT,wrapT:Ps.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Ps.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Ps.MagFilter={NEAREST:9728,LINEAR:9729};Ps.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:iy,G:oy,B:sy,A:cde}=pN;class lh extends Fi{init(){this.propertyType=ct.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:lh.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Ps(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Ps(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Ps(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Ps(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Ps(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:iy|oy|sy|cde,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:iy|oy|sy,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:iy|oy|sy})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:iy})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:oy|sy})}}lh.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class C7 extends Fi{init(){this.propertyType=ct.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new qn})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}let b7=class extends Fi{init(){this.propertyType=ct.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new qn})}copy(e,t=fu){if(t===fu)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Jn.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),r=this.get("rotation").slice(),i=this.get("scale").slice();return Jn.decompose(e,t,r,i),this.set("translation",t).set("rotation",r).set("scale",i)}getWorldTranslation(){const e=[0,0,0];return Jn.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Jn.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Jn.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let i=this;i!=null;i=i.getParentNode())e.push(i);let t;const r=e.pop().getMatrix();for(;t=e.pop();)que(r,r,t.getMatrix());return r}addChild(e){const t=e.getParentNode();t&&t.removeChild(e);for(const r of e.listParents())r.propertyType===ct.SCENE&&r.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===ct.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}};class I1 extends Fi{init(){this.propertyType=ct.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:I1.Mode.TRIANGLES,material:null,indices:null,attributes:new hl,targets:new qn})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Lo.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Lo.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}I1.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class ude extends zk{init(){this.propertyType=ct.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new hl})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Lo.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Ri(){return Ri=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ri.apply(this,arguments)}class A7 extends Fi{init(){this.propertyType=ct.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new qn})}copy(e,t=fu){if(t===fu)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){const t=e.getParentNode();return t&&t.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class M7 extends Fi{init(){this.propertyType=ct.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new qn})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Lo.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class R7 extends Fi{init(){this.propertyType=ct.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Vd.extensionToMimeType(Mm.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=Vd.extensionToMimeType(Mm.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",rn.assertView(e))}getSize(){const e=this.get("image");return e?Vd.getSize(e,this.getMimeType()):null}}class dde extends Fi{init(){this.propertyType=ct.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${x7}`,version:"2.0"},defaultScene:null,accessors:new qn,animations:new qn,buffers:new qn,cameras:new qn,materials:new qn,meshes:new qn,nodes:new qn,scenes:new qn,skins:new qn,textures:new qn})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",t=>{this._addChildOfRoot(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=fu){if(t===fu)throw new Error("Root cannot be copied.");this.set("asset",Ri({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Ri({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const r of e.listRefMapKeys("extensions")){const i=e.getExtension(r);this.setExtension(r,t(i))}return this}_addChildOfRoot(e){return e instanceof A7?this.addRef("scenes",e):e instanceof b7?this.addRef("nodes",e):e instanceof Mh?this.addRef("cameras",e):e instanceof M7?this.addRef("skins",e):e instanceof C7?this.addRef("meshes",e):e instanceof lh?this.addRef("materials",e):e instanceof R7?this.addRef("textures",e):e instanceof S7?this.addRef("animations",e):e instanceof At?this.addRef("accessors",e):e instanceof T7&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Bv{static fromGraph(e){return Bv._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new Wue,this._root=new dde(this._graph),this._logger=ts.DEFAULT_INSTANCE,Bv._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const t=e.map(r=>r.name);for(const r of e)await r(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(i=>i.extensionName===t)||new e(this)}createScene(e=""){return new A7(this._graph,e)}createNode(e=""){return new b7(this._graph,e)}createCamera(e=""){return new Mh(this._graph,e)}createSkin(e=""){return new M7(this._graph,e)}createMesh(e=""){return new C7(this._graph,e)}createPrimitive(){return new I1(this._graph)}createPrimitiveTarget(e=""){return new ude(this._graph,e)}createMaterial(e=""){return new lh(this._graph,e)}createTexture(e=""){return new R7(this._graph,e)}createAnimation(e=""){return new S7(this._graph,e)}createAnimationChannel(e=""){return new E7(this._graph,e)}createAnimationSampler(e=""){return new g_(this._graph,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new At(this._graph,e).setBuffer(t)}createBuffer(e=""){return new T7(this._graph,e)}}Bv._GRAPH_DOCUMENTS=new WeakMap;class hde{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const r=this.jsonDoc.json.textures[t.index];if(r.sampler===void 0)return;const i=this.jsonDoc.json.samplers[r.sampler];i.magFilter!==void 0&&e.setMagFilter(i.magFilter),i.minFilter!==void 0&&e.setMinFilter(i.minFilter),i.wrapS!==void 0&&e.setWrapS(i.wrapS),i.wrapT!==void 0&&e.setWrapT(i.wrapT)}}const KU={logger:ts.DEFAULT_INSTANCE,extensions:[],dependencies:{}},fde=new Set([ct.BUFFER,ct.TEXTURE,ct.MATERIAL,ct.MESH,ct.PRIMITIVE,ct.NODE,ct.SCENE]);class pde{static read(e,t=KU){const r=Ri({},KU,t),{json:i}=e,o=new Bv().setLogger(r.logger);this.validate(e,r);const s=new hde(e),a=i.asset,l=o.getRoot().getAsset();a.copyright&&(l.copyright=a.copyright),a.extras&&(l.extras=a.extras),i.extras!==void 0&&o.getRoot().setExtras(Ri({},i.extras));const c=i.extensionsUsed||[],u=i.extensionsRequired||[];r.extensions.sort((S,b)=>S.EXTENSION_NAME>b.EXTENSION_NAME?1:-1);for(const S of r.extensions)if(c.includes(S.EXTENSION_NAME)){const b=o.createExtension(S).setRequired(u.includes(S.EXTENSION_NAME)),R=b.prereadTypes.filter(E=>!fde.has(E));R.length&&r.logger.warn(`Preread hooks for some types (${R.join()}), requested by extension ${b.extensionName}, are unsupported. Please file an issue or a PR.`);for(const E of b.readDependencies)b.install(E,r.dependencies[E])}const h=i.buffers||[];o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(ct.BUFFER)).forEach(S=>S.preread(s,ct.BUFFER)),s.buffers=h.map(S=>{const b=o.createBuffer(S.name);return S.extras&&b.setExtras(S.extras),S.uri&&S.uri.indexOf("__")!==0&&b.setURI(S.uri),b});const f=i.bufferViews||[];s.bufferViewBuffers=f.map((S,b)=>{if(!s.bufferViews[b]){const R=e.json.buffers[S.buffer],E=R.uri?e.resources[R.uri]:e.resources[uE],A=S.byteOffset||0;s.bufferViews[b]=rn.toView(E,A,S.byteLength)}return s.buffers[S.buffer]});const m=i.accessors||[];s.accessors=m.map(S=>{const b=s.bufferViewBuffers[S.bufferView],R=o.createAccessor(S.name,b).setType(S.type);return S.extras&&R.setExtras(S.extras),S.normalized!==void 0&&R.setNormalized(S.normalized),S.bufferView===void 0||R.setArray(lw(S,s)),R});const g=i.images||[],_=i.textures||[];o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(ct.TEXTURE)).forEach(S=>S.preread(s,ct.TEXTURE)),s.textures=g.map(S=>{const b=o.createTexture(S.name);if(S.extras&&b.setExtras(S.extras),S.bufferView!==void 0){const R=i.bufferViews[S.bufferView],E=e.json.buffers[R.buffer],A=E.uri?e.resources[E.uri]:e.resources[uE],F=R.byteOffset||0,D=R.byteLength,M=A.slice(F,F+D);b.setImage(M)}else S.uri!==void 0&&(b.setImage(e.resources[S.uri]),S.uri.indexOf("__")!==0&&b.setURI(S.uri));if(S.mimeType!==void 0)b.setMimeType(S.mimeType);else if(S.uri){const R=Mm.extension(S.uri);b.setMimeType(Vd.extensionToMimeType(R))}return b}),o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(ct.MATERIAL)).forEach(S=>S.preread(s,ct.MATERIAL));const v=i.materials||[];s.materials=v.map(S=>{const b=o.createMaterial(S.name);S.extras&&b.setExtras(S.extras),S.alphaMode!==void 0&&b.setAlphaMode(S.alphaMode),S.alphaCutoff!==void 0&&b.setAlphaCutoff(S.alphaCutoff),S.doubleSided!==void 0&&b.setDoubleSided(S.doubleSided);const R=S.pbrMetallicRoughness||{};if(R.baseColorFactor!==void 0&&b.setBaseColorFactor(R.baseColorFactor),S.emissiveFactor!==void 0&&b.setEmissiveFactor(S.emissiveFactor),R.metallicFactor!==void 0&&b.setMetallicFactor(R.metallicFactor),R.roughnessFactor!==void 0&&b.setRoughnessFactor(R.roughnessFactor),R.baseColorTexture!==void 0){const E=R.baseColorTexture,A=s.textures[_[E.index].source];b.setBaseColorTexture(A),s.setTextureInfo(b.getBaseColorTextureInfo(),E)}if(S.emissiveTexture!==void 0){const E=S.emissiveTexture,A=s.textures[_[E.index].source];b.setEmissiveTexture(A),s.setTextureInfo(b.getEmissiveTextureInfo(),E)}if(S.normalTexture!==void 0){const E=S.normalTexture,A=s.textures[_[E.index].source];b.setNormalTexture(A),s.setTextureInfo(b.getNormalTextureInfo(),E),S.normalTexture.scale!==void 0&&b.setNormalScale(S.normalTexture.scale)}if(S.occlusionTexture!==void 0){const E=S.occlusionTexture,A=s.textures[_[E.index].source];b.setOcclusionTexture(A),s.setTextureInfo(b.getOcclusionTextureInfo(),E),S.occlusionTexture.strength!==void 0&&b.setOcclusionStrength(S.occlusionTexture.strength)}if(R.metallicRoughnessTexture!==void 0){const E=R.metallicRoughnessTexture,A=s.textures[_[E.index].source];b.setMetallicRoughnessTexture(A),s.setTextureInfo(b.getMetallicRoughnessTextureInfo(),E)}return b}),o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(ct.MESH)).forEach(S=>S.preread(s,ct.MESH));const p=i.meshes||[];o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(ct.PRIMITIVE)).forEach(S=>S.preread(s,ct.PRIMITIVE)),s.meshes=p.map(S=>{const b=o.createMesh(S.name);return S.extras&&b.setExtras(S.extras),S.weights!==void 0&&b.setWeights(S.weights),(S.primitives||[]).forEach(E=>{const A=o.createPrimitive();E.extras&&A.setExtras(E.extras),E.material!==void 0&&A.setMaterial(s.materials[E.material]),E.mode!==void 0&&A.setMode(E.mode);for(const[M,k]of Object.entries(E.attributes||{}))A.setAttribute(M,s.accessors[k]);E.indices!==void 0&&A.setIndices(s.accessors[E.indices]);const F=S.extras&&S.extras.targetNames||[];(E.targets||[]).forEach((M,k)=>{const z=F[k]||k.toString(),P=o.createPrimitiveTarget(z);for(const[U,Y]of Object.entries(M))P.setAttribute(U,s.accessors[Y]);A.addTarget(P)}),b.addPrimitive(A)}),b});const x=i.cameras||[];s.cameras=x.map(S=>{const b=o.createCamera(S.name).setType(S.type);if(S.extras&&b.setExtras(S.extras),S.type===Mh.Type.PERSPECTIVE){const R=S.perspective;b.setYFov(R.yfov),b.setZNear(R.znear),R.zfar!==void 0&&b.setZFar(R.zfar),R.aspectRatio!==void 0&&b.setAspectRatio(R.aspectRatio)}else{const R=S.orthographic;b.setZNear(R.znear).setZFar(R.zfar).setXMag(R.xmag).setYMag(R.ymag)}return b});const y=i.nodes||[];o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(ct.NODE)).forEach(S=>S.preread(s,ct.NODE)),s.nodes=y.map(S=>{const b=o.createNode(S.name);if(S.extras&&b.setExtras(S.extras),S.translation!==void 0&&b.setTranslation(S.translation),S.rotation!==void 0&&b.setRotation(S.rotation),S.scale!==void 0&&b.setScale(S.scale),S.matrix!==void 0){const R=[0,0,0],E=[0,0,0,1],A=[1,1,1];Jn.decompose(S.matrix,R,E,A),b.setTranslation(R),b.setRotation(E),b.setScale(A)}return S.weights!==void 0&&b.setWeights(S.weights),b});const w=i.skins||[];s.skins=w.map(S=>{const b=o.createSkin(S.name);S.extras&&b.setExtras(S.extras),S.inverseBindMatrices!==void 0&&b.setInverseBindMatrices(s.accessors[S.inverseBindMatrices]),S.skeleton!==void 0&&b.setSkeleton(s.nodes[S.skeleton]);for(const R of S.joints)b.addJoint(s.nodes[R]);return b}),y.map((S,b)=>{const R=s.nodes[b];(S.children||[]).forEach(A=>R.addChild(s.nodes[A])),S.mesh!==void 0&&R.setMesh(s.meshes[S.mesh]),S.camera!==void 0&&R.setCamera(s.cameras[S.camera]),S.skin!==void 0&&R.setSkin(s.skins[S.skin])});const C=i.animations||[];s.animations=C.map(S=>{const b=o.createAnimation(S.name);S.extras&&b.setExtras(S.extras);const E=(S.samplers||[]).map(F=>{const D=o.createAnimationSampler().setInput(s.accessors[F.input]).setOutput(s.accessors[F.output]).setInterpolation(F.interpolation||g_.Interpolation.LINEAR);return F.extras&&D.setExtras(F.extras),b.addSampler(D),D});return(S.channels||[]).forEach(F=>{const D=o.createAnimationChannel().setSampler(E[F.sampler]).setTargetPath(F.target.path);F.target.node!==void 0&&D.setTargetNode(s.nodes[F.target.node]),F.extras&&D.setExtras(F.extras),b.addChannel(D)}),b});const T=i.scenes||[];return o.getRoot().listExtensionsUsed().filter(S=>S.prereadTypes.includes(ct.SCENE)).forEach(S=>S.preread(s,ct.SCENE)),s.scenes=T.map(S=>{const b=o.createScene(S.name);return S.extras&&b.setExtras(S.extras),(S.nodes||[]).map(E=>s.nodes[E]).forEach(E=>b.addChild(E)),b}),i.scene!==void 0&&o.getRoot().setDefaultScene(s.scenes[i.scene]),o.getRoot().listExtensionsUsed().forEach(S=>S.read(s)),m.forEach((S,b)=>{const R=s.accessors[b],E=!!S.sparse,A=!S.bufferView&&!R.getArray();(E||A)&&R.setSparse(!0).setArray(gde(S,s))}),o}static validate(e,t){const r=e.json;if(r.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${r.asset.version}".`);if(r.extensionsRequired){for(const i of r.extensionsRequired)if(!t.extensions.find(o=>o.EXTENSION_NAME===i))throw new Error(`Missing required extension, "${i}".`)}if(r.extensionsUsed)for(const i of r.extensionsUsed)t.extensions.find(o=>o.EXTENSION_NAME===i)||t.logger.warn(`Missing optional extension, "${i}".`)}}function mde(n,e){const t=e.jsonDoc,r=e.bufferViews[n.bufferView],i=t.json.bufferViews[n.bufferView],o=R1[n.componentType],s=At.getElementSize(n.type),a=o.BYTES_PER_ELEMENT,l=n.byteOffset||0,c=new o(n.count*s),u=new DataView(r.buffer,r.byteOffset,r.byteLength),h=i.byteStride;for(let f=0;f<n.count;f++)for(let m=0;m<s;m++){const g=l+f*h+m*a;let _;switch(n.componentType){case At.ComponentType.FLOAT:_=u.getFloat32(g,!0);break;case At.ComponentType.UNSIGNED_INT:_=u.getUint32(g,!0);break;case At.ComponentType.UNSIGNED_SHORT:_=u.getUint16(g,!0);break;case At.ComponentType.UNSIGNED_BYTE:_=u.getUint8(g);break;case At.ComponentType.SHORT:_=u.getInt16(g,!0);break;case At.ComponentType.BYTE:_=u.getInt8(g);break;default:throw new Error(`Unexpected componentType "${n.componentType}".`)}c[f*s+m]=_}return c}function lw(n,e){const t=e.jsonDoc,r=e.bufferViews[n.bufferView],i=t.json.bufferViews[n.bufferView],o=R1[n.componentType],s=At.getElementSize(n.type),a=o.BYTES_PER_ELEMENT,l=s*a;if(i.byteStride!==void 0&&i.byteStride!==l)return mde(n,e);const c=r.byteOffset+(n.byteOffset||0),u=n.count*s*a;return new o(r.buffer.slice(c,c+u))}function gde(n,e){const t=R1[n.componentType],r=At.getElementSize(n.type);let i;n.bufferView!==void 0?i=lw(n,e):i=new t(n.count*r);const o=n.sparse;if(!o)return i;const s=o.count,a=Ri({},n,o.indices,{count:s,type:"SCALAR"}),l=Ri({},n,o.values,{count:s}),c=lw(a,e),u=lw(l,e);for(let h=0;h<a.count;h++)for(let f=0;f<r;f++)i[c[h]*r+f]=u[h*r+f];return i}var zv;(function(n){n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(zv||(zv={}));class Gd{constructor(e,t,r){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=t,this.options=r;const i=e.getRoot(),o=i.listBuffers().length,s=i.listTextures().length;this.bufferURIGenerator=new XU(o>1,()=>r.basename||"buffer"),this.imageURIGenerator=new XU(s>1,a=>vde(e,a)||r.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const r={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},i=JSON.stringify(r);this.samplerDefIndexMap.has(i)||(this.samplerDefIndexMap.set(i,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(r));const o={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(i)},s=JSON.stringify(o);this.textureDefIndexMap.has(s)||(this.textureDefIndexMap.set(s,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(o));const a={index:this.textureDefIndexMap.get(s)};return t.getTexCoord()!==0&&(a.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(a.extras=t.getExtras()),this.textureInfoDefMap.set(t,a),a}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(i=>i.getName()==="attributes"&&i.getAttributes().key==="POSITION"||i.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,r){if(this.options.format===Hd.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const i=Vd.mimeTypeToExtension(r.getMimeType());e.uri=this.imageURIGenerator.createURI(r,i),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this._accessorUsageMap.get(e);if(t)return t;if(e.getSparse())return Lo.SPARSE;for(const r of this._doc.getGraph().listParentEdges(e)){const{usage:i}=r.getAttributes();if(i)return i;r.getParent().propertyType!==ct.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${r.getName()}".`)}return Lo.OTHER}addAccessorToUsageGroup(e,t){const r=this._accessorUsageMap.get(e);if(r&&r!==t)throw new Error(`Accessor with usage "${r}" cannot be reused as "${t}".`);return this._accessorUsageMap.set(e,t),this}}Gd.BufferViewTarget=zv;Gd.BufferViewUsage=Lo;Gd.USAGE_TO_TARGET={[Lo.ARRAY_BUFFER]:zv.ARRAY_BUFFER,[Lo.ELEMENT_ARRAY_BUFFER]:zv.ELEMENT_ARRAY_BUFFER};class XU{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const r=this.basename(e);return this.counter[r]=this.counter[r]||1,`${r}_${this.counter[r]++}.${t}`}else return`${this.basename(e)}.${t}`}}function vde(n,e){const t=n.getGraph().listParentEdges(e).find(r=>r.getParent()!==n.getRoot());return t?t.getName().replace(/texture$/i,""):""}const{BufferViewUsage:ay}=Gd,{UNSIGNED_INT:_de,UNSIGNED_SHORT:xde,UNSIGNED_BYTE:yde}=At.ComponentType,wde=new Set([ct.ACCESSOR,ct.BUFFER,ct.MATERIAL,ct.MESH]);let Sde=class{static write(e,t){const r=e.getGraph(),i=e.getRoot(),o={asset:Ri({generator:`glTF-Transform ${x7}`},i.getAsset()),extras:Ri({},i.getExtras())},s={json:o,resources:{}},a=new Gd(e,s,t),l=t.logger||ts.DEFAULT_INSTANCE,c=new Set(t.extensions.map(p=>p.EXTENSION_NAME)),u=e.getRoot().listExtensionsUsed().filter(p=>c.has(p.extensionName)).sort((p,x)=>p.extensionName>x.extensionName?1:-1),h=e.getRoot().listExtensionsRequired().filter(p=>c.has(p.extensionName)).sort((p,x)=>p.extensionName>x.extensionName?1:-1);u.length<e.getRoot().listExtensionsUsed().length&&l.warn("Some extensions were not registered for I/O, and will not be written.");for(const p of u){const x=p.prewriteTypes.filter(y=>!wde.has(y));x.length&&l.warn(`Prewrite hooks for some types (${x.join()}), requested by extension ${p.extensionName}, are unsupported. Please file an issue or a PR.`);for(const y of p.writeDependencies)p.install(y,t.dependencies[y])}function f(p,x,y,w){const C=[];let T=0;for(const R of p){const E=a.createAccessorDef(R);E.bufferView=o.bufferViews.length;const A=R.getArray(),F=rn.pad(rn.toView(A));E.byteOffset=T,T+=F.byteLength,C.push(F),a.accessorIndexMap.set(R,o.accessors.length),o.accessors.push(E)}const S=rn.concat(C),b={buffer:x,byteOffset:y,byteLength:S.byteLength};return w&&(b.target=w),o.bufferViews.push(b),{buffers:C,byteLength:T}}function m(p,x,y){const w=p[0].getCount();let C=0;for(const E of p){const A=a.createAccessorDef(E);A.bufferView=o.bufferViews.length,A.byteOffset=C;const F=E.getElementSize(),D=E.getComponentSize();C+=rn.padNumber(F*D),a.accessorIndexMap.set(E,o.accessors.length),o.accessors.push(A)}const T=w*C,S=new ArrayBuffer(T),b=new DataView(S);for(let E=0;E<w;E++){let A=0;for(const F of p){const D=F.getElementSize(),M=F.getComponentSize(),k=F.getComponentType(),z=F.getArray();for(let P=0;P<D;P++){const U=E*C+A+P*M,Y=z[E*D+P];switch(k){case At.ComponentType.FLOAT:b.setFloat32(U,Y,!0);break;case At.ComponentType.BYTE:b.setInt8(U,Y);break;case At.ComponentType.SHORT:b.setInt16(U,Y,!0);break;case At.ComponentType.UNSIGNED_BYTE:b.setUint8(U,Y);break;case At.ComponentType.UNSIGNED_SHORT:b.setUint16(U,Y,!0);break;case At.ComponentType.UNSIGNED_INT:b.setUint32(U,Y,!0);break;default:throw new Error("Unexpected component type: "+k)}}A+=rn.padNumber(D*M)}}const R={buffer:x,byteOffset:y,byteLength:T,byteStride:C,target:Gd.BufferViewTarget.ARRAY_BUFFER};return o.bufferViews.push(R),{byteLength:T,buffers:[new Uint8Array(S)]}}function g(p,x,y){const w=[];let C=0;const T=new Map;let S=-1/0,b=!1;for(const k of p){const z=a.createAccessorDef(k);o.accessors.push(z),a.accessorIndexMap.set(k,o.accessors.length-1);const P=[],U=[],Y=[],Z=new Array(k.getElementSize()).fill(0);for(let K=0,ee=k.getCount();K<ee;K++)if(k.getElement(K,Y),!Jn.eq(Y,Z,0)){S=Math.max(K,S),P.push(K);for(let fe=0;fe<Y.length;fe++)U.push(Y[fe])}const j=P.length,X={accessorDef:z,count:j};if(T.set(k,X),j===0)continue;j>k.getCount()/2&&(b=!0);const B=R1[k.getComponentType()];X.indices=P,X.values=new B(U)}if(!Number.isFinite(S))return{buffers:w,byteLength:C};b&&l.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const R=S<255?Uint8Array:S<65535?Uint16Array:Uint32Array,E=S<255?yde:S<65535?xde:_de,A={buffer:x,byteOffset:y+C,byteLength:0};for(const k of p){const z=T.get(k);if(z.count===0)continue;z.indicesByteOffset=A.byteLength;const P=rn.pad(rn.toView(new R(z.indices)));w.push(P),C+=P.byteLength,A.byteLength+=P.byteLength}o.bufferViews.push(A);const F=o.bufferViews.length-1,D={buffer:x,byteOffset:y+C,byteLength:0};for(const k of p){const z=T.get(k);if(z.count===0)continue;z.valuesByteOffset=D.byteLength;const P=rn.pad(rn.toView(z.values));w.push(P),C+=P.byteLength,D.byteLength+=P.byteLength}o.bufferViews.push(D);const M=o.bufferViews.length-1;for(const k of p){const z=T.get(k);z.count!==0&&(z.accessorDef.sparse={count:z.count,indices:{bufferView:F,byteOffset:z.indicesByteOffset,componentType:E},values:{bufferView:M,byteOffset:z.valuesByteOffset}})}return{buffers:w,byteLength:C}}if(o.accessors=[],o.bufferViews=[],o.samplers=[],o.textures=[],o.images=i.listTextures().map((p,x)=>{const y=a.createPropertyDef(p);p.getMimeType()&&(y.mimeType=p.getMimeType());const w=p.getImage();return w&&a.createImageData(y,w,p),a.imageIndexMap.set(p,x),y}),u.filter(p=>p.prewriteTypes.includes(ct.ACCESSOR)).forEach(p=>p.prewrite(a,ct.ACCESSOR)),i.listAccessors().forEach(p=>{const x=a.accessorUsageGroupedByParent,y=a.accessorParents;if(a.accessorIndexMap.has(p))return;const w=a.getAccessorUsage(p);if(a.addAccessorToUsageGroup(p,w),x.has(w)){const C=r.listParents(p).find(T=>T.propertyType!==ct.ROOT);y.set(p,C)}}),u.filter(p=>p.prewriteTypes.includes(ct.BUFFER)).forEach(p=>p.prewrite(a,ct.BUFFER)),(i.listAccessors().length>0||i.listTextures().length>0||a.otherBufferViews.size>0)&&i.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");o.buffers=[],i.listBuffers().forEach((p,x)=>{const y=a.createPropertyDef(p),w=a.accessorUsageGroupedByParent,C=p.listParents().filter(D=>D instanceof At),T=new Set(C.map(D=>a.accessorParents.get(D))),S=new Map(Array.from(T).map((D,M)=>[D,M])),b={};for(const D of C){var R;if(a.accessorIndexMap.has(D))continue;const M=a.getAccessorUsage(D);let k=M;if(w.has(M)){const z=a.accessorParents.get(D);k+=`:${S.get(z)}`}b[R=k]||(b[R]={usage:M,accessors:[]}),b[k].accessors.push(D)}const E=[],A=o.buffers.length;let F=0;for(const{usage:D,accessors:M}of Object.values(b))if(D===ay.ARRAY_BUFFER&&t.vertexLayout===dE.INTERLEAVED){const k=m(M,A,F);F+=k.byteLength,E.push(...k.buffers)}else if(D===ay.ARRAY_BUFFER)for(const k of M){const z=m([k],A,F);F+=z.byteLength,E.push(...z.buffers)}else if(D===ay.SPARSE){const k=g(M,A,F);F+=k.byteLength,E.push(...k.buffers)}else if(D===ay.ELEMENT_ARRAY_BUFFER){const k=Gd.BufferViewTarget.ELEMENT_ARRAY_BUFFER,z=f(M,A,F,k);F+=z.byteLength,E.push(...z.buffers)}else{const k=f(M,A,F);F+=k.byteLength,E.push(...k.buffers)}if(a.imageBufferViews.length&&x===0){for(let D=0;D<a.imageBufferViews.length;D++)if(o.bufferViews[o.images[D].bufferView].byteOffset=F,F+=a.imageBufferViews[D].byteLength,E.push(a.imageBufferViews[D]),F%8){const M=8-F%8;F+=M,E.push(new Uint8Array(M))}}if(a.otherBufferViews.has(p))for(const D of a.otherBufferViews.get(p))o.bufferViews.push({buffer:A,byteOffset:F,byteLength:D.byteLength}),a.otherBufferViewsIndexMap.set(D,o.bufferViews.length-1),F+=D.byteLength,E.push(D);if(F){let D;t.format===Hd.GLB?D=uE:(D=a.bufferURIGenerator.createURI(p,"bin"),y.uri=D),y.byteLength=F,s.resources[D]=rn.concat(E)}o.buffers.push(y),a.bufferIndexMap.set(p,x)}),i.listAccessors().find(p=>!p.getBuffer())&&l.warn("Skipped writing one or more Accessors: no Buffer assigned."),u.filter(p=>p.prewriteTypes.includes(ct.MATERIAL)).forEach(p=>p.prewrite(a,ct.MATERIAL)),o.materials=i.listMaterials().map((p,x)=>{const y=a.createPropertyDef(p);if(p.getAlphaMode()!==lh.AlphaMode.OPAQUE&&(y.alphaMode=p.getAlphaMode()),p.getAlphaMode()===lh.AlphaMode.MASK&&(y.alphaCutoff=p.getAlphaCutoff()),p.getDoubleSided()&&(y.doubleSided=!0),y.pbrMetallicRoughness={},Jn.eq(p.getBaseColorFactor(),[1,1,1,1])||(y.pbrMetallicRoughness.baseColorFactor=p.getBaseColorFactor()),Jn.eq(p.getEmissiveFactor(),[0,0,0])||(y.emissiveFactor=p.getEmissiveFactor()),p.getRoughnessFactor()!==1&&(y.pbrMetallicRoughness.roughnessFactor=p.getRoughnessFactor()),p.getMetallicFactor()!==1&&(y.pbrMetallicRoughness.metallicFactor=p.getMetallicFactor()),p.getBaseColorTexture()){const w=p.getBaseColorTexture(),C=p.getBaseColorTextureInfo();y.pbrMetallicRoughness.baseColorTexture=a.createTextureInfoDef(w,C)}if(p.getEmissiveTexture()){const w=p.getEmissiveTexture(),C=p.getEmissiveTextureInfo();y.emissiveTexture=a.createTextureInfoDef(w,C)}if(p.getNormalTexture()){const w=p.getNormalTexture(),C=p.getNormalTextureInfo(),T=a.createTextureInfoDef(w,C);p.getNormalScale()!==1&&(T.scale=p.getNormalScale()),y.normalTexture=T}if(p.getOcclusionTexture()){const w=p.getOcclusionTexture(),C=p.getOcclusionTextureInfo(),T=a.createTextureInfoDef(w,C);p.getOcclusionStrength()!==1&&(T.strength=p.getOcclusionStrength()),y.occlusionTexture=T}if(p.getMetallicRoughnessTexture()){const w=p.getMetallicRoughnessTexture(),C=p.getMetallicRoughnessTextureInfo();y.pbrMetallicRoughness.metallicRoughnessTexture=a.createTextureInfoDef(w,C)}return a.materialIndexMap.set(p,x),y}),u.filter(p=>p.prewriteTypes.includes(ct.MESH)).forEach(p=>p.prewrite(a,ct.MESH)),o.meshes=i.listMeshes().map((p,x)=>{const y=a.createPropertyDef(p);let w=null;return y.primitives=p.listPrimitives().map(C=>{const T={attributes:{}};T.mode=C.getMode();const S=C.getMaterial();S&&(T.material=a.materialIndexMap.get(S)),Object.keys(C.getExtras()).length&&(T.extras=C.getExtras());const b=C.getIndices();b&&(T.indices=a.accessorIndexMap.get(b));for(const R of C.listSemantics())T.attributes[R]=a.accessorIndexMap.get(C.getAttribute(R));for(const R of C.listTargets()){const E={};for(const A of R.listSemantics())E[A]=a.accessorIndexMap.get(R.getAttribute(A));T.targets=T.targets||[],T.targets.push(E)}return C.listTargets().length&&!w&&(w=C.listTargets().map(R=>R.getName())),T}),p.getWeights().length&&(y.weights=p.getWeights()),w&&(y.extras=y.extras||{},y.extras.targetNames=w),a.meshIndexMap.set(p,x),y}),o.cameras=i.listCameras().map((p,x)=>{const y=a.createPropertyDef(p);if(y.type=p.getType(),y.type===Mh.Type.PERSPECTIVE){y.perspective={znear:p.getZNear(),zfar:p.getZFar(),yfov:p.getYFov()};const w=p.getAspectRatio();w!==null&&(y.perspective.aspectRatio=w)}else y.orthographic={znear:p.getZNear(),zfar:p.getZFar(),xmag:p.getXMag(),ymag:p.getYMag()};return a.cameraIndexMap.set(p,x),y}),o.nodes=i.listNodes().map((p,x)=>{const y=a.createPropertyDef(p);return Jn.eq(p.getTranslation(),[0,0,0])||(y.translation=p.getTranslation()),Jn.eq(p.getRotation(),[0,0,0,1])||(y.rotation=p.getRotation()),Jn.eq(p.getScale(),[1,1,1])||(y.scale=p.getScale()),p.getWeights().length&&(y.weights=p.getWeights()),a.nodeIndexMap.set(p,x),y}),o.skins=i.listSkins().map((p,x)=>{const y=a.createPropertyDef(p),w=p.getInverseBindMatrices();w&&(y.inverseBindMatrices=a.accessorIndexMap.get(w));const C=p.getSkeleton();return C&&(y.skeleton=a.nodeIndexMap.get(C)),y.joints=p.listJoints().map(T=>a.nodeIndexMap.get(T)),a.skinIndexMap.set(p,x),y}),i.listNodes().forEach((p,x)=>{const y=o.nodes[x],w=p.getMesh();w&&(y.mesh=a.meshIndexMap.get(w));const C=p.getCamera();C&&(y.camera=a.cameraIndexMap.get(C));const T=p.getSkin();T&&(y.skin=a.skinIndexMap.get(T)),p.listChildren().length>0&&(y.children=p.listChildren().map(S=>a.nodeIndexMap.get(S)))}),o.animations=i.listAnimations().map((p,x)=>{const y=a.createPropertyDef(p),w=new Map;return y.samplers=p.listSamplers().map((C,T)=>{const S=a.createPropertyDef(C);return S.input=a.accessorIndexMap.get(C.getInput()),S.output=a.accessorIndexMap.get(C.getOutput()),S.interpolation=C.getInterpolation(),w.set(C,T),S}),y.channels=p.listChannels().map(C=>{const T=a.createPropertyDef(C);return T.sampler=w.get(C.getSampler()),T.target={node:a.nodeIndexMap.get(C.getTargetNode()),path:C.getTargetPath()},T}),a.animationIndexMap.set(p,x),y}),o.scenes=i.listScenes().map((p,x)=>{const y=a.createPropertyDef(p);return y.nodes=p.listChildren().map(w=>a.nodeIndexMap.get(w)),a.sceneIndexMap.set(p,x),y});const v=i.getDefaultScene();return v&&(o.scene=i.listScenes().indexOf(v)),o.extensionsUsed=u.map(p=>p.extensionName),o.extensionsRequired=h.map(p=>p.extensionName),u.forEach(p=>p.write(a)),Ede(o),s}};function Ede(n){const e=[];for(const t in n){const r=n[t];(Array.isArray(r)&&r.length===0||r===null||r===""||r&&typeof r=="object"&&Object.keys(r).length===0)&&e.push(t)}for(const t of e)delete n[t]}var fE;(function(n){n[n.JSON=1313821514]="JSON",n[n.BIN=5130562]="BIN"})(fE||(fE={}));class Tde{constructor(){this._logger=ts.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=dE.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const t of e)this._extensions.add(t),t.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const r=qU(t)?this._binaryToJSON(t):{json:JSON.parse(rn.decodeText(t)),resources:{}};return await this._readResourcesExternal(r,this.dirname(e)),this._readResourcesInternal(r),r}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),pde.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const t=this._binaryToJSON(rn.assertView(e));this._readResourcesInternal(t);const r=t.json;if(r.buffers&&r.buffers.some(i=>Cde(t,i)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(r.images&&r.images.some(i=>bde(t,i)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(rn.assertView(e)))}async writeJSON(e,t={}){if(t.format===Hd.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return Sde.write(e,{format:t.format||Hd.GLTF,basename:t.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:Ri({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:t,resources:r}=await this.writeJSON(e,{format:Hd.GLB}),i=new Uint32Array([1179937895,2,12]),o=JSON.stringify(t),s=rn.pad(rn.encodeText(o),32),a=rn.toView(new Uint32Array([s.byteLength,1313821514])),l=rn.concat([a,s]);i[i.length-1]+=l.byteLength;const c=Object.values(r)[0];if(!c||!c.byteLength)return rn.concat([rn.toView(i),l]);const u=rn.pad(c,0),h=rn.toView(new Uint32Array([u.byteLength,5130562])),f=rn.concat([h,u]);return i[i.length-1]+=f.byteLength,rn.concat([rn.toView(i),l,f])}async _readResourcesExternal(e,t){var r=this;const i=e.json.images||[],o=e.json.buffers||[],s=[...i,...o].map(async function(a){const l=a.uri;if(!l||l.match(/data:/))return Promise.resolve();e.resources[l]=await r.readURI(r.resolve(t,l),"view"),r.lastReadBytes+=e.resources[l].byteLength});await Promise.all(s)}_readResourcesInternal(e){function t(o){if(o.uri){if(o.uri in e.resources){rn.assertView(e.resources[o.uri]);return}if(o.uri.match(/data:/)){const s=`__${ode()}.${Mm.extension(o.uri)}`;e.resources[s]=rn.createBufferFromDataURI(o.uri),o.uri=s}}}(e.json.images||[]).forEach(o=>{if(o.bufferView===void 0&&o.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(o)}),(e.json.buffers||[]).forEach(t)}_copyJSON(e){const{images:t,buffers:r}=e.json;return e={json:Ri({},e.json),resources:Ri({},e.resources)},t&&(e.json.images=t.map(i=>Ri({},i))),r&&(e.json.buffers=r.map(i=>Ri({},i))),e}_binaryToJSON(e){if(!qU(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==fE.JSON)throw new Error("Missing required GLB JSON chunk.");const r=20,i=t[0],o=rn.decodeText(rn.toView(e,r,i)),s=JSON.parse(o),a=r+i;if(e.byteLength<=a)return{json:s,resources:{}};const l=new Uint32Array(e.buffer,e.byteOffset+a,2);if(l[1]!==fE.BIN)return{json:s,resources:{}};const c=l[0],u=rn.toView(e,a+8,c);return{json:s,resources:{[uE]:u}}}}function Cde(n,e){return e.uri!==void 0&&!(e.uri in n.resources)}function bde(n,e){return e.uri!==void 0&&!(e.uri in n.resources)&&e.bufferView===void 0}function qU(n){if(n.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(n.buffer,n.byteOffset,3);return e[0]===1179937895&&e[1]===2}class Ade extends Tde{constructor(e=J0.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=e}async readURI(e,t){const r=await fetch(e,this._fetchConfig);switch(t){case"view":return new Uint8Array(await r.arrayBuffer());case"text":return r.text()}}resolve(e,t){return J0.resolve(e,t)}dirname(e){return J0.dirname(e)}}function P1(n){return`META_${n}`}function N7(n){var t,r;const e=(t=n==null?void 0:n.json)==null?void 0:t.scenes;return Array.isArray(e)&&e.length>0?(r=e[0].extras)==null?void 0:r.meta:null}function I7(n,e,t){const r=e.byteOffset||0,i=t.byteOffset||0,o=r+i,s=t.componentType===5125?4:2,a=s*t.count;if(s===2){const l=new Uint16Array(n.slice(o,o+a).buffer),c=new Uint32Array(l.length);for(let u=0;u<l.length;u++)c[u]=l[u];return c}else return new Uint32Array(n.slice(o,o+a).buffer)}function P7(n,e,t){const r=e.byteOffset||0,i=t.byteOffset||0,o=r+i,a=4*(t.count*3);return new Float32Array(n.slice(o,o+a).buffer)}function k7(n,e){const t=new Set,r=new dt().makeRotationX(Math.PI/2).toArray();for(let i=0;i<n.length;i++){const o=n[i]*3;if(t.has(o))continue;const s=e[o],a=e[o+1],l=e[o+2],c=1/(r[3]*s+r[7]*a+r[11]*l+r[15]),u=(r[0]*s+r[4]*a+r[8]*l+r[12])/c,h=(r[1]*s+r[5]*a+r[9]*l+r[13])/c,f=(r[2]*s+r[6]*a+r[10]*l+r[14])/c;e[o]=u,e[o+1]=h,e[o+2]=f,t.add(o)}}function Mde(n,e,t){const r=[];function i(s){var l,c,u,h,f,m;let a=s.json.scene||0;return(l=s.json.scenes)!=null&&l.length&&s.json.scenes[0]&&((c=s.json.scenes[0].nodes)!=null&&c.length)&&s.json.scenes[0].nodes[0]&&(a=s.json.scenes[0].nodes[0]),(h=(u=s==null?void 0:s.json)==null?void 0:u.nodes)!=null&&h.length&&((f=s==null?void 0:s.json)!=null&&f.nodes[a])?(m=s==null?void 0:s.json)==null?void 0:m.nodes[a]:(console.error("no main node found"),{})}const o=i(n);return Array.isArray(o.children)&&o.children.forEach(s=>{var b,R,E,A,F;const a=n.json.nodes&&n.json.nodes[s];if(!a||a.mesh===void 0)return;const l=n.json.meshes&&n.json.meshes[a.mesh];if(!l)return;const c=((b=a.name)==null?void 0:b.replace("node",""))||"";if(c==="")return;const u=parseInt(c);u===void 0&&console.warn("unexpected reult for nodename");const h=l.primitives[0].material;if(u!==h&&console.warn("test",u,h),h===void 0)return;const f=l.primitives[0].indices;if(f===void 0)return;const m=l.primitives[0].attributes.POSITION,g=n.json.accessors&&n.json.accessors[f];if(g===void 0||g.bufferView===void 0)return;const _=n.json.accessors&&n.json.accessors[m];if(_===void 0||_.bufferView===void 0)return;const v=n.json.bufferViews&&n.json.bufferViews[g.bufferView];if(!v)return;const p=n.json.bufferViews&&n.json.bufferViews[_.bufferView];if(!p)return;const y=((A=(((R=n==null?void 0:n.json)==null?void 0:R.materials)&&((E=n==null?void 0:n.json)==null?void 0:E.materials[h])||{}).pbrMetallicRoughness)==null?void 0:A.baseColorFactor)||[1,1,1,1],w=n.resources["@glb.bin"],C=I7(w,v,g),T=P7(w,p,_);if(!C.length){console.log("missing index",e,t,s);return}if(!T.length){console.log("missing position",e,t,s);return}k7(C,T);const S=((F=n.json.scenes)==null?void 0:F.length)&&n.json.scenes[0].extras&&n.json.scenes[0].extras[`id_sequence${u}`];if(!S){console.log("missing id sequence",e,t,`id_sequence${u}`,s);return}r.push({position:T,index:C,color:y,id_sequence:S,indexdbKey:er()})}),r}function Hk(n){const e={x:null,y:null,z:null},t={x:null,y:null,z:null};let r=0;for(;r<n.length;)for(let i=0;i<3;i++,r++){const o=n[r]||0;i===0&&(e.x===null&&(e.x=o),t.x===null&&(t.x=o),e.x<o&&(e.x=o),t.x>o&&(t.x=o)),i===1&&(e.y===null&&(e.y=o),t.y===null&&(t.y=o),e.y<o&&(e.y=o),t.y>o&&(t.y=o)),i===2&&(e.z===null&&(e.z=o),t.z===null&&(t.z=o),e.z<o&&(e.z=o),t.z>o&&(t.z=o))}return{X:e.x||0,Y:e.y||0,Z:e.z||0,x:t.x||0,y:t.y||0,z:t.z||0}}function Rde(n,e,t,r,i){Object.keys(i).forEach(s=>{const a=[],[l,c]=i[s];for(let u=l;u<c+1;u++){const h=t[u]*3;a.push(r[h]),a.push(r[h+1]),a.push(r[h+2])}n.add(s),e[s]=Hk(a)})}function Nde(n,e){let t=!0;for(;t&&n;){const r=new Set;Object.keys(n).forEach(o=>{const s=n[o];r.add(s[1])});let i=0;Object.keys(n).forEach(o=>{!r.has(o)&&!e.has(o)&&(i++,delete n[o])}),i===0&&(t=!1)}}function k1(n){return`${n}_ALL_KEYS`}async function Ide(n,e,t,r,i=null){try{const o=new Oi(n),s=[],a=[],l=new Set,c={},u=k1(t);o.getJsonKey(u).then(C=>{Array.isArray(C)&&C.forEach(T=>{o.deleteKey(T)})});const h=N7(r);if(!h)return console.log("Missing expected glb meta",e,t),null;const f=Mde(r,e,t),m={};for(let C=0;C<f.length;C++){const T=f[C];Rde(l,c,T.index,T.position,T.id_sequence);const S=T.index,b=o.getUUID();await o.setBufferKey(b,S.buffer),T.index=b,a.push(b);const R=T.position,E=o.getUUID();await o.setBufferKey(E,R.buffer),T.position=E,a.push(E),s.push(T.indexdbKey),a.push(T.indexdbKey),m[b]={indexdb_key:T.indexdbKey,index:b,color:T.color,position:E,id_sequence:structuredClone(T.id_sequence)},T.id_sequence=null,await o.setJsonKey(T.indexdbKey,T)}Nde(h,l);const g=Object.keys(h),_=[],v=new Map;let p=0;i?(v.set("*",1),p++):v.set("*",0),g.forEach(C=>{const T=c[C],S=h[C];let b,R;const E=S[0],A=S[1];v.has(C)?b=v.get(C):(p++,b=p,v.set(C,p)),v.has(A)?R=v.get(A):(p++,R=p,v.set(A,p)),_.push([b,E,R,T==null?void 0:T.x,T==null?void 0:T.y,T==null?void 0:T.z,T==null?void 0:T.X,T==null?void 0:T.Y,T==null?void 0:T.Z])}),i&&_.unshift([1,i,0,void 0,void 0,void 0,void 0,void 0,void 0]);const x={group_name:t,meshes:m,group_ref:_};Object.keys(x.meshes).forEach(C=>{const T=x.meshes[C];Object.keys(T.id_sequence).forEach(b=>{let R;v.has(b)?R=v.get(b):(p++,R=p,v.set(b,p)),T.id_sequence[R]=T.id_sequence[b],delete T.id_sequence[b]})});const w=new TextEncoder().encode(JSON.stringify(x));return await o.setBufferKey(P1(t),w),await o.setJsonKey(t,s),await o.setJsonKey(u,a),await o.close(),t}catch(o){return console.error("error",t,o),null}}function Pde(n){return n.json.nodes&&n.json.nodes||[]}function kde(n){return n.json.meshes&&n.json.meshes||[]}function Lde(n){return n.json.materials&&n.json.materials||[]}function QU(n){return n.json.accessors&&n.json.accessors||[]}function ZU(n){return n.json.bufferViews&&n.json.bufferViews||[]}function JU(n){return n.json.buffers&&n.json.buffers||[]}function e4(n,e){const t=Object.keys(n.resources);if(t.length===1)return n.resources[t[0]];for(const r in n.resources)if(n.resources[r],n.resources[r].length===e)return n.resources[r]}function Ode(n,e){var r,i,o,s,a,l,c;let t=null;if((r=n.matrix)!=null&&r.length)t=new dt().fromArray(n.matrix);else if((i=n.scale)!=null&&i.length||(o=n.rotation)!=null&&o.length||(s=n.translation)!=null&&s.length){let u=new N(1,1,1),h=new N,f=new Hn;(a=n.scale)!=null&&a.length&&(u=new N(n.scale[0],n.scale[1],n.scale[2])),(l=n.translation)!=null&&l.length&&(h=new N(n.translation[0],n.translation[1],n.translation[2])),(c=n.rotation)!=null&&c.length&&(f=new Hn(n.rotation[0],n.rotation[1],n.rotation[2],n.rotation[3]));const m=new dt().makeScale(u.x,u.y,u.z),g=new dt().makeTranslation(h.x,h.y,h.z),_=new dt().makeRotationFromQuaternion(f);t=new dt().identity(),t=t==null?void 0:t.multiply(g),t=t==null?void 0:t.multiply(_),t=t==null?void 0:t.multiply(m)}return e&&(t?t=new dt().multiplyMatrices(e,t):t=e),t}const Dde=new dt().makeRotationX(Math.PI/2);function Ude(n,e,t,r,i,o){const s=kde(t)[n];if(!s)return;const a=i.next(),l=s.primitives.length>1,c={id:a,parent:e,name:s.name||"Mesh"+n};r.nodes.set(a,c),s.primitives.forEach((u,h)=>{var v;let f=a;if(l&&(f=i.next()),u.mode!==4&&u.mode!==void 0){console.log("dont know this mode",u.mode);return}if(u.indices===void 0){console.log("missing indecies, mesh",n,u);return}if(u.attributes.POSITION===void 0){console.log("missing positions, mesh",n,u);return}if(Array.isArray(u.targets)){console.log("dont know what target is",n,u);return}function m(p){return p===5120||p===5121?1:p===5122||p===5123?2:4}const g=Lde(t)[u.material];if(g){const p=((v=g.pbrMetallicRoughness)==null?void 0:v.baseColorFactor)||[0,0,0,1];r.materials.has(u.material)||r.materials.set(u.material,p)}else{console.log("missing material, mesh",n,u);const p=[0,0,0,1];r.materials.has(-1)||r.materials.set(-1,p),u.material=-1}let _=0;{const p=QU(t)[u.indices];if(p.bufferView===void 0){console.log("missing indicesAccessor.bufferView, mesh",n,u);return}p.type!=="SCALAR"&&console.log("index need to be scalar, mesh",n,u),p.sparse!==void 0&&console.log("accessor.sparse not supported, mesh",n,u);const x=ZU(t)[p.bufferView];x.extensions!==void 0&&console.log("bufferView.extensions not supported, mesh",n,u);const y=m(p.componentType),w=JU(t)[x.buffer];if(!w){console.log("missing indicesBufferView.buffer, mesh",n,u,x);return}const C=e4(t,w.byteLength);if(!C){console.log("missing bin, mesh",n,u,C);return}let T=[];const S=r.buffersIndex.get(u.material);S?T=S:r.buffersIndex.set(u.material,T);const b=r.appendIndexStart[u.material]||0,R=T.length;let E=0;const A=(p.byteOffset||0)+(x.byteOffset||0)+(C.byteOffset||0);for(let M=0;M<p.count;M++){const k=M*((x==null?void 0:x.byteStride)||y);let z=0;y===1&&(z=new DataView(C.buffer).getUint8(A+k)),y===2&&(z=new DataView(C.buffer).getUint16(A+k,!0)),y===4&&(z=new DataView(C.buffer).getUint32(A+k,!0)),z+b>E&&(E=z+b),T.push(z+b)}r.appendIndexStart[u.material]=E+1;let F={};const D=r.ranges.get(u.material);D?F=D:r.ranges.set(u.material,F),l?(r.nodes.set(f,{id:f,parent:a,name:s.name||"Prim"+h}),F[f]=[R,T.length-1]):F[c.id]=[R,T.length-1],_=1}if(_){const p=QU(t)[u.attributes.POSITION];if(p.bufferView===void 0){console.log("missing indicesAccessor.bufferView, mesh",n,u);return}p.type!=="VEC3"&&console.log("index need to be scalar, mesh",n,u),p.sparse!==void 0&&console.log("accessor.sparse not supported, mesh",n,u);const x=ZU(t)[p.bufferView];x.extensions!==void 0&&console.log("bufferView.extensions not supported, mesh",n,u);const y=m(p.componentType),w=JU(t)[x.buffer];if(!w){console.log("missing indicesBufferView.buffer, mesh",n,u,x);return}const C=e4(t,w.byteLength);if(!C){console.log("missing bin, mesh",n,u,C);return}let T=[];const S=r.buffersPosition.get(u.material);S?T=S:r.buffersPosition.set(u.material,T);const b=T.length,R=(p.byteOffset||0)+(x.byteOffset||0)+(C.byteOffset||0);for(let E=0;E<p.count;E++){const A=E*((x==null?void 0:x.byteStride)||y*3),F=R+A+0,D=R+A+y,M=R+A+y*2,k=new DataView(C.buffer).getFloat32(F,!0),z=new DataView(C.buffer).getFloat32(D,!0),P=new DataView(C.buffer).getFloat32(M,!0);if(o){const Y=new N(k,z,P).applyMatrix4(new dt().multiplyMatrices(Dde,o));T.push(Y.x,Y.y,Y.z)}else T.push(k,z,P)}r.bboxes[f]=Hk(T.slice(b,T.length))}})}function _N(n,e,t,r,i,o){const s=Pde(t)[n];if(!s)return;const a={id:i.next(),parent:e,name:s.name||"Node"+n};s.children&&s.mesh&&console.warn("I did not expect this..");const l=Ode(s,o);r.nodes.set(a.id,a),s.children&&s.children.forEach(c=>{_N(c,a.id,t,r,i,l)}),typeof s.mesh=="number"&&Ude(s.mesh,a.id,t,r,i,l)}class Fde{constructor(e){Se(this,"materials");Se(this,"buffersIndex");Se(this,"buffersPosition");Se(this,"ranges");Se(this,"nodes");Se(this,"appendIndexStart");Se(this,"bboxes");this.rootNode=e,this.materials=new Map,this.buffersIndex=new Map,this.appendIndexStart={},this.bboxes={},this.buffersPosition=new Map,this.nodes=new Map,this.ranges=new Map}addGroup(e,t){this.nodes.set(e,t)}}var qv;class jde{constructor(){ni(this,qv,-1)}next(){return vL(this,qv)._++,Be(this,qv)}}qv=new WeakMap;async function Bde(n,e,t,r,i){const o=new jde,s=new Fde(o.next()),a=o.next(),l={id:a,parent:s.rootNode,name:i};if(s.nodes.set(a,l),Array.isArray(r.json.scenes)&&r.json.scenes.length)r.json.scenes.forEach(x=>{x.nodes.forEach(y=>{_N(y,a,r,s,o,null)})});else{if(typeof r.json.scene!="number")return null;_N(r.json.scene,a,r,s,o,null)}const c=new Oi(n),u=[],h=[],f=k1(t),m={},g=Array.from(s.materials.keys());for(let x=0;x<g.length;x++){const y=g[x],w=c.getUUID(),C=s.materials.get(y)||[],T=s.ranges.get(y)||{},S=new Uint32Array(s.buffersIndex.get(y)||[]),b=c.getUUID();await c.setBufferKey(b,S.buffer),h.push(b);const R=new Float32Array(s.buffersPosition.get(y)||[]),E=c.getUUID();await c.setBufferKey(E,R.buffer),h.push(E),u.push(w),h.push(w),m[b]={indexdb_key:w,index:b,color:C,position:E,id_sequence:structuredClone(T)},await c.setJsonKey(w,{index:b,position:E,indexdbKey:w,color:C})}const _=[];s.nodes.forEach(x=>{var y,w,C,T,S,b;_.push([x.id,x.name,x.parent,(y=s.bboxes[x.id])==null?void 0:y.x,(w=s.bboxes[x.id])==null?void 0:w.y,(C=s.bboxes[x.id])==null?void 0:C.z,(T=s.bboxes[x.id])==null?void 0:T.X,(S=s.bboxes[x.id])==null?void 0:S.Y,(b=s.bboxes[x.id])==null?void 0:b.Z])});const v={group_name:t,meshes:m,group_ref:_},p=new TextEncoder().encode(JSON.stringify(v));return await c.setBufferKey(P1(t),p),await c.setJsonKey(t,u),await c.setJsonKey(f,h),await c.close(),t}function zde(n,e,t){var o;const r=[];return(((o=n==null?void 0:n.json)==null?void 0:o.nodes)||[]).forEach(s=>{var S,b,R,E,A;if(!s||s.mesh===void 0)return;const a=n.json.meshes&&n.json.meshes[s.mesh];if(!a)return;const l=((S=s.name)==null?void 0:S.replace("node",""))||"";if(l==="")return;const c=parseInt(l);c===void 0&&console.warn("unexpected reult for nodename");const u=a.primitives[0].material;if(c!==u&&console.warn("test",c,u),u===void 0)return;const h=a.primitives[0].indices;if(h===void 0)return;const f=a.primitives[0].attributes.POSITION,m=n.json.accessors&&n.json.accessors[h];if(m===void 0||m.bufferView===void 0)return;const g=n.json.accessors&&n.json.accessors[f];if(g===void 0||g.bufferView===void 0)return;const _=n.json.bufferViews&&n.json.bufferViews[m.bufferView];if(!_)return;const v=n.json.bufferViews&&n.json.bufferViews[g.bufferView];if(!v)return;const x=((E=(((b=n==null?void 0:n.json)==null?void 0:b.materials)&&((R=n==null?void 0:n.json)==null?void 0:R.materials[u])||{}).pbrMetallicRoughness)==null?void 0:E.baseColorFactor)||[1,1,1,1],y=n.resources["@glb.bin"],w=I7(y,_,m),C=P7(y,v,g);if(!w.length){console.log("missing index",e,t,s);return}if(!C.length){console.log("missing position",e,t,s);return}k7(w,C);const T=((A=n.json.scenes)==null?void 0:A.length)&&n.json.scenes[0].extras&&n.json.scenes[0].extras[`draw_ranges_node${c}`];if(!T){console.log("missing draw_ranges",e,t,`draw_ranges_node${c}`,s);return}r.push({position:C,index:w,color:x,draw_ranges:T,indexdbKey:er()})}),r}function Hde(n,e,t,r,i){const o=Object.keys(i),s=[];o.forEach(a=>{const l=[],[c,u]=i[a];if(!u){s.push(a);return}for(let h=c;h<c+u;h++){const f=t[h]*3;l.push(r[f]),l.push(r[f+1]),l.push(r[f+2])}n.add(a),e[a]=Hk(l)}),s.forEach(a=>{delete i[a]}),s.length&&console.warn("Removed empty nodes/count 0, on :",s.length)}async function Vde(n,e,t,r,i=null){var o,s,a,l;try{const c=new Oi(n),u=[],h=[],f=new Set,m={},g=k1(t);if(c.getJsonKey(g).then(R=>{Array.isArray(R)&&R.forEach(E=>{c.deleteKey(E)})}),!((s=(o=r==null?void 0:r.json)==null?void 0:o.scenes)!=null&&s.length))return console.log("Missing expected glb meta",e,t),null;const _=(l=(a=r==null?void 0:r.json)==null?void 0:a.scenes[0].extras)==null?void 0:l.id_hierarchy;if(!_)return console.log("Missing expected glb meta",e,t),null;const v=zde(r,e,t),p={};for(let R=0;R<v.length;R++){const E=v[R];Hde(f,m,E.index,E.position,E.draw_ranges);const A=E.index,F=c.getUUID();await c.setBufferKey(F,A.buffer),E.index=F,h.push(F);const D=E.position,M=c.getUUID();await c.setBufferKey(M,D.buffer),E.position=M,h.push(M),u.push(E.indexdbKey),h.push(E.indexdbKey),p[F]={indexdb_key:E.indexdbKey,index:F,color:E.color,position:M,id_sequence:structuredClone(E.draw_ranges)},E.draw_ranges=null,await c.setJsonKey(E.indexdbKey,E)}const x=Object.keys(_),y=[],w=new Map;let C=0;i?(w.set("*",1),C++):w.set("*",0),x.forEach(R=>{const E=m[R],A=_[R];let F,D;const M=A[0],k=A[1];w.has(R)?F=w.get(R):(C++,F=C,w.set(R,C)),w.has(k)?D=w.get(k):(C++,D=C,w.set(k,C)),y.push([F,M,D,E==null?void 0:E.x,E==null?void 0:E.y,E==null?void 0:E.z,E==null?void 0:E.X,E==null?void 0:E.Y,E==null?void 0:E.Z])}),i&&y.unshift([1,i,0,void 0,void 0,void 0,void 0,void 0,void 0]);const T={group_name:t,meshes:p,group_ref:y,version:2};Object.keys(T.meshes).forEach(R=>{const E={},A=T.meshes[R];Object.keys(A.id_sequence).forEach(D=>{let M;w.has(D)?M=w.get(D):(C++,M=C,w.set(D,C)),E[M]=A.id_sequence[D]}),A.id_sequence=E});const b=new TextEncoder().encode(JSON.stringify(T));return await c.setBufferKey(P1(t),b),await c.setJsonKey(t,u),await c.setJsonKey(g,h),await c.close(),t}catch(c){return console.error("error",t,c),null}}async function Gde(){var r,i;if(typeof showOpenFilePicker!="function"){Fn.setState({activated:!0,message:["Your browser does not support filesystem Access Api","Use newest Chrome/Edge","If you use brave, then you need to enable it under flags"].join(`
`),header:"Error"});return}const n={types:[{description:"Web3d glb files",accept:{"glb/glb":[".glb"]}}],excludeAcceptAllOption:!0,multiple:!0},e=Re.getState().selectedLayer;e||Re.setState({selectedLayer:[],selectedProject:{plant_name:"LOCAL ONLY",project_key:"LOCAL ONLY"}});const t=await showOpenFilePicker(n);if((t==null?void 0:t.length)>0){rr.setState({treeViewActive:!1});for(let o=0;o<t.length;o++){ke.setState({loadingData:!0,dialogContent:`Loading glb file no:${o+1} of ${t.length}`,dialogHeader:"Please wait"});const s=await t[o].getFile(),a=await s.arrayBuffer(),c=await new Ade({credentials:"include"}).binaryToJSON(new Uint8Array(a)),u=`${s.name}_ID${new Date().getTime()}`,h=Re.getState().selectedProject,f=M1(h),m=N7(c),g=(i=(r=c.json.asset)==null?void 0:r.extras)==null?void 0:i.web3dversion;let _=null;if(g==2?_=await Vde(f,u,u,c,u):m?_=await Ide(f,u,u,c,u):_=await Bde(f,u,u,c,u),_){await ae.add_model_groups([{$synced:!0,name:u,root_name:"Manual_files"}],{project_key:f});const v=mn.getState().modelGroups||[];v.push({$synced:!0,$loaded:!0,$isLocalFile:!0,name:u,root_name:"Manual_files"}),mn.setState({modelGroups:structuredClone(v)}),await cE(f,u),W().forceRenderNextFrame()}}await ae.treeview_reset_rows(),rr.setState({treeViewActive:!0}),e||(W().getSceneController().updateBB(),await W().fitModelToCanvas(!0)),ke.setState({loadingData:!1})}}function Wde(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["For loading/appending local glb file. Y axis is UP","Only supports simple GLTF files, max 2 GB in size","Does not support sparse accessors/skinning/animation/textures/extensions"].join(`
`),onClick:async()=>{await Gde()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Open GLB"})]})}function pE(n){return((n==null?void 0:n.project_key)||"unknown")+"_TEMP_SET"}class $de{constructor(e){Se(this,"collection",new Map);Se(this,"generationCount",0);Se(this,"collectionBoundingBox",null);Se(this,"groupNamesUsed",new Set);this.name=e}getkeys(){return Array.from(this.collection)}add(e){e.forEach(t=>this.collection.set(t.index,t))}clear(e=!1){this.generationCount=0,this.collection=new Map,this.groupNamesUsed=new Set,W().getSceneController().clearModelGroup(this.name,e),e||W().forceRenderNextFrame()}unload(){this.generationCount=0,W().getSceneController().clearModelGroup(this.name),W().forceRenderNextFrame()}async load(e=!1,t=!1,r=this.name){var a;this.groupNamesUsed.clear(),e||ke.setState({loadingData:!e,dialogContent:"please wait, depends on hardware/model details",dialogHeader:"Generating Model"});const i=new Oi(pE(Re.getState().selectedProject));this.generationCount=0,W().getSceneController().clearModelGroup(this.name),this.collectionBoundingBox=new nt;const o=[],s=Array.from(this.collection.keys());for(let l=0;l<s.length;l++){const c=this.collection.get(s[l]);if(!c)return;this.groupNamesUsed.add(c.group_name);const u=(a=mn.getState().modelGroups)==null?void 0:a.filter(b=>b.name===c.group_name);let h;u!=null&&u.length&&u[0].$isLocalFile?h=new Oi(M1(Re.getState().selectedProject)):h=new Oi(m_(Re.getState().selectedProject));const f=c.index_ranges,m=c.materials;let g=[],_=[];if(c.full_mesh)g=await h.getBufferKey(c.index),_=await h.getBufferKey(c.position);else{const b=new Map,R=new Uint32Array(await h.getBufferKey(c.index)),E=new Float32Array(await h.getBufferKey(c.position));let A=0;for(let F=0;F<f.length;F++){const D=f[F];if(R.length===0&&D.length>0)console.error("index is 0 but have ranges, most likely a sync issue, resync and try again",R,D);else{const M=D[0]+D[1];for(let k=D[0];k<M;k++){const z=R[k]*3,P=E[z]+1,U=E[z+1]+1,Y=E[z+2]+1,Z=P*1e4*(U*1e3)*(Y*100);b.has(Z)?g.push(b.get(Z)):(g.push(A),b.set(Z,A),A++,_.push(E[z]),_.push(E[z+1]),_.push(E[z+2]))}}}}const v=new Sn,p=new Float32Array(_),x=new $n(p,3,!1);x.onUploadCallback=function(){this.array=null},v.setAttribute("position",x);const y=new Uint32Array(g),w=new $n(y,1,!1);w.onUploadCallback=function(){this.array=null},v.setIndex(w),v.computeBoundingBox(),v.computeBoundingSphere();const C=c.groups.map(b=>({start:b.start,count:b.count,material_index:b.material_index,transformation:0,is_sel:0})),T=new g7,S={modelGroupKey:c.group_name,modelDBKey:`map(${l}):(${this.generationCount}):${r}`,modelDBKeyIndex:c.index,modelDBKeyPosition:c.position,modelDBStore:pE(Re.getState().selectedProject)};if(T.$initMesh(v,m,C,S),o.push(T.__modelDBKey),r){const b=Array.from(m.keys()),R={indexdbKey:T.__modelDBKey,groupKey:c.group_name,position:T.__modelDBKeyPosition,index:T.__modelDBKeyIndex,color:m.get(b[0])};i.setBufferKey(R.position,p),i.setBufferKey(R.index,y),i.setJsonKey(R.indexdbKey,R)}this.collectionBoundingBox.expandByObject(T),W().getSceneController().addMeshToScene(T,this.name),bt.flushSync(()=>{e||ke.setState({loadingData:!e,dialogContent:`Processing mesh ${l}/${s.length}`,dialogHeader:"Generating Model "})})}r&&i.setJsonKey(r,o),t||W().fitModelToCanvas(!0),W().forceRenderNextFrame(),e||ke.setState({loadingData:!1,dialogContent:"",dialogHeader:""})}}const Pi=new $de("USER_SET_01");async function v_(){const n=mn.getState().modelGroups;if(Re.getState().selectedProject&&(n!=null&&n.length)){for(let t=0;t<n.length;t++)n[t].$loaded=!1;mn.setState({modelGroups:[]}),mn.setState({modelGroups:n}),W().getSceneController().clearScene(),W().__forceRender=!0}Pi.unload(),await ae.selection_clear(!0)}function t4(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Unloads all models displayed",onClick:async()=>{v_(),await ae.selection_clear(!0),await ae.treeview_reset_rows()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Unload"})]})}function Vk(n){return n.enable?d.jsx("div",{"data-tooltip":["Turns clipping plane off in selected axis"].join(`
`),className:"w-20 cursor-pointer text-center text-2xl font-semibold hover:bg-gray-500",onClick:n.onClick,children:"ON"}):d.jsx("div",{"data-tooltip":["Turns clipping plane on in selected axis"].join(`
`),className:"w-20 cursor-pointer text-center text-2xl font-semibold hover:bg-gray-500",onClick:n.onClick,children:"OFF"})}function Gk(n){return n.enable?d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Inverts clipping plane",stroke:"currentColor",onClick:n.onClick,strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}):d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 rotate-45 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Inverts clipping plane",stroke:"currentColor",onClick:n.onClick,strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}let so=!1;function Yde(n){return-n}function Kde(){const n=De();return d.jsxs("div",{className:"pointer-events-auto ml-5 mr-5 flex flex-1 select-none bg-gray-800",children:[d.jsx("div",{className:"flex flex-1 flex-col place-content-evenly p-2 text-red-700 hover:text-red-900",children:d.jsx(Vk,{enable:n.x_plane_enable,onClick:()=>{const e=W().__lastClick,t=n.x_plane_neg?-e.x:e.x;n.x_plane_enable?De.setState({x_plane_offset:0,x_plane_enable:!1}):De.setState({x_plane_offset:t,x_plane_enable:!0})}})}),d.jsxs("div",{className:"ml-3 mr-3 flex flex-1 flex-col place-content-evenly p-2 text-gray-300",children:[d.jsx(Gk,{enable:n.x_plane_neg,onClick:()=>{if(n.x_plane_enable){n.x_plane_neg?De.setState({x_plane_neg:!1}):De.setState({x_plane_neg:!0});const e=De.getState().x_plane_offset;De.setState({x_plane_offset:Yde(e)})}}}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping to last clicked point",onClick:()=>{if(n.x_plane_enable){const e=W().__lastClick,t=n.x_plane_neg?-e.x:e.x;De.setState({x_plane_offset:t})}},onMouseUp:()=>{so=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})})]}),d.jsxs("div",{className:"m-2 ml-3 mr-3 flex flex-1 flex-col place-content-between p-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",onPointerDown:()=>{if(n.x_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().x_plane_offset-.1;De.setState({x_plane_offset:t}),so&&e()},50)};so=!0,e()}},onPointerUp:()=>{so=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.x_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().x_plane_offset+.1;De.setState({x_plane_offset:t}),so&&e()},50)};so=!0,e()}},onPointerUp:()=>{so=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),d.jsxs("div",{className:"m-2 ml-3 mr-3 flex flex-1 flex-col place-content-between p-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",onPointerDown:()=>{if(n.x_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().x_plane_offset-1;De.setState({x_plane_offset:t}),so&&e()},50)};so=!0,e()}},onPointerUp:()=>{so=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.x_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().x_plane_offset+1;De.setState({x_plane_offset:t}),so&&e()},50)};so=!0,e()}},onPointerUp:()=>{so=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})]})]})}let ao=!1;function Xde(n){return-n}function qde(){const n=De();return d.jsxs("div",{className:"pointer-events-auto ml-5 mr-5 flex flex-1 select-none bg-gray-800",children:[d.jsx("div",{className:"flex flex-1 flex-col place-content-evenly p-2 text-green-700 hover:text-green-900",children:d.jsx(Vk,{enable:n.y_plane_enable,onClick:()=>{const e=W().__lastClick,t=n.y_plane_neg?-e.y:e.y;n.y_plane_enable?De.setState({y_plane_offset:0,y_plane_enable:!1}):De.setState({y_plane_offset:t,y_plane_enable:!0})}})}),d.jsxs("div",{className:"ml-3 mr-3 flex flex-1 flex-col place-content-evenly p-2 text-gray-300",children:[d.jsx(Gk,{enable:n.y_plane_neg,onClick:()=>{if(n.y_plane_enable){n.y_plane_neg?De.setState({y_plane_neg:!1}):De.setState({y_plane_neg:!0});const e=De.getState().y_plane_offset;De.setState({y_plane_offset:Xde(e)})}}}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping to last clicked point",onClick:()=>{if(n.y_plane_enable){const e=W().__lastClick,t=n.y_plane_neg?-e.y:e.y;De.setState({y_plane_offset:t})}},onMouseUp:()=>{ao=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})})]}),d.jsxs("div",{className:"m-2 ml-3 mr-3 flex flex-1 flex-col place-content-between p-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",onPointerDown:()=>{if(n.y_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().y_plane_offset-.1;De.setState({y_plane_offset:t}),ao&&e()},50)};ao=!0,e()}},onPointerUp:()=>{ao=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.y_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().y_plane_offset+.1;De.setState({y_plane_offset:t}),ao&&e()},50)};ao=!0,e()}},onPointerUp:()=>{ao=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),d.jsxs("div",{className:"m-2 flex flex-1 flex-col place-content-between p-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",onPointerDown:()=>{if(n.y_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().y_plane_offset-1;De.setState({y_plane_offset:t}),ao&&e()},50)};ao=!0,e()}},onPointerUp:()=>{ao=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.y_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().y_plane_offset+1;De.setState({y_plane_offset:t}),ao&&e()},50)};ao=!0,e()}},onPointerUp:()=>{ao=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})]})]})}let lo=!1;function Qde(n){return-n}function Zde(){const n=De();return d.jsxs("div",{className:"pointer-events-auto ml-5 mr-5 flex flex-1 select-none bg-gray-800",children:[d.jsx("div",{className:"flex flex-1 flex-col place-content-evenly p-2 text-blue-700 hover:text-blue-900",children:d.jsx(Vk,{enable:n.z_plane_enable,onClick:()=>{const e=W().__lastClick,t=n.z_plane_neg?-e.z:e.z;n.z_plane_enable?De.setState({z_plane_offset:0,z_plane_enable:!1}):De.setState({z_plane_offset:t,z_plane_enable:!0})}})}),d.jsxs("div",{className:"ml-3 mr-3 flex flex-1 flex-col place-content-evenly p-2 text-gray-300",children:[d.jsx(Gk,{enable:n.z_plane_neg,onClick:()=>{if(n.z_plane_enable){n.z_plane_neg?De.setState({z_plane_neg:!1}):De.setState({z_plane_neg:!0});const e=De.getState().z_plane_offset;De.setState({z_plane_offset:Qde(e)})}}}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping to last clicked point",onClick:()=>{if(n.z_plane_enable){const e=W().__lastClick,t=n.z_plane_neg?-e.z:e.z;De.setState({z_plane_offset:t})}},onMouseUp:()=>{lo=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})})]}),d.jsxs("div",{className:"m-2 ml-3 mr-3 flex flex-1 flex-col place-content-between p-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Move clipping plane",stroke:"currentColor",onPointerDown:()=>{if(n.z_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().z_plane_offset+.1;De.setState({z_plane_offset:t}),lo&&e()},50)};lo=!0,e()}},onPointerUp:()=>{lo=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.z_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().z_plane_offset-.1;De.setState({z_plane_offset:t}),lo&&e()},50)};lo=!0,e()}},onPointerUp:()=>{lo=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),d.jsxs("div",{className:"m-2 flex flex-1 flex-col place-content-between p-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Move clipping plane",stroke:"currentColor",onPointerDown:()=>{if(n.z_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().z_plane_offset+1;De.setState({z_plane_offset:t}),lo&&e()},50)};lo=!0,e()}},onPointerUp:()=>{lo=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 cursor-pointer text-gray-300 hover:bg-gray-500 hover:text-gray-900",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.z_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().z_plane_offset-1;De.setState({z_plane_offset:t}),lo&&e()},50)};lo=!0,e()}},onPointerUp:()=>{lo=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})]})]})}function Jde(){const n=Pe();return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["Opens settings dialog"].join(`
`),onClick:()=>{n.settingsToggle()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),d.jsx("span",{className:"text-center text-xs",children:"Settings"})]})}let Xg,_2,vf,ly;function x2(n,e=1/0,t=null){_2||(_2=new Om(2,2,1,1)),vf||(vf=new No({uniforms:{blitTexture:new Ja(n)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),vf.uniforms.blitTexture.value=n,vf.defines.IS_SRGB=n.colorSpace==$o,vf.needsUpdate=!0,ly||(ly=new Ve(_2,vf),ly.frustumCulled=!1);const r=new Vi,i=new _w;i.add(ly),t===null&&(t=Xg=new NA({antialias:!1}));const o=Math.min(n.image.width,e),s=Math.min(n.image.height,e);t.setSize(o,s),t.clear(),t.render(i,r);const a=document.createElement("canvas"),l=a.getContext("2d");a.width=o,a.height=s,l.drawImage(t.domElement,0,0,o,s);const c=new uQ(a);return c.minFilter=n.minFilter,c.magFilter=n.magFilter,c.wrapS=n.wrapS,c.wrapT=n.wrapT,c.colorSpace=n.colorSpace,c.name=n.name,Xg&&(Xg.forceContextLoss(),Xg.dispose(),Xg=null),c}const n4={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Wk{constructor(){this.pluginCallbacks=[],this.register(function(e){return new che(e)}),this.register(function(e){return new uhe(e)}),this.register(function(e){return new phe(e)}),this.register(function(e){return new mhe(e)}),this.register(function(e){return new ghe(e)}),this.register(function(e){return new vhe(e)}),this.register(function(e){return new dhe(e)}),this.register(function(e){return new hhe(e)}),this.register(function(e){return new fhe(e)}),this.register(function(e){return new _he(e)}),this.register(function(e){return new xhe(e)}),this.register(function(e){return new yhe(e)}),this.register(function(e){return new whe(e)}),this.register(function(e){return new She(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){const o=new lhe,s=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)s.push(this.pluginCallbacks[a](o));o.setPlugins(s),o.write(e,t,i).catch(r)}parseAsync(e,t){const r=this;return new Promise(function(i,o){r.parse(e,i,o,t)})}}const Vt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},y2="KHR_mesh_quantization",bo={};bo[So]=Vt.NEAREST;bo[IF]=Vt.NEAREST_MIPMAP_NEAREST;bo[e0]=Vt.NEAREST_MIPMAP_LINEAR;bo[qo]=Vt.LINEAR;bo[gy]=Vt.LINEAR_MIPMAP_NEAREST;bo[Lc]=Vt.LINEAR_MIPMAP_LINEAR;bo[kc]=Vt.CLAMP_TO_EDGE;bo[dw]=Vt.REPEAT;bo[hw]=Vt.MIRRORED_REPEAT;const r4={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},ehe=new rt,i4=12,the=1179937895,nhe=2,o4=8,rhe=1313821514,ihe=5130562;function S0(n,e){return n.length===e.length&&n.every(function(t,r){return t===e[r]})}function ohe(n){return new TextEncoder().encode(n).buffer}function she(n){return S0(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function ahe(n,e,t){const r={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=e;i<e+t;i++)for(let o=0;o<n.itemSize;o++){let s;n.itemSize>4?s=n.array[i*n.itemSize+o]:(o===0?s=n.getX(i):o===1?s=n.getY(i):o===2?s=n.getZ(i):o===3&&(s=n.getW(i)),n.normalized===!0&&(s=ov.normalize(s,n.array))),r.min[o]=Math.min(r.min[o],s),r.max[o]=Math.max(r.max[o],s)}return r}function L7(n){return Math.ceil(n/4)*4}function w2(n,e=0){const t=L7(n.byteLength);if(t!==n.byteLength){const r=new Uint8Array(t);if(r.set(new Uint8Array(n)),e!==0)for(let i=n.byteLength;i<t;i++)r[i]=e;return r.buffer}return n}function s4(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function a4(n,e){if(n.toBlob!==void 0)return new Promise(r=>n.toBlob(r,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),n.convertToBlob({type:e,quality:t})}class lhe{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+AE}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,r={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},r),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,o=i.buffers,s=i.json;r=i.options;const a=i.extensionsUsed,l=i.extensionsRequired,c=new Blob(o,{type:"application/octet-stream"}),u=Object.keys(a),h=Object.keys(l);if(u.length>0&&(s.extensionsUsed=u),h.length>0&&(s.extensionsRequired=h),s.buffers&&s.buffers.length>0&&(s.buffers[0].byteLength=c.size),r.binary===!0){const f=new FileReader;f.readAsArrayBuffer(c),f.onloadend=function(){const m=w2(f.result),g=new DataView(new ArrayBuffer(o4));g.setUint32(0,m.byteLength,!0),g.setUint32(4,ihe,!0);const _=w2(ohe(JSON.stringify(s)),32),v=new DataView(new ArrayBuffer(o4));v.setUint32(0,_.byteLength,!0),v.setUint32(4,rhe,!0);const p=new ArrayBuffer(i4),x=new DataView(p);x.setUint32(0,the,!0),x.setUint32(4,nhe,!0);const y=i4+v.byteLength+_.byteLength+g.byteLength+m.byteLength;x.setUint32(8,y,!0);const w=new Blob([p,v,_,g,m],{type:"application/octet-stream"}),C=new FileReader;C.readAsArrayBuffer(w),C.onloadend=function(){t(C.result)}}}else if(s.buffers&&s.buffers.length>0){const f=new FileReader;f.readAsDataURL(c),f.onloadend=function(){const m=f.result;s.buffers[0].uri=m,t(s)}}else t(s)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const r=this.options,i=this.extensionsUsed;try{const o=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&o.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const s in o.gltfExtensions)t.extensions[s]=o.gltfExtensions[s],i[s]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(t.extras=o)}catch(o){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+o.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(e,i)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const r=new N;for(let i=0,o=e.count;i<o;i++)if(Math.abs(r.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const r=e.clone(),i=new N;for(let o=0,s=r.count;o<s;o++)i.fromBufferAttribute(r,o),i.x===0&&i.y===0&&i.z===0?i.setX(1):i.normalize(),r.setXYZ(o,i.x,i.y,i.z);return t.attributesNormalized.set(e,r),r}applyTextureTransform(e,t){let r=!1;const i={};(t.offset.x!==0||t.offset.y!==0)&&(i.offset=t.offset.toArray(),r=!0),t.rotation!==0&&(i.rotation=t.rotation,r=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(i.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function r(m){return m.colorSpace===$o?function(_){return _<.04045?_*.0773993808:Math.pow(_*.9478672986+.0521327014,2.4)}:function(_){return _}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof LT&&(e=x2(e)),t instanceof LT&&(t=x2(t));const i=e?e.image:null,o=t?t.image:null,s=Math.max(i?i.width:0,o?o.width:0),a=Math.max(i?i.height:0,o?o.height:0),l=s4();l.width=s,l.height=a;const c=l.getContext("2d",{willReadFrequently:!0});c.fillStyle="#00ffff",c.fillRect(0,0,s,a);const u=c.getImageData(0,0,s,a);if(i){c.drawImage(i,0,0,s,a);const m=r(e),g=c.getImageData(0,0,s,a).data;for(let _=2;_<g.length;_+=4)u.data[_]=m(g[_]/256)*256}if(o){c.drawImage(o,0,0,s,a);const m=r(t),g=c.getImageData(0,0,s,a).data;for(let _=1;_<g.length;_+=4)u.data[_]=m(g[_]/256)*256}c.putImageData(u,0,0);const f=(e||t).clone();return f.source=new JN(l),f.colorSpace=rl,f.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),f}processBuffer(e){const t=this.json,r=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),r.push(e),0}processBufferView(e,t,r,i,o){const s=this.json;s.bufferViews||(s.bufferViews=[]);let a;switch(t){case Vt.BYTE:case Vt.UNSIGNED_BYTE:a=1;break;case Vt.SHORT:case Vt.UNSIGNED_SHORT:a=2;break;default:a=4}let l=e.itemSize*a;o===Vt.ARRAY_BUFFER&&(l=Math.ceil(l/4)*4);const c=L7(i*l),u=new DataView(new ArrayBuffer(c));let h=0;for(let g=r;g<r+i;g++){for(let _=0;_<e.itemSize;_++){let v;e.itemSize>4?v=e.array[g*e.itemSize+_]:(_===0?v=e.getX(g):_===1?v=e.getY(g):_===2?v=e.getZ(g):_===3&&(v=e.getW(g)),e.normalized===!0&&(v=ov.normalize(v,e.array))),t===Vt.FLOAT?u.setFloat32(h,v,!0):t===Vt.INT?u.setInt32(h,v,!0):t===Vt.UNSIGNED_INT?u.setUint32(h,v,!0):t===Vt.SHORT?u.setInt16(h,v,!0):t===Vt.UNSIGNED_SHORT?u.setUint16(h,v,!0):t===Vt.BYTE?u.setInt8(h,v):t===Vt.UNSIGNED_BYTE&&u.setUint8(h,v),h+=a}h%l!==0&&(h+=l-h%l)}const f={buffer:this.processBuffer(u.buffer),byteOffset:this.byteOffset,byteLength:c};return o!==void 0&&(f.target=o),o===Vt.ARRAY_BUFFER&&(f.byteStride=l),this.byteOffset+=c,s.bufferViews.push(f),{id:s.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,r=t.json;return r.bufferViews||(r.bufferViews=[]),new Promise(function(i){const o=new FileReader;o.readAsArrayBuffer(e),o.onloadend=function(){const s=w2(o.result),a={buffer:t.processBuffer(s),byteOffset:t.byteOffset,byteLength:s.byteLength};t.byteOffset+=s.byteLength,i(r.bufferViews.push(a)-1)}})}processAccessor(e,t,r,i){const o=this.json,s={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=Vt.FLOAT;else if(e.array.constructor===Int32Array)a=Vt.INT;else if(e.array.constructor===Uint32Array)a=Vt.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=Vt.SHORT;else if(e.array.constructor===Uint16Array)a=Vt.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=Vt.BYTE;else if(e.array.constructor===Uint8Array)a=Vt.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(r===void 0&&(r=0),(i===void 0||i===1/0)&&(i=e.count),i===0)return null;const l=ahe(e,r,i);let c;t!==void 0&&(c=e===t.index?Vt.ELEMENT_ARRAY_BUFFER:Vt.ARRAY_BUFFER);const u=this.processBufferView(e,a,r,i,c),h={bufferView:u.id,byteOffset:u.byteOffset,componentType:a,count:i,max:l.max,min:l.min,type:s[e.itemSize]};return e.normalized===!0&&(h.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(h)-1}processImage(e,t,r,i="image/png"){if(e!==null){const o=this,s=o.cache,a=o.json,l=o.options,c=o.pending;s.images.has(e)||s.images.set(e,{});const u=s.images.get(e),h=i+":flipY/"+r.toString();if(u[h]!==void 0)return u[h];a.images||(a.images=[]);const f={mimeType:i},m=s4();m.width=Math.min(e.width,l.maxTextureSize),m.height=Math.min(e.height,l.maxTextureSize);const g=m.getContext("2d",{willReadFrequently:!0});if(r===!0&&(g.translate(0,m.height),g.scale(1,-1)),e.data!==void 0){t!==Jo&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const v=new Uint8ClampedArray(e.height*e.width*4);for(let p=0;p<v.length;p+=4)v[p+0]=e.data[p+0],v[p+1]=e.data[p+1],v[p+2]=e.data[p+2],v[p+3]=e.data[p+3];g.putImageData(new ImageData(v,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)g.drawImage(e,0,0,m.width,m.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");l.binary===!0?c.push(a4(m,i).then(v=>o.processBufferViewImage(v)).then(v=>{f.bufferView=v})):m.toDataURL!==void 0?f.uri=m.toDataURL(i):c.push(a4(m,i).then(v=>new FileReader().readAsDataURL(v)).then(v=>{f.uri=v}));const _=a.images.push(f)-1;return u[h]=_,_}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const r={magFilter:bo[e.magFilter],minFilter:bo[e.minFilter],wrapS:bo[e.wrapS],wrapT:bo[e.wrapT]};return t.samplers.push(r)-1}processTexture(e){const r=this.options,i=this.cache,o=this.json;if(i.textures.has(e))return i.textures.get(e);o.textures||(o.textures=[]),e instanceof LT&&(e=x2(e,r.maxTextureSize));let s=e.userData.mimeType;s==="image/webp"&&(s="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,s)};e.name&&(a.name=e.name),this._invokeAll(function(c){c.writeTexture&&c.writeTexture(e,a)});const l=o.textures.push(a)-1;return i.textures.set(e,l),l}processMaterial(e){const t=this.cache,r=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;r.materials||(r.materials=[]);const i={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const o=e.color.toArray().concat([e.opacity]);if(S0(o,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=o),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),l={index:this.processTexture(a),channel:a.channel};this.applyTextureTransform(l,a),i.pbrMetallicRoughness.metallicRoughnessTexture=l}if(e.map){const a={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(a,e.map),i.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){const a=e.emissive;if(Math.max(a.r,a.g,a.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const c={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(c,e.emissiveMap),i.emissiveTexture=c}}if(e.normalMap){const a={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),i.normalTexture=a}if(e.aoMap){const a={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),i.occlusionTexture=a}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===vi&&(i.doubleSided=!0),e.name!==""&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,i)});const s=r.materials.push(i)-1;return t.materials.set(e,s),s}processMesh(e){const t=this.cache,r=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let w=0,C=e.material.length;w<C;w++)i.push(e.material[w].uuid);else i.push(e.material.uuid);const o=i.join(":");if(t.meshes.has(o))return t.meshes.get(o);const s=e.geometry;let a;e.isLineSegments?a=Vt.LINES:e.isLineLoop?a=Vt.LINE_LOOP:e.isLine?a=Vt.LINE_STRIP:e.isPoints?a=Vt.POINTS:a=e.material.wireframe?Vt.LINES:Vt.TRIANGLES;const l={},c={},u=[],h=[],f={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=s.getAttribute("normal");m!==void 0&&!this.isNormalizedNormalAttribute(m)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.setAttribute("normal",this.createNormalizedNormalAttribute(m)));let g=null;for(let w in s.attributes){if(w.slice(0,5)==="morph")continue;const C=s.attributes[w];if(w=f[w]||w.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(w)||(w="_"+w),t.attributes.has(this.getUID(C))){c[w]=t.attributes.get(this.getUID(C));continue}g=null;const S=C.array;w==="JOINTS_0"&&!(S instanceof Uint16Array)&&!(S instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new $n(new Uint16Array(S),C.itemSize,C.normalized));const b=this.processAccessor(g||C,s);b!==null&&(w.startsWith("_")||this.detectMeshQuantization(w,C),c[w]=b,t.attributes.set(this.getUID(C),b))}if(m!==void 0&&s.setAttribute("normal",m),Object.keys(c).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const w=[],C=[],T={};if(e.morphTargetDictionary!==void 0)for(const S in e.morphTargetDictionary)T[e.morphTargetDictionary[S]]=S;for(let S=0;S<e.morphTargetInfluences.length;++S){const b={};let R=!1;for(const E in s.morphAttributes){if(E!=="position"&&E!=="normal"){R||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),R=!0);continue}const A=s.morphAttributes[E][S],F=E.toUpperCase(),D=s.attributes[E];if(t.attributes.has(this.getUID(A,!0))){b[F]=t.attributes.get(this.getUID(A,!0));continue}const M=A.clone();if(!s.morphTargetsRelative)for(let k=0,z=A.count;k<z;k++)for(let P=0;P<A.itemSize;P++)P===0&&M.setX(k,A.getX(k)-D.getX(k)),P===1&&M.setY(k,A.getY(k)-D.getY(k)),P===2&&M.setZ(k,A.getZ(k)-D.getZ(k)),P===3&&M.setW(k,A.getW(k)-D.getW(k));b[F]=this.processAccessor(M,s),t.attributes.set(this.getUID(D,!0),b[F])}h.push(b),w.push(e.morphTargetInfluences[S]),e.morphTargetDictionary!==void 0&&C.push(T[S])}l.weights=w,C.length>0&&(l.extras={},l.extras.targetNames=C)}const _=Array.isArray(e.material);if(_&&s.groups.length===0)return null;let v=!1;if(_&&s.index===null){const w=[];for(let C=0,T=s.attributes.position.count;C<T;C++)w[C]=C;s.setIndex(w),v=!0}const p=_?e.material:[e.material],x=_?s.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let w=0,C=x.length;w<C;w++){const T={mode:a,attributes:c};if(this.serializeUserData(s,T),h.length>0&&(T.targets=h),s.index!==null){let b=this.getUID(s.index);(x[w].start!==void 0||x[w].count!==void 0)&&(b+=":"+x[w].start+":"+x[w].count),t.attributes.has(b)?T.indices=t.attributes.get(b):(T.indices=this.processAccessor(s.index,s,x[w].start,x[w].count),t.attributes.set(b,T.indices)),T.indices===null&&delete T.indices}const S=this.processMaterial(p[x[w].materialIndex]);S!==null&&(T.material=S),u.push(T)}v===!0&&s.setIndex(null),l.primitives=u,r.meshes||(r.meshes=[]),this._invokeAll(function(w){w.writeMesh&&w.writeMesh(e,l)});const y=r.meshes.push(l)-1;return t.meshes.set(o,y),y}detectMeshQuantization(e,t){if(this.extensionsUsed[y2])return;let r;switch(t.array.constructor){case Int8Array:r="byte";break;case Uint8Array:r="unsigned byte";break;case Int16Array:r="short";break;case Uint16Array:r="unsigned short";break;default:return}t.normalized&&(r+=" normalized");const i=e.split("_",1)[0];n4[i]&&n4[i].includes(r)&&(this.extensionsUsed[y2]=!0,this.extensionsRequired[y2]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const r=e.isOrthographicCamera,i={type:r?"orthographic":"perspective"};return r?i.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:ov.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const r=this.json,i=this.nodeMap;r.animations||(r.animations=[]),e=Wk.Utils.mergeMorphTargetTracks(e.clone(),t);const o=e.tracks,s=[],a=[];for(let l=0;l<o.length;++l){const c=o[l],u=on.parseTrackName(c.name);let h=on.findNode(t,u.nodeName);const f=r4[u.propertyName];if(u.objectName==="bones"&&(h.isSkinnedMesh===!0?h=h.skeleton.getBoneByName(u.objectIndex):h=void 0),!h||!f){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name);continue}const m=1;let g=c.values.length/c.times.length;f===r4.morphTargetInfluences&&(g/=h.morphTargetInfluences.length);let _;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(_="CUBICSPLINE",g/=3):c.getInterpolation()===TW?_="STEP":_="LINEAR",a.push({input:this.processAccessor(new $n(c.times,m)),output:this.processAccessor(new $n(c.values,g)),interpolation:_}),s.push({sampler:a.length-1,target:{node:i.get(h),path:f}})}return r.animations.push({name:e.name||"clip_"+r.animations.length,samplers:a,channels:s}),r.animations.length-1}processSkin(e){const t=this.json,r=this.nodeMap,i=t.nodes[r.get(e)],o=e.skeleton;if(o===void 0)return null;const s=e.skeleton.bones[0];if(s===void 0)return null;const a=[],l=new Float32Array(o.bones.length*16),c=new dt;for(let h=0;h<o.bones.length;++h)a.push(r.get(o.bones[h])),c.copy(o.boneInverses[h]),c.multiply(e.bindMatrix).toArray(l,h*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new $n(l,16)),joints:a,skeleton:r.get(s)}),i.skin=t.skins.length-1}processNode(e){const t=this.json,r=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const o={};if(r.trs){const a=e.quaternion.toArray(),l=e.position.toArray(),c=e.scale.toArray();S0(a,[0,0,0,1])||(o.rotation=a),S0(l,[0,0,0])||(o.translation=l),S0(c,[1,1,1])||(o.scale=c)}else e.matrixAutoUpdate&&e.updateMatrix(),she(e.matrix)===!1&&(o.matrix=e.matrix.elements);if(e.name!==""&&(o.name=String(e.name)),this.serializeUserData(e,o),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(o.mesh=a)}else e.isCamera&&(o.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let l=0,c=e.children.length;l<c;l++){const u=e.children[l];if(u.visible||r.onlyVisible===!1){const h=this.processNode(u);h!==null&&a.push(h)}}a.length>0&&(o.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,o)});const s=t.nodes.push(o)-1;return i.set(e,s),s}processScene(e){const t=this.json,r=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};e.name!==""&&(i.name=e.name),t.scenes.push(i);const o=[];for(let s=0,a=e.children.length;s<a;s++){const l=e.children[s];if(l.visible||r.onlyVisible===!1){const c=this.processNode(l);c!==null&&o.push(c)}}o.length>0&&(i.nodes=o),this.serializeUserData(e,i)}processObjects(e){const t=new _w;t.name="AuxScene";for(let r=0;r<e.length;r++)t.children.push(e[r]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(i){i.beforeParse&&i.beforeParse(e)});const r=[];for(let i=0;i<e.length;i++)e[i]instanceof _w?this.processScene(e[i]):r.push(e[i]);r.length>0&&this.processObjects(r);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(i){i.afterParse&&i.afterParse(e)})}_invokeAll(e){for(let t=0,r=this.plugins.length;t<r;t++)e(this.plugins[t])}}class che{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const r=this.writer,i=r.json,o=r.extensionsUsed,s={};e.name&&(s.name=e.name),s.color=e.color.toArray(),s.intensity=e.intensity,e.isDirectionalLight?s.type="directional":e.isPointLight?(s.type="point",e.distance>0&&(s.range=e.distance)):e.isSpotLight&&(s.type="spot",e.distance>0&&(s.range=e.distance),s.spot={},s.spot.innerConeAngle=(1-e.penumbra)*e.angle,s.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),o[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},o[this.name]=!0);const a=i.extensions[this.name].lights;a.push(s),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class uhe{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class dhe{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const r=this.writer,i=r.extensionsUsed,o={};if(o.clearcoatFactor=e.clearcoat,e.clearcoatMap){const s={index:r.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};r.applyTextureTransform(s,e.clearcoatMap),o.clearcoatTexture=s}if(o.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const s={index:r.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};r.applyTextureTransform(s,e.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=s}if(e.clearcoatNormalMap){const s={index:r.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};e.clearcoatNormalScale.x!==1&&(s.scale=e.clearcoatNormalScale.x),r.applyTextureTransform(s,e.clearcoatNormalMap),o.clearcoatNormalTexture=s}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class hhe{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.dispersion===0)return;const i=this.writer.extensionsUsed,o={};o.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class fhe{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const r=this.writer,i=r.extensionsUsed,o={};if(o.iridescenceFactor=e.iridescence,e.iridescenceMap){const s={index:r.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};r.applyTextureTransform(s,e.iridescenceMap),o.iridescenceTexture=s}if(o.iridescenceIor=e.iridescenceIOR,o.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const s={index:r.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};r.applyTextureTransform(s,e.iridescenceThicknessMap),o.iridescenceThicknessTexture=s}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class phe{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const r=this.writer,i=r.extensionsUsed,o={};if(o.transmissionFactor=e.transmission,e.transmissionMap){const s={index:r.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};r.applyTextureTransform(s,e.transmissionMap),o.transmissionTexture=s}t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class mhe{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const r=this.writer,i=r.extensionsUsed,o={};if(o.thicknessFactor=e.thickness,e.thicknessMap){const s={index:r.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};r.applyTextureTransform(s,e.thicknessMap),o.thicknessTexture=s}e.attenuationDistance!==1/0&&(o.attenuationDistance=e.attenuationDistance),o.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class ghe{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const i=this.writer.extensionsUsed,o={};o.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class vhe{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(ehe)&&!e.specularIntensityMap&&!e.specularColorMap)return;const r=this.writer,i=r.extensionsUsed,o={};if(e.specularIntensityMap){const s={index:r.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};r.applyTextureTransform(s,e.specularIntensityMap),o.specularTexture=s}if(e.specularColorMap){const s={index:r.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};r.applyTextureTransform(s,e.specularColorMap),o.specularColorTexture=s}o.specularFactor=e.specularIntensity,o.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class _he{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const r=this.writer,i=r.extensionsUsed,o={};if(e.sheenRoughnessMap){const s={index:r.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};r.applyTextureTransform(s,e.sheenRoughnessMap),o.sheenRoughnessTexture=s}if(e.sheenColorMap){const s={index:r.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};r.applyTextureTransform(s,e.sheenColorMap),o.sheenColorTexture=s}o.sheenRoughnessFactor=e.sheenRoughness,o.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class xhe{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const r=this.writer,i=r.extensionsUsed,o={};if(e.anisotropyMap){const s={index:r.processTexture(e.anisotropyMap)};r.applyTextureTransform(s,e.anisotropyMap),o.anisotropyTexture=s}o.anisotropyStrength=e.anisotropy,o.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class yhe{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const i=this.writer.extensionsUsed,o={};o.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class whe{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const r=this.writer,i=r.extensionsUsed,o={};if(e.bumpMap){const s={index:r.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};r.applyTextureTransform(s,e.bumpMap),o.bumpTexture=s}o.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=o,i[this.name]=!0}}class She{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const r=this.writer,i=e,o=new Float32Array(i.count*3),s=new Float32Array(i.count*4),a=new Float32Array(i.count*3),l=new dt,c=new N,u=new Hn,h=new N;for(let m=0;m<i.count;m++)i.getMatrixAt(m,l),l.decompose(c,u,h),c.toArray(o,m*3),u.toArray(s,m*4),h.toArray(a,m*3);const f={TRANSLATION:r.processAccessor(new $n(o,3)),ROTATION:r.processAccessor(new $n(s,4)),SCALE:r.processAccessor(new $n(a,3))};i.instanceColor&&(f._COLOR_0=r.processAccessor(i.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:f},r.extensionsUsed[this.name]=!0,r.extensionsRequired[this.name]=!0}}Wk.Utils={insertKeyframe:function(n,e){const r=n.getValueSize(),i=new n.TimeBufferType(n.times.length+1),o=new n.ValueBufferType(n.values.length+r),s=n.createInterpolant(new n.ValueBufferType(r));let a;if(n.times.length===0){i[0]=e;for(let l=0;l<r;l++)o[l]=0;a=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;i[0]=e,i.set(n.times,1),o.set(s.evaluate(e),0),o.set(n.values,r),a=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;i[i.length-1]=e,i.set(n.times,0),o.set(n.values,0),o.set(s.evaluate(e),n.values.length),a=i.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-e)<.001)return l;if(n.times[l]<e&&n.times[l+1]>e){i.set(n.times.slice(0,l+1),0),i[l+1]=e,i.set(n.times.slice(l+1),l+2),o.set(n.values.slice(0,(l+1)*r),0),o.set(s.evaluate(e),(l+1)*r),o.set(n.values.slice((l+1)*r),(l+2)*r),a=l+1;break}}return n.times=i,n.values=o,a},mergeMorphTargetTracks:function(n,e){const t=[],r={},i=n.tracks;for(let o=0;o<i.length;++o){let s=i[o];const a=on.parseTrackName(s.name),l=on.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(s);continue}if(s.createInterpolant!==s.InterpolantFactoryMethodDiscrete&&s.createInterpolant!==s.InterpolantFactoryMethodLinear){if(s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),s=s.clone(),s.setInterpolation(CW)}const c=l.morphTargetInfluences.length,u=l.morphTargetDictionary[a.propertyIndex];if(u===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let h;if(r[l.uuid]===void 0){h=s.clone();const m=new h.ValueBufferType(c*h.times.length);for(let g=0;g<h.times.length;g++)m[g*c+u]=h.values[g];h.name=(a.nodeName||"")+".morphTargetInfluences",h.values=m,r[l.uuid]=h,t.push(h);continue}const f=s.createInterpolant(new s.ValueBufferType(1));h=r[l.uuid];for(let m=0;m<h.times.length;m++)h.values[m*c+u]=f.evaluate(h.times[m]);for(let m=0;m<s.times.length;m++){const g=this.insertKeyframe(h,s.times[m]);h.values[g*c+u]=s.values[m]}}return n.tracks=t,n}};async function Ehe(n){const e=new Wk,t=document.createElement("a");t.style.display="none",document.body.appendChild(t),bt.flushSync(()=>{ke.setState({loadingData:!0,dialogContent:"please wait, collecting model data",dialogHeader:"Generating Model"})});function r(s,a){t.href=URL.createObjectURL(s),t.download=a,t.click()}function i(s,a){r(new Blob([s],{type:"application/octet-stream"}),a)}const o=[];for(let s=0;s<n.length;s++)if(bt.flushSync(()=>{ke.setState({loadingData:!0,dialogContent:`please wait, building group (${s+1}/${n.length})`,dialogHeader:"Generating Model"})}),n[s].__modelDBStore){const a=new Oi(n[s].__modelDBStore),l=new Uint32Array(await a.getJsonKey(n[s].__modelDBKeyIndex)),c=new Float32Array(await a.getJsonKey(n[s].__modelDBKeyPosition)),u=n[s].$groupTransforms;n[s].$groups.forEach(h=>{const f=new Sn;if(!h.count)return;const m=new Uint32Array(l.slice(h.start,h.start+h.count)),g=[],_=[],v=new Map;let p=0;for(let C=0;C<m.length;C++){const T=m[C]*3,S=c[T].toString()+c[T+1].toString()+c[T+2].toString();v.has(S)?g.push(v.get(S)):(g.push(p),v.set(S,p),p++,_.push(c[T]),_.push(c[T+1]),_.push(c[T+2]))}f.setIndex(new $n(new Uint32Array(g),1)),f.setAttribute("position",new $n(new Float32Array(_),3,!0));const x=u.get(h.transformation);if(x&&x.length){const C=new dt().fromArray(x);f.applyMatrix4(C)}f.computeBoundingBox();const y=n[s].$getMeshMaterialFromRange(h.material_index,h.transformation,h.is_sel),w=new Ve(f,y);w.rotateX(-Math.PI/2),o.push(w)})}e.parse(o,function(s){i(s,"web3dExport.glb"),ke.setState({loadingData:!1,dialogContent:"please wait, collecting model data",dialogHeader:"Generating Model"})},function(s){console.log(s)},{binary:!0,trs:!0})}globalThis.testing=async function(){const n=Xe.getState().enabled,e=Pe.getState().enableItemCulling,t=Pe.getState().cullingDistance,r=Pe.getState().cullingSize;n&&(bt.flushSync(()=>{Pe.setState({enableItemCulling:!1,enableGlbCulling:!0,cullingDistance:0,cullingSize:0})}),await zi(!1));const o=W().getSceneController().getMeshes(),s=[];Array.isArray(o)&&(o.forEach(a=>s.push(a)),await Ehe(s)),n&&(bt.flushSync(()=>{Pe.setState({enableItemCulling:e,enableGlbCulling:!1,cullingDistance:t,cullingSize:r})}),await zi(!0))};function The(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["Export displayed model as GLB file"].join(`
`),onClick:()=>{globalThis.testing()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),d.jsx("span",{className:"text-center text-xs",children:"GLTF"})]})}async function Che(n,e){var o;const t=await Ua(),r=await Ll(t.ENV__AZURE_STORAGE_SHARE_CONTAINER_NAME);return await Id(((o=r.data)==null?void 0:o.token)||"no-sas-access",t.ENV__AZURE_STORAGE_SHARE_CONTAINER_NAME,`${e}/${n}.Web3DVP`)}async function O7(n){var s;const e=new Oi("ALL_PROJECTS"),t=await Ua(!0),r=await Ll(t.ENV__AZURE_STORAGE_PROJECT_CONTAINER_NAME),i=await Id(((s=r.data)==null?void 0:s.token)||"no-sas-access",t.ENV__AZURE_STORAGE_PROJECT_CONTAINER_NAME,t.ENV__AZURE_STORAGE_PROJECT_CONFIG_JSON),o={};for(let a=0;a<i.length;a++){const l=i[a].active,c=i[a].dev_only,u=i[a].container,h=i[a].unique_key,f=i[a].plant_code,m=i[a].plant_name,g=i[a].config;l&&(o[h]={},o[h].unique_key=h,o[h].container=u,o[h].plant_code=f,o[h].plant_name=m,o[h].config=g,o[h].dev_only=c)}return o&&await e.setJsonKey("PROJECTS",o),o}async function bhe(n){return await O7()}async function $k(n){const e=await bhe().catch(t=>{Mz(t)});if(e){const t=Object.keys(e),r=[];t.forEach(i=>{r.push(e[i])}),await Re.getState().setAllProjects(r)}}const Hv=mr(()=>({modelIssues:!1,modelIssuesMessages:[]}));async function l4(n,e,t,r){var i;try{let o=!1;const s=[],a={};if(Array.isArray(t))for(let l=0;l<t.length;l++){const c=await Ll(t[l].container_override||e),u=await Id(((i=c.data)==null?void 0:i.token)||"no-sas-access",t[l].container_override||e,t[l].path).catch(()=>(o=!0,s.push(`Missing access linked project ${t[l].container_override} - ${t[l].name} `),{models:[]})),h=Object.keys(u.models),f=new Date().getTime(),m=new Date(u.source_created_date).getTime(),g=f-m,_=Math.floor(g/1e3/3600);g>0&&t[l].warning_after_hours>0&&_>t[l].warning_after_hours&&(o=!0,s.push(`${t[l].name} is ${_} hours, warning is set at ${t[l].warning_after_hours} hours`)),Array.isArray(u.warnings)&&u.warnings.forEach(v=>{o=!0,s.push(`${t[l].name} - ${v}`)}),h.forEach(v=>{const p=u.models[v];p.source_md5_hash=u.source_md5_hash,p.source_created_date=u.source_created_date,p.source_checked_date=u.source_checked_date,p.blob_created_date=u.blob_created_date,p.blob_modified_date=u.blob_modified_date,p.root_name=t[l].name,typeof t[l].load_by_default_override=="boolean"&&(p.load_by_default=t[l].load_by_default_override),p.container_override=t[l].container_override,p.$group_name=p.name,p.name=p.name+"__"+t[l].path,a[p.name]=p,delete a[v]})}if(a){const l=await n.getJsonKey(r);if(l&&a){Object.keys(a).forEach(h=>{const f=l[h],m=a[h];f&&f.glb_md5_hash===m.glb_md5_hash&&f.$synced&&(m.$synced=!0)});const u=Object.keys(l);for(let h=0;h<u.length;h++){const f=u[h];if(!a[f]){const g=k1(f),_=P1(f),v=await n.getJsonKey(g);if(Array.isArray(v))for await(const p of v)await n.deleteKey(p);await n.deleteKey(f),await n.deleteKey(g),await n.deleteKey(_),console.log("todo, delete",f)}}}await n.setJsonKey(r,a)}return Hv.setState({modelIssues:o,modelIssuesMessages:s}),a}catch(o){throw Hv.setState({modelIssues:!1,modelIssuesMessages:[]}),o}}function Ahe(n,e){const t=[];return e.length&&Object.keys(n).forEach(r=>{let i=!1;const o=r.toUpperCase();e.forEach(s=>{if(i)return;const a=s.toUpperCase();if(a.split("*").length>1){let l="";a[0]!=="*"&&(l="^");let c="";a[a.length-1]!=="*"&&(c="$"),new RegExp(`${l}${a.replace(/\*/g,".*")}${c}`,"").test(o)&&(i=!0)}else o===a&&(i=!0)}),i||t.push(r)}),t.forEach(r=>{delete n[r]}),n}function Mhe(n,e){return e.length&&Object.keys(n).forEach(t=>{let r=!1;const i=t.toUpperCase();e.forEach(o=>{if(r)return;const s=o.toUpperCase();if(s.split("*").length>1){let a="";s[0]!=="*"&&(a="^");let l="";s[s.length-1]!=="*"&&(l="$"),new RegExp(`${a}${s.replace(/\*/g,".*")}${l}`,"").test(i)&&(r=!0)}else i===s&&(r=!0)}),r?n[t].load_by_default=!0:n[t].load_by_default=!1}),n}async function Yk(n){const e=Re.getState().selectedProject,t=Re.getState().selectedLayer;if(e){const r=e.container,i=e.model_data,o=(t==null?void 0:t.groups)||[],s=(t==null?void 0:t.loadGroups)||[],a=m_(Re.getState().selectedProject),l=new Oi(a);try{let c;n?c=await l4(l,r,i,a):(c=await l.getJsonKey(a),c||(c=await l4(l,r,i,a)));const u=Mhe(c||{},s);return Ahe(u||{},o)}catch(c){throw c}}else throw"getActiveProjectModelGroups called without active project"}function Kk(n){if(n){const e=Object.keys(n),t=[];let r=0;e.forEach(i=>{n[i].name||(n[i].name=i),n[i].description||(n[i].description="..."),n[i].$synced||r++,t.push(n[i])}),mn.setState({modelGroups:t,unsyncedCount:r})}}async function xN(n=!1){if(Re.getState().selectedProject){const t=await Yk(n);Kk(t)}}function Rhe(n){return new Worker(""+new URL("syncWorker-BrxNulNk.js",import.meta.url).href,{name:n==null?void 0:n.name})}async function Nhe(){return new Promise(async(n,e)=>{const t=new Rhe,r=Um(t),i=new r,o=setTimeout(()=>{e("timeout")},1e3),s=await Promise.resolve(i);clearTimeout(o),n([s,t])})}let cy=0;const c4=10;async function Ihe(n,e,t,r){var s;const i=Object.keys(t);i.sort();const o=[];for(let a=0;a<i.length;a++)try{const l=i[a],c=t[l],u=await Ll(c.container_override||n),[h,f]=await Nhe();if(cy>c4)for(;cy>c4-1;)await JI(2);cy++;const m=h.downloadFromAzure(((s=u.data)==null?void 0:s.token)||"no-sas-access",e,c.container_override||n,l,c.glb_url).then(g=>{r(g),h[lI](),f.terminate(),cy--});o.push(m)}catch(l){console.error(l),r("")}await Promise.all(o)}function Phe(n){const e=pE(n);new Oi(e).deleteDB()}function khe(n){const e=M1(n);new Oi(e).deleteDB()}async function E0(n,e,t){const r=Re.getState().selectedProject;if(r){const i=await Yk(!1);if(i){ke.getState().activateLoadingData(),ke.setState({dialogHeader:"Syncing Models"});let o=0;const s=m_(r),a=new Oi(s);let l=n?i:{};if(!n)for(const m in i){const g=i[m];g.$synced||(l[m]=g)}const c=Object.keys(l).length;ke.setState({dialogContent:"downloading"});let u=!1,h=0;c&&(Phe(Re.getState().selectedProject),khe(Re.getState().selectedProject));const f=await a.getJsonKey(s);return await Ihe(r.container,s,l,async m=>{o++,m?(i[m].$synced=!0,f[m].$synced=!0,await a.setJsonKey(s,f),ke.setState({dialogContent:`Synced ${o}/${c}
We only sync sites with changes.`})):(u=!0,h++)}),u&&t!==!0&&(Fn.setState({activated:!0,header:"Sync error",message:[`${h} model groups had errors while trying to download.`,"This might be due to network issues or low diskspace",'Please click "Sync & Load" to try again'].join(`
`)}),ke.setState({loadingData:!1})),Kk(i),mn.getState().unsyncedCount>0&&t!==!0?mn.getState().activateSyncDialog():await O1(r,!1,!0,!1),u}}}function Lhe(){const n=[];W().getSceneController().getMeshes().forEach(t=>{var i;const r=(i=t.$geometry.boundingBox)==null?void 0:i.clone();r&&n.push(r)}),W().getSceneController().addOccludeTesters(n),W().forceRenderNextFrame()}async function Ohe(){const n=await ae.get_bounding_boxes_from_selection(),e=[];n.forEach(r=>{e.push(new nt(new N(r.x_min,r.y_min,r.z_min),new N(r.x_max,r.y_max,r.z_max)))}),W().getSceneController().addOccludeTesters(e),W().forceRenderNextFrame()}function Dhe(){const n=W().getSceneController(),e=[];n.getOccluders().forEach(t=>{e.push({minMaxArr:[t.min.x,t.min.y,t.min.z,t.max.x,t.max.y,t.max.z],autoSplit:!0})}),console.log(JSON.stringify(e))}window.injectOccuders=function(n){const e=JSON.parse(n),t=[];e.forEach(r=>{if(Array.isArray(r.minMaxArr)&&r.minMaxArr.length===6)if(r.autoSplit){const i=L1(new nt().setFromArray(r.minMaxArr),0,r.maxDepth);i!=null&&i.length&&i.forEach(o=>t.push(o))}else t.push(new nt().setFromArray(r.minMaxArr))}),t.length&&W().getSceneController().addOccludeTesters(t)};function Uhe(){W().getSceneController().showOccludeVolumes(),W().forceRenderNextFrame()}function Fhe(){W().getSceneController().hideOccludeVolumes(),W().forceRenderNextFrame()}function jhe(){W().getSceneController().clearOccluders()}let S2=!1;function Bhe(){const n=W().getSceneController();S2=!S2,n.forceOccludeOn(S2);const e=new N;e.x=e.x+1e-6,W().getActiveControls().getPosition(e),W().getActiveControls().setPosition(e.x,e.y,e.z,!1),W().forceRenderNextFrame()}async function D7(n=!1){const e=Xe.getState();if(!e.maxX)return;console.log("NEW BOX"),console.log([e.minX,e.minY,e.minZ,e.maxX,e.maxY,e.maxZ]);let t=L1(new nt(new N(e.minX,e.minY,e.minZ),new N(e.maxX,e.maxY,e.maxZ)));const r=W().getSceneController();n&&(t=t.concat(r.getCurrentOccludeBoxes())),r.addOccludeTesters(t),W().forceRenderNextFrame()}function L1(n,e=0,t=2){const r=[];r.length||r.push(n);const i=zhe(n,e+1,t);if(i)for(let o=0;o<i.length;o++){const s=i[o];r.push(i[o]);const a=L1(s,e+1,t);a&&a.forEach(l=>{r.push(l)})}return r}function zhe(n,e,t=1){if(e===t)return null;const r=n.min.x,i=n.min.y,o=n.min.z,s=n.max.x,a=n.max.y,l=n.max.z,c=(r+s)*.5,u=(i+a)*.5,h=(o+l)*.5,f=[],m=s-r,g=a-i,_=l-o;return m>20&&g>20&&_>20&&(f.push(new nt(new N(r,i,o),new N(c,u,h))),f.push(new nt(new N(c,i,o),new N(s,u,h))),f.push(new nt(new N(r,u,o),new N(c,a,h))),f.push(new nt(new N(c,u,o),new N(s,a,h))),f.push(new nt(new N(r,i,h),new N(c,u,l))),f.push(new nt(new N(c,i,h),new N(s,u,l))),f.push(new nt(new N(r,u,h),new N(c,a,l))),f.push(new nt(new N(c,u,h),new N(s,a,l)))),m<20&&g>20&&_>20&&(f.push(new nt(new N(r,i,o),new N(s,u,h))),f.push(new nt(new N(r,i,h),new N(s,u,l))),f.push(new nt(new N(r,u,o),new N(s,a,h))),f.push(new nt(new N(r,u,h),new N(s,a,l)))),m<20&&m>20&&_>20&&(f.push(new nt(new N(r,i,o),new N(c,a,h))),f.push(new nt(new N(r,i,h),new N(c,a,l))),f.push(new nt(new N(c,i,o),new N(s,a,h))),f.push(new nt(new N(c,i,h),new N(s,a,l)))),m<20&&g>20&&_<20&&(f.push(new nt(new N(r,i,o),new N(s,u,l))),f.push(new nt(new N(r,u,o),new N(s,a,l)))),m>20&&g<20&&_<20&&(f.push(new nt(new N(r,i,o),new N(c,a,l))),f.push(new nt(new N(c,i,o),new N(s,a,l)))),m>20&&g>20&&_<20&&(f.push(new nt(new N(r,i,o),new N(s,u,l))),f.push(new nt(new N(r,u,o),new N(s,a,l))),f.push(new nt(new N(r,i,o),new N(c,a,l))),f.push(new nt(new N(c,i,o),new N(s,a,l)))),m<20&&g<20&&_>20&&(f.push(new nt(new N(r,i,o),new N(s,a,h))),f.push(new nt(new N(r,i,h),new N(s,a,l)))),f}async function O1(n,e=!0,t=!0,r=!0){var i;if(ke.setState({loadingData:!0,dialogContent:"Please wait while loading data",dialogHeader:"Loading project"}),Re.setState({selectedProject:n}),await v_(),n){const o=Re.getState().selectedProject;if(o!=null&&o.controllerPosition&&(o!=null&&o.controllerTarget)){const a=Re.getState().selectedLayer,l=(a==null?void 0:a.controllerTarget)||(o==null?void 0:o.controllerTarget),c=(a==null?void 0:a.controllerPosition)||(o==null?void 0:o.controllerPosition);await W().getActiveControls().setLookAt(c[0],c[1],c[2],l[0],l[1],l[2],!1)}const s=await Yk(r).catch(a=>{ke.setState({loadingData:!1}),Re.setState({isOpen:!0}),Mz(a)});if(Kk(s||null),mn.getState().unsyncedCount>0&&e)await E0(!1);else if(s&&t){ke.setState({loadingData:!0,dialogContent:`Please wait 
 Generating data 
 Speed of this depends on model size`,dialogHeader:"Loading metadata"}),await ae.clear();const a=new Promise(async c=>{var h;const u=((h=mn.getState().modelGroups)==null?void 0:h.slice())||[];if(u!=null&&u.length){async function f(){const m=u.pop();if(ke.setState({loadingData:!0,dialogContent:`Please wait 
 Generating data 
 Speed of this depends on model size
 Data to generate:`+u.length,dialogHeader:"Loading metadata"}),m&&m.$synced)ae.add_model_groups([m],o).then(()=>{f()});else{if(!m){c(null);return}f()}}f()}else c(null)});await xN(!0),await Promise.all([a]),ke.setState({loadingData:!0,dialogContent:`Please wait 
 preparing volumnes`,dialogHeader:"Loading metadata"}),W().getSceneController().clearOccluders();const l=(i=Re.getState().selectedProject)==null?void 0:i.occlusionCullingBoxes;if(Array.isArray(l)){const c=[];l.forEach(u=>{if(Array.isArray(u.minMaxArr)&&u.minMaxArr.length===6)if(u.autoSplit){const h=L1(new nt().setFromArray(u.minMaxArr),0,u.maxDepth);h!=null&&h.length&&h.forEach(f=>c.push(f))}else c.push(new nt().setFromArray(u.minMaxArr))}),c.length&&W().getSceneController().addOccludeTesters(c)}await ae.all_sites_loaded(),rr.setState({treeViewActive:!gF}),await ae.treeview_reset_rows(),ke.setState({loadingData:!1,dialogContent:"",dialogHeader:""})}}Re.setState({isOpen:!1})}async function Vv(n){var r;const e=(r=mn.getState().modelGroups)==null?void 0:r.filter(i=>i.load_by_default);if(Re.getState().selectedProject&&(e!=null&&e.length)){ke.setState({loadingData:!0,dialogContent:"please wait, depends on hardware/model details",dialogHeader:"Loading"});let i=0;const o=[],s=performance.now();for(let a=0;a<e.length;a++)e[a].load_by_default&&e[a].$loaded!==!0&&e[a].$synced===!0&&o.push(cE(m_(Re.getState().selectedProject),e[a].name).then(()=>{ke.setState({loadingData:!0,dialogContent:`${i}/${e.length-1}`}),W().forceRenderNextFrame(),e[a].$loaded=!0,i++}).catch(l=>{console.error(e[a].name,l)}));await Promise.all(o),console.log("Loadingtime",performance.now()-s),await zi(!0),Pe.getState().showAllWhenStill&&await ae.reset_culling_all_meshes(),ke.setState({loadingData:!1,dialogContent:"",dialogHeader:"Loading"})}}async function U7(){var r;const n=Gt.getState(),e=n.currentSet.colorOverride.length&&n.currentSet.colorOverride||[];e.length===0&&e.push({uuid:"na",name:"!RESET!",color:"white",operator:"Equal"});const t=((r=Re.getState().selectedProject)==null?void 0:r.project_key)||"unknown";n.setProjectKey(t),await ae.filter_geometry([],e),await ae.selection_append(),W().forceRenderNextFrame()}function D1(n){n?document.title=`WEB-3D - ${n}`:document.title="WEB-3D"}async function F7(n,e,t=!1,r){var o,s,a,l;ke.setState({loadingData:!0,dialogContent:"please wait",dialogHeader:""});const i=r||await Che(n,e).catch(()=>(ke.setState({loadingData:!1,dialogContent:"",dialogHeader:""}),Re.setState({isOpen:!0}),Fn.setState({activated:!0,header:"Error",message:"unable to find set"}),null));if(i&&(Array.isArray(i.filter)||(i.filter=[]),Array.isArray(i.siteFilter)&&(delete i.lvl3Filter,delete i.lvl3Filter,delete i.lvl3Filter,delete i.siteFilter,delete i.zoneFilter,delete i.itemFilter),(o=i.viewPoints)==null||o.forEach(c=>{c.uuid||(c.uuid=er())}),(s=i.colorOverride)==null||s.forEach(c=>{c.uuid||(c.uuid=er())}),(a=i.filter)==null||a.forEach(c=>{c.forEach(u=>{u.uuid||(u.uuid=er())})}),i.version===void 0&&i.layerFilter&&Array.isArray(i.layerFilter.groups)&&(i.layerFilter.groups=i.layerFilter.groups.map(c=>c&&!c.endsWith("*")?c+"*":c)),await $k(),ke.setState({loadingData:!0,dialogContent:"",dialogHeader:""}),i!=null&&i.projectKey)){const c=Re.getState().allProjects.filter(f=>f.unique_key===(i==null?void 0:i.projectKey))[0],u=await zP(c.container,c.config,c.unique_key,c.plant_code,c.plant_name);if(!u){Fn.setState({activated:!0,header:"Unable to get project data",message:"Missing access"}),ke.setState({loadingData:!1});return}Re.setState({selectedProject:u,projectSelectedKey:c.unique_key,projectSelectedCode:c.plant_code,projectSelectedName:c.plant_name}),!EG&&(i!=null&&i.layerFilter)&&Re.setState({selectedLayer:i==null?void 0:i.layerFilter,selectedLayerTitle:`${c.plant_code} - ${c.plant_name} - ${(l=i==null?void 0:i.layerFilter)==null?void 0:l.description}`}),TG&&(i!=null&&i.setFilter)&&Re.setState({selectedLayer:i==null?void 0:i.setFilter,selectedLayerTitle:`${c.plant_code} - ${c.plant_name} - SET_FILTER USED`});const h=Re.getState().selectedProject;if(h&&(h==null?void 0:h.project_key)===(i==null?void 0:i.projectKey)){await O1(h),D1(h.plant_code),ke.setState({loadingData:!0,dialogContent:"",dialogHeader:""}),ke.setState({loadingData:!0,dialogContent:"please wait",dialogHeader:""}),Gt.setState({currentSet:i,isOpen:!0,editMode:!1,activeTab:"VIEWPOINT"});const f=Gt.getState();if(W().disableRender(),i.filter.length){const g=await ae.filter_geometry(f.currentSet.filter,[]);Pi.add(g),await Pi.load(!1,!1,i.UUID),await ae.filter_geometry([],f.currentSet.colorOverride),await ae.selection_append()}t&&i.filter.length===0&&Pi.getkeys().length===0&&await Vv(),ke.setState({loadingData:!0,dialogContent:"Applying colors",dialogHeader:""}),i.filter.length===0&&(await U7(),await ae.selection_clear(!0)),W().enableRender(),ke.setState({loadingData:!1,dialogContent:"please wait",dialogHeader:""}),W().getSceneController().updateBB(),rr.setState({treeViewActive:!0});const m=f.currentSet.viewPoints[0];if(m){W().setCameraMode(m.cameraType==="PerspectiveCamera"?"3D":"2D"),De.setState({z_plane_visible:m.z_plane_visible,y_plane_visible:m.y_plane_visible,x_plane_visible:m.x_plane_visible,z_plane_enable:m.z_plane_enable,y_plane_enable:m.y_plane_enable,x_plane_enable:m.x_plane_enable,z_plane_neg:m.z_plane_neg,y_plane_neg:m.y_plane_neg,x_plane_neg:m.x_plane_neg,z_plane_offset:m.z_plane_offset,y_plane_offset:m.y_plane_offset,x_plane_offset:m.x_plane_offset}),m.boxClippingEnabled?Xe.setState({enabled:!0,transformHelperEnabled:!1,minX:m.boxClippingMinX,minY:m.boxClippingMinY,minZ:m.boxClippingMinZ,maxX:m.boxClippingMaxX,maxY:m.boxClippingMaxY,maxZ:m.boxClippingMaxZ}):Xe.setState({enabled:!1,transformHelperEnabled:!1}),Xt.updateClipShader(),Xt.updateClippingHelper(),W().getActiveControls().smoothTime=.5,W().getActiveControls().saveState(),m.cameraType!=="PerspectiveCamera"&&m.zoom!==void 0&&(W().getActiveControls()._zoomEnd=m.zoom);const g=W().getActiveControls().setLookAt(m.controllerPosition[0],m.controllerPosition[1],m.controllerPosition[2],m.controllerTarget[0],m.controllerTarget[1],m.controllerTarget[2],!0);let _=null;m.selectedFullName&&(_=ae.get_ids_from_fullnames([m.selectedFullName]).then(async v=>{if(v.length){await ae.selection_clear(!1),await ae.treeview_collapse(),await ae.selection_add(v),await ae.treeview_expand_from_id(v[0]),await ae.selection_append();const p=ae.getRowOfKey(v[0]);Pt.getState().updateToggel(p),Km(v[0],!1)}})),await Promise.all([g,_])}else{W().setCameraMode("3D"),De.setState({z_plane_enable:!1,y_plane_enable:!1,x_plane_enable:!1}),Xe.setState({enabled:!1,transformHelperEnabled:!1});const g=Re.getState().selectedProject;if(g!=null&&g.controllerPosition&&(g!=null&&g.controllerTarget)){const _=Re.getState().selectedLayer,v=(_==null?void 0:_.controllerTarget)||(g==null?void 0:g.controllerTarget),p=(_==null?void 0:_.controllerPosition)||(g==null?void 0:g.controllerPosition);await W().getActiveControls().setLookAt(p[0],p[1],p[2],v[0],v[1],v[2],!1)}else W().fitModelToCanvas(!0)}W().getActiveControls().smoothTime=1,W().getActiveControls().saveState();return}}}function Hhe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Unloads model
Reloads metadata for project
Regenerate set editor model`,onClick:()=>{var e,t;const n=Gt.getState();n.currentSet.UUID&&((t=(e=n.currentSet)==null?void 0:e.filter)==null?void 0:t.length)>0&&(v_(),Pi.clear(),F7(n.currentSet.UUID,pE(Re.getState().selectedProject),!1,n.currentSet))},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),d.jsx("span",{className:"text-center text-xs",children:"Reload"})]})}function Vhe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Unloads model displayed model generated by set editor",onClick:()=>{Pi.unload()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Unload"})]})}function Ghe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Unloads model
And clears everything created in set editor`,onClick:async()=>{Gt.getState().clearSet(),Pi.unload(),await ae.selection_clear(!0)},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d.jsx("span",{className:"text-center text-xs",children:"Clear"})]})}function Whe(){const n=su();return d.jsx("div",{className:"flex",children:d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{su.setState({isPointToPointDialogActive:!n.isPointToPointDialogActive})},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M19.875 12c.621 0 1.125 .512 1.125 1.143v5.714c0 .631 -.504 1.143 -1.125 1.143h-15.875a1 1 0 0 1 -1 -1v-5.857c0 -.631 .504 -1.143 1.125 -1.143h15.75z"}),d.jsx("path",{d:"M9 12v2"}),d.jsx("path",{d:"M6 12v3"}),d.jsx("path",{d:"M12 12v3"}),d.jsx("path",{d:"M18 12v3"}),d.jsx("path",{d:"M15 12v2"}),d.jsx("path",{d:"M3 3v4"}),d.jsx("path",{d:"M3 5h18"}),d.jsx("path",{d:"M21 3v4"})]}),d.jsx("span",{className:"text-center text-xs",children:"Line/Path"})]})})}let $he=0;function Yhe(){var e,t;const n=Re();if((e=n.selectedProject)!=null&&e.tools){const r=Object.keys((t=n.selectedProject)==null?void 0:t.tools);return d.jsx(d.Fragment,{children:r.map((i,o)=>{var a,l;const s=(l=(a=n.selectedProject)==null?void 0:a.tools)==null?void 0:l[i];return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{var c,u,h;if(n.selectedProject){const f=`${i}:${$he++}`;(c=n.selectedProject)!=null&&c.activeTools?n.selectedProject.activeTools.indexOf(i)!==-1||(Array.isArray((u=n.selectedProject)==null?void 0:u.activeTools)?n.selectedProject.activeTools.push(f):n.selectedProject.activeTools=[f]):Array.isArray((h=n.selectedProject)==null?void 0:h.activeTools)?n.selectedProject.activeTools.push(f):n.selectedProject.activeTools=[f],Re.setState({selectedProject:null}),Re.setState({selectedProject:n.selectedProject})}},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})}),d.jsx("span",{className:"text-center text-xs",children:s==null?void 0:s.tabButtonName})]},r[o])})})}return d.jsx("div",{className:"m-auto p-2",children:"No Tools configured for project"})}function Khe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{console.log("--------------------------------------------------------------------"),console.log("These can be added to project json");const n=new N;W().getActiveControls().getTarget(n);const e=new N;W().getActiveControls().getPosition(e),console.log("--------------------------------------------------------------------");const t=JSON.stringify({controllerTarget:[n.x,n.y,n.z],controllerPosition:[e.x,e.y,e.z]}),r=t.slice(1,t.length-1);console.log("Target/position:"),console.log({data:r}),console.log("--------------------------------------------------------------------");const i=Xe.getState();if(i.enabled){const o=JSON.stringify({boundingbox:[i.minX,i.minY,i.minZ,i.maxX,i.maxY,i.maxZ]}),s=o.slice(1,o.length-1);console.log("BOUNDINGBOX:"),console.log({data:s}),console.log("--------------------------------------------------------------------")}},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 min-h-[30px] w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),d.jsx("span",{className:"ml-2 mr-2 text-center text-xs",children:"print target and position"})]})}function Xhe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Opens/closes the set editor",onClick:()=>{const n=Gt.getState().isOpen;Gt.setState({isOpen:!n})},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Set Editor"})]})}async function U1(){await ae.selection_set_color("green:0"),Pt.getState().updateToggel()}async function qhe(){await ae.hide_not_selected(),Pt.getState().updateToggel()}async function j7(){await ae.selection_reset(!1,!1,!0,!1),Pt.getState().updateToggel()}async function Xk(){await ae.unhide_all(),Pt.getState().updateToggel()}function Qhe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["Hides selected items, shortcut H"].join(`
`),onClick:async()=>{U1()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"})}),d.jsx("span",{className:"text-center text-xs",children:"Hide"})]})}async function qk(){await ae.selection_reset(!0,!1,!1,!0),Pt.getState().updateToggel()}async function Zhe(){await ae.selection_reset(!1,!0,!1,!1),Pt.getState().updateToggel()}function Jhe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Resets colors of selected back to original color",onClick:async()=>{qk()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 min-h-[30px] w-4",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"ml-2 mr-2 text-center text-xs",children:"Reset Sel"})]})}function efe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{await ae.selection_set_color("white:25"),await Pt.getState().updateToggel()},"data-tooltip":`Sets selected to 25% opacity. Opacity higher than 10% is selectable by default.
To select through transparent hold SHIFT key down.`,children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 min-h-[30px] w-4",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"ml-2 mr-2 text-center text-xs",children:"(0.25)"})]})}async function Qk(){await ae.selection_invert(),Pt.getState().updateToggel()}function tfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Inverts selection",onClick:async()=>{Qk()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 min-h-[30px] w-4",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"ml-2 mr-2 text-center text-xs",children:"Invert Sel"})]})}async function B7(){await ae.selection_set_color("white:10"),await Pt.getState().updateToggel()}function nfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{B7()},"data-tooltip":`Sets selected to 10% opacity. Opacity 10% or less is not selectable by default.
To select transparent 10% or less hold SHIFT key down.`,children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 min-h-[30px] w-4",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"ml-2 mr-2 text-center text-xs",children:"(0.10)"})]})}async function z7(){const n=rr.getState().allowSelectionOfHidden;ae.selection_allow_selection_of_hidden(!n),rr.setState({allowSelectionOfHidden:!n}),await ae.selection_append(),Pt.getState().updateToggel()}function rfe(){const n=rr();let e="text-red-500 min-h-[30px] h-5 w-5 ";return n.allowSelectionOfHidden&&(e="text-green-500 min-h-[30px] h-5 w-5 "),d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["Allow selection of hidden i treeview or when doing invert selection","They will show with selectino color, and be hidden when deselecting"].join(`
`),onClick:async()=>{z7()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zM12 2.25V4.5m5.834.166l-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243l-1.59-1.59"})}),d.jsx("span",{className:"text-center text-xs",children:"Hidden"})]})}function ife(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"TEST"})]})}function ofe(){const n=dm();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.mode==="2D"&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer"),d.jsxs("div",{className:e,onClick:()=>{W().setCameraMode("2D"),W().fitModelToCanvas(),W().forceRenderNextFrame()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"})}),d.jsx("span",{className:"text-center text-xs",children:"Orthographic"})]})}function sfe(){const n=dm();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.mode==="3D"&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer"),d.jsxs("div",{className:e,onClick:()=>{W().setCameraMode("3D"),W().fitModelToCanvas(),W().forceRenderNextFrame()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"})}),d.jsx("span",{className:"text-center text-xs",children:"Perspective"})]})}function afe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{W().setGizmoAxis("-x")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"West"})]})}function lfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{W().setGizmoAxis("x")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"East"})]})}function cfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{W().setGizmoAxis("y")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"North"})]})}function ufe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{W().setGizmoAxis("-y")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"South"})]})}function dfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{W().setGizmoAxis("-z")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Down"})]})}function hfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{W().setGizmoAxis("z")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Up"})]})}function ffe(){const n=Xe();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.enabled&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":"Toggle axes info on/off.",onClick:async()=>{Xt.toggleClipping()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 3.75H6.912a2.25 2.25 0 00-2.15 1.588L2.35 13.177a2.25 2.25 0 00-.1.661V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 00-2.15-1.588H15M2.25 13.5h3.86a2.25 2.25 0 012.012 1.244l.256.512a2.25 2.25 0 002.013 1.244h3.218a2.25 2.25 0 002.013-1.244l.256-.512a2.25 2.25 0 012.013-1.244h3.859M12 3v8.25m0 0l-3-3m3 3l3-3"})}),d.jsx("span",{className:"text-center text-xs",children:n.enabled?"Disable":"Enable"})]})}function u4(){const n=Xe();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.transformHelperEnabled&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":`Toggle scale/move tools on/off. 
Shortcut for this is X.`,onClick:async()=>{Xt.toggleTransformHelper()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Tool toggle"})]})}function d4(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Resizes clippingbox to selected. 
Shortcut for this is F.`,onClick:async()=>{Xe.getState().enabled||Xt.toggleClipping();const e=await Xt.resizeToSelected(),t=new N;e.getCenter(t),W().setOrbitOn(t)},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Fit Selected"})]})}function h4(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Toggle between transform mode translate and scale. 
Sortcut for this is M`,onClick:async()=>{Xt.toggleMode()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-2.25-2.25l3.276-3.276a4.5 4.5 0 00-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437l1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008z"})}),d.jsx("span",{className:"text-center text-xs",children:"Tool Mode"})]})}function f4(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Resizes clippingbox to selected. 
No shortcut for this`,onClick:async()=>{Xe.getState().enabled||Xt.toggleClipping(),Xt.resizeToLoaded()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})}),d.jsx("span",{className:"text-center text-xs",children:"Fit Loaded"})]})}function pfe(){const n=Vn();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.enabled&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":"Enable/Disable transform tools",onClick:async()=>{n.enabled?Rr.disable():Rr.enable()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:n.enabled?"Disable":"Enable"})]})}let E2=!1;function mfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{E2=!E2,W().__sceneController.getMeshes().map(n=>n.$setPicking?n.$setPicking(E2,!1):null),W().forceRenderNextFrame()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 min-h-[30px] w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),d.jsx("span",{className:"ml-2 mr-2 text-center text-xs",children:"toggel picking colors"})]})}function gfe(){const n=Vn();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.mode==="rotate"&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":"Set transform tool to rotation",onClick:async()=>{const t="rotate";Vn.setState({mode:t}),Rr.toggleMode(t)},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Rotate"})]})}function vfe(){const n=Vn();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.mode==="scale"&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":"Set transform tool to scaling",onClick:async()=>{const t="scale";Vn.setState({mode:t}),Rr.toggleMode(t)},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Scale"})]})}function _fe(){const n=Vn();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.mode==="translate"&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":"Set transform tool to transform",onClick:async()=>{const t="translate";Vn.setState({mode:t}),Rr.toggleMode(t)},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Translate"})]})}function xfe(){const n=Vn();return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Resets selected back to original position",onClick:async()=>{Zhe(),n.enabled&&(Rr.disable(),Rr.enable())},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),d.jsx("span",{className:"text-center text-xs",children:"Reset Sel."})]})}function yfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{await Ohe()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Set selection as occluders (only use volume)"})]})}function wfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{Bhe()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Force Toggle Occulders on/off"})]})}function Sfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{Fhe()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Hide Occluders"})]})}function Efe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{Uhe()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Show Occluders"})]})}function Tfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{Lhe()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Set sites as occluders"})]})}function Cfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{jhe()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Clear all occluders"})]})}function bfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{D7()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Set clipbox as occluders (replace)"})]})}function Afe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{D7(!0)},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Set clipbox as occluders (add)"})]})}function Mfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{Dhe()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Print Occulders To Console"})]})}function Rfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await u7()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 2X"})]})}function Nfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await d7()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 3X"})]})}function Ife(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await uue()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 2X"})]})}function Pfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await hue()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 3X"})]})}function kfe(){const n=Xe();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.lineHelperEnabled&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":`Toggle box lines on/off. 
`,onClick:async()=>{Xt.toggleLineHelper()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Box toggle"})]})}function Lfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await cue()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 2X"})]})}function Ofe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await due()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 3X"})]})}function Dfe(){const n=Xe();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.axisHelperEnabled&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":`Toggle scale/move tools on/off. 
Shortcut for this is X.`,onClick:async()=>{Xt.toggleAxisHelper()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Axis toggle"})]})}function Ufe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Undo last transform if any",onClick:async()=>{await ae.undo_transform(),Rr.updateClippingHelper()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Undo last"})]})}function Ffe(){const[n,e]=O.useState("zoom");return dm().mode!=="2D"?null:d.jsxs("div",{"data-tooltip":["You might need dolly mode if you start getting clipping issues","Model will also start turning dark","This might happend due to angle/camera offset when using left button rotate mode"].join(`
`),className:"w-25 pointer-events-auto m-2 flex cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{const i=W().__controls2d;i.mouseButtons.wheel===Fr.ACTION.ZOOM?(i.mouseButtons.wheel=Fr.ACTION.DOLLY,e("dolly")):(i.mouseButtons.wheel=Fr.ACTION.ZOOM,e("zoom")),i.saveState()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"})}),d.jsxs("span",{className:"text-center text-xs",children:["Wheel ",n]})]})}function jfe(){const[n,e]=O.useState("pan");return dm().mode!=="2D"?null:d.jsxs("div",{className:"w-25 pointer-events-auto m-2 flex cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{const i=W().__controls2d;i.mouseButtons.left===Fr.ACTION.TRUCK?(i.mouseButtons.left=Fr.ACTION.ROTATE,e("rotate")):(i.mouseButtons.left=Fr.ACTION.TRUCK,e("pan")),i.saveState()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"})}),d.jsxs("span",{className:"text-center text-xs",children:["left ",n]})]})}function Bfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["Hides unselected items, shortcut J"].join(`
`),onClick:async()=>{j7()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"})}),d.jsx("span",{className:"text-center text-xs",children:"Unhide"})]})}function zfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["Unhides manualy hidden before, shortcut K"].join(`
`),onClick:async()=>{Xk()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"})}),d.jsx("span",{className:"text-center text-xs",children:"Unhide All"})]})}async function mE(){const n=Re.getState().selectedProject;if(n!=null&&n.controllerPosition&&(n!=null&&n.controllerTarget)){v_(),await ae.selection_clear(!0);const e=Re.getState().selectedLayer,t=(e==null?void 0:e.controllerTarget)||(n==null?void 0:n.controllerTarget),r=(e==null?void 0:e.controllerPosition)||(n==null?void 0:n.controllerPosition);await W().getActiveControls().setLookAt(r[0],r[1],r[2],t[0],t[1],t[2],!1),await Vv()}else await Vv(),W().fitModelToCanvas(!0);W().getSceneController().updateBB(),fN.clear(),Pt.setState({update:!0})}function p4(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":`Loads model, if model is already loaded,
model will be unloaded/loaded.
This only loads groups set to load by default`,onClick:async()=>{await mE()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Load"})]})}const fl=mr(n=>({isOpen:!1,activeTab:"ITEM",toggleOpen:()=>{n(e=>({isOpen:!e.isOpen}))}}));function Hfe(){const n=fl();return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["Opens attribute dialog"].join(`
`),onClick:()=>{n.toggleOpen()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),d.jsx("span",{className:"text-center text-xs",children:"Attributes"})]})}function Vfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{await ae.selection_set_color("black:10"),await Pt.getState().updateToggel()},"data-tooltip":`Sets selected to 10% opacity. Opacity 10% or less is not selectable by default.
To select transparent 10% or less hold SHIFT key down.`,children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 min-h-[30px] w-4 text-black",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"ml-2 mr-2 text-center text-xs",children:"(0.10)"})]})}function Gfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:async()=>{await ae.selection_set_color("black:25"),await Pt.getState().updateToggel()},"data-tooltip":`Sets selected to 25% opacity. Opacity higher than 10% is selectable by default.
To select through transparent hold SHIFT key down.`,children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"black",className:"text-greay-900 h-4 min-h-[30px] w-4",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"ml-2 mr-2 text-center text-xs",children:"(0.25)"})]})}function Wfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["Resets colors of all back to original color.","This also unhides if hidden.","It does not reset transforms"].join(`
`),onClick:async()=>{await ae.reset_all_meshes(!0,!1,!0,!0),Pt.getState().updateToggel()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 min-h-[30px] w-4",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"ml-2 mr-2 text-center text-xs",children:"Reset All"})]})}function $fe(){const n=Vn();return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Resets selected back to original position",onClick:async()=>{await ae.reset_all_meshes(!1,!0,!1,!1),n.enabled&&(Rr.disable(),Rr.enable()),Pt.getState().updateToggel()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),d.jsx("span",{className:"text-center text-xs",children:"Reset All"})]})}function Yfe(){return d.jsxs("div",{className:"w-34 pointer-events-auto ml-2 mr-2 flex cursor-pointer items-center rounded pl-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["Hides everything not selected","Does not unhide anything allready hidden"].join(`
`),onClick:async()=>{qhe()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-4 min-h-[30px] w-4",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"ml-2 mr-2 text-center text-xs",children:"Not Sel"})]})}function Kfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":["Export Selected full names as txt, does not include hidden","If you hold in SHIFT key it only exports selected with color set to white","This will also inlude all parents/not correct order per element"].join(`
`),onClick:async n=>{if(typeof showSaveFilePicker!="function"){Fn.setState({header:"Error",message:"Your browser does not support filesystem Access Api, use newest Chrome/Edge "});return}const e=`selected_fullnames_${new Date().toLocaleDateString("no-NO").replace(".","-")}.txt`,t={types:[{description:"txt",accept:{"text/text":[".txt"]}}],suggestedName:e},r=await showSaveFilePicker(t);ke.setState({loadingData:!0,dialogHeader:"please wait",dialogContent:"This will close when we are done"});const i=await ae.get_selected_fullnames_from_loaded(n.shiftKey),o=await r.createWritable();await o.write(i.join(`
`)),await o.close(),ke.setState({loadingData:!1})},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),d.jsx("span",{className:"text-center text-xs",children:"Names(sel)"})]})}function Xfe(){const n=Vn();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";if(n.transformOnNextClickEnabled&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),!!n.enabled)return d.jsxs("div",{className:e,"data-tooltip":["When enabled it will move selected to click position","Only works if transform tools is enabled/something is selected"],onClick:async()=>{n.enabled&&Vn.setState({transformOnNextClickEnabled:!n.transformOnNextClickEnabled})},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:n.transformOnNextClickEnabled?"Enabled":"Disabled"})]})}const yN="USER_SELECTION_COLORS",wN=["#FFFFFF","#56565C","#FFFF00","#FF92FF","#9D03FF","#00FF00","#0000FF","#FF0000","#00FFFF","#FFBB01","#9797A4","#3F1F08","#A55116","#333333","#2649A8","#007700"],m4=localStorage.getItem(yN);let Gf=wN.concat([]);if(m4)try{Gf=JSON.parse(m4)}catch(n){n==="x"&&console.log(n)}function qfe(){const[n,e]=O.useState(Gf),[t,r]=O.useState(!1);let i="h-5 min-h-[30px] w-5";return t&&(i="h-5 min-h-[30px] w-5 text-yellow-500"),d.jsxs("div",{className:"pointer-events-auto flex",children:[d.jsx("div",{className:"flex w-[300px] flex-1 flex-wrap gap-1 p-2",children:n.map((o,s)=>d.jsx("input",{style:{appearance:"none",backgroundColor:"transparent"},className:"w-8",type:"color",value:o,onChange:a=>{Gf[s]=a.currentTarget.value,e(Gf.concat([])),localStorage.setItem(yN,JSON.stringify(Gf))},onClick:a=>{t||(a.preventDefault(),ae.selection_set_color(o).then(()=>{Pt.getState().updateToggel()}))},"data-tooltip":"Sets color on selected items"},s))}),d.jsxs("div",{className:"flex flex-col p-2",children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:i,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,"data-tooltip":["Enables edit mode","You can now edit colors to how you want it","Color changes will be remembered user clear it/or browser cache is reset"].join(`
`),onClick:()=>{r(!t)},children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5","data-tooltip":["Resets to original colors"].join(`
`),onClick:()=>{wN.forEach((o,s)=>{Gf[s]=o}),e(wN.concat([])),localStorage.removeItem(yN)},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})})]})]})}const gE=mr(()=>({isOpen:!1}));function Qfe(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900","data-tooltip":"Opens/closes the dialog",onClick:()=>{const n=gE.getState().isOpen;gE.setState({isOpen:!n})},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 min-h-[30px] w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"})}),d.jsx("span",{className:"text-center text-xs",children:"File info"})]})}function Zfe(){var t;const n=v7(),e=Re();switch(n.activeTab){case"HOME":return d.jsxs("div",{className:"flex",children:[d.jsxs($t,{name:e.selectedLayerTitle||"No project/layer selected",children:[e.localMode?d.jsx(d.Fragment,{}):d.jsx(Vue,{}),e.localMode?d.jsx(d.Fragment,{}):d.jsx(Gue,{}),d.jsx(Hue,{}),d.jsx(_7,{}),d.jsx(Jde,{}),d.jsx(Qfe,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsxs($t,{name:"Load and unload all",children:[d.jsx(p4,{}),d.jsx(t4,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsx($t,{name:"Append local file",children:d.jsx(Wde,{})})]});case"SELECTION_TRANSFORM":return d.jsxs("div",{className:"flex",children:[d.jsx($t,{name:"Status",children:d.jsx(pfe,{})}),d.jsxs($t,{name:"Mode",children:[d.jsx(gfe,{}),d.jsx(vfe,{}),d.jsx(_fe,{})]}),d.jsx($t,{name:"Reset Selected",children:d.jsx(xfe,{})}),d.jsx($t,{name:"Undo",children:d.jsx(Ufe,{})}),d.jsx($t,{name:"Reset (no undo)",children:d.jsx($fe,{})}),d.jsx($t,{name:"Transform on next click",children:d.jsx(Xfe,{})}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"})]});case"SELECTION_COLOR":return d.jsxs("div",{className:"flex",children:[d.jsxs($t,{name:"Hidden items",children:[d.jsx(Qhe,{}),d.jsx(Bfe,{}),d.jsx(zfe,{}),d.jsx(rfe,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsx($t,{name:"Quick Coloring, sets color of selected",children:d.jsx(qfe,{})}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsxs($t,{name:"Quick Coloring, with opacity",children:[d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(efe,{}),d.jsx(nfe,{})]}),d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(Gfe,{}),d.jsx(Vfe,{})]})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsx($t,{name:"Color reset",children:d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(Jhe,{}),d.jsx(Wfe,{})]})}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsx($t,{name:"Misc",children:d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(tfe,{}),d.jsx(Yfe,{})]})}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"})]});case"CLIPPING_BOX":return d.jsxs("div",{className:"flex",children:[d.jsxs($t,{name:"Enable/Disable",children:[d.jsx(ffe,{}),d.jsx(u4,{}),d.jsx(h4,{}),d.jsx(kfe,{}),d.jsx(Dfe,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsxs($t,{name:"From Selection - center",children:[d.jsx(f4,{}),d.jsx(d4,{}),d.jsx(Rfe,{}),d.jsx(Nfe,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsxs($t,{name:"From Selection - bottom - 1m",children:[d.jsx(Ife,{}),d.jsx(Pfe,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsxs($t,{name:"From Selection - top - 1m",children:[d.jsx(Lfe,{}),d.jsx(Ofe,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"})]});case"CLIPPING_PLANE":return d.jsxs("div",{className:"flex",children:[d.jsx($t,{name:"West & East",children:d.jsx(Kde,{})}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsx($t,{name:"North & South",children:d.jsx(qde,{})}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsx($t,{name:"Up & Down",children:d.jsx(Zde,{})}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"})]});case"SET":return d.jsxs("div",{className:"flex",children:[d.jsxs($t,{name:"Generate Sharable Model/URL",children:[d.jsx(Hhe,{}),d.jsx(Vhe,{}),d.jsx(Ghe,{}),d.jsx("div",{className:"m-1 min-h-[55px] border-r border-gray-600"}),d.jsx(Xhe,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsxs($t,{name:"Load and unload all",children:[d.jsx(p4,{}),d.jsx(t4,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),(t=Re.getState().selectedProject)!=null&&t.enable_glb?d.jsxs(d.Fragment,{children:[d.jsxs($t,{name:"File export",children:[d.jsx(The,{}),d.jsx(Kfe,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"})]}):d.jsx("div",{})]});case"MEASURE":return d.jsxs("div",{className:"flex",children:[d.jsx($t,{name:"Measurement tools ",children:d.jsx(Whe,{})}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"})]});case"VIEW":return d.jsxs("div",{className:"flex",children:[d.jsxs($t,{name:"Camera Projection",children:[d.jsx(ofe,{}),d.jsx(sfe,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsxs($t,{name:"Viewpoints  (should be used with clipping box only)",children:[d.jsx(hfe,{}),d.jsx(afe,{}),d.jsx(lfe,{}),d.jsx(cfe,{}),d.jsx(ufe,{}),d.jsx(dfe,{})]}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsxs($t,{name:"Mouse behavior",children:[d.jsx(Ffe,{}),d.jsx(jfe,{})]})]});case"TOOLS":return d.jsxs("div",{className:"flex",children:[d.jsx($t,{name:"External Data & Tools",children:d.jsx(Yhe,{})}),d.jsx($t,{name:"Attribute files",children:d.jsx(Hfe,{})}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"})]});case"DEV":return d.jsxs("div",{className:"flex",children:[d.jsx($t,{name:"new project helpers",children:d.jsx("div",{className:"flex flex-col place-content-evenly",children:d.jsx(Khe,{})})}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsx($t,{name:"new project helpers",children:d.jsx("div",{className:"flex flex-col place-content-evenly",children:d.jsx(ife,{})})}),d.jsx("div",{className:"m-1 min-h-[95px] border-r border-gray-600"}),d.jsx($t,{name:"new project helpers",children:d.jsx("div",{className:"flex flex-col place-content-evenly",children:d.jsx(mfe,{})})}),d.jsx($t,{name:"Culling tools clip box",children:d.jsxs("div",{className:"flex place-content-evenly",children:[d.jsx(f4,{}),d.jsx(d4,{}),d.jsx(h4,{}),d.jsx(u4,{})]})}),d.jsxs($t,{name:"Culling Tools",children:[d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(yfe,{}),d.jsx(Tfe,{}),d.jsx(bfe,{}),d.jsx(Afe,{})]}),d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(Sfe,{}),d.jsx(Efe,{})]}),d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(wfe,{}),d.jsx(Cfe,{}),d.jsx(Mfe,{})]})]})]})}return null}function oa(n){const e=v7();function t(i){return e.activeTab===i?"text-gray-300 bg-gray-800  border-r border-gray-400 border-l border-t rounded-t mt-1 font-semibold cursor-pointer ":"text-gray-900 bg-gray-400 mt-1 rounded-t cursor-pointer "}function r(i){const o=i.toLowerCase();return o[0].toUpperCase()+o.substring(1,o.length)}return d.jsx("button",{className:t(n.name)+"ml-1 mr-1 w-28 border-gray-700 text-center text-xs",onClick:()=>{e.setActiveTab(n.name)},children:n.titleOverride||r(n.name)})}function Jfe(){return d.jsxs("div",{className:"pointer-events-auto flex bg-gray-800",children:[d.jsx(oa,{name:"HOME"}),GN?d.jsx(oa,{name:"DEV"}):null,d.jsx(oa,{name:"CLIPPING_PLANE",titleOverride:"Clipping Plane"}),d.jsx(oa,{name:"CLIPPING_BOX",titleOverride:"Clipping Box"}),d.jsx(oa,{name:"MEASURE",titleOverride:"Measure Tools"}),d.jsx(oa,{name:"SELECTION_TRANSFORM",titleOverride:"Selection Transform"}),d.jsx(oa,{name:"SELECTION_COLOR",titleOverride:"Selection Color"}),d.jsx(oa,{name:"VIEW",titleOverride:"Projection & View"}),d.jsx(oa,{name:"SET",titleOverride:"Sets"}),d.jsx(oa,{name:"TOOLS",titleOverride:"Data & Tools"})]})}function epe(){return d.jsxs("div",{className:"flex flex-col bg-gray-800",children:[d.jsx(Jfe,{}),d.jsxs("div",{className:"flex bg-gray-800",children:[d.jsx(Zfe,{}),d.jsxs("div",{className:"flex flex-1",children:[d.jsx("div",{className:"flex flex-1"}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("div",{className:"flex flex-1"}),d.jsxs("div",{className:"flex p-1 text-gray-600",children:["V:","1.29.2"]})]})]})]}),d.jsx("div",{className:"relative bg-yellow-300",children:d.jsx("div",{className:"absolute flex w-full flex-col p-1 text-sm",children:d.jsx(tpe,{})})})]})}function tpe(){const n=De(),e=Xe();return!n.x_plane_enable&&!n.y_plane_enable&&!n.z_plane_enable&&!e.enabled?null:d.jsx(d.Fragment,{children:d.jsx("span",{className:"m-auto bg-gray-900 text-yellow-500",children:"INFO Clipping is enabled"})})}function npe(n){const e={height:"17px",display:"block",overflow:"hidden",width:"100%"};return d.jsx(d.Fragment,{children:n.items.map((t,r)=>d.jsx("div",{style:e,className:"block border-b border-gray-700 text-xs hover:bg-gray-700",onClick:async i=>{const o=await ae.get_ids_from_fullnames([i.target.textContent],!1);if(o.length){await ae.selection_clear(!1);let s=o;Array.isArray(o)&&(s=o,Km(o[0],!1));for(let l=0;l<s.length;l++){const c=s[l];await ae.treeview_expand_from_id(c);const u=await ae.getKeyChildrenFromItem(c);await ae.selection_add(o.concat([c]).concat(u))}await ae.selection_append();const a=ae.getRowOfKey(s[0]);Pt.getState().updateToggel(a)}},children:d.jsx("div",{children:t})},r))})}function rpe(n){return n.active?d.jsx("div",{style:{height:"25px",display:"block",overflow:"hidden",width:"100%"},className:"relative block animate-pulse border-b border-gray-700 p-1 text-xs hover:bg-gray-700",children:"waiting for result, please wait"}):n.results?null:d.jsx("div",{style:{height:"25px",display:"block",overflow:"hidden",width:"100%"},className:"relative block animate-pulse border-b border-gray-700 p-1 text-xs hover:bg-gray-700",children:"found nothing"})}let g4,uy=0,v4="",T2=0;function ipe(){const n=rr(),[e,t]=O.useState([]),[r,i]=O.useState(!1),o=10;if(!n.treeViewActive)return e.length&&t([]),null;if(!n.treeViewSearchActive)return e.length&&t([]),null;let s=e.length*17;e.length===o||e.length===0?s=s+60:s=s+40;async function a(l){uy=uy+1,clearTimeout(g4),bt.flushSync(()=>{i(!0),t([])}),g4=setTimeout(async()=>{const c=uy;v4=l;const[u,h]=await ae.filterFullname(l,T2,o);T2=u.length===o?h:0,c===uy&&(i(!1),t(u))},350)}return d.jsxs("div",{className:"pointer-events-auto flex flex-col overflow-hidden bg-gray-800",style:{width:n.treeViewWidth+"px",minHeight:s+"px"},children:[d.jsx("input",{className:"m-1 inline-block bg-gray-700 p-1 text-gray-300 outline-none","data-tooltip":"Default is equal, you can use * for wildcard, only support wildcard in the start or end",placeholder:"Equal filter, wilcard is * (start/end)",onChange:async l=>{T2=0,a(l.target.value)}}),d.jsxs("div",{className:"mb-1 ml-1 mr-1 w-full whitespace-nowrap text-xs",children:[d.jsx(rpe,{active:r,results:e.length}),d.jsx(npe,{items:e})]}),e.length===o?d.jsxs("button",{className:"m-auto w-full bg-indigo-700",onClick:()=>{a(v4)},children:["Next ",o]}):null]})}function F1(n){nE.add(n)}let H7=new nt;function _4(){return H7}function ope(){F1({handleEvent:async n=>{if(n){const e=await ae.getBoundingBoxFromKey(n.key);e&&e.X!==void 0&&(H7=new nt(new N(e.x,e.y,e.z),new N(e.X,e.Y,e.Z)))}}})}let _f=!1;function spe(){const n=rr(),[e,t]=O.useState(!1);return n.treeViewActive?d.jsx("div",{className:"pointer-events-auto flex bg-gray-800",style:{width:n.treeViewWidth+"px"},children:d.jsxs("div",{className:"flex overflow-hidden",children:[d.jsx("div",{className:"m-1",onClick:()=>{n.treeViewSearchToggle()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Toggle Search",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),d.jsx("div",{className:"m-1",onClick:async()=>{await ae.treeview_collapse()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Collapse Tree",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),d.jsx("div",{className:"m-1",onClick:()=>{if(_4()){const r=new N;_4().getCenter(r),W().getActiveControls().smoothTime=.5,W().getActiveControls().saveState(),W().getActiveControls().setLookAt(r.x+2,r.y+2,r.z+2,r.x,r.y,r.z,!0).then(()=>{W().getActiveControls().smoothTime=1,W().getActiveControls().saveState()})}},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 max-w-6 rotate-45 p-1 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Fly to selected",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}),d.jsx("div",{className:"m-1",onClick:async()=>{if(_f)await ae.selection_show_only_selected(!_f);else{const r=await ae.get_bounding_box_from_selection(),i=new nt(new N(r.x,r.y,r.z),new N(r.X,r.Y,r.Z)),o=new N;i.getCenter(o),await W().setOrbitOn(o),await ae.selection_show_only_selected(!_f)}_f=!_f,t(!e),W().forceRenderNextFrame()},children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:_f?"m-1 h-6 w-6 max-w-6 p-1 text-yellow-500 hover:bg-gray-500":"m-1 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":["Forcus orbit point to selected and hides everything except selected.","Only for quick on/off to find item if you are unable to see it.","Atm this is a quick visual mode only"].join(`
`),strokeWidth:2,children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),d.jsx("div",{className:"m-1",onClick:()=>{W().getActiveControls().smoothTime=.5,W().getActiveControls().saveState(),W().setOrbitOn().then(()=>{W().getActiveControls().smoothTime=1,W().getActiveControls().saveState()})},children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":`Set last clicked point in model as focus point for rotation.
Shortcut for this is O`,strokeWidth:2,children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M18.816 13.58c2.292 2.138 3.546 4 3.092 4.9c-.745 1.46 -5.783 -.259 -11.255 -3.838c-5.47 -3.579 -9.304 -7.664 -8.56 -9.123c.464 -.91 2.926 -.444 5.803 .805"}),d.jsx("path",{d:"M12 12m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"})]})})]})}):null}function ape(){const n=O.useRef(null);return O.useEffect(()=>{const e=n.current;let t,r,i;const o=new ResizeObserver(s=>{for(const a of s)clearTimeout(t),t=setTimeout(()=>{const l=Array.isArray(a.contentRect)?a.contentRect[0]:a.contentRect,c=l.width+(e==null?void 0:e.offsetLeft)||0,u=l.height;W()&&(r!==c||i!==u)&&W().setSize(window.innerWidth,window.innerHeight,0,(e==null?void 0:e.offsetTop)||0)},100)});return e&&o.observe(e),()=>{e&&o.unobserve(e)}}),d.jsx("div",{className:"pointer-events-none fixed z-40 flex h-full w-full",children:d.jsxs("div",{className:"pointer-events-none flex h-full w-full select-none flex-col",children:[d.jsx(epe,{}),d.jsxs("div",{className:"flex flex-grow",style:{minHeight:"0px"},children:[d.jsxs("div",{className:"flex flex-grow flex-col border-b-4 border-gray-900",style:{minHeight:"0px"},children:[d.jsx(spe,{}),d.jsx(ipe,{}),d.jsx(zue,{})]}),d.jsx("div",{ref:n,id:"canvas-tracker",className:"h-full w-full"})]})]})})}function C2(){const n=ke();return n.loadingData?d.jsx("div",{className:"fadeIn fixed z-[9000] grid h-full w-full items-center justify-center bg-gray-600/70",children:d.jsxs("div",{className:"block h-80 w-96 bg-gray-800 shadow-2xl",children:[d.jsx("span",{className:"m-auto block bg-gray-700 p-2 text-center text-2xl text-white",children:"Please wait"}),d.jsx("div",{className:"m-2 mt-10 block",children:d.jsx("span",{className:"loader m-auto block text-center text-white"})}),d.jsx("span",{className:"m-auto block text-center font-semibold text-white underline",children:n.dialogHeader}),d.jsx("span",{className:"m-auto mt-4 block whitespace-pre-line text-center text-white",children:n.dialogContent||""})]})}):null}const x4={};function ev(n,e,t,r,i){function o(){const s=window.innerWidth,a=window.innerHeight;let l=r().bottom,c=r().right,u=r().height,h=r().width;const f=r().closed;clearTimeout(x4[e]),x4[e]=setTimeout(()=>{l+u>a?(l=a-u,l<0&&(l=0,u=a)):l<0&&(l=0,l+u>a&&(l=0,u=a)),c+h>s?(c=s-h,c<0&&(c=0,h=s)):c<0&&(c=0,c+h>s&&(c=0,h=s)),bt.flushSync(()=>{i({height:u,width:h,right:c,bottom:l,initLoaded:!0,closed:f})})},250)}if(t==="open"&&(window.addEventListener("resize",o),!r().initLoaded)){let s=r().bottom,a=r().right,l=r().height,c=r().width;s+l>innerHeight?(s=innerHeight-l,s<0&&(s=0,l=innerHeight)):s<0&&(s=0,s+l>innerHeight&&(s=0,l=innerHeight)),a+c>innerWidth?(a=innerWidth-c,a<0&&(a=0,c=innerWidth)):a<0&&(a=0,a+c>innerWidth&&(a=0,c=innerWidth)),i({height:l,width:c,right:a,bottom:s,initLoaded:!0,closed})}t==="close"&&window.removeEventListener("resize",o)}function jr(n,e,t,r,i=350,o=s=>{}){let s=n==null?void 0:n.clientX,a=n==null?void 0:n.clientY,l=t.bottom,c=t.right,u=t.height,h=t.width;function f(_){var A;let v=_.clientX,p=_.clientY;(A=_.changedTouches)!=null&&A[0]&&(v=_.changedTouches[0].clientX,p=_.changedTouches[0].clientY);const x=window.innerHeight,y=Math.abs(Math.abs(v)-Math.abs(s)),w=Math.abs(Math.abs(p)-Math.abs(a));let C=null,T=null;s>v&&(C="left"),s<v&&(C="rigth"),a>p&&(T="up"),a<p&&(T="down"),s=v,a=p;function S(){T==="up"&&l+u<x&&(u=u+w),T==="down"&&(u=u-w,u<40&&(u=40))}function b(){T==="up"&&(u=u-w,u<40?u=40:l=l+w),T==="down"&&(l=l-w,l<0?l=0:u=u+w)}function R(){const F=window.innerWidth;C==="left"&&(h=h+y,c+h>F&&(h=F-c)),C==="rigth"&&h>i&&(h=h-y)}function E(){C==="left"&&h>i&&(c=c+y,h=h-y,c+h>innerWidth&&(c=innerWidth-h)),C==="rigth"&&(c=c-y,c<0?c=0:h=h+y)}switch(e){case"top":S();break;case"top-left":S(),R();break;case"top-right":S(),E();break;case"left":R();break;case"right":E();break;case"bottom-left":b(),R();break;case"bottom-right":b(),E();break;case"bottom":b();break;case"position":C==="left"&&(c=c+y,c+h>innerWidth&&(c=innerWidth-h)),C==="rigth"&&(c=c-y,c<0&&(c=0)),T==="up"&&(l=l+w,l+u>x&&(l=x-u)),T==="down"&&(l=l-w,l<0&&(l=0));break}bt.flushSync(()=>{r({height:u,width:h,right:c,bottom:l,initLoaded:!0,closed})})}function m(){o(!1);const _=document.getElementsByTagName("iframe");for(let v=0;v<_.length;v++)_[v].style.pointerEvents="auto";window.removeEventListener("touchend",m),window.removeEventListener("touchmove",f),window.removeEventListener("mouseup",m),window.removeEventListener("mousemove",f)}o(!0);const g=document.getElementsByTagName("iframe");for(let _=0;_<g.length;_++)g[_].style.pointerEvents="none";window.addEventListener("touchend",m),window.addEventListener("touchmove",f),window.addEventListener("mouseup",m),window.addEventListener("mousemove",f)}function Gv(n){const e=document.getElementsByClassName("floating-dialog");let t=0;for(let i=0;i<e.length;i++){const o=parseInt(e[i].style.zIndex||"0");t<o&&(t=o)}let r=n.target;for(;r;){if(r!=null&&r.classList.contains("floating-dialog"))for(let i=0;i<e.length;i++)e[i]===r&&(e[i].style.zIndex=(t+1).toString());r=r.parentElement}}function lpe(){document.removeEventListener("mousedown",Gv),document.addEventListener("mousedown",Gv)}const y4=new Map;function V7(n){const[e,t]=O.useState(n.state.height);return n.state.height===40?d.jsx("div",{className:"h-6 w-6 cursor-pointer bg-gray-700 font-semibold text-blue-600 hover:bg-gray-600 focus:outline-none",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",onClick:()=>{if(n.uniqueName){const r=y4.get(n.uniqueName)||150,i=n.state.bottom-r+40;n.setState({...n.state,bottom:i,height:r})}else{const r=n.state.bottom-e+40;n.setState({...n.state,bottom:r,height:e})}},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 5.25l-7.5 7.5-7.5-7.5m15 6l-7.5 7.5-7.5-7.5"})})}):d.jsx("div",{className:"h-6 w-6 cursor-pointer bg-gray-700 font-semibold text-blue-600 hover:bg-gray-600 focus:outline-none",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",onClick:()=>{n.uniqueName&&y4.set(n.uniqueName,n.state.height),t(n.state.height);const r=n.state.bottom+n.state.height-40;n.setState({...n.state,bottom:r,height:40})},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l7.5-7.5 7.5 7.5m-15 6l7.5-7.5 7.5 7.5"})})})}function Rh(n){const e=O.useRef(null),[t,r]=O.useState(),[i,o]=O.useState({height:100,width:100,bottom:0,right:0,initLoaded:!1,closed:!n.isOpen});O.useEffect(()=>{n.isOpen&&Gv({target:e==null?void 0:e.current})},[n.isOpen]),O.useEffect(()=>{if(!t&&n.isOpen){r(1);let l={height:0,width:0,bottom:0,right:0,initLoaded:!1,closed:!n.isOpen};if(n.adjustOnLoad){if(n.width&&n.height){const c=window.innerWidth-n.width,u=window.innerHeight-n.height;l={height:n.height,width:n.width,bottom:Math.floor((u||100)/2),right:Math.floor((c||100)/2),initLoaded:!1,closed:!n.isOpen}}if(n.right&&n.bottom){const c=window.innerWidth-n.right*2;l={height:window.innerHeight-n.bottom*2,width:c,bottom:n.bottom,right:n.right,initLoaded:!1,closed:!n.isOpen}}}else l={height:n.height||i.height,width:n.width||i.width,bottom:n.bottom||i.bottom,right:n.right||i.right,initLoaded:!1,closed:!n.isOpen};o(l),ev({},n.uniqueName,"open",()=>l,o)}else ev({},n.uniqueName,"open",()=>i,o);return()=>{ev({},n.uniqueName,"close",()=>i,o)}});const s={bottom:i.bottom,right:i.right,width:i.width,height:i.height,zIndex:110};if(!n.isOpen)return null;const a=n.isModal?"fixed bg-slate-500/70 top-0 bottom-0 left-0 right-0 z-[1000]":"";return d.jsx("div",{className:a,children:d.jsxs("div",{ref:e,style:s,className:"floating-dialog absolute mb-2 flex select-none flex-col overflow-hidden border border-gray-900 bg-gray-800 p-1 shadow-2xl shadow-black",children:[d.jsxs("div",{className:"z-50 flex cursor-move bg-gray-700",onPointerDown:l=>{Gv({target:e.current}),jr(l,"position",i,o)},children:[d.jsx("span",{className:"m-auto p-1 text-white",children:n.title}),d.jsxs("div",{className:"absolute right-1 flex gap-2",children:[d.jsx(V7,{uniqueName:n.uniqueName,state:i,setState:o}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 bg-gray-700 font-semibold text-blue-600 hover:bg-gray-600 focus:outline-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"close",strokeWidth:2,onClick:()=>{n.onClose({height:i.height,width:i.width,bottom:i.bottom,right:i.right}),r(0)},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]})]}),d.jsx("div",{className:"scrollbar absolute bottom-1 left-1 right-1 top-8 flex",children:n.children}),d.jsxs("div",{className:"absolute bottom-0 left-0 right-0 top-0 z-[-10]",children:[d.jsx("div",{className:"absolute right-0 top-0 z-50 h-3 w-3 cursor-ne-resize",onPointerDown:l=>jr(l,"top-right",i,o)}),d.jsx("div",{className:"absolute bottom-0 right-0 z-50 h-3 w-3 cursor-nw-resize",onPointerDown:l=>jr(l,"bottom-right",i,o)}),d.jsx("div",{className:"absolute left-0 top-0 z-50 h-3 w-3 cursor-nw-resize",onPointerDown:l=>jr(l,"top-left",i,o)}),d.jsx("div",{className:"absolute bottom-0 left-0 z-50 h-3 w-3 cursor-ne-resize",onPointerDown:l=>jr(l,"bottom-left",i,o)}),d.jsx("div",{className:"absolute bottom-0 left-5 right-5 z-50 h-2 cursor-n-resize",onPointerDown:l=>jr(l,"bottom",i,o)}),d.jsx("div",{className:"z-5000 absolute left-5 right-5 top-0 h-2 cursor-n-resize",onPointerDown:l=>jr(l,"top",i,o)}),d.jsx("div",{className:"z-5000 absolute bottom-5 left-0 top-5 w-2 cursor-e-resize",onPointerDown:l=>jr(l,"left",i,o)}),d.jsx("div",{className:"z-5000 absolute bottom-5 right-0 top-5 w-2 cursor-e-resize",onPointerDown:l=>jr(l,"right",i,o)})]})]})})}async function G7(n){const e=setTimeout(()=>{ke.setState({loadingData:!0,dialogContent:`Hmm, looks like its going slow today.
If this never goes away then please check network/vpn or just reload page?`,dialogHeader:"Loading layers"})},750),t=await zP(n.container,n.config,n.unique_key,n.plant_code,n.plant_name);clearTimeout(e),ke.setState({loadingData:!1,dialogContent:"Still waiting",dialogHeader:"Loading data"}),Re.setState({selectedProject:t,projectSelectedKey:n.unique_key,projectSelectedCode:n.plant_code,projectSelectedName:n.plant_name}),e7()}function cpe(){const n=Re();return d.jsxs("div",{className:"flex flex-1 flex-grow flex-col",children:[d.jsxs("div",{className:"mb-1 mt-2 flex min-h-20 flex-col bg-gray-700",children:[d.jsx("span",{className:"m-auto mt-0 font-semibold underline",children:"All Projects:"}),d.jsx("input",{className:"m-2 bg-gray-300 p-1 text-black outline-none",placeholder:"Filter projects",value:n.projectFilter,onInput:e=>{n.projectFilter=e.currentTarget.value,n.runFilter()}})]}),d.jsx("div",{className:"flex h-full flex-grow",children:d.jsx("div",{className:"relative h-full w-full",children:d.jsx("div",{className:"scrollbar absolute bottom-0 left-0 right-0 top-0 overflow-y-auto",children:d.jsx("div",{className:"flex flex-col",children:n.filteredProjects.map(e=>{const t=e.unique_key===n.projectSelectedKey;let r="p-1  text-center hover:bg-gray-700 flex  ml-2";return t&&(r="p-1 text-center bg-gray-600/50 hover:bg-gray-600 flex  ml-2"),d.jsx("div",{className:"w-full cursor-pointer border-b border-b-gray-500",onClick:async()=>{await G7(e)},children:d.jsx("div",{className:r,children:d.jsx("div",{children:e.plant_name||"-"})})},e.unique_key)})})})})})]})}function upe(){const n=Re();if(ke().loadingData)return null;if(!n.projectSelectedKey)return d.jsx("div",{className:"flex flex-1 flex-grow flex-col",children:d.jsx("div",{className:"relative h-full w-full",children:d.jsx("div",{className:"flex",children:d.jsx("span",{className:"m-auto mt-5",children:"No project is selected"})})})});const t=n.selectedProject;return t?d.jsxs("div",{className:"flex flex-1 flex-grow flex-col",children:[d.jsxs("div",{className:"mb-1 mt-2 flex min-h-20 flex-col bg-gray-700",children:[d.jsx("div",{className:"m-auto flex",children:d.jsx("div",{children:n.projectSelectedName||"-"})}),d.jsx("span",{className:"m-auto mt-0 underline",children:"Available Sub Models:"})]}),d.jsx("div",{className:"relative h-full w-full",children:d.jsx("div",{className:"scrollbar absolute bottom-0 left-0 right-0 top-0 overflow-y-auto",children:d.jsx("div",{className:"flex flex-col",children:t.model_layer.map((r,i)=>d.jsx("div",{className:"w-full cursor-pointer border-b border-b-gray-500",onClick:async o=>{var a;Gt.getState().clearSet(),fl.setState({isOpen:!1}),bt.flushSync(()=>{rr.setState({treeViewActive:!1})}),Re.setState({selectedLayer:r,selectedLayerTitle:`${n.projectSelectedName} - ${r.description}`});let s=location.href.split("?")[0];V2&&(s=s+"?skip-alias"),history.pushState(null,"",s),D1(t.plant_code||"unknown"),await O1(t),!mn.getState().unsyncedCount&&(bt.flushSync(()=>{Xe.setState({enabled:!1}),De.setState({x_plane_enable:!1,y_plane_enable:!1,z_plane_enable:!1}),rr.setState({treeViewActive:!0})}),!((a=o.target)!=null&&a.dataset.loadModel)&&mE())},children:d.jsxs("div",{className:"ml-2 flex p-1 hover:bg-gray-700",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-5 w-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"})}),d.jsx("div",{className:"ml-2",children:r.description}),d.jsx("div",{className:"flex-1"}),d.jsx("button",{"data-tooltip":["Opens project, but does not load 3d model after sync.","For users who want to load sites manually"].join(`
`),"data-load-model":!0,className:"bg-gray-600 p-[0.1rem] hover:bg-gray-500",onClick:()=>{console.log("wow")},children:"Skip load"})]})},i))})})})]}):d.jsx("div",{className:"flex flex-1 flex-grow flex-col",children:d.jsx("div",{className:"relative h-full w-full",children:d.jsx("div",{className:"flex",children:d.jsxs("span",{className:"m-auto mt-5 bg-yellow-300 p-2 text-red-800",children:["Missing access for: ",n.projectSelectedCode]})})})})}const b2=mr(()=>({selectedAccount:null,accounts:[]}));function dpe(){var t;const n=Re(),e=b2();return O.useEffect(()=>{async function r(){const i=await Ip(),o=(i==null?void 0:i.getAllAccounts())||[],s=i==null?void 0:i.getActiveAccount();b2.setState({accounts:o.concat([{homeAccountId:"0",name:"Other"}]),selectedAccount:structuredClone(s)})}r()},[]),e.selectedAccount?d.jsx("select",{defaultValue:(t=e.selectedAccount)==null?void 0:t.homeAccountId,onChange:async r=>{if(r.target.value==="0"){const i=await Ip(),o=await s1();i.loginRedirect({scopes:o.scopes,prompt:"select_account"})}else for await(const i of e.accounts)i.homeAccountId===r.target.value&&((await Ip()).setActiveAccount(i),b2.setState({selectedAccount:structuredClone(i)}));if(n.projectSelectedKey){rie();const i=n.allProjects.filter(o=>o.unique_key===n.projectSelectedKey)[0];await G7(i)}},className:"block bg-gray-700 text-center font-semibold outline-none dark:text-white",children:e.accounts.map(r=>d.jsx("option",{value:r.homeAccountId,children:r.name},r.homeAccountId))}):null}async function hpe(){ke.setState({loadingData:!0,dialogHeader:"Loading Projects",dialogContent:"Please wait"}),await $k(),ke.setState({loadingData:!1,dialogHeader:"",dialogContent:""})}let w4=!1;function fpe(){const n=Re();return O.useEffect(()=>{async function e(){n.isOpen&&!w4&&(w4=!0,await hpe())}e()}),n.isOpen?d.jsxs("div",{style:{minHeight:0},className:"flex w-full flex-grow flex-col",children:[d.jsxs("div",{className:"flex flex-1",children:[d.jsx("div",{className:"flex flex-1",children:d.jsx(cpe,{})}),d.jsx("div",{className:"flex p-1",children:d.jsx("div",{className:"border border-gray-600"})}),d.jsx("div",{className:"flex flex-1",children:d.jsx(upe,{})})]}),d.jsx("div",{className:"flex border-gray-700 pt-1",children:d.jsx(dpe,{})})]}):null}let xf={height:550,width:1e3,bottom:200,right:0,initLoaded:!1,adjustOnLoad:!0,closed:!0};function S4(){const n=Re();return d.jsx(Rh,{uniqueName:"ProjectSelector",adjustOnLoad:xf.adjustOnLoad,isModal:!0,title:"Project Selector",isOpen:n.isOpen,width:xf.width,height:xf.height,bottom:xf.bottom,onClose:e=>{xf={...xf,...e,adjustOnLoad:!1},Re.setState({isOpen:!1})},children:d.jsx(fpe,{})})}function ppe(){var t;const n=mn();O.useEffect(()=>{xN()},[]);function e(){if(Array.isArray(n.modelGroups)){const r=n.modelGroups;if(Array.isArray(r))return r[0].source_checked_date}return"NA"}return d.jsxs("div",{className:"flex h-full w-full flex-col",children:[n.unsyncedCount?d.jsxs("div",{className:"mt-2 bg-red-500 text-center text-gray-800",children:["You need to sync ",n.unsyncedCount]}):d.jsx("div",{className:"mt-2 bg-green-500 text-center text-gray-800",children:"All synced"}),d.jsx("div",{className:"relative h-full flex-1",children:d.jsx("div",{style:{minHeight:0},className:"scrollbar absolute bottom-0 left-0 right-0 top-1 overflow-y-auto",children:d.jsx("div",{className:"flex flex-col",children:(t=n.modelGroups)==null?void 0:t.sort((r,i)=>r.name<i.name?-1:1).map((r,i)=>{const o=r.$synced?"italic text-green-500":"italic text-red-500";return d.jsx("div",{className:"w-full border-b border-b-gray-500",children:d.jsxs("div",{className:"m-1 text-center",children:[d.jsx("div",{className:"font-semibold",children:r.$group_name}),d.jsx("div",{className:o,children:r.$synced?"Synced":"Not Synced"})]})},i)})})})}),d.jsxs("div",{className:"mt-2 border-t border-gray-900 text-center text-xs text-gray-200",children:["Model Checked: ",e()]}),d.jsxs("div",{className:"flex",children:[d.jsx("button",{className:"m-2 w-28 bg-indigo-600 hover:bg-indigo-700",onClick:async()=>{await E0(!1)||(n.deactivateSyncDialog(),mE())},children:"Sync & load"}),d.jsx("button",{className:"m-2 w-28 bg-gray-600 hover:bg-gray-700",onClick:async()=>{await E0(!1)||n.deactivateSyncDialog()},children:"Sync Missing"}),d.jsx("button",{className:"m-2 w-28 bg-gray-600 hover:bg-gray-700",onClick:async()=>{if(await E0(!1,void 0,!0)){const i=Hv.getState().modelIssuesMessages.slice();i.push("Using model without all models synced"),Hv.setState({modelIssues:!0,modelIssuesMessages:i})}n.deactivateSyncDialog(),mE()},children:"Use Synced"}),d.jsx("button",{className:"m-2 w-28 bg-gray-600 hover:bg-gray-700",onClick:async()=>{await E0(!0)||n.deactivateSyncDialog()},children:"Resync all"}),d.jsx("button",{className:"m-2 w-28 bg-gray-600 hover:bg-gray-700",onClick:async()=>{xN(!0)},children:"Refresh List"})]})]})}let yf={height:500,width:550,bottom:200,right:0,initLoaded:!1,adjustOnLoad:!0,closed:!0};function E4(){const n=mn();return d.jsx(Rh,{uniqueName:"SyncDialog",adjustOnLoad:yf.adjustOnLoad,title:"Sync",isOpen:n.isOpen,width:yf.width,height:yf.height,bottom:yf.bottom,onClose:e=>{yf={...yf,...e,adjustOnLoad:!1},mn.setState({isOpen:!1})},children:d.jsx(ppe,{})})}let A2=null;const mpe=()=>{const[n,e]=O.useState({x:0,y:0}),[t,r]=O.useState({show:!1,msg:""});if(O.useEffect(()=>{const i=function(s,a){var h;const l=((h=a==null?void 0:a.dataset)==null?void 0:h.tooltip)||"",c=l==null?void 0:l.split(`
`);let u=0;return c&&c.length&&c.forEach(f=>{f.length>u&&(u=f.length)}),u&&s+u*4>innerWidth-2&&(s=s-u*4),s},o=s=>{A2&&clearTimeout(A2);const a=s.target;if(A2=setTimeout(()=>{var u;let l=a,c=0;for(;c<5&&l;){if((u=l==null?void 0:l.dataset)!=null&&u.tooltip){r({show:!0,msg:l.dataset.tooltip});const h=i(s.clientX,a);e({x:h,y:s.clientY});break}c++,l=l==null?void 0:l.parentElement}},300),t.show)r({show:!1,msg:""});else{const l=i(s.clientX,a);e({x:l,y:s.clientY})}};return window.addEventListener("pointermove",o),()=>{window.removeEventListener("pointermove",o)}}),t.show){const i={display:t.show?"block":"none",left:n.x+"px",top:n.y+"px"};return d.jsx("div",{id:"tooltip",style:i,className:"absolute z-[9999] m-5 whitespace-pre-wrap border border-blue-400 bg-gray-800 p-1 text-xs text-white drop-shadow-lg focus:outline-none",children:t.msg})}else return null};function gpe(n){const e=Re();return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 cursor-pointer bg-gray-700 font-semibold text-blue-600 hover:bg-gray-600 focus:outline-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"close",strokeWidth:2,onClick:()=>{var t,r;if((t=e==null?void 0:e.selectedProject)!=null&&t.activeTools){const i=(r=e==null?void 0:e.selectedProject)==null?void 0:r.activeTools.indexOf(n.name+":"+n.id);i!==void 0&&i!==-1&&e.selectedProject.activeTools.splice(i,1),Re.setState({selectedProject:null}),Re.setState({selectedProject:e.selectedProject})}},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}function vpe(n){const e=Re();return n.allowExternal?d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 cursor-pointer bg-gray-700 font-semibold text-blue-600 hover:bg-gray-600 focus:outline-none",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"open as external",strokeWidth:2,onClick:()=>{var t,r;if((t=e==null?void 0:e.selectedProject)!=null&&t.activeTools){const i=(r=e==null?void 0:e.selectedProject)==null?void 0:r.activeTools.indexOf(n.name);i!==void 0&&i!==-1&&e.selectedProject.activeTools.splice(i,1),Re.setState({selectedProject:null}),Re.setState({selectedProject:e.selectedProject}),window.open(`${n.url}#external`,n.dialogHeader)}},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})}):null}function _pe(n){aE.add(n)}function xpe(n){aE.delete(n)}function M2(n){return W7()?n.urlBeta:ype()?n.urlTest:n.urlProd}function ype(){return!!(location.origin.includes(".tapps.")&&!W7())}function W7(){return!!(location.origin.includes(".bapps.")||location.origin.includes("beta")||location.origin.includes("localhost")||location.origin.includes("127.0.0.1"))}const wpe=new Date().getTime().toString();function Spe(n){var f,m;const e=Re(),[t,r]=O.useState(!1),i=O.useRef(null),o=O.useRef(null),s=(f=e==null?void 0:e.selectedProject)==null?void 0:f.tools,a=s?s[n.name]:null,[l,c]=O.useState((a==null?void 0:a.dialogHeader)||""),[u,h]=O.useState({height:(a==null?void 0:a.height)||200,width:(a==null?void 0:a.width)||200,bottom:(a==null?void 0:a.bottom)||200,right:(a==null?void 0:a.right)||0,initLoaded:!1,closed:!0});if(O.useEffect(()=>{const g={handleEvent:(_,v)=>(_===`${n.name}:${n.id}`&&c(v==="MANUAL INPUT"?sue()||"":v||""),!0)};return _pe(g),ev({},n.name,"open",()=>u,h),()=>{xpe(g),ev({},n.name,"close",()=>u,h)}}),O.useEffect(()=>{o.current&&u.closed&&(h({...u,closed:!1}),Gv({target:o.current}))}),(m=e.selectedProject)!=null&&m.tools&&a){const g={bottom:u.bottom,right:u.right,width:u.width,height:u.height,zIndex:110},_=new URLSearchParams;_.append("url",M2(a)),_.append("plant",e.selectedProject.plant_code),_.append("timestamp",wpe),_.append("versionweb3d","1.29.2"),_.append("iframe","YES"),_.append("eventsupport","urlopen,fileopen"),_.append("dialogid",n.name+":"+n.id),_.append("web3dBroadcastChannel",A1);try{_.append("data",a.data?JSON.stringify(a.data):JSON.stringify("{}"))}catch(w){console.error(w)}const v=t?"w-full h-full pointer-events-none":"w-full h-full pointer-events-auto",p=`${M2(a)}?${_.toString()}`;_.append("iframe","YES");const x=`${M2(a)}?${_.toString()}`,y=200;return d.jsxs("div",{ref:o,style:g,className:"floating-dialog absolute flex select-none flex-col overflow-hidden border border-gray-900 bg-gray-800 p-1 shadow-2xl",children:[d.jsxs("div",{className:"z-50 flex cursor-move bg-gray-700",onPointerDown:w=>jr(w,"position",u,h,y,r),children:[d.jsx("span",{className:"p-1",children:l}),d.jsxs("div",{className:"absolute right-1 flex gap-2",children:[d.jsx(vpe,{name:n.name,allowExternal:a.allowExternal,dialogHeader:l,url:p}),d.jsx(V7,{state:u,setState:h}),d.jsx(gpe,{name:n.name,id:n.id})]})]}),d.jsx("div",{className:"z-50 mt-1 flex flex-1 overflow-auto",children:d.jsx("iframe",{className:v,ref:i,src:x})}),d.jsxs("div",{className:"absolute bottom-0 left-0 right-0 top-0",children:[d.jsx("div",{className:"absolute right-0 top-0 z-50 h-3 w-3 cursor-ne-resize",onPointerDown:w=>jr(w,"top-right",u,h,y,r)}),d.jsx("div",{className:"absolute bottom-0 right-0 z-50 h-3 w-3 cursor-nw-resize",onPointerDown:w=>jr(w,"bottom-right",u,h,y,r)}),d.jsx("div",{className:"absolute left-0 top-0 z-50 h-3 w-3 cursor-nw-resize",onPointerDown:w=>jr(w,"top-left",u,h,y,r)}),d.jsx("div",{className:"absolute bottom-0 left-0 z-50 h-3 w-3 cursor-ne-resize",onPointerDown:w=>jr(w,"bottom-left",u,h,y,r)}),d.jsx("div",{className:"absolute bottom-0 left-5 right-5 z-50 h-2 cursor-n-resize",onPointerDown:w=>jr(w,"bottom",u,h,y,r)}),d.jsx("div",{className:"absolute left-5 right-5 top-0 z-50 h-2 cursor-n-resize",onPointerDown:w=>jr(w,"top",u,h,y,r)}),d.jsx("div",{className:"absolute bottom-5 left-0 top-5 z-50 w-2 cursor-e-resize",onPointerDown:w=>jr(w,"left",u,h,y,r)}),d.jsx("div",{className:"absolute bottom-5 right-0 top-5 z-50 w-2 cursor-e-resize",onPointerDown:w=>jr(w,"right",u,h,y,r)})]})]})}return null}function Epe(){var e,t,r,i;const n=Re();return(t=(e=n.selectedProject)==null?void 0:e.activeTools)!=null&&t.length?d.jsx(d.Fragment,{children:(i=(r=n.selectedProject)==null?void 0:r.activeTools)==null?void 0:i.map(o=>{const[s,a]=o.split(":");return d.jsx(Spe,{name:s,id:a},a)})}):null}async function Tpe(){var n;try{const e=await Ip(),t=await s1(),r=await e.acquireTokenSilent({scopes:t.scopes,forceRefresh:Az()});return(n=r==null?void 0:r.account)==null?void 0:n.homeAccountId}catch(e){console.error(e),Fn.setState({header:"login",message:e==null?void 0:e.errorMessage})}return""}const _c=mr(n=>({isActivated:!1,activate:()=>n(()=>({isActivated:!0})),deactivate:()=>n(()=>({isActivated:!1})),url:""}));function Cpe(n){return`U${window.btoa(encodeURIComponent(n))}`}async function bpe(n,e){var l,c;const t=await Ua(),r=await Ll(t.ENV__AZURE_STORAGE_SHARE_CONTAINER_NAME),i=((l=Re.getState().selectedProject)==null?void 0:l.project_key)||"unknown",o=await Tpe()||"unknown",s=`${Cpe(o)}-${n}`,a=t.ENV__AZURE_STORAGE_SHARE_CONTAINER_NAME;try{const u=await fetch(`${t.ENV__AZURE_STORAGE_URL}/${a}/${i}/${s}.Web3DVP?${(c=r.data)==null?void 0:c.token}`,{method:"PUT",body:JSON.stringify(e),headers:{"cache-control":"no-cache","x-ms-blob-type":"BlockBlob","x-ms-date":new Date().toUTCString()}});if(u.ok){const h=new URLSearchParams;h.set("load-set",s),h.set("project-key",i),_c.setState({isActivated:!0,url:location.origin+location.pathname+"?"+h.toString()})}else throw u.statusText}catch(u){console.error(u),Fn.setState({activated:!0,header:"bookmark error",message:"unable to create bookmark"})}}function Ape(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 cursor-pointer text-indigo-500 hover:text-indigo-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Generate Bookmark",strokeWidth:2,onClick:async()=>{var e,t;const n=structuredClone(Gt.getState().currentSet);n.projectKey=((e=Re.getState().selectedProject)==null?void 0:e.project_key)||"unknown",n.version=sE,Pi.groupNamesUsed.size&&(n.setFilter={name:"set generated",description:"generated by modelgroups loaded by set",groups:Array.from(Pi.groupNamesUsed),loadGroups:[]}),((t=Re.getState().selectedLayer)==null?void 0:t.name)!=="set generated"&&(n.layerFilter=Re.getState().selectedLayer),bpe(n.UUID,JSON.parse(JSON.stringify(n)))},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})}async function Mpe(){if(typeof showOpenFilePicker!="function"){Fn.setState({header:"Error",message:"Your browser does not support filesystem Access Api, use newest Chrome/Edge "});return}const n={types:[{description:"WEB 3d Viewpoint",accept:{"web3d/web3d":[".Web3DVP"]}}],excludeAcceptAllOption:!0,multiple:!1},e=await showOpenFilePicker(n);if((e==null?void 0:e.length)>0)return await(await e[0].getFile()).text()}function Rpe(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 cursor-pointer text-indigo-500 hover:text-indigo-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Open set from file",strokeWidth:2,onClick:async()=>{var e,t,r,i;const n=await Mpe();if(n)try{const o=JSON.parse(n);o.UUID||(o.UUID=er()),Array.isArray(o.filter)||(o.filter=[]),Array.isArray(o.siteFilter)&&(delete o.lvl3Filter,delete o.lvl3Filter,delete o.lvl3Filter,delete o.siteFilter,delete o.zoneFilter,delete o.itemFilter),(e=o.colorOverride)==null||e.forEach(a=>{a.uuid||(a.uuid=er())}),(t=o.viewPoints)==null||t.forEach(a=>{a.uuid||(a.uuid=er())}),(r=o.filter)==null||r.forEach(a=>{a.forEach(l=>{l.uuid||(l.uuid=er())})});const s=((i=Re.getState().selectedProject)==null?void 0:i.project_key)||"unknown";o.projectKey=s,Gt.setState({currentSet:o})}catch(o){console.error(o),Fn.setState({header:"Error",message:"Unable to read file"})}},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}async function Npe(n){if(typeof showSaveFilePicker!="function"){Fn.setState({header:"Error",message:"Your browser does not support filesystem Access Api, use newest Chrome/Edge "});return}const e=`Web_3D_viewpoint_${new Date().toLocaleDateString("no-NO").replace(".","-")}.Web3DVP`,t={types:[{description:"WEB 3d Viewpoint",accept:{"web3d/web3d":[".Web3DVP"]}}],suggestedName:e},i=await(await showSaveFilePicker(t)).createWritable();await i.write(n),await i.close()}function Ipe(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 cursor-pointer text-indigo-500 hover:text-indigo-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Save set as file",strokeWidth:2,onClick:async()=>{var n;try{const e=structuredClone(Gt.getState().currentSet);e.projectKey=((n=Re.getState().selectedProject)==null?void 0:n.project_key)||"unknown",Pi.groupNamesUsed.size&&(e.setFilter={name:"set generated",description:"generated by modelgroups loaded by set",groups:Array.from(Pi.groupNamesUsed),loadGroups:[]}),e.layerFilter=Re.getState().selectedLayer,e.version=sE,await Npe(JSON.stringify(e))}catch(e){console.error(e),Fn.setState({header:"Error",message:"Unable to save file"})}},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-7a2 2 0 012-2h2m3-4H9a2 2 0 00-2 2v7a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-1m-1 4l-3 3m0 0l-3-3m3 3V3"})})}function Ppe(){const n=Gt(),e="flex-1 text-center  hover:bg-gray-700 hover:text-gray-200 cursor-pointer ",t="bg-gray-800  text-gray-200 border-r hover:text-gray-200 border-gray-400 border-l border-t rounded-t mt-1 font-semibold w-28  mr-1 ml-1  text-xs border-gray-700 text-center",r="text-gray-900 bg-gray-400 mt-1 text-gray-800 rounded-t w-28 hover:text-gray-200  mr-1 ml-1  text-xs border-gray-700 text-center",i=e+(n.activeTab==="FILTER"?t:r),o=e+(n.activeTab==="VIEWPOINT"?t:r),s=e+(n.activeTab==="COLOR"?t:r);return d.jsxs("div",{className:"mt-1 flex",children:[d.jsx("div",{className:i,onClick:()=>Gt.setState({activeTab:"FILTER"}),children:"Filter"}),d.jsx("div",{className:o,onClick:()=>Gt.setState({activeTab:"VIEWPOINT"}),children:"ViewPoint"}),d.jsx("div",{className:s,onClick:()=>Gt.setState({activeTab:"COLOR"}),children:"Colors"})]})}const T4=["antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","White","whitesmoke","yellow","yellowgreen"],$7=typeof document<"u"?Rt.useLayoutEffect:()=>{};function kpe(n){const e=O.useRef(null);return $7(()=>{e.current=n},[n]),O.useCallback((...t)=>{const r=e.current;return r==null?void 0:r(...t)},[])}const __=n=>{var e;return(e=n==null?void 0:n.ownerDocument)!==null&&e!==void 0?e:document},Td=n=>n&&"window"in n&&n.window===n?n:__(n).defaultView||window;function Lpe(n){var e;return typeof window>"u"||window.navigator==null?!1:((e=window.navigator.userAgentData)===null||e===void 0?void 0:e.brands.some(t=>n.test(t.brand)))||n.test(window.navigator.userAgent)}function Ope(n){var e;return typeof window<"u"&&window.navigator!=null?n.test(((e=window.navigator.userAgentData)===null||e===void 0?void 0:e.platform)||window.navigator.platform):!1}function Y7(n){let e=null;return()=>(e==null&&(e=n()),e)}const Dpe=Y7(function(){return Ope(/^Mac/i)}),Upe=Y7(function(){return Lpe(/Android/i)});function Fpe(n){return n.mozInputSource===0&&n.isTrusted?!0:Upe()&&n.pointerType?n.type==="click"&&n.buttons===1:n.detail===0&&!n.pointerType}class jpe{isDefaultPrevented(){return this.nativeEvent.defaultPrevented}preventDefault(){this.defaultPrevented=!0,this.nativeEvent.preventDefault()}stopPropagation(){this.nativeEvent.stopPropagation(),this.isPropagationStopped=()=>!0}isPropagationStopped(){return!1}persist(){}constructor(e,t){this.nativeEvent=t,this.target=t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget,this.bubbles=t.bubbles,this.cancelable=t.cancelable,this.defaultPrevented=t.defaultPrevented,this.eventPhase=t.eventPhase,this.isTrusted=t.isTrusted,this.timeStamp=t.timeStamp,this.type=e}}function K7(n){let e=O.useRef({isFocused:!1,observer:null});$7(()=>{const r=e.current;return()=>{r.observer&&(r.observer.disconnect(),r.observer=null)}},[]);let t=kpe(r=>{n==null||n(r)});return O.useCallback(r=>{if(r.target instanceof HTMLButtonElement||r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement||r.target instanceof HTMLSelectElement){e.current.isFocused=!0;let i=r.target,o=s=>{e.current.isFocused=!1,i.disabled&&t(new jpe("blur",s)),e.current.observer&&(e.current.observer.disconnect(),e.current.observer=null)};i.addEventListener("focusout",o,{once:!0}),e.current.observer=new MutationObserver(()=>{if(e.current.isFocused&&i.disabled){var s;(s=e.current.observer)===null||s===void 0||s.disconnect();let a=i===document.activeElement?null:document.activeElement;i.dispatchEvent(new FocusEvent("blur",{relatedTarget:a})),i.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:a}))}}),e.current.observer.observe(i,{attributes:!0,attributeFilter:["disabled"]})}},[t])}function Bpe(n){let{isDisabled:e,onFocus:t,onBlur:r,onFocusChange:i}=n;const o=O.useCallback(l=>{if(l.target===l.currentTarget)return r&&r(l),i&&i(!1),!0},[r,i]),s=K7(o),a=O.useCallback(l=>{const c=__(l.target);l.target===l.currentTarget&&c.activeElement===l.target&&(t&&t(l),i&&i(!0),s(l))},[i,t,s]);return{focusProps:{onFocus:!e&&(t||i||r)?a:void 0,onBlur:!e&&(r||i)?o:void 0}}}let x_=null,SN=new Set,tv=new Map,ch=!1,EN=!1;const zpe={Tab:!0,Escape:!0};function Zk(n,e){for(let t of SN)t(n,e)}function Hpe(n){return!(n.metaKey||!Dpe()&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function vE(n){ch=!0,Hpe(n)&&(x_="keyboard",Zk("keyboard",n))}function Xo(n){x_="pointer",(n.type==="mousedown"||n.type==="pointerdown")&&(ch=!0,Zk("pointer",n))}function X7(n){Fpe(n)&&(ch=!0,x_="virtual")}function q7(n){n.target===window||n.target===document||(!ch&&!EN&&(x_="virtual",Zk("virtual",n)),ch=!1,EN=!1)}function Q7(){ch=!1,EN=!0}function TN(n){if(typeof window>"u"||tv.get(Td(n)))return;const e=Td(n),t=__(n);let r=e.HTMLElement.prototype.focus;e.HTMLElement.prototype.focus=function(){ch=!0,r.apply(this,arguments)},t.addEventListener("keydown",vE,!0),t.addEventListener("keyup",vE,!0),t.addEventListener("click",X7,!0),e.addEventListener("focus",q7,!0),e.addEventListener("blur",Q7,!1),typeof PointerEvent<"u"?(t.addEventListener("pointerdown",Xo,!0),t.addEventListener("pointermove",Xo,!0),t.addEventListener("pointerup",Xo,!0)):(t.addEventListener("mousedown",Xo,!0),t.addEventListener("mousemove",Xo,!0),t.addEventListener("mouseup",Xo,!0)),e.addEventListener("beforeunload",()=>{Z7(n)},{once:!0}),tv.set(e,{focus:r})}const Z7=(n,e)=>{const t=Td(n),r=__(n);e&&r.removeEventListener("DOMContentLoaded",e),tv.has(t)&&(t.HTMLElement.prototype.focus=tv.get(t).focus,r.removeEventListener("keydown",vE,!0),r.removeEventListener("keyup",vE,!0),r.removeEventListener("click",X7,!0),t.removeEventListener("focus",q7,!0),t.removeEventListener("blur",Q7,!1),typeof PointerEvent<"u"?(r.removeEventListener("pointerdown",Xo,!0),r.removeEventListener("pointermove",Xo,!0),r.removeEventListener("pointerup",Xo,!0)):(r.removeEventListener("mousedown",Xo,!0),r.removeEventListener("mousemove",Xo,!0),r.removeEventListener("mouseup",Xo,!0)),tv.delete(t))};function Vpe(n){const e=__(n);let t;return e.readyState!=="loading"?TN(n):(t=()=>{TN(n)},e.addEventListener("DOMContentLoaded",t)),()=>Z7(n,t)}typeof document<"u"&&Vpe();function J7(){return x_!=="pointer"}const Gpe=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function Wpe(n,e,t){var r;const i=typeof window<"u"?Td(t==null?void 0:t.target).HTMLInputElement:HTMLInputElement,o=typeof window<"u"?Td(t==null?void 0:t.target).HTMLTextAreaElement:HTMLTextAreaElement,s=typeof window<"u"?Td(t==null?void 0:t.target).HTMLElement:HTMLElement,a=typeof window<"u"?Td(t==null?void 0:t.target).KeyboardEvent:KeyboardEvent;return n=n||(t==null?void 0:t.target)instanceof i&&!Gpe.has(t==null||(r=t.target)===null||r===void 0?void 0:r.type)||(t==null?void 0:t.target)instanceof o||(t==null?void 0:t.target)instanceof s&&(t==null?void 0:t.target.isContentEditable),!(n&&e==="keyboard"&&t instanceof a&&!zpe[t.key])}function $pe(n,e,t){TN(),O.useEffect(()=>{let r=(i,o)=>{Wpe(!!(t!=null&&t.isTextInput),i,o)&&n(J7())};return SN.add(r),()=>{SN.delete(r)}},e)}function Ype(n){let{isDisabled:e,onBlurWithin:t,onFocusWithin:r,onFocusWithinChange:i}=n,o=O.useRef({isFocusWithin:!1}),s=O.useCallback(c=>{o.current.isFocusWithin&&!c.currentTarget.contains(c.relatedTarget)&&(o.current.isFocusWithin=!1,t&&t(c),i&&i(!1))},[t,i,o]),a=K7(s),l=O.useCallback(c=>{!o.current.isFocusWithin&&document.activeElement===c.target&&(r&&r(c),i&&i(!0),o.current.isFocusWithin=!0,a(c))},[r,i,a]);return e?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:l,onBlur:s}}}let _E=!1,R2=0;function CN(){_E=!0,setTimeout(()=>{_E=!1},50)}function C4(n){n.pointerType==="touch"&&CN()}function Kpe(){if(!(typeof document>"u"))return typeof PointerEvent<"u"?document.addEventListener("pointerup",C4):document.addEventListener("touchend",CN),R2++,()=>{R2--,!(R2>0)&&(typeof PointerEvent<"u"?document.removeEventListener("pointerup",C4):document.removeEventListener("touchend",CN))}}function eV(n){let{onHoverStart:e,onHoverChange:t,onHoverEnd:r,isDisabled:i}=n,[o,s]=O.useState(!1),a=O.useRef({isHovered:!1,ignoreEmulatedMouseEvents:!1,pointerType:"",target:null}).current;O.useEffect(Kpe,[]);let{hoverProps:l,triggerHoverEnd:c}=O.useMemo(()=>{let u=(m,g)=>{if(a.pointerType=g,i||g==="touch"||a.isHovered||!m.currentTarget.contains(m.target))return;a.isHovered=!0;let _=m.currentTarget;a.target=_,e&&e({type:"hoverstart",target:_,pointerType:g}),t&&t(!0),s(!0)},h=(m,g)=>{if(a.pointerType="",a.target=null,g==="touch"||!a.isHovered)return;a.isHovered=!1;let _=m.currentTarget;r&&r({type:"hoverend",target:_,pointerType:g}),t&&t(!1),s(!1)},f={};return typeof PointerEvent<"u"?(f.onPointerEnter=m=>{_E&&m.pointerType==="mouse"||u(m,m.pointerType)},f.onPointerLeave=m=>{!i&&m.currentTarget.contains(m.target)&&h(m,m.pointerType)}):(f.onTouchStart=()=>{a.ignoreEmulatedMouseEvents=!0},f.onMouseEnter=m=>{!a.ignoreEmulatedMouseEvents&&!_E&&u(m,"mouse"),a.ignoreEmulatedMouseEvents=!1},f.onMouseLeave=m=>{!i&&m.currentTarget.contains(m.target)&&h(m,"mouse")}),{hoverProps:f,triggerHoverEnd:h}},[e,t,r,i,a]);return O.useEffect(()=>{i&&c({currentTarget:a.target},a.pointerType)},[i]),{hoverProps:l,isHovered:o}}function tV(n={}){let{autoFocus:e=!1,isTextInput:t,within:r}=n,i=O.useRef({isFocused:!1,isFocusVisible:e||J7()}),[o,s]=O.useState(!1),[a,l]=O.useState(()=>i.current.isFocused&&i.current.isFocusVisible),c=O.useCallback(()=>l(i.current.isFocused&&i.current.isFocusVisible),[]),u=O.useCallback(m=>{i.current.isFocused=m,s(m),c()},[c]);$pe(m=>{i.current.isFocusVisible=m,c()},[],{isTextInput:t});let{focusProps:h}=Bpe({isDisabled:r,onFocusChange:u}),{focusWithinProps:f}=Ype({isDisabled:!r,onFocusWithinChange:u});return{isFocused:o,isFocusVisible:a,focusProps:r?f:h}}var Xpe=Object.defineProperty,qpe=(n,e,t)=>e in n?Xpe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,N2=(n,e,t)=>(qpe(n,typeof e!="symbol"?e+"":e,t),t);let Qpe=class{constructor(){N2(this,"current",this.detect()),N2(this,"handoffState","pending"),N2(this,"currentId",0)}set(e){this.current!==e&&(this.handoffState="pending",this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}handoff(){this.handoffState==="pending"&&(this.handoffState="complete")}get isHandoffComplete(){return this.handoffState==="complete"}},Wd=new Qpe;function y_(n){return Wd.isServer?null:n instanceof Node?n.ownerDocument:n!=null&&n.hasOwnProperty("current")&&n.current instanceof Node?n.current.ownerDocument:document}function nV(n){typeof queueMicrotask=="function"?queueMicrotask(n):Promise.resolve().then(n).catch(e=>setTimeout(()=>{throw e}))}function Oa(){let n=[],e={addEventListener(t,r,i,o){return t.addEventListener(r,i,o),e.add(()=>t.removeEventListener(r,i,o))},requestAnimationFrame(...t){let r=requestAnimationFrame(...t);return e.add(()=>cancelAnimationFrame(r))},nextFrame(...t){return e.requestAnimationFrame(()=>e.requestAnimationFrame(...t))},setTimeout(...t){let r=setTimeout(...t);return e.add(()=>clearTimeout(r))},microTask(...t){let r={current:!0};return nV(()=>{r.current&&t[0]()}),e.add(()=>{r.current=!1})},style(t,r,i){let o=t.style.getPropertyValue(r);return Object.assign(t.style,{[r]:i}),this.add(()=>{Object.assign(t.style,{[r]:o})})},group(t){let r=Oa();return t(r),this.add(()=>r.dispose())},add(t){return n.includes(t)||n.push(t),()=>{let r=n.indexOf(t);if(r>=0)for(let i of n.splice(r,1))i()}},dispose(){for(let t of n.splice(0))t()}};return e}function qm(){let[n]=O.useState(Oa);return O.useEffect(()=>()=>n.dispose(),[n]),n}let _n=(n,e)=>{Wd.isServer?O.useEffect(n,e):O.useLayoutEffect(n,e)};function Tu(n){let e=O.useRef(n);return _n(()=>{e.current=n},[n]),e}let mt=function(n){let e=Tu(n);return Rt.useCallback((...t)=>e.current(...t),[e])};function Zpe(n){let e=n.width/2,t=n.height/2;return{top:n.clientY-t,right:n.clientX+e,bottom:n.clientY+t,left:n.clientX-e}}function Jpe(n,e){return!(!n||!e||n.right<e.left||n.left>e.right||n.bottom<e.top||n.top>e.bottom)}function eme({disabled:n=!1}={}){let e=O.useRef(null),[t,r]=O.useState(!1),i=qm(),o=mt(()=>{e.current=null,r(!1),i.dispose()}),s=mt(a=>{if(i.dispose(),e.current===null){e.current=a.currentTarget,r(!0);{let l=y_(a.currentTarget);i.addEventListener(l,"pointerup",o,!1),i.addEventListener(l,"pointermove",c=>{if(e.current){let u=Zpe(c);r(Jpe(u,e.current.getBoundingClientRect()))}},!1),i.addEventListener(l,"pointercancel",o,!1)}}});return{pressed:t,pressProps:n?{}:{onPointerDown:s,onPointerUp:o,onClick:o}}}let tme=O.createContext(void 0);function Jk(){return O.useContext(tme)}function bN(...n){return Array.from(new Set(n.flatMap(e=>typeof e=="string"?e.split(" "):[]))).filter(Boolean).join(" ")}function js(n,e,...t){if(n in e){let i=e[n];return typeof i=="function"?i(...t):i}let r=new Error(`Tried to handle "${n}" but there is no handler defined. Only defined handlers are: ${Object.keys(e).map(i=>`"${i}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,js),r}var xE=(n=>(n[n.None=0]="None",n[n.RenderStrategy=1]="RenderStrategy",n[n.Static=2]="Static",n))(xE||{}),Bc=(n=>(n[n.Unmount=0]="Unmount",n[n.Hidden=1]="Hidden",n))(Bc||{});function Uo({ourProps:n,theirProps:e,slot:t,defaultTag:r,features:i,visible:o=!0,name:s,mergeRefs:a}){a=a??rme;let l=rV(e,n);if(o)return dy(l,t,r,s,a);let c=i??0;if(c&2){let{static:u=!1,...h}=l;if(u)return dy(h,t,r,s,a)}if(c&1){let{unmount:u=!0,...h}=l;return js(u?0:1,{0(){return null},1(){return dy({...h,hidden:!0,style:{display:"none"}},t,r,s,a)}})}return dy(l,t,r,s,a)}function dy(n,e={},t,r,i){let{as:o=t,children:s,refName:a="ref",...l}=I2(n,["unmount","static"]),c=n.ref!==void 0?{[a]:n.ref}:{},u=typeof s=="function"?s(e):s;"className"in l&&l.className&&typeof l.className=="function"&&(l.className=l.className(e)),l["aria-labelledby"]&&l["aria-labelledby"]===l.id&&(l["aria-labelledby"]=void 0);let h={};if(e){let f=!1,m=[];for(let[g,_]of Object.entries(e))typeof _=="boolean"&&(f=!0),_===!0&&m.push(g.replace(/([A-Z])/g,v=>`-${v.toLowerCase()}`));if(f){h["data-headlessui-state"]=m.join(" ");for(let g of m)h[`data-${g}`]=""}}if(o===O.Fragment&&(Object.keys(Sc(l)).length>0||Object.keys(Sc(h)).length>0))if(!O.isValidElement(u)||Array.isArray(u)&&u.length>1){if(Object.keys(Sc(l)).length>0)throw new Error(['Passing props on "Fragment"!',"",`The current component <${r} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(Sc(l)).concat(Object.keys(Sc(h))).map(f=>`  - ${f}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(f=>`  - ${f}`).join(`
`)].join(`
`))}else{let f=u.props,m=f==null?void 0:f.className,g=typeof m=="function"?(...p)=>bN(m(...p),l.className):bN(m,l.className),_=g?{className:g}:{},v=rV(u.props,Sc(I2(l,["ref"])));for(let p in h)p in v&&delete h[p];return O.cloneElement(u,Object.assign({},v,h,c,{ref:i(u.ref,c.ref)},_))}return O.createElement(o,Object.assign({},I2(l,["ref"]),o!==O.Fragment&&c,o!==O.Fragment&&h),u)}function nme(){let n=O.useRef([]),e=O.useCallback(t=>{for(let r of n.current)r!=null&&(typeof r=="function"?r(t):r.current=t)},[]);return(...t)=>{if(!t.every(r=>r==null))return n.current=t,e}}function rme(...n){return n.every(e=>e==null)?void 0:e=>{for(let t of n)t!=null&&(typeof t=="function"?t(e):t.current=e)}}function rV(...n){if(n.length===0)return{};if(n.length===1)return n[0];let e={},t={};for(let r of n)for(let i in r)i.startsWith("on")&&typeof r[i]=="function"?(t[i]!=null||(t[i]=[]),t[i].push(r[i])):e[i]=r[i];if(e.disabled||e["aria-disabled"])for(let r in t)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(r)&&(t[r]=[i=>{var o;return(o=i==null?void 0:i.preventDefault)==null?void 0:o.call(i)}]);for(let r in t)Object.assign(e,{[r](i,...o){let s=t[r];for(let a of s){if((i instanceof Event||(i==null?void 0:i.nativeEvent)instanceof Event)&&i.defaultPrevented)return;a(i,...o)}}});return e}function eL(...n){if(n.length===0)return{};if(n.length===1)return n[0];let e={},t={};for(let r of n)for(let i in r)i.startsWith("on")&&typeof r[i]=="function"?(t[i]!=null||(t[i]=[]),t[i].push(r[i])):e[i]=r[i];for(let r in t)Object.assign(e,{[r](...i){let o=t[r];for(let s of o)s==null||s(...i)}});return e}function eo(n){var e;return Object.assign(O.forwardRef(n),{displayName:(e=n.displayName)!=null?e:n.name})}function Sc(n){let e=Object.assign({},n);for(let t in e)e[t]===void 0&&delete e[t];return e}function I2(n,e=[]){let t=Object.assign({},n);for(let r of e)r in t&&delete t[r];return t}function ime(n,e,t){let[r,i]=O.useState(t),o=n!==void 0,s=O.useRef(o),a=O.useRef(!1),l=O.useRef(!1);return o&&!s.current&&!a.current?(a.current=!0,s.current=o,console.error("A component is changing from uncontrolled to controlled. This may be caused by the value changing from undefined to a defined value, which should not happen.")):!o&&s.current&&!l.current&&(l.current=!0,s.current=o,console.error("A component is changing from controlled to uncontrolled. This may be caused by the value changing from a defined value to undefined, which should not happen.")),[o?n:r,mt(c=>(o||i(c),e==null?void 0:e(c)))]}function ome(n){let[e]=O.useState(n);return e}function iV(n={},e=null,t=[]){for(let[r,i]of Object.entries(n))sV(t,oV(e,r),i);return t}function oV(n,e){return n?n+"["+e+"]":e}function sV(n,e,t){if(Array.isArray(t))for(let[r,i]of t.entries())sV(n,oV(e,r.toString()),i);else t instanceof Date?n.push([e,t.toISOString()]):typeof t=="boolean"?n.push([e,t?"1":"0"]):typeof t=="string"?n.push([e,t]):typeof t=="number"?n.push([e,`${t}`]):t==null?n.push([e,""]):iV(t,e,n)}let sme="span";var tL=(n=>(n[n.None=1]="None",n[n.Focusable=2]="Focusable",n[n.Hidden=4]="Hidden",n))(tL||{});function ame(n,e){var t;let{features:r=1,...i}=n,o={ref:e,"aria-hidden":(r&2)===2?!0:(t=i["aria-hidden"])!=null?t:void 0,hidden:(r&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(r&4)===4&&(r&2)!==2&&{display:"none"}}};return Uo({ourProps:o,theirProps:i,slot:{},defaultTag:sme,name:"Hidden"})}let aV=eo(ame),lme=O.createContext(null);function cme({children:n}){let e=O.useContext(lme);if(!e)return Rt.createElement(Rt.Fragment,null,n);let{target:t}=e;return t?bt.createPortal(Rt.createElement(Rt.Fragment,null,n),t):null}function ume({data:n,form:e,disabled:t,onReset:r,overrides:i}){let[o,s]=O.useState(null),a=qm();return O.useEffect(()=>{if(r&&o)return a.addEventListener(o,"reset",r)},[o,e,r]),Rt.createElement(cme,null,Rt.createElement(dme,{setForm:s,formId:e}),iV(n).map(([l,c])=>Rt.createElement(aV,{features:tL.Hidden,...Sc({key:l,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:e,disabled:t,name:l,value:c,...i})})))}function dme({setForm:n,formId:e}){return O.useEffect(()=>{if(e){let t=document.getElementById(e);t&&n(t)}},[n,e]),e?null:Rt.createElement(aV,{features:tL.Hidden,as:"input",type:"hidden",hidden:!0,readOnly:!0,ref:t=>{if(!t)return;let r=t.closest("form");r&&n(r)}})}let hme=O.createContext(void 0);function lV(){return O.useContext(hme)}function fme(n){let e=n.parentElement,t=null;for(;e&&!(e instanceof HTMLFieldSetElement);)e instanceof HTMLLegendElement&&(t=e),e=e.parentElement;let r=(e==null?void 0:e.getAttribute("disabled"))==="";return r&&pme(t)?!1:r}function pme(n){if(!n)return!1;let e=n.previousElementSibling;for(;e!==null;){if(e instanceof HTMLLegendElement)return!1;e=e.previousElementSibling}return!0}let cV=Symbol();function mme(n,e=!0){return Object.assign(n,{[cV]:e})}function Xs(...n){let e=O.useRef(n);O.useEffect(()=>{e.current=n},[n]);let t=mt(r=>{for(let i of e.current)i!=null&&(typeof i=="function"?i(r):i.current=r)});return n.every(r=>r==null||(r==null?void 0:r[cV]))?void 0:t}let nL=O.createContext(null);nL.displayName="DescriptionContext";function uV(){let n=O.useContext(nL);if(n===null){let e=new Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(e,uV),e}return n}function gme(){var n,e;return(e=(n=O.useContext(nL))==null?void 0:n.value)!=null?e:void 0}let vme="p";function _me(n,e){let t=O.useId(),r=Jk(),{id:i=`headlessui-description-${t}`,...o}=n,s=uV(),a=Xs(e);_n(()=>s.register(i),[i,s.register]);let l=r||!1,c=O.useMemo(()=>({...s.slot,disabled:l}),[s.slot,l]),u={ref:a,...s.props,id:i};return Uo({ourProps:u,theirProps:o,slot:c,defaultTag:vme,name:s.name||"Description"})}let xme=eo(_me);Object.assign(xme,{});var bi=(n=>(n.Space=" ",n.Enter="Enter",n.Escape="Escape",n.Backspace="Backspace",n.Delete="Delete",n.ArrowLeft="ArrowLeft",n.ArrowUp="ArrowUp",n.ArrowRight="ArrowRight",n.ArrowDown="ArrowDown",n.Home="Home",n.End="End",n.PageUp="PageUp",n.PageDown="PageDown",n.Tab="Tab",n))(bi||{});let j1=O.createContext(null);j1.displayName="LabelContext";function dV(){let n=O.useContext(j1);if(n===null){let e=new Error("You used a <Label /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(e,dV),e}return n}function B1(n){var e,t,r;let i=(t=(e=O.useContext(j1))==null?void 0:e.value)!=null?t:void 0;return((r=n==null?void 0:n.length)!=null?r:0)>0?[i,...n].filter(Boolean).join(" "):i}function yme({inherit:n=!1}={}){let e=B1(),[t,r]=O.useState([]),i=n?[e,...t].filter(Boolean):t;return[i.length>0?i.join(" "):void 0,O.useMemo(()=>function(o){let s=mt(l=>(r(c=>[...c,l]),()=>r(c=>{let u=c.slice(),h=u.indexOf(l);return h!==-1&&u.splice(h,1),u}))),a=O.useMemo(()=>({register:s,slot:o.slot,name:o.name,props:o.props,value:o.value}),[s,o.slot,o.name,o.props,o.value]);return Rt.createElement(j1.Provider,{value:a},o.children)},[r])]}let wme="label";function Sme(n,e){var t;let r=O.useId(),i=dV(),o=lV(),s=Jk(),{id:a=`headlessui-label-${r}`,htmlFor:l=o??((t=i.props)==null?void 0:t.htmlFor),passive:c=!1,...u}=n,h=Xs(e);_n(()=>i.register(a),[a,i.register]);let f=mt(v=>{let p=v.currentTarget;if(p instanceof HTMLLabelElement&&v.preventDefault(),i.props&&"onClick"in i.props&&typeof i.props.onClick=="function"&&i.props.onClick(v),p instanceof HTMLLabelElement){let x=document.getElementById(p.htmlFor);if(x){let y=x.getAttribute("disabled");if(y==="true"||y==="")return;let w=x.getAttribute("aria-disabled");if(w==="true"||w==="")return;(x instanceof HTMLInputElement&&(x.type==="radio"||x.type==="checkbox")||x.role==="radio"||x.role==="checkbox"||x.role==="switch")&&x.click(),x.focus({preventScroll:!0})}}}),m=s||!1,g=O.useMemo(()=>({...i.slot,disabled:m}),[i.slot,m]),_={ref:h,...i.props,id:a,htmlFor:l,onClick:f};return c&&("onClick"in _&&(delete _.htmlFor,delete _.onClick),"onClick"in u&&delete u.onClick),Uo({ourProps:_,theirProps:u,slot:g,defaultTag:l?wme:"div",name:i.name||"Label"})}let Eme=eo(Sme),Tme=Object.assign(Eme,{});function wf(n,e,t){let r=t.initialDeps??[],i;return()=>{var o,s,a,l;let c;t.key&&((o=t.debug)!=null&&o.call(t))&&(c=Date.now());const u=n();if(!(u.length!==r.length||u.some((m,g)=>r[g]!==m)))return i;r=u;let f;if(t.key&&((s=t.debug)!=null&&s.call(t))&&(f=Date.now()),i=e(...u),t.key&&((a=t.debug)!=null&&a.call(t))){const m=Math.round((Date.now()-c)*100)/100,g=Math.round((Date.now()-f)*100)/100,_=g/16,v=(p,x)=>{for(p=String(p);p.length<x;)p=" "+p;return p};console.info(`%c ${v(g,5)} /${v(m,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*_,120))}deg 100% 31%);`,t==null?void 0:t.key)}return(l=t==null?void 0:t.onChange)==null||l.call(t,i),i}}function P2(n,e){if(n===void 0)throw new Error("Unexpected undefined");return n}const Cme=(n,e)=>Math.abs(n-e)<1,bme=(n,e,t)=>{let r;return function(...i){n.clearTimeout(r),r=n.setTimeout(()=>e.apply(this,i),t)}},Ame=n=>n,Mme=n=>{const e=Math.max(n.startIndex-n.overscan,0),t=Math.min(n.endIndex+n.overscan,n.count-1),r=[];for(let i=e;i<=t;i++)r.push(i);return r},Rme=(n,e)=>{const t=n.scrollElement;if(!t)return;const r=n.targetWindow;if(!r)return;const i=s=>{const{width:a,height:l}=s;e({width:Math.round(a),height:Math.round(l)})};if(i(t.getBoundingClientRect()),!r.ResizeObserver)return()=>{};const o=new r.ResizeObserver(s=>{const a=s[0];if(a!=null&&a.borderBoxSize){const l=a.borderBoxSize[0];if(l){i({width:l.inlineSize,height:l.blockSize});return}}i(t.getBoundingClientRect())});return o.observe(t,{box:"border-box"}),()=>{o.unobserve(t)}},b4={passive:!0},Nme=typeof window>"u"?!0:"onscrollend"in window,Ime=(n,e)=>{const t=n.scrollElement;if(!t)return;const r=n.targetWindow;if(!r)return;let i=0;const o=Nme?()=>{}:bme(r,()=>{e(i,!1)},n.options.isScrollingResetDelay),s=c=>()=>{const{horizontal:u,isRtl:h}=n.options;i=u?t.scrollLeft*(h&&-1||1):t.scrollTop,o(),e(i,c)},a=s(!0),l=s(!1);return l(),t.addEventListener("scroll",a,b4),t.addEventListener("scrollend",l,b4),()=>{t.removeEventListener("scroll",a),t.removeEventListener("scrollend",l)}},Pme=(n,e,t)=>{if(e!=null&&e.borderBoxSize){const r=e.borderBoxSize[0];if(r)return Math.round(r[t.options.horizontal?"inlineSize":"blockSize"])}return Math.round(n.getBoundingClientRect()[t.options.horizontal?"width":"height"])},kme=(n,{adjustments:e=0,behavior:t},r)=>{var i,o;const s=n+e;(o=(i=r.scrollElement)==null?void 0:i.scrollTo)==null||o.call(i,{[r.options.horizontal?"left":"top"]:s,behavior:t})};class Lme{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let t=null;const r=()=>t||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:t=new this.targetWindow.ResizeObserver(i=>{i.forEach(o=>{this._measureElement(o.target,o)})}));return{disconnect:()=>{var i;(i=r())==null||i.disconnect(),t=null},observe:i=>{var o;return(o=r())==null?void 0:o.observe(i,{box:"border-box"})},unobserve:i=>{var o;return(o=r())==null?void 0:o.unobserve(i)}}})(),this.range=null,this.setOptions=t=>{Object.entries(t).forEach(([r,i])=>{typeof i>"u"&&delete t[r]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Ame,rangeExtractor:Mme,onChange:()=>{},measureElement:Pme,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,...t}},this.notify=t=>{var r,i;(i=(r=this.options).onChange)==null||i.call(r,this,t)},this.maybeNotify=wf(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),t=>{this.notify(t)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(t=>t()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var t;const r=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==r){if(this.cleanup(),!r){this.maybeNotify();return}this.scrollElement=r,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((t=this.scrollElement)==null?void 0:t.window)??null,this.elementsCache.forEach(i=>{this.observer.observe(i)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,i=>{this.scrollRect=i,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(i,o)=>{this.scrollAdjustments=0,this.scrollDirection=o?this.getScrollOffset()<i?"forward":"backward":null,this.scrollOffset=i,this.isScrolling=o,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(t,r)=>{const i=new Map,o=new Map;for(let s=r-1;s>=0;s--){const a=t[s];if(i.has(a.lane))continue;const l=o.get(a.lane);if(l==null||a.end>l.end?o.set(a.lane,a):a.end<l.end&&i.set(a.lane,!0),i.size===this.options.lanes)break}return o.size===this.options.lanes?Array.from(o.values()).sort((s,a)=>s.end===a.end?s.index-a.index:s.end-a.end)[0]:void 0},this.getMeasurementOptions=wf(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(t,r,i,o,s)=>(this.pendingMeasuredCacheIndexes=[],{count:t,paddingStart:r,scrollMargin:i,getItemKey:o,enabled:s}),{key:!1}),this.getMeasurements=wf(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:t,paddingStart:r,scrollMargin:i,getItemKey:o,enabled:s},a)=>{if(!s)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(u=>{this.itemSizeCache.set(u.key,u.size)}));const l=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const c=this.measurementsCache.slice(0,l);for(let u=l;u<t;u++){const h=o(u),f=this.options.lanes===1?c[u-1]:this.getFurthestMeasurement(c,u),m=f?f.end+this.options.gap:r+i,g=a.get(h),_=typeof g=="number"?g:this.options.estimateSize(u),v=m+_,p=f?f.lane:u%this.options.lanes;c[u]={index:u,start:m,size:_,end:v,key:h,lane:p}}return this.measurementsCache=c,c},{key:!1,debug:()=>this.options.debug}),this.calculateRange=wf(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset()],(t,r,i)=>this.range=t.length>0&&r>0?Ome({measurements:t,outerSize:r,scrollOffset:i}):null,{key:!1,debug:()=>this.options.debug}),this.getIndexes=wf(()=>[this.options.rangeExtractor,this.calculateRange(),this.options.overscan,this.options.count],(t,r,i,o)=>r===null?[]:t({startIndex:r.startIndex,endIndex:r.endIndex,overscan:i,count:o}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=t=>{const r=this.options.indexAttribute,i=t.getAttribute(r);return i?parseInt(i,10):(console.warn(`Missing attribute name '${r}={index}' on measured element.`),-1)},this._measureElement=(t,r)=>{const i=this.indexFromElement(t),o=this.measurementsCache[i];if(!o)return;const s=o.key,a=this.elementsCache.get(s);a!==t&&(a&&this.observer.unobserve(a),this.observer.observe(t),this.elementsCache.set(s,t)),t.isConnected&&this.resizeItem(i,this.options.measureElement(t,r,this))},this.resizeItem=(t,r)=>{const i=this.measurementsCache[t];if(!i)return;const o=this.itemSizeCache.get(i.key)??i.size,s=r-o;s!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(i,s,this):i.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=s,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(i.index),this.itemSizeCache=new Map(this.itemSizeCache.set(i.key,r)),this.notify(!1))},this.measureElement=t=>{if(!t){this.elementsCache.forEach((r,i)=>{r.isConnected||(this.observer.unobserve(r),this.elementsCache.delete(i))});return}this._measureElement(t,void 0)},this.getVirtualItems=wf(()=>[this.getIndexes(),this.getMeasurements()],(t,r)=>{const i=[];for(let o=0,s=t.length;o<s;o++){const a=t[o],l=r[a];i.push(l)}return i},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=t=>{const r=this.getMeasurements();if(r.length!==0)return P2(r[hV(0,r.length-1,i=>P2(r[i]).start,t)])},this.getOffsetForAlignment=(t,r)=>{const i=this.getSize(),o=this.getScrollOffset();r==="auto"&&(t<=o?r="start":t>=o+i?r="end":r="start"),r==="start"?t=t:r==="end"?t=t-i:r==="center"&&(t=t-i/2);const s=this.options.horizontal?"scrollWidth":"scrollHeight",l=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[s]:this.scrollElement[s]:0)-i;return Math.max(Math.min(l,t),0)},this.getOffsetForIndex=(t,r="auto")=>{t=Math.max(0,Math.min(t,this.options.count-1));const i=this.measurementsCache[t];if(!i)return;const o=this.getSize(),s=this.getScrollOffset();if(r==="auto")if(i.end>=s+o-this.options.scrollPaddingEnd)r="end";else if(i.start<=s+this.options.scrollPaddingStart)r="start";else return[s,r];const a=r==="end"?i.end+this.options.scrollPaddingEnd:i.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,r),r]},this.isDynamicMode=()=>this.elementsCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(t,{align:r="start",behavior:i}={})=>{this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(t,r),{adjustments:void 0,behavior:i})},this.scrollToIndex=(t,{align:r="auto",behavior:i}={})=>{t=Math.max(0,Math.min(t,this.options.count-1)),this.cancelScrollToIndex(),i==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const o=this.getOffsetForIndex(t,r);if(!o)return;const[s,a]=o;this._scrollToOffset(s,{adjustments:void 0,behavior:i}),i!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.elementsCache.has(this.options.getItemKey(t))){const[c]=P2(this.getOffsetForIndex(t,a));Cme(c,this.getScrollOffset())||this.scrollToIndex(t,{align:a,behavior:i})}else this.scrollToIndex(t,{align:a,behavior:i})}))},this.scrollBy=(t,{behavior:r}={})=>{this.cancelScrollToIndex(),r==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+t,{adjustments:void 0,behavior:r})},this.getTotalSize=()=>{var t;const r=this.getMeasurements();let i;return r.length===0?i=this.options.paddingStart:i=this.options.lanes===1?((t=r[r.length-1])==null?void 0:t.end)??0:Math.max(...r.slice(-this.options.lanes).map(o=>o.end)),Math.max(i-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(t,{adjustments:r,behavior:i})=>{this.options.scrollToFn(t,{behavior:i,adjustments:r},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e)}}const hV=(n,e,t,r)=>{for(;n<=e;){const i=(n+e)/2|0,o=t(i);if(o<r)n=i+1;else if(o>r)e=i-1;else return i}return n>0?n-1:0};function Ome({measurements:n,outerSize:e,scrollOffset:t}){const r=n.length-1,o=hV(0,r,a=>n[a].start,t);let s=o;for(;s<r&&n[s].end<t+e;)s++;return{startIndex:o,endIndex:s}}const Dme=typeof document<"u"?O.useLayoutEffect:O.useEffect;function Ume(n){const e=O.useReducer(()=>({}),{})[1],t={...n,onChange:(i,o)=>{var s;o?bt.flushSync(e):e(),(s=n.onChange)==null||s.call(n,i,o)}},[r]=O.useState(()=>new Lme(t));return r.setOptions(t),O.useEffect(()=>r._didMount(),[]),Dme(()=>r._willUpdate()),r}function Fme(n){return Ume({observeElementRect:Rme,observeElementOffset:Ime,scrollToFn:kme,...n})}function jme(n,e){return n!==null&&e!==null&&typeof n=="object"&&typeof e=="object"&&"id"in n&&"id"in e?n.id===e.id:n===e}function Bme(n=jme){return O.useCallback((e,t)=>{if(typeof n=="string"){let r=n;return(e==null?void 0:e[r])===(t==null?void 0:t[r])}return n(e,t)},[n])}function zme(n){if(n===null)return{width:0,height:0};let{width:e,height:t}=n.getBoundingClientRect();return{width:e,height:t}}function A4(n,e=!1){let[t,r]=O.useReducer(()=>({}),{}),i=O.useMemo(()=>zme(n),[n,t]);return _n(()=>{if(!n)return;let o=new ResizeObserver(r);return o.observe(n),()=>{o.disconnect()}},[n]),e?{width:`${i.width}px`,height:`${i.height}px`}:i}let Hme=class extends Map{constructor(e){super(),this.factory=e}get(e){let t=super.get(e);return t===void 0&&(t=this.factory(e),this.set(e,t)),t}};function fV(n,e){let t=n(),r=new Set;return{getSnapshot(){return t},subscribe(i){return r.add(i),()=>r.delete(i)},dispatch(i,...o){let s=e[i].call(t,...o);s&&(t=s,r.forEach(a=>a()))}}}function pV(n){return O.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getSnapshot)}let Vme=new Hme(()=>fV(()=>[],{ADD(n){return this.includes(n)?this:[...this,n]},REMOVE(n){let e=this.indexOf(n);if(e===-1)return this;let t=this.slice();return t.splice(e,1),t}}));function rL(n,e){let t=Vme.get(e),r=O.useId(),i=pV(t);if(_n(()=>{if(n)return t.dispatch("ADD",r),()=>t.dispatch("REMOVE",r)},[t,n]),!n)return!1;let o=i.indexOf(r),s=i.length;return o===-1&&(o=s,s+=1),o===s-1}let AN=new Map,nv=new Map;function M4(n){var e;let t=(e=nv.get(n))!=null?e:0;return nv.set(n,t+1),t!==0?()=>R4(n):(AN.set(n,{"aria-hidden":n.getAttribute("aria-hidden"),inert:n.inert}),n.setAttribute("aria-hidden","true"),n.inert=!0,()=>R4(n))}function R4(n){var e;let t=(e=nv.get(n))!=null?e:1;if(t===1?nv.delete(n):nv.set(n,t-1),t!==1)return;let r=AN.get(n);r&&(r["aria-hidden"]===null?n.removeAttribute("aria-hidden"):n.setAttribute("aria-hidden",r["aria-hidden"]),n.inert=r.inert,AN.delete(n))}function Gme(n,{allowed:e,disallowed:t}={}){let r=rL(n,"inert-others");_n(()=>{var i,o;if(!r)return;let s=Oa();for(let l of(i=t==null?void 0:t())!=null?i:[])l&&s.add(M4(l));let a=(o=e==null?void 0:e())!=null?o:[];for(let l of a){if(!l)continue;let c=y_(l);if(!c)continue;let u=l.parentElement;for(;u&&u!==c.body;){for(let h of u.children)a.some(f=>h.contains(f))||s.add(M4(h));u=u.parentElement}}return s.dispose},[r,e,t])}function Wme(n,e,t){let r=Tu(i=>{let o=i.getBoundingClientRect();o.x===0&&o.y===0&&o.width===0&&o.height===0&&t()});O.useEffect(()=>{if(!n)return;let i=e===null?null:e instanceof HTMLElement?e:e.current;if(!i)return;let o=Oa();if(typeof ResizeObserver<"u"){let s=new ResizeObserver(()=>r.current(i));s.observe(i),o.add(()=>s.disconnect())}if(typeof IntersectionObserver<"u"){let s=new IntersectionObserver(()=>r.current(i));s.observe(i),o.add(()=>s.disconnect())}return()=>o.dispose()},[e,r,n])}let MN=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(n=>`${n}:not([tabindex='-1'])`).join(",");var $me=(n=>(n[n.First=1]="First",n[n.Previous=2]="Previous",n[n.Next=4]="Next",n[n.Last=8]="Last",n[n.WrapAround=16]="WrapAround",n[n.NoScroll=32]="NoScroll",n[n.AutoFocus=64]="AutoFocus",n))($me||{}),Yme=(n=>(n[n.Error=0]="Error",n[n.Overflow=1]="Overflow",n[n.Success=2]="Success",n[n.Underflow=3]="Underflow",n))(Yme||{}),Kme=(n=>(n[n.Previous=-1]="Previous",n[n.Next=1]="Next",n))(Kme||{}),mV=(n=>(n[n.Strict=0]="Strict",n[n.Loose=1]="Loose",n))(mV||{});function Xme(n,e=0){var t;return n===((t=y_(n))==null?void 0:t.body)?!1:js(e,{0(){return n.matches(MN)},1(){let r=n;for(;r!==null;){if(r.matches(MN))return!0;r=r.parentElement}return!1}})}var qme=(n=>(n[n.Keyboard=0]="Keyboard",n[n.Mouse=1]="Mouse",n))(qme||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",n=>{n.metaKey||n.altKey||n.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",n=>{n.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:n.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));function Qme(n,e=t=>t){return n.slice().sort((t,r)=>{let i=e(t),o=e(r);if(i===null||o===null)return 0;let s=i.compareDocumentPosition(o);return s&Node.DOCUMENT_POSITION_FOLLOWING?-1:s&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function gV(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function Zme(){return/Android/gi.test(window.navigator.userAgent)}function vV(){return gV()||Zme()}function qg(n,e,t,r){let i=Tu(t);O.useEffect(()=>{if(!n)return;function o(s){i.current(s)}return document.addEventListener(e,o,r),()=>document.removeEventListener(e,o,r)},[n,e,r])}function Jme(n,e,t,r){let i=Tu(t);O.useEffect(()=>{if(!n)return;function o(s){i.current(s)}return window.addEventListener(e,o,r),()=>window.removeEventListener(e,o,r)},[n,e,r])}const N4=30;function ege(n,e,t){let r=rL(n,"outside-click"),i=Tu(t),o=O.useCallback(function(l,c){if(l.defaultPrevented)return;let u=c(l);if(u===null||!u.getRootNode().contains(u)||!u.isConnected)return;let h=function f(m){return typeof m=="function"?f(m()):Array.isArray(m)||m instanceof Set?m:[m]}(e);for(let f of h)if(f!==null&&(f.contains(u)||l.composed&&l.composedPath().includes(f)))return;return!Xme(u,mV.Loose)&&u.tabIndex!==-1&&l.preventDefault(),i.current(l,u)},[i,e]),s=O.useRef(null);qg(r,"pointerdown",l=>{var c,u;s.current=((u=(c=l.composedPath)==null?void 0:c.call(l))==null?void 0:u[0])||l.target},!0),qg(r,"mousedown",l=>{var c,u;s.current=((u=(c=l.composedPath)==null?void 0:c.call(l))==null?void 0:u[0])||l.target},!0),qg(r,"click",l=>{vV()||s.current&&(o(l,()=>s.current),s.current=null)},!0);let a=O.useRef({x:0,y:0});qg(r,"touchstart",l=>{a.current.x=l.touches[0].clientX,a.current.y=l.touches[0].clientY},!0),qg(r,"touchend",l=>{let c={x:l.changedTouches[0].clientX,y:l.changedTouches[0].clientY};if(!(Math.abs(c.x-a.current.x)>=N4||Math.abs(c.y-a.current.y)>=N4))return o(l,()=>l.target instanceof HTMLElement?l.target:null)},!0),Jme(r,"blur",l=>o(l,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}function z1(...n){return O.useMemo(()=>y_(...n),[...n])}function tge(n,e,t,r){let i=Tu(t);O.useEffect(()=>{n=n??window;function o(s){i.current(s)}return n.addEventListener(e,o,r),()=>n.removeEventListener(e,o,r)},[n,e,r])}function _V(n){let e=O.useRef({value:"",selectionStart:null,selectionEnd:null});return tge(n,"blur",t=>{let r=t.target;r instanceof HTMLInputElement&&(e.current={value:r.value,selectionStart:r.selectionStart,selectionEnd:r.selectionEnd})}),mt(()=>{if(document.activeElement!==n&&n instanceof HTMLInputElement&&n.isConnected){if(n.focus({preventScroll:!0}),n.value!==e.current.value)n.setSelectionRange(n.value.length,n.value.length);else{let{selectionStart:t,selectionEnd:r}=e.current;t!==null&&r!==null&&n.setSelectionRange(t,r)}e.current={value:"",selectionStart:null,selectionEnd:null}}})}function nge(n,e){return O.useMemo(()=>{var t;if(n.type)return n.type;let r=(t=n.as)!=null?t:"button";if(typeof r=="string"&&r.toLowerCase()==="button"||(e==null?void 0:e.tagName)==="BUTTON"&&!e.hasAttribute("type"))return"button"},[n.type,n.as,e])}function rge(){let n;return{before({doc:e}){var t;let r=e.documentElement,i=(t=e.defaultView)!=null?t:window;n=Math.max(0,i.innerWidth-r.clientWidth)},after({doc:e,d:t}){let r=e.documentElement,i=Math.max(0,r.clientWidth-r.offsetWidth),o=Math.max(0,n-i);t.style(r,"paddingRight",`${o}px`)}}}function ige(){return gV()?{before({doc:n,d:e,meta:t}){function r(i){return t.containers.flatMap(o=>o()).some(o=>o.contains(i))}e.microTask(()=>{var i;if(window.getComputedStyle(n.documentElement).scrollBehavior!=="auto"){let a=Oa();a.style(n.documentElement,"scrollBehavior","auto"),e.add(()=>e.microTask(()=>a.dispose()))}let o=(i=window.scrollY)!=null?i:window.pageYOffset,s=null;e.addEventListener(n,"click",a=>{if(a.target instanceof HTMLElement)try{let l=a.target.closest("a");if(!l)return;let{hash:c}=new URL(l.href),u=n.querySelector(c);u&&!r(u)&&(s=u)}catch{}},!0),e.addEventListener(n,"touchstart",a=>{if(a.target instanceof HTMLElement)if(r(a.target)){let l=a.target;for(;l.parentElement&&r(l.parentElement);)l=l.parentElement;e.style(l,"overscrollBehavior","contain")}else e.style(a.target,"touchAction","none")}),e.addEventListener(n,"touchmove",a=>{if(a.target instanceof HTMLElement){if(a.target.tagName==="INPUT")return;if(r(a.target)){let l=a.target;for(;l.parentElement&&l.dataset.headlessuiPortal!==""&&!(l.scrollHeight>l.clientHeight||l.scrollWidth>l.clientWidth);)l=l.parentElement;l.dataset.headlessuiPortal===""&&a.preventDefault()}else a.preventDefault()}},{passive:!1}),e.add(()=>{var a;let l=(a=window.scrollY)!=null?a:window.pageYOffset;o!==l&&window.scrollTo(0,o),s&&s.isConnected&&(s.scrollIntoView({block:"nearest"}),s=null)})})}}:{}}function oge(){return{before({doc:n,d:e}){e.style(n.documentElement,"overflow","hidden")}}}function sge(n){let e={};for(let t of n)Object.assign(e,t(e));return e}let Cd=fV(()=>new Map,{PUSH(n,e){var t;let r=(t=this.get(n))!=null?t:{doc:n,count:0,d:Oa(),meta:new Set};return r.count++,r.meta.add(e),this.set(n,r),this},POP(n,e){let t=this.get(n);return t&&(t.count--,t.meta.delete(e)),this},SCROLL_PREVENT({doc:n,d:e,meta:t}){let r={doc:n,d:e,meta:sge(t)},i=[ige(),rge(),oge()];i.forEach(({before:o})=>o==null?void 0:o(r)),i.forEach(({after:o})=>o==null?void 0:o(r))},SCROLL_ALLOW({d:n}){n.dispose()},TEARDOWN({doc:n}){this.delete(n)}});Cd.subscribe(()=>{let n=Cd.getSnapshot(),e=new Map;for(let[t]of n)e.set(t,t.documentElement.style.overflow);for(let t of n.values()){let r=e.get(t.doc)==="hidden",i=t.count!==0;(i&&!r||!i&&r)&&Cd.dispatch(t.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",t),t.count===0&&Cd.dispatch("TEARDOWN",t)}});function age(n,e,t=()=>({containers:[]})){let r=pV(Cd),i=e?r.get(e):void 0,o=i?i.count>0:!1;return _n(()=>{if(!(!e||!n))return Cd.dispatch("PUSH",e,t),()=>Cd.dispatch("POP",e,t)},[n,e]),o}function lge(n,e,t=()=>[document.body]){let r=rL(n,"scroll-lock");age(r,e,i=>{var o;return{containers:[...(o=i.containers)!=null?o:[],t]}})}function I4(n){return[n.screenX,n.screenY]}function cge(){let n=O.useRef([-1,-1]);return{wasMoved(e){let t=I4(e);return n.current[0]===t[0]&&n.current[1]===t[1]?!1:(n.current=t,!0)},update(e){n.current=I4(e)}}}function uge(n=0){let[e,t]=O.useState(n),r=O.useCallback(l=>t(l),[e]),i=O.useCallback(l=>t(c=>c|l),[e]),o=O.useCallback(l=>(e&l)===l,[e]),s=O.useCallback(l=>t(c=>c&~l),[t]),a=O.useCallback(l=>t(c=>c^l),[t]);return{flags:e,setFlag:r,addFlag:i,hasFlag:o,removeFlag:s,toggleFlag:a}}var dge={},P4;typeof process<"u"&&typeof globalThis<"u"&&((P4=process==null?void 0:dge)==null?void 0:P4.NODE_ENV)==="test"&&typeof Element.prototype.getAnimations>"u"&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join(`
`)),[]});var hge=(n=>(n[n.None=0]="None",n[n.Closed=1]="Closed",n[n.Enter=2]="Enter",n[n.Leave=4]="Leave",n))(hge||{});function xV(n){let e={};for(let t in n)n[t]===!0&&(e[`data-${t}`]="");return e}function yV(n,e,t,r){let[i,o]=O.useState(t),{hasFlag:s,addFlag:a,removeFlag:l}=uge(n&&i?3:0),c=O.useRef(!1),u=O.useRef(!1),h=qm();return _n(()=>{var f;if(n){if(t&&o(!0),!e){t&&a(3);return}return(f=r==null?void 0:r.start)==null||f.call(r,t),fge(e,{inFlight:c,prepare(){u.current?u.current=!1:u.current=c.current,c.current=!0,!u.current&&(t?(a(3),l(4)):(a(4),l(2)))},run(){u.current?t?(l(3),a(4)):(l(4),a(3)):t?l(1):a(1)},done(){var m;u.current&&typeof e.getAnimations=="function"&&e.getAnimations().length>0||(c.current=!1,l(7),t||o(!1),(m=r==null?void 0:r.end)==null||m.call(r,t))}})}},[n,t,e,h]),n?[i,{closed:s(1),enter:s(2),leave:s(4),transition:s(2)||s(4)}]:[t,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}function fge(n,{prepare:e,run:t,done:r,inFlight:i}){let o=Oa();return mge(n,{prepare:e,inFlight:i}),o.nextFrame(()=>{t(),o.requestAnimationFrame(()=>{o.add(pge(n,r))})}),o.dispose}function pge(n,e){var t,r;let i=Oa();if(!n)return i.dispose;let o=!1;i.add(()=>{o=!0});let s=(r=(t=n.getAnimations)==null?void 0:t.call(n).filter(a=>a instanceof CSSTransition))!=null?r:[];return s.length===0?(e(),i.dispose):(Promise.allSettled(s.map(a=>a.finished)).then(()=>{o||e()}),i.dispose)}function mge(n,{inFlight:e,prepare:t}){if(e!=null&&e.current){t();return}let r=n.style.transition;n.style.transition="none",t(),n.offsetHeight,n.style.transition=r}function gge(n,{container:e,accept:t,walk:r}){let i=O.useRef(t),o=O.useRef(r);O.useEffect(()=>{i.current=t,o.current=r},[t,r]),_n(()=>{if(!e||!n)return;let s=y_(e);if(!s)return;let a=i.current,l=o.current,c=Object.assign(h=>a(h),{acceptNode:a}),u=s.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,c,!1);for(;u.nextNode();)l(u.currentNode)},[e,n,i,o])}function k4(n,e){let t=O.useRef([]),r=mt(n);O.useEffect(()=>{let i=[...t.current];for(let[o,s]of e.entries())if(t.current[o]!==s){let a=r(e,i);return t.current=e,a}},[r,...e])}function H1(){return typeof window<"u"}function Qm(n){return wV(n)?(n.nodeName||"").toLowerCase():"#document"}function Ro(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function Ba(n){var e;return(e=(wV(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function wV(n){return H1()?n instanceof Node||n instanceof Ro(n).Node:!1}function ki(n){return H1()?n instanceof Element||n instanceof Ro(n).Element:!1}function Da(n){return H1()?n instanceof HTMLElement||n instanceof Ro(n).HTMLElement:!1}function L4(n){return!H1()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Ro(n).ShadowRoot}function w_(n){const{overflow:e,overflowX:t,overflowY:r,display:i}=$s(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(i)}function vge(n){return["table","td","th"].includes(Qm(n))}function V1(n){return[":popover-open",":modal"].some(e=>{try{return n.matches(e)}catch{return!1}})}function iL(n){const e=oL(),t=ki(n)?$s(n):n;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function _ge(n){let e=pu(n);for(;Da(e)&&!Rm(e);){if(iL(e))return e;if(V1(e))return null;e=pu(e)}return null}function oL(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Rm(n){return["html","body","#document"].includes(Qm(n))}function $s(n){return Ro(n).getComputedStyle(n)}function G1(n){return ki(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function pu(n){if(Qm(n)==="html")return n;const e=n.assignedSlot||n.parentNode||L4(n)&&n.host||Ba(n);return L4(e)?e.host:e}function SV(n){const e=pu(n);return Rm(e)?n.ownerDocument?n.ownerDocument.body:n.body:Da(e)&&w_(e)?e:SV(e)}function Wv(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=SV(n),o=i===((r=n.ownerDocument)==null?void 0:r.body),s=Ro(i);if(o){const a=RN(s);return e.concat(s,s.visualViewport||[],w_(i)?i:[],a&&t?Wv(a):[])}return e.concat(i,Wv(i,[],t))}function RN(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function xge(){const n=navigator.userAgentData;return n&&Array.isArray(n.brands)?n.brands.map(e=>{let{brand:t,version:r}=e;return t+"/"+r}).join(" "):navigator.userAgent}const Nm=Math.min,gi=Math.max,$v=Math.round,hy=Math.floor,mu=n=>({x:n,y:n}),yge={left:"right",right:"left",bottom:"top",top:"bottom"},wge={start:"end",end:"start"};function O4(n,e,t){return gi(n,Nm(e,t))}function Zm(n,e){return typeof n=="function"?n(e):n}function gu(n){return n.split("-")[0]}function S_(n){return n.split("-")[1]}function EV(n){return n==="x"?"y":"x"}function TV(n){return n==="y"?"height":"width"}function uh(n){return["top","bottom"].includes(gu(n))?"y":"x"}function CV(n){return EV(uh(n))}function Sge(n,e,t){t===void 0&&(t=!1);const r=S_(n),i=CV(n),o=TV(i);let s=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(s=yE(s)),[s,yE(s)]}function Ege(n){const e=yE(n);return[NN(n),e,NN(e)]}function NN(n){return n.replace(/start|end/g,e=>wge[e])}function Tge(n,e,t){const r=["left","right"],i=["right","left"],o=["top","bottom"],s=["bottom","top"];switch(n){case"top":case"bottom":return t?e?i:r:e?r:i;case"left":case"right":return e?o:s;default:return[]}}function Cge(n,e,t,r){const i=S_(n);let o=Tge(gu(n),t==="start",r);return i&&(o=o.map(s=>s+"-"+i),e&&(o=o.concat(o.map(NN)))),o}function yE(n){return n.replace(/left|right|bottom|top/g,e=>yge[e])}function bge(n){return{top:0,right:0,bottom:0,left:0,...n}}function Age(n){return typeof n!="number"?bge(n):{top:n,right:n,bottom:n,left:n}}function wE(n){const{x:e,y:t,width:r,height:i}=n;return{width:r,height:i,top:t,left:e,right:e+r,bottom:t+i,x:e,y:t}}function D4(n,e,t){let{reference:r,floating:i}=n;const o=uh(e),s=CV(e),a=TV(s),l=gu(e),c=o==="y",u=r.x+r.width/2-i.width/2,h=r.y+r.height/2-i.height/2,f=r[a]/2-i[a]/2;let m;switch(l){case"top":m={x:u,y:r.y-i.height};break;case"bottom":m={x:u,y:r.y+r.height};break;case"right":m={x:r.x+r.width,y:h};break;case"left":m={x:r.x-i.width,y:h};break;default:m={x:r.x,y:r.y}}switch(S_(e)){case"start":m[s]-=f*(t&&c?-1:1);break;case"end":m[s]+=f*(t&&c?-1:1);break}return m}const Mge=async(n,e,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=t,a=o.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(e));let c=await s.getElementRects({reference:n,floating:e,strategy:i}),{x:u,y:h}=D4(c,r,l),f=r,m={},g=0;for(let _=0;_<a.length;_++){const{name:v,fn:p}=a[_],{x,y,data:w,reset:C}=await p({x:u,y:h,initialPlacement:r,placement:f,strategy:i,middlewareData:m,rects:c,platform:s,elements:{reference:n,floating:e}});u=x??u,h=y??h,m={...m,[v]:{...m[v],...w}},C&&g<=50&&(g++,typeof C=="object"&&(C.placement&&(f=C.placement),C.rects&&(c=C.rects===!0?await s.getElementRects({reference:n,floating:e,strategy:i}):C.rects),{x:u,y:h}=D4(c,f,l)),_=-1)}return{x:u,y:h,placement:f,strategy:i,middlewareData:m}};async function W1(n,e){var t;e===void 0&&(e={});const{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:f=!1,padding:m=0}=Zm(e,n),g=Age(m),v=a[f?h==="floating"?"reference":"floating":h],p=wE(await o.getClippingRect({element:(t=await(o.isElement==null?void 0:o.isElement(v)))==null||t?v:v.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),x=h==="floating"?{x:r,y:i,width:s.floating.width,height:s.floating.height}:s.reference,y=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),w=await(o.isElement==null?void 0:o.isElement(y))?await(o.getScale==null?void 0:o.getScale(y))||{x:1,y:1}:{x:1,y:1},C=wE(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:x,offsetParent:y,strategy:l}):x);return{top:(p.top-C.top+g.top)/w.y,bottom:(C.bottom-p.bottom+g.bottom)/w.y,left:(p.left-C.left+g.left)/w.x,right:(C.right-p.right+g.right)/w.x}}const Rge=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:i,middlewareData:o,rects:s,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:_=!0,...v}=Zm(n,e);if((t=o.arrow)!=null&&t.alignmentOffset)return{};const p=gu(i),x=uh(a),y=gu(a)===a,w=await(l.isRTL==null?void 0:l.isRTL(c.floating)),C=f||(y||!_?[yE(a)]:Ege(a)),T=g!=="none";!f&&T&&C.push(...Cge(a,_,g,w));const S=[a,...C],b=await W1(e,v),R=[];let E=((r=o.flip)==null?void 0:r.overflows)||[];if(u&&R.push(b[p]),h){const M=Sge(i,s,w);R.push(b[M[0]],b[M[1]])}if(E=[...E,{placement:i,overflows:R}],!R.every(M=>M<=0)){var A,F;const M=(((A=o.flip)==null?void 0:A.index)||0)+1,k=S[M];if(k)return{data:{index:M,overflows:E},reset:{placement:k}};let z=(F=E.filter(P=>P.overflows[0]<=0).sort((P,U)=>P.overflows[1]-U.overflows[1])[0])==null?void 0:F.placement;if(!z)switch(m){case"bestFit":{var D;const P=(D=E.filter(U=>{if(T){const Y=uh(U.placement);return Y===x||Y==="y"}return!0}).map(U=>[U.placement,U.overflows.filter(Y=>Y>0).reduce((Y,Z)=>Y+Z,0)]).sort((U,Y)=>U[1]-Y[1])[0])==null?void 0:D[0];P&&(z=P);break}case"initialPlacement":z=a;break}if(i!==z)return{reset:{placement:z}}}return{}}}};async function Nge(n,e){const{placement:t,platform:r,elements:i}=n,o=await(r.isRTL==null?void 0:r.isRTL(i.floating)),s=gu(t),a=S_(t),l=uh(t)==="y",c=["left","top"].includes(s)?-1:1,u=o&&l?-1:1,h=Zm(e,n);let{mainAxis:f,crossAxis:m,alignmentAxis:g}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return a&&typeof g=="number"&&(m=a==="end"?g*-1:g),l?{x:m*u,y:f*c}:{x:f*c,y:m*u}}const Ige=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:i,y:o,placement:s,middlewareData:a}=e,l=await Nge(e,n);return s===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:o+l.y,data:{...l,placement:s}}}}},Pge=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:i}=e,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:v=>{let{x:p,y:x}=v;return{x:p,y:x}}},...l}=Zm(n,e),c={x:t,y:r},u=await W1(e,l),h=uh(gu(i)),f=EV(h);let m=c[f],g=c[h];if(o){const v=f==="y"?"top":"left",p=f==="y"?"bottom":"right",x=m+u[v],y=m-u[p];m=O4(x,m,y)}if(s){const v=h==="y"?"top":"left",p=h==="y"?"bottom":"right",x=g+u[v],y=g-u[p];g=O4(x,g,y)}const _=a.fn({...e,[f]:m,[h]:g});return{..._,data:{x:_.x-t,y:_.y-r,enabled:{[f]:o,[h]:s}}}}}},kge=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,r;const{placement:i,rects:o,platform:s,elements:a}=e,{apply:l=()=>{},...c}=Zm(n,e),u=await W1(e,c),h=gu(i),f=S_(i),m=uh(i)==="y",{width:g,height:_}=o.floating;let v,p;h==="top"||h==="bottom"?(v=h,p=f===(await(s.isRTL==null?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(p=h,v=f==="end"?"top":"bottom");const x=_-u.top-u.bottom,y=g-u.left-u.right,w=Nm(_-u[v],x),C=Nm(g-u[p],y),T=!e.middlewareData.shift;let S=w,b=C;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(b=y),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(S=x),T&&!f){const E=gi(u.left,0),A=gi(u.right,0),F=gi(u.top,0),D=gi(u.bottom,0);m?b=g-2*(E!==0||A!==0?E+A:gi(u.left,u.right)):S=_-2*(F!==0||D!==0?F+D:gi(u.top,u.bottom))}await l({...e,availableWidth:b,availableHeight:S});const R=await s.getDimensions(a.floating);return g!==R.width||_!==R.height?{reset:{rects:!0}}:{}}}};function bV(n){const e=$s(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Da(n),o=i?n.offsetWidth:t,s=i?n.offsetHeight:r,a=$v(t)!==o||$v(r)!==s;return a&&(t=o,r=s),{width:t,height:r,$:a}}function sL(n){return ki(n)?n:n.contextElement}function Kp(n){const e=sL(n);if(!Da(e))return mu(1);const t=e.getBoundingClientRect(),{width:r,height:i,$:o}=bV(e);let s=(o?$v(t.width):t.width)/r,a=(o?$v(t.height):t.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const Lge=mu(0);function AV(n){const e=Ro(n);return!oL()||!e.visualViewport?Lge:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Oge(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Ro(n)?!1:e}function dh(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),o=sL(n);let s=mu(1);e&&(r?ki(r)&&(s=Kp(r)):s=Kp(n));const a=Oge(o,t,r)?AV(o):mu(0);let l=(i.left+a.x)/s.x,c=(i.top+a.y)/s.y,u=i.width/s.x,h=i.height/s.y;if(o){const f=Ro(o),m=r&&ki(r)?Ro(r):r;let g=f,_=RN(g);for(;_&&r&&m!==g;){const v=Kp(_),p=_.getBoundingClientRect(),x=$s(_),y=p.left+(_.clientLeft+parseFloat(x.paddingLeft))*v.x,w=p.top+(_.clientTop+parseFloat(x.paddingTop))*v.y;l*=v.x,c*=v.y,u*=v.x,h*=v.y,l+=y,c+=w,g=Ro(_),_=RN(g)}}return wE({width:u,height:h,x:l,y:c})}function Dge(n){let{elements:e,rect:t,offsetParent:r,strategy:i}=n;const o=i==="fixed",s=Ba(r),a=e?V1(e.floating):!1;if(r===s||a&&o)return t;let l={scrollLeft:0,scrollTop:0},c=mu(1);const u=mu(0),h=Da(r);if((h||!h&&!o)&&((Qm(r)!=="body"||w_(s))&&(l=G1(r)),Da(r))){const f=dh(r);c=Kp(r),u.x=f.x+r.clientLeft,u.y=f.y+r.clientTop}return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x,y:t.y*c.y-l.scrollTop*c.y+u.y}}function Uge(n){return Array.from(n.getClientRects())}function IN(n,e){const t=G1(n).scrollLeft;return e?e.left+t:dh(Ba(n)).left+t}function Fge(n){const e=Ba(n),t=G1(n),r=n.ownerDocument.body,i=gi(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),o=gi(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let s=-t.scrollLeft+IN(n);const a=-t.scrollTop;return $s(r).direction==="rtl"&&(s+=gi(e.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}function jge(n,e){const t=Ro(n),r=Ba(n),i=t.visualViewport;let o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;const c=oL();(!c||c&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}function Bge(n,e){const t=dh(n,!0,e==="fixed"),r=t.top+n.clientTop,i=t.left+n.clientLeft,o=Da(n)?Kp(n):mu(1),s=n.clientWidth*o.x,a=n.clientHeight*o.y,l=i*o.x,c=r*o.y;return{width:s,height:a,x:l,y:c}}function U4(n,e,t){let r;if(e==="viewport")r=jge(n,t);else if(e==="document")r=Fge(Ba(n));else if(ki(e))r=Bge(e,t);else{const i=AV(n);r={...e,x:e.x-i.x,y:e.y-i.y}}return wE(r)}function MV(n,e){const t=pu(n);return t===e||!ki(t)||Rm(t)?!1:$s(t).position==="fixed"||MV(t,e)}function zge(n,e){const t=e.get(n);if(t)return t;let r=Wv(n,[],!1).filter(a=>ki(a)&&Qm(a)!=="body"),i=null;const o=$s(n).position==="fixed";let s=o?pu(n):n;for(;ki(s)&&!Rm(s);){const a=$s(s),l=iL(s);!l&&a.position==="fixed"&&(i=null),(o?!l&&!i:!l&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||w_(s)&&!l&&MV(n,s))?r=r.filter(u=>u!==s):i=a,s=pu(s)}return e.set(n,r),r}function Hge(n){let{element:e,boundary:t,rootBoundary:r,strategy:i}=n;const s=[...t==="clippingAncestors"?V1(e)?[]:zge(e,this._c):[].concat(t),r],a=s[0],l=s.reduce((c,u)=>{const h=U4(e,u,i);return c.top=gi(h.top,c.top),c.right=Nm(h.right,c.right),c.bottom=Nm(h.bottom,c.bottom),c.left=gi(h.left,c.left),c},U4(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Vge(n){const{width:e,height:t}=bV(n);return{width:e,height:t}}function Gge(n,e,t){const r=Da(e),i=Ba(e),o=t==="fixed",s=dh(n,!0,o,e);let a={scrollLeft:0,scrollTop:0};const l=mu(0);if(r||!r&&!o)if((Qm(e)!=="body"||w_(i))&&(a=G1(e)),r){const m=dh(e,!0,o,e);l.x=m.x+e.clientLeft,l.y=m.y+e.clientTop}else i&&(l.x=IN(i));let c=0,u=0;if(i&&!r&&!o){const m=i.getBoundingClientRect();u=m.top+a.scrollTop,c=m.left+a.scrollLeft-IN(i,m)}const h=s.left+a.scrollLeft-l.x-c,f=s.top+a.scrollTop-l.y-u;return{x:h,y:f,width:s.width,height:s.height}}function k2(n){return $s(n).position==="static"}function F4(n,e){if(!Da(n)||$s(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return Ba(n)===t&&(t=t.ownerDocument.body),t}function RV(n,e){const t=Ro(n);if(V1(n))return t;if(!Da(n)){let i=pu(n);for(;i&&!Rm(i);){if(ki(i)&&!k2(i))return i;i=pu(i)}return t}let r=F4(n,e);for(;r&&vge(r)&&k2(r);)r=F4(r,e);return r&&Rm(r)&&k2(r)&&!iL(r)?t:r||_ge(n)||t}const Wge=async function(n){const e=this.getOffsetParent||RV,t=this.getDimensions,r=await t(n.floating);return{reference:Gge(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function $ge(n){return $s(n).direction==="rtl"}const Yge={convertOffsetParentRelativeRectToViewportRelativeRect:Dge,getDocumentElement:Ba,getClippingRect:Hge,getOffsetParent:RV,getElementRects:Wge,getClientRects:Uge,getDimensions:Vge,getScale:Kp,isElement:ki,isRTL:$ge};function Kge(n,e){let t=null,r;const i=Ba(n);function o(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function s(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),o();const{left:c,top:u,width:h,height:f}=n.getBoundingClientRect();if(a||e(),!h||!f)return;const m=hy(u),g=hy(i.clientWidth-(c+h)),_=hy(i.clientHeight-(u+f)),v=hy(c),x={rootMargin:-m+"px "+-g+"px "+-_+"px "+-v+"px",threshold:gi(0,Nm(1,l))||1};let y=!0;function w(C){const T=C[0].intersectionRatio;if(T!==l){if(!y)return s();T?s(!1,T):r=setTimeout(()=>{s(!1,1e-7)},1e3)}y=!1}try{t=new IntersectionObserver(w,{...x,root:i.ownerDocument})}catch{t=new IntersectionObserver(w,x)}t.observe(n)}return s(!0),o}function Xge(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=sL(n),u=i||o?[...c?Wv(c):[],...Wv(e)]:[];u.forEach(p=>{i&&p.addEventListener("scroll",t,{passive:!0}),o&&p.addEventListener("resize",t)});const h=c&&a?Kge(c,t):null;let f=-1,m=null;s&&(m=new ResizeObserver(p=>{let[x]=p;x&&x.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var y;(y=m)==null||y.observe(e)})),t()}),c&&!l&&m.observe(c),m.observe(e));let g,_=l?dh(n):null;l&&v();function v(){const p=dh(n);_&&(p.x!==_.x||p.y!==_.y||p.width!==_.width||p.height!==_.height)&&t(),_=p,g=requestAnimationFrame(v)}return t(),()=>{var p;u.forEach(x=>{i&&x.removeEventListener("scroll",t),o&&x.removeEventListener("resize",t)}),h==null||h(),(p=m)==null||p.disconnect(),m=null,l&&cancelAnimationFrame(g)}}const L2=W1,qge=Ige,Qge=Pge,Zge=Rge,Jge=kge,e0e=(n,e,t)=>{const r=new Map,i={platform:Yge,...t},o={...i.platform,_c:r};return Mge(n,e,{...i,platform:o})};var cw=typeof document<"u"?O.useLayoutEffect:O.useEffect;function SE(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!SE(n[r],e[r]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=t;r--!==0;){const o=i[r];if(!(o==="_owner"&&n.$$typeof)&&!SE(n[o],e[o]))return!1}return!0}return n!==n&&e!==e}function NV(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function j4(n,e){const t=NV(n);return Math.round(e*t)/t}function O2(n){const e=O.useRef(n);return cw(()=>{e.current=n}),e}function t0e(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:i,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:l,open:c}=n,[u,h]=O.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[f,m]=O.useState(r);SE(f,r)||m(r);const[g,_]=O.useState(null),[v,p]=O.useState(null),x=O.useCallback(U=>{U!==T.current&&(T.current=U,_(U))},[]),y=O.useCallback(U=>{U!==S.current&&(S.current=U,p(U))},[]),w=o||g,C=s||v,T=O.useRef(null),S=O.useRef(null),b=O.useRef(u),R=l!=null,E=O2(l),A=O2(i),F=O2(c),D=O.useCallback(()=>{if(!T.current||!S.current)return;const U={placement:e,strategy:t,middleware:f};A.current&&(U.platform=A.current),e0e(T.current,S.current,U).then(Y=>{const Z={...Y,isPositioned:F.current!==!1};M.current&&!SE(b.current,Z)&&(b.current=Z,bt.flushSync(()=>{h(Z)}))})},[f,e,t,A,F]);cw(()=>{c===!1&&b.current.isPositioned&&(b.current.isPositioned=!1,h(U=>({...U,isPositioned:!1})))},[c]);const M=O.useRef(!1);cw(()=>(M.current=!0,()=>{M.current=!1}),[]),cw(()=>{if(w&&(T.current=w),C&&(S.current=C),w&&C){if(E.current)return E.current(w,C,D);D()}},[w,C,D,E,R]);const k=O.useMemo(()=>({reference:T,floating:S,setReference:x,setFloating:y}),[x,y]),z=O.useMemo(()=>({reference:w,floating:C}),[w,C]),P=O.useMemo(()=>{const U={position:t,left:0,top:0};if(!z.floating)return U;const Y=j4(z.floating,u.x),Z=j4(z.floating,u.y);return a?{...U,transform:"translate("+Y+"px, "+Z+"px)",...NV(z.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:Y,top:Z}},[t,a,z.floating,u.x,u.y]);return O.useMemo(()=>({...u,update:D,refs:k,elements:z,floatingStyles:P}),[u,D,k,z,P])}const IV=(n,e)=>({...qge(n),options:[n,e]}),n0e=(n,e)=>({...Qge(n),options:[n,e]}),r0e=(n,e)=>({...Zge(n),options:[n,e]}),i0e=(n,e)=>({...Jge(n),options:[n,e]}),PV={...H2},o0e=PV.useInsertionEffect,s0e=o0e||(n=>n());function kV(n){const e=O.useRef(()=>{});return s0e(()=>{e.current=n}),O.useCallback(function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e.current==null?void 0:e.current(...r)},[])}var PN=typeof document<"u"?O.useLayoutEffect:O.useEffect;let B4=!1,a0e=0;const z4=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+a0e++;function l0e(){const[n,e]=O.useState(()=>B4?z4():void 0);return PN(()=>{n==null&&e(z4())},[]),O.useEffect(()=>{B4=!0},[]),n}const c0e=PV.useId,u0e=c0e||l0e;function d0e(){const n=new Map;return{emit(e,t){var r;(r=n.get(e))==null||r.forEach(i=>i(t))},on(e,t){n.set(e,[...n.get(e)||[],t])},off(e,t){var r;n.set(e,((r=n.get(e))==null?void 0:r.filter(i=>i!==t))||[])}}}const h0e=O.createContext(null),f0e=O.createContext(null),p0e=()=>{var n;return((n=O.useContext(h0e))==null?void 0:n.id)||null},m0e=()=>O.useContext(f0e),g0e="data-floating-ui-focusable";function v0e(n){const{open:e=!1,onOpenChange:t,elements:r}=n,i=u0e(),o=O.useRef({}),[s]=O.useState(()=>d0e()),a=p0e()!=null,[l,c]=O.useState(r.reference),u=kV((m,g,_)=>{o.current.openEvent=m?g:void 0,s.emit("openchange",{open:m,event:g,reason:_,nested:a}),t==null||t(m,g,_)}),h=O.useMemo(()=>({setPositionReference:c}),[]),f=O.useMemo(()=>({reference:l||r.reference||null,floating:r.floating||null,domReference:r.reference}),[l,r.reference,r.floating]);return O.useMemo(()=>({dataRef:o,open:e,onOpenChange:u,elements:f,events:s,floatingId:i,refs:h}),[e,u,f,s,i,h])}function _0e(n){n===void 0&&(n={});const{nodeId:e}=n,t=v0e({...n,elements:{reference:null,floating:null,...n.elements}}),r=n.rootContext||t,i=r.elements,[o,s]=O.useState(null),[a,l]=O.useState(null),u=(i==null?void 0:i.reference)||o,h=O.useRef(null),f=m0e();PN(()=>{u&&(h.current=u)},[u]);const m=t0e({...n,elements:{...i,...a&&{reference:a}}}),g=O.useCallback(y=>{const w=ki(y)?{getBoundingClientRect:()=>y.getBoundingClientRect(),contextElement:y}:y;l(w),m.refs.setReference(w)},[m.refs]),_=O.useCallback(y=>{(ki(y)||y===null)&&(h.current=y,s(y)),(ki(m.refs.reference.current)||m.refs.reference.current===null||y!==null&&!ki(y))&&m.refs.setReference(y)},[m.refs]),v=O.useMemo(()=>({...m.refs,setReference:_,setPositionReference:g,domReference:h}),[m.refs,_,g]),p=O.useMemo(()=>({...m.elements,domReference:u}),[m.elements,u]),x=O.useMemo(()=>({...m,...r,refs:v,elements:p,nodeId:e}),[m,v,p,e,r]);return PN(()=>{r.dataRef.current.floatingContext=x;const y=f==null?void 0:f.nodesRef.current.find(w=>w.id===e);y&&(y.context=x)}),O.useMemo(()=>({...m,context:x,refs:v,elements:p}),[m,v,p,x])}const H4="active",V4="selected";function D2(n,e,t){const r=new Map,i=t==="item";let o=n;if(i&&n){const{[H4]:s,[V4]:a,...l}=n;o=l}return{...t==="floating"&&{tabIndex:-1,[g0e]:""},...o,...e.map(s=>{const a=s?s[t]:null;return typeof a=="function"?n?a(n):null:a}).concat(n).reduce((s,a)=>(a&&Object.entries(a).forEach(l=>{let[c,u]=l;if(!(i&&[H4,V4].includes(c)))if(c.indexOf("on")===0){if(r.has(c)||r.set(c,[]),typeof u=="function"){var h;(h=r.get(c))==null||h.push(u),s[c]=function(){for(var f,m=arguments.length,g=new Array(m),_=0;_<m;_++)g[_]=arguments[_];return(f=r.get(c))==null?void 0:f.map(v=>v(...g)).find(v=>v!==void 0)}}}else s[c]=u}),s),{})}}function x0e(n){n===void 0&&(n=[]);const e=n.map(a=>a==null?void 0:a.reference),t=n.map(a=>a==null?void 0:a.floating),r=n.map(a=>a==null?void 0:a.item),i=O.useCallback(a=>D2(a,n,"reference"),e),o=O.useCallback(a=>D2(a,n,"floating"),t),s=O.useCallback(a=>D2(a,n,"item"),r);return O.useMemo(()=>({getReferenceProps:i,getFloatingProps:o,getItemProps:s}),[i,o,s])}function G4(n,e){return{...n,rects:{...n.rects,floating:{...n.rects.floating,height:e}}}}const y0e=n=>({name:"inner",options:n,async fn(e){const{listRef:t,overflowRef:r,onFallbackChange:i,offset:o=0,index:s=0,minItemsVisible:a=4,referenceOverflowThreshold:l=0,scrollRef:c,...u}=Zm(n,e),{rects:h,elements:{floating:f}}=e,m=t.current[s],g=(c==null?void 0:c.current)||f,_=f.clientTop||g.clientTop,v=f.clientTop!==0,p=g.clientTop!==0,x=f===g;if(!m)return{};const y={...e,...await IV(-m.offsetTop-f.clientTop-h.reference.height/2-m.offsetHeight/2-o).fn(e)},w=await L2(G4(y,g.scrollHeight+_+f.clientTop),u),C=await L2(y,{...u,elementContext:"reference"}),T=gi(0,w.top),S=y.y+T,b=$v(gi(0,g.scrollHeight+(v&&x||p?_*2:0)-T-gi(0,w.bottom)));if(g.style.maxHeight=b+"px",g.scrollTop=T,i){const R=g.scrollHeight>g.offsetHeight&&g.offsetHeight<m.offsetHeight*a-1||C.top>=-l||C.bottom>=-l;bt.flushSync(()=>i(R))}return r&&(r.current=await L2(G4({...y,y:S},g.offsetHeight+_+f.clientTop),u)),{y:S}}});function w0e(n,e){const{open:t,elements:r}=n,{enabled:i=!0,overflowRef:o,scrollRef:s,onChange:a}=e,l=kV(a),c=O.useRef(!1),u=O.useRef(null),h=O.useRef(null);O.useEffect(()=>{if(!i)return;function m(_){if(_.ctrlKey||!g||o.current==null)return;const v=_.deltaY,p=o.current.top>=-.5,x=o.current.bottom>=-.5,y=g.scrollHeight-g.clientHeight,w=v<0?-1:1,C=v<0?"max":"min";g.scrollHeight<=g.clientHeight||(!p&&v>0||!x&&v<0?(_.preventDefault(),bt.flushSync(()=>{l(T=>T+Math[C](v,y*w))})):/firefox/i.test(xge())&&(g.scrollTop+=v))}const g=(s==null?void 0:s.current)||r.floating;if(t&&g)return g.addEventListener("wheel",m),requestAnimationFrame(()=>{u.current=g.scrollTop,o.current!=null&&(h.current={...o.current})}),()=>{u.current=null,h.current=null,g.removeEventListener("wheel",m)}},[i,t,r.floating,o,s,l]);const f=O.useMemo(()=>({onKeyDown(){c.current=!0},onWheel(){c.current=!1},onPointerMove(){c.current=!1},onScroll(){const m=(s==null?void 0:s.current)||r.floating;if(!(!o.current||!m||!c.current)){if(u.current!==null){const g=m.scrollTop-u.current;(o.current.bottom<-.5&&g<-1||o.current.top<-.5&&g>1)&&bt.flushSync(()=>l(_=>_+g))}requestAnimationFrame(()=>{u.current=m.scrollTop})}}}),[r.floating,l,o,s]);return O.useMemo(()=>i?{floating:f}:{},[i,f])}let E_=O.createContext({styles:void 0,setReference:()=>{},setFloating:()=>{},getReferenceProps:()=>({}),getFloatingProps:()=>({}),slot:{}});E_.displayName="FloatingContext";let aL=O.createContext(null);aL.displayName="PlacementContext";function S0e(n){return O.useMemo(()=>n?typeof n=="string"?{to:n}:n:null,[n])}function E0e(){return O.useContext(E_).setReference}function T0e(){let{getFloatingProps:n,slot:e}=O.useContext(E_);return O.useCallback((...t)=>Object.assign({},n(...t),{"data-anchor":e.anchor}),[n,e])}function C0e(n=null){n===!1&&(n=null),typeof n=="string"&&(n={to:n});let e=O.useContext(aL),t=O.useMemo(()=>n,[JSON.stringify(n,typeof HTMLElement<"u"?(i,o)=>o instanceof HTMLElement?o.outerHTML:o:void 0)]);_n(()=>{e==null||e(t??null)},[e,t]);let r=O.useContext(E_);return O.useMemo(()=>[r.setFloating,n?r.styles:{}],[r.setFloating,n,r.styles])}let W4=4;function b0e({children:n,enabled:e=!0}){let[t,r]=O.useState(null),[i,o]=O.useState(0),s=O.useRef(null),[a,l]=O.useState(null);A0e(a);let c=e&&t!==null&&a!==null,{to:u="bottom",gap:h=0,offset:f=0,padding:m=0,inner:g}=M0e(t,a),[_,v="center"]=u.split(" ");_n(()=>{c&&o(0)},[c]);let{refs:p,floatingStyles:x,context:y}=_0e({open:c,placement:_==="selection"?v==="center"?"bottom":`bottom-${v}`:v==="center"?`${_}`:`${_}-${v}`,strategy:"absolute",transform:!1,middleware:[IV({mainAxis:_==="selection"?0:h,crossAxis:f}),n0e({padding:m}),_!=="selection"&&r0e({padding:m}),_==="selection"&&g?y0e({...g,padding:m,overflowRef:s,offset:i,minItemsVisible:W4,referenceOverflowThreshold:m,onFallbackChange(A){var F,D;if(!A)return;let M=y.elements.floating;if(!M)return;let k=parseFloat(getComputedStyle(M).scrollPaddingBottom)||0,z=Math.min(W4,M.childElementCount),P=0,U=0;for(let Y of(D=(F=y.elements.floating)==null?void 0:F.childNodes)!=null?D:[])if(Y instanceof HTMLElement){let Z=Y.offsetTop,j=Z+Y.clientHeight+k,X=M.scrollTop,B=X+M.clientHeight;if(Z>=X&&j<=B)z--;else{U=Math.max(0,Math.min(j,B)-Math.max(Z,X)),P=Y.clientHeight;break}}z>=1&&o(Y=>{let Z=P*z-U+k;return Y>=Z?Y:Z})}}):null,i0e({padding:m,apply({availableWidth:A,availableHeight:F,elements:D}){Object.assign(D.floating.style,{overflow:"auto",maxWidth:`${A}px`,maxHeight:`min(var(--anchor-max-height, 100vh), ${F}px)`})}})].filter(Boolean),whileElementsMounted:Xge}),[w=_,C=v]=y.placement.split("-");_==="selection"&&(w="selection");let T=O.useMemo(()=>({anchor:[w,C].filter(Boolean).join(" ")}),[w,C]),S=w0e(y,{overflowRef:s,onChange:o}),{getReferenceProps:b,getFloatingProps:R}=x0e([S]),E=mt(A=>{l(A),p.setFloating(A)});return O.createElement(aL.Provider,{value:r},O.createElement(E_.Provider,{value:{setFloating:E,setReference:p.setReference,styles:x,getReferenceProps:b,getFloatingProps:R,slot:T}},n))}function A0e(n){_n(()=>{if(!n)return;let e=new MutationObserver(()=>{let t=window.getComputedStyle(n).maxHeight,r=parseFloat(t);if(isNaN(r))return;let i=parseInt(t);isNaN(i)||r!==i&&(n.style.maxHeight=`${Math.ceil(r)}px`)});return e.observe(n,{attributes:!0,attributeFilter:["style"]}),()=>{e.disconnect()}},[n])}function M0e(n,e){var t,r,i;let o=U2((t=n==null?void 0:n.gap)!=null?t:"var(--anchor-gap, 0)",e),s=U2((r=n==null?void 0:n.offset)!=null?r:"var(--anchor-offset, 0)",e),a=U2((i=n==null?void 0:n.padding)!=null?i:"var(--anchor-padding, 0)",e);return{...n,gap:o,offset:s,padding:a}}function U2(n,e,t=void 0){let r=qm(),i=mt((l,c)=>{if(l==null)return[t,null];if(typeof l=="number")return[l,null];if(typeof l=="string"){if(!c)return[t,null];let u=$4(l,c);return[u,h=>{let f=LV(l);{let m=f.map(g=>window.getComputedStyle(c).getPropertyValue(g));r.requestAnimationFrame(function g(){r.nextFrame(g);let _=!1;for(let[p,x]of f.entries()){let y=window.getComputedStyle(c).getPropertyValue(x);if(m[p]!==y){m[p]=y,_=!0;break}}if(!_)return;let v=$4(l,c);u!==v&&(h(v),u=v)})}return r.dispose}]}return[t,null]}),o=O.useMemo(()=>i(n,e)[0],[n,e]),[s=o,a]=O.useState();return _n(()=>{let[l,c]=i(n,e);if(a(l),!!c)return c(a)},[n,e]),s}function LV(n){let e=/var\((.*)\)/.exec(n);if(e){let t=e[1].indexOf(",");if(t===-1)return[e[1]];let r=e[1].slice(0,t).trim(),i=e[1].slice(t+1).trim();return i?[r,...LV(i)]:[r]}return[]}function $4(n,e){let t=document.createElement("div");e.appendChild(t),t.style.setProperty("margin-top","0px","important"),t.style.setProperty("margin-top",n,"important");let r=parseFloat(window.getComputedStyle(t).marginTop)||0;return e.removeChild(t),r}function R0e({children:n,freeze:e}){let t=kN(e,n);return Rt.createElement(Rt.Fragment,null,t)}function kN(n,e){let[t,r]=O.useState(e);return!n&&t!==e&&r(e),n?t:e}let lL=O.createContext(null);lL.displayName="OpenClosedContext";var Ls=(n=>(n[n.Open=1]="Open",n[n.Closed=2]="Closed",n[n.Closing=4]="Closing",n[n.Opening=8]="Opening",n))(Ls||{});function cL(){return O.useContext(lL)}function OV({value:n,children:e}){return Rt.createElement(lL.Provider,{value:n},e)}function N0e(n){function e(){document.readyState!=="loading"&&(n(),document.removeEventListener("DOMContentLoaded",e))}typeof window<"u"&&typeof document<"u"&&(document.addEventListener("DOMContentLoaded",e),e())}let hd=[];N0e(()=>{function n(e){if(!(e.target instanceof HTMLElement)||e.target===document.body||hd[0]===e.target)return;let t=e.target;t=t.closest(MN),hd.unshift(t??e.target),hd=hd.filter(r=>r!=null&&r.isConnected),hd.splice(10)}window.addEventListener("click",n,{capture:!0}),window.addEventListener("mousedown",n,{capture:!0}),window.addEventListener("focus",n,{capture:!0}),document.body.addEventListener("click",n,{capture:!0}),document.body.addEventListener("mousedown",n,{capture:!0}),document.body.addEventListener("focus",n,{capture:!0})});function I0e(n){throw new Error("Unexpected object: "+n)}var yr=(n=>(n[n.First=0]="First",n[n.Previous=1]="Previous",n[n.Next=2]="Next",n[n.Last=3]="Last",n[n.Specific=4]="Specific",n[n.Nothing=5]="Nothing",n))(yr||{});function Y4(n,e){let t=e.resolveItems();if(t.length<=0)return null;let r=e.resolveActiveIndex(),i=r??-1;switch(n.focus){case 0:{for(let o=0;o<t.length;++o)if(!e.resolveDisabled(t[o],o,t))return o;return r}case 1:{i===-1&&(i=t.length);for(let o=i-1;o>=0;--o)if(!e.resolveDisabled(t[o],o,t))return o;return r}case 2:{for(let o=i+1;o<t.length;++o)if(!e.resolveDisabled(t[o],o,t))return o;return r}case 3:{for(let o=t.length-1;o>=0;--o)if(!e.resolveDisabled(t[o],o,t))return o;return r}case 4:{for(let o=0;o<t.length;++o)if(e.resolveId(t[o],o,t)===n.id)return o;return r}case 5:return null;default:I0e(n)}}var uL=(n=>(n[n.Left=0]="Left",n[n.Right=2]="Right",n))(uL||{});function P0e(n){let e=mt(n),t=O.useRef(!1);O.useEffect(()=>(t.current=!1,()=>{t.current=!0,nV(()=>{t.current&&e()})}),[e])}function k0e(){let n=typeof document>"u";return"useSyncExternalStore"in H2?(e=>e.useSyncExternalStore)(H2)(()=>()=>{},()=>!1,()=>!n):!1}function dL(){let n=k0e(),[e,t]=O.useState(Wd.isHandoffComplete);return e&&Wd.isHandoffComplete===!1&&t(!1),O.useEffect(()=>{e!==!0&&t(!0)},[e]),O.useEffect(()=>Wd.handoff(),[]),n?!1:e}let L0e=O.createContext(!1);function O0e(){return O.useContext(L0e)}function D0e(n){let e=O0e(),t=O.useContext(UV),r=z1(n),[i,o]=O.useState(()=>{var s;if(!e&&t!==null)return(s=t.current)!=null?s:null;if(Wd.isServer)return null;let a=r==null?void 0:r.getElementById("headlessui-portal-root");if(a)return a;if(r===null)return null;let l=r.createElement("div");return l.setAttribute("id","headlessui-portal-root"),r.body.appendChild(l)});return O.useEffect(()=>{i!==null&&(r!=null&&r.body.contains(i)||r==null||r.body.appendChild(i))},[i,r]),O.useEffect(()=>{e||t!==null&&o(t.current)},[t,o,e]),i}let DV=O.Fragment,U0e=eo(function(n,e){let t=n,r=O.useRef(null),i=Xs(mme(u=>{r.current=u}),e),o=z1(r),s=D0e(r),[a]=O.useState(()=>{var u;return Wd.isServer?null:(u=o==null?void 0:o.createElement("div"))!=null?u:null}),l=O.useContext(z0e),c=dL();return _n(()=>{!s||!a||s.contains(a)||(a.setAttribute("data-headlessui-portal",""),s.appendChild(a))},[s,a]),_n(()=>{if(a&&l)return l.register(a)},[l,a]),P0e(()=>{var u;!s||!a||(a instanceof Node&&s.contains(a)&&s.removeChild(a),s.childNodes.length<=0&&((u=s.parentElement)==null||u.removeChild(s)))}),c?!s||!a?null:bt.createPortal(Uo({ourProps:{ref:i},theirProps:t,slot:{},defaultTag:DV,name:"Portal"}),a):null});function F0e(n,e){let t=Xs(e),{enabled:r=!0,...i}=n;return r?Rt.createElement(U0e,{...i,ref:t}):Uo({ourProps:{ref:t},theirProps:i,slot:{},defaultTag:DV,name:"Portal"})}let j0e=O.Fragment,UV=O.createContext(null);function B0e(n,e){let{target:t,...r}=n,i={ref:Xs(e)};return Rt.createElement(UV.Provider,{value:t},Uo({ourProps:i,theirProps:r,defaultTag:j0e,name:"Popover.Group"}))}let z0e=O.createContext(null),H0e=eo(F0e),V0e=eo(B0e),G0e=Object.assign(H0e,{Group:V0e});var W0e={},$0e=(n=>(n[n.Open=0]="Open",n[n.Closed=1]="Closed",n))($0e||{}),Y0e=(n=>(n[n.Single=0]="Single",n[n.Multi=1]="Multi",n))(Y0e||{}),K0e=(n=>(n[n.Pointer=0]="Pointer",n[n.Focus=1]="Focus",n[n.Other=2]="Other",n))(K0e||{}),X0e=(n=>(n[n.OpenCombobox=0]="OpenCombobox",n[n.CloseCombobox=1]="CloseCombobox",n[n.GoToOption=2]="GoToOption",n[n.SetTyping=3]="SetTyping",n[n.RegisterOption=4]="RegisterOption",n[n.UnregisterOption=5]="UnregisterOption",n[n.SetActivationTrigger=6]="SetActivationTrigger",n[n.UpdateVirtualConfiguration=7]="UpdateVirtualConfiguration",n[n.SetInputElement=8]="SetInputElement",n[n.SetButtonElement=9]="SetButtonElement",n[n.SetOptionsElement=10]="SetOptionsElement",n))(X0e||{});function F2(n,e=t=>t){let t=n.activeOptionIndex!==null?n.options[n.activeOptionIndex]:null,r=e(n.options.slice()),i=r.length>0&&r[0].dataRef.current.order!==null?r.sort((s,a)=>s.dataRef.current.order-a.dataRef.current.order):Qme(r,s=>s.dataRef.current.domRef.current),o=t?i.indexOf(t):null;return o===-1&&(o=null),{options:i,activeOptionIndex:o}}let q0e={1(n){var e;return(e=n.dataRef.current)!=null&&e.disabled||n.comboboxState===1?n:{...n,activeOptionIndex:null,comboboxState:1,isTyping:!1,activationTrigger:2,__demoMode:!1}},0(n){var e,t;if((e=n.dataRef.current)!=null&&e.disabled||n.comboboxState===0)return n;if((t=n.dataRef.current)!=null&&t.value){let r=n.dataRef.current.calculateIndex(n.dataRef.current.value);if(r!==-1)return{...n,activeOptionIndex:r,comboboxState:0,__demoMode:!1}}return{...n,comboboxState:0,__demoMode:!1}},3(n,e){return n.isTyping===e.isTyping?n:{...n,isTyping:e.isTyping}},2(n,e){var t,r,i,o;if((t=n.dataRef.current)!=null&&t.disabled||n.optionsElement&&!((r=n.dataRef.current)!=null&&r.optionsPropsRef.current.static)&&n.comboboxState===1)return n;if(n.virtual){let{options:c,disabled:u}=n.virtual,h=e.focus===yr.Specific?e.idx:Y4(e,{resolveItems:()=>c,resolveActiveIndex:()=>{var m,g;return(g=(m=n.activeOptionIndex)!=null?m:c.findIndex(_=>!u(_)))!=null?g:null},resolveDisabled:u,resolveId(){throw new Error("Function not implemented.")}}),f=(i=e.trigger)!=null?i:2;return n.activeOptionIndex===h&&n.activationTrigger===f?n:{...n,activeOptionIndex:h,activationTrigger:f,isTyping:!1,__demoMode:!1}}let s=F2(n);if(s.activeOptionIndex===null){let c=s.options.findIndex(u=>!u.dataRef.current.disabled);c!==-1&&(s.activeOptionIndex=c)}let a=e.focus===yr.Specific?e.idx:Y4(e,{resolveItems:()=>s.options,resolveActiveIndex:()=>s.activeOptionIndex,resolveId:c=>c.id,resolveDisabled:c=>c.dataRef.current.disabled}),l=(o=e.trigger)!=null?o:2;return n.activeOptionIndex===a&&n.activationTrigger===l?n:{...n,...s,isTyping:!1,activeOptionIndex:a,activationTrigger:l,__demoMode:!1}},4:(n,e)=>{var t,r,i;if((t=n.dataRef.current)!=null&&t.virtual)return{...n,options:[...n.options,e.payload]};let o=e.payload,s=F2(n,l=>(l.push(o),l));n.activeOptionIndex===null&&(r=n.dataRef.current)!=null&&r.isSelected(e.payload.dataRef.current.value)&&(s.activeOptionIndex=s.options.indexOf(o));let a={...n,...s,activationTrigger:2};return(i=n.dataRef.current)!=null&&i.__demoMode&&n.dataRef.current.value===void 0&&(a.activeOptionIndex=0),a},5:(n,e)=>{var t;if((t=n.dataRef.current)!=null&&t.virtual)return{...n,options:n.options.filter(i=>i.id!==e.id)};let r=F2(n,i=>{let o=i.findIndex(s=>s.id===e.id);return o!==-1&&i.splice(o,1),i});return{...n,...r,activationTrigger:2}},6:(n,e)=>n.activationTrigger===e.trigger?n:{...n,activationTrigger:e.trigger},7:(n,e)=>{var t,r;if(n.virtual===null)return{...n,virtual:{options:e.options,disabled:(t=e.disabled)!=null?t:()=>!1}};if(n.virtual.options===e.options&&n.virtual.disabled===e.disabled)return n;let i=n.activeOptionIndex;if(n.activeOptionIndex!==null){let o=e.options.indexOf(n.virtual.options[n.activeOptionIndex]);o!==-1?i=o:i=null}return{...n,activeOptionIndex:i,virtual:{options:e.options,disabled:(r=e.disabled)!=null?r:()=>!1}}},8:(n,e)=>n.inputElement===e.element?n:{...n,inputElement:e.element},9:(n,e)=>n.buttonElement===e.element?n:{...n,buttonElement:e.element},10:(n,e)=>n.optionsElement===e.element?n:{...n,optionsElement:e.element}},hL=O.createContext(null);hL.displayName="ComboboxActionsContext";function T_(n){let e=O.useContext(hL);if(e===null){let t=new Error(`<${n} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,T_),t}return e}let FV=O.createContext(null);function Q0e(n){let e=Jm("VirtualProvider"),{options:t}=e.virtual,[r,i]=O.useMemo(()=>{let c=e.optionsElement;if(!c)return[0,0];let u=window.getComputedStyle(c);return[parseFloat(u.paddingBlockStart||u.paddingTop),parseFloat(u.paddingBlockEnd||u.paddingBottom)]},[e.optionsElement]),o=Fme({enabled:t.length!==0,scrollPaddingStart:r,scrollPaddingEnd:i,count:t.length,estimateSize(){return 40},getScrollElement(){return e.optionsElement},overscan:12}),[s,a]=O.useState(0);_n(()=>{a(c=>c+1)},[t]);let l=o.getVirtualItems();return l.length===0?null:Rt.createElement(FV.Provider,{value:o},Rt.createElement("div",{style:{position:"relative",width:"100%",height:`${o.getTotalSize()}px`},ref:c=>{if(c){if(typeof process<"u"&&W0e.JEST_WORKER_ID!==void 0||e.activationTrigger===0)return;e.activeOptionIndex!==null&&t.length>e.activeOptionIndex&&o.scrollToIndex(e.activeOptionIndex)}}},l.map(c=>{var u;return Rt.createElement(O.Fragment,{key:c.key},Rt.cloneElement((u=n.children)==null?void 0:u.call(n,{...n.slot,option:t[c.index]}),{key:`${s}-${c.key}`,"data-index":c.index,"aria-setsize":t.length,"aria-posinset":c.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${c.start}px)`,overflowAnchor:"none"}}))})))}let Yv=O.createContext(null);Yv.displayName="ComboboxDataContext";function Jm(n){let e=O.useContext(Yv);if(e===null){let t=new Error(`<${n} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,Jm),t}return e}function Z0e(n,e){return js(e.type,q0e,n,e)}let J0e=O.Fragment;function eve(n,e){var t,r;let i=Jk(),{value:o,defaultValue:s,onChange:a,form:l,name:c,by:u,disabled:h=i||!1,onClose:f,__demoMode:m=!1,multiple:g=!1,immediate:_=!1,virtual:v=null,nullable:p,...x}=n,y=ome(s),[w=g?[]:void 0,C]=ime(o,a,y),[T,S]=O.useReducer(Z0e,{dataRef:O.createRef(),comboboxState:m?0:1,isTyping:!1,options:[],virtual:v?{options:v.options,disabled:(t=v.disabled)!=null?t:()=>!1}:null,activeOptionIndex:null,activationTrigger:2,inputElement:null,buttonElement:null,optionsElement:null,__demoMode:m}),b=O.useRef(!1),R=O.useRef({static:!1,hold:!1}),E=Bme(u),A=mt($=>v?u===null?v.options.indexOf($):v.options.findIndex(ot=>E(ot,$)):T.options.findIndex(ot=>E(ot.dataRef.current.value,$))),F=O.useCallback($=>js(M.mode,{1:()=>w.some(ot=>E(ot,$)),0:()=>E(w,$)}),[w]),D=mt($=>T.activeOptionIndex===A($)),M=O.useMemo(()=>({...T,immediate:_,optionsPropsRef:R,value:w,defaultValue:y,disabled:h,mode:g?1:0,virtual:v?T.virtual:null,get activeOptionIndex(){if(b.current&&T.activeOptionIndex===null&&(v?v.options.length>0:T.options.length>0)){if(v){let ot=v.options.findIndex(se=>{var Ee,Te;return!((Te=(Ee=v.disabled)==null?void 0:Ee.call(v,se))!=null&&Te)});if(ot!==-1)return ot}let $=T.options.findIndex(ot=>!ot.dataRef.current.disabled);if($!==-1)return $}return T.activeOptionIndex},calculateIndex:A,compare:E,isSelected:F,isActive:D}),[w,y,h,g,m,T,v]);_n(()=>{var $;v&&S({type:7,options:v.options,disabled:($=v.disabled)!=null?$:null})},[v,v==null?void 0:v.options,v==null?void 0:v.disabled]),_n(()=>{T.dataRef.current=M},[M]);let k=M.comboboxState===0;ege(k,[M.buttonElement,M.inputElement,M.optionsElement],()=>we.closeCombobox());let z=O.useMemo(()=>{var $,ot,se;return{open:M.comboboxState===0,disabled:h,activeIndex:M.activeOptionIndex,activeOption:M.activeOptionIndex===null?null:M.virtual?M.virtual.options[($=M.activeOptionIndex)!=null?$:0]:(se=(ot=M.options[M.activeOptionIndex])==null?void 0:ot.dataRef.current.value)!=null?se:null,value:w}},[M,h,w]),P=mt(()=>{if(M.activeOptionIndex!==null){if(we.setIsTyping(!1),M.virtual)B(M.virtual.options[M.activeOptionIndex]);else{let{dataRef:$}=M.options[M.activeOptionIndex];B($.current.value)}we.goToOption(yr.Specific,M.activeOptionIndex)}}),U=mt(()=>{S({type:0}),b.current=!0}),Y=mt(()=>{S({type:1}),b.current=!1,f==null||f()}),Z=mt($=>{S({type:3,isTyping:$})}),j=mt(($,ot,se)=>(b.current=!1,$===yr.Specific?S({type:2,focus:yr.Specific,idx:ot,trigger:se}):S({type:2,focus:$,trigger:se}))),X=mt(($,ot)=>(S({type:4,payload:{id:$,dataRef:ot}}),()=>{M.isActive(ot.current.value)&&(b.current=!0),S({type:5,id:$})})),B=mt($=>js(M.mode,{0(){return C==null?void 0:C($)},1(){let ot=M.value.slice(),se=ot.findIndex(Ee=>E(Ee,$));return se===-1?ot.push($):ot.splice(se,1),C==null?void 0:C(ot)}})),K=mt($=>{S({type:6,trigger:$})}),ee=mt($=>{S({type:8,element:$})}),fe=mt($=>{S({type:9,element:$})}),ce=mt($=>{S({type:10,element:$})}),we=O.useMemo(()=>({onChange:B,registerOption:X,goToOption:j,setIsTyping:Z,closeCombobox:Y,openCombobox:U,setActivationTrigger:K,selectActiveOption:P,setInputElement:ee,setButtonElement:fe,setOptionsElement:ce}),[]),[Ie,ft]=yme(),_t=e===null?{}:{ref:e},pt=O.useCallback(()=>{if(y!==void 0)return C==null?void 0:C(y)},[C,y]);return Rt.createElement(ft,{value:Ie,props:{htmlFor:(r=M.inputElement)==null?void 0:r.id},slot:{open:M.comboboxState===0,disabled:h}},Rt.createElement(b0e,null,Rt.createElement(hL.Provider,{value:we},Rt.createElement(Yv.Provider,{value:M},Rt.createElement(OV,{value:js(M.comboboxState,{0:Ls.Open,1:Ls.Closed})},c!=null&&Rt.createElement(ume,{disabled:h,data:w!=null?{[c]:w}:{},form:l,onReset:pt}),Uo({ourProps:_t,theirProps:x,slot:z,defaultTag:J0e,name:"Combobox"}))))))}let tve="input";function nve(n,e){var t,r,i,o,s;let a=Jm("Combobox.Input"),l=T_("Combobox.Input"),c=O.useId(),u=lV(),{id:h=u||`headlessui-combobox-input-${c}`,onChange:f,displayValue:m,disabled:g=a.disabled||!1,autoFocus:_=!1,type:v="text",...p}=n,x=O.useRef(null),y=Xs(x,e,E0e(),l.setInputElement),w=z1(a.inputElement),C=qm(),T=mt(()=>{l.onChange(null),a.optionsElement&&(a.optionsElement.scrollTop=0),l.goToOption(yr.Nothing)}),S=O.useMemo(()=>{var B;return typeof m=="function"&&a.value!==void 0?(B=m(a.value))!=null?B:"":typeof a.value=="string"?a.value:""},[a.value,m]);k4(([B,K],[ee,fe])=>{if(a.isTyping)return;let ce=x.current;ce&&((fe===0&&K===1||B!==ee)&&(ce.value=B),requestAnimationFrame(()=>{if(a.isTyping||!ce||(w==null?void 0:w.activeElement)!==ce)return;let{selectionStart:we,selectionEnd:Ie}=ce;Math.abs((Ie??0)-(we??0))===0&&we===0&&ce.setSelectionRange(ce.value.length,ce.value.length)}))},[S,a.comboboxState,w,a.isTyping]),k4(([B],[K])=>{if(B===0&&K===1){if(a.isTyping)return;let ee=x.current;if(!ee)return;let fe=ee.value,{selectionStart:ce,selectionEnd:we,selectionDirection:Ie}=ee;ee.value="",ee.value=fe,Ie!==null?ee.setSelectionRange(ce,we,Ie):ee.setSelectionRange(ce,we)}},[a.comboboxState]);let b=O.useRef(!1),R=mt(()=>{b.current=!0}),E=mt(()=>{C.nextFrame(()=>{b.current=!1})}),A=mt(B=>{switch(l.setIsTyping(!0),B.key){case bi.Enter:if(a.comboboxState!==0||b.current)return;if(B.preventDefault(),B.stopPropagation(),a.activeOptionIndex===null){l.closeCombobox();return}l.selectActiveOption(),a.mode===0&&l.closeCombobox();break;case bi.ArrowDown:return B.preventDefault(),B.stopPropagation(),js(a.comboboxState,{0:()=>l.goToOption(yr.Next),1:()=>l.openCombobox()});case bi.ArrowUp:return B.preventDefault(),B.stopPropagation(),js(a.comboboxState,{0:()=>l.goToOption(yr.Previous),1:()=>{bt.flushSync(()=>l.openCombobox()),a.value||l.goToOption(yr.Last)}});case bi.Home:if(B.shiftKey)break;return B.preventDefault(),B.stopPropagation(),l.goToOption(yr.First);case bi.PageUp:return B.preventDefault(),B.stopPropagation(),l.goToOption(yr.First);case bi.End:if(B.shiftKey)break;return B.preventDefault(),B.stopPropagation(),l.goToOption(yr.Last);case bi.PageDown:return B.preventDefault(),B.stopPropagation(),l.goToOption(yr.Last);case bi.Escape:return a.comboboxState!==0?void 0:(B.preventDefault(),a.optionsElement&&!a.optionsPropsRef.current.static&&B.stopPropagation(),a.mode===0&&a.value===null&&T(),l.closeCombobox());case bi.Tab:if(a.comboboxState!==0)return;a.mode===0&&a.activationTrigger!==1&&l.selectActiveOption(),l.closeCombobox();break}}),F=mt(B=>{f==null||f(B),a.mode===0&&B.target.value===""&&T(),l.openCombobox()}),D=mt(B=>{var K,ee,fe;let ce=(K=B.relatedTarget)!=null?K:hd.find(we=>we!==B.currentTarget);if(!((ee=a.optionsElement)!=null&&ee.contains(ce))&&!((fe=a.buttonElement)!=null&&fe.contains(ce))&&a.comboboxState===0)return B.preventDefault(),a.mode===0&&a.value===null&&T(),l.closeCombobox()}),M=mt(B=>{var K,ee,fe;let ce=(K=B.relatedTarget)!=null?K:hd.find(we=>we!==B.currentTarget);(ee=a.buttonElement)!=null&&ee.contains(ce)||(fe=a.optionsElement)!=null&&fe.contains(ce)||a.disabled||a.immediate&&a.comboboxState!==0&&C.microTask(()=>{bt.flushSync(()=>l.openCombobox()),l.setActivationTrigger(1)})}),k=B1(),z=gme(),{isFocused:P,focusProps:U}=tV({autoFocus:_}),{isHovered:Y,hoverProps:Z}=eV({isDisabled:g}),j=O.useMemo(()=>({open:a.comboboxState===0,disabled:g,hover:Y,focus:P,autofocus:_}),[a,Y,P,_,g]),X=eL({ref:y,id:h,role:"combobox",type:v,"aria-controls":(t=a.optionsElement)==null?void 0:t.id,"aria-expanded":a.comboboxState===0,"aria-activedescendant":a.activeOptionIndex===null?void 0:a.virtual?(r=a.options.find(B=>!B.dataRef.current.disabled&&a.compare(B.dataRef.current.value,a.virtual.options[a.activeOptionIndex])))==null?void 0:r.id:(i=a.options[a.activeOptionIndex])==null?void 0:i.id,"aria-labelledby":k,"aria-describedby":z,"aria-autocomplete":"list",defaultValue:(s=(o=n.defaultValue)!=null?o:a.defaultValue!==void 0?m==null?void 0:m(a.defaultValue):null)!=null?s:a.defaultValue,disabled:g||void 0,autoFocus:_,onCompositionStart:R,onCompositionEnd:E,onKeyDown:A,onChange:F,onFocus:M,onBlur:D},U,Z);return Uo({ourProps:X,theirProps:p,slot:j,defaultTag:tve,name:"Combobox.Input"})}let rve="button";function ive(n,e){var t;let r=Jm("Combobox.Button"),i=T_("Combobox.Button"),o=Xs(e,i.setButtonElement),s=nme(),a=O.useId(),{id:l=`headlessui-combobox-button-${a}`,disabled:c=r.disabled||!1,autoFocus:u=!1,...h}=n,f=_V(r.inputElement),m=mt(b=>{switch(b.key){case bi.Space:case bi.Enter:b.preventDefault(),b.stopPropagation(),r.comboboxState===1&&bt.flushSync(()=>i.openCombobox()),f();return;case bi.ArrowDown:b.preventDefault(),b.stopPropagation(),r.comboboxState===1&&(bt.flushSync(()=>i.openCombobox()),r.value||i.goToOption(yr.First)),f();return;case bi.ArrowUp:b.preventDefault(),b.stopPropagation(),r.comboboxState===1&&(bt.flushSync(()=>i.openCombobox()),r.value||i.goToOption(yr.Last)),f();return;case bi.Escape:if(r.comboboxState!==0)return;b.preventDefault(),r.optionsElement&&!r.optionsPropsRef.current.static&&b.stopPropagation(),bt.flushSync(()=>i.closeCombobox()),f();return;default:return}}),g=mt(b=>{b.preventDefault(),!fme(b.currentTarget)&&(b.button===uL.Left&&(r.comboboxState===0?i.closeCombobox():i.openCombobox()),f())}),_=B1([l]),{isFocusVisible:v,focusProps:p}=tV({autoFocus:u}),{isHovered:x,hoverProps:y}=eV({isDisabled:c}),{pressed:w,pressProps:C}=eme({disabled:c}),T=O.useMemo(()=>({open:r.comboboxState===0,active:w||r.comboboxState===0,disabled:c,value:r.value,hover:x,focus:v}),[r,x,v,w,c]),S=eL({ref:o,id:l,type:nge(n,r.buttonElement),tabIndex:-1,"aria-haspopup":"listbox","aria-controls":(t=r.optionsElement)==null?void 0:t.id,"aria-expanded":r.comboboxState===0,"aria-labelledby":_,disabled:c||void 0,autoFocus:u,onMouseDown:g,onKeyDown:m},p,y,C);return Uo({mergeRefs:s,ourProps:S,theirProps:h,slot:T,defaultTag:rve,name:"Combobox.Button"})}let ove="div",sve=xE.RenderStrategy|xE.Static;function ave(n,e){var t,r,i;let o=O.useId(),{id:s=`headlessui-combobox-options-${o}`,hold:a=!1,anchor:l,portal:c=!1,modal:u=!0,transition:h=!1,...f}=n,m=Jm("Combobox.Options"),g=T_("Combobox.Options"),_=S0e(l);_&&(c=!0);let[v,p]=C0e(_),[x,y]=O.useState(null),w=T0e(),C=Xs(e,_?v:null,g.setOptionsElement,y),T=z1(m.optionsElement),S=cL(),[b,R]=yV(h,x,S!==null?(S&Ls.Open)===Ls.Open:m.comboboxState===0);Wme(b,m.inputElement,g.closeCombobox);let E=m.__demoMode?!1:u&&m.comboboxState===0;lge(E,T);let A=m.__demoMode?!1:u&&m.comboboxState===0;Gme(A,{allowed:O.useCallback(()=>[m.inputElement,m.buttonElement,m.optionsElement],[m.inputElement,m.buttonElement,m.optionsElement])}),_n(()=>{var j;m.optionsPropsRef.current.static=(j=n.static)!=null?j:!1},[m.optionsPropsRef,n.static]),_n(()=>{m.optionsPropsRef.current.hold=a},[m.optionsPropsRef,a]),gge(m.comboboxState===0,{container:m.optionsElement,accept(j){return j.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:j.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(j){j.setAttribute("role","none")}});let F=B1([(t=m.buttonElement)==null?void 0:t.id]),D=O.useMemo(()=>({open:m.comboboxState===0,option:void 0}),[m.comboboxState]),M=mt(()=>{g.setActivationTrigger(0)}),k=mt(j=>{j.preventDefault(),g.setActivationTrigger(0)}),z=eL(_?w():{},{"aria-labelledby":F,role:"listbox","aria-multiselectable":m.mode===1?!0:void 0,id:s,ref:C,style:{...f.style,...p,"--input-width":A4(m.inputElement,!0).width,"--button-width":A4(m.buttonElement,!0).width},onWheel:m.activationTrigger===0?void 0:M,onMouseDown:k,...xV(R)}),P=b&&m.comboboxState===1,U=kN(P,(r=m.virtual)==null?void 0:r.options),Y=kN(P,m.value),Z=mt(j=>m.compare(Y,j));if(m.virtual){if(U===void 0)throw new Error("Missing `options` in virtual mode");Object.assign(f,{children:Rt.createElement(Yv.Provider,{value:U!==m.virtual.options?{...m,virtual:{...m.virtual,options:U}}:m},Rt.createElement(Q0e,{slot:D},f.children))})}return Rt.createElement(G0e,{enabled:c?n.static||b:!1},Rt.createElement(Yv.Provider,{value:m.mode===1?m:{...m,isSelected:Z}},Uo({ourProps:z,theirProps:{...f,children:Rt.createElement(R0e,{freeze:P},typeof f.children=="function"?(i=f.children)==null?void 0:i.call(f,D):f.children)},slot:D,defaultTag:ove,features:sve,visible:b,name:"Combobox.Options"})))}let lve="div";function cve(n,e){var t,r,i,o;let s=Jm("Combobox.Option"),a=T_("Combobox.Option"),l=O.useId(),{id:c=`headlessui-combobox-option-${l}`,value:u,disabled:h=(i=(r=(t=s.virtual)==null?void 0:t.disabled)==null?void 0:r.call(t,u))!=null?i:!1,order:f=null,...m}=n,g=_V(s.inputElement),_=s.virtual?s.activeOptionIndex===s.calculateIndex(u):s.activeOptionIndex===null?!1:((o=s.options[s.activeOptionIndex])==null?void 0:o.id)===c,v=s.isSelected(u),p=O.useRef(null),x=Tu({disabled:h,value:u,domRef:p,order:f}),y=O.useContext(FV),w=Xs(e,p,y?y.measureElement:null),C=mt(()=>{a.setIsTyping(!1),a.onChange(u)});_n(()=>a.registerOption(c,x),[x,c]);let T=O.useRef(!(s.virtual||s.__demoMode));_n(()=>{if(!s.virtual&&!s.__demoMode)return Oa().requestAnimationFrame(()=>{T.current=!0})},[s.virtual,s.__demoMode]),_n(()=>{if(T.current&&s.comboboxState===0&&_&&s.activationTrigger!==0)return Oa().requestAnimationFrame(()=>{var M,k;(k=(M=p.current)==null?void 0:M.scrollIntoView)==null||k.call(M,{block:"nearest"})})},[p,_,s.comboboxState,s.activationTrigger,s.activeOptionIndex]);let S=mt(M=>{M.preventDefault(),M.button===uL.Left&&(h||(C(),vV()||requestAnimationFrame(()=>g()),s.mode===0&&a.closeCombobox()))}),b=mt(()=>{if(h)return a.goToOption(yr.Nothing);let M=s.calculateIndex(u);a.goToOption(yr.Specific,M)}),R=cge(),E=mt(M=>R.update(M)),A=mt(M=>{if(!R.wasMoved(M)||h||_)return;let k=s.calculateIndex(u);a.goToOption(yr.Specific,k,0)}),F=mt(M=>{R.wasMoved(M)&&(h||_&&(s.optionsPropsRef.current.hold||a.goToOption(yr.Nothing)))}),D=O.useMemo(()=>({active:_,focus:_,selected:v,disabled:h}),[_,v,h]);return Uo({ourProps:{id:c,ref:w,role:"option",tabIndex:h===!0?void 0:-1,"aria-disabled":h===!0?!0:void 0,"aria-selected":v,disabled:void 0,onMouseDown:S,onFocus:b,onPointerEnter:E,onMouseEnter:E,onPointerMove:A,onMouseMove:A,onPointerLeave:F,onMouseLeave:F},theirProps:m,slot:D,defaultTag:lve,name:"Combobox.Option"})}let uve=eo(eve),dve=eo(ive),hve=eo(nve),fve=Tme,pve=eo(ave),mve=eo(cve),Na=Object.assign(uve,{Input:hve,Button:dve,Label:fve,Options:pve,Option:mve});function gve(){let n=O.useRef(!1);return _n(()=>(n.current=!0,()=>{n.current=!1}),[]),n}function jV(n){var e;return!!(n.enter||n.enterFrom||n.enterTo||n.leave||n.leaveFrom||n.leaveTo)||((e=n.as)!=null?e:zV)!==O.Fragment||Rt.Children.count(n.children)===1}let $1=O.createContext(null);$1.displayName="TransitionContext";var vve=(n=>(n.Visible="visible",n.Hidden="hidden",n))(vve||{});function _ve(){let n=O.useContext($1);if(n===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return n}function xve(){let n=O.useContext(Y1);if(n===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return n}let Y1=O.createContext(null);Y1.displayName="NestingContext";function K1(n){return"children"in n?K1(n.children):n.current.filter(({el:e})=>e.current!==null).filter(({state:e})=>e==="visible").length>0}function BV(n,e){let t=Tu(n),r=O.useRef([]),i=gve(),o=qm(),s=mt((m,g=Bc.Hidden)=>{let _=r.current.findIndex(({el:v})=>v===m);_!==-1&&(js(g,{[Bc.Unmount](){r.current.splice(_,1)},[Bc.Hidden](){r.current[_].state="hidden"}}),o.microTask(()=>{var v;!K1(r)&&i.current&&((v=t.current)==null||v.call(t))}))}),a=mt(m=>{let g=r.current.find(({el:_})=>_===m);return g?g.state!=="visible"&&(g.state="visible"):r.current.push({el:m,state:"visible"}),()=>s(m,Bc.Unmount)}),l=O.useRef([]),c=O.useRef(Promise.resolve()),u=O.useRef({enter:[],leave:[]}),h=mt((m,g,_)=>{l.current.splice(0),e&&(e.chains.current[g]=e.chains.current[g].filter(([v])=>v!==m)),e==null||e.chains.current[g].push([m,new Promise(v=>{l.current.push(v)})]),e==null||e.chains.current[g].push([m,new Promise(v=>{Promise.all(u.current[g].map(([p,x])=>x)).then(()=>v())})]),g==="enter"?c.current=c.current.then(()=>e==null?void 0:e.wait.current).then(()=>_(g)):_(g)}),f=mt((m,g,_)=>{Promise.all(u.current[g].splice(0).map(([v,p])=>p)).then(()=>{var v;(v=l.current.shift())==null||v()}).then(()=>_(g))});return O.useMemo(()=>({children:r,register:a,unregister:s,onStart:h,onStop:f,wait:c,chains:u}),[a,s,r,h,f,u,c])}let zV=O.Fragment,HV=xE.RenderStrategy;function yve(n,e){var t,r;let{transition:i=!0,beforeEnter:o,afterEnter:s,beforeLeave:a,afterLeave:l,enter:c,enterFrom:u,enterTo:h,entered:f,leave:m,leaveFrom:g,leaveTo:_,...v}=n,[p,x]=O.useState(null),y=O.useRef(null),w=jV(n),C=Xs(...w?[y,e,x]:e===null?[]:[e]),T=(t=v.unmount)==null||t?Bc.Unmount:Bc.Hidden,{show:S,appear:b,initial:R}=_ve(),[E,A]=O.useState(S?"visible":"hidden"),F=xve(),{register:D,unregister:M}=F;_n(()=>D(y),[D,y]),_n(()=>{if(T===Bc.Hidden&&y.current){if(S&&E!=="visible"){A("visible");return}return js(E,{hidden:()=>M(y),visible:()=>D(y)})}},[E,y,D,M,S,T]);let k=dL();_n(()=>{if(w&&k&&E==="visible"&&y.current===null)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[y,E,k,w]);let z=R&&!b,P=b&&S&&R,U=O.useRef(!1),Y=BV(()=>{U.current||(A("hidden"),M(y))},F),Z=mt(fe=>{U.current=!0;let ce=fe?"enter":"leave";Y.onStart(y,ce,we=>{we==="enter"?o==null||o():we==="leave"&&(a==null||a())})}),j=mt(fe=>{let ce=fe?"enter":"leave";U.current=!1,Y.onStop(y,ce,we=>{we==="enter"?s==null||s():we==="leave"&&(l==null||l())}),ce==="leave"&&!K1(Y)&&(A("hidden"),M(y))});O.useEffect(()=>{w&&i||(Z(S),j(S))},[S,w,i]);let X=!(!i||!w||!k||z),[,B]=yV(X,p,S,{start:Z,end:j}),K=Sc({ref:C,className:((r=bN(v.className,P&&c,P&&u,B.enter&&c,B.enter&&B.closed&&u,B.enter&&!B.closed&&h,B.leave&&m,B.leave&&!B.closed&&g,B.leave&&B.closed&&_,!B.transition&&S&&f))==null?void 0:r.trim())||void 0,...xV(B)}),ee=0;return E==="visible"&&(ee|=Ls.Open),E==="hidden"&&(ee|=Ls.Closed),B.enter&&(ee|=Ls.Opening),B.leave&&(ee|=Ls.Closing),Rt.createElement(Y1.Provider,{value:Y},Rt.createElement(OV,{value:ee},Uo({ourProps:K,theirProps:v,defaultTag:zV,features:HV,visible:E==="visible",name:"Transition.Child"})))}function wve(n,e){let{show:t,appear:r=!1,unmount:i=!0,...o}=n,s=O.useRef(null),a=jV(n),l=Xs(...a?[s,e]:e===null?[]:[e]);dL();let c=cL();if(t===void 0&&c!==null&&(t=(c&Ls.Open)===Ls.Open),t===void 0)throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[u,h]=O.useState(t?"visible":"hidden"),f=BV(()=>{t||h("hidden")}),[m,g]=O.useState(!0),_=O.useRef([t]);_n(()=>{m!==!1&&_.current[_.current.length-1]!==t&&(_.current.push(t),g(!1))},[_,t]);let v=O.useMemo(()=>({show:t,appear:r,initial:m}),[t,r,m]);_n(()=>{t?h("visible"):!K1(f)&&s.current!==null&&h("hidden")},[t,f]);let p={unmount:i},x=mt(()=>{var w;m&&g(!1),(w=n.beforeEnter)==null||w.call(n)}),y=mt(()=>{var w;m&&g(!1),(w=n.beforeLeave)==null||w.call(n)});return Rt.createElement(Y1.Provider,{value:f},Rt.createElement($1.Provider,{value:v},Uo({ourProps:{...p,as:O.Fragment,children:Rt.createElement(VV,{ref:l,...p,...o,beforeEnter:x,beforeLeave:y})},theirProps:{},defaultTag:O.Fragment,features:HV,visible:u==="visible",name:"Transition"})))}function Sve(n,e){let t=O.useContext($1)!==null,r=cL()!==null;return Rt.createElement(Rt.Fragment,null,!t&&r?Rt.createElement(LN,{ref:e,...n}):Rt.createElement(VV,{ref:e,...n}))}let LN=eo(wve),VV=eo(yve),Eve=eo(Sve),GV=Object.assign(LN,{Child:Eve,Root:LN});function K4(n){const[e,t]=O.useState(n.selected),[r,i]=O.useState(!1),[o,s]=O.useState(""),a=O.useRef(null);O.useEffect(()=>{e!==n.selected&&t(n.selected)},[n.selected]);const l=o===""?n.list:n.list.filter(c=>c.label.toLowerCase().replace(/\s+/g,"").includes(o.toLowerCase().replace(/\s+/g,"")));return d.jsx(Na,{value:e||n.selected,onChange:c=>{n.onChange(c),t(c)},children:d.jsxs("div",{className:"relative",ref:a,onClick:()=>i(!r),children:[d.jsx("div",{className:"relative w-full overflow-hidden text-left shadow-sm focus:outline-none",children:d.jsx(Na.Button,{as:"div",children:d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"m-auto h-3 w-3",style:{backgroundColor:(e==null?void 0:e.label)=="NA"?"transparent":(e==null?void 0:e.label)||"white"}}),d.jsx(Na.Input,{className:"ml-1 w-full cursor-pointer border-none bg-transparent text-orange-400 hover:text-orange-300 focus:outline-none",displayValue:c=>n.onDisplayValue(c),onChange:c=>s(c.target.value)})]})})}),d.jsx(Tve,{setQuery:s,filteredList:l,query:o,refParent:a})]})})}function Tve(n){const[e,t]=O.useState(0),[r,i]=O.useState(0);return O.useEffect(()=>{var o;if((o=n.refParent)!=null&&o.current){const s=n.refParent.current.getBoundingClientRect();s.bottom!==e&&t(s.bottom),s.left!==r&&i(s.left)}}),bt.createPortal(d.jsx(GV,{as:O.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",afterLeave:()=>n.setQuery(""),children:d.jsx(Na.Options,{style:{top:e,left:r},className:"scrollbar absolute z-[1000] mt-1 max-h-60 overflow-auto border border-gray-600 bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:n.filteredList.length===0&&n.query!==""?d.jsx("div",{className:"relative ml-1 cursor-default select-none text-xs text-red-500",children:"Nothing found."}):n.filteredList.map(o=>d.jsx(Na.Option,{className:({active:s})=>`relative cursor-pointer select-none pl-1 pr-2 ${s?"bg-gray-700 text-orange-400":"text-orange-400"}`,value:o,children:()=>d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"m-auto ml-1 h-3 w-3",style:{backgroundColor:o.label}}),d.jsx("span",{className:"m-auto ml-1 block flex-1 text-xs",children:o.label})]})},o.id))})}),document.body)}function Cve(){return d.jsx("button",{className:"left-1 max-w-[7rem] bg-green-700 p-1 text-xs hover:bg-green-600",onClick:async()=>{ke.setState({loadingData:!0,dialogHeader:"please wait",dialogContent:"searching for elements"}),await U7(),await ae.selection_clear(!1),Pt.getState().updateToggel(),ke.setState({loadingData:!1,dialogHeader:"please wait",dialogContent:"searching for elements"})},children:"Update colors"})}function $d(n){const[e,t]=O.useState(n.selected),[r,i]=O.useState(!1),[o,s]=O.useState(""),a=O.useRef(null);O.useEffect(()=>{e!==n.selected&&t(n.selected)},[n.selected]);const l=o===""?n.list:n.list.filter(c=>c.label.toLowerCase().replace(/\s+/g,"").includes(o.toLowerCase().replace(/\s+/g,"")));return d.jsx(Na,{value:e||n.selected,onChange:c=>{n.onChange(c),t(c)},children:d.jsxs("div",{className:"relative",ref:a,onClick:()=>i(!r),children:[d.jsx("div",{className:"relative w-full overflow-hidden focus:outline-none",children:d.jsx(Na.Button,{as:"div",children:d.jsx("div",{className:"flex",children:d.jsx(Na.Input,{className:"w-full cursor-pointer border-none bg-transparent text-xs text-orange-400 hover:text-orange-300 focus:outline-none",displayValue:c=>n.onDisplayValue(c),onChange:c=>s(c.target.value)})})})}),d.jsx(bve,{setQuery:s,filteredList:l,query:o,refParent:a})]})})}function bve(n){const[e,t]=O.useState(0),[r,i]=O.useState(0);return O.useEffect(()=>{var o;if((o=n.refParent)!=null&&o.current){const s=n.refParent.current.getBoundingClientRect();s.bottom!==e&&t(s.bottom),s.left!==r&&i(s.left)}}),bt.createPortal(d.jsx(GV,{as:O.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",afterLeave:()=>n.setQuery(""),children:d.jsx(Na.Options,{style:{top:e,left:r},className:"scrollbar absolute z-[1000] mt-1 max-h-60 overflow-auto border border-gray-600 bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:n.filteredList.length===0&&n.query!==""?d.jsx("div",{className:"relative ml-1 cursor-default select-none text-xs text-red-500",children:"Nothing found."}):n.filteredList.map(o=>d.jsx(Na.Option,{className:({active:s})=>`cursor-pointer select-none ${s?"bg-gray-700 text-orange-400":"text-orange-400"}`,value:o,children:()=>d.jsx("span",{className:"m-auto ml-1 block flex-1 text-xs",children:o.label})},o.id))})}),document.body)}function Ave(){const n=Gt();return d.jsxs("div",{style:{minHeight:"0px"},className:"flex flex-grow flex-col",children:[d.jsx(Cve,{}),d.jsxs("div",{className:"mt-5 flex",children:[d.jsx("div",{className:"p-2 underline",children:"Color:"}),d.jsx("div",{className:"flex-1"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:async()=>{n.addColor({name:"",color:"White",operator:"Contains",uuid:er()}),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})})]}),d.jsx("div",{className:"scrollbar flex flex-grow flex-col overflow-auto border-t-2 border-gray-900/50 shadow-inner",children:n.currentSet.colorOverride.map((e,t)=>{const r=(e.color||"").split(":")[0],i=(e.color||"").split(":")[1]||"100",o=["100","75","50","25","10","05","02","00"];return d.jsxs("div",{className:"mb-2 flex flex-col border-b border-gray-900 p-2",children:[d.jsxs("div",{className:"flex",children:[d.jsxs("div",{className:"flex flex-1 flex-col text-xs",children:[d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"w-14 text-gray-300",children:"Name:"}),e.operator==="In"?d.jsx("textarea",{autoComplete:"off",value:e.name.length>1e4?["The text is too large to be fully displayed in edit mode, so only parts of it are visible."].concat("=====================").concat(e.name.slice(0,250)).concat("=====================").concat("If you need to edit, save config as file and use something like notepad ++").join(`
`):e.name,readOnly:e.name.length>1e4,onChange:s=>{var l;if(e.name.length>1e4)return;const a=(l=s==null?void 0:s.target)==null?void 0:l.value;n.updateColorItemName(t,a),n.updateUUID()},className:"scrollbar ml-1 flex-1 border-b border-dashed border-gray-700 bg-gray-800 p-[2px] text-gray-200 placeholder-gray-600 outline-none",placeholder:"paste in name and color column from excel"}):d.jsx("input",{autoComplete:"off",value:e.name,onChange:s=>{var l;const a=(l=s==null?void 0:s.target)==null?void 0:l.value;n.updateColorItemName(t,a),n.updateUUID()},className:"ml-1 max-h-5 flex-1 border-b border-dashed border-gray-700 bg-gray-800 p-[2px] text-gray-200 placeholder-gray-600 outline-none",placeholder:"item you want colored"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"w-14 text-gray-300",children:"Operator:"}),d.jsx("div",{className:"ml-1 font-semibold",children:d.jsx($d,{selected:{id:e.operator,label:e.operator},list:["Equal","Contains","In","StartWith","EndWith"].map(s=>({id:s,label:s})),onChange:s=>{const a=(s==null?void 0:s.label)||"Equal";n.updateColorOperator(t,a),a==="In"&&n.updateColorColorName(t,"NA:100"),n.updateUUID()},onDisplayValue:s=>(s==null?void 0:s.label)||""})})]}),e.operator==="In"?d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"w-14 text-gray-300",children:"Color:"}),d.jsx("div",{className:"ml-1 font-semibold",children:d.jsx(K4,{selected:{id:r,label:r},list:["NA"].concat(T4).map(s=>({id:s,label:s})),onChange:s=>{const a=(s==null?void 0:s.label)||"transparent";n.updateColorColorName(t,`${a}:100`),n.updateUUID()},onDisplayValue:s=>(s==null?void 0:s.label)||""})})]}):d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"w-14 text-gray-300",children:"Color:"}),d.jsx("div",{className:"ml-1 font-semibold",children:d.jsx(K4,{selected:{id:r,label:r},list:T4.map(s=>({id:s,label:s})),onChange:s=>{const a=(s==null?void 0:s.label)||"white";n.updateColorColorName(t,`${a}:${i}`),n.updateUUID()},onDisplayValue:s=>(s==null?void 0:s.label)||""})})]}),e.operator==="In"?null:d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"w-14 text-gray-300",children:"Opacity:"}),d.jsx("div",{className:"ml-1 font-semibold",children:d.jsx($d,{selected:{id:i,label:i=="00"?"00 (hide)":i},list:o.map(s=>({id:s,label:s=="00"?"00 (hide)":s})),onChange:s=>{const a=(s==null?void 0:s.id)||"100";n.updateColorColorName(t,`${r}:${a}`),n.updateUUID()},onDisplayValue:s=>(s==null?void 0:s.label)||""})})]})]}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 text-red-600 hover:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Delete color",strokeWidth:2,onClick:()=>{n.deleteColor(t),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})]}),d.jsxs("div",{className:"mt-2 flex items-center justify-center",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mr-2 h-5 w-5 text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{n.pushDownColor(t),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ml-2 h-5 w-5 text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{n.pushUpColor(t),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]})]},e.uuid)})})]})}function td(n,e){const t=Gt.getState();W().getSceneController().clearModelGroup("BBOX"+n);const r=structuredClone(t.currentSet.filter[n][e].max),i=structuredClone(t.currentSet.filter[n][e].min),o=new nt(new N(i.x,i.y,i.z),new N(r.x,r.y,r.z)),s=new PA(o,new rt("yellow"));W().getSceneController().addMeshToScene(s,"BBOX"+n),W().forceRenderNextFrame()}let T0=!1,Ec="up";function ON(n,e,t){const r=Gt.getState(),i=structuredClone(r.currentSet.filter[t][e].max),o=structuredClone(r.currentSet.filter[t][e].min);let s=0;function a(l,c){return c==="up"?l=l+.1:l=l-.1}switch(n){case"maxX":s=a(i.x,Ec),s>o.x&&(i.x=s);break;case"maxY":s=a(i.y,Ec),s>o.y&&(i.y=s);break;case"maxZ":s=a(i.z,Ec),s>o.z&&(i.z=s);break;case"minX":s=a(o.x,Ec),s<i.x&&(o.x=s);break;case"minY":s=a(o.y,Ec),s<i.y&&(o.y=s);break;case"minZ":s=a(o.z,Ec),s<i.z&&(o.z=s);break}r.updateBoundingFilter(t,e,{max:i,min:o}),td(t,e),T0&&setTimeout(()=>ON(n,e,t),50)}function Sf(n){return d.jsxs("div",{className:"flex",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ml-2 h-4 w-4 cursor-pointer text-orange-500 hover:text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onMouseDown:()=>{T0=!0,Ec="down",ON(n.type,n.index,n.filterIndex)},onMouseUp:()=>{T0=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ml-2 h-4 w-4 cursor-pointer text-orange-500 hover:text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onMouseDown:()=>{T0=!0,Ec="up",ON(n.type,n.index,n.filterIndex)},onMouseUp:()=>{T0=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]})}function Mve(n){const e=Gt(),t=n.row,r=n.rowNo,i=n.filterIndex,o={display:r===0?"none":""};return d.jsxs("div",{className:"m-1 flex flex-col border border-gray-900/50",children:[d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{className:"flex w-full flex-col text-xs",children:[d.jsxs("div",{className:"flex w-full",children:[d.jsx("span",{className:"ml-1 mt-1 w-14 text-gray-300",children:"Type:"}),d.jsx("div",{className:"ml-1 mt-1 font-semibold",children:d.jsx($d,{selected:{id:n.row.type,label:n.row.type},list:["Standard"].map(s=>({id:s,label:s})),onChange:s=>{switch((s==null?void 0:s.label)||"Standard"){case"Standard":e.setAsStandardFilter(i,r);break;case"Boundingbox":e.setAsBoundingboxFilter(i,r);break}e.updateUUID()},onDisplayValue:s=>(s==null?void 0:s.label)||"Standard"})})]}),d.jsxs("div",{className:"flex w-full",style:o,children:[d.jsx("span",{className:"ml-1 mt-1 w-14 text-gray-300",children:"Action:"}),d.jsx("div",{className:"ml-1 mt-1 font-semibold",children:d.jsx($d,{selected:{id:t.filtertype,label:t.filtertype},list:["Append","Remove","Keep"].map(s=>({id:s,label:s})),onChange:s=>{const a=(s==null?void 0:s.label)||"Append";e.setFilterType(i,r,a),e.updateUUID()},onDisplayValue:s=>(s==null?void 0:s.label)||"Append"})})]})]}),d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"flex items-center",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-4 w-4 cursor-pointer text-orange-500 hover:text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"get coordinates from selection",strokeWidth:2,onClick:async()=>{W().getSceneController().clearModelGroup("BBOX"+i);const s=await ae.get_bounding_box_from_selection();if(!s.X===void 0)return;const a=new nt(new N(s.x,s.y,s.z),new N(s.X,s.Y,s.Z)),l=new PA(a,new rt("yellow"));l.geometry.computeBoundingBox(),W().getSceneController().addMeshToScene(l,"BBOX"+i),W().forceRenderNextFrame();const c=structuredClone(e.currentSet.filter[i][r].max);c.x=a.max.x,c.y=a.max.y,c.z=a.max.z;const u=structuredClone(e.currentSet.filter[i][r].min);u.x=a.min.x,u.y=a.min.y,u.z=a.min.z,e.updateBoundingFilter(i,r,{max:c,min:u}),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),d.jsx("div",{className:"flex items-center",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-4 w-4 cursor-pointer text-orange-500 hover:text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"show bounding box",strokeWidth:2,onClick:()=>{W().getSceneController().clearModelGroup("BBOX"+i);const s=structuredClone(e.currentSet.filter[i][r].max),a=structuredClone(e.currentSet.filter[i][r].min),l=new nt(new N(a.x,a.y,a.z),new N(s.x,s.y,s.z)),c=new PA(l,new rt("yellow"));c.geometry.computeBoundingBox(),W().getSceneController().addMeshToScene(c,"BBOX"+i),W().forceRenderNextFrame()},children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),d.jsx("div",{className:"flex items-center",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-4 w-4 cursor-pointer text-orange-500 hover:text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"hide bounding box",strokeWidth:2,onClick:()=>{W().getSceneController().clearModelGroup("BBOX"+i),W().forceRenderNextFrame()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),d.jsx("div",{className:"flex flex-1"}),d.jsx("div",{className:"flex items-center",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-4 w-4 cursor-pointer text-red-500 hover:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.removeBoundingFilter(i,r),W().getSceneController().clearModelGroup("BBOX"+i),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),d.jsxs("div",{className:"flex text-xs",children:[d.jsxs("div",{className:"ml-1 flex-1 p-1",children:[d.jsx("div",{className:"underline",children:"Min"}),d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"flex w-5 font-semibold text-gray-300",children:"W:"}),d.jsx("input",{value:t.min.x,onChange:s=>{var u,h;const a=(h=(u=s==null?void 0:s.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);c.x=a,e.updateBoundingFilter(i,r,{max:l,min:c}),td(i,r),e.updateUUID()},className:"ml-1 max-h-5 w-16 border-b border-dashed border-gray-700 bg-gray-800 p-[2px] text-xs text-gray-200 placeholder-gray-600 outline-none",placeholder:"you need to add filter text"}),d.jsx(Sf,{type:"minX",index:r,filterIndex:i})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"flex w-5 font-semibold text-gray-300",children:"S:"}),d.jsx("input",{value:t.min.y,onChange:s=>{var u,h;const a=(h=(u=s==null?void 0:s.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);c.y=a,e.updateBoundingFilter(i,r,{max:l,min:c}),td(i,r),e.updateUUID()},className:"ml-1 max-h-5 w-16 border-b border-dashed border-gray-700 bg-gray-800 p-[2px] text-xs text-gray-200 placeholder-gray-600 outline-none",placeholder:"you need to add filter text"}),d.jsx(Sf,{type:"minY",index:r,filterIndex:i})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"flex w-5 font-semibold text-gray-300",children:"D:"}),d.jsx("input",{value:t.min.z,onChange:s=>{var u,h;const a=(h=(u=s==null?void 0:s.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);c.z=a,e.updateBoundingFilter(i,r,{max:l,min:c}),td(i,r),e.updateUUID()},className:"ml-1 max-h-5 w-16 border-b border-dashed border-gray-700 bg-gray-800 p-[2px] text-xs text-gray-200 placeholder-gray-600 outline-none",placeholder:"you need to add filter text"}),d.jsx(Sf,{type:"minZ",index:r,filterIndex:i})]})]})]}),d.jsxs("div",{className:"flex-1 p-1",children:[d.jsx("div",{className:"underline",children:"Max"}),d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"flex w-5 font-semibold text-gray-300",children:"E:"}),d.jsx("input",{value:t.max.x,onChange:s=>{var u,h;const a=(h=(u=s==null?void 0:s.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);l.x=a,e.updateBoundingFilter(i,r,{max:l,min:c}),td(i,r),e.updateUUID()},className:"ml-1 max-h-5 w-16 border-b border-dashed border-gray-700 bg-gray-800 p-[2px] text-xs text-gray-200 placeholder-gray-600 outline-none",placeholder:"you need to add filter text"}),d.jsx(Sf,{type:"maxX",index:r,filterIndex:i})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"flex w-5 font-semibold text-gray-300",children:"N:"}),d.jsx("input",{value:t.max.y,onChange:s=>{var u,h;const a=(h=(u=s==null?void 0:s.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);l.y=a,e.updateBoundingFilter(i,r,{max:l,min:c}),td(i,r),e.updateUUID()},className:"ml-1 max-h-5 w-16 border-b border-dashed border-gray-700 bg-gray-800 p-[2px] text-xs text-gray-200 placeholder-gray-600 outline-none",placeholder:"you need to add filter text"}),d.jsx(Sf,{type:"maxY",index:r,filterIndex:i})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"flex w-5 font-semibold text-gray-300",children:"U:"}),d.jsx("input",{value:t.max.z,onChange:s=>{var u,h;const a=(h=(u=s==null?void 0:s.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);l.z=a,e.updateBoundingFilter(i,r,{max:l,min:c}),td(i,r),e.updateUUID()},className:"ml-1 max-h-5 w-16 border-b border-dashed border-gray-700 bg-gray-800 p-[2px] text-xs text-gray-200 placeholder-gray-600 outline-none",placeholder:"you need to add filter text"}),d.jsx(Sf,{type:"maxZ",index:r,filterIndex:i})]})]})]})]}),d.jsxs("div",{className:"mt-2 flex items-center justify-center",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.filterPushDown(i,r),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.filterPushUp(i,r),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]})]},r)}function Rve(n){const e=Gt(),t=n.rowNo,r=n.filterIndex,i=n.row,o={display:t===0?"none":""};return d.jsxs("div",{className:"m-1 flex flex-col border border-gray-900/50",children:[d.jsx("div",{className:"mb-2 flex",children:d.jsxs("div",{className:"flex flex-col text-xs",children:[d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"ml-1 mt-1 w-14 text-gray-300",children:"Type:"}),d.jsx("div",{className:"ml-1 mt-1 font-semibold",children:d.jsx($d,{selected:{id:n.row.type,label:n.row.type},list:["Standard"].map(s=>({id:s,label:s})),onChange:s=>{switch((s==null?void 0:s.label)||"Standard"){case"Standard":e.setAsStandardFilter(r,t);break;case"Boundingbox":e.setAsBoundingboxFilter(r,t);break}e.updateUUID()},onDisplayValue:s=>(s==null?void 0:s.label)||"Standard"})})]}),d.jsxs("div",{className:"flex",style:o,children:[d.jsx("span",{className:"ml-1 mt-1 w-14 text-gray-300",children:"Action:"}),d.jsx("div",{className:"ml-1 mt-1 font-semibold",children:d.jsx($d,{selected:{id:i.filtertype,label:i.filtertype},list:["Append","Remove","Keep"].map(s=>({id:s,label:s})),onChange:s=>{const a=(s==null?void 0:s.label)||"Append";e.setFilterType(r,t,a),e.updateUUID()},onDisplayValue:s=>(s==null?void 0:s.label)||"Append"})})]})]})}),d.jsx("span",{className:"m-1 w-14 text-xs text-gray-300",children:"Expressions:"}),i.expression.map((s,a)=>d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"ml-1 mt-1 max-w-[3rem] font-semibold",children:d.jsx($d,{selected:{id:s.operator,label:s.operator},list:["Equal","Contains","In","StartWith","EndWith"].map(l=>({id:l,label:l})),onChange:l=>{const c=(l==null?void 0:l.label)||"Equal";e.setExpressionOperator(r,t,a,c),e.updateUUID()},onDisplayValue:l=>(l==null?void 0:l.label)||"Equal"})}),s.operator==="In"?d.jsx("textarea",{value:s.input.length>1e4?["The text is too large to be fully displayed in edit mode, so only parts of it are visible."].concat("=====================").concat(s.input.slice(0,250)).concat("=====================").concat("If you need to edit, save config as file and use something like notepad ++").join(`
`):s.input,readOnly:s.input.length>1e4,onChange:l=>{var u,h;if(s.input.length>1e4)return;const c=(h=(u=l==null?void 0:l.nativeEvent)==null?void 0:u.target)==null?void 0:h.value;e.setExpressionValue(r,t,a,c),e.updateUUID()},className:"scrollbar ml-1 flex-1 border-b border-dashed border-gray-700 bg-gray-800 p-[2px] text-xs text-gray-200 placeholder-gray-600 outline-none",placeholder:"you can paste rows from excel here"}):d.jsx("input",{value:s.input,onChange:l=>{var u,h;const c=(h=(u=l==null?void 0:l.nativeEvent)==null?void 0:u.target)==null?void 0:h.value;e.setExpressionValue(r,t,a,c),e.updateUUID()},className:"ml-1 max-h-5 flex-1 border-b border-dashed border-gray-700 bg-gray-800 p-[2px] text-xs text-gray-200 placeholder-gray-600 outline-none",placeholder:"you need to add filter text"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-auto ml-5 mr-2 h-4 w-4 cursor-pointer text-red-500 hover:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.removeExpression(r,t,a),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})]},`${t}-${a}`)),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute bottom-1 left-1 text-gray-700"}),d.jsxs("div",{className:"mt-2 flex items-center justify-center",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.filterPushDown(r,t),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-5 w-5 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{const s={input:"",operator:"Contains"};e.addExpression(r,t,s),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.filterPushUp(r,t),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]})]})]},t)}function Nve(n){const e=Gt();return d.jsxs("div",{className:"m-2 flex flex-col",children:[d.jsxs("div",{className:"sticky top-0 z-10 flex bg-gray-700 p-2 text-gray-400 shadow",children:[d.jsxs("div",{className:"flex-1 underline",children:["Filter no: ",n.index+1]}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 cursor-pointer text-red-500 hover:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:()=>{e.removeFilter(n.index)},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:()=>{const t={filtertype:"Append",max:{x:1,y:1,z:1},min:{x:1,y:1,z:1},type:"Standard",grouptype:"Or",expression:[{input:"",operator:"Contains"}],uuid:er()};e.addSubFilter(n.index,t),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})})]}),d.jsx("div",{className:"ml-3 flex flex-col",children:e.currentSet.filter[n.index].map((t,r)=>t.type==="Boundingbox"?d.jsx(Mve,{row:t,filterIndex:n.index,rowNo:r},r):d.jsx(Rve,{row:t,filterIndex:n.index,rowNo:r},r))})]})}function Ive(){return d.jsx("button",{className:"left-1 max-w-[7rem] bg-green-700 p-1 text-xs hover:bg-green-600",onClick:async()=>{var e;const n=Gt.getState();if(n.currentSet.filter.length){v_(),ke.setState({loadingData:!0,dialogHeader:"please wait",dialogContent:"searching for elements"});const t=((e=Re.getState().selectedProject)==null?void 0:e.project_key)||"unknown";n.setProjectKey(t);const r=Pi.getkeys().length>0,i=await ae.filter_geometry(n.currentSet.filter,[]);await ae.selection_clear(!0),Pi.clear(),Pi.add(i),await Pi.load(!1,r),await ae.filter_geometry([],n.currentSet.colorOverride),await ae.selection_append(),W().getSceneController().updateBB(),W().forceRenderNextFrame()}else Fn.setState({activated:!0,message:"no filters set"})},children:"Generate"})}function Pve(){const n=Gt();return d.jsxs("div",{style:{minHeight:"0px"},className:"flex flex-grow flex-col",children:[d.jsx("div",{className:"m-2 flex",children:d.jsx(Ive,{})}),d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"p-2 underline",children:"Filters:"}),d.jsx("div",{className:"flex-1"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 cursor-pointer text-red-500 hover:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:()=>{n.removeAllFilters()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:()=>{n.addFilter(),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})})]}),d.jsx("div",{className:"scrollbar flex flex-col overflow-auto border-b border-t-2 border-gray-900/50 shadow-inner",children:n.currentSet.filter.map((e,t)=>d.jsx(Nve,{index:t},e[0].uuid))})]})}function kve(){const n=Gt(),e=async()=>{const i=new N,o=new N;W().getActiveControls().getPosition(i),W().getActiveControls().getTarget(o);const s=W().getActiveCamera().type,a=W().getActiveCamera().zoom,l={uuid:er(),name:`${n.currentSet.viewPoints.length+1}`,z_plane_visible:De.getState().z_plane_visible,y_plane_visible:De.getState().y_plane_visible,x_plane_visible:De.getState().x_plane_visible,z_plane_enable:De.getState().z_plane_enable,y_plane_enable:De.getState().y_plane_enable,x_plane_enable:De.getState().x_plane_enable,z_plane_neg:De.getState().z_plane_neg,y_plane_neg:De.getState().y_plane_neg,x_plane_neg:De.getState().x_plane_neg,z_plane_offset:De.getState().z_plane_offset,y_plane_offset:De.getState().y_plane_offset,x_plane_offset:De.getState().x_plane_offset,boxClippingEnabled:Xe.getState().enabled,boxClippingMaxX:Xe.getState().maxX,boxClippingMaxY:Xe.getState().maxY,boxClippingMaxZ:Xe.getState().maxZ,boxClippingMinX:Xe.getState().minX,boxClippingMinY:Xe.getState().minY,boxClippingMinZ:Xe.getState().minZ,selectedFullName:"",comment:"",links:[],controllerPosition:[i.x,i.y,i.z],controllerTarget:[o.x,o.y,o.z],cameraType:s,zoom:a};n.addViewPoint(l),n.updateUUID()},t=async i=>{const o=n.currentSet.viewPoints[i];W().setCameraMode(o.cameraType==="PerspectiveCamera"?"3D":"2D"),De.setState({z_plane_visible:o.z_plane_visible,y_plane_visible:o.y_plane_visible,x_plane_visible:o.x_plane_visible,z_plane_enable:o.z_plane_enable,y_plane_enable:o.y_plane_enable,x_plane_enable:o.x_plane_enable,z_plane_neg:o.z_plane_neg,y_plane_neg:o.y_plane_neg,x_plane_neg:o.x_plane_neg,z_plane_offset:o.z_plane_offset,y_plane_offset:o.y_plane_offset,x_plane_offset:o.x_plane_offset}),o.boxClippingEnabled?Xe.setState({enabled:!0,transformHelperEnabled:!1,minX:o.boxClippingMinX,minY:o.boxClippingMinY,minZ:o.boxClippingMinZ,maxX:o.boxClippingMaxX,maxY:o.boxClippingMaxY,maxZ:o.boxClippingMaxZ}):Xe.setState({enabled:!1,transformHelperEnabled:!1}),Xt.updateClipShader(),Xt.updateClippingHelper(),W().getActiveControls().smoothTime=.5,W().getActiveControls().saveState(),o.cameraType!=="PerspectiveCamera"&&o.zoom!==void 0&&(W().getActiveControls()._zoomEnd=o.zoom);const s=W().getActiveControls().setLookAt(o.controllerPosition[0],o.controllerPosition[1],o.controllerPosition[2],o.controllerTarget[0],o.controllerTarget[1],o.controllerTarget[2],!0);let a=null;o.selectedFullName&&(a=ae.get_ids_from_fullnames([o.selectedFullName]).then(async l=>{if(l.length){await ae.selection_clear(!1),await ae.treeview_collapse(),await ae.selection_add(l),await ae.treeview_expand_from_id(l[0]),await ae.selection_append();const c=ae.getRowOfKey(l[0]);Pt.getState().updateToggel(c),Km(l[0],!1)}})),await Promise.all([s,a]),W().getActiveControls().smoothTime=1,W().getActiveControls().saveState()},r=i=>{const o=new N,s=new N;W().getActiveControls().getPosition(o),W().getActiveControls().getTarget(s);const a=W().getActiveCamera().type,l=W().getActiveCamera().zoom,c={uuid:er(),z_plane_visible:De.getState().z_plane_visible,y_plane_visible:De.getState().y_plane_visible,x_plane_visible:De.getState().x_plane_visible,z_plane_enable:De.getState().z_plane_enable,y_plane_enable:De.getState().y_plane_enable,x_plane_enable:De.getState().x_plane_enable,z_plane_neg:De.getState().z_plane_neg,y_plane_neg:De.getState().y_plane_neg,x_plane_neg:De.getState().x_plane_neg,z_plane_offset:De.getState().z_plane_offset,y_plane_offset:De.getState().y_plane_offset,x_plane_offset:De.getState().x_plane_offset,boxClippingEnabled:Xe.getState().enabled,boxClippingMaxX:Xe.getState().maxX,boxClippingMaxY:Xe.getState().maxY,boxClippingMaxZ:Xe.getState().maxZ,boxClippingMinX:Xe.getState().minX,boxClippingMinY:Xe.getState().minY,boxClippingMinZ:Xe.getState().minZ,controllerPosition:[o.x,o.y,o.z],controllerTarget:[s.x,s.y,s.z],cameraType:a,zoom:l,links:[]};n.updateViewpoint(i,c),n.updateUUID()};return d.jsxs("div",{style:{minHeight:"0px"},className:"flex flex-grow flex-col",children:[d.jsxs("div",{className:"mt-5 flex",children:[d.jsx("div",{className:"p-2 underline",children:"ViewPoints:"}),d.jsx("div",{className:"flex-1"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:()=>e(),children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})})]}),d.jsx("div",{className:"scrollbar flex flex-grow flex-col overflow-y-auto border-t-2 border-gray-900/50 shadow-inner",children:n.currentSet.viewPoints.map((i,o)=>{let s="flex flex-col border-b border-gray-900";return o%2===1&&(s="flex flex-col border-b border-gray-900 bg-gray-700/20"),d.jsxs("div",{className:s,children:[d.jsxs("div",{className:"mb-2 flex border-b border-gray-700/50",children:[d.jsxs("div",{className:"flex",children:[d.jsxs("div",{className:"m-2 text-lg text-gray-500",children:["(",o+1,")"]}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 rotate-45 cursor-pointer text-orange-700 hover:text-orange-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Load viewpoint",strokeWidth:2,onClick:()=>t(o),children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 ml-10 h-6 w-6 cursor-pointer text-orange-500 hover:text-orange-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,"data-tooltip":"Push up",onClick:()=>{n.pushUpViewpoint(o),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 cursor-pointer text-orange-500 hover:text-orange-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,"data-tooltip":"Push down",onClick:()=>{n.pushDownViewpoint(o),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),d.jsx("div",{className:"flex-1"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 cursor-pointer text-orange-600 hover:text-orange-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Update controller position/rotation center",strokeWidth:2,onClick:()=>r(o),children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 cursor-pointer text-red-600 hover:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Delete viewpoint",strokeWidth:2,onClick:()=>{n.deleteViewpoint(o),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})]}),d.jsxs("div",{className:"ml-2 flex flex-1 flex-col text-xs",children:[d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"w-16 font-semibold text-gray-300",children:"Name:"}),d.jsx("input",{value:i.name,onChange:a=>{var c;const l=(c=a==null?void 0:a.target)==null?void 0:c.value;n.updateViewpointName(o,l),n.updateUUID()},className:"ml-1 max-h-5 flex-1 border-b border-dashed border-gray-700 bg-transparent p-[2px] text-gray-200 placeholder-gray-600 outline-none",placeholder:"you need to add filter text"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"w-16 font-semibold text-gray-300",children:"Item:"}),d.jsx("input",{value:i.selectedFullName,onChange:a=>{var c;const l=(c=a==null?void 0:a.target)==null?void 0:c.value;n.updateViewpointSelect(o,l),n.updateUUID()},className:"ml-1 max-h-5 flex-1 border-b border-dashed border-gray-700 bg-transparent p-[2px] text-gray-200 placeholder-gray-600 outline-none",placeholder:"add name of item to select"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"mt-2 w-16 font-semibold text-gray-300",children:"Comment:"}),d.jsx("textarea",{value:i.comment,onChange:a=>{var c;const l=(c=a==null?void 0:a.target)==null?void 0:c.value;n.updateViewpointComment(o,l),n.updateUUID()},className:"scrollbar ml-1 mt-1 max-h-5 min-h-[5rem] flex-1 resize-none border-b border-dashed border-gray-700 bg-transparent p-[2px] text-xs text-gray-200 placeholder-gray-600 outline-none",placeholder:"your comment"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"mt-2 font-semibold text-gray-300",children:"Links:"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-4 w-4 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{const a={label:"",url:""};n.addLink(a,o),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),d.jsx("div",{className:"flex flex-col",children:i.links.length===0?null:i.links.map((a,l)=>d.jsx("div",{className:"mt-2 flex flex-col",children:d.jsxs("div",{className:"flex",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mt-2 h-4 w-4 cursor-pointer text-red-500 hover:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{n.deleteLink(o,l),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d.jsxs("div",{className:"ml-2 flex flex-1 flex-col",children:[d.jsxs("label",{className:"flex",children:[d.jsx("div",{className:"w-16 text-xs text-gray-300",children:"Label:"}),d.jsx("input",{value:a.label,onChange:c=>{var h;const u=(h=c==null?void 0:c.target)==null?void 0:h.value;n.updateLinkLabel(o,l,u),n.updateUUID()},className:"ml-1 max-h-5 flex-1 border-b border-dashed border-gray-700 bg-transparent p-[2px] text-gray-200 placeholder-gray-600 outline-none",placeholder:"link label"})]}),d.jsxs("label",{className:"flex",children:[d.jsx("div",{className:"w-16 text-xs text-gray-300",children:"Url:"}),d.jsx("input",{value:a.url,onChange:c=>{var h;const u=(h=c==null?void 0:c.target)==null?void 0:h.value;n.updateLinkUrl(o,l,u),n.updateUUID()},className:"mb-2 ml-1 max-h-5 flex-1 border-b border-dashed border-gray-700 bg-transparent p-[2px] text-gray-200 placeholder-gray-600 outline-none",placeholder:"link url"})]})]})]})},l))})]})]},i.uuid)})})]})}function Lve(){const n=Gt();return n.activeTab==="FILTER"?d.jsx(Pve,{}):n.activeTab==="COLOR"?d.jsx("div",{className:"scrollbar flex flex-col overflow-auto",children:d.jsx(Ave,{})}):n.activeTab==="VIEWPOINT"?d.jsx(kve,{}):null}function DN(){return Gt().editMode?d.jsx("svg",{onClick:async()=>{Gt.setState({editMode:!1})},xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Goto View Mode",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}):d.jsx("svg",{onClick:async()=>{Gt.setState({editMode:!0})},xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Goto Edit Mode",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}function X4(){return Gt().viewModeListMode?d.jsx("svg",{onClick:async()=>{Gt.setState({viewModeListMode:!1})},xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Goto View Mode",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})}):d.jsx("svg",{onClick:async()=>{Gt.setState({viewModeListMode:!0})},xmlns:"http://www.w3.org/2000/svg",className:"m-2 h-6 w-6 cursor-pointer text-indigo-500 hover:text-indigo-300",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Goto Edit Mode",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})}function q4(n){return n.view?d.jsx(d.Fragment,{children:d.jsxs("div",{className:"ml-2 flex flex-1 flex-col text-xs",children:[d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"w-16 text-gray-300",children:"Name:"}),d.jsx("input",{value:n.view.name,readOnly:!0,className:"ml-1 max-h-5 flex-1 border-b border-dashed border-gray-700 bg-transparent p-[2px] text-gray-200 placeholder-gray-600 outline-none",placeholder:"you need to add filter text"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"s w-16 text-gray-300",children:"Item:"}),d.jsx("input",{value:n.view.selectedFullName,readOnly:!0,className:"ml-1 max-h-5 flex-1 border-b border-dashed border-gray-700 bg-transparent p-[2px] text-gray-200 placeholder-gray-600 outline-none",placeholder:"add name of item to select"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"mt-2 w-16 text-gray-300",children:"Comment:"}),d.jsx("textarea",{value:n.view.comment,readOnly:!0,className:"scrollbar ml-1 mt-1 max-h-5 min-h-[5rem] flex-1 resize-none border-b border-dashed border-gray-700 bg-transparent p-[2px] text-xs text-gray-200 placeholder-gray-600 outline-none",placeholder:"your comment"})]}),d.jsx("div",{className:"flex",children:d.jsx("span",{className:"mt-2 text-gray-300",children:n.view.links.length===0?null:"Links:"})}),d.jsx("div",{className:"flex flex-col",children:n.view.links.length===0?null:n.view.links.map((e,t)=>d.jsx("div",{className:"flex flex-col",children:d.jsx("div",{className:"mr-3 flex items-center",children:d.jsxs("div",{className:"m-2 flex",children:[d.jsxs("span",{className:"mr-2",children:[t+1,":"]}),d.jsx("a",{target:"_blank",rel:"noreferrer",href:e.url,onClick:r=>{r.preventDefault();const i=e.url.replace("web3dBroadcastChannel","oldBC").split("/"),o="web-report.apps.aibel.net",s="web-report.tapps.aibel.net",a=i[2]&&i[2].toLowerCase();if(location.host.includes("localhost")||a===o||a===s){i.shift(),i.shift(),i[0]=`${location.origin}/tool-webreport`;const c=new URLSearchParams;c.append("web3dBroadcastChannel",A1),e.url.includes("?")?i[i.length-1]=i[i.length-1]+`&${c.toString()}`:i[i.length-1]=i[i.length-1]+`#?${c.toString()}`}const l=i.join("/");window.open(l)},className:"text-indigo-400 visited:bg-indigo-200 hover:visited:bg-orange-500",children:e.label})]})})},t))})]})}):null}function WV(n){var o,s;const e=Gt(),[t,r]=O.useState(0);async function i(a){r(a);const l=e.currentSet.viewPoints[a];W().setCameraMode(l.cameraType==="PerspectiveCamera"?"3D":"2D"),W().fitModelToCanvas(),W().forceRenderNextFrame(),De.setState({z_plane_visible:l.z_plane_visible,y_plane_visible:l.y_plane_visible,x_plane_visible:l.x_plane_visible,z_plane_enable:l.z_plane_enable,y_plane_enable:l.y_plane_enable,x_plane_enable:l.x_plane_enable,z_plane_neg:l.z_plane_neg,y_plane_neg:l.y_plane_neg,x_plane_neg:l.x_plane_neg,z_plane_offset:l.z_plane_offset,y_plane_offset:l.y_plane_offset,x_plane_offset:l.x_plane_offset}),l.boxClippingEnabled?Xe.setState({enabled:!0,transformHelperEnabled:!1,minX:l.boxClippingMinX,minY:l.boxClippingMinY,minZ:l.boxClippingMinZ,maxX:l.boxClippingMaxX,maxY:l.boxClippingMaxY,maxZ:l.boxClippingMaxZ}):Xe.setState({enabled:!1,transformHelperEnabled:!1}),Xt.updateClipShader(),Xt.updateClippingHelper(),W().getActiveControls().smoothTime=.25,W().getActiveControls().saveState(),l.cameraType!=="PerspectiveCamera"&&l.zoom!==void 0&&(W().getActiveControls()._zoomEnd=l.zoom);const c=W().getActiveControls().setLookAt(l.controllerPosition[0],l.controllerPosition[1],l.controllerPosition[2],l.controllerTarget[0],l.controllerTarget[1],l.controllerTarget[2],!0);let u=null;l.selectedFullName&&(u=ae.get_ids_from_fullnames([l.selectedFullName]).then(async h=>{if(h.length){await ae.selection_clear(!1),await ae.treeview_collapse(),await ae.selection_add(h),await ae.treeview_expand_from_id(h[0]),await ae.selection_append();const f=ae.getRowOfKey(h[0]);Pt.getState().updateToggel(f),Km(h[0],!1)}})),await Promise.all([c,u]),W().getActiveControls().smoothTime=0,W().getActiveControls().saveState()}return e.viewModeListMode?d.jsxs("div",{style:{minHeight:"0px"},className:"flex flex-grow flex-col",children:[d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"p-2 underline",children:"ViewPoints:"}),d.jsx("div",{className:"flex-1"}),d.jsx(X4,{}),d.jsx(DN,{})]}),d.jsx("div",{className:"scrollbar flex flex-grow flex-col overflow-y-auto border-t-2 border-gray-900/50 shadow-inner",children:e.currentSet.viewPoints.map((a,l)=>{let c="flex flex-col border-b border-gray-900";return l%2===1&&(c="flex flex-col border-b border-gray-900 bg-gray-700/20"),d.jsxs("div",{className:c,children:[d.jsxs("div",{className:"mb-2 flex border-b border-gray-700/50",children:[d.jsxs("div",{className:"m-2 text-lg text-gray-500",children:["(",l+1,")"]}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-2 ml-2 h-6 w-6 rotate-45 cursor-pointer text-orange-700 hover:text-orange-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Load viewpoint",strokeWidth:2,onClick:async()=>{i(l)},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})]}),d.jsx(q4,{view:a})]},a.uuid)})})]}):d.jsxs("div",{style:{minHeight:"0px"},className:"flex flex-grow flex-col",children:[d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"p-2 underline",children:"ViewPoints:"}),d.jsx("div",{className:"flex-1"}),n.simplified?null:d.jsx(X4,{}),n.simplified?null:d.jsx(DN,{})]}),d.jsxs("div",{className:"scrollbar flex flex-grow flex-col overflow-y-auto border-t-2 border-gray-900/50 shadow-inner",children:[d.jsxs("div",{className:"m-2 flex",children:[d.jsx("button",{className:"m-2 flex-1 bg-indigo-500 p-1",onClick:()=>{var l,c,u;if(!((c=(l=e.currentSet)==null?void 0:l.viewPoints)!=null&&c.length))return;const a=((u=e.currentSet)==null?void 0:u.viewPoints.length)-1;i(t===0?a:t-1)},children:"Prev"}),d.jsx("div",{className:"m-2 flex-1 p-1 text-center text-gray-200",children:d.jsxs("span",{className:"text-xl font-semibold",children:[t+1," / ",((o=e.currentSet)==null?void 0:o.viewPoints.length)||""]})}),d.jsx("button",{className:"m-2 flex-1 bg-indigo-500 p-1",onClick:()=>{var l,c,u;if(!((c=(l=e.currentSet)==null?void 0:l.viewPoints)!=null&&c.length))return;const a=((u=e.currentSet)==null?void 0:u.viewPoints.length)-1;i(t===a?0:t+1)},children:"Next"})]}),d.jsx(q4,{view:(s=e.currentSet)==null?void 0:s.viewPoints[t]})]})]})}const Ove=Rt.memo(function(){return Gt().editMode?d.jsxs("div",{className:"flex h-full w-full flex-grow flex-col",children:[d.jsx(Ppe,{}),d.jsxs("div",{className:"mt-3 flex",children:[d.jsx("div",{className:"m-2 flex-1"}),d.jsx(DN,{}),eP()?d.jsx(Ape,{}):null,d.jsx(Ipe,{}),d.jsx(Rpe,{})]}),d.jsx(Lve,{})]}):d.jsx("div",{className:"z-50 flex h-full w-full flex-grow flex-col",children:d.jsx(WV,{})})});let Qg={height:500,width:350,bottom:200,right:0,initLoaded:!1,closed:!0};function Dve(){const n=Gt();return d.jsx(Rh,{uniqueName:"SetEditor",adjustOnLoad:!1,title:"Set Editor",isOpen:n.isOpen,width:Qg.width,height:Qg.height,bottom:Qg.bottom,onClose:e=>{Qg={...Qg,...e},Gt.setState({isOpen:!1}),Pt.getState().updateToggel()},children:d.jsx(Ove,{})})}function Uve(){const n=Pe();return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"sticky top-0 mb-1 ml-1 mt-1 flex border-b border-gray-700 bg-gray-800 text-yellow-500",children:["Scene",d.jsx("svg",{"data-tooltip":["Basic scene settings"].join(`
`),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:.5,stroke:"currentColor",className:"m-auto ml-2 h-3 w-3",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})})]}),d.jsxs("label",{className:"ml-2 mt-2 flex flex-col p-1",children:[d.jsx("span",{className:"flex",children:"Background Color:"}),d.jsx("div",{className:"flex p-1",children:d.jsx("input",{value:n.backgroundColor,type:"color",onChange:e=>{bt.flushSync(()=>{Pe.setState({backgroundColor:e.currentTarget.value})}),Yt();const t=W().getSceneController().currentScene();t.background=new rt(Pe.getState().backgroundColor),W().forceRenderNextFrame()}})})]}),d.jsxs("label",{className:"ml-2 mt-2 flex flex-col p-1",children:[d.jsx("span",{className:"flex",children:"Selection Color:"}),d.jsx("div",{className:"flex p-1",children:d.jsx("input",{value:n.selectionColor,type:"color",onChange:e=>{bt.flushSync(()=>{Pe.setState({selectionColor:e.currentTarget.value})}),Yt();const t=W().getSceneController().getMeshes();for(let r=0;r<t.length;r++)t[r].$refreshSelection!==void 0&&t[r].$refreshSelection();W().forceRenderNextFrame()}})})]}),d.jsxs("div",{className:"ml-2 flex flex-col p-1",children:[d.jsx("span",{className:"flex",children:"AmbientLight:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"ml-2 mr-2 w-12 p-1 text-black",type:"number",step:.1,value:n.lightAmbient,onChange:e=>{if(e.currentTarget.valueAsNumber>=.1){Pe.setState({lightAmbient:e.currentTarget.valueAsNumber});const t=W().getSceneController();t.__ambientLight.intensity=Pe.getState().lightAmbient,Yt(),W().forceRenderNextFrame()}}}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{if(n.lightAmbient>=.2){Pe.setState({lightAmbient:parseFloat((n.lightAmbient-.1).toFixed(1))});const e=W().getSceneController();e.__ambientLight.intensity=Pe.getState().lightAmbient,Yt(),W().forceRenderNextFrame()}},children:"- 0.1"}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{Pe.setState({lightAmbient:parseFloat((n.lightAmbient+.1).toFixed(1))});const e=W().getSceneController();e.__ambientLight.intensity=Pe.getState().lightAmbient,Yt(),W().forceRenderNextFrame()},children:"+ 0.1"})]})]}),d.jsxs("div",{className:"ml-2 flex flex-col p-1",children:[d.jsx("span",{className:"flex",children:"PointLight:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"ml-2 mr-2 w-12 p-1 text-black",type:"number",step:.1,value:n.lightPoint,onChange:e=>{if(e.currentTarget.valueAsNumber>=.1){Pe.setState({lightPoint:e.currentTarget.valueAsNumber});const t=W().getSceneController();t.__pointLight.intensity=Pe.getState().lightPoint,Yt(),W().forceRenderNextFrame()}}}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{if(n.lightPoint>=.2){Pe.setState({lightPoint:parseFloat((n.lightPoint-.1).toFixed(1))});const e=W().getSceneController();e.__pointLight.intensity=Pe.getState().lightPoint,Yt(),W().forceRenderNextFrame()}},children:"- 0.1"}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{Pe.setState({lightPoint:parseFloat((n.lightPoint+.1).toFixed(1))});const e=W().getSceneController();e.__pointLight.intensity=Pe.getState().lightPoint,Yt(),W().forceRenderNextFrame()},children:"+ 0.1"})]})]})]})}function Fve(){const n=Pe();return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"sticky top-0 mb-1 ml-1 mt-1 flex border-b border-gray-700 bg-gray-800 text-yellow-500",children:["Info Controller",d.jsx("svg",{"data-tooltip":["Controller - Forward speed","How fast you move forward, default = 0.7","Forward min distance:","When this is to low, it will feel like controller is hanging when trying to move past/over a orbit point, default is 5"].join(`
`),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:.5,stroke:"currentColor",className:"m-auto ml-2 h-3 w-3",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})})]}),d.jsxs("div",{className:"ml-2 flex flex-col p-1",children:[d.jsx("span",{className:"flex",children:"Controller - Forward speed:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"ml-2 mr-2 w-12 p-1 text-black",type:"number",step:.1,value:n.controllerDollySpeed,onChange:e=>{e.currentTarget.valueAsNumber>=.1&&(Pe.setState({controllerDollySpeed:e.currentTarget.valueAsNumber}),W().__controls3d.dollySpeed=e.currentTarget.valueAsNumber,W().__controls3d.saveState(),Yt())}}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{n.controllerDollySpeed>=.2&&(Pe.setState({controllerDollySpeed:parseFloat((n.controllerDollySpeed-.1).toFixed(1))}),W().__controls3d.dollySpeed=n.controllerDollySpeed-.1,W().__controls3d.saveState(),Yt())},children:"- 0.1"}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{Pe.setState({controllerDollySpeed:parseFloat((n.controllerDollySpeed+.1).toFixed(1))}),W().__controls3d.dollySpeed=n.controllerDollySpeed+.1,W().__controls3d.saveState(),Yt()},children:"+ 0.1"})]})]}),d.jsxs("div",{className:"ml-2 flex flex-col p-1",children:[d.jsx("span",{className:"flex",children:"Controller - Forward min distance:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"ml-2 mr-2 w-12 p-1 text-black",type:"number",step:.1,value:n.controllerDollyMinDistance,onChange:e=>{e.currentTarget.valueAsNumber>=.1&&(Pe.setState({controllerDollyMinDistance:e.currentTarget.valueAsNumber}),W().__controls3d.minDistance=e.currentTarget.valueAsNumber,W().__controls3d.saveState(),Yt())}}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{n.controllerDollyMinDistance>=.2&&(Pe.setState({controllerDollyMinDistance:parseFloat((n.controllerDollyMinDistance-.1).toFixed(1))}),W().__controls3d.minDistance=n.controllerDollyMinDistance-.1,W().__controls3d.saveState(),Yt())},children:"- 0.1"}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{Pe.setState({controllerDollyMinDistance:parseFloat((n.controllerDollyMinDistance+.1).toFixed(1))}),W().__controls3d.minDistance=n.controllerDollyMinDistance+.1,W().__controls3d.saveState(),Yt()},children:"+ 0.1"})]})]})]})}function jve(){const n=Pe();return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"sticky top-0 mb-1 ml-1 mt-1 flex border-b border-gray-700 bg-gray-800 text-yellow-500",children:["Info Alpahash",d.jsx("svg",{"data-tooltip":["Alphahash is a different type of tranparency","It will give a performance boost, but does not look as good as default with low opacity (<10%)","You can enable antialiasing to make alphahash look better.","Antialiasing can give performance issues on weak hardware. default value is 6","If you plan to use opacity over 10% and on many items you should use alphahash"].join(`
`),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:.5,stroke:"currentColor",className:"m-auto ml-2 h-3 w-3",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})})]}),d.jsxs("label",{className:"ml-2 mt-2 p-1",children:[d.jsx("input",{checked:n.enableAlphaHash,type:"checkbox",onChange:()=>{const e=!n.enableAlphaHash;bt.flushSync(()=>{Pe.setState({enableAlphaHash:e})}),Yt();const t=W().getSceneController();t.getMeshGroups().forEach(i=>{t.getMeshes(i).forEach(s=>{s.children.forEach(a=>{const l=a;l.material.opacity<1&&(l.material=Am(l.material.color,l.material.opacity,!1),l.$backupMaterial=l.material)})})}),W().forceRenderNextFrame()}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Enable Alphahash"})]}),d.jsxs("label",{className:"ml-2 mt-2 p-1",children:[d.jsx("input",{checked:n.enableAntiAliasing,type:"checkbox",onChange:()=>{Pe.setState({enableAntiAliasing:!n.enableAntiAliasing}),W().forceRenderNextFrame(),Yt()}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Enable Antialiasing (if Alphahash enabled)"})]}),d.jsxs("div",{className:"ml-2 flex flex-col p-1",children:[d.jsx("span",{className:"flex",children:"Antialiasing sampling:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"ml-2 mr-2 w-12 p-1 text-black",type:"number",step:1,value:n.enableAntiAliasingSamples,onChange:e=>{e.currentTarget.valueAsNumber>=1&&(Pe.setState({enableAntiAliasingSamples:e.currentTarget.valueAsNumber}),Yt())}}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{n.enableAntiAliasingSamples>=1&&(Pe.setState({enableAntiAliasingSamples:parseFloat((n.enableAntiAliasingSamples-1).toFixed(1))}),Yt())},children:"- 1"}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{Pe.setState({enableAntiAliasingSamples:parseFloat((n.enableAntiAliasingSamples+1).toFixed(1))}),Yt()},children:"+ 1"})]})]})]})}function Bve(){const n=Pe();return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"sticky top-0 mb-1 ml-1 mt-1 flex border-b border-gray-700 bg-gray-800 text-yellow-500",children:["Geometry Culling (preview feature)",d.jsx("svg",{"data-tooltip":["Preview feature!","Atm transformations support is limited, like occlusion culling","Tries to render less triangles. Geometry will pop inn/out more.","It can give a performance boost in many cases if its not a cad pc.","You can set distance to keep everything","You can adjust level, only affect parts outside keep distance","Occlusion culling can make it worse, so can show all when standing still","You should enable alpha hash and not Antialiasing when using this.","As additional option, you can add ?skip-alias for more performance, you need to reload page when this is added to url."].join(`
`),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:.5,stroke:"currentColor",className:"m-auto ml-2 h-3 w-3",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})})]}),d.jsxs("label",{className:"ml-2 mt-2 p-1",children:[d.jsx("input",{checked:n.enableItemCulling,type:"checkbox",onChange:async()=>{Pe.setState({enableItemCulling:!n.enableItemCulling}),Yt(),await zi(!0)}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Enable culling"})]}),d.jsxs("label",{className:"ml-2 mt-2 p-1",children:[d.jsx("input",{checked:n.occlusionCulling,type:"checkbox",onChange:async()=>{Pe.setState({occlusionCulling:!n.occlusionCulling}),W().forceRenderNextFrame(),Yt(),await zi(!0)}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Use occlusion culling"})]}),d.jsxs("label",{className:"ml-2 mt-2 p-1",children:[d.jsx("input",{checked:n.skipFustrumCulling,type:"checkbox",onChange:async()=>{Pe.setState({skipFustrumCulling:!n.skipFustrumCulling}),W().forceRenderNextFrame(),Yt(),await zi(!0)}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Skip frustum Culling"})]}),d.jsxs("div",{className:"ml-2 flex flex-col p-1",children:[d.jsx("span",{className:"flex",children:"Distance to keep:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"ml-2 mr-2 w-12 p-1 text-black",type:"number",step:1,value:n.cullingDistance,onChange:async e=>{e.currentTarget.valueAsNumber>=1&&(Pe.setState({cullingDistance:e.currentTarget.valueAsNumber}),Yt(),await zi(!0))}}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{n.cullingDistance>=1&&(Pe.setState({cullingDistance:parseInt((n.cullingDistance-1).toFixed(1))}),Yt(),await zi(!0))},children:"- 1"}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{Pe.setState({cullingDistance:parseFloat((n.cullingDistance+1).toFixed(1))}),Yt(),await zi(!0)},children:"+ 1"})]})]}),d.jsxs("div",{className:"ml-2 flex flex-col p-1",children:[d.jsx("span",{className:"flex",children:"Size level:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"ml-2 mr-2 w-12 p-1 text-black",type:"number",step:1,value:n.cullingSize,onChange:async e=>{e.currentTarget.valueAsNumber>=1&&(Pe.setState({cullingSize:e.currentTarget.valueAsNumber}),Yt(),await zi(!0))}}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{n.cullingSize>=1&&(Pe.setState({cullingSize:parseInt((n.cullingSize-1).toFixed(1))}),Yt(),await zi(!0))},children:"- 1"}),d.jsx("button",{className:"ml-2 mr-2 w-12 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{Pe.setState({cullingSize:parseFloat((n.cullingSize+1).toFixed(1))}),Yt(),await zi(!0)},children:"+ 1"})]})]})]})}function zve(){return d.jsxs("div",{className:"flex flex-1",children:[d.jsx("button",{className:"m-auto bg-indigo-600 p-1 hover:bg-indigo-700",onClick:()=>{Pe.setState({isOpen:!1})},children:"Close"}),d.jsx("div",{className:"flex-1"}),d.jsx("button",{className:"bg-gray-600 p-1 hover:bg-gray-700",onClick:async()=>{Pue()},children:"Reset all to default"})]})}function Hve(){const n=Pe();return d.jsxs(d.Fragment,{children:[d.jsxs("label",{className:"p-1","data-tooltip":["Dev tool only."].join(`
`),children:[d.jsx("input",{checked:n.isWebGlStatsActive,type:"checkbox",onChange:()=>{const e=!n.isWebGlStatsActive;Pe.setState({isWebGlStatsActive:!n.isWebGlStatsActive}),e?W().addStats():W().removeStats(),W().forceRenderNextFrame(),Yt()}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Show debugging info"})]}),d.jsxs("label",{className:"p-1","data-tooltip":["Dev tool only."].join(`
`),children:[d.jsx("input",{checked:n.freezeCurrentCulling,type:"checkbox",onChange:()=>{const e=!n.freezeCurrentCulling;Pe.setState({freezeCurrentCulling:!n.freezeCurrentCulling}),e?W().addStats():W().removeStats(),W().forceRenderNextFrame(),Yt()}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Freeze current culling"})]})]})}let Ef={height:550,width:350,bottom:200,right:0,initLoaded:!1,adjustOnLoad:!0,closed:!0};function Vve(){const n=Pe();return d.jsx(Rh,{uniqueName:"SettingsDialog",adjustOnLoad:Ef.adjustOnLoad,title:"Settings",isOpen:n.isOpen,width:Ef.width,height:Ef.height,bottom:Ef.bottom,onClose:e=>{Ef={...Ef,...e,adjustOnLoad:!1},Pe.setState({isOpen:!1})},children:d.jsxs("div",{className:"grid h-full w-full",children:[d.jsxs("div",{className:"scrollbar flex flex-col overflow-auto border-b border-gray-500",children:[d.jsx(Uve,{}),d.jsx(Kce,{}),d.jsx(Fve,{}),d.jsx(jve,{}),d.jsx(Bve,{})]}),d.jsx(Hve,{}),d.jsx(zve,{})]})})}function Gve(n){return new Worker(""+new URL("attributeStoreWorker-X2BQODUP.js",import.meta.url).href,{name:n==null?void 0:n.name})}class Wve{constructor(){Se(this,"isSearching",!1);Se(this,"nextSearch",null);Se(this,"dataStore");Se(this,"dataLoaded",!1);this.getStore()}async getStore(){if(!this.dataStore){const e=new Gve,t=Um(e);this.dataStore=await new t,await this.dataStore.initDB()||console.log("failed to init db")}return this.dataStore}async loadE3dAttributeFile(e,t,r,i,o){const a=await(await this.getStore()).loadE3dAttributeFile(e,t,r,i,o);return a!=null&&a.success&&(this.dataLoaded=!0),a}async selectData(e,t,r,i,o=!1){if(!this.dataLoaded)return console.warn("query before data is loaded"),[null,""];if(this.isSearching&&!o)return this.nextSearch=[e,t,r,i],[null,""];let s;if(this.nextSearch){const[a,l,c,u]=structuredClone(this.nextSearch);this.nextSearch=null,s=await(await this.getStore()).selectData(a,l,c,u),this.nextSearch&&(s=await this.selectData(a,l,c,u,!0))}else this.isSearching=!0,this.nextSearch=[e,t,r,i],s=await this.selectData(e,t,r,i,!0);return this.isSearching=!1,this.nextSearch=null,s}}const uw=new Wve;function fL(n){nE.delete(n)}function $ve(){const n=fl(),e="flex-1 text-center  hover:bg-gray-700 hover:text-gray-200 cursor-pointer ",t="bg-gray-800  text-gray-200 border-r hover:text-gray-200 border-gray-400 border-l border-t rounded-t mt-1 font-semibold w-28  mr-1 ml-1  text-xs border-gray-700 text-center",r="text-gray-900 bg-gray-400 mt-1 text-gray-800 rounded-t w-28 hover:text-gray-200  mr-1 ml-1  text-xs border-gray-700 text-center",i=e+(n.activeTab==="FILTER"?t:r),o=e+(n.activeTab==="SIMPLE_FILTER"?t:r),s=e+(n.activeTab==="ITEM"?t:r);return d.jsxs("div",{className:"mt-1 flex",children:[d.jsx("div",{className:s,onClick:()=>fl.setState({activeTab:"ITEM"}),children:"Item"}),d.jsx("div",{className:o,onClick:()=>fl.setState({activeTab:"SIMPLE_FILTER"}),children:"Simple filter"}),d.jsx("div",{className:i,onClick:()=>fl.setState({activeTab:"FILTER"}),children:"Custom Filter"})]})}const Yve=`
-- THIS OPTION IS VERY EARLY
-- plan was to add predefined seraches users can use        
-- This samplecode is very special since I try and link structure with correct coloring based on STLR/OWNER


-- Drop/create temp data for faster lookup
DROP TABLE IF EXISTS XYZ;
CREATE TEMPORARY TABLE XYZ(FULLNAME TEXT, OWNER TEXT, STLR TEXT, STATUSCODE TEXT);

-- INSERT DATA INTO TEMP TABLE
INSERT INTO XYZ 
    SELECT 
        a.FULLNAME,
        json_extract ( a.DATA, '$.OWNE' ) OWNER,
        json_extract ( a.DATA, '$.STLR' ) STLR,
        json_extract ( a.DATA, '$.:StatusCode' ) STATUSCODE
    FROM 
        attributes a;

WITH CTE1 AS (
    -- Structure lookup based on owner
    SELECT A.FULLNAME,
        IFnull(b.StatusCode, a.StatusCode ) StatusCode
    FROM 
        XYZ a
    Left join xyZ b 
        on 
            a.fullname = b.OWNER
), CTE2 AS (
    -- Structure lookup based on STLR
    SELECT A.FULLNAME,
        IFnull(b.StatusCode, a.StatusCode) StatusCode
    FROM 
        XYZ a
    Left join xyZ b 
        on 
            a.fullname = b.STLR
), CTE3 AS (
    -- combine result
    SELECT 
        A.FULLNAME, a.StatusCode
    FROM 
        CTE1 a 
    where 
        a.StatusCode is not null
    union all
    SELECT 
        A.FULLNAME, a.StatusCode
    FROM 
        CTE2 a
    where 
        a.StatusCode is not null
)
-- final result we set the colors
select 
    a.FULLNAME, 
    case 
    WHEN a.StatusCode like 'A1' then 
        '#CC00CC'
    WHEN a.StatusCode like 'A2' then 
        '#FF0000'
    WHEN a.StatusCode like 'B1' then 
        '#0000FF'
    WHEN a.StatusCode like 'B2' then 
        '#00FFFF'
    WHEN a.StatusCode like 'C1' then 
        '#FFFF00'
    WHEN a.StatusCode like 'C2' then 
        '#008000'
    END Aa
from 
    CTE3 a
where 
        a.StatusCode is not null`;async function sa(n,e,t,r){const i=[];let o="";for(let s=0;s<n.length;s++){if(e[s]==="ALL_FILES")continue;const[a,l]=await uw.selectData(n[s],e[s],t,r);if(l){o=l;break}a&&a.forEach(c=>i.push(c))}return[i,o]}function Kve(n){const e=fl(),[t,r]=O.useState(0),[i,o]=O.useState(""),[s,a]=O.useState(""),[l,c]=O.useState(""),[u,h]=O.useState(Yve),f=[],m=[];if(n.currentOwner==="ALL_FILES"?n.availableFiles.forEach(g=>{f.push(n.container),m.push(g.path)}):(f.push(n.container),m.push(n.selectedFile)),e.activeTab==="ITEM"){const g=Object.keys(n.contentData);return d.jsx(d.Fragment,{children:d.jsx("div",{className:"scrollbar mb-1 ml-2 mt-2 h-full w-full overflow-auto text-xs",style:{minHeight:"0px"},children:d.jsxs("table",{className:"w-full select-text",children:[d.jsx("thead",{className:"border-b border-gray-700",children:d.jsxs("tr",{children:[d.jsx("th",{className:"m-2 w-1/3 whitespace-nowrap break-keep border-r border-gray-800 pr-2 text-right text-gray-300",children:"Attribute"}),d.jsx("th",{className:"w-2/3 pl-2 text-left",children:"Value"})]})}),d.jsxs("tbody",{children:[d.jsxs("tr",{className:"border-b border-gray-800",children:[d.jsx("td",{className:"w-1/3 break-keep border-r border-gray-700 pr-2 text-right align-top text-gray-400",children:"Fullname"}),d.jsx("td",{className:"w-2/3 pl-2 text-left align-top text-white",children:n.fullname})]},-1),g.map((_,v)=>d.jsxs("tr",{className:"border-b border-gray-800",children:[d.jsx("td",{className:"w-1/3 break-keep border-r border-gray-700 pr-2 text-right align-top text-gray-400",children:_}),d.jsx("td",{className:"w-2/3 pl-2 text-left align-top text-white",children:n.contentData[_]})]},v))]})]})})})}return e.activeTab==="SIMPLE_FILTER"?d.jsx("div",{className:"flex h-full w-full flex-grow flex-col text-xs",style:{minHeight:"0px"},children:d.jsxs("div",{className:"scrollbar flex flex-grow flex-col overflow-auto p-1",children:["Contains:",d.jsxs("div",{className:"flex-1 p-2",children:[d.jsx("input",{onChange:g=>{g.currentTarget.value&&(a(g.currentTarget.value),c(`
                                        select 
                                            a.FULLNAME, 
                                            'yellow' Aa
                                        FROM 
                                            attributes a
                                        where 
                                            json_extract ( a.DATA, '$' ) like '%${g.currentTarget.value}%' or a.FULLNAME like '%${g.currentTarget.value}%'
                                    `))},value:s,className:"w-full p-1 text-black outline-none",placeholder:"something you want to find"}),d.jsx("span",{className:"text-xs text-gray-400",children:"Coloring is done on all loaded models"})]}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{bt.flushSync(()=>{ke.setState({loadingData:!0,dialogHeader:"Please wait",dialogContent:"Running query"}),o("")});const[g,_]=await sa(f,m,l,[]);if(_&&o(_),!_){const v=[];g!=null&&g.length&&g.forEach(p=>v.push(p[0])),await Ss({data:{type:"web3d-replace-selection",rows:v}})}ke.setState({loadingData:!1}),r(g!=null&&g.length?g==null?void 0:g.length:0)},children:"Set as selection"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{bt.flushSync(()=>{ke.setState({loadingData:!0,dialogHeader:"Please wait",dialogContent:"Running query"}),o("")});const g=[],_=[],[v,p]=await sa(f,m,l,[]);p&&o(p),p||(v!=null&&v.length&&v.forEach(x=>{g.push(x[0]),_.push(x[1]||"gray")}),await Ss({data:{type:"web3d-set-color",rows:g,colors:_}})),ke.setState({loadingData:!1}),r(v!=null&&v.length?v==null?void 0:v.length:0)},children:"Set yellow color"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{bt.flushSync(()=>{ke.setState({loadingData:!0,dialogHeader:"Please wait",dialogContent:"Running query"}),o("")});const[g,_]=await sa(f,m,l,[]);if(_&&o(_),!_){const v=[],p=[];g!=null&&g.length&&g.forEach(x=>{v.push(x[0]),p.push(x[1]||"gray")}),await Ss({data:{type:"web3d-set-color",rows:v,colors:p,data:"white"}})}ke.setState({loadingData:!1}),r(g!=null&&g.length?g==null?void 0:g.length:0)},children:"Set yellow color and other white"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{bt.flushSync(()=>{ke.setState({loadingData:!0,dialogHeader:"Please wait",dialogContent:"Running query"}),o("")});const[g,_]=await sa(f,m,l,[]);if(_&&o(_),!_){const v=[],p=[];g!=null&&g.length&&g.forEach(x=>{v.push(x[0]),p.push(x[1]||"gray")}),await Ss({data:{type:"web3d-set-color",rows:v,colors:p,data:"hide"}})}ke.setState({loadingData:!1}),r(g!=null&&g.length?g==null?void 0:g.length:0)},children:"Set yellow color and other hide"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{bt.flushSync(()=>{ke.setState({loadingData:!0,dialogHeader:"Please wait",dialogContent:"Running query"}),o("")});const[g,_]=await sa(f,m,l,[]);if(_&&o(_),!_){const v=[],p=[];g!=null&&g.length&&g.forEach(x=>{v.push(x[0]),p.push(x[1]||"gray")}),await Ss({data:{type:"web3d-set-color",rows:v,colors:p,data:"transparent"}})}ke.setState({loadingData:!1}),r(g!=null&&g.length?g==null?void 0:g.length:0)},children:"Set yellow color and other transparent"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{ke.setState({loadingData:!0,dialogHeader:"please wait",dialogContent:"resetting all colors"});const g=[{uuid:"na",name:"!RESET!",color:"white",operator:"Equal"}];await ae.filter_geometry([],g),await ae.selection_append(),W().forceRenderNextFrame(),await ae.selection_clear(!1),Pt.getState().updateToggel(),ke.setState({loadingData:!1,dialogHeader:"please wait",dialogContent:"resetting all colors"})},children:"Reset colors on not hidden"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{ke.setState({loadingData:!0,dialogHeader:"please wait",dialogContent:"resetting all colors"}),await ae.reset_all_meshes(!0,!1,!0,!0),Pt.getState().updateToggel(),ke.setState({loadingData:!1,dialogHeader:"please wait",dialogContent:"resetting all colors"})},children:"Reset all incl unhide"}),d.jsxs("div",{children:["RowsFound:",t]}),d.jsx("div",{className:"text-red-300",children:i})]})}):e.activeTab==="FILTER"?d.jsx("div",{className:"flex h-full w-full flex-grow flex-col text-xs",style:{minHeight:"0px"},children:d.jsxs("div",{className:"scrollbar flex flex-grow flex-col overflow-auto p-1",children:["SQL (SQLLITE SYNTAX):",d.jsx("div",{className:"flex-1 p-2",children:d.jsx("textarea",{onChange:g=>{h(g.currentTarget.value)},value:u,className:"utline-none h-full w-full p-1 text-black",placeholder:"sql query"})}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{bt.flushSync(()=>{ke.setState({loadingData:!0,dialogHeader:"Please wait",dialogContent:"Running query"}),o("")});const[g,_]=await sa(f,m,u,[]);if(_&&o(_),!_){const v=[];g!=null&&g.length&&g.forEach(p=>v.push(p[0])),await Ss({data:{type:"web3d-replace-selection",rows:v}})}ke.setState({loadingData:!1}),r(g!=null&&g.length?g==null?void 0:g.length:0)},children:"Set as selection"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{bt.flushSync(()=>{ke.setState({loadingData:!0,dialogHeader:"Please wait",dialogContent:"Running query"}),o("")});const[g,_]=await sa(f,m,u,[]);if(_&&o(_),!_){const v=[],p=[];g!=null&&g.length&&g.forEach(x=>{v.push(x[0]),p.push(x[1]||"gray")}),await Ss({data:{type:"web3d-set-color",rows:v,colors:p}})}ke.setState({loadingData:!1}),r(g!=null&&g.length?g==null?void 0:g.length:0)},children:"Set color (gray default)"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{bt.flushSync(()=>{ke.setState({loadingData:!0,dialogHeader:"Please wait",dialogContent:"Running query"}),o("")});const[g,_]=await sa(f,m,u,[]);if(_&&o(_),!_){const v=[],p=[];g!=null&&g.length&&g.forEach(x=>{v.push(x[0]),p.push(x[1]||"gray")}),await Ss({data:{type:"web3d-set-color",rows:v,colors:p,data:"white"}})}ke.setState({loadingData:!1}),r(g!=null&&g.length?g==null?void 0:g.length:0)},children:"Set color (gray default) and other white"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{bt.flushSync(()=>{ke.setState({loadingData:!0,dialogHeader:"Please wait",dialogContent:"Running query"}),o("")});const[g,_]=await sa(f,m,u,[]);if(_&&o(_),!_){const v=[],p=[];g!=null&&g.length&&g.forEach(x=>{v.push(x[0]),p.push(x[1]||"gray")}),await Ss({data:{type:"web3d-set-color",rows:v,colors:p,data:"hide"}})}ke.setState({loadingData:!1}),r(g!=null&&g.length?g==null?void 0:g.length:0)},children:"Set color (gray default) and other hide"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{bt.flushSync(()=>{ke.setState({loadingData:!0,dialogHeader:"Please wait",dialogContent:"Running query"}),o("")});const[g,_]=await sa(f,m,u,[]);if(_&&o(_),!_){const v=[],p=[];g!=null&&g.length&&g.forEach(x=>{v.push(x[0]),p.push(x[1]||"gray")}),await Ss({data:{type:"web3d-set-color",rows:v,colors:p,data:"transparent"}})}ke.setState({loadingData:!1}),r(g!=null&&g.length?g==null?void 0:g.length:0)},children:"Set color (gray default) and other transparent"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{ke.setState({loadingData:!0,dialogHeader:"please wait",dialogContent:"resetting all colors"});const g=[{uuid:"na",name:"!RESET!",color:"white",operator:"Equal"}];await ae.filter_geometry([],g),await ae.selection_append(),W().forceRenderNextFrame(),await ae.selection_clear(!1),Pt.getState().updateToggel(),ke.setState({loadingData:!1,dialogHeader:"please wait",dialogContent:"resetting all colors"})},children:"Reset colors on not hidden"}),d.jsx("button",{className:"m-1 bg-indigo-600 p-1 hover:bg-indigo-700",onClick:async()=>{ke.setState({loadingData:!0,dialogHeader:"please wait",dialogContent:"resetting all colors"}),await ae.reset_all_meshes(!0,!1,!0,!0),Pt.getState().updateToggel(),ke.setState({loadingData:!1,dialogHeader:"please wait",dialogContent:"resetting all colors"})},children:"Reset all incl unhide"}),d.jsxs("div",{children:["RowsFound:",t]}),d.jsx("div",{className:"text-red-300",children:i})]})}):null}function Xve(){var y;const[n,e]=O.useState({}),[t,r]=O.useState(""),[i,o]=O.useState(""),[s,a]=O.useState(!1),[l,c]=O.useState("Loading data, please wait."),[u,h]=O.useState(""),[f,m]=O.useState(""),[g,_]=O.useState(""),[v,p]=O.useState(null),x=Re();if(O.useEffect(()=>{const w={handleEvent(C){var R;if(s||!C||!Array.isArray(C==null?void 0:C.parents)||((R=C.parents)==null?void 0:R.length)===0)return;const T=C.parents[C.parents.length-1],S=v==null?void 0:v.filter(E=>E.owner===T)[0];return!S&&f!=="ALL_FILES"?(e({info:"Not part of this attribute root:","Selected Root:":S}),!0):(uw.selectData(u,(S==null?void 0:S.path)||"x","select json(data) from attributes where fullname = ? limit 1",[C.fullname]).then(E=>{var A;E!=null&&E.length&&((A=E[0])!=null&&A.length)?e(JSON.parse(E[0])):e(E===null?{info:"In queue, please wait until prev search is done"}:{info:"Nothing found"})}),bt.flushSync(()=>{o(C.fullname||""),e({info:"Loading"})}),!0)}};return F1(w),()=>{fL(w)}},[u,g,s]),s)return d.jsx("div",{className:"p-2",children:l});if(!x.selectedLayer)return d.jsx("div",{className:"p-2",children:"No project layer selected, please open project selector and try again."});if(!v){const w=[];return(y=x.selectedProject)==null||y.model_data.forEach(C=>{Array.isArray(C.attributes)&&C.attributes.forEach(T=>{C.container_override?w.push(Object.assign({owner:C.name,container_override:C.container_override},T)):w.push(Object.assign({owner:C.name},T))})}),w.length>1&&w.push({owner:"ALL_FILES",path:"ALL_FILES",type:"ALL_FILES",name:"ALL_FILES"}),p(w),null}if(!g){const w="Select an option";return d.jsxs("div",{className:"m-auto mt-5 flex flex-col",children:[d.jsx("span",{className:"m-auto p-1",children:"Select file"}),d.jsxs("select",{defaultValue:w,onChange:async C=>{a(!0);const T=Re.getState().selectedProject,S=(T==null?void 0:T.container)||"NOT_SET",b=v[C.currentTarget.selectedIndex-1].path,R=v[C.currentTarget.selectedIndex-1].owner,E=v[C.currentTarget.selectedIndex-1].container_override||S;if(_(b),m(R),h(S),R!=="ALL_FILES")Ll(E).then(async A=>{const F=`${S}${b}`;await navigator.locks.request(F,{ifAvailable:!0},async D=>{var z;if(!D){a(!1),o(`Some other tab is allready doing this work.
Please wait and open/close this dialog when its done.`);return}const M=er(),k=new BroadcastChannel(M);k.onmessage=P=>{console.log(),bt.flushSync(()=>{c(P.data)})},await uw.loadE3dAttributeFile(((z=A.data)==null?void 0:z.token)||"no access",S,E,b,M).then(P=>{k.close(),a(!1),P!=null&&P.success?o(P==null?void 0:P.msg):(_(""),r((P==null?void 0:P.msg)||"Unknonw error"))}).catch(()=>{k.close(),a(!1),_(""),r("unexpected error")})})});else{let A=0;for(let F=0;F<v.length&&!A;F++){const D=v[F].name,M=v[F].path,k=v[F].owner,z=v[F].container_override||S;if(k==="ALL_FILES")continue;const P=await Ll(z),U=`${S}${M}`;await navigator.locks.request(U,{ifAvailable:!0},async Y=>{var X;if(!Y){A=1,o(`Some other tab is allready doing this work.
Please wait and open/close this dialog when its done.`);return}const Z=er(),j=new BroadcastChannel(Z);j.onmessage=B=>{console.log(),bt.flushSync(()=>{c(`${D}:${B.data}`)})},await uw.loadE3dAttributeFile(((X=P.data)==null?void 0:X.token)||"no access",S,z,M,Z).then(B=>{j.close(),B!=null&&B.success?o("All loaded"):r((B==null?void 0:B.msg)||"Unknonw error")}).catch(()=>{j.close(),a(!1),r("unexpected error")})})}a(!1)}},className:"cursor-pointer bg-transparent text-xs text-orange-400 hover:text-orange-300",children:[d.jsx("option",{className:"bg-gray-800 p-1",disabled:!0,children:w}),v.map(C=>d.jsx("option",{className:"bg-gray-800 p-1",children:C.name},C.path))]}),d.jsx("div",{className:"m-auto mt-3 text-red-500",children:t})]})}return d.jsxs("div",{className:"flex h-full w-full flex-grow flex-col",children:[d.jsx("div",{className:"m-auto text-yellow-400",children:f}),d.jsx($ve,{}),d.jsx("div",{className:"flex h-full w-full flex-grow flex-col",style:{minHeight:"0px"},children:d.jsx(Kve,{fullname:i,contentData:n,container:u,selectedFile:g,availableFiles:v,currentOwner:f})})]})}let Tf={height:550,width:350,bottom:200,right:0,initLoaded:!1,adjustOnLoad:!0,closed:!0};function qve(){const n=fl();return d.jsx(Rh,{uniqueName:"AttributeDialog",adjustOnLoad:Tf.adjustOnLoad,title:"Attribute Viewer",isOpen:n.isOpen,width:Tf.width,height:Tf.height,bottom:Tf.bottom,onClose:e=>{Tf={...Tf,...e,adjustOnLoad:!1},fl.setState({isOpen:!1})},children:d.jsx(Xve,{})})}function Qve(){return d.jsx("iframe",{id:"externalFrame",className:"h-full w-full",src:window.useUrl})}function j2(){var t,r;const n=Fn();if(!n.activated)return null;let e=n.message;return typeof n.message!="string"&&(e=(t=n.message)==null?void 0:t.message,typeof((r=n.message)==null?void 0:r.message)!="string"&&(e="unknown, see console",console.log(n.message))),d.jsx("div",{className:"fadeIn fixed z-[8010] grid h-full w-full items-center justify-center bg-gray-50/50",children:d.jsxs("div",{className:"flex h-80 w-[550px] flex-col bg-gray-800",children:[d.jsx("div",{className:"block w-full bg-gray-700 p-2 text-center text-2xl text-white",children:"Error"}),d.jsx("div",{className:"m-auto block w-full text-center font-semibold text-white underline",children:n.header||"Error"}),d.jsx("div",{className:"scrollbar m-auto mt-4 block flex-1 overflow-auto whitespace-pre-line p-1 text-center text-white",children:e}),d.jsx("div",{className:"left-0 right-0 m-2",children:d.jsx("button",{className:"m-auto block w-28 bg-gray-600 p-2 hover:bg-gray-700",onClick:()=>n.deactivate(),children:"Close"})})]})})}const Zve=localStorage.getItem("web3d-hide-mouse-and-keyboard-page")||"1",Jve=!!localStorage.getItem("web3d-hide-mouse-and-keyboard-keys"),C_=mr(n=>({currentPage:parseInt(Zve),isVisible:!Jve,toggleVisibility:()=>{n(e=>{const t=!e.isVisible;return localStorage.setItem("web3d-hide-mouse-and-keyboard-keys",t?"0":"1"),{isVisible:t}})},gotoPrevPage:()=>{n(e=>({currentPage:e.currentPage-1}))},gotoNextPage:()=>{n(e=>({currentPage:e.currentPage+1}))}}));function Zg(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-12 w-12","data-tooltip":"Show navigation and shortcuts",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})})}let ks=null,Q4=[],Kv=[],EE=[];const Z4={handleEvent:async n=>{if(Array.isArray(n==null?void 0:n.parentKeys)&&Array.isArray(n==null?void 0:n.parents)){const e=structuredClone(n.parents),t=structuredClone(n.parentKeys);e.shift(),t.shift(),EE=[],Q4=e,Q4.reverse(),Kv=t,Kv.reverse(),ks=n.key}return!0}};async function X1(){if(Kv.length&&(ks&&EE.push(ks),ks=Kv.pop(),ks)){const n=ks;await ae.treeview_expand_from_id(n),await ae.selection_add([n]);const e=await ae.getKeyChildrenFromItem(n);await ae.selection_add(e),await ae.selection_append();const t=await ae.getRowOfKey(n);Pt.getState().updateToggel(t)}}async function q1(){if(EE.length&&(ks&&Kv.push(ks),ks=EE.pop(),ks)){const n=ks;await ae.selection_clear(!1),await ae.treeview_expand_from_id(n),await ae.selection_add([n]);const e=await ae.getKeyChildrenFromItem(n);await ae.selection_add(e),await ae.selection_append();const t=await ae.getRowOfKey(n);Pt.getState().updateToggel(t)}}function pn(n){return d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:n.classOveride?n.classOveride:"m-auto h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[d.jsx("path",{x:"4.8929076",y:"3.2340963",width:"14.940843",height:"13.955923",d:"m6.4804 3.2341h11.766a1.5875 1.5875 45 0 1 1.5875 1.5875v10.781a1.5875 1.5875 135 0 1-1.5875 1.5875h-11.766a1.5875 1.5875 45 0 1-1.5875-1.5875v-10.781a1.5875 1.5875 135 0 1 1.5875-1.5875z",fillOpacity:"0",strokeWidth:".78334"}),d.jsx("path",{x:"2.2201288",y:"3.2309675",width:"20.079046",height:"16.709587",d:"m4.9999 3.231h14.364a2.9353 2.9353 45 0 1 2.9353 2.9353v12.187a1.5875 1.5875 135 0 1-1.5875 1.5875h-16.904a1.5875 1.5875 45 0 1-1.5875-1.5875v-12.342a2.7798 2.7798 135 0 1 2.7798-2.7798z",fillOpacity:"0",strokeWidth:".78334"}),d.jsxs("g",{fill:"none",children:[d.jsx("path",{d:"m2.3535 18.798s2.5503-2.8137 2.5503-2.8137",strokeWidth:".67939"}),d.jsx("path",{d:"m4.0104 19.787 1.7106-2.6956",strokeWidth:".62362"}),d.jsx("path",{d:"m20.967 19.866s-1.9155-2.978-1.9155-2.978",strokeWidth:".69575"}),d.jsx("path",{d:"m22.496 18.647s-2.5894-2.7447-2.5894-2.7447",strokeWidth:".69575"})]}),d.jsx("text",{transform:n.scale?n.scale:"scale(1.0338 .96735)",x:"6.8110447",y:"15.365105",fill:"#000000",fontFamily:"sans-serif",fontSize:n.fontSize?n.fontSize:"13.986px",letterSpacing:"0px",strokeWidth:".75591",wordSpacing:"0px",style:{lineHeight:"1.25"},children:d.jsx("tspan",{x:n.positionX||"6.8110447",y:n.positionY||"15.365105",strokeWidth:".75591",children:n.letters})})]})}function fy(n){let e;switch(n.button){case"LEFT":e="m4.9505 10.791c0-0.77873 0.018619-1.0235 0.10293-1.3532 0.28209-1.103 1.1198-2.0034 2.4623-2.6465 1.0804-0.51761 2.2209-0.80166 3.746-0.93301l0.37582-0.032367v2.6935l-0.24623 0.08212c-0.33049 0.11022-0.72749 0.41811-0.93257 0.72325-0.28884 0.42975-0.37633 0.81819-0.37633 1.6707v0.74619h-5.1319z";break;case"MIDDLE":e="m11.728 15.521c-0.42319-0.0997-0.666-0.27645-0.84827-0.61749-0.08924-0.16698-0.09829-0.34746-0.11357-2.2654-0.01417-1.7784-0.0044-2.1314 0.06629-2.4075 0.16536-0.64548 0.61869-1.027 1.2203-1.027 0.52612 0 0.949 0.30146 1.1404 0.81292 0.09786 0.26156 0.10374 0.40371 0.10374 2.5064 0 2.1234-0.0049 2.2387-0.1032 2.4314-0.13827 0.27104-0.3812 0.44644-0.75208 0.54304-0.33882 0.08825-0.42668 0.09115-0.71362 0.02354z";break;case"RIGHT":e="m14.011 10.925c-0.018954-0.65138-0.045312-0.87585-0.13037-1.1103-0.26365-0.72659-0.74158-1.1345-1.5363-1.3111l-0.14881-0.033076 0.0212-1.2911c0.01166-0.71008 0.03796-1.3078 0.05845-1.3283 0.04987-0.049874 1.3389 0.059588 1.9545 0.16597 1.2629 0.21824 2.6644 0.78055 3.4472 1.3831 0.46706 0.3595 0.92155 0.90147 1.1409 1.3605 0.26048 0.54511 0.33648 1.0129 0.33648 2.0713v0.90935h-5.1196z"}return d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-auto h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[d.jsx("path",{d:"m4.6667 10.221c0.040204-6.1879 14.812-6.2467 14.759 0l0.04556 9.5202c0.01204 4.996-14.778 4.9417-14.759 0z",strokeWidth:"1"}),d.jsx("path",{d:"m10.419 10.676c0.0088-2.4465 3.2566-2.4698 3.245 0l0.01007 3.764c0.0027 1.9753-3.2491 1.9538-3.245 0z",strokeWidth:"1"}),d.jsxs("g",{fill:"none",strokeWidth:"1",children:[d.jsx("path",{d:"m13.651 12.023h4.652 0.95459"}),d.jsx("path",{d:"m4.6043 12.049h4.652 0.95459"}),d.jsx("path",{d:"m11.931 8.7892c0-1.212 0-2.424 0.02857-3.2023s0.08571-1.1229 0.52147-1.4616c0.43576-0.33868 1.2501-0.67138 1.7001-1.2893 0.45-0.61787 0.53572-1.5209 0.62144-2.424"})]}),d.jsx("path",{d:"m14.043 10.224c-0.017761-0.48347-0.036822-0.61315-0.11574-0.78413-0.19741-0.42763-0.77375-0.79211-1.4064-0.88943l-0.26787-0.041187v-2.6966h0.2467c0.13568 0 0.49605 0.024401 0.8008 0.053903 2.4936 0.24262 4.4514 1.1749 5.2989 2.5234 0.37392 0.59495 0.51107 1.1001 0.51107 1.8826v0.53078h-5.0462z",strokeWidth:"0"}),d.jsx("g",{fill:"#6CF10A",strokeWidth:"0",children:d.jsx("path",{d:e})})]})}function e_e(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("text",{transform:"scale(1.0338 .96735)",x:"6.8110447",y:"15.365105",fill:"#000000",fontFamily:"sans-serif",fontSize:"13.986px",letterSpacing:"0px",strokeWidth:".75591",wordSpacing:"0px",style:{lineHeight:"1.25"},children:d.jsx("tspan",{x:"6.8110447",y:"15.365105",strokeWidth:".75591",children:"+"})})})}function t_e(){const n=C_();return d.jsx("div",{className:"text-white-400 pointer-events-none fixed bottom-0 left-0 right-0 z-50 select-none",children:d.jsx("div",{className:"flex",children:d.jsxs("div",{className:"pointer-events-auto m-auto flex flex-col",children:[d.jsxs("div",{className:"m-1 flex",children:[d.jsx("div",{className:"flex-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.toggleVisibility()}}),d.jsx("div",{className:"flex flex-1 flex-col items-end",children:d.jsx("div",{className:"cursor-pointer bg-gray-800/90 p-1 text-gray-200 hover:text-gray-300",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.gotoNextPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062A1.125 1.125 0 013 16.81V8.688zM12.75 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062a1.125 1.125 0 01-1.683-.977V8.688z"})})})})]}),d.jsxs("div",{className:"mb-2 flex bg-gray-800/90 p-1",children:[d.jsxs("div",{className:"ml-3 mr-3 flex w-48 flex-1 flex-col",children:[d.jsx(fy,{button:"LEFT"}),d.jsx("div",{className:"m-auto",children:"Rotate"})]}),d.jsxs("div",{className:"ml-3 mr-3 flex w-48 flex-1 flex-col",children:[d.jsx(fy,{button:"MIDDLE"}),d.jsx("div",{className:"m-auto",children:"Move to mousepointer"})]}),d.jsxs("div",{className:"ml-3 mr-3 flex w-48 flex-1 flex-col",children:[d.jsx(fy,{button:"RIGHT"}),d.jsx("div",{className:"m-auto",children:"Pan"})]})]}),d.jsxs("div",{className:"mb-2 flex bg-gray-800/90 p-1",children:[d.jsxs("div",{className:"w-42 ml-2 mr-2 flex flex-1 flex-col","data-tooltip":"Sets focus point for rotation",children:[d.jsxs("div",{className:"flex",children:[d.jsx(pn,{letters:"ALT",positionY:"12.5",positionX:"6.2",fontSize:"6px"}),d.jsx(e_e,{}),d.jsx(fy,{button:"LEFT"})]}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Set focus point"})})})]}),d.jsxs("div",{className:"ml-3 mr-3 flex w-48 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation(),X1()},"data-tooltip":"Sets selection in treeview to parent element",children:[d.jsx(pn,{letters:"U"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Up lvl (tree)"})})})]}),d.jsxs("div",{className:"ml-3 mr-3 flex w-48 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation(),q1()},"data-tooltip":"Sets selection in treeview back to previous",children:[d.jsx(pn,{letters:"P"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Prev lvl (tree)"})})})]})]}),d.jsx("div",{className:"mb-2 flex bg-gray-800/90 p-1 text-yellow-500",children:d.jsx("div",{className:"m-auto",children:"When you close this helper you can open it again with icon in top right cornor."})})]})})})}function n_e(){const n=C_();return d.jsx("div",{className:"text-white-400 pointer-events-none fixed bottom-0 left-0 right-0 z-50 select-none",children:d.jsx("div",{className:"flex",children:d.jsxs("div",{className:"pointer-events-auto m-auto flex flex-col",children:[d.jsxs("div",{className:"m-1 flex",children:[d.jsx("div",{className:"flex flex-1 flex-col items-start",children:d.jsx("div",{className:"cursor-pointer bg-gray-800/90 p-1 text-gray-200 hover:text-gray-300",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.gotoPrevPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953l7.108-4.062A1.125 1.125 0 0121 8.688v8.123zM11.25 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953L9.567 7.71a1.125 1.125 0 011.683.977v8.123z"})})})}),d.jsx("div",{className:"flex flex-1 flex-col items-end",children:d.jsx("div",{className:"cursor-pointer bg-gray-800/90 p-1 text-gray-200 hover:text-gray-300",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.gotoNextPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062A1.125 1.125 0 013 16.81V8.688zM12.75 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062a1.125 1.125 0 01-1.683-.977V8.688z"})})})})]}),d.jsxs("div",{className:"mb-2 flex bg-gray-800/90 p-1",children:[d.jsxs("div",{className:"ml-3 mr-3 flex w-48 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(pn,{letters:"Q"}),d.jsx("div",{className:"m-auto whitespace-nowrap",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:"Move up"})]}),d.jsxs("div",{className:"ml-3 mr-3 flex w-48 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(pn,{letters:"W",positionX:"5.3"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move forward"})]}),d.jsxs("div",{className:"ml-3 mr-3 flex w-48 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(pn,{letters:"E"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move down"})]})]}),d.jsxs("div",{className:"mb-2 flex bg-gray-800/90 p-1",children:[d.jsxs("div",{className:"ml-3 mr-3 flex w-48 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(pn,{letters:"A"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move left"})]}),d.jsxs("div",{className:"ml-3 mr-3 flex w-48 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(pn,{letters:"S"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move backwards"})]}),d.jsxs("div",{className:"ml-3 mr-3 flex w-48 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(pn,{letters:"D"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move right"})]})]}),d.jsx("div",{className:"mb-2 flex bg-gray-800/90 p-1 text-yellow-500",children:d.jsx("div",{className:"m-auto",children:"User mouse wheel to exit firstperson view, holding space will set it into FLY mode"})})]})})})}function pL(){W().getActiveControls().smoothTime=.5,W().getActiveControls().saveState(),W().setOrbitOn().then(()=>{W().getActiveControls().smoothTime=1,W().getActiveControls().saveState()})}function r_e(){const n=C_();return d.jsx("div",{className:"text-white-400 pointer-events-none fixed bottom-0 left-0 right-0 z-50 select-none",children:d.jsx("div",{className:"flex",children:d.jsxs("div",{className:"pointer-events-auto m-auto flex flex-col",children:[d.jsxs("div",{className:"m-1 flex",children:[d.jsx("div",{className:"flex flex-1 flex-col items-start",children:d.jsx("div",{className:"cursor-pointer bg-gray-800/90 p-1 text-gray-200 hover:text-gray-300",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.gotoPrevPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953l7.108-4.062A1.125 1.125 0 0121 8.688v8.123zM11.25 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953L9.567 7.71a1.125 1.125 0 011.683.977v8.123z"})})})}),d.jsx("div",{className:"flex flex-1 flex-col items-end",children:d.jsx("div",{className:"cursor-pointer bg-gray-800/90 p-1 text-gray-200 hover:text-gray-300",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.gotoNextPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062A1.125 1.125 0 013 16.81V8.688zM12.75 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062a1.125 1.125 0 01-1.683-.977V8.688z"})})})})]}),d.jsxs("div",{className:"mb-2 flex bg-gray-800/90 p-1",children:[d.jsxs("div",{className:"w-42 mr-1 flex flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation(),U1()},"data-tooltip":"Hides selected",children:[d.jsx(pn,{letters:"H",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Hide"})})]}),d.jsxs("div",{className:"w-42 ml-1 flex flex-1 flex-col",onPointerUp:()=>{},onPointerDown:e=>{e.preventDefault(),e.stopPropagation(),qk()},"data-tooltip":"Reset color on selected",children:[d.jsx(pn,{letters:"R",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Reset"})})})]}),d.jsxs("div",{className:"w-42 ml-1 flex flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation(),Xk()},"data-tooltip":"Unhides all",children:[d.jsx(pn,{letters:"K",positionX:"7",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Unhide all "})})})]}),d.jsxs("div",{className:"w-42 flex flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation(),Qk()},"data-tooltip":"Inverts selection",children:[d.jsx(pn,{letters:"I",positionX:"10",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Invert"})})})]}),d.jsxs("div",{className:"ml-1 mr-1 flex w-32 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation(),X1()},"data-tooltip":"Move up to parent in treeview",children:[d.jsx(pn,{letters:"U",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Up Lvl (tree)"})})})]}),d.jsxs("div",{className:"ml-1 mr-1 flex w-32 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation(),q1()},"data-tooltip":"Move down to previous selected",children:[d.jsx(pn,{letters:"P",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Prev Lvl (tree)"})})})]}),d.jsxs("div",{className:"ml-1 mr-1 flex w-32 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation(),r_()},"data-tooltip":"Go to last clicked point in model",children:[d.jsx(pn,{letters:"G",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Go to point"})})})]}),d.jsxs("div",{className:"ml-1 mr-1 flex w-32 flex-1 flex-col",onClick:e=>{e.preventDefault(),e.stopPropagation(),pL()},"data-tooltip":"Set last clicked point in model as focus point for rotation",children:[d.jsx(pn,{letters:"O",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Orbit point"})})})]})]}),d.jsx("div",{className:"mb-2 flex bg-gray-800/90 p-1 text-yellow-500",children:d.jsx("div",{className:"m-auto",children:"Selection actions"})})]})})})}function i_e(){const[n,e]=O.useState(!1),[t,r]=O.useState(!1),i=C_(),o=O.useRef(null),s=O.useRef(null),a=O.useRef(null),l=O.useRef(null),c=O.useRef(null),u=O.useRef(null),h=` flex flex-1 flex-col w-42 mr-2 ml-2 pointer-events-auto ${n?" text-yellow-400 ":""}`;return O.useEffect(()=>{const f=new df(o.current),m=new df(s.current),g=new df(a.current),_=new df(l.current),v=new df(c.current),p=new df(u.current),x=()=>{Ju()},y=R=>{const E=W();if(n){const A=.02*R.deltaTime;E.__controls3d.dollyInFixed(A,!1)}else{const A=.002*R.deltaTime;E.__controls3d.dollyInFixed(A,!1)}E.forceRenderNextFrame()},w=R=>{const E=W(),A=.002*R.deltaTime;E.__controls3d.dollyInFixed(-A,!1),E.forceRenderNextFrame()},C=R=>{const E=W(),A=.002*R.deltaTime;E.__controls3d.truck(-A,0,!1)},T=R=>{const E=W(),A=.002*R.deltaTime;E.__controls3d.truck(A,0,!1)},S=R=>{const E=W(),A=.002*R.deltaTime;E.__controls3d.elevate(+A,!1)},b=R=>{const E=W(),A=.002*R.deltaTime;E.__controls3d.elevate(-A,!1)};return f.addEventListener(Lt.HOLD_START,x),f.addEventListener(Lt.HOLDING,y),m.addEventListener(Lt.HOLD_START,x),m.addEventListener(Lt.HOLDING,w),g.addEventListener(Lt.HOLD_START,x),g.addEventListener(Lt.HOLDING,C),_.addEventListener(Lt.HOLD_START,x),_.addEventListener(Lt.HOLDING,T),v.addEventListener(Lt.HOLD_START,x),v.addEventListener(Lt.HOLDING,S),p.addEventListener(Lt.HOLD_START,x),p.addEventListener(Lt.HOLDING,b),()=>{f.removeEventListener(Lt.HOLD_START,x),f.removeEventListener(Lt.HOLDING,y),m.removeEventListener(Lt.HOLD_START,x),m.removeEventListener(Lt.HOLDING,w),g.removeEventListener(Lt.HOLD_START,x),g.removeEventListener(Lt.HOLDING,C),_.removeEventListener(Lt.HOLD_START,x),_.removeEventListener(Lt.HOLDING,T),v.removeEventListener(Lt.HOLD_START,x),v.removeEventListener(Lt.HOLDING,S),p.removeEventListener(Lt.HOLD_START,x),p.removeEventListener(Lt.HOLDING,b)}},[t,o,s,a,l,c,u,n]),d.jsx("div",{className:"text-white-400 pointer-events-none fixed bottom-0 left-0 right-0 z-50 select-none",children:d.jsx("div",{className:"pointer-events-none flex select-none",children:d.jsxs("div",{className:"pointer-events-none flex w-full flex-col",children:[d.jsxs("div",{className:"pointer-events-none m-1 flex",children:[d.jsx("div",{className:"pointer-events-auto flex flex-1 flex-col items-start",children:d.jsx("div",{className:"cursor-pointer bg-gray-800/90 p-1 text-gray-200 hover:text-gray-300",onClick:f=>{f.preventDefault(),f.stopPropagation(),i.gotoPrevPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953l7.108-4.062A1.125 1.125 0 0121 8.688v8.123zM11.25 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953L9.567 7.71a1.125 1.125 0 011.683.977v8.123z"})})})}),d.jsx("div",{className:"pointer-events-none flex-1 select-none"})]}),d.jsxs("div",{className:"pointer-events-none flex",children:[d.jsxs("div",{children:[d.jsxs("div",{className:"mb-2 flex bg-gray-800/90",children:[d.jsxs("div",{className:"pointer-events-auto ml-2 mr-2 flex w-32 flex-1 flex-col",ref:c,onPointerCancel:()=>{r(!t)},onClick:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(pn,{letters:"Q"}),d.jsx("div",{className:"m-auto whitespace-nowrap",onClick:f=>{f.preventDefault(),f.stopPropagation()},children:"Move up"})]}),d.jsxs("div",{className:"pointer-events-auto ml-2 mr-2 flex w-32 flex-col",ref:o,onPointerCancel:()=>{r(!t)},onPointerDown:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(pn,{letters:"W",positionX:"5.3"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Forward"})]}),d.jsxs("div",{className:"pointer-events-auto ml-2 mr-2 flex w-32 flex-1 flex-col",ref:u,onPointerCancel:()=>{r(!t)},onClick:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(pn,{letters:"E"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move down"})]})]}),d.jsxs("div",{className:"mb-2 flex bg-gray-800/90",children:[d.jsxs("div",{className:"pointer-events-auto ml-2 mr-2 flex w-32 flex-col",ref:a,onPointerCancel:()=>{r(!t)},onClick:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(pn,{letters:"A"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move left"})]}),d.jsxs("div",{className:"pointer-events-auto ml-2 mr-2 flex w-32 flex-1 flex-col",ref:s,onPointerCancel:()=>{r(!t)},onClick:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(pn,{letters:"S"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move backwards"})]}),d.jsxs("div",{className:"pointer-events-auto ml-2 mr-2 flex w-32 flex-1 flex-col",ref:l,onPointerCancel:()=>{r(!t)},onClick:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(pn,{letters:"D"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move right"})]})]})]}),d.jsx("div",{className:"pointer-events-none flex-1"}),d.jsxs("div",{children:[d.jsxs("div",{className:"pointer-events-auto mb-2 flex bg-gray-800/90",children:[d.jsxs("div",{className:h,onClick:f=>{f.preventDefault(),f.stopPropagation(),e(!n)},"data-tooltip":"Turbo mode forward",children:[d.jsx(pn,{letters:"T",positionX:"7",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Turbo mode"})})})]}),d.jsxs("div",{className:"pointer-events-auto ml-2 mr-2 flex w-32 flex-1 flex-col",onClick:f=>{f.preventDefault(),f.stopPropagation(),r_()},"data-tooltip":"Go to last clicked point in model",children:[d.jsx(pn,{letters:"G",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Go to point"})})})]}),d.jsxs("div",{className:"pointer-events-auto ml-2 mr-2 flex w-32 flex-1 flex-col",onClick:f=>{f.preventDefault(),f.stopPropagation(),X1()},"data-tooltip":"Move up to parent in treeview",children:[d.jsx(pn,{letters:"U",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Up Lvl (tree)"})})})]})]}),d.jsxs("div",{className:"mb-2 flex flex-row-reverse bg-gray-800/90",children:[d.jsxs("div",{className:"pointer-events-auto ml-2 mr-2 flex w-32 flex-1 flex-col",onClick:f=>{f.preventDefault(),f.stopPropagation(),q1()},"data-tooltip":"Move down to previous selected",children:[d.jsx(pn,{letters:"P",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Prev Lvl (tree)"})})})]}),d.jsxs("div",{className:"pointer-events-auto ml-2 mr-2 flex w-32 flex-1 flex-col",onClick:f=>{f.preventDefault(),f.stopPropagation(),pL()},"data-tooltip":"Set last clicked point in model as focus point for rotation",children:[d.jsx(pn,{letters:"O",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Orbit point"})})})]}),d.jsxs("div",{className:"pointer-events-auto ml-2 mr-2 flex w-32 flex-1 flex-col",onClick:f=>{f.preventDefault(),f.stopPropagation(),U1()},"data-tooltip":`Sets selected to 10% opacity. Opacity 10% or lower is not selectable by default.
To select transparent 10% or less HOLD shift key down.`,children:[d.jsx(pn,{letters:"H",positionX:"7",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Hide "})})})]})]})]})]}),d.jsx("div",{className:"mb-2 flex bg-gray-800/90 p-1 text-yellow-500",children:d.jsx("div",{className:"m-auto",children:"Helpers for touch screen"})})]})})})}function o_e(){const n=C_();return n.isVisible?n.currentPage===2?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed right-0 top-0 z-50",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"m-1 flex",children:d.jsx("div",{className:"cursor-pointer p-1 text-gray-200 hover:text-gray-300",onClick:()=>{n.toggleVisibility()},children:d.jsx(Zg,{})})})})}),d.jsx(n_e,{})]}):n.currentPage===3?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed right-0 top-0 z-50",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"m-1 flex",children:d.jsx("div",{className:"cursor-pointer p-1 text-gray-200 hover:text-gray-300",onClick:()=>{n.toggleVisibility()},children:d.jsx(Zg,{})})})})}),d.jsx(r_e,{})]}):n.currentPage===4?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed right-0 top-0 z-50",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"m-1 flex",children:d.jsx("div",{className:"cursor-pointer p-1 text-gray-200 hover:text-gray-300",onClick:()=>{n.toggleVisibility()},children:d.jsx(Zg,{})})})})}),d.jsx(i_e,{})]}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed right-0 top-0 z-50",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"m-1 flex",children:d.jsx("div",{className:"cursor-pointer p-1 text-gray-200 hover:text-gray-300",onClick:()=>{n.toggleVisibility()},children:d.jsx(Zg,{})})})})}),d.jsx(t_e,{})]}):d.jsx("div",{className:"fixed right-0 top-0 z-50",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"m-1 flex",children:d.jsx("div",{className:"cursor-pointer p-1 text-gray-200 hover:text-gray-300",onClick:()=>{n.toggleVisibility()},children:d.jsx(Zg,{})})})})})}const s_e=()=>{const[n,e]=O.useState({x:0,y:0}),[t,r]=O.useState({show:!1,text:""});if(O.useEffect(()=>{const i=()=>{r({show:!1,text:""}),window.removeEventListener("click",i)},o=s=>{var u,h,f;s.preventDefault();let l=s.target,c=0;for(;c<5&&l;){if((u=l==null?void 0:l.dataset)!=null&&u.copyvalue&&((h=l==null?void 0:l.dataset)!=null&&h.rawValue)){r({show:!0,text:(f=l==null?void 0:l.dataset)==null?void 0:f.rawValue});break}c++,l=l==null?void 0:l.parentElement}e({x:s.clientX,y:s.clientY}),window.addEventListener("click",i)};return window.addEventListener("contextmenu",o),()=>{window.removeEventListener("contextmenu",o)}}),t.show){const i={display:t.show?"block":"none",left:n.x+"px",top:n.y+"px"};return d.jsx("div",{onClick:()=>{function o(s){var a;(a=s.clipboardData)==null||a.setData("text/plain",t.text),s.preventDefault()}document.addEventListener("copy",o),document.execCommand("copy"),document.removeEventListener("copy",o)},style:i,className:"absolute z-[9999] whitespace-pre-wrap border border-gray-900 bg-gray-700 p-1 text-xs text-white drop-shadow-lg hover:bg-gray-500 focus:outline-none",children:"Copy value"})}else return null};function a_e(){const[n,e]=O.useState(""),[t,r]=O.useState(!1),[i,o]=O.useState(!1),[s,a]=O.useState(!1),l=_c();return l.isActivated?d.jsx("div",{className:"fadeIn fixed z-[8010] grid h-full w-full items-center justify-center bg-gray-50/50",children:d.jsxs("div",{className:"relative block h-[25rem] w-96 bg-gray-800",children:[d.jsx("span",{className:"m-auto block bg-gray-700 p-2 text-center text-2xl text-white",children:"Bookmark URL"}),d.jsx("span",{className:"m-auto mt-2 block text-center font-semibold text-white underline",children:"Copy link below"}),d.jsx("span",{className:"m-auto ml-2 mr-2 mt-4 block flex-1 overflow-clip bg-gray-200 p-1 text-center text-gray-900",children:l.url}),d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("label",{className:"m-auto p-1","data-tooltip":"Displays page with simpler user interface",children:["Add Presentation Mode (pad)",d.jsx("input",{type:"checkbox",checked:t,className:"m-1",onChange:()=>{if(t){const c=l.url.replace("&presentation-mode","");_c.setState({url:c}),r(!1)}else{const c=l.url+"&presentation-mode";_c.setState({url:c}),r(!0)}}})]}),d.jsxs("label",{className:"m-auto p-1","data-tooltip":"Anti-aliasing makes 3d more clear, but at the cost of performance",children:["Add Skip Anti-aliasing",d.jsx("input",{type:"checkbox",className:"m-1",checked:i,onChange:()=>{if(i){const c=l.url.replace("&skip-alias","");_c.setState({url:c}),o(!1)}else{const c=l.url+"&skip-alias";_c.setState({url:c}),o(!0)}}})]}),d.jsxs("label",{className:"m-auto p-1","data-tooltip":"This will try and just load sites on filter, less to load, useful when very large models",children:["Use filtered sites",d.jsx("input",{type:"checkbox",className:"m-1",checked:s,onChange:()=>{if(s){const c=l.url.replaceAll("&use-set-layer","");_c.setState({url:c}),a(!1)}else{const c=l.url+"&use-set-layer";_c.setState({url:c}),a(!0)}}})]})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("button",{className:"m-auto mt-2 bg-green-800 p-2 hover:bg-green-700",onClick:()=>{function c(u){var h;(h=u.clipboardData)==null||h.setData("text/plain",l.url),u.preventDefault(),e("URL Copied "),setTimeout(()=>{e("")},3500)}document.addEventListener("copy",c),document.execCommand("copy"),document.removeEventListener("copy",c)},children:"Copy to clipboard"}),n?d.jsx("span",{className:"animate-pulse p-2 text-center",children:n}):""]}),d.jsx("div",{className:"absolute bottom-2 left-0 right-0",children:d.jsx("button",{className:"m-auto block w-28 bg-gray-600 p-2 hover:bg-gray-700",onClick:()=>l.deactivate(),children:"Close"})})]})}):null}function l_e(){const[n,e]=O.useState([]);return O.useEffect(()=>{const t={handleEvent:r=>(e(r.parents.reverse()),!0)};return F1(t),()=>fL(t)},[]),d.jsx("div",{className:"pointer-events-none flex flex-col",children:n.map((t,r)=>{const i=`${(r+1)*5}px`;return d.jsx("span",{className:"block-inline m-1 text-yellow-400",style:{marginLeft:i},children:d.jsx("span",{className:"bg-gray-800/50",children:t})},t)})})}function c_e(){const n=rr();return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{n.hideViewPointInPresentationMode?rr.setState({hideViewPointInPresentationMode:!1}):rr.setState({hideViewPointInPresentationMode:!0})},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 min-h-[30px] w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-2m-4-1v8m0 0l3-3m-3 3L9 8m-5 5h2.586a1 1 0 01.707.293l2.414 2.414a1 1 0 00.707.293h3.172a1 1 0 00.707-.293l2.414-2.414a1 1 0 01.707-.293H20"})}),d.jsx("span",{className:"text-center text-xs",children:"Viewpoints"})]})}function u_e(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{W().getActiveControls().smoothTime=.5,W().getActiveControls().saveState(),W().setOrbitOn().then(()=>{W().getActiveControls().smoothTime=1,W().getActiveControls().saveState()})},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Set last clicked point in model as focus point for rotation",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})}),d.jsx("span",{className:"text-center text-xs",children:"Focus"})]})}function d_e(){return d.jsxs("div",{className:"pointer-events-auto m-2 flex w-20 cursor-pointer flex-col items-center rounded p-2 text-gray-300 hover:bg-gray-500 hover:text-gray-900",onClick:()=>{r_()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"m-1 h-6 w-6 max-w-6 rotate-45 p-1 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Fly to selected",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),d.jsx("span",{className:"text-center text-xs",children:"Fly/Focus"})]})}function h_e(){const n=O.useRef(null),e=rr(),t=Re();return O.useEffect(()=>{const r=n.current;let i,o,s;const a=new ResizeObserver(l=>{for(const c of l)clearTimeout(i),i=setTimeout(()=>{const u=Array.isArray(c.contentRect)?c.contentRect[0]:c.contentRect,h=u.width+(r==null?void 0:r.offsetLeft)||0,f=u.height;W()&&(o!==h||s!==f)&&W().setSize(window.innerWidth,window.innerHeight,0,(r==null?void 0:r.offsetTop)||0)},100)});return r&&a.observe(r),()=>{r&&a.unobserve(r)}}),d.jsx("div",{className:"pointer-events-none fixed z-40 flex h-full w-full",children:d.jsxs("div",{className:"pointer-events-none flex h-full w-full select-none flex-col",children:[d.jsxs($t,{name:t.selectedLayerTitle||"No project/layer selected",children:[d.jsx(_7,{}),d.jsx(c_e,{}),d.jsx(u_e,{}),d.jsx(d_e,{})]}),d.jsxs("div",{className:"flex flex-grow",style:{minHeight:"0px"},children:[d.jsx("div",{ref:n,id:"canvas-tracker",className:"h-full w-full"}),d.jsx("div",{className:"flex flex-grow flex-col border-gray-900",style:{minHeight:"0px"},children:d.jsx("div",{className:"pointer-events-auto flex bg-gray-800",style:{minHeight:"50%"},children:e.hideViewPointInPresentationMode?null:d.jsx(WV,{simplified:!0})})})]}),d.jsx(l_e,{})]})})}function f_e(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-12 w-12",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})}function J4(){const n=Hv();return n.modelIssues?d.jsx("div",{className:"fixed right-28 top-1 z-50",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"m-1 flex",children:d.jsx("div",{className:"cursor-pointer p-1 text-yellow-500 hover:text-gray-300",onClick:()=>{Fn.setState({activated:!0,message:n.modelIssuesMessages.join(`
`),header:"Model Issues"})},children:d.jsx(f_e,{})})})})}):null}async function p_e(n,e=!1){if(n){Re.setState({projectSelectedKey:n}),await $k();const t=Re.getState().selectedProject;if(t&&(t==null?void 0:t.project_key)===n){if(wL&&t.model_layer){const r=t.model_layer.filter(i=>i.name===wL)[0];r&&bt.flushSync(()=>{Re.setState({selectedLayer:r,selectedLayerTitle:`${t.plant_code} - ${t.plant_name} - ${r.description}`})})}else bt.flushSync(()=>{Re.setState({selectedLayerTitle:`${t.plant_code} - ${t.plant_name} `})});if(D1(t.plant_code),await O1(t),e){const r=Re.getState().selectedProject;if(r!=null&&r.controllerPosition&&(r!=null&&r.controllerTarget)){const i=Re.getState().selectedLayer,o=(i==null?void 0:i.controllerTarget)||(r==null?void 0:r.controllerTarget),s=(i==null?void 0:i.controllerPosition)||(r==null?void 0:r.controllerPosition);await W().getActiveControls().setLookAt(s[0],s[1],s[2],o[0],o[1],o[2],!1),await Vv()}else await Vv(),W().fitModelToCanvas(!0);W().getSceneController().updateBB()}rr.setState({treeViewActive:!gF})}}}async function eF(n){var e,t;((e=n.target)==null?void 0:e.tagName)==="INPUT"||((t=n.target)==null?void 0:t.tagName)==="TEXTAREA"||(n.key.toLocaleUpperCase()==="H"&&U1(),n.key.toLocaleUpperCase()==="J"&&j7(),n.key.toLocaleUpperCase()==="K"&&Xk(),n.key.toLocaleUpperCase()==="G"&&r_(),n.key.toLocaleUpperCase()==="I"&&Qk(),n.key.toLocaleUpperCase()==="V"&&z7(),n.key.toLocaleUpperCase()==="R"&&qk(),n.key.toLocaleUpperCase()==="T"&&B7(),n.key.toLocaleUpperCase()==="O"&&pL(),n.key.toLocaleUpperCase()==="U"&&X1(),n.key.toLocaleUpperCase()==="P"&&q1(),n.key.toLocaleUpperCase()==="M"&&Xt.toggleMode(),n.key.toLocaleUpperCase()==="X"&&Xt.toggleTransformHelper(),n.key.toLocaleUpperCase()==="F"&&Xt.resizeToSelected(),n.key.toLocaleUpperCase()==="B"&&Xt.toggleClipping())}function m_e(){fL(Z4),document.removeEventListener("keyup",eF),F1(Z4),document.addEventListener("keyup",eF)}function g_e(){const[n,e]=O.useState("");return O.useEffect(()=>{Ua().then(t=>{e(t.ENV__CONFIG_WIKI_LINK)})},[]),n?d.jsx("a",{target:"_blank",rel:"noreferrer",href:n,children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"h-12 w-12","data-tooltip":"Opens wiki page for web-3d",children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M3 4.984h2"}),d.jsx("path",{d:"M8 4.984h2.5"}),d.jsx("path",{d:"M14.5 4.984h2.5"}),d.jsx("path",{d:"M22 4.984h-2"}),d.jsx("path",{d:"M4 4.984l5.455 14.516l6.545 -14.516"}),d.jsx("path",{d:"M9 4.984l6 14.516l6 -14.516"})]})}):null}function v_e(){return d.jsx("div",{className:"fixed right-14 top-0 z-50",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"m-1 flex",children:d.jsx("div",{className:"cursor-pointer p-1 text-gray-200 hover:text-gray-300",children:d.jsx(g_e,{})})})})})}function __e(){const[n,e]=O.useState(),[t,r]=O.useState();return O.useEffect(()=>{Ua().then(i=>{i.ENV__CONFIG_CONTACT_INFO_URL&&e(i.ENV__CONFIG_CONTACT_INFO_URL),i.ENV__CONFIG_CONTACT_INFO_TEXT&&r(i.ENV__CONFIG_CONTACT_INFO_TEXT.replaceAll("_"," "))})},[]),n?d.jsx("div",{className:"text-1xl fixed bottom-0 z-[100000] flex w-full text-red-600",children:d.jsx("a",{className:"absolute bottom-0 right-3 bg-gray-800",href:n,target:"blank",children:t})}):null}const UN=3;async function x_e(n,e){var s,a,l,c;const t=await O7();let r;n&&t&&(r=new Set(n.split(",").map(u=>u.trim().toUpperCase())));const i=[];if(!t)return i;const o=Object.keys(t);for await(const u of o){const h=t[u];if(r!=null&&r.size&&!r.has(h.container.toUpperCase())&&!r.has("*")||!(r!=null&&r.size))continue;const f={projectlistUniqueKey:h.unique_key,projectlistPlantCode:h.plant_code,projectlistPlantName:h.plant_name,projectlistContainer:h.container,projectlistConfigFilePath:h.config,projectlistIsActive:!0,projectlistIsDevOnly:h.dev_only,uploaderServer:null,uploaderLastCheck:null,uploaderLastCheckHours:0,uploaderConfigVersion:null,uploaderConfigFilePath:null,uploaderBuildNumber:null,warningCount:0,errorCount:0,errorCountTxt:0,errorCountRvm:0,errorGeneral:"",lastCheckError:"",$showErrorsOnly:!0,files:[]};i.push(f),e(`Reading container${h.container}`);const m=await Ll(h.container);if(!(m!=null&&m.success))return f.errorCount++,f.errorGeneral="Unable to get sas token, stopping all validation, reason: "+m.message,i;const g=await Id(((s=m.data)==null?void 0:s.token)||"",h.container,h.config,!0).catch(()=>(f.errorCount++,f.errorGeneral=`Unable to get project config
`,null)),_=await Id(((a=m.data)==null?void 0:a.token)||"",h.container,"rvm_uploader.json",!0).catch(()=>(f.errorCount++,f.errorGeneral=f.errorGeneral+"Unable to get rvm uploader log, project not configured yet or just test project",null));if(!g||!_)continue;const v={};if((l=_.Files)!=null&&l.length&&_.Files.forEach(p=>{v[p.DestinationPath.replace("\\","/")]=p}),f.uploaderBuildNumber=_.BuildNumber,f.uploaderLastCheck=_.LastCheck?FN(new Date(_.LastCheck)):null,f.uploaderLastCheckHours=_.LastCheck?TE(new Date(_.LastCheck)):0,f.uploaderLastCheckHours>UN&&(f.lastCheckError=f.lastCheckError+"Over 3 hours since last check",f.errorCount++),f.uploaderServer=_.MachineName,f.uploaderConfigVersion=_.ConfigVersion,f.uploaderConfigFilePath=_.ConfigFilePath,g)for await(const p of g.model_data){const x={projectConfigGlbEnabled:g.enable_glb,projectConfigModelName:p.name,projectConfigPath:p.path,projectConfigWarningAfterHours:p.warning_after_hours,projectConfigAttributes:p.attributes||[],projectConfigWarning:"",modelDataSourcePath:"",uploaderSourcePath:null,uploaderTempCopyPath:null,uploaderDestinationPath:null,uploaderContainerName:null,uploaderLastUpload:null,uploaderLastUploadHours:0,uploaderLastModified:null,uploaderLastModifiedHours:0,uploaderUncompressedMD5:null,uploaderCompressedMD5:null,uploaderWarningMessage:null,uploaderErrorMessage:null,uploaderInformationMessage:null,uploaderExecutionTimeMs:"",uploaderExecutionTimeLastUploadMs:"",siteWarningAfterHours:0,outDatedFileError:!1,warningCount:0,errorCount:0,convertWarnings:""};f.files.push(x),e(`Reading container${h.container}, ${p.path}`);const y=await Id(((c=m.data)==null?void 0:c.token)||"",h.container,p.path,!0).catch(()=>(f.errorCount++,x.errorCount++,x.projectConfigWarning=`Unable to get site config
`,null));if(y){Array.isArray(y==null?void 0:y.warnings)&&(y==null||y.warnings.forEach(S=>{f.warningCount++,x.warningCount++,x.convertWarnings=x.convertWarnings+S+`.
`}));const w=new Date(y.source_created_date),C=TE(w);C>p.warning_after_hours&&(f.warningCount++,x.warningCount++,x.convertWarnings=x.convertWarnings+`Outdated web3d model, model is ${C} hours, warning is set at ${p.warning_after_hours} hours`),x.modelDataSourcePath=y.source_file;const T=v[y.source_file];tF(f,x,T,p.warning_after_hours),Array.isArray(x.projectConfigAttributes)&&x.projectConfigAttributes.length&&x.projectConfigAttributes.forEach(S=>{const b={projectConfigGlbEnabled:!1,projectConfigModelName:S.name+".txt",projectConfigPath:S.path,projectConfigWarningAfterHours:p.warning_after_hours,projectConfigAttributes:[],projectConfigWarning:"",modelDataSourcePath:"",uploaderSourcePath:null,uploaderTempCopyPath:null,uploaderDestinationPath:null,uploaderContainerName:null,uploaderLastUpload:null,uploaderLastUploadHours:0,uploaderLastModified:null,uploaderLastModifiedHours:0,uploaderUncompressedMD5:null,uploaderCompressedMD5:null,uploaderWarningMessage:null,uploaderErrorMessage:null,uploaderInformationMessage:null,uploaderExecutionTimeMs:"",uploaderExecutionTimeLastUploadMs:"",uploaderCompressedFileSizeBytes:0,uploaderFileSizeBytes:0,siteWarningAfterHours:0,outDatedFileError:!1,warningCount:0,errorCount:0,errorCountTxt:0,errorCountRvm:0,convertWarnings:""};f.files.push(b);const R=v[S.path];tF(f,b,R,p.warning_after_hours)})}}}return console.log(i),i}function tF(n,e,t,r){if(!t)n.errorCount++,e.errorCount++,e.projectConfigWarning=e.projectConfigWarning+"Unable to find rvm uploader source file, file might not be part of automatic system";else{e.uploaderSourcePath=t.SourcePath,e.uploaderTempCopyPath=t.TempCopyPath,e.uploaderDestinationPath=t.DestinationPath,e.uploaderContainerName=t.ContainerName,e.uploaderLastUpload=FN(new Date(t.LastUpload)),e.uploaderLastUploadHours=TE(new Date(t.LastUpload)),e.uploaderLastModified=FN(new Date(t.LastModified)),e.uploaderLastModifiedHours=TE(new Date(t.LastModified)),e.uploaderUncompressedMD5=t.UncompressedMD5,e.uploaderCompressedMD5=t.CompressedMD5,e.uploaderWarningMessage=t.WarningMessage,e.uploaderErrorMessage=t.ErrorMessage,e.uploaderInformationMessage=t.InformationMessage;{const i=Math.floor((t.ExecutionTimeMs||0)/3600),o=Math.floor((t.ExecutionTimeMs||0)%3600/1e3);e.uploaderExecutionTimeMs=`${i}m ${o}s`}{const i=Math.floor((t.ExecutionTimeLastUploadMs||0)/3600),o=Math.floor((t.ExecutionTimeLastUploadMs||0)%3600/1e3);e.uploaderExecutionTimeLastUploadMs=`${i}m ${o}s`}e.uploaderFileSizeBytes=Math.ceil(t.FileSizeBytes||0),e.uploaderCompressedFileSizeBytes=Math.ceil(t.CompressedFileSizeBytes||0),t.ErrorMessage&&(e.errorCount++,n.errorCount++),t.ErrorMessage&&e.uploaderSourcePath.toUpperCase().includes(".TXT")&&(e.errorCountTxt++,n.errorCountTxt++),t.ErrorMessage&&e.uploaderSourcePath.toUpperCase().includes(".RVM")&&(e.errorCountRvm++,n.errorCountRvm++),t.WarningMessage&&(e.warningCount++,n.warningCount++),e.siteWarningAfterHours=r,r>0&&e.uploaderLastModifiedHours>r&&(e.outDatedFileError=!0,e.errorCount++,n.errorCount++,e.uploaderSourcePath.toUpperCase().includes(".RVM")?(e.errorCountRvm++,n.errorCountRvm++):(e.errorCountTxt++,n.errorCountTxt++))}}function TE(n){const e=Math.abs(new Date().getTime()-n.getTime())/36e5;return parseFloat(e.toFixed(2))}function FN(n){let e=n;if(e==null||e==="")return e="";if(e=new Date(e).toDateString(),e==="Invalid Date"&&(e=""),e&&n){const t=new Date(n).getFullYear();let r=(new Date(n).getMonth()+1).toString();r.length===1&&(r="0"+r);let i=new Date(n).getDate().toString();i.length===1&&(i="0"+i);let o=new Date(n).getHours().toString();o.length===1&&(o="0"+o);let s=new Date(n).getMinutes().toString();s.length===1&&(s="0"+s);let a=new Date(n).getSeconds().toString();a.length===1&&(a="0"+a),e=`${t}-${r}-${i}T${o}:${s}:${a}`}return e}function y_e(){const[n,e]=O.useState(!0),[t,r]=O.useState(!1),[i,o]=O.useState([]);return O.useEffect(()=>{async function s(){ke.setState({loadingData:!0,dialogContent:"collecting data"});const a=await x_e(G2,l=>{ke.setState({dialogContent:l})});ke.setState({loadingData:!1}),a&&o(a)}s()},[]),d.jsxs("div",{className:"scrollbar m-2 flex h-full w-full flex-col text-xs",children:[d.jsx("span",{className:"m-auto mb-0 mt-0 text-xl",children:"Model Config Status"}),d.jsxs("label",{className:"flex p-2",children:[d.jsx("input",{checked:n,type:"checkbox",onChange:()=>{e(!n)}}),d.jsx("span",{className:"p-1",children:"Only projects with issues"})]}),d.jsxs("label",{className:"flex p-2",children:[d.jsx("input",{checked:t,type:"checkbox",onChange:()=>{r(!t)}}),d.jsx("span",{className:"p-1 text-yellow-400",children:"Show txt files"})]}),d.jsx("div",{className:"scrollbar overflow-auto p-2",children:i.filter(s=>n?s.warningCount+s.errorCount>0:!0).map((s,a)=>d.jsxs("div",{className:"flex flex-col p-5",children:[d.jsxs("div",{className:"flex w-full flex-col bg-gray-700 p-1",children:[d.jsxs("div",{className:"flex w-full flex-col",children:[d.jsx("div",{className:"flex pb-3 text-xl font-semibold",children:s.projectlistPlantCode}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Project Plant Desc:"}),s.projectlistPlantName]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Uploader server:"}),s.uploaderServer]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Uploader Config File:"}),s.uploaderConfigFilePath]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Uploader Config Version:"}),s.uploaderConfigVersion]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Uploader Build Version:"}),s.uploaderBuildNumber]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Uploader lastcheck:"}),s.uploaderLastCheck]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("span",{className:"text-red-400 underline",children:s.lastCheckError}),d.jsxs("div",{className:"flex"+(s.lastCheckError?" pl-4":""),children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Uploader hours since last check:"}),d.jsx("span",{className:s.uploaderLastCheckHours>UN?"text-red-400":"",children:s.uploaderLastCheckHours})]})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Error Count:"}),d.jsx("span",{className:s.errorCount>0?"text-red-400":"",children:s.errorCount})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pl-2 pr-2 text-gray-400",children:"RVM:"}),d.jsx("span",{className:s.errorCountRvm>0?"text-red-400":"",children:s.errorCountRvm})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pl-2 pr-2 text-gray-400",children:"TXT:"}),d.jsx("span",{className:s.errorCountTxt>0?"text-red-400":"",children:s.errorCountTxt})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Warning Count:"}),d.jsx("span",{className:s.warningCount>0?"text-orange-400":"",children:s.warningCount})]})]}),d.jsxs("div",{className:"pt-1",children:[d.jsx("div",{className:"w-3/3 text-red-500",children:s.errorGeneral}),d.jsx("button",{className:"text-indigo-400",onClick:()=>{s.$expandFiles=!s.$expandFiles,o(structuredClone(i))},children:s.$expandFiles?"Close Details":"Show details"})]}),s.$expandFiles?d.jsxs("label",{className:"flex p-2",children:[d.jsx("input",{type:"checkbox",checked:s.$showErrorsOnly,onChange:()=>{s.$showErrorsOnly=!s.$showErrorsOnly,o(structuredClone(i))}}),d.jsx("span",{className:"p-1",children:"Only files with issues"})]}):null]}),s.$expandFiles&&s.files.filter(l=>!t&&l.uploaderSourcePath&&l.uploaderSourcePath.toLocaleLowerCase().endsWith(".txt")?!1:s.$showErrorsOnly?l.warningCount+l.errorCount>0:!0).map((l,c)=>l.projectConfigWarning?d.jsxs("div",{className:"flex flex-col border-b border-gray-700 p-5",children:[d.jsx("div",{className:"flex pb-3 text-xl font-semibold",children:l.projectConfigModelName}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Web3d Source Path:"}),l.modelDataSourcePath]}),d.jsxs("div",{className:"flex text-red-400",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Error:"}),l.projectConfigWarning]})]},c):d.jsx("div",{className:"flex flex-col border-b border-gray-700 p-5",children:d.jsxs("div",{className:"flex w-full flex-col",children:[d.jsx("div",{className:"flex pb-3 text-xl font-semibold",children:l.projectConfigModelName}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Destination Path:"}),l.uploaderContainerName,"\\",l.uploaderDestinationPath]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Source Path:"}),l.uploaderSourcePath]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Temp Copy Path:"}),l.uploaderTempCopyPath]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Execution Last Run:"}),l.uploaderExecutionTimeMs]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Execution Last Upload:"}),l.uploaderExecutionTimeLastUploadMs]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Last Upload:"}),l.uploaderLastUpload]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Last Modified:"}),l.uploaderLastModified]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Filesize(MB):"}),((l.uploaderFileSizeBytes||0)/(1024*1024)).toFixed(2)]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Filesize Compressed (MB):"}),((l.uploaderCompressedFileSizeBytes||0)/(1024*1024)).toFixed(2)]}),l.outDatedFileError?d.jsxs("div",{className:"pb-2 pt-2",children:[d.jsx("span",{className:"text-red-400 underline",children:"Outdated file Error:"}),d.jsxs("div",{className:"flex pl-4",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Warning after hours:"}),d.jsx("span",{className:"pr-2 text-red-400",children:l.siteWarningAfterHours})]}),d.jsxs("div",{className:"flex pl-4",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Source file age(hours):"}),d.jsx("span",{className:"pr-2 text-red-400",children:l.uploaderLastModifiedHours})]}),d.jsxs("div",{className:"flex pl-4",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Hours since last check:"}),d.jsx("span",{className:s.uploaderLastCheckHours>UN?"text-red-400":"",children:s.uploaderLastCheckHours})]})]}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Warning after hours:"}),l.siteWarningAfterHours]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Source file age(hours):"}),l.uploaderLastModifiedHours]})]}),d.jsxs("div",{className:"flex text-yellow-200",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Uploader Info :"}),l.uploaderInformationMessage]}),d.jsxs("div",{className:"flex text-orange-400",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Uploader Warning:"}),l.uploaderWarningMessage]}),d.jsxs("div",{className:"flex text-red-400",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Uploader Error :"}),l.uploaderErrorMessage]}),d.jsxs("div",{className:"flex text-orange-400",children:[d.jsx("span",{className:"pr-2 text-gray-400",children:"Convert Warning:"}),l.convertWarnings]})]})},c))]},a))})]})}function w_e(){const n=su(),e=it.getPoints();function t(){su.setState({update:!n.update})}return d.jsxs("div",{className:"flex w-full flex-col",children:[d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{className:"flex w-full justify-center border-gray-900 pb-2",children:[d.jsxs("div",{className:"flex flex-col",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":["Adds point at the end and set as current","You can use CONTRL to add when clicking"].join(`
`),className:"m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:()=>{it.addPoint(),t(),setTimeout(()=>{const r=document.getElementById("measurements");r&&r.scrollTo(0,r.scrollHeight)},100)},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Add"})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":["Snap to Cornor","Use with causion!","Some edges is just 2 items overlapping"].join(`
`),className:`m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500${it.isSnapEdgeActive()?" text-yellow-400":""}`,onClick:()=>{it.toggleSnapEdge()},children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M12 3v6l3 -3m-6 0l3 3"}),d.jsx("path",{d:"M12 21v-6l3 3m-6 0l3 -3"}),d.jsx("path",{d:"M4 12l1 0"}),d.jsx("path",{d:"M9 12l1 0"}),d.jsx("path",{d:"M14 12l1 0"}),d.jsx("path",{d:"M19 12l1 0"})]}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Edge"})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":["Snap to Cornor","Use with causion!","Some cornors is just 2 items overlapping"].join(`
`),className:`m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500${it.isSnapCornorActive()?" text-yellow-400":""}`,onClick:()=>{it.toggleSnapCornor()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9 3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5 5.25 5.25"})}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Corner"})]}),d.jsx("div",{className:"flex flex-col",children:it.isMeasureMode()?d.jsxs(d.Fragment,{children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":["Opens for editing","Stops you from accidentally adding/editing point"].join(`
`),className:"m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:()=>{it.setMeasureMode(!it.isMeasureMode()),t()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 10.5V6.75a4.5 4.5 0 1 1 9 0v3.75M3.75 21.75h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H3.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Unlocked"})]}):d.jsxs(d.Fragment,{children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Locks editing",className:"m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:()=>{it.setMeasureMode(!it.isMeasureMode()),t()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Locked"})]})}),d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Toggle label on points, need minium 2 before this display",className:`m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500${it.isPointLabelEnabled()?" text-yellow-400":""}`,onClick:()=>{it.togglePointLabel(),t(),it.updateLine()},children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M7.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"}),d.jsx("path",{d:"M3 6v5.172a2 2 0 0 0 .586 1.414l7.71 7.71a2.41 2.41 0 0 0 3.408 0l5.592 -5.592a2.41 2.41 0 0 0 0 -3.408l-7.71 -7.71a2 2 0 0 0 -1.414 -.586h-5.172a3 3 0 0 0 -3 3z"})]}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Point"})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Deletes all/reset undo & redo",className:"m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:()=>{it.deleteAll()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Delete All"})]})]}),d.jsxs("div",{className:"flex w-full justify-center border-gray-900 pb-2",children:[d.jsx("div",{className:"flex flex-col",children:it.isHidden()?d.jsxs(d.Fragment,{children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Click to show hidden measurement",className:"m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:()=>{it.toggleHidden()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"})}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Hidden"})]}):d.jsxs(d.Fragment,{children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Click to hide measurement",className:"m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:()=>{it.toggleHidden()},children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Visible"})]})}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":["When activated it will override click and set orbit/goto","Mostly helper for touch screen","This only have effect when measuretool is not in lock mode/active point"].join(`
`),className:`m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500${it.isGotoActive()?"  text-yellow-400":""}`,onClick:()=>{it.toggleGoto()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Goto"})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Save measurement to file",className:"m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:async()=>{await it.saveToFile()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9 13.5 3 3m0 0 3-3m-3 3v-6m1.06-4.19-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"})}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Save"})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Load measurement from file",className:"m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:async()=>{await it.loadFile()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"})}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Open"})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{className:"relative",children:[d.jsx("span",{className:"absolute right-4 top-1 text-xs text-gray-400",children:it.getUndoStackSize()}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Undo",className:"m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:()=>{it.undo()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"})})]}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Undo"})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{className:"relative",children:[d.jsx("span",{className:"absolute right-4 top-1 text-xs text-gray-400",children:it.getRedoStackSize()}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Redo",className:"m-4 mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:()=>{it.redo()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15 15 6-6m0 0-6-6m6 6H9a6 6 0 0 0 0 12h3"})})]}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Redo"})]})]})]}),d.jsx("div",{className:"flex w-full border-t-2 border-gray-700 p-1"}),d.jsx("div",{id:"measurements",className:"scrollbar overflow-y-auto overflow-x-hidden",children:e.map((r,i)=>{let o=!1;const s=e[i-1];(s===void 0||s.isEnd||r.resetTotal)&&(o=!0);const a=it.isMeasureMode()&&r.id===it.activeMeasurePoint?" text-yellow-400":"",l="h-6 w-6 p-1 m-auto mb-0 max-w-6 hover:bg-gray-500"+a;return d.jsxs("div",{className:"flex w-full flex-col border-t border-gray-600 bg-gray-800 pb-4",children:[d.jsxs("div",{className:"text-ms flex w-full flex-col bg-gray-600 p-1",children:[d.jsxs("div",{className:"flex",children:[d.jsxs("span",{children:["P",i+1," "]}),o?d.jsx(d.Fragment,{children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Shows this start of line",className:"m-auto mb-0 mr-2 h-6 w-6 max-w-6 p-1 text-yellow-500",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 19.5 15-15m0 0H8.25m11.25 0v11.25"})})}):null]}),d.jsxs("div",{className:"flex select-text text-xs text-gray-400",children:[d.jsxs("span",{className:"m-auto",children:["X: ",r.px.toFixed(3)]}),d.jsxs("span",{className:"m-auto",children:["Y: ",r.py.toFixed(3)]}),d.jsxs("span",{className:"m-auto",children:[" Z: ",r.py.toFixed(3)]})]})]}),d.jsxs("div",{className:"flex justify-center",children:[d.jsxs("div",{className:"flex w-20 flex-col",children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:l,"data-tooltip":["Sets current point as active","When active, you can change location"],onClick:()=>{it.isMeasureMode()||it.setMeasureMode(!0),it.activeMeasurePoint=r.id,t()},children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"}),d.jsx("path",{d:"M12 12a8 8 0 0 0 8 4"}),d.jsx("path",{d:"M7.5 13.5a12 12 0 0 0 8.5 6.5"}),d.jsx("path",{d:"M12 12a8 8 0 0 0 -7.464 4.928"}),d.jsx("path",{d:"M12.951 7.353a12 12 0 0 0 -9.88 4.111"}),d.jsx("path",{d:"M12 12a8 8 0 0 0 -.536 -8.928"}),d.jsx("path",{d:"M15.549 15.147a12 12 0 0 0 1.38 -10.611"})]}),d.jsx("span",{className:"m-auto mt-0 text-xs text-gray-400"+a,children:a?"Activated":"Activate"})]}),d.jsxs("div",{className:"flex w-20 flex-col p-4",children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Insert new point before current",className:"m-auto mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:()=>{const c=it;c.addPoint(i),c.updateLine()},children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M4 18v-4a1 1 0 0 1 1 -1h14a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-14a1 1 0 0 1 -1 -1z"}),d.jsx("path",{d:"M12 9v-4"}),d.jsx("path",{d:"M10 7l4 0"})]}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Insert"})]}),d.jsxs("div",{className:"flex w-20 flex-col p-4",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"Delete point",className:"m-auto mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500",onClick:()=>{const c=it;c.removePoint(r.id),c.updateLine()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Delete"})]}),d.jsxs("div",{className:"flex w-20 flex-col p-4",children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":["Restart meter count","Userful for when you want to treat this as own measurement"],className:`m-auto mb-0 h-6 w-6 max-w-6 p-1 hover:bg-gray-500${r.resetTotal?"  text-yellow-400":""}`,onClick:()=>{it.toggleResetTotal(i)},children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M10 10v4a2 2 0 1 0 4 0v-4a2 2 0 1 0 -4 0z"}),d.jsx("path",{d:"M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7c.412 .41 .97 .64 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1c0 .58 .23 1.138 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1"})]}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Reset"})]}),d.jsxs("div",{className:"flex w-20 flex-col p-4",children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","data-tooltip":"If its end, we dont draw line to next point, and total restart on next point",className:`m-auto mb-0 h-6 w-6 max-w-6 rotate-90 p-1 hover:bg-gray-500${r.isEnd?" text-yellow-400":""}`,onClick:()=>{it.toggleAsEnd(i)},children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M6 5h12"}),d.jsx("path",{d:"M6 9h12"}),d.jsx("path",{d:"M12 9v10"})]}),d.jsx("span",{className:"m-auto text-xs text-gray-400",children:"Is end"})]})]}),d.jsxs("div",{className:"flex w-full flex-col pl-4 pr-4",children:[d.jsxs("div",{className:"flex w-full flex-col bg-gray-700 p-1 text-xs text-gray-400",children:[d.jsxs("span",{className:"m-auto",children:["P",i+1," to P",i+2]}),d.jsxs("span",{className:"m-auto",children:["(",Math.abs(r.length).toFixed(3),"m)"," "]})]}),d.jsxs("div",{className:"m-1 flex",children:[d.jsx("div",{className:"flex-1 text-xs text-gray-400",children:"Axis:"}),d.jsx("div",{className:"flex-1 text-xs text-gray-400",children:"Meter"}),d.jsx("div",{className:"flex-1 text-xs text-gray-400",children:"Show"}),d.jsx("div",{className:"flex-1 text-xs text-gray-400",children:"From"}),d.jsx("div",{className:"flex-1 text-xs text-gray-400",children:"To"})]}),d.jsxs("div",{className:"m-1 flex",children:[d.jsx("div",{className:"m-auto flex-1 text-xs text-red-500",children:"X (W/E):"}),d.jsx("div",{className:"m-auto mr-0 flex-1 text-xs text-gray-200",children:Math.abs(parseFloat(r.xLength.toFixed(3)))}),d.jsx("div",{className:"flex-1",children:d.jsx(B2,{enabled:r.xShowLine,addClasses:"mr-3",clickCallback:()=>{it.toggleAxis(r,"X")}})}),d.jsx("div",{className:"flex-1",children:d.jsx(Cf,{tooltip:"Aligns this axis with next point on same axis",addClasses:"mr-3",clickCallback:()=>{it.activeMeasurePoint=r.id,it.onSelect(r.px-r.xLength,r.py,r.pz,r.nx,r.ny,r.nz)}})}),d.jsx("div",{className:"flex-1",children:d.jsx(Cf,{tooltip:"Aligns axis on next point to this",addClasses:"",clickCallback:()=>{const c=e[i+1];c&&(it.activeMeasurePoint=c.id,it.onSelect(c.px+r.xLength,c.py,c.pz,c.nx,c.ny,c.nz),it.activeMeasurePoint=r.id)}})})]}),d.jsxs("div",{className:"m-1 flex",children:[d.jsx("div",{className:"m-auto flex-1 text-xs text-green-500",children:"Y (N/S):"}),d.jsx("div",{className:"m-auto mr-0 flex-1 text-xs text-gray-200",children:Math.abs(parseFloat(r.yLength.toFixed(3)))}),d.jsx("div",{className:"flex-1",children:d.jsx(B2,{enabled:r.yShowLine,addClasses:"",clickCallback:()=>{it.toggleAxis(r,"Y")}})}),d.jsx("div",{className:"flex-1",children:d.jsx(Cf,{tooltip:"Aligns this axis with next point on same axis",addClasses:"",clickCallback:()=>{it.activeMeasurePoint=r.id,it.onSelect(r.px,r.py-r.yLength,r.pz,r.nx,r.ny,r.nz)}})}),d.jsx("div",{className:"flex-1",children:d.jsx(Cf,{addClasses:"",tooltip:"Aligns axis on next point to this",clickCallback:()=>{const c=e[i+1];c&&(it.activeMeasurePoint=c.id,it.onSelect(c.px,c.py+r.yLength,c.pz,c.nx,c.ny,c.nz),it.activeMeasurePoint=r.id)}})})]}),d.jsxs("div",{className:"m-1 flex",children:[d.jsx("div",{className:"m-auto flex-1 text-xs text-blue-500",children:"Z (A/U):"}),d.jsx("div",{className:"m-auto mr-0 flex-1 text-xs text-gray-200",children:Math.abs(parseFloat(r.zLength.toFixed(3)))}),d.jsx("div",{className:"flex-1",children:d.jsx(B2,{enabled:r.zShowLine,addClasses:" mr-3",clickCallback:()=>{it.toggleAxis(r,"Z")}})}),d.jsx("div",{className:"flex-1",children:d.jsx(Cf,{addClasses:" mr-3",tooltip:"Aligns this axis with next point on same axis",clickCallback:()=>{it.activeMeasurePoint=r.id,it.onSelect(r.px,r.py,r.pz-r.zLength,r.nx,r.ny,r.nz)}})}),d.jsx("div",{className:"flex-1",children:d.jsx(Cf,{addClasses:"",tooltip:"Aligns axis on next point to this",clickCallback:()=>{const c=e[i+1];c&&(it.activeMeasurePoint=c.id,it.onSelect(c.px,c.py,c.pz+r.zLength,c.nx,c.ny,c.nz),it.activeMeasurePoint=r.id)}})})]})]})]},r.id)})})]})}function B2(n){return n.enabled?d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Shows Axis with line/color",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6 max-w-6 p-1 hover:bg-gray-500 "+n.addClasses,onClick:()=>{n.clickCallback()},children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}):d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Shows Axis with line/color",strokeWidth:1.5,stroke:"currentColor",className:"h-6 w-6 max-w-6 p-1 hover:bg-gray-500 "+n.addClasses,onClick:()=>{n.clickCallback()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"})})}function Cf(n){return d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,"data-tooltip":n.tooltip,stroke:"currentColor",className:"h-6 w-6 max-w-6 p-1 hover:bg-gray-500 "+n.addClasses,onClick:()=>{n.clickCallback()},children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"}),d.jsx("path",{d:"M4 8v-2a2 2 0 0 1 2 -2h2"}),d.jsx("path",{d:"M4 16v2a2 2 0 0 0 2 2h2"}),d.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v2"}),d.jsx("path",{d:"M16 20h2a2 2 0 0 0 2 -2v-2"})]})}let Jg={height:500,width:350,bottom:200,right:0,initLoaded:!1,closed:!0};function S_e(){const n=su();return d.jsx(Rh,{uniqueName:"PointPathMeasurementDialog",adjustOnLoad:!1,title:"Line/Path Measurement Tool",isOpen:n.isPointToPointDialogActive,width:Jg.width,height:Jg.height,bottom:Jg.bottom,onClose:e=>{Jg={...Jg,...e},su.setState({isPointToPointDialogActive:!1}),Pt.getState().updateToggel()},children:d.jsx(w_e,{})})}let bf={height:650,width:750,bottom:200,right:0,initLoaded:!1,adjustOnLoad:!0,closed:!0};function E_e(){const n=gE();return d.jsx(Rh,{uniqueName:"SourceFileInfo",adjustOnLoad:bf.adjustOnLoad,title:"Source File Info",isOpen:n.isOpen,width:bf.width,height:bf.height,bottom:bf.bottom,onClose:e=>{bf={...bf,...e,adjustOnLoad:!1},gE.setState({isOpen:!1})},children:d.jsx("div",{className:"grid h-full w-full",children:d.jsx(T_e,{})})})}function T_e(){var e,t;const n=(e=Re.getState().selectedProject)==null?void 0:e.plant_code;if((t=Re.getState().selectedProject)!=null&&t.plant_code){const r=`${location.origin}/?validate=${n}`;return d.jsx("iframe",{className:"h-full w-full",src:r})}return d.jsx("span",{children:"No projects is selected"})}D1("No project selected");function C_e(){const n=rr();if(O.useEffect(()=>{!EL&&G2===null&&(Iue("3dview"),ope(),m_e(),lpe(),rT&&SL&&F7(rT,SL,!0).catch(t=>{ke.setState({loadingData:!1,dialogContent:"",dialogHeader:""}),Fn.setState({activated:!0,header:"Loading error",message:t}),console.error(t)}).then(()=>{Pt.getState().updateToggel(),zi(!0)}),nT&&p_e(nT,wG).catch(t=>{ke.setState({loadingData:!1,dialogContent:"",dialogHeader:""}),Fn.setState({activated:!0,header:"Loading error",message:t}),console.error(t)}),!nT&&!rT&&eP()&&Re.setState({isOpen:!0}))},[]),G2!==null)return d.jsxs("div",{className:"app items-center bg-gray-800 text-gray-200",children:[d.jsx(j2,{}),d.jsx(C2,{}),d.jsx(y_e,{})]});if(EL)return document.title="Web-3d external",d.jsx("div",{className:"app items-center overflow-auto bg-gray-800 text-gray-200",children:d.jsx(Qve,{})});if(n.isPresentationMode)return d.jsxs("div",{className:"app items-center bg-gray-800 text-gray-200",children:[d.jsx(j2,{}),d.jsx(S4,{}),d.jsx(J4,{}),d.jsx(E4,{}),d.jsx(C2,{}),d.jsx(h_e,{}),d.jsx("canvas",{className:"fixed cursor-default",id:"3dview"})]});const e=n.canvasMode==="NORMAL"?"cursor-default fixed":"cursor-crosshair fixed";return d.jsxs("div",{className:"app items-center bg-gray-800 text-gray-200",children:[d.jsx(S_e,{}),d.jsx(mpe,{}),d.jsx(s_e,{}),d.jsx(a_e,{}),d.jsx(J4,{}),d.jsx(o_e,{}),d.jsx(v_e,{}),d.jsx(j2,{}),d.jsx(Dve,{}),d.jsx(qve,{}),d.jsx(Epe,{}),d.jsx(S4,{}),d.jsx(E4,{}),d.jsx(C2,{}),d.jsx(Vve,{}),d.jsx(E_e,{}),d.jsx(ape,{}),d.jsx(kue,{}),d.jsx(__e,{}),d.jsx("canvas",{className:e,id:"3dview"})]})}var $V,nF=bt;$V=nF.createRoot,nF.hydrateRoot;const z2=6;async function b_e(){ke.setState({loadingData:!0,dialogHeader:"Version check",dialogContent:"Checking version"});const n=localStorage.getItem("Wb3dVersion");n&&n!==z2.toString()&&(ke.setState({loadingData:!0,dialogHeader:"Version check",dialogContent:"Cleaning cache will autoreload page"}),navigator.serviceWorker.getRegistrations(),localStorage.clear(),sessionStorage.clear(),localStorage.setItem("Wb3dVersion",z2.toString()),history.pushState(null,"",location.origin+location.pathname),await VN(),location.reload()),n===null&&(localStorage.clear(),sessionStorage.clear(),localStorage.setItem("Wb3dVersion",z2.toString())),ke.setState({loadingData:!1})}console.log("Web-3d version: 1.29.2");b_e().then(()=>{Fce().then(()=>{const n=document.getElementById("root");$V(n).render(d.jsx(C_e,{}))})});
