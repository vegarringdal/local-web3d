function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var o8=Object.defineProperty;var a8=(n,e,t)=>e in n?o8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Q=(n,e,t)=>(a8(n,typeof e!="symbol"?e+"":e,t),t),eI=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var qv=(n,e,t)=>(eI(n,e,"read from private field"),t?t.call(n):e.get(n)),YS=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},KS=(n,e,t,r)=>(eI(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t);var tI=(n,e,t,r)=>({set _(i){KS(n,e,i,t)},get _(){return qv(n,e,r)}});function l8(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function X3(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var q3={exports:{}},Nw={},Z3={exports:{}},jt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ev=Symbol.for("react.element"),c8=Symbol.for("react.portal"),u8=Symbol.for("react.fragment"),d8=Symbol.for("react.strict_mode"),h8=Symbol.for("react.profiler"),f8=Symbol.for("react.provider"),p8=Symbol.for("react.context"),m8=Symbol.for("react.forward_ref"),g8=Symbol.for("react.suspense"),v8=Symbol.for("react.memo"),_8=Symbol.for("react.lazy"),nI=Symbol.iterator;function x8(n){return n===null||typeof n!="object"?null:(n=nI&&n[nI]||n["@@iterator"],typeof n=="function"?n:null)}var Q3={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},J3=Object.assign,eU={};function Cp(n,e,t){this.props=n,this.context=e,this.refs=eU,this.updater=t||Q3}Cp.prototype.isReactComponent={};Cp.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Cp.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function tU(){}tU.prototype=Cp.prototype;function IA(n,e,t){this.props=n,this.context=e,this.refs=eU,this.updater=t||Q3}var PA=IA.prototype=new tU;PA.constructor=IA;J3(PA,Cp.prototype);PA.isPureReactComponent=!0;var rI=Array.isArray,nU=Object.prototype.hasOwnProperty,kA={current:null},rU={key:!0,ref:!0,__self:!0,__source:!0};function iU(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)nU.call(e,r)&&!rU.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ev,type:n,key:s,ref:o,props:i,_owner:kA.current}}function y8(n,e){return{$$typeof:Ev,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function LA(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ev}function w8(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var iI=/\/+/g;function $S(n,e){return typeof n=="object"&&n!==null&&n.key!=null?w8(""+n.key):e.toString(36)}function B_(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Ev:case c8:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+$S(o,0):r,rI(i)?(t="",n!=null&&(t=n.replace(iI,"$&/")+"/"),B_(i,e,t,"",function(c){return c})):i!=null&&(LA(i)&&(i=y8(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(iI,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",rI(n))for(var a=0;a<n.length;a++){s=n[a];var l=r+$S(s,a);o+=B_(s,e,t,l,i)}else if(l=x8(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=r+$S(s,a++),o+=B_(s,e,t,l,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Zv(n,e,t){if(n==null)return n;var r=[],i=0;return B_(n,r,"","",function(s){return e.call(t,s,i++)}),r}function S8(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Ei={current:null},H_={transition:null},E8={ReactCurrentDispatcher:Ei,ReactCurrentBatchConfig:H_,ReactCurrentOwner:kA};jt.Children={map:Zv,forEach:function(n,e,t){Zv(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Zv(n,function(){e++}),e},toArray:function(n){return Zv(n,function(e){return e})||[]},only:function(n){if(!LA(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};jt.Component=Cp;jt.Fragment=u8;jt.Profiler=h8;jt.PureComponent=IA;jt.StrictMode=d8;jt.Suspense=g8;jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=E8;jt.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=J3({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=kA.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)nU.call(e,l)&&!rU.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:Ev,type:n.type,key:i,ref:s,props:r,_owner:o}};jt.createContext=function(n){return n={$$typeof:p8,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:f8,_context:n},n.Consumer=n};jt.createElement=iU;jt.createFactory=function(n){var e=iU.bind(null,n);return e.type=n,e};jt.createRef=function(){return{current:null}};jt.forwardRef=function(n){return{$$typeof:m8,render:n}};jt.isValidElement=LA;jt.lazy=function(n){return{$$typeof:_8,_payload:{_status:-1,_result:n},_init:S8}};jt.memo=function(n,e){return{$$typeof:v8,type:n,compare:e===void 0?null:e}};jt.startTransition=function(n){var e=H_.transition;H_.transition={};try{n()}finally{H_.transition=e}};jt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};jt.useCallback=function(n,e){return Ei.current.useCallback(n,e)};jt.useContext=function(n){return Ei.current.useContext(n)};jt.useDebugValue=function(){};jt.useDeferredValue=function(n){return Ei.current.useDeferredValue(n)};jt.useEffect=function(n,e){return Ei.current.useEffect(n,e)};jt.useId=function(){return Ei.current.useId()};jt.useImperativeHandle=function(n,e,t){return Ei.current.useImperativeHandle(n,e,t)};jt.useInsertionEffect=function(n,e){return Ei.current.useInsertionEffect(n,e)};jt.useLayoutEffect=function(n,e){return Ei.current.useLayoutEffect(n,e)};jt.useMemo=function(n,e){return Ei.current.useMemo(n,e)};jt.useReducer=function(n,e,t){return Ei.current.useReducer(n,e,t)};jt.useRef=function(n){return Ei.current.useRef(n)};jt.useState=function(n){return Ei.current.useState(n)};jt.useSyncExternalStore=function(n,e,t){return Ei.current.useSyncExternalStore(n,e,t)};jt.useTransition=function(){return Ei.current.useTransition()};jt.version="18.2.0";Z3.exports=jt;var ee=Z3.exports;const Mn=X3(ee),sI=l8({__proto__:null,default:Mn},[ee]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T8=ee,C8=Symbol.for("react.element"),b8=Symbol.for("react.fragment"),A8=Object.prototype.hasOwnProperty,M8=T8.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,R8={key:!0,ref:!0,__self:!0,__source:!0};function sU(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)A8.call(e,r)&&!R8.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:C8,type:n,key:s,ref:o,props:i,_owner:M8.current}}Nw.Fragment=b8;Nw.jsx=sU;Nw.jsxs=sU;q3.exports=Nw;var d=q3.exports,N8={VITE_CJS_TRACE:"true",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const oI=n=>{let e;const t=new Set,r=(u,h)=>{const f=typeof u=="function"?u(e):u;if(!Object.is(f,e)){const p=e;e=h??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(_=>_(e,p))}},i=()=>e,l={setState:r,getState:i,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(N8?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},c=e=n(r,i,l);return l},I8=n=>n?oI(n):oI;var oU={exports:{}},aU={},lU={exports:{}},cU={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kf=ee;function P8(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var k8=typeof Object.is=="function"?Object.is:P8,L8=Kf.useState,O8=Kf.useEffect,D8=Kf.useLayoutEffect,U8=Kf.useDebugValue;function F8(n,e){var t=e(),r=L8({inst:{value:t,getSnapshot:e}}),i=r[0].inst,s=r[1];return D8(function(){i.value=t,i.getSnapshot=e,XS(i)&&s({inst:i})},[n,t,e]),O8(function(){return XS(i)&&s({inst:i}),n(function(){XS(i)&&s({inst:i})})},[n]),U8(t),t}function XS(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!k8(n,t)}catch{return!0}}function j8(n,e){return e()}var z8=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?j8:F8;cU.useSyncExternalStore=Kf.useSyncExternalStore!==void 0?Kf.useSyncExternalStore:z8;lU.exports=cU;var B8=lU.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Iw=ee,H8=B8;function V8(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var G8=typeof Object.is=="function"?Object.is:V8,W8=H8.useSyncExternalStore,Y8=Iw.useRef,K8=Iw.useEffect,$8=Iw.useMemo,X8=Iw.useDebugValue;aU.useSyncExternalStoreWithSelector=function(n,e,t,r,i){var s=Y8(null);if(s.current===null){var o={hasValue:!1,value:null};s.current=o}else o=s.current;s=$8(function(){function l(p){if(!c){if(c=!0,u=p,p=r(p),i!==void 0&&o.hasValue){var _=o.value;if(i(_,p))return h=_}return h=p}if(_=h,G8(u,p))return _;var y=r(p);return i!==void 0&&i(_,y)?_:(u=p,h=y)}var c=!1,u,h,f=t===void 0?null:t;return[function(){return l(e())},f===null?void 0:function(){return l(f())}]},[e,t,r,i]);var a=W8(n,s[0],s[1]);return K8(function(){o.hasValue=!0,o.value=a},[a]),X8(a),a};oU.exports=aU;var q8=oU.exports;const Z8=X3(q8);var uU={VITE_CJS_TRACE:"true",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{useDebugValue:Q8}=Mn,{useSyncExternalStoreWithSelector:J8}=Z8;let aI=!1;const e9=n=>n;function t9(n,e=e9,t){(uU?"production":void 0)!=="production"&&t&&!aI&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),aI=!0);const r=J8(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return Q8(r),r}const lI=n=>{(uU?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof n=="function"?I8(n):n,t=(r,i)=>t9(e,r,i);return Object.assign(t,e),t},Ir=n=>n?lI(n):lI;/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const OA="162",n9={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},r9=0,cI=1,i9=2,dU=1,s9=2,wa=3,$a=0,ji=1,gi=2,Fa=0,xf=1,CC=2,uI=3,dI=4,o9=5,gu=100,a9=101,l9=102,hI=103,fI=104,c9=200,u9=201,d9=202,h9=203,bC=204,AC=205,f9=206,p9=207,m9=208,g9=209,v9=210,_9=211,x9=212,y9=213,w9=214,S9=0,E9=1,T9=2,Tx=3,C9=4,b9=5,A9=6,M9=7,hU=0,R9=1,N9=2,sc=0,fU=1,pU=2,mU=3,gU=4,I9=5,vU=6,_U=7,xU=300,$f=301,Xf=302,MC=303,RC=304,Pw=306,Cx=1e3,ks=1001,bx=1002,ei=1003,NC=1004,Ih=1005,mi=1006,V_=1007,$l=1008,oc=1009,P9=1010,k9=1011,DA=1012,yU=1013,Xl=1014,Na=1015,Xa=1016,wU=1017,SU=1018,Uu=1020,L9=1021,Ls=1023,O9=1024,D9=1025,Fu=1026,qf=1027,U9=1028,EU=1029,F9=1030,TU=1031,CU=1033,qS=33776,ZS=33777,QS=33778,JS=33779,pI=35840,mI=35841,gI=35842,vI=35843,bU=36196,_I=37492,xI=37496,yI=37808,wI=37809,SI=37810,EI=37811,TI=37812,CI=37813,bI=37814,AI=37815,MI=37816,RI=37817,NI=37818,II=37819,PI=37820,kI=37821,eE=36492,LI=36494,OI=36495,j9=36283,DI=36284,UI=36285,FI=36286,z9=2300,B9=2301,H9=3200,V9=3201,AU=0,G9=1,Ia="",Ns="srgb",ol="srgb-linear",UA="display-p3",kw="display-p3-linear",Ax="linear",vn="srgb",Mx="rec709",Rx="p3",jd=7680,jI=519,W9=512,Y9=513,K9=514,MU=515,$9=516,X9=517,q9=518,Z9=519,zI=35044,BI="300 es",IC=1035,ka=2e3,Nx=2001;let bp=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}};const Vr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let HI=1234567;const yf=Math.PI/180,Ug=180/Math.PI;function Ap(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Vr[n&255]+Vr[n>>8&255]+Vr[n>>16&255]+Vr[n>>24&255]+"-"+Vr[e&255]+Vr[e>>8&255]+"-"+Vr[e>>16&15|64]+Vr[e>>24&255]+"-"+Vr[t&63|128]+Vr[t>>8&255]+"-"+Vr[t>>16&255]+Vr[t>>24&255]+Vr[r&255]+Vr[r>>8&255]+Vr[r>>16&255]+Vr[r>>24&255]).toLowerCase()}function ti(n,e,t){return Math.max(e,Math.min(t,n))}function FA(n,e){return(n%e+e)%e}function Q9(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function J9(n,e,t){return n!==e?(t-n)/(e-n):0}function og(n,e,t){return(1-t)*n+t*e}function e7(n,e,t,r){return og(n,e,1-Math.exp(-t*r))}function t7(n,e=1){return e-Math.abs(FA(n,e*2)-e)}function n7(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function r7(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function i7(n,e){return n+Math.floor(Math.random()*(e-n+1))}function s7(n,e){return n+Math.random()*(e-n)}function o7(n){return n*(.5-Math.random())}function a7(n){n!==void 0&&(HI=n);let e=HI+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function l7(n){return n*yf}function c7(n){return n*Ug}function PC(n){return(n&n-1)===0&&n!==0}function u7(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Ix(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function d7(n,e,t,r,i){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),f=o((e-r)/2),p=s((r-e)/2),_=o((r-e)/2);switch(i){case"XYX":n.set(a*u,l*h,l*f,a*c);break;case"YZY":n.set(l*f,a*u,l*h,a*c);break;case"ZXZ":n.set(l*h,l*f,a*u,a*c);break;case"XZX":n.set(a*u,l*_,l*p,a*c);break;case"YXY":n.set(l*p,a*u,l*_,a*c);break;case"ZYZ":n.set(l*_,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Ph(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function di(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const Fg={DEG2RAD:yf,RAD2DEG:Ug,generateUUID:Ap,clamp:ti,euclideanModulo:FA,mapLinear:Q9,inverseLerp:J9,lerp:og,damp:e7,pingpong:t7,smoothstep:n7,smootherstep:r7,randInt:i7,randFloat:s7,randFloatSpread:o7,seededRandom:a7,degToRad:l7,radToDeg:c7,isPowerOfTwo:PC,ceilPowerOfTwo:u7,floorPowerOfTwo:Ix,setQuaternionFromProperEuler:d7,normalize:di,denormalize:Ph};class gt{constructor(e=0,t=0){gt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(ti(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ct{constructor(e,t,r,i,s,o,a,l,c){Ct.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,o,a,l,c)}set(e,t,r,i,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=r,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[3],l=r[6],c=r[1],u=r[4],h=r[7],f=r[2],p=r[5],_=r[8],y=i[0],g=i[3],m=i[6],v=i[1],x=i[4],w=i[7],E=i[2],S=i[5],C=i[8];return s[0]=o*y+a*v+l*E,s[3]=o*g+a*x+l*S,s[6]=o*m+a*w+l*C,s[1]=c*y+u*v+h*E,s[4]=c*g+u*x+h*S,s[7]=c*m+u*w+h*C,s[2]=f*y+p*v+_*E,s[5]=f*g+p*x+_*S,s[8]=f*m+p*w+_*C,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-r*s*u+r*a*l+i*s*c-i*o*l}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,f=a*l-u*s,p=c*s-o*l,_=t*h+r*f+i*p;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/_;return e[0]=h*y,e[1]=(i*c-u*r)*y,e[2]=(a*r-i*o)*y,e[3]=f*y,e[4]=(u*t-i*l)*y,e[5]=(i*s-a*t)*y,e[6]=p*y,e[7]=(r*l-c*t)*y,e[8]=(o*t-r*s)*y,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(r*l,r*c,-r*(l*o+c*a)+o+e,-i*c,i*l,-i*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(tE.makeScale(e,t)),this}rotate(e){return this.premultiply(tE.makeRotation(-e)),this}translate(e,t){return this.premultiply(tE.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const tE=new Ct;function RU(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Px(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function h7(){const n=Px("canvas");return n.style.display="block",n}const VI={};function f7(n){n in VI||(VI[n]=!0,console.warn(n))}const GI=new Ct().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),WI=new Ct().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Qv={[ol]:{transfer:Ax,primaries:Mx,toReference:n=>n,fromReference:n=>n},[Ns]:{transfer:vn,primaries:Mx,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[kw]:{transfer:Ax,primaries:Rx,toReference:n=>n.applyMatrix3(WI),fromReference:n=>n.applyMatrix3(GI)},[UA]:{transfer:vn,primaries:Rx,toReference:n=>n.convertSRGBToLinear().applyMatrix3(WI),fromReference:n=>n.applyMatrix3(GI).convertLinearToSRGB()}},p7=new Set([ol,kw]),Jt={enabled:!0,_workingColorSpace:ol,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!p7.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const r=Qv[e].toReference,i=Qv[t].fromReference;return i(r(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return Qv[n].primaries},getTransfer:function(n){return n===Ia?Ax:Qv[n].transfer}};function wf(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function nE(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let zd;class NU{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{zd===void 0&&(zd=Px("canvas")),zd.width=e.width,zd.height=e.height;const r=zd.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=zd}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Px("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=wf(s[o]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(wf(t[r]/255)*255):t[r]=wf(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let m7=0;class jA{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:m7++}),this.uuid=Ap(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(rE(i[o].image)):s.push(rE(i[o]))}else s=rE(i);r.url=s}return t||(e.images[this.uuid]=r),r}}function rE(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?NU.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let g7=0;class si extends bp{constructor(e=si.DEFAULT_IMAGE,t=si.DEFAULT_MAPPING,r=ks,i=ks,s=mi,o=$l,a=Ls,l=oc,c=si.DEFAULT_ANISOTROPY,u=Ia){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:g7++}),this.uuid=Ap(),this.name="",this.source=new jA(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new gt(0,0),this.repeat=new gt(1,1),this.center=new gt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ct,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==xU)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Cx:e.x=e.x-Math.floor(e.x);break;case ks:e.x=e.x<0?0:1;break;case bx:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Cx:e.y=e.y-Math.floor(e.y);break;case ks:e.y=e.y<0?0:1;break;case bx:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}si.DEFAULT_IMAGE=null;si.DEFAULT_MAPPING=xU;si.DEFAULT_ANISOTROPY=1;class Cn{constructor(e=0,t=0,r=0,i=1){Cn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*s,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*s,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*s,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,s;const l=e.elements,c=l[0],u=l[4],h=l[8],f=l[1],p=l[5],_=l[9],y=l[2],g=l[6],m=l[10];if(Math.abs(u-f)<.01&&Math.abs(h-y)<.01&&Math.abs(_-g)<.01){if(Math.abs(u+f)<.1&&Math.abs(h+y)<.1&&Math.abs(_+g)<.1&&Math.abs(c+p+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const x=(c+1)/2,w=(p+1)/2,E=(m+1)/2,S=(u+f)/4,C=(h+y)/4,A=(_+g)/4;return x>w&&x>E?x<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(x),i=S/r,s=C/r):w>E?w<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(w),r=S/i,s=A/i):E<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(E),r=C/s,i=A/s),this.set(r,i,s,t),this}let v=Math.sqrt((g-_)*(g-_)+(h-y)*(h-y)+(f-u)*(f-u));return Math.abs(v)<.001&&(v=1),this.x=(g-_)/v,this.y=(h-y)/v,this.z=(f-u)/v,this.w=Math.acos((c+p+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class v7 extends bp{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Cn(0,0,e,t),this.scissorTest=!1,this.viewport=new Cn(0,0,e,t);const i={width:e,height:t,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:mi,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},r);const s=new si(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const o=r.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,i=e.textures.length;r<i;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new jA(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class zs extends v7{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class IU extends si{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=ei,this.minFilter=ei,this.wrapR=ks,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class _7 extends si{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=ei,this.minFilter=ei,this.wrapR=ks,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Wn{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,s,o,a){let l=r[i+0],c=r[i+1],u=r[i+2],h=r[i+3];const f=s[o+0],p=s[o+1],_=s[o+2],y=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=f,e[t+1]=p,e[t+2]=_,e[t+3]=y;return}if(h!==y||l!==f||c!==p||u!==_){let g=1-a;const m=l*f+c*p+u*_+h*y,v=m>=0?1:-1,x=1-m*m;if(x>Number.EPSILON){const E=Math.sqrt(x),S=Math.atan2(E,m*v);g=Math.sin(g*S)/E,a=Math.sin(a*S)/E}const w=a*v;if(l=l*g+f*w,c=c*g+p*w,u=u*g+_*w,h=h*g+y*w,g===1-a){const E=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=E,c*=E,u*=E,h*=E}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,i,s,o){const a=r[i],l=r[i+1],c=r[i+2],u=r[i+3],h=s[o],f=s[o+1],p=s[o+2],_=s[o+3];return e[t]=a*_+u*h+l*p-c*f,e[t+1]=l*_+u*f+c*h-a*p,e[t+2]=c*_+u*p+a*f-l*h,e[t+3]=u*_-a*h-l*f-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(r/2),u=a(i/2),h=a(s/2),f=l(r/2),p=l(i/2),_=l(s/2);switch(o){case"XYZ":this._x=f*u*h+c*p*_,this._y=c*p*h-f*u*_,this._z=c*u*_+f*p*h,this._w=c*u*h-f*p*_;break;case"YXZ":this._x=f*u*h+c*p*_,this._y=c*p*h-f*u*_,this._z=c*u*_-f*p*h,this._w=c*u*h+f*p*_;break;case"ZXY":this._x=f*u*h-c*p*_,this._y=c*p*h+f*u*_,this._z=c*u*_+f*p*h,this._w=c*u*h-f*p*_;break;case"ZYX":this._x=f*u*h-c*p*_,this._y=c*p*h+f*u*_,this._z=c*u*_-f*p*h,this._w=c*u*h+f*p*_;break;case"YZX":this._x=f*u*h+c*p*_,this._y=c*p*h+f*u*_,this._z=c*u*_-f*p*h,this._w=c*u*h-f*p*_;break;case"XZY":this._x=f*u*h-c*p*_,this._y=c*p*h-f*u*_,this._z=c*u*_+f*p*h,this._w=c*u*h+f*p*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],f=r+a+h;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(u-l)*p,this._y=(s-c)*p,this._z=(o-i)*p}else if(r>a&&r>h){const p=2*Math.sqrt(1+r-a-h);this._w=(u-l)/p,this._x=.25*p,this._y=(i+o)/p,this._z=(s+c)/p}else if(a>h){const p=2*Math.sqrt(1+a-r-h);this._w=(s-c)/p,this._x=(i+o)/p,this._y=.25*p,this._z=(l+u)/p}else{const p=2*Math.sqrt(1+h-r-a);this._w=(o-i)/p,this._x=(s+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ti(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=r*u+o*a+i*c-s*l,this._y=i*u+o*l+s*a-r*c,this._z=s*u+o*c+r*l-i*a,this._w=o*u-r*a-i*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+r*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*r+t*this._x,this._y=p*i+t*this._y,this._z=p*s+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,f=Math.sin(t*u)/c;return this._w=o*h+this._w*f,this._x=r*h+this._x*f,this._y=i*h+this._y*f,this._z=s*h+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class N{constructor(e=0,t=0,r=0){N.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(YI.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(YI.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6]*i,this.y=s[1]*t+s[4]*r+s[7]*i,this.z=s[2]*t+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*i-a*r),u=2*(a*t-s*i),h=2*(s*r-o*t);return this.x=t+l*c+o*h-a*u,this.y=r+l*u+a*c-s*h,this.z=i+l*h+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i,this.y=s[1]*t+s[5]*r+s[9]*i,this.z=s[2]*t+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=i*l-s*a,this.y=s*o-r*l,this.z=r*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return iE.copy(this).projectOnVector(e),this.sub(iE)}reflect(e){return this.sub(iE.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(ti(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const iE=new N,YI=new Wn;class et{constructor(e=new N(1/0,1/0,1/0),t=new N(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Ys.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Ys.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Ys.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Ys):Ys.fromBufferAttribute(s,o),Ys.applyMatrix4(e.matrixWorld),this.expandByPoint(Ys);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Jv.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),Jv.copy(r.boundingBox)),Jv.applyMatrix4(e.matrixWorld),this.union(Jv)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ys),Ys.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Vp),e0.subVectors(this.max,Vp),Bd.subVectors(e.a,Vp),Hd.subVectors(e.b,Vp),Vd.subVectors(e.c,Vp),hl.subVectors(Hd,Bd),fl.subVectors(Vd,Hd),Bc.subVectors(Bd,Vd);let t=[0,-hl.z,hl.y,0,-fl.z,fl.y,0,-Bc.z,Bc.y,hl.z,0,-hl.x,fl.z,0,-fl.x,Bc.z,0,-Bc.x,-hl.y,hl.x,0,-fl.y,fl.x,0,-Bc.y,Bc.x,0];return!sE(t,Bd,Hd,Vd,e0)||(t=[1,0,0,0,1,0,0,0,1],!sE(t,Bd,Hd,Vd,e0))?!1:(t0.crossVectors(hl,fl),t=[t0.x,t0.y,t0.z],sE(t,Bd,Hd,Vd,e0))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ys).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ys).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ha[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ha[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ha[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ha[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ha[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ha[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ha[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ha[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ha),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ha=[new N,new N,new N,new N,new N,new N,new N,new N],Ys=new N,Jv=new et,Bd=new N,Hd=new N,Vd=new N,hl=new N,fl=new N,Bc=new N,Vp=new N,e0=new N,t0=new N,Hc=new N;function sE(n,e,t,r,i){for(let s=0,o=n.length-3;s<=o;s+=3){Hc.fromArray(n,s);const a=i.x*Math.abs(Hc.x)+i.y*Math.abs(Hc.y)+i.z*Math.abs(Hc.z),l=e.dot(Hc),c=t.dot(Hc),u=r.dot(Hc);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const x7=new et,Gp=new N,oE=new N;class Tv{constructor(e=new N,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):x7.setFromPoints(e).getCenter(r);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Gp.subVectors(e,this.center);const t=Gp.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(Gp,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(oE.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Gp.copy(e.center).add(oE)),this.expandByPoint(Gp.copy(e.center).sub(oE))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const fa=new N,aE=new N,n0=new N,pl=new N,lE=new N,r0=new N,cE=new N;class zA{constructor(e=new N,t=new N(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,fa)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=fa.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(fa.copy(this.origin).addScaledVector(this.direction,t),fa.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){aE.copy(e).add(t).multiplyScalar(.5),n0.copy(t).sub(e).normalize(),pl.copy(this.origin).sub(aE);const s=e.distanceTo(t)*.5,o=-this.direction.dot(n0),a=pl.dot(this.direction),l=-pl.dot(n0),c=pl.lengthSq(),u=Math.abs(1-o*o);let h,f,p,_;if(u>0)if(h=o*l-a,f=o*a-l,_=s*u,h>=0)if(f>=-_)if(f<=_){const y=1/u;h*=y,f*=y,p=h*(h+o*f+2*a)+f*(o*h+f+2*l)+c}else f=s,h=Math.max(0,-(o*f+a)),p=-h*h+f*(f+2*l)+c;else f=-s,h=Math.max(0,-(o*f+a)),p=-h*h+f*(f+2*l)+c;else f<=-_?(h=Math.max(0,-(-o*s+a)),f=h>0?-s:Math.min(Math.max(-s,-l),s),p=-h*h+f*(f+2*l)+c):f<=_?(h=0,f=Math.min(Math.max(-s,-l),s),p=f*(f+2*l)+c):(h=Math.max(0,-(o*s+a)),f=h>0?s:Math.min(Math.max(-s,-l),s),p=-h*h+f*(f+2*l)+c);else f=o>0?-s:s,h=Math.max(0,-(o*f+a)),p=-h*h+f*(f+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(aE).addScaledVector(n0,f),p}intersectSphere(e,t){fa.subVectors(e.center,this.origin);const r=fa.dot(this.direction),i=fa.dot(fa)-r*r,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=r-o,l=r+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,f=this.origin;return c>=0?(r=(e.min.x-f.x)*c,i=(e.max.x-f.x)*c):(r=(e.max.x-f.x)*c,i=(e.min.x-f.x)*c),u>=0?(s=(e.min.y-f.y)*u,o=(e.max.y-f.y)*u):(s=(e.max.y-f.y)*u,o=(e.min.y-f.y)*u),r>o||s>i||((s>r||isNaN(r))&&(r=s),(o<i||isNaN(i))&&(i=o),h>=0?(a=(e.min.z-f.z)*h,l=(e.max.z-f.z)*h):(a=(e.max.z-f.z)*h,l=(e.min.z-f.z)*h),r>l||a>i)||((a>r||r!==r)&&(r=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,fa)!==null}intersectTriangle(e,t,r,i,s){lE.subVectors(t,e),r0.subVectors(r,e),cE.crossVectors(lE,r0);let o=this.direction.dot(cE),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;pl.subVectors(this.origin,e);const l=a*this.direction.dot(r0.crossVectors(pl,r0));if(l<0)return null;const c=a*this.direction.dot(lE.cross(pl));if(c<0||l+c>o)return null;const u=-a*pl.dot(cE);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ot{constructor(e,t,r,i,s,o,a,l,c,u,h,f,p,_,y,g){ot.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,o,a,l,c,u,h,f,p,_,y,g)}set(e,t,r,i,s,o,a,l,c,u,h,f,p,_,y,g){const m=this.elements;return m[0]=e,m[4]=t,m[8]=r,m[12]=i,m[1]=s,m[5]=o,m[9]=a,m[13]=l,m[2]=c,m[6]=u,m[10]=h,m[14]=f,m[3]=p,m[7]=_,m[11]=y,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ot().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Gd.setFromMatrixColumn(e,0).length(),s=1/Gd.setFromMatrixColumn(e,1).length(),o=1/Gd.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*s,t[5]=r[5]*s,t[6]=r[6]*s,t[7]=0,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),a=Math.sin(r),l=Math.cos(i),c=Math.sin(i),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const f=o*u,p=o*h,_=a*u,y=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=p+_*c,t[5]=f-y*c,t[9]=-a*l,t[2]=y-f*c,t[6]=_+p*c,t[10]=o*l}else if(e.order==="YXZ"){const f=l*u,p=l*h,_=c*u,y=c*h;t[0]=f+y*a,t[4]=_*a-p,t[8]=o*c,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=p*a-_,t[6]=y+f*a,t[10]=o*l}else if(e.order==="ZXY"){const f=l*u,p=l*h,_=c*u,y=c*h;t[0]=f-y*a,t[4]=-o*h,t[8]=_+p*a,t[1]=p+_*a,t[5]=o*u,t[9]=y-f*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const f=o*u,p=o*h,_=a*u,y=a*h;t[0]=l*u,t[4]=_*c-p,t[8]=f*c+y,t[1]=l*h,t[5]=y*c+f,t[9]=p*c-_,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const f=o*l,p=o*c,_=a*l,y=a*c;t[0]=l*u,t[4]=y-f*h,t[8]=_*h+p,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=p*h+_,t[10]=f-y*h}else if(e.order==="XZY"){const f=o*l,p=o*c,_=a*l,y=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=f*h+y,t[5]=o*u,t[9]=p*h-_,t[2]=_*h-p,t[6]=a*u,t[10]=y*h+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(y7,e,w7)}lookAt(e,t,r){const i=this.elements;return Ki.subVectors(e,t),Ki.lengthSq()===0&&(Ki.z=1),Ki.normalize(),ml.crossVectors(r,Ki),ml.lengthSq()===0&&(Math.abs(r.z)===1?Ki.x+=1e-4:Ki.z+=1e-4,Ki.normalize(),ml.crossVectors(r,Ki)),ml.normalize(),i0.crossVectors(Ki,ml),i[0]=ml.x,i[4]=i0.x,i[8]=Ki.x,i[1]=ml.y,i[5]=i0.y,i[9]=Ki.y,i[2]=ml.z,i[6]=i0.z,i[10]=Ki.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[4],l=r[8],c=r[12],u=r[1],h=r[5],f=r[9],p=r[13],_=r[2],y=r[6],g=r[10],m=r[14],v=r[3],x=r[7],w=r[11],E=r[15],S=i[0],C=i[4],A=i[8],k=i[12],T=i[1],R=i[5],$=i[9],P=i[13],M=i[2],I=i[6],j=i[10],O=i[14],z=i[3],B=i[7],L=i[11],D=i[15];return s[0]=o*S+a*T+l*M+c*z,s[4]=o*C+a*R+l*I+c*B,s[8]=o*A+a*$+l*j+c*L,s[12]=o*k+a*P+l*O+c*D,s[1]=u*S+h*T+f*M+p*z,s[5]=u*C+h*R+f*I+p*B,s[9]=u*A+h*$+f*j+p*L,s[13]=u*k+h*P+f*O+p*D,s[2]=_*S+y*T+g*M+m*z,s[6]=_*C+y*R+g*I+m*B,s[10]=_*A+y*$+g*j+m*L,s[14]=_*k+y*P+g*O+m*D,s[3]=v*S+x*T+w*M+E*z,s[7]=v*C+x*R+w*I+E*B,s[11]=v*A+x*$+w*j+E*L,s[15]=v*k+x*P+w*O+E*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],f=e[10],p=e[14],_=e[3],y=e[7],g=e[11],m=e[15];return _*(+s*l*h-i*c*h-s*a*f+r*c*f+i*a*p-r*l*p)+y*(+t*l*p-t*c*f+s*o*f-i*o*p+i*c*u-s*l*u)+g*(+t*c*h-t*a*p-s*o*h+r*o*p+s*a*u-r*c*u)+m*(-i*a*u-t*l*h+t*a*f+i*o*h-r*o*f+r*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],p=e[11],_=e[12],y=e[13],g=e[14],m=e[15],v=h*g*c-y*f*c+y*l*p-a*g*p-h*l*m+a*f*m,x=_*f*c-u*g*c-_*l*p+o*g*p+u*l*m-o*f*m,w=u*y*c-_*h*c+_*a*p-o*y*p-u*a*m+o*h*m,E=_*h*l-u*y*l-_*a*f+o*y*f+u*a*g-o*h*g,S=t*v+r*x+i*w+s*E;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/S;return e[0]=v*C,e[1]=(y*f*s-h*g*s-y*i*p+r*g*p+h*i*m-r*f*m)*C,e[2]=(a*g*s-y*l*s+y*i*c-r*g*c-a*i*m+r*l*m)*C,e[3]=(h*l*s-a*f*s-h*i*c+r*f*c+a*i*p-r*l*p)*C,e[4]=x*C,e[5]=(u*g*s-_*f*s+_*i*p-t*g*p-u*i*m+t*f*m)*C,e[6]=(_*l*s-o*g*s-_*i*c+t*g*c+o*i*m-t*l*m)*C,e[7]=(o*f*s-u*l*s+u*i*c-t*f*c-o*i*p+t*l*p)*C,e[8]=w*C,e[9]=(_*h*s-u*y*s-_*r*p+t*y*p+u*r*m-t*h*m)*C,e[10]=(o*y*s-_*a*s+_*r*c-t*y*c-o*r*m+t*a*m)*C,e[11]=(u*a*s-o*h*s-u*r*c+t*h*c+o*r*p-t*a*p)*C,e[12]=E*C,e[13]=(u*y*i-_*h*i+_*r*f-t*y*f-u*r*g+t*h*g)*C,e[14]=(_*a*i-o*y*i-_*r*l+t*y*l+o*r*g-t*a*g)*C,e[15]=(o*h*i-u*a*i+u*r*l-t*h*l-o*r*f+t*a*f)*C,this}scale(e){const t=this.elements,r=e.x,i=e.y,s=e.z;return t[0]*=r,t[4]*=i,t[8]*=s,t[1]*=r,t[5]*=i,t[9]*=s,t[2]*=r,t[6]*=i,t[10]*=s,t[3]*=r,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),s=1-r,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+r,c*a-i*l,c*l+i*a,0,c*a+i*l,u*a+r,u*l-i*o,0,c*l-i*a,u*l+i*o,s*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,s,o){return this.set(1,r,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,h=a+a,f=s*c,p=s*u,_=s*h,y=o*u,g=o*h,m=a*h,v=l*c,x=l*u,w=l*h,E=r.x,S=r.y,C=r.z;return i[0]=(1-(y+m))*E,i[1]=(p+w)*E,i[2]=(_-x)*E,i[3]=0,i[4]=(p-w)*S,i[5]=(1-(f+m))*S,i[6]=(g+v)*S,i[7]=0,i[8]=(_+x)*C,i[9]=(g-v)*C,i[10]=(1-(f+y))*C,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let s=Gd.set(i[0],i[1],i[2]).length();const o=Gd.set(i[4],i[5],i[6]).length(),a=Gd.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Ks.copy(this);const c=1/s,u=1/o,h=1/a;return Ks.elements[0]*=c,Ks.elements[1]*=c,Ks.elements[2]*=c,Ks.elements[4]*=u,Ks.elements[5]*=u,Ks.elements[6]*=u,Ks.elements[8]*=h,Ks.elements[9]*=h,Ks.elements[10]*=h,t.setFromRotationMatrix(Ks),r.x=s,r.y=o,r.z=a,this}makePerspective(e,t,r,i,s,o,a=ka){const l=this.elements,c=2*s/(t-e),u=2*s/(r-i),h=(t+e)/(t-e),f=(r+i)/(r-i);let p,_;if(a===ka)p=-(o+s)/(o-s),_=-2*o*s/(o-s);else if(a===Nx)p=-o/(o-s),_=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=_,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,r,i,s,o,a=ka){const l=this.elements,c=1/(t-e),u=1/(r-i),h=1/(o-s),f=(t+e)*c,p=(r+i)*u;let _,y;if(a===ka)_=(o+s)*h,y=-2*h;else if(a===Nx)_=s*h,y=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=y,l[14]=-_,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Gd=new N,Ks=new ot,y7=new N(0,0,0),w7=new N(1,1,1),ml=new N,i0=new N,Ki=new N,KI=new ot,$I=new Wn;class vo{constructor(e=0,t=0,r=0,i=vo.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,s=i[0],o=i[4],a=i[8],l=i[1],c=i[5],u=i[9],h=i[2],f=i[6],p=i[10];switch(t){case"XYZ":this._y=Math.asin(ti(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-ti(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(ti(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-ti(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(ti(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-ti(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return KI.makeRotationFromQuaternion(e),this.setFromRotationMatrix(KI,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return $I.setFromEuler(this),this.setFromQuaternion($I,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}vo.DEFAULT_ORDER="XYZ";class BA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let S7=0;const XI=new N,Wd=new Wn,pa=new ot,s0=new N,Wp=new N,E7=new N,T7=new Wn,qI=new N(1,0,0),ZI=new N(0,1,0),QI=new N(0,0,1),C7={type:"added"},b7={type:"removed"},uE={type:"childadded",child:null},dE={type:"childremoved",child:null};class ar extends bp{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:S7++}),this.uuid=Ap(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ar.DEFAULT_UP.clone();const e=new N,t=new vo,r=new Wn,i=new N(1,1,1);function s(){r.setFromEuler(t,!1)}function o(){t.setFromQuaternion(r,void 0,!1)}t._onChange(s),r._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ot},normalMatrix:{value:new Ct}}),this.matrix=new ot,this.matrixWorld=new ot,this.matrixAutoUpdate=ar.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ar.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new BA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Wd.setFromAxisAngle(e,t),this.quaternion.multiply(Wd),this}rotateOnWorldAxis(e,t){return Wd.setFromAxisAngle(e,t),this.quaternion.premultiply(Wd),this}rotateX(e){return this.rotateOnAxis(qI,e)}rotateY(e){return this.rotateOnAxis(ZI,e)}rotateZ(e){return this.rotateOnAxis(QI,e)}translateOnAxis(e,t){return XI.copy(e).applyQuaternion(this.quaternion),this.position.add(XI.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(qI,e)}translateY(e){return this.translateOnAxis(ZI,e)}translateZ(e){return this.translateOnAxis(QI,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(pa.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?s0.copy(e):s0.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Wp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?pa.lookAt(Wp,s0,this.up):pa.lookAt(s0,Wp,this.up),this.quaternion.setFromRotationMatrix(pa),i&&(pa.extractRotation(i.matrixWorld),Wd.setFromRotationMatrix(pa),this.quaternion.premultiply(Wd.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(C7),uE.child=e,this.dispatchEvent(uE),uE.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(b7),dE.child=e,this.dispatchEvent(dE),dE.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),pa.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),pa.multiply(e.parent.matrixWorld)),e.applyMatrix4(pa),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const o=this.children[r].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wp,e,E7),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wp,T7,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++){const s=t[r];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++){const a=i[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];i.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),h=o(e.shapes),f=o(e.skeletons),p=o(e.animations),_=o(e.nodes);a.length>0&&(r.geometries=a),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),p.length>0&&(r.animations=p),_.length>0&&(r.nodes=_)}return r.object=i,r;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}ar.DEFAULT_UP=new N(0,1,0);ar.DEFAULT_MATRIX_AUTO_UPDATE=!0;ar.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const $s=new N,ma=new N,hE=new N,ga=new N,Yd=new N,Kd=new N,JI=new N,fE=new N,pE=new N,mE=new N;class lo{constructor(e=new N,t=new N,r=new N){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),$s.subVectors(e,t),i.cross($s);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,r,i,s){$s.subVectors(i,t),ma.subVectors(r,t),hE.subVectors(e,t);const o=$s.dot($s),a=$s.dot(ma),l=$s.dot(hE),c=ma.dot(ma),u=ma.dot(hE),h=o*c-a*a;if(h===0)return s.set(0,0,0),null;const f=1/h,p=(c*l-a*u)*f,_=(o*u-a*l)*f;return s.set(1-p-_,_,p)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,ga)===null?!1:ga.x>=0&&ga.y>=0&&ga.x+ga.y<=1}static getInterpolation(e,t,r,i,s,o,a,l){return this.getBarycoord(e,t,r,i,ga)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,ga.x),l.addScaledVector(o,ga.y),l.addScaledVector(a,ga.z),l)}static isFrontFacing(e,t,r,i){return $s.subVectors(r,t),ma.subVectors(e,t),$s.cross(ma).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return $s.subVectors(this.c,this.b),ma.subVectors(this.a,this.b),$s.cross(ma).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return lo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return lo.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,s){return lo.getInterpolation(e,this.a,this.b,this.c,t,r,i,s)}containsPoint(e){return lo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return lo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,s=this.c;let o,a;Yd.subVectors(i,r),Kd.subVectors(s,r),fE.subVectors(e,r);const l=Yd.dot(fE),c=Kd.dot(fE);if(l<=0&&c<=0)return t.copy(r);pE.subVectors(e,i);const u=Yd.dot(pE),h=Kd.dot(pE);if(u>=0&&h<=u)return t.copy(i);const f=l*h-u*c;if(f<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(r).addScaledVector(Yd,o);mE.subVectors(e,s);const p=Yd.dot(mE),_=Kd.dot(mE);if(_>=0&&p<=_)return t.copy(s);const y=p*c-l*_;if(y<=0&&c>=0&&_<=0)return a=c/(c-_),t.copy(r).addScaledVector(Kd,a);const g=u*_-p*h;if(g<=0&&h-u>=0&&p-_>=0)return JI.subVectors(s,i),a=(h-u)/(h-u+(p-_)),t.copy(i).addScaledVector(JI,a);const m=1/(g+y+f);return o=y*m,a=f*m,t.copy(r).addScaledVector(Yd,o).addScaledVector(Kd,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const PU={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},gl={h:0,s:0,l:0},o0={h:0,s:0,l:0};function gE(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class at{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ns){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Jt.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=Jt.workingColorSpace){return this.r=e,this.g=t,this.b=r,Jt.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=Jt.workingColorSpace){if(e=FA(e,1),t=ti(t,0,1),r=ti(r,0,1),t===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+t):r+t-r*t,o=2*r-s;this.r=gE(o,s,e+1/3),this.g=gE(o,s,e),this.b=gE(o,s,e-1/3)}return Jt.toWorkingColorSpace(this,i),this}setStyle(e,t=Ns){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ns){const r=PU[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=wf(e.r),this.g=wf(e.g),this.b=wf(e.b),this}copyLinearToSRGB(e){return this.r=nE(e.r),this.g=nE(e.g),this.b=nE(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ns){return Jt.fromWorkingColorSpace(Gr.copy(this),e),Math.round(ti(Gr.r*255,0,255))*65536+Math.round(ti(Gr.g*255,0,255))*256+Math.round(ti(Gr.b*255,0,255))}getHexString(e=Ns){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Jt.workingColorSpace){Jt.fromWorkingColorSpace(Gr.copy(this),t);const r=Gr.r,i=Gr.g,s=Gr.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const h=o-a;switch(c=u<=.5?h/(o+a):h/(2-o-a),o){case r:l=(i-s)/h+(i<s?6:0);break;case i:l=(s-r)/h+2;break;case s:l=(r-i)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Jt.workingColorSpace){return Jt.fromWorkingColorSpace(Gr.copy(this),t),e.r=Gr.r,e.g=Gr.g,e.b=Gr.b,e}getStyle(e=Ns){Jt.fromWorkingColorSpace(Gr.copy(this),e);const t=Gr.r,r=Gr.g,i=Gr.b;return e!==Ns?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(gl),this.setHSL(gl.h+e,gl.s+t,gl.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(gl),e.getHSL(o0);const r=og(gl.h,o0.h,t),i=og(gl.s,o0.s,t),s=og(gl.l,o0.l,t);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*r+s[6]*i,this.g=s[1]*t+s[4]*r+s[7]*i,this.b=s[2]*t+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Gr=new at;at.NAMES=PU;let A7=0;class Mp extends bp{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:A7++}),this.uuid=Ap(),this.name="",this.type="Material",this.blending=xf,this.side=$a,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=bC,this.blendDst=AC,this.blendEquation=gu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new at(0,0,0),this.blendAlpha=0,this.depthFunc=Tx,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=jI,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=jd,this.stencilZFail=jd,this.stencilZPass=jd,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==xf&&(r.blending=this.blending),this.side!==$a&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==bC&&(r.blendSrc=this.blendSrc),this.blendDst!==AC&&(r.blendDst=this.blendDst),this.blendEquation!==gu&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==Tx&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==jI&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==jd&&(r.stencilFail=this.stencilFail),this.stencilZFail!==jd&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==jd&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=i(e.textures),o=i(e.images);s.length>0&&(r.textures=s),o.length>0&&(r.images=o)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=t[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class al extends Mp{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new at(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vo,this.combine=hU,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const tr=new N,a0=new gt;class Dn{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=zI,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Na,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return f7("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)a0.fromBufferAttribute(this,t),a0.applyMatrix3(e),this.setXY(t,a0.x,a0.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)tr.fromBufferAttribute(this,t),tr.applyMatrix3(e),this.setXYZ(t,tr.x,tr.y,tr.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)tr.fromBufferAttribute(this,t),tr.applyMatrix4(e),this.setXYZ(t,tr.x,tr.y,tr.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)tr.fromBufferAttribute(this,t),tr.applyNormalMatrix(e),this.setXYZ(t,tr.x,tr.y,tr.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)tr.fromBufferAttribute(this,t),tr.transformDirection(e),this.setXYZ(t,tr.x,tr.y,tr.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=Ph(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=di(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Ph(t,this.array)),t}setX(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Ph(t,this.array)),t}setY(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Ph(t,this.array)),t}setZ(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Ph(t,this.array)),t}setW(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),r=di(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),r=di(r,this.array),i=di(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),r=di(r,this.array),i=di(i,this.array),s=di(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==zI&&(e.usage=this.usage),e}}class kU extends Dn{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class LU extends Dn{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Wt extends Dn{constructor(e,t,r){super(new Float32Array(e),t,r)}}let M7=0;const ws=new ot,vE=new ar,$d=new N,$i=new et,Yp=new et,Er=new N;class xn extends bp{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:M7++}),this.uuid=Ap(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(RU(e)?LU:kU)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new Ct().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ws.makeRotationFromQuaternion(e),this.applyMatrix4(ws),this}rotateX(e){return ws.makeRotationX(e),this.applyMatrix4(ws),this}rotateY(e){return ws.makeRotationY(e),this.applyMatrix4(ws),this}rotateZ(e){return ws.makeRotationZ(e),this.applyMatrix4(ws),this}translate(e,t,r){return ws.makeTranslation(e,t,r),this.applyMatrix4(ws),this}scale(e,t,r){return ws.makeScale(e,t,r),this.applyMatrix4(ws),this}lookAt(e){return vE.lookAt(e),vE.updateMatrix(),this.applyMatrix4(vE.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter($d).negate(),this.translate($d.x,$d.y,$d.z),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const s=e[r];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Wt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new et);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new N(-1/0,-1/0,-1/0),new N(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const s=t[r];$i.setFromBufferAttribute(s),this.morphTargetsRelative?(Er.addVectors(this.boundingBox.min,$i.min),this.boundingBox.expandByPoint(Er),Er.addVectors(this.boundingBox.max,$i.max),this.boundingBox.expandByPoint(Er)):(this.boundingBox.expandByPoint($i.min),this.boundingBox.expandByPoint($i.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Tv);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new N,1/0);return}if(e){const r=this.boundingSphere.center;if($i.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];Yp.setFromBufferAttribute(a),this.morphTargetsRelative?(Er.addVectors($i.min,Yp.min),$i.expandByPoint(Er),Er.addVectors($i.max,Yp.max),$i.expandByPoint(Er)):($i.expandByPoint(Yp.min),$i.expandByPoint(Yp.max))}$i.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)Er.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(Er));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)Er.fromBufferAttribute(a,c),l&&($d.fromBufferAttribute(e,c),Er.add($d)),i=Math.max(i,r.distanceToSquared(Er))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Dn(new Float32Array(4*r.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let A=0;A<r.count;A++)a[A]=new N,l[A]=new N;const c=new N,u=new N,h=new N,f=new gt,p=new gt,_=new gt,y=new N,g=new N;function m(A,k,T){c.fromBufferAttribute(r,A),u.fromBufferAttribute(r,k),h.fromBufferAttribute(r,T),f.fromBufferAttribute(s,A),p.fromBufferAttribute(s,k),_.fromBufferAttribute(s,T),u.sub(c),h.sub(c),p.sub(f),_.sub(f);const R=1/(p.x*_.y-_.x*p.y);isFinite(R)&&(y.copy(u).multiplyScalar(_.y).addScaledVector(h,-p.y).multiplyScalar(R),g.copy(h).multiplyScalar(p.x).addScaledVector(u,-_.x).multiplyScalar(R),a[A].add(y),a[k].add(y),a[T].add(y),l[A].add(g),l[k].add(g),l[T].add(g))}let v=this.groups;v.length===0&&(v=[{start:0,count:e.count}]);for(let A=0,k=v.length;A<k;++A){const T=v[A],R=T.start,$=T.count;for(let P=R,M=R+$;P<M;P+=3)m(e.getX(P+0),e.getX(P+1),e.getX(P+2))}const x=new N,w=new N,E=new N,S=new N;function C(A){E.fromBufferAttribute(i,A),S.copy(E);const k=a[A];x.copy(k),x.sub(E.multiplyScalar(E.dot(k))).normalize(),w.crossVectors(S,k);const R=w.dot(l[A])<0?-1:1;o.setXYZW(A,x.x,x.y,x.z,R)}for(let A=0,k=v.length;A<k;++A){const T=v[A],R=T.start,$=T.count;for(let P=R,M=R+$;P<M;P+=3)C(e.getX(P+0)),C(e.getX(P+1)),C(e.getX(P+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Dn(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let f=0,p=r.count;f<p;f++)r.setXYZ(f,0,0,0);const i=new N,s=new N,o=new N,a=new N,l=new N,c=new N,u=new N,h=new N;if(e)for(let f=0,p=e.count;f<p;f+=3){const _=e.getX(f+0),y=e.getX(f+1),g=e.getX(f+2);i.fromBufferAttribute(t,_),s.fromBufferAttribute(t,y),o.fromBufferAttribute(t,g),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),a.fromBufferAttribute(r,_),l.fromBufferAttribute(r,y),c.fromBufferAttribute(r,g),a.add(u),l.add(u),c.add(u),r.setXYZ(_,a.x,a.y,a.z),r.setXYZ(y,l.x,l.y,l.z),r.setXYZ(g,c.x,c.y,c.z)}else for(let f=0,p=t.count;f<p;f+=3)i.fromBufferAttribute(t,f+0),s.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),r.setXYZ(f+0,u.x,u.y,u.z),r.setXYZ(f+1,u.x,u.y,u.z),r.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Er.fromBufferAttribute(e,t),Er.normalize(),e.setXYZ(t,Er.x,Er.y,Er.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,f=new c.constructor(l.length*u);let p=0,_=0;for(let y=0,g=l.length;y<g;y++){a.isInterleavedBufferAttribute?p=l[y]*a.data.stride+a.offset:p=l[y]*u;for(let m=0;m<u;m++)f[_++]=c[p++]}return new Dn(f,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new xn,r=this.index.array,i=this.attributes;for(const a in i){const l=i[a],c=e(l,r);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,h=c.length;u<h;u++){const f=c[u],p=e(f,r);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const i={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,f=c.length;h<f;h++){const p=c[h];u.push(p.toJSON(e.data))}u.length>0&&(i[l]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const i=e.attributes;for(const c in i){const u=i[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let f=0,p=h.length;f<p;f++)u.push(h[f].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const h=o[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const eP=new ot,Vc=new zA,l0=new Tv,tP=new N,Xd=new N,qd=new N,Zd=new N,_E=new N,c0=new N,u0=new gt,d0=new gt,h0=new gt,nP=new N,rP=new N,iP=new N,f0=new N,p0=new N;class Be extends ar{constructor(e=new xn,t=new al){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,o=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){c0.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l],h=s[l];u!==0&&(_E.fromBufferAttribute(h,e),o?c0.addScaledVector(_E,u):c0.addScaledVector(_E.sub(t),u))}t.add(c0)}return t}raycast(e,t){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),l0.copy(r.boundingSphere),l0.applyMatrix4(s),Vc.copy(e.ray).recast(e.near),!(l0.containsPoint(Vc.origin)===!1&&(Vc.intersectSphere(l0,tP)===null||Vc.origin.distanceToSquared(tP)>(e.far-e.near)**2))&&(eP.copy(s).invert(),Vc.copy(e.ray).applyMatrix4(eP),!(r.boundingBox!==null&&Vc.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,Vc)))}_computeIntersections(e,t,r){let i;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,f=s.groups,p=s.drawRange;if(a!==null)if(Array.isArray(o))for(let _=0,y=f.length;_<y;_++){const g=f[_],m=o[g.materialIndex],v=Math.max(g.start,p.start),x=Math.min(a.count,Math.min(g.start+g.count,p.start+p.count));for(let w=v,E=x;w<E;w+=3){const S=a.getX(w),C=a.getX(w+1),A=a.getX(w+2);i=m0(this,m,e,r,c,u,h,S,C,A),i&&(i.faceIndex=Math.floor(w/3),i.face.materialIndex=g.materialIndex,t.push(i))}}else{const _=Math.max(0,p.start),y=Math.min(a.count,p.start+p.count);for(let g=_,m=y;g<m;g+=3){const v=a.getX(g),x=a.getX(g+1),w=a.getX(g+2);i=m0(this,o,e,r,c,u,h,v,x,w),i&&(i.faceIndex=Math.floor(g/3),t.push(i))}}else if(l!==void 0)if(Array.isArray(o))for(let _=0,y=f.length;_<y;_++){const g=f[_],m=o[g.materialIndex],v=Math.max(g.start,p.start),x=Math.min(l.count,Math.min(g.start+g.count,p.start+p.count));for(let w=v,E=x;w<E;w+=3){const S=w,C=w+1,A=w+2;i=m0(this,m,e,r,c,u,h,S,C,A),i&&(i.faceIndex=Math.floor(w/3),i.face.materialIndex=g.materialIndex,t.push(i))}}else{const _=Math.max(0,p.start),y=Math.min(l.count,p.start+p.count);for(let g=_,m=y;g<m;g+=3){const v=g,x=g+1,w=g+2;i=m0(this,o,e,r,c,u,h,v,x,w),i&&(i.faceIndex=Math.floor(g/3),t.push(i))}}}}function R7(n,e,t,r,i,s,o,a){let l;if(e.side===ji?l=r.intersectTriangle(o,s,i,!0,a):l=r.intersectTriangle(i,s,o,e.side===$a,a),l===null)return null;p0.copy(a),p0.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(p0);return c<t.near||c>t.far?null:{distance:c,point:p0.clone(),object:n}}function m0(n,e,t,r,i,s,o,a,l,c){n.getVertexPosition(a,Xd),n.getVertexPosition(l,qd),n.getVertexPosition(c,Zd);const u=R7(n,e,t,r,Xd,qd,Zd,f0);if(u){i&&(u0.fromBufferAttribute(i,a),d0.fromBufferAttribute(i,l),h0.fromBufferAttribute(i,c),u.uv=lo.getInterpolation(f0,Xd,qd,Zd,u0,d0,h0,new gt)),s&&(u0.fromBufferAttribute(s,a),d0.fromBufferAttribute(s,l),h0.fromBufferAttribute(s,c),u.uv1=lo.getInterpolation(f0,Xd,qd,Zd,u0,d0,h0,new gt)),o&&(nP.fromBufferAttribute(o,a),rP.fromBufferAttribute(o,l),iP.fromBufferAttribute(o,c),u.normal=lo.getInterpolation(f0,Xd,qd,Zd,nP,rP,iP,new N),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:l,c,normal:new N,materialIndex:0};lo.getNormal(Xd,qd,Zd,h.normal),u.face=h}return u}class En extends xn{constructor(e=1,t=1,r=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],h=[];let f=0,p=0;_("z","y","x",-1,-1,r,t,e,o,s,0),_("z","y","x",1,-1,r,t,-e,o,s,1),_("x","z","y",1,1,e,r,t,i,o,2),_("x","z","y",1,-1,e,r,-t,i,o,3),_("x","y","z",1,-1,e,t,r,i,s,4),_("x","y","z",-1,-1,e,t,-r,i,s,5),this.setIndex(l),this.setAttribute("position",new Wt(c,3)),this.setAttribute("normal",new Wt(u,3)),this.setAttribute("uv",new Wt(h,2));function _(y,g,m,v,x,w,E,S,C,A,k){const T=w/C,R=E/A,$=w/2,P=E/2,M=S/2,I=C+1,j=A+1;let O=0,z=0;const B=new N;for(let L=0;L<j;L++){const D=L*R-P;for(let W=0;W<I;W++){const H=W*T-$;B[y]=H*v,B[g]=D*x,B[m]=M,c.push(B.x,B.y,B.z),B[y]=0,B[g]=0,B[m]=S>0?1:-1,u.push(B.x,B.y,B.z),h.push(W/C),h.push(1-L/A),O+=1}}for(let L=0;L<A;L++)for(let D=0;D<C;D++){const W=f+D+I*L,H=f+D+I*(L+1),K=f+(D+1)+I*(L+1),oe=f+(D+1)+I*L;l.push(W,H,oe),l.push(H,K,oe),z+=6}a.addGroup(p,z,k),p+=z,f+=O}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new En(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Zf(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function hi(n){const e={};for(let t=0;t<n.length;t++){const r=Zf(n[t]);for(const i in r)e[i]=r[i]}return e}function N7(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function OU(n){return n.getRenderTarget()===null?n.outputColorSpace:Jt.workingColorSpace}const Lw={clone:Zf,merge:hi};var I7=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,P7=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class fs extends Mp{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=I7,this.fragmentShader=P7,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Zf(e.uniforms),this.uniformsGroups=N7(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class DU extends ar{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ot,this.projectionMatrix=new ot,this.projectionMatrixInverse=new ot,this.coordinateSystem=ka}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const vl=new N,sP=new gt,oP=new gt;class Ni extends DU{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Ug*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(yf*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Ug*2*Math.atan(Math.tan(yf*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){vl.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(vl.x,vl.y).multiplyScalar(-e/vl.z),vl.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(vl.x,vl.y).multiplyScalar(-e/vl.z)}getViewSize(e,t){return this.getViewBounds(e,sP,oP),t.subVectors(oP,sP)}setViewOffset(e,t,r,i,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(yf*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*i/l,t-=o.offsetY*r/c,i*=o.width/l,r*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Qd=-90,Jd=1;class k7 extends ar{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Ni(Qd,Jd,e,t);i.layers=this.layers,this.add(i);const s=new Ni(Qd,Jd,e,t);s.layers=this.layers,this.add(s);const o=new Ni(Qd,Jd,e,t);o.layers=this.layers,this.add(o);const a=new Ni(Qd,Jd,e,t);a.layers=this.layers,this.add(a);const l=new Ni(Qd,Jd,e,t);l.layers=this.layers,this.add(l);const c=new Ni(Qd,Jd,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===ka)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Nx)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,u]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),_=e.xr.enabled;e.xr.enabled=!1;const y=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,s),e.setRenderTarget(r,1,i),e.render(t,o),e.setRenderTarget(r,2,i),e.render(t,a),e.setRenderTarget(r,3,i),e.render(t,l),e.setRenderTarget(r,4,i),e.render(t,c),r.texture.generateMipmaps=y,e.setRenderTarget(r,5,i),e.render(t,u),e.setRenderTarget(h,f,p),e.xr.enabled=_,r.texture.needsPMREMUpdate=!0}}class UU extends si{constructor(e,t,r,i,s,o,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:$f,super(e,t,r,i,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class L7 extends zs{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new UU(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:mi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new En(5,5,5),s=new fs({name:"CubemapFromEquirect",uniforms:Zf(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:ji,blending:Fa});s.uniforms.tEquirect.value=t;const o=new Be(i,s),a=t.minFilter;return t.minFilter===$l&&(t.minFilter=mi),new k7(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,r,i){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,r,i);e.setRenderTarget(s)}}const xE=new N,O7=new N,D7=new Ct;class Fo{constructor(e=new N(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=xE.subVectors(r,t).cross(O7.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(xE),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||D7.getNormalMatrix(e),i=this.coplanarPoint(xE).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Gc=new Tv,g0=new N;class HA{constructor(e=new Fo,t=new Fo,r=new Fo,i=new Fo,s=new Fo,o=new Fo){this.planes=[e,t,r,i,s,o]}set(e,t,r,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=ka){const r=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],l=i[3],c=i[4],u=i[5],h=i[6],f=i[7],p=i[8],_=i[9],y=i[10],g=i[11],m=i[12],v=i[13],x=i[14],w=i[15];if(r[0].setComponents(l-s,f-c,g-p,w-m).normalize(),r[1].setComponents(l+s,f+c,g+p,w+m).normalize(),r[2].setComponents(l+o,f+u,g+_,w+v).normalize(),r[3].setComponents(l-o,f-u,g-_,w-v).normalize(),r[4].setComponents(l-a,f-h,g-y,w-x).normalize(),t===ka)r[5].setComponents(l+a,f+h,g+y,w+x).normalize();else if(t===Nx)r[5].setComponents(a,h,y,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Gc.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Gc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Gc)}intersectsSprite(e){return Gc.center.set(0,0,0),Gc.radius=.7071067811865476,Gc.applyMatrix4(e.matrixWorld),this.intersectsSphere(Gc)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(g0.x=i.normal.x>0?e.max.x:e.min.x,g0.y=i.normal.y>0?e.max.y:e.min.y,g0.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(g0)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function FU(){let n=null,e=!1,t=null,r=null;function i(s,o){t(s,o),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function U7(n,e){const t=e.isWebGL2,r=new WeakMap;function i(c,u){const h=c.array,f=c.usage,p=h.byteLength,_=n.createBuffer();n.bindBuffer(u,_),n.bufferData(u,h,f),c.onUploadCallback();let y;if(h instanceof Float32Array)y=n.FLOAT;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)y=n.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else y=n.UNSIGNED_SHORT;else if(h instanceof Int16Array)y=n.SHORT;else if(h instanceof Uint32Array)y=n.UNSIGNED_INT;else if(h instanceof Int32Array)y=n.INT;else if(h instanceof Int8Array)y=n.BYTE;else if(h instanceof Uint8Array)y=n.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)y=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:_,type:y,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version,size:p}}function s(c,u,h){const f=u.array,p=u._updateRange,_=u.updateRanges;if(n.bindBuffer(h,c),p.count===-1&&_.length===0&&n.bufferSubData(h,0,f),_.length!==0){for(let y=0,g=_.length;y<g;y++){const m=_[y];t?n.bufferSubData(h,m.start*f.BYTES_PER_ELEMENT,f,m.start,m.count):n.bufferSubData(h,m.start*f.BYTES_PER_ELEMENT,f.subarray(m.start,m.start+m.count))}u.clearUpdateRanges()}p.count!==-1&&(t?n.bufferSubData(h,p.offset*f.BYTES_PER_ELEMENT,f,p.offset,p.count):n.bufferSubData(h,p.offset*f.BYTES_PER_ELEMENT,f.subarray(p.offset,p.offset+p.count)),p.count=-1),u.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=r.get(c);u&&(n.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const f=r.get(c);(!f||f.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=r.get(c);if(h===void 0)r.set(c,i(c,u));else if(h.version<c.version){if(h.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");s(h.buffer,c,u),h.version=c.version}}return{get:o,remove:a,update:l}}class Rp extends xn{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const s=e/2,o=t/2,a=Math.floor(r),l=Math.floor(i),c=a+1,u=l+1,h=e/a,f=t/l,p=[],_=[],y=[],g=[];for(let m=0;m<u;m++){const v=m*f-o;for(let x=0;x<c;x++){const w=x*h-s;_.push(w,-v,0),y.push(0,0,1),g.push(x/a),g.push(1-m/l)}}for(let m=0;m<l;m++)for(let v=0;v<a;v++){const x=v+c*m,w=v+c*(m+1),E=v+1+c*(m+1),S=v+1+c*m;p.push(x,w,S),p.push(w,E,S)}this.setIndex(p),this.setAttribute("position",new Wt(_,3)),this.setAttribute("normal",new Wt(y,3)),this.setAttribute("uv",new Wt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rp(e.width,e.height,e.widthSegments,e.heightSegments)}}var F7=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,j7=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,z7=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,B7=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,H7=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,V7=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,G7=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,W7=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Y7=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,K7=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,$7=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,X7=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,q7=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Z7=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Q7=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,J7=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,eV=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,tV=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,nV=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,rV=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,iV=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,sV=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,oV=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,aV=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,lV=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,cV=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,uV=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,dV=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,hV=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,fV=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,pV="gl_FragColor = linearToOutputTexel( gl_FragColor );",mV=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,gV=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,vV=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,_V=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,xV=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,yV=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,wV=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,SV=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,EV=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,TV=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,CV=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,bV=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,AV=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,MV=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,RV=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,NV=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,IV=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,PV=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,kV=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,LV=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,OV=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,DV=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,UV=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,FV=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,jV=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,zV=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,BV=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,HV=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,VV=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,GV=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,WV=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,YV=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,KV=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,$V=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,XV=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,qV=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,ZV=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,QV=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,JV=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,eG=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,tG=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,nG=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,rG=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,iG=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,sG=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,oG=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,aG=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,lG=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,cG=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,uG=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,dG=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,hG=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,fG=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,pG=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,mG=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,gG=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,vG=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,_G=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,xG=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,yG=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,wG=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,SG=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,EG=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,TG=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,CG=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,bG=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,AG=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,MG=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,RG=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,NG=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,IG=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	float startCompression = 0.8 - 0.04;
	float desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min(color.r, min(color.g, color.b));
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max(color.r, max(color.g, color.b));
	if (peak < startCompression) return color;
	float d = 1. - startCompression;
	float newPeak = 1. - d * d / (peak + d - startCompression);
	color *= newPeak / peak;
	float g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);
	return mix(color, vec3(1, 1, 1), g);
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,PG=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,kG=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,LG=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,OG=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,DG=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,UG=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const FG=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,jG=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,zG=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,BG=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,HG=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,VG=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,GG=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,WG=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,YG=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,KG=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,$G=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,XG=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,qG=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ZG=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,QG=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,JG=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,eW=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,tW=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,nW=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,rW=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,iW=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,sW=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,oW=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,aW=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lW=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,cW=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uW=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dW=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hW=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fW=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,pW=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,mW=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,gW=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,vW=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Tt={alphahash_fragment:F7,alphahash_pars_fragment:j7,alphamap_fragment:z7,alphamap_pars_fragment:B7,alphatest_fragment:H7,alphatest_pars_fragment:V7,aomap_fragment:G7,aomap_pars_fragment:W7,batching_pars_vertex:Y7,batching_vertex:K7,begin_vertex:$7,beginnormal_vertex:X7,bsdfs:q7,iridescence_fragment:Z7,bumpmap_pars_fragment:Q7,clipping_planes_fragment:J7,clipping_planes_pars_fragment:eV,clipping_planes_pars_vertex:tV,clipping_planes_vertex:nV,color_fragment:rV,color_pars_fragment:iV,color_pars_vertex:sV,color_vertex:oV,common:aV,cube_uv_reflection_fragment:lV,defaultnormal_vertex:cV,displacementmap_pars_vertex:uV,displacementmap_vertex:dV,emissivemap_fragment:hV,emissivemap_pars_fragment:fV,colorspace_fragment:pV,colorspace_pars_fragment:mV,envmap_fragment:gV,envmap_common_pars_fragment:vV,envmap_pars_fragment:_V,envmap_pars_vertex:xV,envmap_physical_pars_fragment:IV,envmap_vertex:yV,fog_vertex:wV,fog_pars_vertex:SV,fog_fragment:EV,fog_pars_fragment:TV,gradientmap_pars_fragment:CV,lightmap_fragment:bV,lightmap_pars_fragment:AV,lights_lambert_fragment:MV,lights_lambert_pars_fragment:RV,lights_pars_begin:NV,lights_toon_fragment:PV,lights_toon_pars_fragment:kV,lights_phong_fragment:LV,lights_phong_pars_fragment:OV,lights_physical_fragment:DV,lights_physical_pars_fragment:UV,lights_fragment_begin:FV,lights_fragment_maps:jV,lights_fragment_end:zV,logdepthbuf_fragment:BV,logdepthbuf_pars_fragment:HV,logdepthbuf_pars_vertex:VV,logdepthbuf_vertex:GV,map_fragment:WV,map_pars_fragment:YV,map_particle_fragment:KV,map_particle_pars_fragment:$V,metalnessmap_fragment:XV,metalnessmap_pars_fragment:qV,morphinstance_vertex:ZV,morphcolor_vertex:QV,morphnormal_vertex:JV,morphtarget_pars_vertex:eG,morphtarget_vertex:tG,normal_fragment_begin:nG,normal_fragment_maps:rG,normal_pars_fragment:iG,normal_pars_vertex:sG,normal_vertex:oG,normalmap_pars_fragment:aG,clearcoat_normal_fragment_begin:lG,clearcoat_normal_fragment_maps:cG,clearcoat_pars_fragment:uG,iridescence_pars_fragment:dG,opaque_fragment:hG,packing:fG,premultiplied_alpha_fragment:pG,project_vertex:mG,dithering_fragment:gG,dithering_pars_fragment:vG,roughnessmap_fragment:_G,roughnessmap_pars_fragment:xG,shadowmap_pars_fragment:yG,shadowmap_pars_vertex:wG,shadowmap_vertex:SG,shadowmask_pars_fragment:EG,skinbase_vertex:TG,skinning_pars_vertex:CG,skinning_vertex:bG,skinnormal_vertex:AG,specularmap_fragment:MG,specularmap_pars_fragment:RG,tonemapping_fragment:NG,tonemapping_pars_fragment:IG,transmission_fragment:PG,transmission_pars_fragment:kG,uv_pars_fragment:LG,uv_pars_vertex:OG,uv_vertex:DG,worldpos_vertex:UG,background_vert:FG,background_frag:jG,backgroundCube_vert:zG,backgroundCube_frag:BG,cube_vert:HG,cube_frag:VG,depth_vert:GG,depth_frag:WG,distanceRGBA_vert:YG,distanceRGBA_frag:KG,equirect_vert:$G,equirect_frag:XG,linedashed_vert:qG,linedashed_frag:ZG,meshbasic_vert:QG,meshbasic_frag:JG,meshlambert_vert:eW,meshlambert_frag:tW,meshmatcap_vert:nW,meshmatcap_frag:rW,meshnormal_vert:iW,meshnormal_frag:sW,meshphong_vert:oW,meshphong_frag:aW,meshphysical_vert:lW,meshphysical_frag:cW,meshtoon_vert:uW,meshtoon_frag:dW,points_vert:hW,points_frag:fW,shadow_vert:pW,shadow_frag:mW,sprite_vert:gW,sprite_frag:vW},je={common:{diffuse:{value:new at(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ct},alphaMap:{value:null},alphaMapTransform:{value:new Ct},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ct}},envmap:{envMap:{value:null},envMapRotation:{value:new Ct},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ct}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ct}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ct},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ct},normalScale:{value:new gt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ct},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ct}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ct}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ct}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new at(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new at(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ct},alphaTest:{value:0},uvTransform:{value:new Ct}},sprite:{diffuse:{value:new at(16777215)},opacity:{value:1},center:{value:new gt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ct},alphaMap:{value:null},alphaMapTransform:{value:new Ct},alphaTest:{value:0}}},jo={basic:{uniforms:hi([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.fog]),vertexShader:Tt.meshbasic_vert,fragmentShader:Tt.meshbasic_frag},lambert:{uniforms:hi([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.fog,je.lights,{emissive:{value:new at(0)}}]),vertexShader:Tt.meshlambert_vert,fragmentShader:Tt.meshlambert_frag},phong:{uniforms:hi([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.fog,je.lights,{emissive:{value:new at(0)},specular:{value:new at(1118481)},shininess:{value:30}}]),vertexShader:Tt.meshphong_vert,fragmentShader:Tt.meshphong_frag},standard:{uniforms:hi([je.common,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.roughnessmap,je.metalnessmap,je.fog,je.lights,{emissive:{value:new at(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Tt.meshphysical_vert,fragmentShader:Tt.meshphysical_frag},toon:{uniforms:hi([je.common,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.gradientmap,je.fog,je.lights,{emissive:{value:new at(0)}}]),vertexShader:Tt.meshtoon_vert,fragmentShader:Tt.meshtoon_frag},matcap:{uniforms:hi([je.common,je.bumpmap,je.normalmap,je.displacementmap,je.fog,{matcap:{value:null}}]),vertexShader:Tt.meshmatcap_vert,fragmentShader:Tt.meshmatcap_frag},points:{uniforms:hi([je.points,je.fog]),vertexShader:Tt.points_vert,fragmentShader:Tt.points_frag},dashed:{uniforms:hi([je.common,je.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Tt.linedashed_vert,fragmentShader:Tt.linedashed_frag},depth:{uniforms:hi([je.common,je.displacementmap]),vertexShader:Tt.depth_vert,fragmentShader:Tt.depth_frag},normal:{uniforms:hi([je.common,je.bumpmap,je.normalmap,je.displacementmap,{opacity:{value:1}}]),vertexShader:Tt.meshnormal_vert,fragmentShader:Tt.meshnormal_frag},sprite:{uniforms:hi([je.sprite,je.fog]),vertexShader:Tt.sprite_vert,fragmentShader:Tt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ct},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Tt.background_vert,fragmentShader:Tt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ct}},vertexShader:Tt.backgroundCube_vert,fragmentShader:Tt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Tt.cube_vert,fragmentShader:Tt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Tt.equirect_vert,fragmentShader:Tt.equirect_frag},distanceRGBA:{uniforms:hi([je.common,je.displacementmap,{referencePosition:{value:new N},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Tt.distanceRGBA_vert,fragmentShader:Tt.distanceRGBA_frag},shadow:{uniforms:hi([je.lights,je.fog,{color:{value:new at(0)},opacity:{value:1}}]),vertexShader:Tt.shadow_vert,fragmentShader:Tt.shadow_frag}};jo.physical={uniforms:hi([jo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ct},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ct},clearcoatNormalScale:{value:new gt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ct},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ct},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ct},sheen:{value:0},sheenColor:{value:new at(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ct},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ct},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ct},transmissionSamplerSize:{value:new gt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ct},attenuationDistance:{value:0},attenuationColor:{value:new at(0)},specularColor:{value:new at(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ct},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ct},anisotropyVector:{value:new gt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ct}}]),vertexShader:Tt.meshphysical_vert,fragmentShader:Tt.meshphysical_frag};const v0={r:0,b:0,g:0},Wc=new vo,_W=new ot;function xW(n,e,t,r,i,s,o){const a=new at(0);let l=s===!0?0:1,c,u,h=null,f=0,p=null;function _(g,m){let v=!1,x=m.isScene===!0?m.background:null;x&&x.isTexture&&(x=(m.backgroundBlurriness>0?t:e).get(x)),x===null?y(a,l):x&&x.isColor&&(y(x,1),v=!0);const w=n.xr.getEnvironmentBlendMode();w==="additive"?r.buffers.color.setClear(0,0,0,1,o):w==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,o),(n.autoClear||v)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),x&&(x.isCubeTexture||x.mapping===Pw)?(u===void 0&&(u=new Be(new En(1,1,1),new fs({name:"BackgroundCubeMaterial",uniforms:Zf(jo.backgroundCube.uniforms),vertexShader:jo.backgroundCube.vertexShader,fragmentShader:jo.backgroundCube.fragmentShader,side:ji,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(E,S,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),Wc.copy(m.backgroundRotation),Wc.x*=-1,Wc.y*=-1,Wc.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(Wc.y*=-1,Wc.z*=-1),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(_W.makeRotationFromEuler(Wc)),u.material.toneMapped=Jt.getTransfer(x.colorSpace)!==vn,(h!==x||f!==x.version||p!==n.toneMapping)&&(u.material.needsUpdate=!0,h=x,f=x.version,p=n.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new Be(new Rp(2,2),new fs({name:"BackgroundMaterial",uniforms:Zf(jo.background.uniforms),vertexShader:jo.background.vertexShader,fragmentShader:jo.background.fragmentShader,side:$a,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=Jt.getTransfer(x.colorSpace)!==vn,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(h!==x||f!==x.version||p!==n.toneMapping)&&(c.material.needsUpdate=!0,h=x,f=x.version,p=n.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function y(g,m){g.getRGB(v0,OU(n)),r.buffers.color.setClear(v0.r,v0.g,v0.b,m,o)}return{getClearColor:function(){return a},setClearColor:function(g,m=1){a.set(g),l=m,y(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,y(a,l)},render:_}}function yW(n,e,t,r){const i=n.getParameter(n.MAX_VERTEX_ATTRIBS),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),o=r.isWebGL2||s!==null,a={},l=g(null);let c=l,u=!1;function h(M,I,j,O,z){let B=!1;if(o){const L=y(O,j,I);c!==L&&(c=L,p(c.object)),B=m(M,O,j,z),B&&v(M,O,j,z)}else{const L=I.wireframe===!0;(c.geometry!==O.id||c.program!==j.id||c.wireframe!==L)&&(c.geometry=O.id,c.program=j.id,c.wireframe=L,B=!0)}z!==null&&t.update(z,n.ELEMENT_ARRAY_BUFFER),(B||u)&&(u=!1,A(M,I,j,O),z!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(z).buffer))}function f(){return r.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}function p(M){return r.isWebGL2?n.bindVertexArray(M):s.bindVertexArrayOES(M)}function _(M){return r.isWebGL2?n.deleteVertexArray(M):s.deleteVertexArrayOES(M)}function y(M,I,j){const O=j.wireframe===!0;let z=a[M.id];z===void 0&&(z={},a[M.id]=z);let B=z[I.id];B===void 0&&(B={},z[I.id]=B);let L=B[O];return L===void 0&&(L=g(f()),B[O]=L),L}function g(M){const I=[],j=[],O=[];for(let z=0;z<i;z++)I[z]=0,j[z]=0,O[z]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:I,enabledAttributes:j,attributeDivisors:O,object:M,attributes:{},index:null}}function m(M,I,j,O){const z=c.attributes,B=I.attributes;let L=0;const D=j.getAttributes();for(const W in D)if(D[W].location>=0){const K=z[W];let oe=B[W];if(oe===void 0&&(W==="instanceMatrix"&&M.instanceMatrix&&(oe=M.instanceMatrix),W==="instanceColor"&&M.instanceColor&&(oe=M.instanceColor)),K===void 0||K.attribute!==oe||oe&&K.data!==oe.data)return!0;L++}return c.attributesNum!==L||c.index!==O}function v(M,I,j,O){const z={},B=I.attributes;let L=0;const D=j.getAttributes();for(const W in D)if(D[W].location>=0){let K=B[W];K===void 0&&(W==="instanceMatrix"&&M.instanceMatrix&&(K=M.instanceMatrix),W==="instanceColor"&&M.instanceColor&&(K=M.instanceColor));const oe={};oe.attribute=K,K&&K.data&&(oe.data=K.data),z[W]=oe,L++}c.attributes=z,c.attributesNum=L,c.index=O}function x(){const M=c.newAttributes;for(let I=0,j=M.length;I<j;I++)M[I]=0}function w(M){E(M,0)}function E(M,I){const j=c.newAttributes,O=c.enabledAttributes,z=c.attributeDivisors;j[M]=1,O[M]===0&&(n.enableVertexAttribArray(M),O[M]=1),z[M]!==I&&((r.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](M,I),z[M]=I)}function S(){const M=c.newAttributes,I=c.enabledAttributes;for(let j=0,O=I.length;j<O;j++)I[j]!==M[j]&&(n.disableVertexAttribArray(j),I[j]=0)}function C(M,I,j,O,z,B,L){L===!0?n.vertexAttribIPointer(M,I,j,z,B):n.vertexAttribPointer(M,I,j,O,z,B)}function A(M,I,j,O){if(r.isWebGL2===!1&&(M.isInstancedMesh||O.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();const z=O.attributes,B=j.getAttributes(),L=I.defaultAttributeValues;for(const D in B){const W=B[D];if(W.location>=0){let H=z[D];if(H===void 0&&(D==="instanceMatrix"&&M.instanceMatrix&&(H=M.instanceMatrix),D==="instanceColor"&&M.instanceColor&&(H=M.instanceColor)),H!==void 0){const K=H.normalized,oe=H.itemSize,me=t.get(H);if(me===void 0)continue;const Se=me.buffer,Te=me.type,G=me.bytesPerElement,he=r.isWebGL2===!0&&(Te===n.INT||Te===n.UNSIGNED_INT||H.gpuType===yU);if(H.isInterleavedBufferAttribute){const ve=H.data,Y=ve.stride,Ne=H.offset;if(ve.isInstancedInterleavedBuffer){for(let Re=0;Re<W.locationSize;Re++)E(W.location+Re,ve.meshPerAttribute);M.isInstancedMesh!==!0&&O._maxInstanceCount===void 0&&(O._maxInstanceCount=ve.meshPerAttribute*ve.count)}else for(let Re=0;Re<W.locationSize;Re++)w(W.location+Re);n.bindBuffer(n.ARRAY_BUFFER,Se);for(let Re=0;Re<W.locationSize;Re++)C(W.location+Re,oe/W.locationSize,Te,K,Y*G,(Ne+oe/W.locationSize*Re)*G,he)}else{if(H.isInstancedBufferAttribute){for(let ve=0;ve<W.locationSize;ve++)E(W.location+ve,H.meshPerAttribute);M.isInstancedMesh!==!0&&O._maxInstanceCount===void 0&&(O._maxInstanceCount=H.meshPerAttribute*H.count)}else for(let ve=0;ve<W.locationSize;ve++)w(W.location+ve);n.bindBuffer(n.ARRAY_BUFFER,Se);for(let ve=0;ve<W.locationSize;ve++)C(W.location+ve,oe/W.locationSize,Te,K,oe*G,oe/W.locationSize*ve*G,he)}}else if(L!==void 0){const K=L[D];if(K!==void 0)switch(K.length){case 2:n.vertexAttrib2fv(W.location,K);break;case 3:n.vertexAttrib3fv(W.location,K);break;case 4:n.vertexAttrib4fv(W.location,K);break;default:n.vertexAttrib1fv(W.location,K)}}}}S()}function k(){$();for(const M in a){const I=a[M];for(const j in I){const O=I[j];for(const z in O)_(O[z].object),delete O[z];delete I[j]}delete a[M]}}function T(M){if(a[M.id]===void 0)return;const I=a[M.id];for(const j in I){const O=I[j];for(const z in O)_(O[z].object),delete O[z];delete I[j]}delete a[M.id]}function R(M){for(const I in a){const j=a[I];if(j[M.id]===void 0)continue;const O=j[M.id];for(const z in O)_(O[z].object),delete O[z];delete j[M.id]}}function $(){P(),u=!0,c!==l&&(c=l,p(c.object))}function P(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:$,resetDefaultState:P,dispose:k,releaseStatesOfGeometry:T,releaseStatesOfProgram:R,initAttributes:x,enableAttribute:w,disableUnusedAttributes:S}}function wW(n,e,t,r){const i=r.isWebGL2;let s;function o(u){s=u}function a(u,h){n.drawArrays(s,u,h),t.update(h,s,1)}function l(u,h,f){if(f===0)return;let p,_;if(i)p=n,_="drawArraysInstanced";else if(p=e.get("ANGLE_instanced_arrays"),_="drawArraysInstancedANGLE",p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[_](s,u,h,f),t.update(h,s,f)}function c(u,h,f){if(f===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let _=0;_<f;_++)this.render(u[_],h[_]);else{p.multiDrawArraysWEBGL(s,u,0,h,0,f);let _=0;for(let y=0;y<f;y++)_+=h[y];t.update(_,s,1)}}this.setMode=o,this.render=a,this.renderInstances=l,this.renderMultiDraw=c}function SW(n,e,t){let r;function i(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const C=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(C){if(C==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";C="mediump"}return C==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&n.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,h=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=n.getParameter(n.MAX_TEXTURE_SIZE),_=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),y=n.getParameter(n.MAX_VERTEX_ATTRIBS),g=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),m=n.getParameter(n.MAX_VARYING_VECTORS),v=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),x=f>0,w=o||e.has("OES_texture_float"),E=x&&w,S=o?n.getParameter(n.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:i,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:f,maxTextureSize:p,maxCubemapSize:_,maxAttributes:y,maxVertexUniforms:g,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:x,floatFragmentTextures:w,floatVertexTextures:E,maxSamples:S}}function EW(n){const e=this;let t=null,r=0,i=!1,s=!1;const o=new Fo,a=new Ct,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const p=h.length!==0||f||r!==0||i;return i=f,r=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,f){t=u(h,f,0)},this.setState=function(h,f,p){const _=h.clippingPlanes,y=h.clipIntersection,g=h.clipShadows,m=n.get(h);if(!i||_===null||_.length===0||s&&!g)s?u(null):c();else{const v=s?0:r,x=v*4;let w=m.clippingState||null;l.value=w,w=u(_,f,x,p);for(let E=0;E!==x;++E)w[E]=t[E];m.clippingState=w,this.numIntersection=y?this.numPlanes:0,this.numPlanes+=v}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,f,p,_){const y=h!==null?h.length:0;let g=null;if(y!==0){if(g=l.value,_!==!0||g===null){const m=p+y*4,v=f.matrixWorldInverse;a.getNormalMatrix(v),(g===null||g.length<m)&&(g=new Float32Array(m));for(let x=0,w=p;x!==y;++x,w+=4)o.copy(h[x]).applyMatrix4(v,a),o.normal.toArray(g,w),g[w+3]=o.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=y,e.numIntersection=0,g}}function TW(n){let e=new WeakMap;function t(o,a){return a===MC?o.mapping=$f:a===RC&&(o.mapping=Xf),o}function r(o){if(o&&o.isTexture){const a=o.mapping;if(a===MC||a===RC)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new L7(l.height);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",i),t(c.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}class VA extends DU{constructor(e=-1,t=1,r=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,o=r+e,a=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Yh=4,aP=[.125,.215,.35,.446,.526,.582],vu=20,yE=new VA,lP=new at;let wE=null,SE=0,EE=0;const ou=(1+Math.sqrt(5))/2,eh=1/ou,cP=[new N(1,1,1),new N(-1,1,1),new N(1,1,-1),new N(-1,1,-1),new N(0,ou,eh),new N(0,ou,-eh),new N(eh,0,ou),new N(-eh,0,ou),new N(ou,eh,0),new N(-ou,eh,0)];class uP{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){wE=this._renderer.getRenderTarget(),SE=this._renderer.getActiveCubeFace(),EE=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,r,i,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=fP(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=hP(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(wE,SE,EE),e.scissorTest=!1,_0(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===$f||e.mapping===Xf?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),wE=this._renderer.getRenderTarget(),SE=this._renderer.getActiveCubeFace(),EE=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:mi,minFilter:mi,generateMipmaps:!1,type:Xa,format:Ls,colorSpace:ol,depthBuffer:!1},i=dP(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=dP(e,t,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=CW(s)),this._blurMaterial=bW(s,e,t)}return i}_compileMaterial(e){const t=new Be(this._lodPlanes[0],e);this._renderer.compile(t,yE)}_sceneToCubeUV(e,t,r,i){const a=new Ni(90,1,t,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,f=u.toneMapping;u.getClearColor(lP),u.toneMapping=sc,u.autoClear=!1;const p=new al({name:"PMREM.Background",side:ji,depthWrite:!1,depthTest:!1}),_=new Be(new En,p);let y=!1;const g=e.background;g?g.isColor&&(p.color.copy(g),e.background=null,y=!0):(p.color.copy(lP),y=!0);for(let m=0;m<6;m++){const v=m%3;v===0?(a.up.set(0,l[m],0),a.lookAt(c[m],0,0)):v===1?(a.up.set(0,0,l[m]),a.lookAt(0,c[m],0)):(a.up.set(0,l[m],0),a.lookAt(0,0,c[m]));const x=this._cubeSize;_0(i,v*x,m>2?x:0,x,x),u.setRenderTarget(i),y&&u.render(_,a),u.render(e,a)}_.geometry.dispose(),_.material.dispose(),u.toneMapping=f,u.autoClear=h,e.background=g}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===$f||e.mapping===Xf;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=fP()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=hP());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new Be(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;_0(t,0,0,3*l,2*l),r.setRenderTarget(t),r.render(o,yE)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const s=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),o=cP[(i-1)%cP.length];this._blur(e,i-1,i,s,o)}t.autoClear=r}_blur(e,t,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new Be(this._lodPlanes[i],c),f=c.uniforms,p=this._sizeLods[r]-1,_=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*vu-1),y=s/_,g=isFinite(s)?1+Math.floor(u*y):vu;g>vu&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${vu}`);const m=[];let v=0;for(let C=0;C<vu;++C){const A=C/y,k=Math.exp(-A*A/2);m.push(k),C===0?v+=k:C<g&&(v+=2*k)}for(let C=0;C<m.length;C++)m[C]=m[C]/v;f.envMap.value=e.texture,f.samples.value=g,f.weights.value=m,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:x}=this;f.dTheta.value=_,f.mipInt.value=x-r;const w=this._sizeLods[i],E=3*w*(i>x-Yh?i-x+Yh:0),S=4*(this._cubeSize-w);_0(t,E,S,3*w,2*w),l.setRenderTarget(t),l.render(h,yE)}}function CW(n){const e=[],t=[],r=[];let i=n;const s=n-Yh+1+aP.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);t.push(a);let l=1/a;o>n-Yh?l=aP[o-n+Yh-1]:o===0&&(l=0),r.push(l);const c=1/(a-2),u=-c,h=1+c,f=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,_=6,y=3,g=2,m=1,v=new Float32Array(y*_*p),x=new Float32Array(g*_*p),w=new Float32Array(m*_*p);for(let S=0;S<p;S++){const C=S%3*2/3-1,A=S>2?0:-1,k=[C,A,0,C+2/3,A,0,C+2/3,A+1,0,C,A,0,C+2/3,A+1,0,C,A+1,0];v.set(k,y*_*S),x.set(f,g*_*S);const T=[S,S,S,S,S,S];w.set(T,m*_*S)}const E=new xn;E.setAttribute("position",new Dn(v,y)),E.setAttribute("uv",new Dn(x,g)),E.setAttribute("faceIndex",new Dn(w,m)),e.push(E),i>Yh&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function dP(n,e,t){const r=new zs(n,e,t);return r.texture.mapping=Pw,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function _0(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function bW(n,e,t){const r=new Float32Array(vu),i=new N(0,1,0);return new fs({name:"SphericalGaussianBlur",defines:{n:vu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:GA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Fa,depthTest:!1,depthWrite:!1})}function hP(){return new fs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:GA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Fa,depthTest:!1,depthWrite:!1})}function fP(){return new fs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:GA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Fa,depthTest:!1,depthWrite:!1})}function GA(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function AW(n){let e=new WeakMap,t=null;function r(a){if(a&&a.isTexture){const l=a.mapping,c=l===MC||l===RC,u=l===$f||l===Xf;if(c||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let h=e.get(a);return t===null&&(t=new uP(n)),h=c?t.fromEquirectangular(a,h):t.fromCubemap(a,h),e.set(a,h),h.texture}else{if(e.has(a))return e.get(a).texture;{const h=a.image;if(c&&h&&h.height>0||u&&h&&i(h)){t===null&&(t=new uP(n));const f=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",s),f.texture}else return null}}}return a}function i(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:o}}function MW(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(r){r.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(r){const i=t(r);return i===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function RW(n,e,t,r){const i={},s=new WeakMap;function o(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const _ in f.attributes)e.remove(f.attributes[_]);for(const _ in f.morphAttributes){const y=f.morphAttributes[_];for(let g=0,m=y.length;g<m;g++)e.remove(y[g])}f.removeEventListener("dispose",o),delete i[f.id];const p=s.get(f);p&&(e.remove(p),s.delete(f)),r.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(h,f){return i[f.id]===!0||(f.addEventListener("dispose",o),i[f.id]=!0,t.memory.geometries++),f}function l(h){const f=h.attributes;for(const _ in f)e.update(f[_],n.ARRAY_BUFFER);const p=h.morphAttributes;for(const _ in p){const y=p[_];for(let g=0,m=y.length;g<m;g++)e.update(y[g],n.ARRAY_BUFFER)}}function c(h){const f=[],p=h.index,_=h.attributes.position;let y=0;if(p!==null){const v=p.array;y=p.version;for(let x=0,w=v.length;x<w;x+=3){const E=v[x+0],S=v[x+1],C=v[x+2];f.push(E,S,S,C,C,E)}}else if(_!==void 0){const v=_.array;y=_.version;for(let x=0,w=v.length/3-1;x<w;x+=3){const E=x+0,S=x+1,C=x+2;f.push(E,S,S,C,C,E)}}else return;const g=new(RU(f)?LU:kU)(f,1);g.version=y;const m=s.get(h);m&&e.remove(m),s.set(h,g)}function u(h){const f=s.get(h);if(f){const p=h.index;p!==null&&f.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function NW(n,e,t,r){const i=r.isWebGL2;let s;function o(p){s=p}let a,l;function c(p){a=p.type,l=p.bytesPerElement}function u(p,_){n.drawElements(s,_,a,p*l),t.update(_,s,1)}function h(p,_,y){if(y===0)return;let g,m;if(i)g=n,m="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[m](s,_,a,p*l,y),t.update(_,s,y)}function f(p,_,y){if(y===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let m=0;m<y;m++)this.render(p[m]/l,_[m]);else{g.multiDrawElementsWEBGL(s,_,0,a,p,0,y);let m=0;for(let v=0;v<y;v++)m+=_[v];t.update(m,s,1)}}this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=h,this.renderMultiDraw=f}function IW(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function PW(n,e){return n[0]-e[0]}function kW(n,e){return Math.abs(e[1])-Math.abs(n[1])}function LW(n,e,t){const r={},i=new Float32Array(8),s=new WeakMap,o=new Cn,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,h){const f=c.morphTargetInfluences;if(e.isWebGL2===!0){const p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,_=p!==void 0?p.length:0;let y=s.get(u);if(y===void 0||y.count!==_){let $=function(){T.dispose(),s.delete(u),u.removeEventListener("dispose",$)};y!==void 0&&y.texture.dispose();const g=u.morphAttributes.position!==void 0,m=u.morphAttributes.normal!==void 0,v=u.morphAttributes.color!==void 0,x=u.morphAttributes.position||[],w=u.morphAttributes.normal||[],E=u.morphAttributes.color||[];let S=0;g===!0&&(S=1),m===!0&&(S=2),v===!0&&(S=3);let C=u.attributes.position.count*S,A=1;C>e.maxTextureSize&&(A=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);const k=new Float32Array(C*A*4*_),T=new IU(k,C,A,_);T.type=Na,T.needsUpdate=!0;const R=S*4;for(let P=0;P<_;P++){const M=x[P],I=w[P],j=E[P],O=C*A*4*P;for(let z=0;z<M.count;z++){const B=z*R;g===!0&&(o.fromBufferAttribute(M,z),k[O+B+0]=o.x,k[O+B+1]=o.y,k[O+B+2]=o.z,k[O+B+3]=0),m===!0&&(o.fromBufferAttribute(I,z),k[O+B+4]=o.x,k[O+B+5]=o.y,k[O+B+6]=o.z,k[O+B+7]=0),v===!0&&(o.fromBufferAttribute(j,z),k[O+B+8]=o.x,k[O+B+9]=o.y,k[O+B+10]=o.z,k[O+B+11]=j.itemSize===4?o.w:1)}}y={count:_,texture:T,size:new gt(C,A)},s.set(u,y),u.addEventListener("dispose",$)}if(c.isInstancedMesh===!0&&c.morphTexture!==null)h.getUniforms().setValue(n,"morphTexture",c.morphTexture,t);else{let g=0;for(let v=0;v<f.length;v++)g+=f[v];const m=u.morphTargetsRelative?1:1-g;h.getUniforms().setValue(n,"morphTargetBaseInfluence",m),h.getUniforms().setValue(n,"morphTargetInfluences",f)}h.getUniforms().setValue(n,"morphTargetsTexture",y.texture,t),h.getUniforms().setValue(n,"morphTargetsTextureSize",y.size)}else{const p=f===void 0?0:f.length;let _=r[u.id];if(_===void 0||_.length!==p){_=[];for(let x=0;x<p;x++)_[x]=[x,0];r[u.id]=_}for(let x=0;x<p;x++){const w=_[x];w[0]=x,w[1]=f[x]}_.sort(kW);for(let x=0;x<8;x++)x<p&&_[x][1]?(a[x][0]=_[x][0],a[x][1]=_[x][1]):(a[x][0]=Number.MAX_SAFE_INTEGER,a[x][1]=0);a.sort(PW);const y=u.morphAttributes.position,g=u.morphAttributes.normal;let m=0;for(let x=0;x<8;x++){const w=a[x],E=w[0],S=w[1];E!==Number.MAX_SAFE_INTEGER&&S?(y&&u.getAttribute("morphTarget"+x)!==y[E]&&u.setAttribute("morphTarget"+x,y[E]),g&&u.getAttribute("morphNormal"+x)!==g[E]&&u.setAttribute("morphNormal"+x,g[E]),i[x]=S,m+=S):(y&&u.hasAttribute("morphTarget"+x)===!0&&u.deleteAttribute("morphTarget"+x),g&&u.hasAttribute("morphNormal"+x)===!0&&u.deleteAttribute("morphNormal"+x),i[x]=0)}const v=u.morphTargetsRelative?1:1-m;h.getUniforms().setValue(n,"morphTargetBaseInfluence",v),h.getUniforms().setValue(n,"morphTargetInfluences",i)}}return{update:l}}function OW(n,e,t,r){let i=new WeakMap;function s(l){const c=r.render.frame,u=l.geometry,h=e.get(l,u);if(i.get(h)!==c&&(e.update(h),i.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),i.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),i.set(l,c))),l.isSkinnedMesh){const f=l.skeleton;i.get(f)!==c&&(f.update(),i.set(f,c))}return h}function o(){i=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}class jU extends si{constructor(e,t,r,i,s,o,a,l,c,u){if(u=u!==void 0?u:Fu,u!==Fu&&u!==qf)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===Fu&&(r=Xl),r===void 0&&u===qf&&(r=Uu),super(null,i,s,o,a,l,u,r,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:ei,this.minFilter=l!==void 0?l:ei,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const zU=new si,BU=new jU(1,1);BU.compareFunction=MU;const HU=new IU,VU=new _7,GU=new UU,pP=[],mP=[],gP=new Float32Array(16),vP=new Float32Array(9),_P=new Float32Array(4);function Np(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let s=pP[i];if(s===void 0&&(s=new Float32Array(i),pP[i]=s),e!==0){r.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function yr(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function wr(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function Ow(n,e){let t=mP[e];t===void 0&&(t=new Int32Array(e),mP[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function DW(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function UW(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(yr(t,e))return;n.uniform2fv(this.addr,e),wr(t,e)}}function FW(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(yr(t,e))return;n.uniform3fv(this.addr,e),wr(t,e)}}function jW(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(yr(t,e))return;n.uniform4fv(this.addr,e),wr(t,e)}}function zW(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(yr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),wr(t,e)}else{if(yr(t,r))return;_P.set(r),n.uniformMatrix2fv(this.addr,!1,_P),wr(t,r)}}function BW(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(yr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),wr(t,e)}else{if(yr(t,r))return;vP.set(r),n.uniformMatrix3fv(this.addr,!1,vP),wr(t,r)}}function HW(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(yr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),wr(t,e)}else{if(yr(t,r))return;gP.set(r),n.uniformMatrix4fv(this.addr,!1,gP),wr(t,r)}}function VW(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function GW(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(yr(t,e))return;n.uniform2iv(this.addr,e),wr(t,e)}}function WW(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(yr(t,e))return;n.uniform3iv(this.addr,e),wr(t,e)}}function YW(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(yr(t,e))return;n.uniform4iv(this.addr,e),wr(t,e)}}function KW(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function $W(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(yr(t,e))return;n.uniform2uiv(this.addr,e),wr(t,e)}}function XW(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(yr(t,e))return;n.uniform3uiv(this.addr,e),wr(t,e)}}function qW(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(yr(t,e))return;n.uniform4uiv(this.addr,e),wr(t,e)}}function ZW(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);const s=this.type===n.SAMPLER_2D_SHADOW?BU:zU;t.setTexture2D(e||s,i)}function QW(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||VU,i)}function JW(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||GU,i)}function eY(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||HU,i)}function tY(n){switch(n){case 5126:return DW;case 35664:return UW;case 35665:return FW;case 35666:return jW;case 35674:return zW;case 35675:return BW;case 35676:return HW;case 5124:case 35670:return VW;case 35667:case 35671:return GW;case 35668:case 35672:return WW;case 35669:case 35673:return YW;case 5125:return KW;case 36294:return $W;case 36295:return XW;case 36296:return qW;case 35678:case 36198:case 36298:case 36306:case 35682:return ZW;case 35679:case 36299:case 36307:return QW;case 35680:case 36300:case 36308:case 36293:return JW;case 36289:case 36303:case 36311:case 36292:return eY}}function nY(n,e){n.uniform1fv(this.addr,e)}function rY(n,e){const t=Np(e,this.size,2);n.uniform2fv(this.addr,t)}function iY(n,e){const t=Np(e,this.size,3);n.uniform3fv(this.addr,t)}function sY(n,e){const t=Np(e,this.size,4);n.uniform4fv(this.addr,t)}function oY(n,e){const t=Np(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function aY(n,e){const t=Np(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function lY(n,e){const t=Np(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function cY(n,e){n.uniform1iv(this.addr,e)}function uY(n,e){n.uniform2iv(this.addr,e)}function dY(n,e){n.uniform3iv(this.addr,e)}function hY(n,e){n.uniform4iv(this.addr,e)}function fY(n,e){n.uniform1uiv(this.addr,e)}function pY(n,e){n.uniform2uiv(this.addr,e)}function mY(n,e){n.uniform3uiv(this.addr,e)}function gY(n,e){n.uniform4uiv(this.addr,e)}function vY(n,e,t){const r=this.cache,i=e.length,s=Ow(t,i);yr(r,s)||(n.uniform1iv(this.addr,s),wr(r,s));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||zU,s[o])}function _Y(n,e,t){const r=this.cache,i=e.length,s=Ow(t,i);yr(r,s)||(n.uniform1iv(this.addr,s),wr(r,s));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||VU,s[o])}function xY(n,e,t){const r=this.cache,i=e.length,s=Ow(t,i);yr(r,s)||(n.uniform1iv(this.addr,s),wr(r,s));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||GU,s[o])}function yY(n,e,t){const r=this.cache,i=e.length,s=Ow(t,i);yr(r,s)||(n.uniform1iv(this.addr,s),wr(r,s));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||HU,s[o])}function wY(n){switch(n){case 5126:return nY;case 35664:return rY;case 35665:return iY;case 35666:return sY;case 35674:return oY;case 35675:return aY;case 35676:return lY;case 5124:case 35670:return cY;case 35667:case 35671:return uY;case 35668:case 35672:return dY;case 35669:case 35673:return hY;case 5125:return fY;case 36294:return pY;case 36295:return mY;case 36296:return gY;case 35678:case 36198:case 36298:case 36306:case 35682:return vY;case 35679:case 36299:case 36307:return _Y;case 35680:case 36300:case 36308:case 36293:return xY;case 36289:case 36303:case 36311:case 36292:return yY}}class SY{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=tY(t.type)}}class EY{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=wY(t.type)}}class TY{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,t[a.id],r)}}}const TE=/(\w+)(\])?(\[|\.)?/g;function xP(n,e){n.seq.push(e),n.map[e.id]=e}function CY(n,e,t){const r=n.name,i=r.length;for(TE.lastIndex=0;;){const s=TE.exec(r),o=TE.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===i){xP(t,c===void 0?new SY(a,n,e):new EY(a,n,e));break}else{let h=t.map[a];h===void 0&&(h=new TY(a),xP(t,h)),t=h}}}class G_{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(t,i),o=e.getUniformLocation(t,s.name);CY(s,o,this)}}setValue(e,t,r,i){const s=this.map[t];s!==void 0&&s.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=r[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in t&&r.push(o)}return r}}function yP(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const bY=37297;let AY=0;function MY(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=i;o<s;o++){const a=o+1;r.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return r.join(`
`)}function RY(n){const e=Jt.getPrimaries(Jt.workingColorSpace),t=Jt.getPrimaries(n);let r;switch(e===t?r="":e===Rx&&t===Mx?r="LinearDisplayP3ToLinearSRGB":e===Mx&&t===Rx&&(r="LinearSRGBToLinearDisplayP3"),n){case ol:case kw:return[r,"LinearTransferOETF"];case Ns:case UA:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[r,"LinearTransferOETF"]}}function wP(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+i+`

`+MY(n.getShaderSource(e),o)}else return i}function NY(n,e){const t=RY(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function IY(n,e){let t;switch(e){case fU:t="Linear";break;case pU:t="Reinhard";break;case mU:t="OptimizedCineon";break;case gU:t="ACESFilmic";break;case vU:t="AgX";break;case _U:t="Neutral";break;case I9:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function PY(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||n.alphaToCoverage||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Kh).join(`
`)}function kY(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Kh).join(`
`)}function LY(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function OY(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function Kh(n){return n!==""}function SP(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function EP(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const DY=/^[ \t]*#include +<([\w\d./]+)>/gm;function kC(n){return n.replace(DY,FY)}const UY=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function FY(n,e){let t=Tt[e];if(t===void 0){const r=UY.get(e);if(r!==void 0)t=Tt[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return kC(t)}const jY=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function TP(n){return n.replace(jY,zY)}function zY(n,e,t,r){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function CP(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	`;return n.isWebGL2&&(e+=`precision ${n.precision} sampler3D;
		precision ${n.precision} sampler2DArray;
		precision ${n.precision} sampler2DShadow;
		precision ${n.precision} samplerCubeShadow;
		precision ${n.precision} sampler2DArrayShadow;
		precision ${n.precision} isampler2D;
		precision ${n.precision} isampler3D;
		precision ${n.precision} isamplerCube;
		precision ${n.precision} isampler2DArray;
		precision ${n.precision} usampler2D;
		precision ${n.precision} usampler3D;
		precision ${n.precision} usamplerCube;
		precision ${n.precision} usampler2DArray;
		`),n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function BY(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===dU?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===s9?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===wa&&(e="SHADOWMAP_TYPE_VSM"),e}function HY(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case $f:case Xf:e="ENVMAP_TYPE_CUBE";break;case Pw:e="ENVMAP_TYPE_CUBE_UV";break}return e}function VY(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Xf:e="ENVMAP_MODE_REFRACTION";break}return e}function GY(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case hU:e="ENVMAP_BLENDING_MULTIPLY";break;case R9:e="ENVMAP_BLENDING_MIX";break;case N9:e="ENVMAP_BLENDING_ADD";break}return e}function WY(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:r,maxMip:t}}function YY(n,e,t,r){const i=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=BY(t),c=HY(t),u=VY(t),h=GY(t),f=WY(t),p=t.isWebGL2?"":PY(t),_=kY(t),y=LY(s),g=i.createProgram();let m,v,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(Kh).join(`
`),m.length>0&&(m+=`
`),v=[p,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(Kh).join(`
`),v.length>0&&(v+=`
`)):(m=[CP(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",(t.batching,""),t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Kh).join(`
`),v=[p,CP(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==sc?"#define TONE_MAPPING":"",t.toneMapping!==sc?Tt.tonemapping_pars_fragment:"",t.toneMapping!==sc?IY("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Tt.colorspace_pars_fragment,NY("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Kh).join(`
`)),o=kC(o),o=SP(o,t),o=EP(o,t),a=kC(a),a=SP(a,t),a=EP(a,t),o=TP(o),a=TP(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,m=[_,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,v=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===BI?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===BI?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const w=x+m+o,E=x+v+a,S=yP(i,i.VERTEX_SHADER,w),C=yP(i,i.FRAGMENT_SHADER,E);i.attachShader(g,S),i.attachShader(g,C),t.index0AttributeName!==void 0?i.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g);function A($){if(n.debug.checkShaderErrors){const P=i.getProgramInfoLog(g).trim(),M=i.getShaderInfoLog(S).trim(),I=i.getShaderInfoLog(C).trim();let j=!0,O=!0;if(i.getProgramParameter(g,i.LINK_STATUS)===!1)if(j=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,g,S,C);else{const z=wP(i,S,"vertex"),B=wP(i,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(g,i.VALIDATE_STATUS)+`

Material Name: `+$.name+`
Material Type: `+$.type+`

Program Info Log: `+P+`
`+z+`
`+B)}else P!==""?console.warn("THREE.WebGLProgram: Program Info Log:",P):(M===""||I==="")&&(O=!1);O&&($.diagnostics={runnable:j,programLog:P,vertexShader:{log:M,prefix:m},fragmentShader:{log:I,prefix:v}})}i.deleteShader(S),i.deleteShader(C),k=new G_(i,g),T=OY(i,g)}let k;this.getUniforms=function(){return k===void 0&&A(this),k};let T;this.getAttributes=function(){return T===void 0&&A(this),T};let R=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return R===!1&&(R=i.getProgramParameter(g,bY)),R},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=AY++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=S,this.fragmentShader=C,this}let KY=0;class $Y{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new XY(e),t.set(e,r)),r}}class XY{constructor(e){this.id=KY++,this.code=e,this.usedTimes=0}}function qY(n,e,t,r,i,s,o){const a=new BA,l=new $Y,c=new Set,u=[],h=i.isWebGL2,f=i.logarithmicDepthBuffer,p=i.vertexTextures;let _=i.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(T){return c.add(T),T===0?"uv":`uv${T}`}function m(T,R,$,P,M){const I=P.fog,j=M.geometry,O=T.isMeshStandardMaterial?P.environment:null,z=(T.isMeshStandardMaterial?t:e).get(T.envMap||O),B=z&&z.mapping===Pw?z.image.height:null,L=y[T.type];T.precision!==null&&(_=i.getMaxPrecision(T.precision),_!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",_,"instead."));const D=j.morphAttributes.position||j.morphAttributes.normal||j.morphAttributes.color,W=D!==void 0?D.length:0;let H=0;j.morphAttributes.position!==void 0&&(H=1),j.morphAttributes.normal!==void 0&&(H=2),j.morphAttributes.color!==void 0&&(H=3);let K,oe,me,Se;if(L){const ln=jo[L];K=ln.vertexShader,oe=ln.fragmentShader}else K=T.vertexShader,oe=T.fragmentShader,l.update(T),me=l.getVertexShaderID(T),Se=l.getFragmentShaderID(T);const Te=n.getRenderTarget(),G=M.isInstancedMesh===!0,he=M.isBatchedMesh===!0,ve=!!T.map,Y=!!T.matcap,Ne=!!z,Re=!!T.aoMap,Ve=!!T.lightMap,Ue=!!T.bumpMap,Je=!!T.normalMap,tt=!!T.displacementMap,st=!!T.emissiveMap,nn=!!T.metalnessMap,V=!!T.roughnessMap,b=T.anisotropy>0,X=T.clearcoat>0,J=T.iridescence>0,te=T.sheen>0,ne=T.transmission>0,Ce=b&&!!T.anisotropyMap,Ee=X&&!!T.clearcoatMap,ye=X&&!!T.clearcoatNormalMap,xe=X&&!!T.clearcoatRoughnessMap,Ge=J&&!!T.iridescenceMap,we=J&&!!T.iridescenceThicknessMap,Rt=te&&!!T.sheenColorMap,q=te&&!!T.sheenRoughnessMap,ie=!!T.specularMap,fe=!!T.specularColorMap,ge=!!T.specularIntensityMap,Le=ne&&!!T.transmissionMap,Ie=ne&&!!T.thicknessMap,Qe=!!T.gradientMap,Z=!!T.alphaMap,Oe=T.alphaTest>0,re=!!T.alphaHash,Pe=!!T.extensions;let ze=sc;T.toneMapped&&(Te===null||Te.isXRRenderTarget===!0)&&(ze=n.toneMapping);const bt={isWebGL2:h,shaderID:L,shaderType:T.type,shaderName:T.name,vertexShader:K,fragmentShader:oe,defines:T.defines,customVertexShaderID:me,customFragmentShaderID:Se,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:_,batching:he,instancing:G,instancingColor:G&&M.instanceColor!==null,instancingMorph:G&&M.morphTexture!==null,supportsVertexTextures:p,outputColorSpace:Te===null?n.outputColorSpace:Te.isXRRenderTarget===!0?Te.texture.colorSpace:ol,alphaToCoverage:!!T.alphaToCoverage,map:ve,matcap:Y,envMap:Ne,envMapMode:Ne&&z.mapping,envMapCubeUVHeight:B,aoMap:Re,lightMap:Ve,bumpMap:Ue,normalMap:Je,displacementMap:p&&tt,emissiveMap:st,normalMapObjectSpace:Je&&T.normalMapType===G9,normalMapTangentSpace:Je&&T.normalMapType===AU,metalnessMap:nn,roughnessMap:V,anisotropy:b,anisotropyMap:Ce,clearcoat:X,clearcoatMap:Ee,clearcoatNormalMap:ye,clearcoatRoughnessMap:xe,iridescence:J,iridescenceMap:Ge,iridescenceThicknessMap:we,sheen:te,sheenColorMap:Rt,sheenRoughnessMap:q,specularMap:ie,specularColorMap:fe,specularIntensityMap:ge,transmission:ne,transmissionMap:Le,thicknessMap:Ie,gradientMap:Qe,opaque:T.transparent===!1&&T.blending===xf&&T.alphaToCoverage===!1,alphaMap:Z,alphaTest:Oe,alphaHash:re,combine:T.combine,mapUv:ve&&g(T.map.channel),aoMapUv:Re&&g(T.aoMap.channel),lightMapUv:Ve&&g(T.lightMap.channel),bumpMapUv:Ue&&g(T.bumpMap.channel),normalMapUv:Je&&g(T.normalMap.channel),displacementMapUv:tt&&g(T.displacementMap.channel),emissiveMapUv:st&&g(T.emissiveMap.channel),metalnessMapUv:nn&&g(T.metalnessMap.channel),roughnessMapUv:V&&g(T.roughnessMap.channel),anisotropyMapUv:Ce&&g(T.anisotropyMap.channel),clearcoatMapUv:Ee&&g(T.clearcoatMap.channel),clearcoatNormalMapUv:ye&&g(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:xe&&g(T.clearcoatRoughnessMap.channel),iridescenceMapUv:Ge&&g(T.iridescenceMap.channel),iridescenceThicknessMapUv:we&&g(T.iridescenceThicknessMap.channel),sheenColorMapUv:Rt&&g(T.sheenColorMap.channel),sheenRoughnessMapUv:q&&g(T.sheenRoughnessMap.channel),specularMapUv:ie&&g(T.specularMap.channel),specularColorMapUv:fe&&g(T.specularColorMap.channel),specularIntensityMapUv:ge&&g(T.specularIntensityMap.channel),transmissionMapUv:Le&&g(T.transmissionMap.channel),thicknessMapUv:Ie&&g(T.thicknessMap.channel),alphaMapUv:Z&&g(T.alphaMap.channel),vertexTangents:!!j.attributes.tangent&&(Je||b),vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!j.attributes.color&&j.attributes.color.itemSize===4,pointsUvs:M.isPoints===!0&&!!j.attributes.uv&&(ve||Z),fog:!!I,useFog:T.fog===!0,fogExp2:!!I&&I.isFogExp2,flatShading:T.flatShading===!0,sizeAttenuation:T.sizeAttenuation===!0,logarithmicDepthBuffer:f,skinning:M.isSkinnedMesh===!0,morphTargets:j.morphAttributes.position!==void 0,morphNormals:j.morphAttributes.normal!==void 0,morphColors:j.morphAttributes.color!==void 0,morphTargetsCount:W,morphTextureStride:H,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numLightProbes:R.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:T.dithering,shadowMapEnabled:n.shadowMap.enabled&&$.length>0,shadowMapType:n.shadowMap.type,toneMapping:ze,useLegacyLights:n._useLegacyLights,decodeVideoTexture:ve&&T.map.isVideoTexture===!0&&Jt.getTransfer(T.map.colorSpace)===vn,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===gi,flipSided:T.side===ji,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionDerivatives:Pe&&T.extensions.derivatives===!0,extensionFragDepth:Pe&&T.extensions.fragDepth===!0,extensionDrawBuffers:Pe&&T.extensions.drawBuffers===!0,extensionShaderTextureLOD:Pe&&T.extensions.shaderTextureLOD===!0,extensionClipCullDistance:Pe&&T.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:Pe&&T.extensions.multiDraw===!0&&r.has("WEBGL_multi_draw"),rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:T.customProgramCacheKey()};return bt.vertexUv1s=c.has(1),bt.vertexUv2s=c.has(2),bt.vertexUv3s=c.has(3),c.clear(),bt}function v(T){const R=[];if(T.shaderID?R.push(T.shaderID):(R.push(T.customVertexShaderID),R.push(T.customFragmentShaderID)),T.defines!==void 0)for(const $ in T.defines)R.push($),R.push(T.defines[$]);return T.isRawShaderMaterial===!1&&(x(R,T),w(R,T),R.push(n.outputColorSpace)),R.push(T.customProgramCacheKey),R.join()}function x(T,R){T.push(R.precision),T.push(R.outputColorSpace),T.push(R.envMapMode),T.push(R.envMapCubeUVHeight),T.push(R.mapUv),T.push(R.alphaMapUv),T.push(R.lightMapUv),T.push(R.aoMapUv),T.push(R.bumpMapUv),T.push(R.normalMapUv),T.push(R.displacementMapUv),T.push(R.emissiveMapUv),T.push(R.metalnessMapUv),T.push(R.roughnessMapUv),T.push(R.anisotropyMapUv),T.push(R.clearcoatMapUv),T.push(R.clearcoatNormalMapUv),T.push(R.clearcoatRoughnessMapUv),T.push(R.iridescenceMapUv),T.push(R.iridescenceThicknessMapUv),T.push(R.sheenColorMapUv),T.push(R.sheenRoughnessMapUv),T.push(R.specularMapUv),T.push(R.specularColorMapUv),T.push(R.specularIntensityMapUv),T.push(R.transmissionMapUv),T.push(R.thicknessMapUv),T.push(R.combine),T.push(R.fogExp2),T.push(R.sizeAttenuation),T.push(R.morphTargetsCount),T.push(R.morphAttributeCount),T.push(R.numDirLights),T.push(R.numPointLights),T.push(R.numSpotLights),T.push(R.numSpotLightMaps),T.push(R.numHemiLights),T.push(R.numRectAreaLights),T.push(R.numDirLightShadows),T.push(R.numPointLightShadows),T.push(R.numSpotLightShadows),T.push(R.numSpotLightShadowsWithMaps),T.push(R.numLightProbes),T.push(R.shadowMapType),T.push(R.toneMapping),T.push(R.numClippingPlanes),T.push(R.numClipIntersection),T.push(R.depthPacking)}function w(T,R){a.disableAll(),R.isWebGL2&&a.enable(0),R.supportsVertexTextures&&a.enable(1),R.instancing&&a.enable(2),R.instancingColor&&a.enable(3),R.instancingMorph&&a.enable(4),R.matcap&&a.enable(5),R.envMap&&a.enable(6),R.normalMapObjectSpace&&a.enable(7),R.normalMapTangentSpace&&a.enable(8),R.clearcoat&&a.enable(9),R.iridescence&&a.enable(10),R.alphaTest&&a.enable(11),R.vertexColors&&a.enable(12),R.vertexAlphas&&a.enable(13),R.vertexUv1s&&a.enable(14),R.vertexUv2s&&a.enable(15),R.vertexUv3s&&a.enable(16),R.vertexTangents&&a.enable(17),R.anisotropy&&a.enable(18),R.alphaHash&&a.enable(19),R.batching&&a.enable(20),T.push(a.mask),a.disableAll(),R.fog&&a.enable(0),R.useFog&&a.enable(1),R.flatShading&&a.enable(2),R.logarithmicDepthBuffer&&a.enable(3),R.skinning&&a.enable(4),R.morphTargets&&a.enable(5),R.morphNormals&&a.enable(6),R.morphColors&&a.enable(7),R.premultipliedAlpha&&a.enable(8),R.shadowMapEnabled&&a.enable(9),R.useLegacyLights&&a.enable(10),R.doubleSided&&a.enable(11),R.flipSided&&a.enable(12),R.useDepthPacking&&a.enable(13),R.dithering&&a.enable(14),R.transmission&&a.enable(15),R.sheen&&a.enable(16),R.opaque&&a.enable(17),R.pointsUvs&&a.enable(18),R.decodeVideoTexture&&a.enable(19),R.alphaToCoverage&&a.enable(20),T.push(a.mask)}function E(T){const R=y[T.type];let $;if(R){const P=jo[R];$=Lw.clone(P.uniforms)}else $=T.uniforms;return $}function S(T,R){let $;for(let P=0,M=u.length;P<M;P++){const I=u[P];if(I.cacheKey===R){$=I,++$.usedTimes;break}}return $===void 0&&($=new YY(n,R,T,s),u.push($)),$}function C(T){if(--T.usedTimes===0){const R=u.indexOf(T);u[R]=u[u.length-1],u.pop(),T.destroy()}}function A(T){l.remove(T)}function k(){l.dispose()}return{getParameters:m,getProgramCacheKey:v,getUniforms:E,acquireProgram:S,releaseProgram:C,releaseShaderCache:A,programs:u,dispose:k}}function ZY(){let n=new WeakMap;function e(s){let o=n.get(s);return o===void 0&&(o={},n.set(s,o)),o}function t(s){n.delete(s)}function r(s,o,a){n.get(s)[o]=a}function i(){n=new WeakMap}return{get:e,remove:t,update:r,dispose:i}}function QY(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function bP(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function AP(){const n=[];let e=0;const t=[],r=[],i=[];function s(){e=0,t.length=0,r.length=0,i.length=0}function o(h,f,p,_,y,g){let m=n[e];return m===void 0?(m={id:h.id,object:h,geometry:f,material:p,groupOrder:_,renderOrder:h.renderOrder,z:y,group:g},n[e]=m):(m.id=h.id,m.object=h,m.geometry=f,m.material=p,m.groupOrder=_,m.renderOrder=h.renderOrder,m.z=y,m.group=g),e++,m}function a(h,f,p,_,y,g){const m=o(h,f,p,_,y,g);p.transmission>0?r.push(m):p.transparent===!0?i.push(m):t.push(m)}function l(h,f,p,_,y,g){const m=o(h,f,p,_,y,g);p.transmission>0?r.unshift(m):p.transparent===!0?i.unshift(m):t.unshift(m)}function c(h,f){t.length>1&&t.sort(h||QY),r.length>1&&r.sort(f||bP),i.length>1&&i.sort(f||bP)}function u(){for(let h=e,f=n.length;h<f;h++){const p=n[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:r,transparent:i,init:s,push:a,unshift:l,finish:u,sort:c}}function JY(){let n=new WeakMap;function e(r,i){const s=n.get(r);let o;return s===void 0?(o=new AP,n.set(r,[o])):i>=s.length?(o=new AP,s.push(o)):o=s[i],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function eK(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new N,color:new at};break;case"SpotLight":t={position:new N,direction:new N,color:new at,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new N,color:new at,distance:0,decay:0};break;case"HemisphereLight":t={direction:new N,skyColor:new at,groundColor:new at};break;case"RectAreaLight":t={color:new at,position:new N,halfWidth:new N,halfHeight:new N};break}return n[e.id]=t,t}}}function tK(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let nK=0;function rK(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function iK(n,e){const t=new eK,r=tK(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)i.probe.push(new N);const s=new N,o=new ot,a=new ot;function l(u,h){let f=0,p=0,_=0;for(let $=0;$<9;$++)i.probe[$].set(0,0,0);let y=0,g=0,m=0,v=0,x=0,w=0,E=0,S=0,C=0,A=0,k=0;u.sort(rK);const T=h===!0?Math.PI:1;for(let $=0,P=u.length;$<P;$++){const M=u[$],I=M.color,j=M.intensity,O=M.distance,z=M.shadow&&M.shadow.map?M.shadow.map.texture:null;if(M.isAmbientLight)f+=I.r*j*T,p+=I.g*j*T,_+=I.b*j*T;else if(M.isLightProbe){for(let B=0;B<9;B++)i.probe[B].addScaledVector(M.sh.coefficients[B],j);k++}else if(M.isDirectionalLight){const B=t.get(M);if(B.color.copy(M.color).multiplyScalar(M.intensity*T),M.castShadow){const L=M.shadow,D=r.get(M);D.shadowBias=L.bias,D.shadowNormalBias=L.normalBias,D.shadowRadius=L.radius,D.shadowMapSize=L.mapSize,i.directionalShadow[y]=D,i.directionalShadowMap[y]=z,i.directionalShadowMatrix[y]=M.shadow.matrix,w++}i.directional[y]=B,y++}else if(M.isSpotLight){const B=t.get(M);B.position.setFromMatrixPosition(M.matrixWorld),B.color.copy(I).multiplyScalar(j*T),B.distance=O,B.coneCos=Math.cos(M.angle),B.penumbraCos=Math.cos(M.angle*(1-M.penumbra)),B.decay=M.decay,i.spot[m]=B;const L=M.shadow;if(M.map&&(i.spotLightMap[C]=M.map,C++,L.updateMatrices(M),M.castShadow&&A++),i.spotLightMatrix[m]=L.matrix,M.castShadow){const D=r.get(M);D.shadowBias=L.bias,D.shadowNormalBias=L.normalBias,D.shadowRadius=L.radius,D.shadowMapSize=L.mapSize,i.spotShadow[m]=D,i.spotShadowMap[m]=z,S++}m++}else if(M.isRectAreaLight){const B=t.get(M);B.color.copy(I).multiplyScalar(j),B.halfWidth.set(M.width*.5,0,0),B.halfHeight.set(0,M.height*.5,0),i.rectArea[v]=B,v++}else if(M.isPointLight){const B=t.get(M);if(B.color.copy(M.color).multiplyScalar(M.intensity*T),B.distance=M.distance,B.decay=M.decay,M.castShadow){const L=M.shadow,D=r.get(M);D.shadowBias=L.bias,D.shadowNormalBias=L.normalBias,D.shadowRadius=L.radius,D.shadowMapSize=L.mapSize,D.shadowCameraNear=L.camera.near,D.shadowCameraFar=L.camera.far,i.pointShadow[g]=D,i.pointShadowMap[g]=z,i.pointShadowMatrix[g]=M.shadow.matrix,E++}i.point[g]=B,g++}else if(M.isHemisphereLight){const B=t.get(M);B.skyColor.copy(M.color).multiplyScalar(j*T),B.groundColor.copy(M.groundColor).multiplyScalar(j*T),i.hemi[x]=B,x++}}v>0&&(e.isWebGL2?n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=je.LTC_FLOAT_1,i.rectAreaLTC2=je.LTC_FLOAT_2):(i.rectAreaLTC1=je.LTC_HALF_1,i.rectAreaLTC2=je.LTC_HALF_2):n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=je.LTC_FLOAT_1,i.rectAreaLTC2=je.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=je.LTC_HALF_1,i.rectAreaLTC2=je.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=f,i.ambient[1]=p,i.ambient[2]=_;const R=i.hash;(R.directionalLength!==y||R.pointLength!==g||R.spotLength!==m||R.rectAreaLength!==v||R.hemiLength!==x||R.numDirectionalShadows!==w||R.numPointShadows!==E||R.numSpotShadows!==S||R.numSpotMaps!==C||R.numLightProbes!==k)&&(i.directional.length=y,i.spot.length=m,i.rectArea.length=v,i.point.length=g,i.hemi.length=x,i.directionalShadow.length=w,i.directionalShadowMap.length=w,i.pointShadow.length=E,i.pointShadowMap.length=E,i.spotShadow.length=S,i.spotShadowMap.length=S,i.directionalShadowMatrix.length=w,i.pointShadowMatrix.length=E,i.spotLightMatrix.length=S+C-A,i.spotLightMap.length=C,i.numSpotLightShadowsWithMaps=A,i.numLightProbes=k,R.directionalLength=y,R.pointLength=g,R.spotLength=m,R.rectAreaLength=v,R.hemiLength=x,R.numDirectionalShadows=w,R.numPointShadows=E,R.numSpotShadows=S,R.numSpotMaps=C,R.numLightProbes=k,i.version=nK++)}function c(u,h){let f=0,p=0,_=0,y=0,g=0;const m=h.matrixWorldInverse;for(let v=0,x=u.length;v<x;v++){const w=u[v];if(w.isDirectionalLight){const E=i.directional[f];E.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),E.direction.sub(s),E.direction.transformDirection(m),f++}else if(w.isSpotLight){const E=i.spot[_];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(m),E.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),E.direction.sub(s),E.direction.transformDirection(m),_++}else if(w.isRectAreaLight){const E=i.rectArea[y];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(m),a.identity(),o.copy(w.matrixWorld),o.premultiply(m),a.extractRotation(o),E.halfWidth.set(w.width*.5,0,0),E.halfHeight.set(0,w.height*.5,0),E.halfWidth.applyMatrix4(a),E.halfHeight.applyMatrix4(a),y++}else if(w.isPointLight){const E=i.point[p];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(m),p++}else if(w.isHemisphereLight){const E=i.hemi[g];E.direction.setFromMatrixPosition(w.matrixWorld),E.direction.transformDirection(m),g++}}}return{setup:l,setupView:c,state:i}}function MP(n,e){const t=new iK(n,e),r=[],i=[];function s(){r.length=0,i.length=0}function o(h){r.push(h)}function a(h){i.push(h)}function l(h){t.setup(r,h)}function c(h){t.setupView(r,h)}return{init:s,state:{lightsArray:r,shadowsArray:i,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function sK(n,e){let t=new WeakMap;function r(s,o=0){const a=t.get(s);let l;return a===void 0?(l=new MP(n,e),t.set(s,[l])):o>=a.length?(l=new MP(n,e),a.push(l)):l=a[o],l}function i(){t=new WeakMap}return{get:r,dispose:i}}class oK extends Mp{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=H9,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class aK extends Mp{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const lK=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,cK=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function uK(n,e,t){let r=new HA;const i=new gt,s=new gt,o=new Cn,a=new oK({depthPacking:V9}),l=new aK,c={},u=t.maxTextureSize,h={[$a]:ji,[ji]:$a,[gi]:gi},f=new fs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new gt},radius:{value:4}},vertexShader:lK,fragmentShader:cK}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const _=new xn;_.setAttribute("position",new Dn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new Be(_,f),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=dU;let m=this.type;this.render=function(S,C,A){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||S.length===0)return;const k=n.getRenderTarget(),T=n.getActiveCubeFace(),R=n.getActiveMipmapLevel(),$=n.state;$.setBlending(Fa),$.buffers.color.setClear(1,1,1,1),$.buffers.depth.setTest(!0),$.setScissorTest(!1);const P=m!==wa&&this.type===wa,M=m===wa&&this.type!==wa;for(let I=0,j=S.length;I<j;I++){const O=S[I],z=O.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",O,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;i.copy(z.mapSize);const B=z.getFrameExtents();if(i.multiply(B),s.copy(z.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/B.x),i.x=s.x*B.x,z.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/B.y),i.y=s.y*B.y,z.mapSize.y=s.y)),z.map===null||P===!0||M===!0){const D=this.type!==wa?{minFilter:ei,magFilter:ei}:{};z.map!==null&&z.map.dispose(),z.map=new zs(i.x,i.y,D),z.map.texture.name=O.name+".shadowMap",z.camera.updateProjectionMatrix()}n.setRenderTarget(z.map),n.clear();const L=z.getViewportCount();for(let D=0;D<L;D++){const W=z.getViewport(D);o.set(s.x*W.x,s.y*W.y,s.x*W.z,s.y*W.w),$.viewport(o),z.updateMatrices(O,D),r=z.getFrustum(),w(C,A,z.camera,O,this.type)}z.isPointLightShadow!==!0&&this.type===wa&&v(z,A),z.needsUpdate=!1}m=this.type,g.needsUpdate=!1,n.setRenderTarget(k,T,R)};function v(S,C){const A=e.update(y);f.defines.VSM_SAMPLES!==S.blurSamples&&(f.defines.VSM_SAMPLES=S.blurSamples,p.defines.VSM_SAMPLES=S.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new zs(i.x,i.y)),f.uniforms.shadow_pass.value=S.map.texture,f.uniforms.resolution.value=S.mapSize,f.uniforms.radius.value=S.radius,n.setRenderTarget(S.mapPass),n.clear(),n.renderBufferDirect(C,null,A,f,y,null),p.uniforms.shadow_pass.value=S.mapPass.texture,p.uniforms.resolution.value=S.mapSize,p.uniforms.radius.value=S.radius,n.setRenderTarget(S.map),n.clear(),n.renderBufferDirect(C,null,A,p,y,null)}function x(S,C,A,k){let T=null;const R=A.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(R!==void 0)T=R;else if(T=A.isPointLight===!0?l:a,n.localClippingEnabled&&C.clipShadows===!0&&Array.isArray(C.clippingPlanes)&&C.clippingPlanes.length!==0||C.displacementMap&&C.displacementScale!==0||C.alphaMap&&C.alphaTest>0||C.map&&C.alphaTest>0){const $=T.uuid,P=C.uuid;let M=c[$];M===void 0&&(M={},c[$]=M);let I=M[P];I===void 0&&(I=T.clone(),M[P]=I,C.addEventListener("dispose",E)),T=I}if(T.visible=C.visible,T.wireframe=C.wireframe,k===wa?T.side=C.shadowSide!==null?C.shadowSide:C.side:T.side=C.shadowSide!==null?C.shadowSide:h[C.side],T.alphaMap=C.alphaMap,T.alphaTest=C.alphaTest,T.map=C.map,T.clipShadows=C.clipShadows,T.clippingPlanes=C.clippingPlanes,T.clipIntersection=C.clipIntersection,T.displacementMap=C.displacementMap,T.displacementScale=C.displacementScale,T.displacementBias=C.displacementBias,T.wireframeLinewidth=C.wireframeLinewidth,T.linewidth=C.linewidth,A.isPointLight===!0&&T.isMeshDistanceMaterial===!0){const $=n.properties.get(T);$.light=A}return T}function w(S,C,A,k,T){if(S.visible===!1)return;if(S.layers.test(C.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&T===wa)&&(!S.frustumCulled||r.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(A.matrixWorldInverse,S.matrixWorld);const P=e.update(S),M=S.material;if(Array.isArray(M)){const I=P.groups;for(let j=0,O=I.length;j<O;j++){const z=I[j],B=M[z.materialIndex];if(B&&B.visible){const L=x(S,B,k,T);S.onBeforeShadow(n,S,C,A,P,L,z),n.renderBufferDirect(A,null,P,L,S,z),S.onAfterShadow(n,S,C,A,P,L,z)}}}else if(M.visible){const I=x(S,M,k,T);S.onBeforeShadow(n,S,C,A,P,I,null),n.renderBufferDirect(A,null,P,I,S,null),S.onAfterShadow(n,S,C,A,P,I,null)}}const $=S.children;for(let P=0,M=$.length;P<M;P++)w($[P],C,A,k,T)}function E(S){S.target.removeEventListener("dispose",E);for(const A in c){const k=c[A],T=S.target.uuid;T in k&&(k[T].dispose(),delete k[T])}}}function dK(n,e,t){const r=t.isWebGL2;function i(){let Z=!1;const Oe=new Cn;let re=null;const Pe=new Cn(0,0,0,0);return{setMask:function(ze){re!==ze&&!Z&&(n.colorMask(ze,ze,ze,ze),re=ze)},setLocked:function(ze){Z=ze},setClear:function(ze,bt,ln,er,Pr){Pr===!0&&(ze*=er,bt*=er,ln*=er),Oe.set(ze,bt,ln,er),Pe.equals(Oe)===!1&&(n.clearColor(ze,bt,ln,er),Pe.copy(Oe))},reset:function(){Z=!1,re=null,Pe.set(-1,0,0,0)}}}function s(){let Z=!1,Oe=null,re=null,Pe=null;return{setTest:function(ze){ze?G(n.DEPTH_TEST):he(n.DEPTH_TEST)},setMask:function(ze){Oe!==ze&&!Z&&(n.depthMask(ze),Oe=ze)},setFunc:function(ze){if(re!==ze){switch(ze){case S9:n.depthFunc(n.NEVER);break;case E9:n.depthFunc(n.ALWAYS);break;case T9:n.depthFunc(n.LESS);break;case Tx:n.depthFunc(n.LEQUAL);break;case C9:n.depthFunc(n.EQUAL);break;case b9:n.depthFunc(n.GEQUAL);break;case A9:n.depthFunc(n.GREATER);break;case M9:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}re=ze}},setLocked:function(ze){Z=ze},setClear:function(ze){Pe!==ze&&(n.clearDepth(ze),Pe=ze)},reset:function(){Z=!1,Oe=null,re=null,Pe=null}}}function o(){let Z=!1,Oe=null,re=null,Pe=null,ze=null,bt=null,ln=null,er=null,Pr=null;return{setTest:function(qt){Z||(qt?G(n.STENCIL_TEST):he(n.STENCIL_TEST))},setMask:function(qt){Oe!==qt&&!Z&&(n.stencilMask(qt),Oe=qt)},setFunc:function(qt,$n,xs){(re!==qt||Pe!==$n||ze!==xs)&&(n.stencilFunc(qt,$n,xs),re=qt,Pe=$n,ze=xs)},setOp:function(qt,$n,xs){(bt!==qt||ln!==$n||er!==xs)&&(n.stencilOp(qt,$n,xs),bt=qt,ln=$n,er=xs)},setLocked:function(qt){Z=qt},setClear:function(qt){Pr!==qt&&(n.clearStencil(qt),Pr=qt)},reset:function(){Z=!1,Oe=null,re=null,Pe=null,ze=null,bt=null,ln=null,er=null,Pr=null}}}const a=new i,l=new s,c=new o,u=new WeakMap,h=new WeakMap;let f={},p={},_=new WeakMap,y=[],g=null,m=!1,v=null,x=null,w=null,E=null,S=null,C=null,A=null,k=new at(0,0,0),T=0,R=!1,$=null,P=null,M=null,I=null,j=null;const O=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let z=!1,B=0;const L=n.getParameter(n.VERSION);L.indexOf("WebGL")!==-1?(B=parseFloat(/^WebGL (\d)/.exec(L)[1]),z=B>=1):L.indexOf("OpenGL ES")!==-1&&(B=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),z=B>=2);let D=null,W={};const H=n.getParameter(n.SCISSOR_BOX),K=n.getParameter(n.VIEWPORT),oe=new Cn().fromArray(H),me=new Cn().fromArray(K);function Se(Z,Oe,re,Pe){const ze=new Uint8Array(4),bt=n.createTexture();n.bindTexture(Z,bt),n.texParameteri(Z,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Z,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let ln=0;ln<re;ln++)r&&(Z===n.TEXTURE_3D||Z===n.TEXTURE_2D_ARRAY)?n.texImage3D(Oe,0,n.RGBA,1,1,Pe,0,n.RGBA,n.UNSIGNED_BYTE,ze):n.texImage2D(Oe+ln,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ze);return bt}const Te={};Te[n.TEXTURE_2D]=Se(n.TEXTURE_2D,n.TEXTURE_2D,1),Te[n.TEXTURE_CUBE_MAP]=Se(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(Te[n.TEXTURE_2D_ARRAY]=Se(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Te[n.TEXTURE_3D]=Se(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),G(n.DEPTH_TEST),l.setFunc(Tx),tt(!1),st(cI),G(n.CULL_FACE),Ue(Fa);function G(Z){f[Z]!==!0&&(n.enable(Z),f[Z]=!0)}function he(Z){f[Z]!==!1&&(n.disable(Z),f[Z]=!1)}function ve(Z,Oe){return p[Z]!==Oe?(n.bindFramebuffer(Z,Oe),p[Z]=Oe,r&&(Z===n.DRAW_FRAMEBUFFER&&(p[n.FRAMEBUFFER]=Oe),Z===n.FRAMEBUFFER&&(p[n.DRAW_FRAMEBUFFER]=Oe)),!0):!1}function Y(Z,Oe){let re=y,Pe=!1;if(Z){re=_.get(Oe),re===void 0&&(re=[],_.set(Oe,re));const ze=Z.textures;if(re.length!==ze.length||re[0]!==n.COLOR_ATTACHMENT0){for(let bt=0,ln=ze.length;bt<ln;bt++)re[bt]=n.COLOR_ATTACHMENT0+bt;re.length=ze.length,Pe=!0}}else re[0]!==n.BACK&&(re[0]=n.BACK,Pe=!0);if(Pe)if(t.isWebGL2)n.drawBuffers(re);else if(e.has("WEBGL_draw_buffers")===!0)e.get("WEBGL_draw_buffers").drawBuffersWEBGL(re);else throw new Error("THREE.WebGLState: Usage of gl.drawBuffers() require WebGL2 or WEBGL_draw_buffers extension")}function Ne(Z){return g!==Z?(n.useProgram(Z),g=Z,!0):!1}const Re={[gu]:n.FUNC_ADD,[a9]:n.FUNC_SUBTRACT,[l9]:n.FUNC_REVERSE_SUBTRACT};if(r)Re[hI]=n.MIN,Re[fI]=n.MAX;else{const Z=e.get("EXT_blend_minmax");Z!==null&&(Re[hI]=Z.MIN_EXT,Re[fI]=Z.MAX_EXT)}const Ve={[c9]:n.ZERO,[u9]:n.ONE,[d9]:n.SRC_COLOR,[bC]:n.SRC_ALPHA,[v9]:n.SRC_ALPHA_SATURATE,[m9]:n.DST_COLOR,[f9]:n.DST_ALPHA,[h9]:n.ONE_MINUS_SRC_COLOR,[AC]:n.ONE_MINUS_SRC_ALPHA,[g9]:n.ONE_MINUS_DST_COLOR,[p9]:n.ONE_MINUS_DST_ALPHA,[_9]:n.CONSTANT_COLOR,[x9]:n.ONE_MINUS_CONSTANT_COLOR,[y9]:n.CONSTANT_ALPHA,[w9]:n.ONE_MINUS_CONSTANT_ALPHA};function Ue(Z,Oe,re,Pe,ze,bt,ln,er,Pr,qt){if(Z===Fa){m===!0&&(he(n.BLEND),m=!1);return}if(m===!1&&(G(n.BLEND),m=!0),Z!==o9){if(Z!==v||qt!==R){if((x!==gu||S!==gu)&&(n.blendEquation(n.FUNC_ADD),x=gu,S=gu),qt)switch(Z){case xf:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case CC:n.blendFunc(n.ONE,n.ONE);break;case uI:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case dI:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}else switch(Z){case xf:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case CC:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case uI:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case dI:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}w=null,E=null,C=null,A=null,k.set(0,0,0),T=0,v=Z,R=qt}return}ze=ze||Oe,bt=bt||re,ln=ln||Pe,(Oe!==x||ze!==S)&&(n.blendEquationSeparate(Re[Oe],Re[ze]),x=Oe,S=ze),(re!==w||Pe!==E||bt!==C||ln!==A)&&(n.blendFuncSeparate(Ve[re],Ve[Pe],Ve[bt],Ve[ln]),w=re,E=Pe,C=bt,A=ln),(er.equals(k)===!1||Pr!==T)&&(n.blendColor(er.r,er.g,er.b,Pr),k.copy(er),T=Pr),v=Z,R=!1}function Je(Z,Oe){Z.side===gi?he(n.CULL_FACE):G(n.CULL_FACE);let re=Z.side===ji;Oe&&(re=!re),tt(re),Z.blending===xf&&Z.transparent===!1?Ue(Fa):Ue(Z.blending,Z.blendEquation,Z.blendSrc,Z.blendDst,Z.blendEquationAlpha,Z.blendSrcAlpha,Z.blendDstAlpha,Z.blendColor,Z.blendAlpha,Z.premultipliedAlpha),l.setFunc(Z.depthFunc),l.setTest(Z.depthTest),l.setMask(Z.depthWrite),a.setMask(Z.colorWrite);const Pe=Z.stencilWrite;c.setTest(Pe),Pe&&(c.setMask(Z.stencilWriteMask),c.setFunc(Z.stencilFunc,Z.stencilRef,Z.stencilFuncMask),c.setOp(Z.stencilFail,Z.stencilZFail,Z.stencilZPass)),V(Z.polygonOffset,Z.polygonOffsetFactor,Z.polygonOffsetUnits),Z.alphaToCoverage===!0?G(n.SAMPLE_ALPHA_TO_COVERAGE):he(n.SAMPLE_ALPHA_TO_COVERAGE)}function tt(Z){$!==Z&&(Z?n.frontFace(n.CW):n.frontFace(n.CCW),$=Z)}function st(Z){Z!==r9?(G(n.CULL_FACE),Z!==P&&(Z===cI?n.cullFace(n.BACK):Z===i9?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):he(n.CULL_FACE),P=Z}function nn(Z){Z!==M&&(z&&n.lineWidth(Z),M=Z)}function V(Z,Oe,re){Z?(G(n.POLYGON_OFFSET_FILL),(I!==Oe||j!==re)&&(n.polygonOffset(Oe,re),I=Oe,j=re)):he(n.POLYGON_OFFSET_FILL)}function b(Z){Z?G(n.SCISSOR_TEST):he(n.SCISSOR_TEST)}function X(Z){Z===void 0&&(Z=n.TEXTURE0+O-1),D!==Z&&(n.activeTexture(Z),D=Z)}function J(Z,Oe,re){re===void 0&&(D===null?re=n.TEXTURE0+O-1:re=D);let Pe=W[re];Pe===void 0&&(Pe={type:void 0,texture:void 0},W[re]=Pe),(Pe.type!==Z||Pe.texture!==Oe)&&(D!==re&&(n.activeTexture(re),D=re),n.bindTexture(Z,Oe||Te[Z]),Pe.type=Z,Pe.texture=Oe)}function te(){const Z=W[D];Z!==void 0&&Z.type!==void 0&&(n.bindTexture(Z.type,null),Z.type=void 0,Z.texture=void 0)}function ne(){try{n.compressedTexImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Ce(){try{n.compressedTexImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Ee(){try{n.texSubImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ye(){try{n.texSubImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function xe(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Ge(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function we(){try{n.texStorage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Rt(){try{n.texStorage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function q(){try{n.texImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ie(){try{n.texImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function fe(Z){oe.equals(Z)===!1&&(n.scissor(Z.x,Z.y,Z.z,Z.w),oe.copy(Z))}function ge(Z){me.equals(Z)===!1&&(n.viewport(Z.x,Z.y,Z.z,Z.w),me.copy(Z))}function Le(Z,Oe){let re=h.get(Oe);re===void 0&&(re=new WeakMap,h.set(Oe,re));let Pe=re.get(Z);Pe===void 0&&(Pe=n.getUniformBlockIndex(Oe,Z.name),re.set(Z,Pe))}function Ie(Z,Oe){const Pe=h.get(Oe).get(Z);u.get(Oe)!==Pe&&(n.uniformBlockBinding(Oe,Pe,Z.__bindingPointIndex),u.set(Oe,Pe))}function Qe(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),r===!0&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),f={},D=null,W={},p={},_=new WeakMap,y=[],g=null,m=!1,v=null,x=null,w=null,E=null,S=null,C=null,A=null,k=new at(0,0,0),T=0,R=!1,$=null,P=null,M=null,I=null,j=null,oe.set(0,0,n.canvas.width,n.canvas.height),me.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:G,disable:he,bindFramebuffer:ve,drawBuffers:Y,useProgram:Ne,setBlending:Ue,setMaterial:Je,setFlipSided:tt,setCullFace:st,setLineWidth:nn,setPolygonOffset:V,setScissorTest:b,activeTexture:X,bindTexture:J,unbindTexture:te,compressedTexImage2D:ne,compressedTexImage3D:Ce,texImage2D:q,texImage3D:ie,updateUBOMapping:Le,uniformBlockBinding:Ie,texStorage2D:we,texStorage3D:Rt,texSubImage2D:Ee,texSubImage3D:ye,compressedTexSubImage2D:xe,compressedTexSubImage3D:Ge,scissor:fe,viewport:ge,reset:Qe}}function hK(n,e,t,r,i,s,o){const a=i.isWebGL2,l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new gt,h=new WeakMap;let f;const p=new WeakMap;let _=!1;try{_=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(V,b){return _?new OffscreenCanvas(V,b):Px("canvas")}function g(V,b,X,J){let te=1;const ne=nn(V);if((ne.width>J||ne.height>J)&&(te=J/Math.max(ne.width,ne.height)),te<1||b===!0)if(typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&V instanceof ImageBitmap||typeof VideoFrame<"u"&&V instanceof VideoFrame){const Ce=b?Ix:Math.floor,Ee=Ce(te*ne.width),ye=Ce(te*ne.height);f===void 0&&(f=y(Ee,ye));const xe=X?y(Ee,ye):f;return xe.width=Ee,xe.height=ye,xe.getContext("2d").drawImage(V,0,0,Ee,ye),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ne.width+"x"+ne.height+") to ("+Ee+"x"+ye+")."),xe}else return"data"in V&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ne.width+"x"+ne.height+")."),V;return V}function m(V){const b=nn(V);return PC(b.width)&&PC(b.height)}function v(V){return a?!1:V.wrapS!==ks||V.wrapT!==ks||V.minFilter!==ei&&V.minFilter!==mi}function x(V,b){return V.generateMipmaps&&b&&V.minFilter!==ei&&V.minFilter!==mi}function w(V){n.generateMipmap(V)}function E(V,b,X,J,te=!1){if(a===!1)return b;if(V!==null){if(n[V]!==void 0)return n[V];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+V+"'")}let ne=b;if(b===n.RED&&(X===n.FLOAT&&(ne=n.R32F),X===n.HALF_FLOAT&&(ne=n.R16F),X===n.UNSIGNED_BYTE&&(ne=n.R8)),b===n.RED_INTEGER&&(X===n.UNSIGNED_BYTE&&(ne=n.R8UI),X===n.UNSIGNED_SHORT&&(ne=n.R16UI),X===n.UNSIGNED_INT&&(ne=n.R32UI),X===n.BYTE&&(ne=n.R8I),X===n.SHORT&&(ne=n.R16I),X===n.INT&&(ne=n.R32I)),b===n.RG&&(X===n.FLOAT&&(ne=n.RG32F),X===n.HALF_FLOAT&&(ne=n.RG16F),X===n.UNSIGNED_BYTE&&(ne=n.RG8)),b===n.RG_INTEGER&&(X===n.UNSIGNED_BYTE&&(ne=n.RG8UI),X===n.UNSIGNED_SHORT&&(ne=n.RG16UI),X===n.UNSIGNED_INT&&(ne=n.RG32UI),X===n.BYTE&&(ne=n.RG8I),X===n.SHORT&&(ne=n.RG16I),X===n.INT&&(ne=n.RG32I)),b===n.RGBA){const Ce=te?Ax:Jt.getTransfer(J);X===n.FLOAT&&(ne=n.RGBA32F),X===n.HALF_FLOAT&&(ne=n.RGBA16F),X===n.UNSIGNED_BYTE&&(ne=Ce===vn?n.SRGB8_ALPHA8:n.RGBA8),X===n.UNSIGNED_SHORT_4_4_4_4&&(ne=n.RGBA4),X===n.UNSIGNED_SHORT_5_5_5_1&&(ne=n.RGB5_A1)}return(ne===n.R16F||ne===n.R32F||ne===n.RG16F||ne===n.RG32F||ne===n.RGBA16F||ne===n.RGBA32F)&&e.get("EXT_color_buffer_float"),ne}function S(V,b,X){return x(V,X)===!0||V.isFramebufferTexture&&V.minFilter!==ei&&V.minFilter!==mi?Math.log2(Math.max(b.width,b.height))+1:V.mipmaps!==void 0&&V.mipmaps.length>0?V.mipmaps.length:V.isCompressedTexture&&Array.isArray(V.image)?b.mipmaps.length:1}function C(V){return V===ei||V===NC||V===Ih?n.NEAREST:n.LINEAR}function A(V){const b=V.target;b.removeEventListener("dispose",A),T(b),b.isVideoTexture&&h.delete(b)}function k(V){const b=V.target;b.removeEventListener("dispose",k),$(b)}function T(V){const b=r.get(V);if(b.__webglInit===void 0)return;const X=V.source,J=p.get(X);if(J){const te=J[b.__cacheKey];te.usedTimes--,te.usedTimes===0&&R(V),Object.keys(J).length===0&&p.delete(X)}r.remove(V)}function R(V){const b=r.get(V);n.deleteTexture(b.__webglTexture);const X=V.source,J=p.get(X);delete J[b.__cacheKey],o.memory.textures--}function $(V){const b=r.get(V);if(V.depthTexture&&V.depthTexture.dispose(),V.isWebGLCubeRenderTarget)for(let J=0;J<6;J++){if(Array.isArray(b.__webglFramebuffer[J]))for(let te=0;te<b.__webglFramebuffer[J].length;te++)n.deleteFramebuffer(b.__webglFramebuffer[J][te]);else n.deleteFramebuffer(b.__webglFramebuffer[J]);b.__webglDepthbuffer&&n.deleteRenderbuffer(b.__webglDepthbuffer[J])}else{if(Array.isArray(b.__webglFramebuffer))for(let J=0;J<b.__webglFramebuffer.length;J++)n.deleteFramebuffer(b.__webglFramebuffer[J]);else n.deleteFramebuffer(b.__webglFramebuffer);if(b.__webglDepthbuffer&&n.deleteRenderbuffer(b.__webglDepthbuffer),b.__webglMultisampledFramebuffer&&n.deleteFramebuffer(b.__webglMultisampledFramebuffer),b.__webglColorRenderbuffer)for(let J=0;J<b.__webglColorRenderbuffer.length;J++)b.__webglColorRenderbuffer[J]&&n.deleteRenderbuffer(b.__webglColorRenderbuffer[J]);b.__webglDepthRenderbuffer&&n.deleteRenderbuffer(b.__webglDepthRenderbuffer)}const X=V.textures;for(let J=0,te=X.length;J<te;J++){const ne=r.get(X[J]);ne.__webglTexture&&(n.deleteTexture(ne.__webglTexture),o.memory.textures--),r.remove(X[J])}r.remove(V)}let P=0;function M(){P=0}function I(){const V=P;return V>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+V+" texture units while this GPU supports only "+i.maxTextures),P+=1,V}function j(V){const b=[];return b.push(V.wrapS),b.push(V.wrapT),b.push(V.wrapR||0),b.push(V.magFilter),b.push(V.minFilter),b.push(V.anisotropy),b.push(V.internalFormat),b.push(V.format),b.push(V.type),b.push(V.generateMipmaps),b.push(V.premultiplyAlpha),b.push(V.flipY),b.push(V.unpackAlignment),b.push(V.colorSpace),b.join()}function O(V,b){const X=r.get(V);if(V.isVideoTexture&&tt(V),V.isRenderTargetTexture===!1&&V.version>0&&X.__version!==V.version){const J=V.image;if(J===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(J.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{me(X,V,b);return}}t.bindTexture(n.TEXTURE_2D,X.__webglTexture,n.TEXTURE0+b)}function z(V,b){const X=r.get(V);if(V.version>0&&X.__version!==V.version){me(X,V,b);return}t.bindTexture(n.TEXTURE_2D_ARRAY,X.__webglTexture,n.TEXTURE0+b)}function B(V,b){const X=r.get(V);if(V.version>0&&X.__version!==V.version){me(X,V,b);return}t.bindTexture(n.TEXTURE_3D,X.__webglTexture,n.TEXTURE0+b)}function L(V,b){const X=r.get(V);if(V.version>0&&X.__version!==V.version){Se(X,V,b);return}t.bindTexture(n.TEXTURE_CUBE_MAP,X.__webglTexture,n.TEXTURE0+b)}const D={[Cx]:n.REPEAT,[ks]:n.CLAMP_TO_EDGE,[bx]:n.MIRRORED_REPEAT},W={[ei]:n.NEAREST,[NC]:n.NEAREST_MIPMAP_NEAREST,[Ih]:n.NEAREST_MIPMAP_LINEAR,[mi]:n.LINEAR,[V_]:n.LINEAR_MIPMAP_NEAREST,[$l]:n.LINEAR_MIPMAP_LINEAR},H={[W9]:n.NEVER,[Z9]:n.ALWAYS,[Y9]:n.LESS,[MU]:n.LEQUAL,[K9]:n.EQUAL,[q9]:n.GEQUAL,[$9]:n.GREATER,[X9]:n.NOTEQUAL};function K(V,b,X){if(b.type===Na&&e.has("OES_texture_float_linear")===!1&&(b.magFilter===mi||b.magFilter===V_||b.magFilter===Ih||b.magFilter===$l||b.minFilter===mi||b.minFilter===V_||b.minFilter===Ih||b.minFilter===$l)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),X?(n.texParameteri(V,n.TEXTURE_WRAP_S,D[b.wrapS]),n.texParameteri(V,n.TEXTURE_WRAP_T,D[b.wrapT]),(V===n.TEXTURE_3D||V===n.TEXTURE_2D_ARRAY)&&n.texParameteri(V,n.TEXTURE_WRAP_R,D[b.wrapR]),n.texParameteri(V,n.TEXTURE_MAG_FILTER,W[b.magFilter]),n.texParameteri(V,n.TEXTURE_MIN_FILTER,W[b.minFilter])):(n.texParameteri(V,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(V,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(V===n.TEXTURE_3D||V===n.TEXTURE_2D_ARRAY)&&n.texParameteri(V,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),(b.wrapS!==ks||b.wrapT!==ks)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(V,n.TEXTURE_MAG_FILTER,C(b.magFilter)),n.texParameteri(V,n.TEXTURE_MIN_FILTER,C(b.minFilter)),b.minFilter!==ei&&b.minFilter!==mi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),b.compareFunction&&(n.texParameteri(V,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(V,n.TEXTURE_COMPARE_FUNC,H[b.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(b.magFilter===ei||b.minFilter!==Ih&&b.minFilter!==$l||b.type===Na&&e.has("OES_texture_float_linear")===!1||a===!1&&b.type===Xa&&e.has("OES_texture_half_float_linear")===!1)return;if(b.anisotropy>1||r.get(b).__currentAnisotropy){const J=e.get("EXT_texture_filter_anisotropic");n.texParameterf(V,J.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,i.getMaxAnisotropy())),r.get(b).__currentAnisotropy=b.anisotropy}}}function oe(V,b){let X=!1;V.__webglInit===void 0&&(V.__webglInit=!0,b.addEventListener("dispose",A));const J=b.source;let te=p.get(J);te===void 0&&(te={},p.set(J,te));const ne=j(b);if(ne!==V.__cacheKey){te[ne]===void 0&&(te[ne]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,X=!0),te[ne].usedTimes++;const Ce=te[V.__cacheKey];Ce!==void 0&&(te[V.__cacheKey].usedTimes--,Ce.usedTimes===0&&R(b)),V.__cacheKey=ne,V.__webglTexture=te[ne].texture}return X}function me(V,b,X){let J=n.TEXTURE_2D;(b.isDataArrayTexture||b.isCompressedArrayTexture)&&(J=n.TEXTURE_2D_ARRAY),b.isData3DTexture&&(J=n.TEXTURE_3D);const te=oe(V,b),ne=b.source;t.bindTexture(J,V.__webglTexture,n.TEXTURE0+X);const Ce=r.get(ne);if(ne.version!==Ce.__version||te===!0){t.activeTexture(n.TEXTURE0+X);const Ee=Jt.getPrimaries(Jt.workingColorSpace),ye=b.colorSpace===Ia?null:Jt.getPrimaries(b.colorSpace),xe=b.colorSpace===Ia||Ee===ye?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,b.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,b.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,xe);const Ge=v(b)&&m(b.image)===!1;let we=g(b.image,Ge,!1,i.maxTextureSize);we=st(b,we);const Rt=m(we)||a,q=s.convert(b.format,b.colorSpace);let ie=s.convert(b.type),fe=E(b.internalFormat,q,ie,b.colorSpace,b.isVideoTexture);K(J,b,Rt);let ge;const Le=b.mipmaps,Ie=a&&b.isVideoTexture!==!0&&fe!==bU,Qe=Ce.__version===void 0||te===!0,Z=ne.dataReady,Oe=S(b,we,Rt);if(b.isDepthTexture)fe=n.DEPTH_COMPONENT,a?b.type===Na?fe=n.DEPTH_COMPONENT32F:b.type===Xl?fe=n.DEPTH_COMPONENT24:b.type===Uu?fe=n.DEPTH24_STENCIL8:fe=n.DEPTH_COMPONENT16:b.type===Na&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),b.format===Fu&&fe===n.DEPTH_COMPONENT&&b.type!==DA&&b.type!==Xl&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),b.type=Xl,ie=s.convert(b.type)),b.format===qf&&fe===n.DEPTH_COMPONENT&&(fe=n.DEPTH_STENCIL,b.type!==Uu&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),b.type=Uu,ie=s.convert(b.type))),Qe&&(Ie?t.texStorage2D(n.TEXTURE_2D,1,fe,we.width,we.height):t.texImage2D(n.TEXTURE_2D,0,fe,we.width,we.height,0,q,ie,null));else if(b.isDataTexture)if(Le.length>0&&Rt){Ie&&Qe&&t.texStorage2D(n.TEXTURE_2D,Oe,fe,Le[0].width,Le[0].height);for(let re=0,Pe=Le.length;re<Pe;re++)ge=Le[re],Ie?Z&&t.texSubImage2D(n.TEXTURE_2D,re,0,0,ge.width,ge.height,q,ie,ge.data):t.texImage2D(n.TEXTURE_2D,re,fe,ge.width,ge.height,0,q,ie,ge.data);b.generateMipmaps=!1}else Ie?(Qe&&t.texStorage2D(n.TEXTURE_2D,Oe,fe,we.width,we.height),Z&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,we.width,we.height,q,ie,we.data)):t.texImage2D(n.TEXTURE_2D,0,fe,we.width,we.height,0,q,ie,we.data);else if(b.isCompressedTexture)if(b.isCompressedArrayTexture){Ie&&Qe&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Oe,fe,Le[0].width,Le[0].height,we.depth);for(let re=0,Pe=Le.length;re<Pe;re++)ge=Le[re],b.format!==Ls?q!==null?Ie?Z&&t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,re,0,0,0,ge.width,ge.height,we.depth,q,ge.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,re,fe,ge.width,ge.height,we.depth,0,ge.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ie?Z&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,re,0,0,0,ge.width,ge.height,we.depth,q,ie,ge.data):t.texImage3D(n.TEXTURE_2D_ARRAY,re,fe,ge.width,ge.height,we.depth,0,q,ie,ge.data)}else{Ie&&Qe&&t.texStorage2D(n.TEXTURE_2D,Oe,fe,Le[0].width,Le[0].height);for(let re=0,Pe=Le.length;re<Pe;re++)ge=Le[re],b.format!==Ls?q!==null?Ie?Z&&t.compressedTexSubImage2D(n.TEXTURE_2D,re,0,0,ge.width,ge.height,q,ge.data):t.compressedTexImage2D(n.TEXTURE_2D,re,fe,ge.width,ge.height,0,ge.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ie?Z&&t.texSubImage2D(n.TEXTURE_2D,re,0,0,ge.width,ge.height,q,ie,ge.data):t.texImage2D(n.TEXTURE_2D,re,fe,ge.width,ge.height,0,q,ie,ge.data)}else if(b.isDataArrayTexture)Ie?(Qe&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Oe,fe,we.width,we.height,we.depth),Z&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,we.width,we.height,we.depth,q,ie,we.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,fe,we.width,we.height,we.depth,0,q,ie,we.data);else if(b.isData3DTexture)Ie?(Qe&&t.texStorage3D(n.TEXTURE_3D,Oe,fe,we.width,we.height,we.depth),Z&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,we.width,we.height,we.depth,q,ie,we.data)):t.texImage3D(n.TEXTURE_3D,0,fe,we.width,we.height,we.depth,0,q,ie,we.data);else if(b.isFramebufferTexture){if(Qe)if(Ie)t.texStorage2D(n.TEXTURE_2D,Oe,fe,we.width,we.height);else{let re=we.width,Pe=we.height;for(let ze=0;ze<Oe;ze++)t.texImage2D(n.TEXTURE_2D,ze,fe,re,Pe,0,q,ie,null),re>>=1,Pe>>=1}}else if(Le.length>0&&Rt){if(Ie&&Qe){const re=nn(Le[0]);t.texStorage2D(n.TEXTURE_2D,Oe,fe,re.width,re.height)}for(let re=0,Pe=Le.length;re<Pe;re++)ge=Le[re],Ie?Z&&t.texSubImage2D(n.TEXTURE_2D,re,0,0,q,ie,ge):t.texImage2D(n.TEXTURE_2D,re,fe,q,ie,ge);b.generateMipmaps=!1}else if(Ie){if(Qe){const re=nn(we);t.texStorage2D(n.TEXTURE_2D,Oe,fe,re.width,re.height)}Z&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,q,ie,we)}else t.texImage2D(n.TEXTURE_2D,0,fe,q,ie,we);x(b,Rt)&&w(J),Ce.__version=ne.version,b.onUpdate&&b.onUpdate(b)}V.__version=b.version}function Se(V,b,X){if(b.image.length!==6)return;const J=oe(V,b),te=b.source;t.bindTexture(n.TEXTURE_CUBE_MAP,V.__webglTexture,n.TEXTURE0+X);const ne=r.get(te);if(te.version!==ne.__version||J===!0){t.activeTexture(n.TEXTURE0+X);const Ce=Jt.getPrimaries(Jt.workingColorSpace),Ee=b.colorSpace===Ia?null:Jt.getPrimaries(b.colorSpace),ye=b.colorSpace===Ia||Ce===Ee?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,b.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,b.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,ye);const xe=b.isCompressedTexture||b.image[0].isCompressedTexture,Ge=b.image[0]&&b.image[0].isDataTexture,we=[];for(let re=0;re<6;re++)!xe&&!Ge?we[re]=g(b.image[re],!1,!0,i.maxCubemapSize):we[re]=Ge?b.image[re].image:b.image[re],we[re]=st(b,we[re]);const Rt=we[0],q=m(Rt)||a,ie=s.convert(b.format,b.colorSpace),fe=s.convert(b.type),ge=E(b.internalFormat,ie,fe,b.colorSpace),Le=a&&b.isVideoTexture!==!0,Ie=ne.__version===void 0||J===!0,Qe=te.dataReady;let Z=S(b,Rt,q);K(n.TEXTURE_CUBE_MAP,b,q);let Oe;if(xe){Le&&Ie&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Z,ge,Rt.width,Rt.height);for(let re=0;re<6;re++){Oe=we[re].mipmaps;for(let Pe=0;Pe<Oe.length;Pe++){const ze=Oe[Pe];b.format!==Ls?ie!==null?Le?Qe&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Pe,0,0,ze.width,ze.height,ie,ze.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Pe,ge,ze.width,ze.height,0,ze.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Le?Qe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Pe,0,0,ze.width,ze.height,ie,fe,ze.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Pe,ge,ze.width,ze.height,0,ie,fe,ze.data)}}}else{if(Oe=b.mipmaps,Le&&Ie){Oe.length>0&&Z++;const re=nn(we[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Z,ge,re.width,re.height)}for(let re=0;re<6;re++)if(Ge){Le?Qe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,0,0,we[re].width,we[re].height,ie,fe,we[re].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,ge,we[re].width,we[re].height,0,ie,fe,we[re].data);for(let Pe=0;Pe<Oe.length;Pe++){const bt=Oe[Pe].image[re].image;Le?Qe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Pe+1,0,0,bt.width,bt.height,ie,fe,bt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Pe+1,ge,bt.width,bt.height,0,ie,fe,bt.data)}}else{Le?Qe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,0,0,ie,fe,we[re]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,ge,ie,fe,we[re]);for(let Pe=0;Pe<Oe.length;Pe++){const ze=Oe[Pe];Le?Qe&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Pe+1,0,0,ie,fe,ze.image[re]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Pe+1,ge,ie,fe,ze.image[re])}}}x(b,q)&&w(n.TEXTURE_CUBE_MAP),ne.__version=te.version,b.onUpdate&&b.onUpdate(b)}V.__version=b.version}function Te(V,b,X,J,te,ne){const Ce=s.convert(X.format,X.colorSpace),Ee=s.convert(X.type),ye=E(X.internalFormat,Ce,Ee,X.colorSpace);if(!r.get(b).__hasExternalTextures){const Ge=Math.max(1,b.width>>ne),we=Math.max(1,b.height>>ne);te===n.TEXTURE_3D||te===n.TEXTURE_2D_ARRAY?t.texImage3D(te,ne,ye,Ge,we,b.depth,0,Ce,Ee,null):t.texImage2D(te,ne,ye,Ge,we,0,Ce,Ee,null)}t.bindFramebuffer(n.FRAMEBUFFER,V),Je(b)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,J,te,r.get(X).__webglTexture,0,Ue(b)):(te===n.TEXTURE_2D||te>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&te<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,J,te,r.get(X).__webglTexture,ne),t.bindFramebuffer(n.FRAMEBUFFER,null)}function G(V,b,X){if(n.bindRenderbuffer(n.RENDERBUFFER,V),b.depthBuffer&&!b.stencilBuffer){let J=a===!0?n.DEPTH_COMPONENT24:n.DEPTH_COMPONENT16;if(X||Je(b)){const te=b.depthTexture;te&&te.isDepthTexture&&(te.type===Na?J=n.DEPTH_COMPONENT32F:te.type===Xl&&(J=n.DEPTH_COMPONENT24));const ne=Ue(b);Je(b)?l.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ne,J,b.width,b.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,ne,J,b.width,b.height)}else n.renderbufferStorage(n.RENDERBUFFER,J,b.width,b.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,V)}else if(b.depthBuffer&&b.stencilBuffer){const J=Ue(b);X&&Je(b)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,J,n.DEPTH24_STENCIL8,b.width,b.height):Je(b)?l.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,J,n.DEPTH24_STENCIL8,b.width,b.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,b.width,b.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,V)}else{const J=b.textures;for(let te=0;te<J.length;te++){const ne=J[te],Ce=s.convert(ne.format,ne.colorSpace),Ee=s.convert(ne.type),ye=E(ne.internalFormat,Ce,Ee,ne.colorSpace),xe=Ue(b);X&&Je(b)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,xe,ye,b.width,b.height):Je(b)?l.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,xe,ye,b.width,b.height):n.renderbufferStorage(n.RENDERBUFFER,ye,b.width,b.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function he(V,b){if(b&&b.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,V),!(b.depthTexture&&b.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(b.depthTexture).__webglTexture||b.depthTexture.image.width!==b.width||b.depthTexture.image.height!==b.height)&&(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=!0),O(b.depthTexture,0);const J=r.get(b.depthTexture).__webglTexture,te=Ue(b);if(b.depthTexture.format===Fu)Je(b)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,J,0,te):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,J,0);else if(b.depthTexture.format===qf)Je(b)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,J,0,te):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,J,0);else throw new Error("Unknown depthTexture format")}function ve(V){const b=r.get(V),X=V.isWebGLCubeRenderTarget===!0;if(V.depthTexture&&!b.__autoAllocateDepthBuffer){if(X)throw new Error("target.depthTexture not supported in Cube render targets");he(b.__webglFramebuffer,V)}else if(X){b.__webglDepthbuffer=[];for(let J=0;J<6;J++)t.bindFramebuffer(n.FRAMEBUFFER,b.__webglFramebuffer[J]),b.__webglDepthbuffer[J]=n.createRenderbuffer(),G(b.__webglDepthbuffer[J],V,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,b.__webglFramebuffer),b.__webglDepthbuffer=n.createRenderbuffer(),G(b.__webglDepthbuffer,V,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function Y(V,b,X){const J=r.get(V);b!==void 0&&Te(J.__webglFramebuffer,V,V.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),X!==void 0&&ve(V)}function Ne(V){const b=V.texture,X=r.get(V),J=r.get(b);V.addEventListener("dispose",k);const te=V.textures,ne=V.isWebGLCubeRenderTarget===!0,Ce=te.length>1,Ee=m(V)||a;if(Ce||(J.__webglTexture===void 0&&(J.__webglTexture=n.createTexture()),J.__version=b.version,o.memory.textures++),ne){X.__webglFramebuffer=[];for(let ye=0;ye<6;ye++)if(a&&b.mipmaps&&b.mipmaps.length>0){X.__webglFramebuffer[ye]=[];for(let xe=0;xe<b.mipmaps.length;xe++)X.__webglFramebuffer[ye][xe]=n.createFramebuffer()}else X.__webglFramebuffer[ye]=n.createFramebuffer()}else{if(a&&b.mipmaps&&b.mipmaps.length>0){X.__webglFramebuffer=[];for(let ye=0;ye<b.mipmaps.length;ye++)X.__webglFramebuffer[ye]=n.createFramebuffer()}else X.__webglFramebuffer=n.createFramebuffer();if(Ce)if(i.drawBuffers)for(let ye=0,xe=te.length;ye<xe;ye++){const Ge=r.get(te[ye]);Ge.__webglTexture===void 0&&(Ge.__webglTexture=n.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&V.samples>0&&Je(V)===!1){X.__webglMultisampledFramebuffer=n.createFramebuffer(),X.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,X.__webglMultisampledFramebuffer);for(let ye=0;ye<te.length;ye++){const xe=te[ye];X.__webglColorRenderbuffer[ye]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,X.__webglColorRenderbuffer[ye]);const Ge=s.convert(xe.format,xe.colorSpace),we=s.convert(xe.type),Rt=E(xe.internalFormat,Ge,we,xe.colorSpace,V.isXRRenderTarget===!0),q=Ue(V);n.renderbufferStorageMultisample(n.RENDERBUFFER,q,Rt,V.width,V.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+ye,n.RENDERBUFFER,X.__webglColorRenderbuffer[ye])}n.bindRenderbuffer(n.RENDERBUFFER,null),V.depthBuffer&&(X.__webglDepthRenderbuffer=n.createRenderbuffer(),G(X.__webglDepthRenderbuffer,V,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ne){t.bindTexture(n.TEXTURE_CUBE_MAP,J.__webglTexture),K(n.TEXTURE_CUBE_MAP,b,Ee);for(let ye=0;ye<6;ye++)if(a&&b.mipmaps&&b.mipmaps.length>0)for(let xe=0;xe<b.mipmaps.length;xe++)Te(X.__webglFramebuffer[ye][xe],V,b,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,xe);else Te(X.__webglFramebuffer[ye],V,b,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,0);x(b,Ee)&&w(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ce){for(let ye=0,xe=te.length;ye<xe;ye++){const Ge=te[ye],we=r.get(Ge);t.bindTexture(n.TEXTURE_2D,we.__webglTexture),K(n.TEXTURE_2D,Ge,Ee),Te(X.__webglFramebuffer,V,Ge,n.COLOR_ATTACHMENT0+ye,n.TEXTURE_2D,0),x(Ge,Ee)&&w(n.TEXTURE_2D)}t.unbindTexture()}else{let ye=n.TEXTURE_2D;if((V.isWebGL3DRenderTarget||V.isWebGLArrayRenderTarget)&&(a?ye=V.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(ye,J.__webglTexture),K(ye,b,Ee),a&&b.mipmaps&&b.mipmaps.length>0)for(let xe=0;xe<b.mipmaps.length;xe++)Te(X.__webglFramebuffer[xe],V,b,n.COLOR_ATTACHMENT0,ye,xe);else Te(X.__webglFramebuffer,V,b,n.COLOR_ATTACHMENT0,ye,0);x(b,Ee)&&w(ye),t.unbindTexture()}V.depthBuffer&&ve(V)}function Re(V){const b=m(V)||a,X=V.textures;for(let J=0,te=X.length;J<te;J++){const ne=X[J];if(x(ne,b)){const Ce=V.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,Ee=r.get(ne).__webglTexture;t.bindTexture(Ce,Ee),w(Ce),t.unbindTexture()}}}function Ve(V){if(a&&V.samples>0&&Je(V)===!1){const b=V.textures,X=V.width,J=V.height;let te=n.COLOR_BUFFER_BIT;const ne=[],Ce=V.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ee=r.get(V),ye=b.length>1;if(ye)for(let xe=0;xe<b.length;xe++)t.bindFramebuffer(n.FRAMEBUFFER,Ee.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+xe,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Ee.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+xe,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Ee.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Ee.__webglFramebuffer);for(let xe=0;xe<b.length;xe++){ne.push(n.COLOR_ATTACHMENT0+xe),V.depthBuffer&&ne.push(Ce);const Ge=Ee.__ignoreDepthValues!==void 0?Ee.__ignoreDepthValues:!1;if(Ge===!1&&(V.depthBuffer&&(te|=n.DEPTH_BUFFER_BIT),V.stencilBuffer&&(te|=n.STENCIL_BUFFER_BIT)),ye&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Ee.__webglColorRenderbuffer[xe]),Ge===!0&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[Ce]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[Ce])),ye){const we=r.get(b[xe]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,we,0)}n.blitFramebuffer(0,0,X,J,0,0,X,J,te,n.NEAREST),c&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,ne)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),ye)for(let xe=0;xe<b.length;xe++){t.bindFramebuffer(n.FRAMEBUFFER,Ee.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+xe,n.RENDERBUFFER,Ee.__webglColorRenderbuffer[xe]);const Ge=r.get(b[xe]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Ee.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+xe,n.TEXTURE_2D,Ge,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Ee.__webglMultisampledFramebuffer)}}function Ue(V){return Math.min(i.maxSamples,V.samples)}function Je(V){const b=r.get(V);return a&&V.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&b.__useRenderToTexture!==!1}function tt(V){const b=o.render.frame;h.get(V)!==b&&(h.set(V,b),V.update())}function st(V,b){const X=V.colorSpace,J=V.format,te=V.type;return V.isCompressedTexture===!0||V.isVideoTexture===!0||V.format===IC||X!==ol&&X!==Ia&&(Jt.getTransfer(X)===vn?a===!1?e.has("EXT_sRGB")===!0&&J===Ls?(V.format=IC,V.minFilter=mi,V.generateMipmaps=!1):b=NU.sRGBToLinear(b):(J!==Ls||te!==oc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",X)),b}function nn(V){return typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement?(u.width=V.naturalWidth||V.width,u.height=V.naturalHeight||V.height):typeof VideoFrame<"u"&&V instanceof VideoFrame?(u.width=V.displayWidth,u.height=V.displayHeight):(u.width=V.width,u.height=V.height),u}this.allocateTextureUnit=I,this.resetTextureUnits=M,this.setTexture2D=O,this.setTexture2DArray=z,this.setTexture3D=B,this.setTextureCube=L,this.rebindTextures=Y,this.setupRenderTarget=Ne,this.updateRenderTargetMipmap=Re,this.updateMultisampleRenderTarget=Ve,this.setupDepthRenderbuffer=ve,this.setupFrameBufferTexture=Te,this.useMultisampledRTT=Je}function fK(n,e,t){const r=t.isWebGL2;function i(s,o=Ia){let a;const l=Jt.getTransfer(o);if(s===oc)return n.UNSIGNED_BYTE;if(s===wU)return n.UNSIGNED_SHORT_4_4_4_4;if(s===SU)return n.UNSIGNED_SHORT_5_5_5_1;if(s===P9)return n.BYTE;if(s===k9)return n.SHORT;if(s===DA)return n.UNSIGNED_SHORT;if(s===yU)return n.INT;if(s===Xl)return n.UNSIGNED_INT;if(s===Na)return n.FLOAT;if(s===Xa)return r?n.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===L9)return n.ALPHA;if(s===Ls)return n.RGBA;if(s===O9)return n.LUMINANCE;if(s===D9)return n.LUMINANCE_ALPHA;if(s===Fu)return n.DEPTH_COMPONENT;if(s===qf)return n.DEPTH_STENCIL;if(s===IC)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===U9)return n.RED;if(s===EU)return n.RED_INTEGER;if(s===F9)return n.RG;if(s===TU)return n.RG_INTEGER;if(s===CU)return n.RGBA_INTEGER;if(s===qS||s===ZS||s===QS||s===JS)if(l===vn)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===qS)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===ZS)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===QS)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===JS)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===qS)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===ZS)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===QS)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===JS)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===pI||s===mI||s===gI||s===vI)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===pI)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===mI)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===gI)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===vI)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===bU)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===_I||s===xI)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===_I)return l===vn?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===xI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===yI||s===wI||s===SI||s===EI||s===TI||s===CI||s===bI||s===AI||s===MI||s===RI||s===NI||s===II||s===PI||s===kI)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===yI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===wI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===SI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===EI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===TI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===CI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===bI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===AI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===MI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===RI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===NI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===II)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===PI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===kI)return l===vn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===eE||s===LI||s===OI)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===eE)return l===vn?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===LI)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===OI)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===j9||s===DI||s===UI||s===FI)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(s===eE)return a.COMPRESSED_RED_RGTC1_EXT;if(s===DI)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===UI)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===FI)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Uu?r?n.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):n[s]!==void 0?n[s]:null}return{convert:i}}class pK extends Ni{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Au extends ar{constructor(){super(),this.isGroup=!0,this.type="Group"}}const mK={type:"move"};class CE{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Au,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Au,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new N,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new N),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Au,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new N,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new N),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const y of e.hand.values()){const g=t.getJointPose(y,r),m=this._getHandJoint(c,y);g!==null&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=g.radius),m.visible=g!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],f=u.position.distanceTo(h.position),p=.02,_=.005;c.inputState.pinching&&f>p+_?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=p-_&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(mK)))}return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new Au;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}const gK=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,vK=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class _K{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const i=new si,s=e.properties.get(i);s.__webglTexture=t.texture,(t.depthNear!=r.depthNear||t.depthFar!=r.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}render(e,t){if(this.texture!==null){if(this.mesh===null){const r=t.cameras[0].viewport,i=new fs({extensions:{fragDepth:!0},vertexShader:gK,fragmentShader:vK,uniforms:{depthColor:{value:this.texture},depthWidth:{value:r.z},depthHeight:{value:r.w}}});this.mesh=new Be(new Rp(20,20),i)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class xK extends bp{constructor(e,t){super();const r=this;let i=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,h=null,f=null,p=null,_=null;const y=new _K,g=t.getContextAttributes();let m=null,v=null;const x=[],w=[],E=new gt;let S=null;const C=new Ni;C.layers.enable(1),C.viewport=new Cn;const A=new Ni;A.layers.enable(2),A.viewport=new Cn;const k=[C,A],T=new pK;T.layers.enable(1),T.layers.enable(2);let R=null,$=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(K){let oe=x[K];return oe===void 0&&(oe=new CE,x[K]=oe),oe.getTargetRaySpace()},this.getControllerGrip=function(K){let oe=x[K];return oe===void 0&&(oe=new CE,x[K]=oe),oe.getGripSpace()},this.getHand=function(K){let oe=x[K];return oe===void 0&&(oe=new CE,x[K]=oe),oe.getHandSpace()};function P(K){const oe=w.indexOf(K.inputSource);if(oe===-1)return;const me=x[oe];me!==void 0&&(me.update(K.inputSource,K.frame,c||o),me.dispatchEvent({type:K.type,data:K.inputSource}))}function M(){i.removeEventListener("select",P),i.removeEventListener("selectstart",P),i.removeEventListener("selectend",P),i.removeEventListener("squeeze",P),i.removeEventListener("squeezestart",P),i.removeEventListener("squeezeend",P),i.removeEventListener("end",M),i.removeEventListener("inputsourceschange",I);for(let K=0;K<x.length;K++){const oe=w[K];oe!==null&&(w[K]=null,x[K].disconnect(oe))}R=null,$=null,y.reset(),e.setRenderTarget(m),p=null,f=null,h=null,i=null,v=null,H.stop(),r.isPresenting=!1,e.setPixelRatio(S),e.setSize(E.width,E.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(K){s=K,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(K){a=K,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(K){c=K},this.getBaseLayer=function(){return f!==null?f:p},this.getBinding=function(){return h},this.getFrame=function(){return _},this.getSession=function(){return i},this.setSession=async function(K){if(i=K,i!==null){if(m=e.getRenderTarget(),i.addEventListener("select",P),i.addEventListener("selectstart",P),i.addEventListener("selectend",P),i.addEventListener("squeeze",P),i.addEventListener("squeezestart",P),i.addEventListener("squeezeend",P),i.addEventListener("end",M),i.addEventListener("inputsourceschange",I),g.xrCompatible!==!0&&await t.makeXRCompatible(),S=e.getPixelRatio(),e.getSize(E),i.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const oe={antialias:i.renderState.layers===void 0?g.antialias:!0,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(i,t,oe),i.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),v=new zs(p.framebufferWidth,p.framebufferHeight,{format:Ls,type:oc,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil})}else{let oe=null,me=null,Se=null;g.depth&&(Se=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,oe=g.stencil?qf:Fu,me=g.stencil?Uu:Xl);const Te={colorFormat:t.RGBA8,depthFormat:Se,scaleFactor:s};h=new XRWebGLBinding(i,t),f=h.createProjectionLayer(Te),i.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),v=new zs(f.textureWidth,f.textureHeight,{format:Ls,type:oc,depthTexture:new jU(f.textureWidth,f.textureHeight,me,void 0,void 0,void 0,void 0,void 0,void 0,oe),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0});const G=e.properties.get(v);G.__ignoreDepthValues=f.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await i.requestReferenceSpace(a),H.setContext(i),H.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode};function I(K){for(let oe=0;oe<K.removed.length;oe++){const me=K.removed[oe],Se=w.indexOf(me);Se>=0&&(w[Se]=null,x[Se].disconnect(me))}for(let oe=0;oe<K.added.length;oe++){const me=K.added[oe];let Se=w.indexOf(me);if(Se===-1){for(let G=0;G<x.length;G++)if(G>=w.length){w.push(me),Se=G;break}else if(w[G]===null){w[G]=me,Se=G;break}if(Se===-1)break}const Te=x[Se];Te&&Te.connect(me)}}const j=new N,O=new N;function z(K,oe,me){j.setFromMatrixPosition(oe.matrixWorld),O.setFromMatrixPosition(me.matrixWorld);const Se=j.distanceTo(O),Te=oe.projectionMatrix.elements,G=me.projectionMatrix.elements,he=Te[14]/(Te[10]-1),ve=Te[14]/(Te[10]+1),Y=(Te[9]+1)/Te[5],Ne=(Te[9]-1)/Te[5],Re=(Te[8]-1)/Te[0],Ve=(G[8]+1)/G[0],Ue=he*Re,Je=he*Ve,tt=Se/(-Re+Ve),st=tt*-Re;oe.matrixWorld.decompose(K.position,K.quaternion,K.scale),K.translateX(st),K.translateZ(tt),K.matrixWorld.compose(K.position,K.quaternion,K.scale),K.matrixWorldInverse.copy(K.matrixWorld).invert();const nn=he+tt,V=ve+tt,b=Ue-st,X=Je+(Se-st),J=Y*ve/V*nn,te=Ne*ve/V*nn;K.projectionMatrix.makePerspective(b,X,J,te,nn,V),K.projectionMatrixInverse.copy(K.projectionMatrix).invert()}function B(K,oe){oe===null?K.matrixWorld.copy(K.matrix):K.matrixWorld.multiplyMatrices(oe.matrixWorld,K.matrix),K.matrixWorldInverse.copy(K.matrixWorld).invert()}this.updateCamera=function(K){if(i===null)return;y.texture!==null&&(K.near=y.depthNear,K.far=y.depthFar),T.near=A.near=C.near=K.near,T.far=A.far=C.far=K.far,(R!==T.near||$!==T.far)&&(i.updateRenderState({depthNear:T.near,depthFar:T.far}),R=T.near,$=T.far,C.near=R,C.far=$,A.near=R,A.far=$,C.updateProjectionMatrix(),A.updateProjectionMatrix(),K.updateProjectionMatrix());const oe=K.parent,me=T.cameras;B(T,oe);for(let Se=0;Se<me.length;Se++)B(me[Se],oe);me.length===2?z(T,C,A):T.projectionMatrix.copy(C.projectionMatrix),L(K,T,oe)};function L(K,oe,me){me===null?K.matrix.copy(oe.matrixWorld):(K.matrix.copy(me.matrixWorld),K.matrix.invert(),K.matrix.multiply(oe.matrixWorld)),K.matrix.decompose(K.position,K.quaternion,K.scale),K.updateMatrixWorld(!0),K.projectionMatrix.copy(oe.projectionMatrix),K.projectionMatrixInverse.copy(oe.projectionMatrixInverse),K.isPerspectiveCamera&&(K.fov=Ug*2*Math.atan(1/K.projectionMatrix.elements[5]),K.zoom=1)}this.getCamera=function(){return T},this.getFoveation=function(){if(!(f===null&&p===null))return l},this.setFoveation=function(K){l=K,f!==null&&(f.fixedFoveation=K),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=K)},this.hasDepthSensing=function(){return y.texture!==null};let D=null;function W(K,oe){if(u=oe.getViewerPose(c||o),_=oe,u!==null){const me=u.views;p!==null&&(e.setRenderTargetFramebuffer(v,p.framebuffer),e.setRenderTarget(v));let Se=!1;me.length!==T.cameras.length&&(T.cameras.length=0,Se=!0);for(let G=0;G<me.length;G++){const he=me[G];let ve=null;if(p!==null)ve=p.getViewport(he);else{const Ne=h.getViewSubImage(f,he);ve=Ne.viewport,G===0&&(e.setRenderTargetTextures(v,Ne.colorTexture,f.ignoreDepthValues?void 0:Ne.depthStencilTexture),e.setRenderTarget(v))}let Y=k[G];Y===void 0&&(Y=new Ni,Y.layers.enable(G),Y.viewport=new Cn,k[G]=Y),Y.matrix.fromArray(he.transform.matrix),Y.matrix.decompose(Y.position,Y.quaternion,Y.scale),Y.projectionMatrix.fromArray(he.projectionMatrix),Y.projectionMatrixInverse.copy(Y.projectionMatrix).invert(),Y.viewport.set(ve.x,ve.y,ve.width,ve.height),G===0&&(T.matrix.copy(Y.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),Se===!0&&T.cameras.push(Y)}const Te=i.enabledFeatures;if(Te&&Te.includes("depth-sensing")){const G=h.getDepthInformation(me[0]);G&&G.isValid&&G.texture&&y.init(e,G,i.renderState)}}for(let me=0;me<x.length;me++){const Se=w[me],Te=x[me];Se!==null&&Te!==void 0&&Te.update(Se,oe,c||o)}y.render(e,T),D&&D(K,oe),oe.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:oe}),_=null}const H=new FU;H.setAnimationLoop(W),this.setAnimationLoop=function(K){D=K},this.dispose=function(){}}}const Yc=new vo,yK=new ot;function wK(n,e){function t(g,m){g.matrixAutoUpdate===!0&&g.updateMatrix(),m.value.copy(g.matrix)}function r(g,m){m.color.getRGB(g.fogColor.value,OU(n)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)}function i(g,m,v,x,w){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(g,m):m.isMeshToonMaterial?(s(g,m),h(g,m)):m.isMeshPhongMaterial?(s(g,m),u(g,m)):m.isMeshStandardMaterial?(s(g,m),f(g,m),m.isMeshPhysicalMaterial&&p(g,m,w)):m.isMeshMatcapMaterial?(s(g,m),_(g,m)):m.isMeshDepthMaterial?s(g,m):m.isMeshDistanceMaterial?(s(g,m),y(g,m)):m.isMeshNormalMaterial?s(g,m):m.isLineBasicMaterial?(o(g,m),m.isLineDashedMaterial&&a(g,m)):m.isPointsMaterial?l(g,m,v,x):m.isSpriteMaterial?c(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function s(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.bumpMap&&(g.bumpMap.value=m.bumpMap,t(m.bumpMap,g.bumpMapTransform),g.bumpScale.value=m.bumpScale,m.side===ji&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,t(m.normalMap,g.normalMapTransform),g.normalScale.value.copy(m.normalScale),m.side===ji&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,t(m.displacementMap,g.displacementMapTransform),g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap,t(m.emissiveMap,g.emissiveMapTransform)),m.specularMap&&(g.specularMap.value=m.specularMap,t(m.specularMap,g.specularMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);const v=e.get(m),x=v.envMap,w=v.envMapRotation;if(x&&(g.envMap.value=x,Yc.copy(w),Yc.x*=-1,Yc.y*=-1,Yc.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(Yc.y*=-1,Yc.z*=-1),g.envMapRotation.value.setFromMatrix4(yK.makeRotationFromEuler(Yc)),g.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap){g.lightMap.value=m.lightMap;const E=n._useLegacyLights===!0?Math.PI:1;g.lightMapIntensity.value=m.lightMapIntensity*E,t(m.lightMap,g.lightMapTransform)}m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity,t(m.aoMap,g.aoMapTransform))}function o(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform))}function a(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}function l(g,m,v,x){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*v,g.scale.value=x*.5,m.map&&(g.map.value=m.map,t(m.map,g.uvTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function c(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function u(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}function h(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}function f(g,m){g.metalness.value=m.metalness,m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap,t(m.metalnessMap,g.metalnessMapTransform)),g.roughness.value=m.roughness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap,t(m.roughnessMap,g.roughnessMapTransform)),e.get(m).envMap&&(g.envMapIntensity.value=m.envMapIntensity)}function p(g,m,v){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap,t(m.sheenColorMap,g.sheenColorMapTransform)),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap,t(m.sheenRoughnessMap,g.sheenRoughnessMapTransform))),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap,t(m.clearcoatMap,g.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,t(m.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(g.clearcoatNormalMap.value=m.clearcoatNormalMap,t(m.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),m.side===ji&&g.clearcoatNormalScale.value.negate())),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap,t(m.iridescenceMap,g.iridescenceMapTransform)),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap,t(m.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=v.texture,g.transmissionSamplerSize.value.set(v.width,v.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap,t(m.transmissionMap,g.transmissionMapTransform)),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap,t(m.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(g.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(g.anisotropyMap.value=m.anisotropyMap,t(m.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap,t(m.specularColorMap,g.specularColorMapTransform)),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap,t(m.specularIntensityMap,g.specularIntensityMapTransform))}function _(g,m){m.matcap&&(g.matcap.value=m.matcap)}function y(g,m){const v=e.get(m).light;g.referencePosition.value.setFromMatrixPosition(v.matrixWorld),g.nearDistance.value=v.shadow.camera.near,g.farDistance.value=v.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function SK(n,e,t,r){let i={},s={},o=[];const a=t.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(v,x){const w=x.program;r.uniformBlockBinding(v,w)}function c(v,x){let w=i[v.id];w===void 0&&(_(v),w=u(v),i[v.id]=w,v.addEventListener("dispose",g));const E=x.program;r.updateUBOMapping(v,E);const S=e.render.frame;s[v.id]!==S&&(f(v),s[v.id]=S)}function u(v){const x=h();v.__bindingPointIndex=x;const w=n.createBuffer(),E=v.__size,S=v.usage;return n.bindBuffer(n.UNIFORM_BUFFER,w),n.bufferData(n.UNIFORM_BUFFER,E,S),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,x,w),w}function h(){for(let v=0;v<a;v++)if(o.indexOf(v)===-1)return o.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(v){const x=i[v.id],w=v.uniforms,E=v.__cache;n.bindBuffer(n.UNIFORM_BUFFER,x);for(let S=0,C=w.length;S<C;S++){const A=Array.isArray(w[S])?w[S]:[w[S]];for(let k=0,T=A.length;k<T;k++){const R=A[k];if(p(R,S,k,E)===!0){const $=R.__offset,P=Array.isArray(R.value)?R.value:[R.value];let M=0;for(let I=0;I<P.length;I++){const j=P[I],O=y(j);typeof j=="number"||typeof j=="boolean"?(R.__data[0]=j,n.bufferSubData(n.UNIFORM_BUFFER,$+M,R.__data)):j.isMatrix3?(R.__data[0]=j.elements[0],R.__data[1]=j.elements[1],R.__data[2]=j.elements[2],R.__data[3]=0,R.__data[4]=j.elements[3],R.__data[5]=j.elements[4],R.__data[6]=j.elements[5],R.__data[7]=0,R.__data[8]=j.elements[6],R.__data[9]=j.elements[7],R.__data[10]=j.elements[8],R.__data[11]=0):(j.toArray(R.__data,M),M+=O.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,$,R.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function p(v,x,w,E){const S=v.value,C=x+"_"+w;if(E[C]===void 0)return typeof S=="number"||typeof S=="boolean"?E[C]=S:E[C]=S.clone(),!0;{const A=E[C];if(typeof S=="number"||typeof S=="boolean"){if(A!==S)return E[C]=S,!0}else if(A.equals(S)===!1)return A.copy(S),!0}return!1}function _(v){const x=v.uniforms;let w=0;const E=16;for(let C=0,A=x.length;C<A;C++){const k=Array.isArray(x[C])?x[C]:[x[C]];for(let T=0,R=k.length;T<R;T++){const $=k[T],P=Array.isArray($.value)?$.value:[$.value];for(let M=0,I=P.length;M<I;M++){const j=P[M],O=y(j),z=w%E;z!==0&&E-z<O.boundary&&(w+=E-z),$.__data=new Float32Array(O.storage/Float32Array.BYTES_PER_ELEMENT),$.__offset=w,w+=O.storage}}}const S=w%E;return S>0&&(w+=E-S),v.__size=w,v.__cache={},this}function y(v){const x={boundary:0,storage:0};return typeof v=="number"||typeof v=="boolean"?(x.boundary=4,x.storage=4):v.isVector2?(x.boundary=8,x.storage=8):v.isVector3||v.isColor?(x.boundary=16,x.storage=12):v.isVector4?(x.boundary=16,x.storage=16):v.isMatrix3?(x.boundary=48,x.storage=48):v.isMatrix4?(x.boundary=64,x.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),x}function g(v){const x=v.target;x.removeEventListener("dispose",g);const w=o.indexOf(x.__bindingPointIndex);o.splice(w,1),n.deleteBuffer(i[x.id]),delete i[x.id],delete s[x.id]}function m(){for(const v in i)n.deleteBuffer(i[v]);o=[],i={},s={}}return{bind:l,update:c,dispose:m}}class kx{constructor(e={}){const{canvas:t=h7(),context:r=null,depth:i=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;this.isWebGLRenderer=!0;let f;r!==null?f=r.getContextAttributes().alpha:f=o;const p=new Uint32Array(4),_=new Int32Array(4);let y=null,g=null;const m=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Ns,this._useLegacyLights=!1,this.toneMapping=sc,this.toneMappingExposure=1;const x=this;let w=!1,E=0,S=0,C=null,A=-1,k=null;const T=new Cn,R=new Cn;let $=null;const P=new at(0);let M=0,I=t.width,j=t.height,O=1,z=null,B=null;const L=new Cn(0,0,I,j),D=new Cn(0,0,I,j);let W=!1;const H=new HA;let K=!1,oe=!1,me=null;const Se=new ot,Te=new gt,G=new N,he={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ve(){return C===null?O:1}let Y=r;function Ne(U,se){for(let ue=0;ue<U.length;ue++){const pe=U[ue],ce=t.getContext(pe,se);if(ce!==null)return ce}return null}try{const U={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${OA}`),t.addEventListener("webglcontextlost",Qe,!1),t.addEventListener("webglcontextrestored",Z,!1),t.addEventListener("webglcontextcreationerror",Oe,!1),Y===null){const se=["webgl2","webgl","experimental-webgl"];if(x.isWebGL1Renderer===!0&&se.shift(),Y=Ne(se,U),Y===null)throw Ne(se)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&Y instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),Y.getShaderPrecisionFormat===void 0&&(Y.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(U){throw console.error("THREE.WebGLRenderer: "+U.message),U}let Re,Ve,Ue,Je,tt,st,nn,V,b,X,J,te,ne,Ce,Ee,ye,xe,Ge,we,Rt,q,ie,fe,ge;function Le(){Re=new MW(Y),Ve=new SW(Y,Re,e),Re.init(Ve),ie=new fK(Y,Re,Ve),Ue=new dK(Y,Re,Ve),Je=new IW(Y),tt=new ZY,st=new hK(Y,Re,Ue,tt,Ve,ie,Je),nn=new TW(x),V=new AW(x),b=new U7(Y,Ve),fe=new yW(Y,Re,b,Ve),X=new RW(Y,b,Je,fe),J=new OW(Y,X,b,Je),we=new LW(Y,Ve,st),ye=new EW(tt),te=new qY(x,nn,V,Re,Ve,fe,ye),ne=new wK(x,tt),Ce=new JY,Ee=new sK(Re,Ve),Ge=new xW(x,nn,V,Ue,J,f,l),xe=new uK(x,J,Ve),ge=new SK(Y,Je,Ve,Ue),Rt=new wW(Y,Re,Je,Ve),q=new NW(Y,Re,Je,Ve),Je.programs=te.programs,x.capabilities=Ve,x.extensions=Re,x.properties=tt,x.renderLists=Ce,x.shadowMap=xe,x.state=Ue,x.info=Je}Le();const Ie=new xK(x,Y);this.xr=Ie,this.getContext=function(){return Y},this.getContextAttributes=function(){return Y.getContextAttributes()},this.forceContextLoss=function(){const U=Re.get("WEBGL_lose_context");U&&U.loseContext()},this.forceContextRestore=function(){const U=Re.get("WEBGL_lose_context");U&&U.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(U){U!==void 0&&(O=U,this.setSize(I,j,!1))},this.getSize=function(U){return U.set(I,j)},this.setSize=function(U,se,ue=!0){if(Ie.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}I=U,j=se,t.width=Math.floor(U*O),t.height=Math.floor(se*O),ue===!0&&(t.style.width=U+"px",t.style.height=se+"px"),this.setViewport(0,0,U,se)},this.getDrawingBufferSize=function(U){return U.set(I*O,j*O).floor()},this.setDrawingBufferSize=function(U,se,ue){I=U,j=se,O=ue,t.width=Math.floor(U*ue),t.height=Math.floor(se*ue),this.setViewport(0,0,U,se)},this.getCurrentViewport=function(U){return U.copy(T)},this.getViewport=function(U){return U.copy(L)},this.setViewport=function(U,se,ue,pe){U.isVector4?L.set(U.x,U.y,U.z,U.w):L.set(U,se,ue,pe),Ue.viewport(T.copy(L).multiplyScalar(O).round())},this.getScissor=function(U){return U.copy(D)},this.setScissor=function(U,se,ue,pe){U.isVector4?D.set(U.x,U.y,U.z,U.w):D.set(U,se,ue,pe),Ue.scissor(R.copy(D).multiplyScalar(O).round())},this.getScissorTest=function(){return W},this.setScissorTest=function(U){Ue.setScissorTest(W=U)},this.setOpaqueSort=function(U){z=U},this.setTransparentSort=function(U){B=U},this.getClearColor=function(U){return U.copy(Ge.getClearColor())},this.setClearColor=function(){Ge.setClearColor.apply(Ge,arguments)},this.getClearAlpha=function(){return Ge.getClearAlpha()},this.setClearAlpha=function(){Ge.setClearAlpha.apply(Ge,arguments)},this.clear=function(U=!0,se=!0,ue=!0){let pe=0;if(U){let ce=!1;if(C!==null){const $e=C.texture.format;ce=$e===CU||$e===TU||$e===EU}if(ce){const $e=C.texture.type,nt=$e===oc||$e===Xl||$e===DA||$e===Uu||$e===wU||$e===SU,dt=Ge.getClearColor(),pt=Ge.getClearAlpha(),At=dt.r,vt=dt.g,yt=dt.b;nt?(p[0]=At,p[1]=vt,p[2]=yt,p[3]=pt,Y.clearBufferuiv(Y.COLOR,0,p)):(_[0]=At,_[1]=vt,_[2]=yt,_[3]=pt,Y.clearBufferiv(Y.COLOR,0,_))}else pe|=Y.COLOR_BUFFER_BIT}se&&(pe|=Y.DEPTH_BUFFER_BIT),ue&&(pe|=Y.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Y.clear(pe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Qe,!1),t.removeEventListener("webglcontextrestored",Z,!1),t.removeEventListener("webglcontextcreationerror",Oe,!1),Ce.dispose(),Ee.dispose(),tt.dispose(),nn.dispose(),V.dispose(),J.dispose(),fe.dispose(),ge.dispose(),te.dispose(),Ie.dispose(),Ie.removeEventListener("sessionstart",Pr),Ie.removeEventListener("sessionend",qt),me&&(me.dispose(),me=null),$n.stop()};function Qe(U){U.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function Z(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const U=Je.autoReset,se=xe.enabled,ue=xe.autoUpdate,pe=xe.needsUpdate,ce=xe.type;Le(),Je.autoReset=U,xe.enabled=se,xe.autoUpdate=ue,xe.needsUpdate=pe,xe.type=ce}function Oe(U){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",U.statusMessage)}function re(U){const se=U.target;se.removeEventListener("dispose",re),Pe(se)}function Pe(U){ze(U),tt.remove(U)}function ze(U){const se=tt.get(U).programs;se!==void 0&&(se.forEach(function(ue){te.releaseProgram(ue)}),U.isShaderMaterial&&te.releaseShaderCache(U))}this.renderBufferDirect=function(U,se,ue,pe,ce,$e){se===null&&(se=he);const nt=ce.isMesh&&ce.matrixWorld.determinant()<0,dt=n8(U,se,ue,pe,ce);Ue.setMaterial(pe,nt);let pt=ue.index,At=1;if(pe.wireframe===!0){if(pt=X.getWireframeAttribute(ue),pt===void 0)return;At=2}const vt=ue.drawRange,yt=ue.attributes.position;let Xn=vt.start*At,Yi=(vt.start+vt.count)*At;$e!==null&&(Xn=Math.max(Xn,$e.start*At),Yi=Math.min(Yi,($e.start+$e.count)*At)),pt!==null?(Xn=Math.max(Xn,0),Yi=Math.min(Yi,pt.count)):yt!=null&&(Xn=Math.max(Xn,0),Yi=Math.min(Yi,yt.count));const Sr=Yi-Xn;if(Sr<0||Sr===1/0)return;fe.setup(ce,pe,dt,ue,pt);let da,Un=Rt;if(pt!==null&&(da=b.get(pt),Un=q,Un.setIndex(da)),ce.isMesh)pe.wireframe===!0?(Ue.setLineWidth(pe.wireframeLinewidth*ve()),Un.setMode(Y.LINES)):Un.setMode(Y.TRIANGLES);else if(ce.isLine){let Et=pe.linewidth;Et===void 0&&(Et=1),Ue.setLineWidth(Et*ve()),ce.isLineSegments?Un.setMode(Y.LINES):ce.isLineLoop?Un.setMode(Y.LINE_LOOP):Un.setMode(Y.LINE_STRIP)}else ce.isPoints?Un.setMode(Y.POINTS):ce.isSprite&&Un.setMode(Y.TRIANGLES);if(ce.isBatchedMesh)Un.renderMultiDraw(ce._multiDrawStarts,ce._multiDrawCounts,ce._multiDrawCount);else if(ce.isInstancedMesh)Un.renderInstances(Xn,Sr,ce.count);else if(ue.isInstancedBufferGeometry){const Et=ue._maxInstanceCount!==void 0?ue._maxInstanceCount:1/0,HS=Math.min(ue.instanceCount,Et);Un.renderInstances(Xn,Sr,HS)}else Un.render(Xn,Sr)};function bt(U,se,ue){U.transparent===!0&&U.side===gi&&U.forceSinglePass===!1?(U.side=ji,U.needsUpdate=!0,Xv(U,se,ue),U.side=$a,U.needsUpdate=!0,Xv(U,se,ue),U.side=gi):Xv(U,se,ue)}this.compile=function(U,se,ue=null){ue===null&&(ue=U),g=Ee.get(ue),g.init(),v.push(g),ue.traverseVisible(function(ce){ce.isLight&&ce.layers.test(se.layers)&&(g.pushLight(ce),ce.castShadow&&g.pushShadow(ce))}),U!==ue&&U.traverseVisible(function(ce){ce.isLight&&ce.layers.test(se.layers)&&(g.pushLight(ce),ce.castShadow&&g.pushShadow(ce))}),g.setupLights(x._useLegacyLights);const pe=new Set;return U.traverse(function(ce){const $e=ce.material;if($e)if(Array.isArray($e))for(let nt=0;nt<$e.length;nt++){const dt=$e[nt];bt(dt,ue,ce),pe.add(dt)}else bt($e,ue,ce),pe.add($e)}),v.pop(),g=null,pe},this.compileAsync=function(U,se,ue=null){const pe=this.compile(U,se,ue);return new Promise(ce=>{function $e(){if(pe.forEach(function(nt){tt.get(nt).currentProgram.isReady()&&pe.delete(nt)}),pe.size===0){ce(U);return}setTimeout($e,10)}Re.get("KHR_parallel_shader_compile")!==null?$e():setTimeout($e,10)})};let ln=null;function er(U){ln&&ln(U)}function Pr(){$n.stop()}function qt(){$n.start()}const $n=new FU;$n.setAnimationLoop(er),typeof self<"u"&&$n.setContext(self),this.setAnimationLoop=function(U){ln=U,Ie.setAnimationLoop(U),U===null?$n.stop():$n.start()},Ie.addEventListener("sessionstart",Pr),Ie.addEventListener("sessionend",qt),this.render=function(U,se){if(se!==void 0&&se.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(w===!0)return;U.matrixWorldAutoUpdate===!0&&U.updateMatrixWorld(),se.parent===null&&se.matrixWorldAutoUpdate===!0&&se.updateMatrixWorld(),Ie.enabled===!0&&Ie.isPresenting===!0&&(Ie.cameraAutoUpdate===!0&&Ie.updateCamera(se),se=Ie.getCamera()),U.isScene===!0&&U.onBeforeRender(x,U,se,C),g=Ee.get(U,v.length),g.init(),v.push(g),Se.multiplyMatrices(se.projectionMatrix,se.matrixWorldInverse),H.setFromProjectionMatrix(Se),oe=this.localClippingEnabled,K=ye.init(this.clippingPlanes,oe),y=Ce.get(U,m.length),y.init(),m.push(y),xs(U,se,0,x.sortObjects),y.finish(),x.sortObjects===!0&&y.sort(z,B),this.info.render.frame++,K===!0&&ye.beginShadows();const ue=g.state.shadowsArray;if(xe.render(ue,U,se),K===!0&&ye.endShadows(),this.info.autoReset===!0&&this.info.reset(),(Ie.enabled===!1||Ie.isPresenting===!1||Ie.hasDepthSensing()===!1)&&Ge.render(y,U),g.setupLights(x._useLegacyLights),se.isArrayCamera){const pe=se.cameras;for(let ce=0,$e=pe.length;ce<$e;ce++){const nt=pe[ce];Fd(y,U,nt,nt.viewport)}}else Fd(y,U,se);C!==null&&(st.updateMultisampleRenderTarget(C),st.updateRenderTargetMipmap(C)),U.isScene===!0&&U.onAfterRender(x,U,se),fe.resetDefaultState(),A=-1,k=null,v.pop(),v.length>0?g=v[v.length-1]:g=null,m.pop(),m.length>0?y=m[m.length-1]:y=null};function xs(U,se,ue,pe){if(U.visible===!1)return;if(U.layers.test(se.layers)){if(U.isGroup)ue=U.renderOrder;else if(U.isLOD)U.autoUpdate===!0&&U.update(se);else if(U.isLight)g.pushLight(U),U.castShadow&&g.pushShadow(U);else if(U.isSprite){if(!U.frustumCulled||H.intersectsSprite(U)){pe&&G.setFromMatrixPosition(U.matrixWorld).applyMatrix4(Se);const nt=J.update(U),dt=U.material;dt.visible&&y.push(U,nt,dt,ue,G.z,null)}}else if((U.isMesh||U.isLine||U.isPoints)&&(!U.frustumCulled||H.intersectsObject(U))){const nt=J.update(U),dt=U.material;if(pe&&(U.boundingSphere!==void 0?(U.boundingSphere===null&&U.computeBoundingSphere(),G.copy(U.boundingSphere.center)):(nt.boundingSphere===null&&nt.computeBoundingSphere(),G.copy(nt.boundingSphere.center)),G.applyMatrix4(U.matrixWorld).applyMatrix4(Se)),Array.isArray(dt)){const pt=nt.groups;for(let At=0,vt=pt.length;At<vt;At++){const yt=pt[At],Xn=dt[yt.materialIndex];Xn&&Xn.visible&&y.push(U,nt,Xn,ue,G.z,yt)}}else dt.visible&&y.push(U,nt,dt,ue,G.z,null)}}const $e=U.children;for(let nt=0,dt=$e.length;nt<dt;nt++)xs($e[nt],se,ue,pe)}function Fd(U,se,ue,pe){const ce=U.opaque,$e=U.transmissive,nt=U.transparent;g.setupLightsView(ue),K===!0&&ye.setGlobalState(x.clippingPlanes,ue),$e.length>0&&Bp(ce,$e,se,ue),pe&&Ue.viewport(T.copy(pe)),ce.length>0&&Hn(ce,se,ue),$e.length>0&&Hn($e,se,ue),nt.length>0&&Hn(nt,se,ue),Ue.buffers.depth.setTest(!0),Ue.buffers.depth.setMask(!0),Ue.buffers.color.setMask(!0),Ue.setPolygonOffset(!1)}function Bp(U,se,ue,pe){if((ue.isScene===!0?ue.overrideMaterial:null)!==null)return;const $e=Ve.isWebGL2;me===null&&(me=new zs(1,1,{generateMipmaps:!0,type:Re.has("EXT_color_buffer_half_float")?Xa:oc,minFilter:$l,samples:$e?4:0})),x.getDrawingBufferSize(Te),$e?me.setSize(Te.x,Te.y):me.setSize(Ix(Te.x),Ix(Te.y));const nt=x.getRenderTarget();x.setRenderTarget(me),x.getClearColor(P),M=x.getClearAlpha(),M<1&&x.setClearColor(16777215,.5),x.clear();const dt=x.toneMapping;x.toneMapping=sc,Hn(U,ue,pe),st.updateMultisampleRenderTarget(me),st.updateRenderTargetMipmap(me);let pt=!1;for(let At=0,vt=se.length;At<vt;At++){const yt=se[At],Xn=yt.object,Yi=yt.geometry,Sr=yt.material,da=yt.group;if(Sr.side===gi&&Xn.layers.test(pe.layers)){const Un=Sr.side;Sr.side=ji,Sr.needsUpdate=!0,Ao(Xn,ue,pe,Yi,Sr,da),Sr.side=Un,Sr.needsUpdate=!0,pt=!0}}pt===!0&&(st.updateMultisampleRenderTarget(me),st.updateRenderTargetMipmap(me)),x.setRenderTarget(nt),x.setClearColor(P,M),x.toneMapping=dt}function Hn(U,se,ue){const pe=se.isScene===!0?se.overrideMaterial:null;for(let ce=0,$e=U.length;ce<$e;ce++){const nt=U[ce],dt=nt.object,pt=nt.geometry,At=pe===null?nt.material:pe,vt=nt.group;dt.layers.test(ue.layers)&&Ao(dt,se,ue,pt,At,vt)}}function Ao(U,se,ue,pe,ce,$e){U.onBeforeRender(x,se,ue,pe,ce,$e),U.modelViewMatrix.multiplyMatrices(ue.matrixWorldInverse,U.matrixWorld),U.normalMatrix.getNormalMatrix(U.modelViewMatrix),ce.onBeforeRender(x,se,ue,pe,U,$e),ce.transparent===!0&&ce.side===gi&&ce.forceSinglePass===!1?(ce.side=ji,ce.needsUpdate=!0,x.renderBufferDirect(ue,se,pe,ce,U,$e),ce.side=$a,ce.needsUpdate=!0,x.renderBufferDirect(ue,se,pe,ce,U,$e),ce.side=gi):x.renderBufferDirect(ue,se,pe,ce,U,$e),U.onAfterRender(x,se,ue,pe,ce,$e)}function Xv(U,se,ue){se.isScene!==!0&&(se=he);const pe=tt.get(U),ce=g.state.lights,$e=g.state.shadowsArray,nt=ce.state.version,dt=te.getParameters(U,ce.state,$e,se,ue),pt=te.getProgramCacheKey(dt);let At=pe.programs;pe.environment=U.isMeshStandardMaterial?se.environment:null,pe.fog=se.fog,pe.envMap=(U.isMeshStandardMaterial?V:nn).get(U.envMap||pe.environment),pe.envMapRotation=pe.environment!==null&&U.envMap===null?se.environmentRotation:U.envMapRotation,At===void 0&&(U.addEventListener("dispose",re),At=new Map,pe.programs=At);let vt=At.get(pt);if(vt!==void 0){if(pe.currentProgram===vt&&pe.lightsStateVersion===nt)return ZN(U,dt),vt}else dt.uniforms=te.getUniforms(U),U.onBuild(ue,dt,x),U.onBeforeCompile(dt,x),vt=te.acquireProgram(dt,pt),At.set(pt,vt),pe.uniforms=dt.uniforms;const yt=pe.uniforms;return(!U.isShaderMaterial&&!U.isRawShaderMaterial||U.clipping===!0)&&(yt.clippingPlanes=ye.uniform),ZN(U,dt),pe.needsLights=i8(U),pe.lightsStateVersion=nt,pe.needsLights&&(yt.ambientLightColor.value=ce.state.ambient,yt.lightProbe.value=ce.state.probe,yt.directionalLights.value=ce.state.directional,yt.directionalLightShadows.value=ce.state.directionalShadow,yt.spotLights.value=ce.state.spot,yt.spotLightShadows.value=ce.state.spotShadow,yt.rectAreaLights.value=ce.state.rectArea,yt.ltc_1.value=ce.state.rectAreaLTC1,yt.ltc_2.value=ce.state.rectAreaLTC2,yt.pointLights.value=ce.state.point,yt.pointLightShadows.value=ce.state.pointShadow,yt.hemisphereLights.value=ce.state.hemi,yt.directionalShadowMap.value=ce.state.directionalShadowMap,yt.directionalShadowMatrix.value=ce.state.directionalShadowMatrix,yt.spotShadowMap.value=ce.state.spotShadowMap,yt.spotLightMatrix.value=ce.state.spotLightMatrix,yt.spotLightMap.value=ce.state.spotLightMap,yt.pointShadowMap.value=ce.state.pointShadowMap,yt.pointShadowMatrix.value=ce.state.pointShadowMatrix),pe.currentProgram=vt,pe.uniformsList=null,vt}function qN(U){if(U.uniformsList===null){const se=U.currentProgram.getUniforms();U.uniformsList=G_.seqWithValue(se.seq,U.uniforms)}return U.uniformsList}function ZN(U,se){const ue=tt.get(U);ue.outputColorSpace=se.outputColorSpace,ue.batching=se.batching,ue.instancing=se.instancing,ue.instancingColor=se.instancingColor,ue.instancingMorph=se.instancingMorph,ue.skinning=se.skinning,ue.morphTargets=se.morphTargets,ue.morphNormals=se.morphNormals,ue.morphColors=se.morphColors,ue.morphTargetsCount=se.morphTargetsCount,ue.numClippingPlanes=se.numClippingPlanes,ue.numIntersection=se.numClipIntersection,ue.vertexAlphas=se.vertexAlphas,ue.vertexTangents=se.vertexTangents,ue.toneMapping=se.toneMapping}function n8(U,se,ue,pe,ce){se.isScene!==!0&&(se=he),st.resetTextureUnits();const $e=se.fog,nt=pe.isMeshStandardMaterial?se.environment:null,dt=C===null?x.outputColorSpace:C.isXRRenderTarget===!0?C.texture.colorSpace:ol,pt=(pe.isMeshStandardMaterial?V:nn).get(pe.envMap||nt),At=pe.vertexColors===!0&&!!ue.attributes.color&&ue.attributes.color.itemSize===4,vt=!!ue.attributes.tangent&&(!!pe.normalMap||pe.anisotropy>0),yt=!!ue.morphAttributes.position,Xn=!!ue.morphAttributes.normal,Yi=!!ue.morphAttributes.color;let Sr=sc;pe.toneMapped&&(C===null||C.isXRRenderTarget===!0)&&(Sr=x.toneMapping);const da=ue.morphAttributes.position||ue.morphAttributes.normal||ue.morphAttributes.color,Un=da!==void 0?da.length:0,Et=tt.get(pe),HS=g.state.lights;if(K===!0&&(oe===!0||U!==k)){const ys=U===k&&pe.id===A;ye.setState(pe,U,ys)}let Nn=!1;pe.version===Et.__version?(Et.needsLights&&Et.lightsStateVersion!==HS.state.version||Et.outputColorSpace!==dt||ce.isBatchedMesh&&Et.batching===!1||!ce.isBatchedMesh&&Et.batching===!0||ce.isInstancedMesh&&Et.instancing===!1||!ce.isInstancedMesh&&Et.instancing===!0||ce.isSkinnedMesh&&Et.skinning===!1||!ce.isSkinnedMesh&&Et.skinning===!0||ce.isInstancedMesh&&Et.instancingColor===!0&&ce.instanceColor===null||ce.isInstancedMesh&&Et.instancingColor===!1&&ce.instanceColor!==null||ce.isInstancedMesh&&Et.instancingMorph===!0&&ce.morphTexture===null||ce.isInstancedMesh&&Et.instancingMorph===!1&&ce.morphTexture!==null||Et.envMap!==pt||pe.fog===!0&&Et.fog!==$e||Et.numClippingPlanes!==void 0&&(Et.numClippingPlanes!==ye.numPlanes||Et.numIntersection!==ye.numIntersection)||Et.vertexAlphas!==At||Et.vertexTangents!==vt||Et.morphTargets!==yt||Et.morphNormals!==Xn||Et.morphColors!==Yi||Et.toneMapping!==Sr||Ve.isWebGL2===!0&&Et.morphTargetsCount!==Un)&&(Nn=!0):(Nn=!0,Et.__version=pe.version);let jc=Et.currentProgram;Nn===!0&&(jc=Xv(pe,se,ce));let QN=!1,Hp=!1,VS=!1;const Hr=jc.getUniforms(),zc=Et.uniforms;if(Ue.useProgram(jc.program)&&(QN=!0,Hp=!0,VS=!0),pe.id!==A&&(A=pe.id,Hp=!0),QN||k!==U){Hr.setValue(Y,"projectionMatrix",U.projectionMatrix),Hr.setValue(Y,"viewMatrix",U.matrixWorldInverse);const ys=Hr.map.cameraPosition;ys!==void 0&&ys.setValue(Y,G.setFromMatrixPosition(U.matrixWorld)),Ve.logarithmicDepthBuffer&&Hr.setValue(Y,"logDepthBufFC",2/(Math.log(U.far+1)/Math.LN2)),(pe.isMeshPhongMaterial||pe.isMeshToonMaterial||pe.isMeshLambertMaterial||pe.isMeshBasicMaterial||pe.isMeshStandardMaterial||pe.isShaderMaterial)&&Hr.setValue(Y,"isOrthographic",U.isOrthographicCamera===!0),k!==U&&(k=U,Hp=!0,VS=!0)}if(ce.isSkinnedMesh){Hr.setOptional(Y,ce,"bindMatrix"),Hr.setOptional(Y,ce,"bindMatrixInverse");const ys=ce.skeleton;ys&&(Ve.floatVertexTextures?(ys.boneTexture===null&&ys.computeBoneTexture(),Hr.setValue(Y,"boneTexture",ys.boneTexture,st)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}ce.isBatchedMesh&&(Hr.setOptional(Y,ce,"batchingTexture"),Hr.setValue(Y,"batchingTexture",ce._matricesTexture,st));const GS=ue.morphAttributes;if((GS.position!==void 0||GS.normal!==void 0||GS.color!==void 0&&Ve.isWebGL2===!0)&&we.update(ce,ue,jc),(Hp||Et.receiveShadow!==ce.receiveShadow)&&(Et.receiveShadow=ce.receiveShadow,Hr.setValue(Y,"receiveShadow",ce.receiveShadow)),pe.isMeshGouraudMaterial&&pe.envMap!==null&&(zc.envMap.value=pt,zc.flipEnvMap.value=pt.isCubeTexture&&pt.isRenderTargetTexture===!1?-1:1),Hp&&(Hr.setValue(Y,"toneMappingExposure",x.toneMappingExposure),Et.needsLights&&r8(zc,VS),$e&&pe.fog===!0&&ne.refreshFogUniforms(zc,$e),ne.refreshMaterialUniforms(zc,pe,O,j,me),G_.upload(Y,qN(Et),zc,st)),pe.isShaderMaterial&&pe.uniformsNeedUpdate===!0&&(G_.upload(Y,qN(Et),zc,st),pe.uniformsNeedUpdate=!1),pe.isSpriteMaterial&&Hr.setValue(Y,"center",ce.center),Hr.setValue(Y,"modelViewMatrix",ce.modelViewMatrix),Hr.setValue(Y,"normalMatrix",ce.normalMatrix),Hr.setValue(Y,"modelMatrix",ce.matrixWorld),pe.isShaderMaterial||pe.isRawShaderMaterial){const ys=pe.uniformsGroups;for(let WS=0,s8=ys.length;WS<s8;WS++)if(Ve.isWebGL2){const JN=ys[WS];ge.update(JN,jc),ge.bind(JN,jc)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return jc}function r8(U,se){U.ambientLightColor.needsUpdate=se,U.lightProbe.needsUpdate=se,U.directionalLights.needsUpdate=se,U.directionalLightShadows.needsUpdate=se,U.pointLights.needsUpdate=se,U.pointLightShadows.needsUpdate=se,U.spotLights.needsUpdate=se,U.spotLightShadows.needsUpdate=se,U.rectAreaLights.needsUpdate=se,U.hemisphereLights.needsUpdate=se}function i8(U){return U.isMeshLambertMaterial||U.isMeshToonMaterial||U.isMeshPhongMaterial||U.isMeshStandardMaterial||U.isShadowMaterial||U.isShaderMaterial&&U.lights===!0}this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(U,se,ue){tt.get(U.texture).__webglTexture=se,tt.get(U.depthTexture).__webglTexture=ue;const pe=tt.get(U);pe.__hasExternalTextures=!0,pe.__autoAllocateDepthBuffer=ue===void 0,pe.__autoAllocateDepthBuffer||Re.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),pe.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(U,se){const ue=tt.get(U);ue.__webglFramebuffer=se,ue.__useDefaultFramebuffer=se===void 0},this.setRenderTarget=function(U,se=0,ue=0){C=U,E=se,S=ue;let pe=!0,ce=null,$e=!1,nt=!1;if(U){const pt=tt.get(U);pt.__useDefaultFramebuffer!==void 0?(Ue.bindFramebuffer(Y.FRAMEBUFFER,null),pe=!1):pt.__webglFramebuffer===void 0?st.setupRenderTarget(U):pt.__hasExternalTextures&&st.rebindTextures(U,tt.get(U.texture).__webglTexture,tt.get(U.depthTexture).__webglTexture);const At=U.texture;(At.isData3DTexture||At.isDataArrayTexture||At.isCompressedArrayTexture)&&(nt=!0);const vt=tt.get(U).__webglFramebuffer;U.isWebGLCubeRenderTarget?(Array.isArray(vt[se])?ce=vt[se][ue]:ce=vt[se],$e=!0):Ve.isWebGL2&&U.samples>0&&st.useMultisampledRTT(U)===!1?ce=tt.get(U).__webglMultisampledFramebuffer:Array.isArray(vt)?ce=vt[ue]:ce=vt,T.copy(U.viewport),R.copy(U.scissor),$=U.scissorTest}else T.copy(L).multiplyScalar(O).floor(),R.copy(D).multiplyScalar(O).floor(),$=W;if(Ue.bindFramebuffer(Y.FRAMEBUFFER,ce)&&Ve.drawBuffers&&pe&&Ue.drawBuffers(U,ce),Ue.viewport(T),Ue.scissor(R),Ue.setScissorTest($),$e){const pt=tt.get(U.texture);Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_CUBE_MAP_POSITIVE_X+se,pt.__webglTexture,ue)}else if(nt){const pt=tt.get(U.texture),At=se||0;Y.framebufferTextureLayer(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,pt.__webglTexture,ue||0,At)}A=-1},this.readRenderTargetPixels=function(U,se,ue,pe,ce,$e,nt){if(!(U&&U.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let dt=tt.get(U).__webglFramebuffer;if(U.isWebGLCubeRenderTarget&&nt!==void 0&&(dt=dt[nt]),dt){Ue.bindFramebuffer(Y.FRAMEBUFFER,dt);try{const pt=U.texture,At=pt.format,vt=pt.type;if(At!==Ls&&ie.convert(At)!==Y.getParameter(Y.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const yt=vt===Xa&&(Re.has("EXT_color_buffer_half_float")||Ve.isWebGL2&&Re.has("EXT_color_buffer_float"));if(vt!==oc&&ie.convert(vt)!==Y.getParameter(Y.IMPLEMENTATION_COLOR_READ_TYPE)&&!(vt===Na&&(Ve.isWebGL2||Re.has("OES_texture_float")||Re.has("WEBGL_color_buffer_float")))&&!yt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}se>=0&&se<=U.width-pe&&ue>=0&&ue<=U.height-ce&&Y.readPixels(se,ue,pe,ce,ie.convert(At),ie.convert(vt),$e)}finally{const pt=C!==null?tt.get(C).__webglFramebuffer:null;Ue.bindFramebuffer(Y.FRAMEBUFFER,pt)}}},this.copyFramebufferToTexture=function(U,se,ue=0){const pe=Math.pow(2,-ue),ce=Math.floor(se.image.width*pe),$e=Math.floor(se.image.height*pe);st.setTexture2D(se,0),Y.copyTexSubImage2D(Y.TEXTURE_2D,ue,0,0,U.x,U.y,ce,$e),Ue.unbindTexture()},this.copyTextureToTexture=function(U,se,ue,pe=0){const ce=se.image.width,$e=se.image.height,nt=ie.convert(ue.format),dt=ie.convert(ue.type);st.setTexture2D(ue,0),Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,ue.flipY),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ue.premultiplyAlpha),Y.pixelStorei(Y.UNPACK_ALIGNMENT,ue.unpackAlignment),se.isDataTexture?Y.texSubImage2D(Y.TEXTURE_2D,pe,U.x,U.y,ce,$e,nt,dt,se.image.data):se.isCompressedTexture?Y.compressedTexSubImage2D(Y.TEXTURE_2D,pe,U.x,U.y,se.mipmaps[0].width,se.mipmaps[0].height,nt,se.mipmaps[0].data):Y.texSubImage2D(Y.TEXTURE_2D,pe,U.x,U.y,nt,dt,se.image),pe===0&&ue.generateMipmaps&&Y.generateMipmap(Y.TEXTURE_2D),Ue.unbindTexture()},this.copyTextureToTexture3D=function(U,se,ue,pe,ce=0){if(x.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const $e=Math.round(U.max.x-U.min.x),nt=Math.round(U.max.y-U.min.y),dt=U.max.z-U.min.z+1,pt=ie.convert(pe.format),At=ie.convert(pe.type);let vt;if(pe.isData3DTexture)st.setTexture3D(pe,0),vt=Y.TEXTURE_3D;else if(pe.isDataArrayTexture||pe.isCompressedArrayTexture)st.setTexture2DArray(pe,0),vt=Y.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,pe.flipY),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),Y.pixelStorei(Y.UNPACK_ALIGNMENT,pe.unpackAlignment);const yt=Y.getParameter(Y.UNPACK_ROW_LENGTH),Xn=Y.getParameter(Y.UNPACK_IMAGE_HEIGHT),Yi=Y.getParameter(Y.UNPACK_SKIP_PIXELS),Sr=Y.getParameter(Y.UNPACK_SKIP_ROWS),da=Y.getParameter(Y.UNPACK_SKIP_IMAGES),Un=ue.isCompressedTexture?ue.mipmaps[ce]:ue.image;Y.pixelStorei(Y.UNPACK_ROW_LENGTH,Un.width),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,Un.height),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,U.min.x),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,U.min.y),Y.pixelStorei(Y.UNPACK_SKIP_IMAGES,U.min.z),ue.isDataTexture||ue.isData3DTexture?Y.texSubImage3D(vt,ce,se.x,se.y,se.z,$e,nt,dt,pt,At,Un.data):pe.isCompressedArrayTexture?Y.compressedTexSubImage3D(vt,ce,se.x,se.y,se.z,$e,nt,dt,pt,Un.data):Y.texSubImage3D(vt,ce,se.x,se.y,se.z,$e,nt,dt,pt,At,Un),Y.pixelStorei(Y.UNPACK_ROW_LENGTH,yt),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,Xn),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,Yi),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,Sr),Y.pixelStorei(Y.UNPACK_SKIP_IMAGES,da),ce===0&&pe.generateMipmaps&&Y.generateMipmap(vt),Ue.unbindTexture()},this.initTexture=function(U){U.isCubeTexture?st.setTextureCube(U,0):U.isData3DTexture?st.setTexture3D(U,0):U.isDataArrayTexture||U.isCompressedArrayTexture?st.setTexture2DArray(U,0):st.setTexture2D(U,0),Ue.unbindTexture()},this.resetState=function(){E=0,S=0,C=null,Ue.reset(),fe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ka}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===UA?"display-p3":"srgb",t.unpackColorSpace=Jt.workingColorSpace===kw?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class EK extends kx{}EK.prototype.isWebGL1Renderer=!0;class Lx extends ar{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new vo,this.environmentRotation=new vo,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class ll extends Mp{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new at(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const RP=new N,NP=new N,IP=new ot,bE=new zA,x0=new Tv;class As extends ar{constructor(e=new xn,t=new ll){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[0];for(let i=1,s=t.count;i<s;i++)RP.fromBufferAttribute(t,i-1),NP.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=RP.distanceTo(NP);e.setAttribute("lineDistance",new Wt(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,o=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),x0.copy(r.boundingSphere),x0.applyMatrix4(i),x0.radius+=s,e.ray.intersectsSphere(x0)===!1)return;IP.copy(i).invert(),bE.copy(e.ray).applyMatrix4(IP);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new N,u=new N,h=new N,f=new N,p=this.isLineSegments?2:1,_=r.index,g=r.attributes.position;if(_!==null){const m=Math.max(0,o.start),v=Math.min(_.count,o.start+o.count);for(let x=m,w=v-1;x<w;x+=p){const E=_.getX(x),S=_.getX(x+1);if(c.fromBufferAttribute(g,E),u.fromBufferAttribute(g,S),bE.distanceSqToSegment(c,u,f,h)>l)continue;f.applyMatrix4(this.matrixWorld);const A=e.ray.origin.distanceTo(f);A<e.near||A>e.far||t.push({distance:A,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{const m=Math.max(0,o.start),v=Math.min(g.count,o.start+o.count);for(let x=m,w=v-1;x<w;x+=p){if(c.fromBufferAttribute(g,x),u.fromBufferAttribute(g,x+1),bE.distanceSqToSegment(c,u,f,h)>l)continue;f.applyMatrix4(this.matrixWorld);const S=e.ray.origin.distanceTo(f);S<e.near||S>e.far||t.push({distance:S,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const PP=new N,kP=new N;class Cv extends As{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[];for(let i=0,s=t.count;i<s;i+=2)PP.fromBufferAttribute(t,i),kP.fromBufferAttribute(t,i+1),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+PP.distanceTo(kP);e.setAttribute("lineDistance",new Wt(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class AE extends si{constructor(e,t,r,i,s,o,a,l,c,u,h,f){super(null,o,a,l,c,u,i,s,h,f),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class TK extends si{constructor(e,t,r,i,s,o,a,l,c){super(e,t,r,i,s,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Or extends xn{constructor(e=1,t=1,r=1,i=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;i=Math.floor(i),s=Math.floor(s);const u=[],h=[],f=[],p=[];let _=0;const y=[],g=r/2;let m=0;v(),o===!1&&(e>0&&x(!0),t>0&&x(!1)),this.setIndex(u),this.setAttribute("position",new Wt(h,3)),this.setAttribute("normal",new Wt(f,3)),this.setAttribute("uv",new Wt(p,2));function v(){const w=new N,E=new N;let S=0;const C=(t-e)/r;for(let A=0;A<=s;A++){const k=[],T=A/s,R=T*(t-e)+e;for(let $=0;$<=i;$++){const P=$/i,M=P*l+a,I=Math.sin(M),j=Math.cos(M);E.x=R*I,E.y=-T*r+g,E.z=R*j,h.push(E.x,E.y,E.z),w.set(I,C,j).normalize(),f.push(w.x,w.y,w.z),p.push(P,1-T),k.push(_++)}y.push(k)}for(let A=0;A<i;A++)for(let k=0;k<s;k++){const T=y[k][A],R=y[k+1][A],$=y[k+1][A+1],P=y[k][A+1];u.push(T,R,P),u.push(R,$,P),S+=6}c.addGroup(m,S,0),m+=S}function x(w){const E=_,S=new gt,C=new N;let A=0;const k=w===!0?e:t,T=w===!0?1:-1;for(let $=1;$<=i;$++)h.push(0,g*T,0),f.push(0,T,0),p.push(.5,.5),_++;const R=_;for(let $=0;$<=i;$++){const M=$/i*l+a,I=Math.cos(M),j=Math.sin(M);C.x=k*j,C.y=g*T,C.z=k*I,h.push(C.x,C.y,C.z),f.push(0,T,0),S.x=I*.5+.5,S.y=j*.5*T+.5,p.push(S.x,S.y),_++}for(let $=0;$<i;$++){const P=E+$,M=R+$;w===!0?u.push(M,M+1,P):u.push(M+1,M,P),A+=3}c.addGroup(m,A,w===!0?1:2),m+=A}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Or(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Dw extends Or{constructor(e=1,t=1,r=32,i=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,r,i,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new Dw(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class WA extends xn{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};const s=[],o=[];a(i),c(r),u(),this.setAttribute("position",new Wt(s,3)),this.setAttribute("normal",new Wt(s.slice(),3)),this.setAttribute("uv",new Wt(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(v){const x=new N,w=new N,E=new N;for(let S=0;S<t.length;S+=3)p(t[S+0],x),p(t[S+1],w),p(t[S+2],E),l(x,w,E,v)}function l(v,x,w,E){const S=E+1,C=[];for(let A=0;A<=S;A++){C[A]=[];const k=v.clone().lerp(w,A/S),T=x.clone().lerp(w,A/S),R=S-A;for(let $=0;$<=R;$++)$===0&&A===S?C[A][$]=k:C[A][$]=k.clone().lerp(T,$/R)}for(let A=0;A<S;A++)for(let k=0;k<2*(S-A)-1;k++){const T=Math.floor(k/2);k%2===0?(f(C[A][T+1]),f(C[A+1][T]),f(C[A][T])):(f(C[A][T+1]),f(C[A+1][T+1]),f(C[A+1][T]))}}function c(v){const x=new N;for(let w=0;w<s.length;w+=3)x.x=s[w+0],x.y=s[w+1],x.z=s[w+2],x.normalize().multiplyScalar(v),s[w+0]=x.x,s[w+1]=x.y,s[w+2]=x.z}function u(){const v=new N;for(let x=0;x<s.length;x+=3){v.x=s[x+0],v.y=s[x+1],v.z=s[x+2];const w=g(v)/2/Math.PI+.5,E=m(v)/Math.PI+.5;o.push(w,1-E)}_(),h()}function h(){for(let v=0;v<o.length;v+=6){const x=o[v+0],w=o[v+2],E=o[v+4],S=Math.max(x,w,E),C=Math.min(x,w,E);S>.9&&C<.1&&(x<.2&&(o[v+0]+=1),w<.2&&(o[v+2]+=1),E<.2&&(o[v+4]+=1))}}function f(v){s.push(v.x,v.y,v.z)}function p(v,x){const w=v*3;x.x=e[w+0],x.y=e[w+1],x.z=e[w+2]}function _(){const v=new N,x=new N,w=new N,E=new N,S=new gt,C=new gt,A=new gt;for(let k=0,T=0;k<s.length;k+=9,T+=6){v.set(s[k+0],s[k+1],s[k+2]),x.set(s[k+3],s[k+4],s[k+5]),w.set(s[k+6],s[k+7],s[k+8]),S.set(o[T+0],o[T+1]),C.set(o[T+2],o[T+3]),A.set(o[T+4],o[T+5]),E.copy(v).add(x).add(w).divideScalar(3);const R=g(E);y(S,T+0,v,R),y(C,T+2,x,R),y(A,T+4,w,R)}}function y(v,x,w,E){E<0&&v.x===1&&(o[x]=v.x-1),w.x===0&&w.z===0&&(o[x]=E/2/Math.PI+.5)}function g(v){return Math.atan2(v.z,-v.x)}function m(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new WA(e.vertices,e.indices,e.radius,e.details)}}const y0=new N,w0=new N,ME=new N,S0=new lo;class WU extends xn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),s=Math.cos(yf*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),f={},p=[];for(let _=0;_<l;_+=3){o?(c[0]=o.getX(_),c[1]=o.getX(_+1),c[2]=o.getX(_+2)):(c[0]=_,c[1]=_+1,c[2]=_+2);const{a:y,b:g,c:m}=S0;if(y.fromBufferAttribute(a,c[0]),g.fromBufferAttribute(a,c[1]),m.fromBufferAttribute(a,c[2]),S0.getNormal(ME),h[0]=`${Math.round(y.x*i)},${Math.round(y.y*i)},${Math.round(y.z*i)}`,h[1]=`${Math.round(g.x*i)},${Math.round(g.y*i)},${Math.round(g.z*i)}`,h[2]=`${Math.round(m.x*i)},${Math.round(m.y*i)},${Math.round(m.z*i)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let v=0;v<3;v++){const x=(v+1)%3,w=h[v],E=h[x],S=S0[u[v]],C=S0[u[x]],A=`${w}_${E}`,k=`${E}_${w}`;k in f&&f[k]?(ME.dot(f[k].normal)<=s&&(p.push(S.x,S.y,S.z),p.push(C.x,C.y,C.z)),f[k]=null):A in f||(f[A]={index0:c[v],index1:c[x],normal:ME.clone()})}}for(const _ in f)if(f[_]){const{index0:y,index1:g}=f[_];y0.fromBufferAttribute(a,y),w0.fromBufferAttribute(a,g),p.push(y0.x,y0.y,y0.z),p.push(w0.x,w0.y,w0.z)}this.setAttribute("position",new Wt(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class $h extends WA{constructor(e=1,t=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $h(e.radius,e.detail)}}class YA extends xn{constructor(e=1,t=32,r=16,i=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const l=Math.min(o+a,Math.PI);let c=0;const u=[],h=new N,f=new N,p=[],_=[],y=[],g=[];for(let m=0;m<=r;m++){const v=[],x=m/r;let w=0;m===0&&o===0?w=.5/t:m===r&&l===Math.PI&&(w=-.5/t);for(let E=0;E<=t;E++){const S=E/t;h.x=-e*Math.cos(i+S*s)*Math.sin(o+x*a),h.y=e*Math.cos(o+x*a),h.z=e*Math.sin(i+S*s)*Math.sin(o+x*a),_.push(h.x,h.y,h.z),f.copy(h).normalize(),y.push(f.x,f.y,f.z),g.push(S+w,1-x),v.push(c++)}u.push(v)}for(let m=0;m<r;m++)for(let v=0;v<t;v++){const x=u[m][v+1],w=u[m][v],E=u[m+1][v],S=u[m+1][v+1];(m!==0||o>0)&&p.push(x,w,S),(m!==r-1||l<Math.PI)&&p.push(w,E,S)}this.setIndex(p),this.setAttribute("position",new Wt(_,3)),this.setAttribute("normal",new Wt(y,3)),this.setAttribute("uv",new Wt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new YA(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class _u extends xn{constructor(e=1,t=.4,r=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:s},r=Math.floor(r),i=Math.floor(i);const o=[],a=[],l=[],c=[],u=new N,h=new N,f=new N;for(let p=0;p<=r;p++)for(let _=0;_<=i;_++){const y=_/i*s,g=p/r*Math.PI*2;h.x=(e+t*Math.cos(g))*Math.cos(y),h.y=(e+t*Math.cos(g))*Math.sin(y),h.z=t*Math.sin(g),a.push(h.x,h.y,h.z),u.x=e*Math.cos(y),u.y=e*Math.sin(y),f.subVectors(h,u).normalize(),l.push(f.x,f.y,f.z),c.push(_/i),c.push(p/r)}for(let p=1;p<=r;p++)for(let _=1;_<=i;_++){const y=(i+1)*p+_-1,g=(i+1)*(p-1)+_-1,m=(i+1)*(p-1)+_,v=(i+1)*p+_;o.push(y,g,v),o.push(g,m,v)}this.setIndex(o),this.setAttribute("position",new Wt(a,3)),this.setAttribute("normal",new Wt(l,3)),this.setAttribute("uv",new Wt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _u(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class CK extends fs{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class YU extends Mp{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new at(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new at(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=AU,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vo,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class KU extends ll{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}class $U extends ar{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new at(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const RE=new ot,LP=new N,OP=new N;class bK{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new gt(512,512),this.map=null,this.mapPass=null,this.matrix=new ot,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new HA,this._frameExtents=new gt(1,1),this._viewportCount=1,this._viewports=[new Cn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;LP.setFromMatrixPosition(e.matrixWorld),t.position.copy(LP),OP.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(OP),t.updateMatrixWorld(),RE.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(RE),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(RE)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}const DP=new ot,Kp=new N,NE=new N;class AK extends bK{constructor(){super(new Ni(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new gt(4,2),this._viewportCount=6,this._viewports=[new Cn(2,1,1,1),new Cn(0,1,1,1),new Cn(3,1,1,1),new Cn(1,1,1,1),new Cn(3,0,1,1),new Cn(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,i=this.matrix,s=e.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),Kp.setFromMatrixPosition(e.matrixWorld),r.position.copy(Kp),NE.copy(r.position),NE.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(NE),r.updateMatrixWorld(),i.makeTranslation(-Kp.x,-Kp.y,-Kp.z),DP.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DP)}}class MK extends $U{constructor(e,t,r=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new AK}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class RK extends $U{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class XU{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=UP(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=UP();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function UP(){return(typeof performance>"u"?Date:performance).now()}const KA="\\[\\]\\.:\\/",NK=new RegExp("["+KA+"]","g"),$A="[^"+KA+"]",IK="[^"+KA.replace("\\.","")+"]",PK=/((?:WC+[\/:])*)/.source.replace("WC",$A),kK=/(WCOD+)?/.source.replace("WCOD",IK),LK=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",$A),OK=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",$A),DK=new RegExp("^"+PK+kK+LK+OK+"$"),UK=["material","materials","bones","map"];class FK{constructor(e,t,r){const i=r||Xt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=r.length;i!==s;++i)r[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}class Xt{constructor(e,t,r){this.path=t,this.parsedPath=r||Xt.parseTrackName(t),this.node=Xt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new Xt.Composite(e,t,r):new Xt(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(NK,"")}static parseTrackName(e){const t=DK.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=r.nodeName.substring(i+1);UK.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){const r=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const l=r(a.children);if(l)return l}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)e[t++]=r[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,s=r.length;i!==s;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=Xt.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let c=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[i];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Xt.Composite=FK;Xt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Xt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Xt.prototype.GetterByBindingType=[Xt.prototype._getValue_direct,Xt.prototype._getValue_array,Xt.prototype._getValue_arrayElement,Xt.prototype._getValue_toArray];Xt.prototype.SetterByBindingTypeAndVersioning=[[Xt.prototype._setValue_direct,Xt.prototype._setValue_direct_setNeedsUpdate,Xt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_array,Xt.prototype._setValue_array_setNeedsUpdate,Xt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_arrayElement,Xt.prototype._setValue_arrayElement_setNeedsUpdate,Xt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Xt.prototype._setValue_fromArray,Xt.prototype._setValue_fromArray_setNeedsUpdate,Xt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ca{constructor(e){this.value=e}clone(){return new Ca(this.value.clone===void 0?this.value:this.value.clone())}}const FP=new ot;class qU{constructor(e,t,r=0,i=1/0){this.ray=new zA(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new BA,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return FP.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(FP),this}intersectObject(e,t=!0,r=[]){return LC(e,this,r,t),r.sort(jP),r}intersectObjects(e,t=!0,r=[]){for(let i=0,s=e.length;i<s;i++)LC(e[i],this,r,t);return r.sort(jP),r}}function jP(n,e){return n.distance-e.distance}function LC(n,e,t,r){if(n.layers.test(e.layers)&&n.raycast(e,t),r===!0){const i=n.children;for(let s=0,o=i.length;s<o;s++)LC(i[s],e,t,!0)}}class jK{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(ti(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class zK extends Cv{constructor(e=10,t=10,r=4473924,i=8947848){r=new at(r),i=new at(i);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let f=0,p=0,_=-a;f<=t;f++,_+=o){l.push(-a,0,_,a,0,_),l.push(_,0,-a,_,0,a);const y=f===s?r:i;y.toArray(c,p),p+=3,y.toArray(c,p),p+=3,y.toArray(c,p),p+=3,y.toArray(c,p),p+=3}const u=new xn;u.setAttribute("position",new Wt(l,3)),u.setAttribute("color",new Wt(c,3));const h=new ll({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class OC extends Cv{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new xn;s.setIndex(new Dn(r,1)),s.setAttribute("position",new Wt(i,3)),super(s,new ll({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class BK extends Cv{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new xn;i.setAttribute("position",new Wt(t,3)),i.setAttribute("color",new Wt(r,3));const s=new ll({vertexColors:!0,toneMapped:!1});super(i,s),this.type="AxesHelper"}setColors(e,t,r){const i=new at,s=this.geometry.attributes.color.array;return i.set(e),i.toArray(s,0),i.toArray(s,3),i.set(t),i.toArray(s,6),i.toArray(s,9),i.set(r),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:OA}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=OA);var ag=function(){var n=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(u){u.preventDefault(),r(++n%e.children.length)},!1);function t(u){return e.appendChild(u.dom),u}function r(u){for(var h=0;h<e.children.length;h++)e.children[h].style.display=h===u?"block":"none";n=u}var i=(performance||Date).now(),s=i,o=0,a=t(new ag.Panel("FPS","#0ff","#002")),l=t(new ag.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new ag.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:t,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){o++;var u=(performance||Date).now();if(l.update(u-i,200),u>s+1e3&&(a.update(o*1e3/(u-s),100),s=u,o=0,c)){var h=performance.memory;c.update(h.usedJSHeapSize/1048576,h.jsHeapSizeLimit/1048576)}return u},update:function(){i=this.end()},domElement:e,setMode:r}};ag.Panel=function(n,e,t){var r=1/0,i=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,u=2*o,h=3*o,f=15*o,p=74*o,_=30*o,y=document.createElement("canvas");y.width=a,y.height=l,y.style.cssText="width:80px;height:48px";var g=y.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=t,g.fillRect(0,0,a,l),g.fillStyle=e,g.fillText(n,c,u),g.fillRect(h,f,p,_),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(h,f,p,_),{dom:y,update:function(m,v){r=Math.min(r,m),i=Math.max(i,m),g.fillStyle=t,g.globalAlpha=1,g.fillRect(0,0,a,f),g.fillStyle=e,g.fillText(s(m)+" "+n+" ("+s(r)+"-"+s(i)+")",c,u),g.drawImage(y,h+o,f,p-o,_,h,f,p-o,_),g.fillRect(h+p-o,f,o,_),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(h+p-o,f,o,s((1-m/v)*_))}}};const Qr=Ir(()=>({anyActiveTools:!1,isLengthMode:!1,isSquareMode:!1,isLengthDisplayActive:!1,isSquareDisplayActive:!1,lengthAxisLock:"A"}));class Uw extends ar{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new gt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const th=new N,zP=new ot,BP=new ot,HP=new N,VP=new N;class HK{constructor(e={}){const t=this;let r,i,s,o;const a={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:r,height:i}},this.render=function(p,_){p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld(),_.parent===null&&_.matrixWorldAutoUpdate===!0&&_.updateMatrixWorld(),zP.copy(_.matrixWorldInverse),BP.multiplyMatrices(_.projectionMatrix,zP),c(p,p,_),f(p)},this.setSize=function(p,_){r=p,i=_,s=r/2,o=i/2,l.style.width=p+"px",l.style.height=_+"px"};function c(p,_,y){if(p.isCSS2DObject){th.setFromMatrixPosition(p.matrixWorld),th.applyMatrix4(BP);const g=p.visible===!0&&th.z>=-1&&th.z<=1&&p.layers.test(y.layers)===!0;if(p.element.style.display=g===!0?"":"none",g===!0){p.onBeforeRender(t,_,y);const v=p.element;v.style.transform="translate("+-100*p.center.x+"%,"+-100*p.center.y+"%)translate("+(th.x*s+s)+"px,"+(-th.y*o+o)+"px)",v.parentNode!==l&&l.appendChild(v),p.onAfterRender(t,_,y)}const m={distanceToCameraSquared:u(y,p)};a.objects.set(p,m)}for(let g=0,m=p.children.length;g<m;g++)c(p.children[g],_,y)}function u(p,_){return HP.setFromMatrixPosition(p.matrixWorld),VP.setFromMatrixPosition(_.matrixWorld),HP.distanceToSquared(VP)}function h(p){const _=[];return p.traverse(function(y){y.isCSS2DObject&&_.push(y)}),_}function f(p){const _=h(p).sort(function(g,m){if(g.renderOrder!==m.renderOrder)return m.renderOrder-g.renderOrder;const v=a.objects.get(g).distanceToCameraSquared,x=a.objects.get(m).distanceToCameraSquared;return v-x}),y=_.length;for(let g=0,m=_.length;g<m;g++)_[g].element.style.zIndex=y-g}}}function ql(n){n.removeFromParent(),n.geometry&&n.geometry.dispose(),n.material&&(Array.isArray(n.material)?n.material.forEach(e=>e.dispose()):n.material.dispose()),n.children&&n.children.length&&n.children.forEach(e=>ql(e)),n.children.length=0}class DC{constructor(e,t,r,i,s,o,a,l,c){Q(this,"context");Q(this,"camera");Q(this,"labelClassName");Q(this,"root",new Au);Q(this,"line");Q(this,"textLabel");Q(this,"endpointMeshes",[]);Q(this,"axis");Q(this,"endpoint");Q(this,"start");Q(this,"end");Q(this,"center");Q(this,"length");Q(this,"scale",new N(1,1,1));Q(this,"lineMaterial");Q(this,"endpointMaterial");Q(this,"boundingMesh");Q(this,"boundingSize",.05);Q(this,"axisLock",null);Q(this,"endVector",new N);this.context=e,this.labelClassName=a,this.axisLock=c,this.start=t,this.end=r,this.scale=l,this.lineMaterial=i,this.endpointMaterial=s,this.length=this.getLength(),this.center=this.getCenter(),this.axis=new xn().setFromPoints([t,r]),this.line=new As(this.axis,this.lineMaterial),this.line.frustumCulled=!1,this.root.add(this.line),this.endpoint=o,this.addEndpointMeshes(),this.textLabel=this.newText(),this.root.renderOrder=1,this.context.getScene().add(this.root),this.camera=this.context.getCamera()}dispose(){this.removeFromScene(),this.context=null,ql(this.root),this.root=null,ql(this.line),this.line=null,this.endpointMeshes.forEach(e=>ql(e)),this.endpointMeshes.length=0,this.axis.dispose(),this.axis=null,this.endpoint.dispose(),this.endpoint=null,this.textLabel.removeFromParent(),this.textLabel.element.remove(),this.textLabel=null,this.lineMaterial.dispose(),this.lineMaterial=null,this.endpointMaterial.dispose(),this.endpointMaterial=null}get text(){return this.textLabel}set dimensionColor(e){this.endpointMaterial.color=e,this.lineMaterial.color=e}set visibility(e){this.root.visible=e,this.textLabel.visible=e}set setAxisLock(e){this.axisLock=e}set endpointGeometry(e){this.endpointMeshes.forEach(t=>this.root.remove(t)),this.endpointMeshes=[],this.endpoint=e,this.addEndpointMeshes()}set endpointScale(e){this.scale=e,this.endpointMeshes.forEach(t=>t.scale.set(e.x,e.y,e.z))}set endPoint(e){if(this.end=e,!this.axis)return;const t=this.axis.attributes.position;if(t){switch(this.axisLock){case"X":t.setXYZ(1,e.x,this.start.y,this.start.z),this.endpointMeshes[1].position.set(e.x,this.start.y,this.start.z);break;case"Y":t.setXYZ(1,this.start.x,e.y,this.start.z),this.endpointMeshes[1].position.set(this.start.x,e.y,this.start.z);break;case"Z":t.setXYZ(1,this.start.x,this.start.y,e.z),this.endpointMeshes[1].position.set(this.start.x,this.start.y,e.z);break;case"U":t.setXYZ(1,e.x,e.y,this.start.z),this.endpointMeshes[1].position.set(e.x,e.y,this.start.z);break;case"D":t.setXYZ(1,e.x,e.y,this.start.z),this.endpointMeshes[1].position.set(e.x,e.y,this.start.z);break;case"W":t.setXYZ(1,e.x,this.start.y,e.z),this.endpointMeshes[1].position.set(e.x,this.start.y,e.z);break;case"E":t.setXYZ(1,e.x,this.start.y,e.z),this.endpointMeshes[1].position.set(e.x,this.start.y,e.z);break;case"N":t.setXYZ(1,this.start.x,e.y,e.z),this.endpointMeshes[1].position.set(this.start.x,e.y,e.z);break;case"S":t.setXYZ(1,this.start.x,e.y,e.z),this.endpointMeshes[1].position.set(this.start.x,e.y,e.z);break;default:t.setXYZ(1,e.x,e.y,e.z),this.endpointMeshes[1].position.set(e.x,e.y,e.z)}t.needsUpdate=!0,this.endVector=new N(this.endpointMeshes[1].position.x,this.endpointMeshes[1].position.y,this.endpointMeshes[1].position.z),this.endpointMeshes[1].lookAt(this.start),this.endpointMeshes[0].lookAt(new N(this.endpointMeshes[1].position.x,this.endpointMeshes[1].position.y,this.endpointMeshes[1].position.z)),this.length=this.getLength(),this.textLabel.element.textContent=this.getTextContent(),this.center=this.getCenter(),this.textLabel.position.set(this.center.x,this.center.y,this.center.z),this.line.computeLineDistances()}}removeFromScene(){this.context.getScene().remove(this.root),this.root.remove(this.textLabel)}addEndpointMeshes(){this.newEndpointMesh(this.start,this.end),this.newEndpointMesh(this.end,this.start)}newEndpointMesh(e,t){const r=new Be(this.endpoint,this.endpointMaterial);r.position.set(e.x,e.y,e.z),r.scale.set(this.scale.x,this.scale.y,this.scale.z),r.lookAt(t),this.endpointMeshes.push(r),this.root.add(r)}newText(){const e=document.createElement("div");e.className=this.labelClassName,e.textContent=this.getTextContent(),e.addEventListener("mouseenter",()=>{this.context.active&&(this.context.hoveredElement=this,e.classList.toggle("measure-label-delete"))}),e.addEventListener("mouseleave",()=>{this.context.active&&(this.context.hoveredElement=null,e.classList.toggle("measure-label-delete"))});const t=new Uw(e);return t.position.set(this.center.x,this.center.y,this.center.z),this.root.add(t),t}getTextContent(){return`${this.length} m`}getLength(){return parseFloat(this.start.distanceTo(this.endVector).toFixed(2))}getCenter(){let e=this.endVector.clone().sub(this.start);const t=e.length()*.5;return e=e.normalize().multiplyScalar(t),this.start.clone().add(e)}}Q(DC,"scaleFactor",.1);class VK{constructor(e){Q(this,"context");Q(this,"dimensions",[]);Q(this,"currentDimension");Q(this,"labelClassName","measure-label");Q(this,"previewClassName","measure-preview");Q(this,"enabled",!1);Q(this,"preview",!1);Q(this,"dragging",!1);Q(this,"snapDistance",.01);Q(this,"arrowHeight",.09);Q(this,"arrowRadius",.02);Q(this,"baseScale",new N(1,1,1));Q(this,"endpoint");Q(this,"previewElement");Q(this,"lineMaterial",new KU({color:0,linewidth:2,depthTest:!1,dashSize:.2,gapSize:.1}));Q(this,"endpointsMaterial",new al({color:0,depthTest:!1}));Q(this,"startPoint",new N);Q(this,"endPoint",new N);Q(this,"axisLock","A");Q(this,"rayCasterReady",!0);this.context=e,this.endpoint=this.getDefaultEndpointGeometry();const t=document.createElement("div");t.className=this.previewClassName,this.previewElement=new Uw(t),this.previewElement.visible=!1}dispose(){this.context=null,this.dimensions.forEach(e=>e.dispose()),this.dimensions=null,this.currentDimension=null,this.endpoint.dispose(),this.endpoint=null,this.previewElement.removeFromParent(),this.previewElement.element.remove(),this.previewElement=null}async update(){if(this.enabled&&this.preview&&this.rayCasterReady){this.rayCasterReady=!1;const e=await this.context.castRay();if(this.rayCasterReady=!0,this.previewElement.visible=!!e,!e)return;this.previewElement.visible=!0;const t=this.getClosestVertex(e);if(this.previewElement.visible=!!t,!t)return;this.previewElement.position.set(t.x,t.y,t.z),this.dragging&&this.drawInProcess(e)}}get previewActive(){return this.preview}set previewActive(e){this.preview=e;const t=this.context.getScene();this.preview?t.add(this.previewElement):t.remove(this.previewElement)}set active(e){this.enabled=e,this.dimensions.forEach(t=>{t.visibility=e})}get active(){return this.enabled}get previewObject(){return this.previewElement}set dimensionsColor(e){this.endpointsMaterial.color=e,this.lineMaterial.color=e}set dimensionsWidth(e){this.lineMaterial.linewidth=e}set endpointGeometry(e){this.dimensions.forEach(t=>{t.endpointGeometry=e})}set endpointScaleFactor(e){DC.scaleFactor=e}set endpointScale(e){this.baseScale=e,this.dimensions.forEach(t=>{t.endpointScale=e})}async create(){if(this.enabled){if(!this.dragging){await this.drawStart();return}this.drawEnd()}}delete(e){if(!this.enabled||this.dimensions.length===0)return;const t=this.dimensions.find(i=>i===e);if(!t)return;const r=this.dimensions.indexOf(t);this.dimensions.splice(r,1),t.removeFromScene()}deleteAll(){this.dimensions.forEach(e=>{e.removeFromScene()}),this.dimensions=[]}cancelDrawing(){var e;this.currentDimension&&(this.dragging=!1,(e=this.currentDimension)==null||e.removeFromScene(),this.currentDimension=void 0)}async drawStart(){this.rayCasterReady=!1;const e=await this.context.castRay();if(this.dragging=!0,this.rayCasterReady=!0,!e)return;const t=this.getClosestVertex(e);t&&(this.startPoint=t)}drawInProcess(e){if(!e)return;const t=this.getClosestVertex(e);t&&(this.endPoint=t,this.currentDimension||(this.currentDimension=this.drawDimension()),this.currentDimension.endPoint=this.endPoint)}drawEnd(){this.currentDimension&&(this.dimensions.push(this.currentDimension),this.currentDimension=void 0,this.dragging=!1)}drawDimension(){return new DC(this.context,this.startPoint,this.endPoint,this.lineMaterial,this.endpointsMaterial,this.endpoint,this.labelClassName,this.baseScale,this.axisLock)}getDefaultEndpointGeometry(){const e=new Dw(this.arrowRadius,this.arrowHeight);return e.translate(0,-this.arrowHeight/2,0),e.rotateX(-Math.PI/2),e}set setAxisLock(e){this.axisLock=e,this.currentDimension&&(this.currentDimension.setAxisLock=e)}getClosestVertex(e){if(!e)return;let t=new N,r=!1,i=Number.MAX_SAFE_INTEGER;const s=this.getVertices(e);return s==null||s.forEach(o=>{if(!o)return;const a=e.point.distanceTo(o);a>i||a>this.snapDistance||(r=!0,t=o,i=e.point.distanceTo(o))}),r?t:e.point}getVertices(e){const t=e==null?void 0:e.object;return!(e!=null&&e.face)||!t?null:e.facePosition.map(r=>new N(r.x,r.y,r.z))}}const IE=new URLSearchParams(location.search).get("load-project"),GK=new URLSearchParams(location.search).get("load-model")!==null,PE=new URLSearchParams(location.search).get("load-set"),GP=new URLSearchParams(location.search).get("project-key"),UC=new URLSearchParams(location.search).get("skip-alias")!==null,WK=new URLSearchParams(location.search).get("single-side")!==null,YK=new URLSearchParams(location.search).get("skip-group-layer")!==null,KK=new URLSearchParams(location.search).get("use-set-layer")!==null,$K=new URLSearchParams(location.search).get("presentation-mode")!==null;var $3;const WP=(($3=location.hash)==null?void 0:$3.indexOf("external"))!==-1,ZU=new URLSearchParams(location.search).get("dev-mode")!==null||location.href.includes("localhost"),XK=new URLSearchParams(location.search).get("use-popup-auth")!==null,qK=new URLSearchParams(location.search).get("minimal-layout")!==null,QU=new URLSearchParams(location.search).get("hide-treeview")!==null;new URLSearchParams(location.search).get("container");new URLSearchParams(location.search).get("model-config");const mn=Ir(n=>({allowSelectionOfHidden:!1,isPresentationMode:$K,hideViewPointInPresentationMode:!1,selectedID:"",selectedName:"",selectedParentName:"",selectedData:[],clippingActive:!1,clippingToggle:()=>{n(e=>({clippingActive:!e.clippingActive}))},treeViewActive:!1,treeViewWidth:200,treeViewToggle:()=>{n(e=>({treeViewActive:!e.treeViewActive}))},treeViewSearchActive:!1,treeViewSearchToggle:()=>{n(e=>({treeViewSearchActive:!e.treeViewSearchActive}))},setActive:!1,setToggle:()=>{n(e=>({setActive:!e.setActive}))},canvasMode:"NORMAL"}));async function Ox(n,e){const t=F();if(t.__cameraMoving)return null;const r=new gt,i=t.__renderer.domElement.clientWidth,s=t.__renderer.domElement.clientHeight,o=n.clientX-t.__offsetLeft,a=n.clientY-t.__offsetTop;if(r.x=o/i*2-1,r.y=-(a/s)*2+1,e){const l=t.__activeCamera.toJSON(),c=await t.__rayWorker.raycast(r,l,e.__modelDBStore,e.__modelDBKeyIndex,e.__modelDBKeyPosition,e.$getGroupsRaycast());return c.forEach(h=>{h.object=e,h.point=new N(h.point.x,h.point.y,h.point.z)}),t.__clippingPlaneHelper.filterClippingPlanes(c)[0]}else{t.__sceneController.getMeshes().map(v=>v.$setPicking?v.$setPicking(!0,n.shiftKey):null),t.__activeCamera.setViewOffset(t.__renderer.domElement.width,t.__renderer.domElement.height,o*t.__pixelRatio|0,a*t.__pixelRatio|0,1,1);const l=new zs(1,1),c=new Uint8Array(4);t.__renderer.setRenderTarget(l),t.__renderer.render(t.__sceneController.currentScene(),t.__activeCamera),t.__renderer.readRenderTargetPixels(l,0,0,1,1,c),t.__renderer.setRenderTarget(null);const u=c[0]<<16|c[1]<<8|c[2],h=t.__sceneController.getMeshes().filter(v=>v.$getMeshById?v.$getMeshById(u):!1)[0];if(t.__activeCamera.clearViewOffset(),t.__sceneController.getMeshes().map(v=>v.$setPicking?v.$setPicking(!1):null),!h)return null;const f=t.__activeCamera.toJSON(),p=await t.__rayWorker.raycast(r,f,h.__modelDBStore,h.__modelDBKeyIndex,h.__modelDBKeyPosition,h.$getGroupsRaycast()),_=h.$groupColors,y=h.$getGroups().filter(v=>{const x=_.get(v.material_index)||[1,1,1,1];return x[3]===0?!1:x[3]<.1001?!!n.shiftKey:!(x[3]<1&&n.shiftKey)}).map(v=>[v.start,v.start+v.count-1]),g=p.filter(v=>{for(let x=0;x<y.length;x++){const w=y[x][0],E=y[x][1],S=v.faceIndex*3;if(S>=w&&S<=E)return!0}return!1}).map(v=>(v.object=h,v.point=new N(v.point.x,v.point.y,v.point.z),v));return t.__clippingPlaneHelper.filterClippingPlanes(g)[0]}}class ZK{constructor(){Q(this,"clientX",0);Q(this,"clientY",0);Q(this,"dimensions");Q(this,"active",!1);Q(this,"hoveredElement",null);Q(this,"contrlKeyDown",!1);Q(this,"display",!1);this.dimensions=new VK(this)}setAxisLock(e){this.dimensions.setAxisLock=e}getScene(){return F().getSceneController().currentScene()}render(){this.active&&this.dimensions.update()}handleEvent(e){(e.type==="mousemove"||e.type==="pointerdown")&&(this.clientX=e.clientX,this.clientY=e.clientY,e.type==="pointerdown"&&e.ctrlKey&&this.dimensions.create()),e.type==="keydown"&&(e.key==="Escape"&&this.dimensions.cancelDrawing(),["A","a","X","x","Y","y","Z","z","U","u","W","w","N","n"].includes(e.key)&&(this.dimensions.setAxisLock=e.key.toUpperCase(),Qr.setState({lengthAxisLock:e.key.toUpperCase()})),e.key==="Delete"&&this.hoveredElement&&this.dimensions.delete(this.hoveredElement))}enableDimension(){const e=F();e.getCanvas().addEventListener("pointerdown",this),e.getCanvas().addEventListener("mousemove",this),e.getCanvas().addEventListener("pointerup",this),window.addEventListener("keydown",this),this.dimensions.previewActive=!0,this.dimensions.active=!0,this.display=!0,this.active=!0,mn.setState({canvasMode:"MEASURE"})}disableDimension(){this.dimensions.cancelDrawing();const e=F();e.getCanvas().removeEventListener("pointerdown",this),e.getCanvas().removeEventListener("mousemove",this),e.getCanvas().removeEventListener("pointerup",this),window.removeEventListener("keydown",this),mn.setState({canvasMode:"NORMAL"}),this.active=!1,this.dimensions.previewActive=!1}toggleDisplay(){this.dimensions.active?(this.dimensions.active=!1,this.display=!1,this.dimensions.cancelDrawing()):(this.dimensions.active=!0,this.display=!0)}getCamera(){return F().getActiveCamera()}castRay(e){return Ox({clientX:this.clientX,clientY:this.clientY},e)}}class FC{constructor(e,t,r,i,s,o,a,l){Q(this,"context");Q(this,"camera");Q(this,"labelClassName");Q(this,"root",new Au);Q(this,"line");Q(this,"textLabel");Q(this,"endpointMeshes",[]);Q(this,"axis");Q(this,"endpoint");Q(this,"start");Q(this,"end");Q(this,"center");Q(this,"length");Q(this,"scale",new N(1,1,1));Q(this,"lineMaterial");Q(this,"endpointMaterial");Q(this,"boundingMesh");Q(this,"boundingSize",.05);Q(this,"axisLock",null);Q(this,"box");Q(this,"endVector",new N);this.context=e,this.labelClassName=a,this.start=t,this.end=r,this.scale=l,this.lineMaterial=i,this.endpointMaterial=s,this.length=this.getLength(),this.center=this.getCenter(),this.axis=new xn().setFromPoints([t,r]),this.line=new As(this.axis,this.lineMaterial),this.endpoint=o,this.addEndpointMeshes(),this.textLabel=this.newText(),this.root.renderOrder=1,this.context.getScene().add(this.root),this.camera=this.context.getCamera()}dispose(){this.removeFromScene(),this.context=null,ql(this.root),this.root=null,ql(this.line),this.line=null,ql(this.box),this.box=null,this.endpointMeshes.forEach(e=>ql(e)),this.endpointMeshes.length=0,this.axis.dispose(),this.axis=null,this.endpoint.dispose(),this.endpoint=null,this.textLabel.removeFromParent(),this.textLabel.element.remove(),this.textLabel=null,this.lineMaterial.dispose(),this.lineMaterial=null,this.endpointMaterial.dispose(),this.endpointMaterial=null}addBox(e){const t=new En(0,0,.1),r=new YU({color:new at("yellow"),opacity:.3,side:gi,transparent:!0}),i=new Be(t,r);i.position.set(e.x,e.y,e.z),this.box=i,this.root.add(i)}updateBox(e,t){this.box||this.addBox(e);const r=e.x-t.x,i=e.y-t.y,s=new En(r,i,.1);this.box.geometry.setAttribute("position",s.getAttribute("position")),this.box.position.setX(e.x-r/2),this.box.position.setY(e.y-i/2),this.box.geometry.attributes.position.needsUpdate=!0}get text(){return this.textLabel}set dimensionColor(e){this.endpointMaterial.color=e,this.lineMaterial.color=e}set visibility(e){this.root.visible=e,this.textLabel.visible=e}set setAxisLock(e){this.axisLock=e}set endpointGeometry(e){this.endpointMeshes.forEach(t=>this.root.remove(t)),this.endpointMeshes=[],this.endpoint=e,this.addEndpointMeshes()}set endpointScale(e){this.scale=e,this.endpointMeshes.forEach(t=>t.scale.set(e.x,e.y,e.z))}set endPoint(e){if(this.end=e,!this.axis)return;const t=this.axis.attributes.position;if(t){switch(this.axisLock){case"X":t.setXYZ(1,e.x,this.start.y,this.start.z),this.endpointMeshes[1].position.set(e.x,this.start.y,this.start.z);break;case"Y":t.setXYZ(1,this.start.x,e.y,this.start.z),this.endpointMeshes[1].position.set(this.start.x,e.y,this.start.z);break;case"Z":t.setXYZ(1,this.start.x,this.start.y,e.z),this.endpointMeshes[1].position.set(this.start.x,this.start.y,e.z);break;case"U":t.setXYZ(1,e.x,e.y,this.start.z),this.endpointMeshes[1].position.set(e.x,e.y,this.start.z);break;case"D":t.setXYZ(1,e.x,e.y,this.start.z),this.endpointMeshes[1].position.set(e.x,e.y,this.start.z);break;case"W":t.setXYZ(1,e.x,this.start.y,e.z),this.endpointMeshes[1].position.set(e.x,this.start.y,e.z);break;case"E":t.setXYZ(1,e.x,this.start.y,e.z),this.endpointMeshes[1].position.set(e.x,this.start.y,e.z);break;case"N":t.setXYZ(1,this.start.x,e.y,e.z),this.endpointMeshes[1].position.set(this.start.x,e.y,e.z);break;case"S":t.setXYZ(1,this.start.x,e.y,e.z),this.endpointMeshes[1].position.set(this.start.x,e.y,e.z);break;default:t.setXYZ(1,e.x,e.y,e.z),this.endpointMeshes[1].position.set(e.x,e.y,e.z)}t.needsUpdate=!0,this.endVector=new N(this.endpointMeshes[1].position.x,this.endpointMeshes[1].position.y,this.endpointMeshes[1].position.z),this.endpointMeshes[1].lookAt(this.start),this.endpointMeshes[0].lookAt(this.end),this.length=this.getLength(),this.textLabel.element.textContent=this.getTextContent(),this.center=this.getCenter(),this.textLabel.position.set(this.center.x,this.center.y,this.center.z),this.line.computeLineDistances()}}removeFromScene(){this.context.getScene().remove(this.root),this.root.remove(this.textLabel)}addEndpointMeshes(){this.newEndpointMesh(this.start,this.end),this.newEndpointMesh(this.end,this.start)}newEndpointMesh(e,t){const r=new Be(this.endpoint,this.endpointMaterial);r.position.set(e.x,e.y,e.z),r.scale.set(this.scale.x,this.scale.y,this.scale.z),r.lookAt(t),this.endpointMeshes.push(r)}newText(){const e=document.createElement("div");e.className=this.labelClassName,e.textContent=this.getTextContent(),e.addEventListener("mouseenter",()=>{this.context.active&&(this.context.hoveredElement=this,e.classList.toggle("measure-label-delete"))}),e.addEventListener("mouseleave",()=>{this.context.active&&(this.context.hoveredElement=null,e.classList.toggle("measure-label-delete"))});const t=new Uw(e);return t.position.set(this.center.x,this.center.y,this.center.z),this.root.add(t),t}getTextContent(){if(!this.endVector)return"0 m2";let e,t;return this.start.x>this.endVector.x?e=this.start.x-this.endVector.x:e=this.endVector.x-this.start.x,this.start.y>this.endVector.y?t=this.start.y-this.endVector.y:t=this.endVector.y-this.start.y,`${Math.abs(e*t).toFixed(2)} m2`}getLength(){return parseFloat(this.start.distanceTo(this.end).toFixed(2))}getCenter(){let e=this.end.clone().sub(this.start);const t=e.length()*.5;return e=e.normalize().multiplyScalar(t),this.start.clone().add(e)}}Q(FC,"scaleFactor",.1);class QK{constructor(e){Q(this,"context");Q(this,"dimensions",[]);Q(this,"currentDimension");Q(this,"labelClassName","measure-label");Q(this,"previewClassName","measure-preview");Q(this,"enabled",!1);Q(this,"preview",!1);Q(this,"dragging",!1);Q(this,"snapDistance",.01);Q(this,"arrowHeight",.2);Q(this,"arrowRadius",.1);Q(this,"baseScale",new N(1,1,1));Q(this,"endpoint");Q(this,"previewElement");Q(this,"lineMaterial",new KU({color:0,linewidth:2,depthTest:!1,dashSize:.2,gapSize:.2}));Q(this,"endpointsMaterial",new al({color:0,depthTest:!1}));Q(this,"startPoint",new N);Q(this,"endPoint",new N);Q(this,"box");Q(this,"rayCasterReady",!0);this.context=e,this.endpoint=this.getDefaultEndpointGeometry();const t=document.createElement("div");t.className=this.previewClassName,this.previewElement=new Uw(t),this.previewElement.visible=!1}dispose(){this.context=null,this.dimensions.forEach(e=>e.dispose()),this.dimensions=null,this.currentDimension=null,this.endpoint.dispose(),this.endpoint=null,this.previewElement.removeFromParent(),this.previewElement.element.remove(),this.previewElement=null}async update(){if(this.enabled&&this.preview&&this.rayCasterReady){this.rayCasterReady=!1;const e=await this.context.castRay();if(this.rayCasterReady=!0,this.previewElement.visible=!!e,!e)return;this.previewElement.visible=!0;const t=this.getClosestVertex(e);if(this.previewElement.visible=!!t,!t)return;this.previewElement.position.set(t.x,t.y,t.z),this.dragging&&this.drawInProcess(e)}}get previewActive(){return this.preview}set previewActive(e){this.preview=e;const t=this.context.getScene();this.preview?t.add(this.previewElement):t.remove(this.previewElement)}set active(e){this.enabled=e,this.dimensions.forEach(t=>{t.visibility=e})}get active(){return this.enabled}get previewObject(){return this.previewElement}set dimensionsColor(e){this.endpointsMaterial.color=e,this.lineMaterial.color=e}set dimensionsWidth(e){this.lineMaterial.linewidth=e}set endpointGeometry(e){this.dimensions.forEach(t=>{t.endpointGeometry=e})}set endpointScaleFactor(e){FC.scaleFactor=e}set endpointScale(e){this.baseScale=e,this.dimensions.forEach(t=>{t.endpointScale=e})}async create(){if(this.enabled){if(!this.dragging){await this.drawStart();return}this.drawEnd()}}delete(e){if(!this.enabled||this.dimensions.length===0)return;const t=this.dimensions.find(i=>i===e);if(!t)return;const r=this.dimensions.indexOf(t);this.dimensions.splice(r,1),t.removeFromScene()}deleteAll(){this.dimensions.forEach(e=>{e.removeFromScene()}),this.dimensions=[]}cancelDrawing(){var e;this.currentDimension&&(this.dragging=!1,(e=this.currentDimension)==null||e.removeFromScene(),this.currentDimension=void 0)}async drawStart(){this.rayCasterReady=!1;const e=await this.context.castRay();if(this.dragging=!0,this.rayCasterReady=!0,!e)return;const t=this.getClosestVertex(e);t&&(this.startPoint=t)}drawInProcess(e){var r;if(!e)return;const t=this.getClosestVertex(e);t&&(this.endPoint=t,this.currentDimension||(this.currentDimension=this.drawDimension()),this.currentDimension.endPoint=this.endPoint,(r=this.currentDimension)==null||r.updateBox(this.startPoint,this.endPoint))}drawEnd(){this.currentDimension&&(this.dimensions.push(this.currentDimension),this.currentDimension=void 0,this.dragging=!1)}drawDimension(){return new FC(this.context,this.startPoint,this.endPoint,this.lineMaterial,this.endpointsMaterial,this.endpoint,this.labelClassName,this.baseScale)}getDefaultEndpointGeometry(){const e=new Dw(this.arrowRadius,this.arrowHeight);return e.translate(0,-this.arrowHeight/2,0),e.rotateX(-Math.PI/2),e}set setAxisLock(e){this.currentDimension&&(this.currentDimension.setAxisLock=e)}getClosestVertex(e){if(!e)return;let t=new N,r=!1,i=Number.MAX_SAFE_INTEGER;const s=this.getVertices(e);return s==null||s.forEach(o=>{if(!o)return;const a=e.point.distanceTo(o);a>i||a>this.snapDistance||(r=!0,t=o,i=e.point.distanceTo(o))}),r?t:e.point}getVertices(e){const t=e==null?void 0:e.object;return!(e!=null&&e.face)||!t?null:e.facePosition.map(r=>new N(r.x,r.y,r.z))}}class JK{constructor(){Q(this,"clientX",0);Q(this,"clientY",0);Q(this,"dimensions");Q(this,"active",!1);Q(this,"hoveredElement",null);Q(this,"contrlKeyDown",!1);Q(this,"display",!1);this.dimensions=new QK(this)}getScene(){return F().getSceneController().currentScene()}async render(){this.active&&await this.dimensions.update()}handleEvent(e){(e.type==="mousemove"||e.type==="pointerdown")&&(this.clientX=e.clientX,this.clientY=e.clientY,e.type==="pointerdown"&&e.ctrlKey&&this.dimensions.create()),e.type==="keydown"&&(e.key==="Escape"&&this.dimensions.cancelDrawing(),["A","a","X","x","Y","y","Z","z","U","u","B","b","A","a","W","w","E","e","N","n","S","s"].includes(e.key)&&(this.dimensions.setAxisLock=e.key.toUpperCase()),e.key==="Delete"&&this.hoveredElement&&this.dimensions.delete(this.hoveredElement))}enableDimension(){const e=F();e.getCanvas().addEventListener("pointerdown",this),e.getCanvas().addEventListener("mousemove",this),e.getCanvas().addEventListener("pointerup",this),window.addEventListener("keydown",this),this.dimensions.previewActive=!0,this.dimensions.active=!0,this.active=!0,this.display=!0,mn.setState({canvasMode:"MEASURE"})}disableDimension(){this.dimensions.cancelDrawing();const e=F();e.getCanvas().removeEventListener("pointerdown",this),e.getCanvas().removeEventListener("mousemove",this),e.getCanvas().removeEventListener("pointerup",this),window.removeEventListener("keydown",this),mn.setState({canvasMode:"NORMAL"}),this.active=!1}toggleDisplay(){this.dimensions.active?(this.dimensions.active=!1,this.dimensions.cancelDrawing(),this.display=!1):(this.display=!0,this.dimensions.active=!0)}getCamera(){return F().getActiveCamera()}castRay(e){return Ox({clientX:this.clientX,clientY:this.clientY},e)}}class e${constructor(){Q(this,"lengthTool");Q(this,"squareTool");Q(this,"activeTool",null);this.lengthTool=new ZK,this.squareTool=new JK,this.activeTool=null}toggleDisplayLengthTool(){this.lengthTool.toggleDisplay(),this.updateState()}isMeasureMode(){return this.activeTool!==null}isDisplayActive(){return!!(this.squareTool.display||this.lengthTool.display)}setLengthAxisLock(e){this.lengthTool.setAxisLock(e)}toggleDisplaySquareTool(){this.squareTool.toggleDisplay(),this.updateState()}render(){this.lengthTool.render(),this.squareTool.render()}setActive(e){switch(e){case"length":this.squareTool.disableDimension(),this.lengthTool.enableDimension(),Qr.setState({lengthAxisLock:"A"});break;case"square":this.lengthTool.disableDimension(),this.squareTool.enableDimension();break;default:this.lengthTool.disableDimension(),this.squareTool.disableDimension()}this.activeTool=e,this.updateState()}updateState(){const e=this.lengthTool.display,t=this.squareTool.display,r=this.activeTool==="length",i=this.activeTool==="square",s=r||i;Qr.setState({anyActiveTools:s,isLengthMode:r,isSquareMode:i,isLengthDisplayActive:e,isSquareDisplayActive:t})}}function t$(n){return new Worker(""+new URL("storeWorker-ClE_HysM.js",import.meta.url).href,{name:n==null?void 0:n.name})}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const JU=Symbol("Comlink.proxy"),n$=Symbol("Comlink.endpoint"),XA=Symbol("Comlink.releaseProxy"),kE=Symbol("Comlink.finalizer"),W_=Symbol("Comlink.thrown"),e5=n=>typeof n=="object"&&n!==null||typeof n=="function",r$={canHandle:n=>e5(n)&&n[JU],serialize(n){const{port1:e,port2:t}=new MessageChannel;return n5(n,e),[t,[t]]},deserialize(n){return n.start(),bv(n)}},i$={canHandle:n=>e5(n)&&W_ in n,serialize({value:n}){let e;return n instanceof Error?e={isError:!0,value:{message:n.message,name:n.name,stack:n.stack}}:e={isError:!1,value:n},[e,[]]},deserialize(n){throw n.isError?Object.assign(new Error(n.value.message),n.value):n.value}},t5=new Map([["proxy",r$],["throw",i$]]);function s$(n,e){for(const t of n)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function n5(n,e=globalThis,t=["*"]){e.addEventListener("message",function r(i){if(!i||!i.data)return;if(!s$(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:s,type:o,path:a}=Object.assign({path:[]},i.data),l=(i.data.argumentList||[]).map(xu);let c;try{const u=a.slice(0,-1).reduce((f,p)=>f[p],n),h=a.reduce((f,p)=>f[p],n);switch(o){case"GET":c=h;break;case"SET":u[a.slice(-1)[0]]=xu(i.data.value),c=!0;break;case"APPLY":c=h.apply(u,l);break;case"CONSTRUCT":{const f=new h(...l);c=d$(f)}break;case"ENDPOINT":{const{port1:f,port2:p}=new MessageChannel;n5(n,p),c=u$(f,[f])}break;case"RELEASE":c=void 0;break;default:return}}catch(u){c={value:u,[W_]:0}}Promise.resolve(c).catch(u=>({value:u,[W_]:0})).then(u=>{const[h,f]=Fx(u);e.postMessage(Object.assign(Object.assign({},h),{id:s}),f),o==="RELEASE"&&(e.removeEventListener("message",r),r5(e),kE in n&&typeof n[kE]=="function"&&n[kE]())}).catch(u=>{const[h,f]=Fx({value:new TypeError("Unserializable return value"),[W_]:0});e.postMessage(Object.assign(Object.assign({},h),{id:s}),f)})}),e.start&&e.start()}function o$(n){return n.constructor.name==="MessagePort"}function r5(n){o$(n)&&n.close()}function bv(n,e){return jC(n,[],e)}function E0(n){if(n)throw new Error("Proxy has been released and is not useable")}function i5(n){return kh(n,{type:"RELEASE"}).then(()=>{r5(n)})}const Dx=new WeakMap,Ux="FinalizationRegistry"in globalThis&&new FinalizationRegistry(n=>{const e=(Dx.get(n)||0)-1;Dx.set(n,e),e===0&&i5(n)});function a$(n,e){const t=(Dx.get(e)||0)+1;Dx.set(e,t),Ux&&Ux.register(n,e,n)}function l$(n){Ux&&Ux.unregister(n)}function jC(n,e=[],t=function(){}){let r=!1;const i=new Proxy(t,{get(s,o){if(E0(r),o===XA)return()=>{l$(i),i5(n),r=!0};if(o==="then"){if(e.length===0)return{then:()=>i};const a=kh(n,{type:"GET",path:e.map(l=>l.toString())}).then(xu);return a.then.bind(a)}return jC(n,[...e,o])},set(s,o,a){E0(r);const[l,c]=Fx(a);return kh(n,{type:"SET",path:[...e,o].map(u=>u.toString()),value:l},c).then(xu)},apply(s,o,a){E0(r);const l=e[e.length-1];if(l===n$)return kh(n,{type:"ENDPOINT"}).then(xu);if(l==="bind")return jC(n,e.slice(0,-1));const[c,u]=YP(a);return kh(n,{type:"APPLY",path:e.map(h=>h.toString()),argumentList:c},u).then(xu)},construct(s,o){E0(r);const[a,l]=YP(o);return kh(n,{type:"CONSTRUCT",path:e.map(c=>c.toString()),argumentList:a},l).then(xu)}});return a$(i,n),i}function c$(n){return Array.prototype.concat.apply([],n)}function YP(n){const e=n.map(Fx);return[e.map(t=>t[0]),c$(e.map(t=>t[1]))]}const s5=new WeakMap;function u$(n,e){return s5.set(n,e),n}function d$(n){return Object.assign(n,{[JU]:!0})}function Fx(n){for(const[e,t]of t5)if(t.canHandle(n)){const[r,i]=t.serialize(n);return[{type:"HANDLER",name:e,value:r},i]}return[{type:"RAW",value:n},s5.get(n)||[]]}function xu(n){switch(n.type){case"HANDLER":return t5.get(n.name).deserialize(n.value);case"RAW":return n.value}}function kh(n,e,t){return new Promise(r=>{const i=h$();n.addEventListener("message",function s(o){!o.data||!o.data.id||o.data.id!==i||(n.removeEventListener("message",s),r(o.data))}),n.start&&n.start(),n.postMessage(Object.assign({id:i},e),t)})}function h$(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var o5={exports:{}},vs={},a5={exports:{}},l5={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(z,B){var L=z.length;z.push(B);e:for(;0<L;){var D=L-1>>>1,W=z[D];if(0<i(W,B))z[D]=B,z[L]=W,L=D;else break e}}function t(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var B=z[0],L=z.pop();if(L!==B){z[0]=L;e:for(var D=0,W=z.length,H=W>>>1;D<H;){var K=2*(D+1)-1,oe=z[K],me=K+1,Se=z[me];if(0>i(oe,L))me<W&&0>i(Se,oe)?(z[D]=Se,z[me]=L,D=me):(z[D]=oe,z[K]=L,D=K);else if(me<W&&0>i(Se,L))z[D]=Se,z[me]=L,D=me;else break e}}return B}function i(z,B){var L=z.sortIndex-B.sortIndex;return L!==0?L:z.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,p=!1,_=!1,y=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(z){for(var B=t(c);B!==null;){if(B.callback===null)r(c);else if(B.startTime<=z)r(c),B.sortIndex=B.expirationTime,e(l,B);else break;B=t(c)}}function w(z){if(y=!1,x(z),!_)if(t(l)!==null)_=!0,j(E);else{var B=t(c);B!==null&&O(w,B.startTime-z)}}function E(z,B){_=!1,y&&(y=!1,m(A),A=-1),p=!0;var L=f;try{for(x(B),h=t(l);h!==null&&(!(h.expirationTime>B)||z&&!R());){var D=h.callback;if(typeof D=="function"){h.callback=null,f=h.priorityLevel;var W=D(h.expirationTime<=B);B=n.unstable_now(),typeof W=="function"?h.callback=W:h===t(l)&&r(l),x(B)}else r(l);h=t(l)}if(h!==null)var H=!0;else{var K=t(c);K!==null&&O(w,K.startTime-B),H=!1}return H}finally{h=null,f=L,p=!1}}var S=!1,C=null,A=-1,k=5,T=-1;function R(){return!(n.unstable_now()-T<k)}function $(){if(C!==null){var z=n.unstable_now();T=z;var B=!0;try{B=C(!0,z)}finally{B?P():(S=!1,C=null)}}else S=!1}var P;if(typeof v=="function")P=function(){v($)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,I=M.port2;M.port1.onmessage=$,P=function(){I.postMessage(null)}}else P=function(){g($,0)};function j(z){C=z,S||(S=!0,P())}function O(z,B){A=g(function(){z(n.unstable_now())},B)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(z){z.callback=null},n.unstable_continueExecution=function(){_||p||(_=!0,j(E))},n.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<z?Math.floor(1e3/z):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(z){switch(f){case 1:case 2:case 3:var B=3;break;default:B=f}var L=f;f=B;try{return z()}finally{f=L}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(z,B){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var L=f;f=z;try{return B()}finally{f=L}},n.unstable_scheduleCallback=function(z,B,L){var D=n.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?D+L:D):L=D,z){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=L+W,z={id:u++,callback:B,priorityLevel:z,startTime:L,expirationTime:W,sortIndex:-1},L>D?(z.sortIndex=L,e(c,z),t(l)===null&&z===t(c)&&(y?(m(A),A=-1):y=!0,O(w,L-D))):(z.sortIndex=W,e(l,z),_||p||(_=!0,j(E))),z},n.unstable_shouldYield=R,n.unstable_wrapCallback=function(z){var B=f;return function(){var L=f;f=B;try{return z.apply(this,arguments)}finally{f=L}}}})(l5);a5.exports=l5;var f$=a5.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c5=ee,ps=f$;function Me(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var u5=new Set,jg={};function xd(n,e){Qf(n,e),Qf(n+"Capture",e)}function Qf(n,e){for(jg[n]=e,n=0;n<e.length;n++)u5.add(e[n])}var qa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),zC=Object.prototype.hasOwnProperty,p$=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,KP={},$P={};function m$(n){return zC.call($P,n)?!0:zC.call(KP,n)?!1:p$.test(n)?$P[n]=!0:(KP[n]=!0,!1)}function g$(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function v$(n,e,t,r){if(e===null||typeof e>"u"||g$(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ti(n,e,t,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var zr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){zr[n]=new Ti(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];zr[e]=new Ti(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){zr[n]=new Ti(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){zr[n]=new Ti(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){zr[n]=new Ti(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){zr[n]=new Ti(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){zr[n]=new Ti(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){zr[n]=new Ti(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){zr[n]=new Ti(n,5,!1,n.toLowerCase(),null,!1,!1)});var qA=/[\-:]([a-z])/g;function ZA(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(qA,ZA);zr[e]=new Ti(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(qA,ZA);zr[e]=new Ti(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(qA,ZA);zr[e]=new Ti(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){zr[n]=new Ti(n,1,!1,n.toLowerCase(),null,!1,!1)});zr.xlinkHref=new Ti("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){zr[n]=new Ti(n,1,!1,n.toLowerCase(),null,!0,!0)});function QA(n,e,t,r){var i=zr.hasOwnProperty(e)?zr[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(v$(e,t,i,r)&&(t=null),r||i===null?m$(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var cl=c5.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T0=Symbol.for("react.element"),Xh=Symbol.for("react.portal"),qh=Symbol.for("react.fragment"),JA=Symbol.for("react.strict_mode"),BC=Symbol.for("react.profiler"),d5=Symbol.for("react.provider"),h5=Symbol.for("react.context"),eM=Symbol.for("react.forward_ref"),HC=Symbol.for("react.suspense"),VC=Symbol.for("react.suspense_list"),tM=Symbol.for("react.memo"),Dl=Symbol.for("react.lazy"),f5=Symbol.for("react.offscreen"),XP=Symbol.iterator;function $p(n){return n===null||typeof n!="object"?null:(n=XP&&n[XP]||n["@@iterator"],typeof n=="function"?n:null)}var Bn=Object.assign,LE;function Um(n){if(LE===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);LE=e&&e[1]||""}return`
`+LE+n}var OE=!1;function DE(n,e){if(!n||OE)return"";OE=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{OE=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Um(n):""}function _$(n){switch(n.tag){case 5:return Um(n.type);case 16:return Um("Lazy");case 13:return Um("Suspense");case 19:return Um("SuspenseList");case 0:case 2:case 15:return n=DE(n.type,!1),n;case 11:return n=DE(n.type.render,!1),n;case 1:return n=DE(n.type,!0),n;default:return""}}function GC(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case qh:return"Fragment";case Xh:return"Portal";case BC:return"Profiler";case JA:return"StrictMode";case HC:return"Suspense";case VC:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case h5:return(n.displayName||"Context")+".Consumer";case d5:return(n._context.displayName||"Context")+".Provider";case eM:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case tM:return e=n.displayName||null,e!==null?e:GC(n.type)||"Memo";case Dl:e=n._payload,n=n._init;try{return GC(n(e))}catch{}}return null}function x$(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return GC(e);case 8:return e===JA?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ec(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function p5(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function y$(n){var e=p5(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function C0(n){n._valueTracker||(n._valueTracker=y$(n))}function m5(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=p5(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function jx(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function WC(n,e){var t=e.checked;return Bn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function qP(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Ec(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function g5(n,e){e=e.checked,e!=null&&QA(n,"checked",e,!1)}function YC(n,e){g5(n,e);var t=Ec(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?KC(n,e.type,t):e.hasOwnProperty("defaultValue")&&KC(n,e.type,Ec(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function ZP(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function KC(n,e,t){(e!=="number"||jx(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Fm=Array.isArray;function Sf(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Ec(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function $C(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Me(91));return Bn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function QP(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Me(92));if(Fm(t)){if(1<t.length)throw Error(Me(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Ec(t)}}function v5(n,e){var t=Ec(e.value),r=Ec(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function JP(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function _5(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function XC(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?_5(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var b0,x5=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(b0=b0||document.createElement("div"),b0.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=b0.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function zg(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var lg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},w$=["Webkit","ms","Moz","O"];Object.keys(lg).forEach(function(n){w$.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),lg[e]=lg[n]})});function y5(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||lg.hasOwnProperty(n)&&lg[n]?(""+e).trim():e+"px"}function w5(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=y5(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var S$=Bn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qC(n,e){if(e){if(S$[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Me(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Me(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Me(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Me(62))}}function ZC(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var QC=null;function nM(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var JC=null,Ef=null,Tf=null;function ek(n){if(n=Rv(n)){if(typeof JC!="function")throw Error(Me(280));var e=n.stateNode;e&&(e=Hw(e),JC(n.stateNode,n.type,e))}}function S5(n){Ef?Tf?Tf.push(n):Tf=[n]:Ef=n}function E5(){if(Ef){var n=Ef,e=Tf;if(Tf=Ef=null,ek(n),e)for(n=0;n<e.length;n++)ek(e[n])}}function T5(n,e){return n(e)}function C5(){}var UE=!1;function b5(n,e,t){if(UE)return n(e,t);UE=!0;try{return T5(n,e,t)}finally{UE=!1,(Ef!==null||Tf!==null)&&(C5(),E5())}}function Bg(n,e){var t=n.stateNode;if(t===null)return null;var r=Hw(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Me(231,e,typeof t));return t}var eb=!1;if(qa)try{var Xp={};Object.defineProperty(Xp,"passive",{get:function(){eb=!0}}),window.addEventListener("test",Xp,Xp),window.removeEventListener("test",Xp,Xp)}catch{eb=!1}function E$(n,e,t,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var cg=!1,zx=null,Bx=!1,tb=null,T$={onError:function(n){cg=!0,zx=n}};function C$(n,e,t,r,i,s,o,a,l){cg=!1,zx=null,E$.apply(T$,arguments)}function b$(n,e,t,r,i,s,o,a,l){if(C$.apply(this,arguments),cg){if(cg){var c=zx;cg=!1,zx=null}else throw Error(Me(198));Bx||(Bx=!0,tb=c)}}function yd(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function A5(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function tk(n){if(yd(n)!==n)throw Error(Me(188))}function A$(n){var e=n.alternate;if(!e){if(e=yd(n),e===null)throw Error(Me(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return tk(i),n;if(s===r)return tk(i),e;s=s.sibling}throw Error(Me(188))}if(t.return!==r.return)t=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o)throw Error(Me(189))}}if(t.alternate!==r)throw Error(Me(190))}if(t.tag!==3)throw Error(Me(188));return t.stateNode.current===t?n:e}function M5(n){return n=A$(n),n!==null?R5(n):null}function R5(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=R5(n);if(e!==null)return e;n=n.sibling}return null}var N5=ps.unstable_scheduleCallback,nk=ps.unstable_cancelCallback,M$=ps.unstable_shouldYield,R$=ps.unstable_requestPaint,Zn=ps.unstable_now,N$=ps.unstable_getCurrentPriorityLevel,rM=ps.unstable_ImmediatePriority,I5=ps.unstable_UserBlockingPriority,Hx=ps.unstable_NormalPriority,I$=ps.unstable_LowPriority,P5=ps.unstable_IdlePriority,Fw=null,Xo=null;function P$(n){if(Xo&&typeof Xo.onCommitFiberRoot=="function")try{Xo.onCommitFiberRoot(Fw,n,void 0,(n.current.flags&128)===128)}catch{}}var fo=Math.clz32?Math.clz32:O$,k$=Math.log,L$=Math.LN2;function O$(n){return n>>>=0,n===0?32:31-(k$(n)/L$|0)|0}var A0=64,M0=4194304;function jm(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Vx(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?r=jm(a):(s&=o,s!==0&&(r=jm(s)))}else o=t&~i,o!==0?r=jm(o):s!==0&&(r=jm(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-fo(e),i=1<<t,r|=n[t],e&=~i;return r}function D$(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function U$(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-fo(s),a=1<<o,l=i[o];l===-1?(!(a&t)||a&r)&&(i[o]=D$(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function nb(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function k5(){var n=A0;return A0<<=1,!(A0&4194240)&&(A0=64),n}function FE(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Av(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-fo(e),n[e]=t}function F$(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-fo(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function iM(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-fo(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var an=0;function L5(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var O5,sM,D5,U5,F5,rb=!1,R0=[],ac=null,lc=null,cc=null,Hg=new Map,Vg=new Map,jl=[],j$="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rk(n,e){switch(n){case"focusin":case"focusout":ac=null;break;case"dragenter":case"dragleave":lc=null;break;case"mouseover":case"mouseout":cc=null;break;case"pointerover":case"pointerout":Hg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vg.delete(e.pointerId)}}function qp(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Rv(e),e!==null&&sM(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function z$(n,e,t,r,i){switch(e){case"focusin":return ac=qp(ac,n,e,t,r,i),!0;case"dragenter":return lc=qp(lc,n,e,t,r,i),!0;case"mouseover":return cc=qp(cc,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return Hg.set(s,qp(Hg.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Vg.set(s,qp(Vg.get(s)||null,n,e,t,r,i)),!0}return!1}function j5(n){var e=Mu(n.target);if(e!==null){var t=yd(e);if(t!==null){if(e=t.tag,e===13){if(e=A5(t),e!==null){n.blockedOn=e,F5(n.priority,function(){D5(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Y_(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=ib(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);QC=r,t.target.dispatchEvent(r),QC=null}else return e=Rv(t),e!==null&&sM(e),n.blockedOn=t,!1;e.shift()}return!0}function ik(n,e,t){Y_(n)&&t.delete(e)}function B$(){rb=!1,ac!==null&&Y_(ac)&&(ac=null),lc!==null&&Y_(lc)&&(lc=null),cc!==null&&Y_(cc)&&(cc=null),Hg.forEach(ik),Vg.forEach(ik)}function Zp(n,e){n.blockedOn===e&&(n.blockedOn=null,rb||(rb=!0,ps.unstable_scheduleCallback(ps.unstable_NormalPriority,B$)))}function Gg(n){function e(i){return Zp(i,n)}if(0<R0.length){Zp(R0[0],n);for(var t=1;t<R0.length;t++){var r=R0[t];r.blockedOn===n&&(r.blockedOn=null)}}for(ac!==null&&Zp(ac,n),lc!==null&&Zp(lc,n),cc!==null&&Zp(cc,n),Hg.forEach(e),Vg.forEach(e),t=0;t<jl.length;t++)r=jl[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<jl.length&&(t=jl[0],t.blockedOn===null);)j5(t),t.blockedOn===null&&jl.shift()}var Cf=cl.ReactCurrentBatchConfig,Gx=!0;function H$(n,e,t,r){var i=an,s=Cf.transition;Cf.transition=null;try{an=1,oM(n,e,t,r)}finally{an=i,Cf.transition=s}}function V$(n,e,t,r){var i=an,s=Cf.transition;Cf.transition=null;try{an=4,oM(n,e,t,r)}finally{an=i,Cf.transition=s}}function oM(n,e,t,r){if(Gx){var i=ib(n,e,t,r);if(i===null)$E(n,e,r,Wx,t),rk(n,r);else if(z$(i,n,e,t,r))r.stopPropagation();else if(rk(n,r),e&4&&-1<j$.indexOf(n)){for(;i!==null;){var s=Rv(i);if(s!==null&&O5(s),s=ib(n,e,t,r),s===null&&$E(n,e,r,Wx,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else $E(n,e,r,null,t)}}var Wx=null;function ib(n,e,t,r){if(Wx=null,n=nM(r),n=Mu(n),n!==null)if(e=yd(n),e===null)n=null;else if(t=e.tag,t===13){if(n=A5(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Wx=n,null}function z5(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(N$()){case rM:return 1;case I5:return 4;case Hx:case I$:return 16;case P5:return 536870912;default:return 16}default:return 16}}var Zl=null,aM=null,K_=null;function B5(){if(K_)return K_;var n,e=aM,t=e.length,r,i="value"in Zl?Zl.value:Zl.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===i[s-r];r++);return K_=i.slice(n,1<r?1-r:void 0)}function $_(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function N0(){return!0}function sk(){return!1}function _s(n){function e(t,r,i,s,o){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?N0:sk,this.isPropagationStopped=sk,this}return Bn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=N0)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=N0)},persist:function(){},isPersistent:N0}),e}var Ip={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lM=_s(Ip),Mv=Bn({},Ip,{view:0,detail:0}),G$=_s(Mv),jE,zE,Qp,jw=Bn({},Mv,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cM,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Qp&&(Qp&&n.type==="mousemove"?(jE=n.screenX-Qp.screenX,zE=n.screenY-Qp.screenY):zE=jE=0,Qp=n),jE)},movementY:function(n){return"movementY"in n?n.movementY:zE}}),ok=_s(jw),W$=Bn({},jw,{dataTransfer:0}),Y$=_s(W$),K$=Bn({},Mv,{relatedTarget:0}),BE=_s(K$),$$=Bn({},Ip,{animationName:0,elapsedTime:0,pseudoElement:0}),X$=_s($$),q$=Bn({},Ip,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Z$=_s(q$),Q$=Bn({},Ip,{data:0}),ak=_s(Q$),J$={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eX={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tX={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nX(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=tX[n])?!!e[n]:!1}function cM(){return nX}var rX=Bn({},Mv,{key:function(n){if(n.key){var e=J$[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=$_(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?eX[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cM,charCode:function(n){return n.type==="keypress"?$_(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?$_(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),iX=_s(rX),sX=Bn({},jw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lk=_s(sX),oX=Bn({},Mv,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cM}),aX=_s(oX),lX=Bn({},Ip,{propertyName:0,elapsedTime:0,pseudoElement:0}),cX=_s(lX),uX=Bn({},jw,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),dX=_s(uX),hX=[9,13,27,32],uM=qa&&"CompositionEvent"in window,ug=null;qa&&"documentMode"in document&&(ug=document.documentMode);var fX=qa&&"TextEvent"in window&&!ug,H5=qa&&(!uM||ug&&8<ug&&11>=ug),ck=" ",uk=!1;function V5(n,e){switch(n){case"keyup":return hX.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function G5(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Zh=!1;function pX(n,e){switch(n){case"compositionend":return G5(e);case"keypress":return e.which!==32?null:(uk=!0,ck);case"textInput":return n=e.data,n===ck&&uk?null:n;default:return null}}function mX(n,e){if(Zh)return n==="compositionend"||!uM&&V5(n,e)?(n=B5(),K_=aM=Zl=null,Zh=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return H5&&e.locale!=="ko"?null:e.data;default:return null}}var gX={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dk(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!gX[n.type]:e==="textarea"}function W5(n,e,t,r){S5(r),e=Yx(e,"onChange"),0<e.length&&(t=new lM("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var dg=null,Wg=null;function vX(n){n4(n,0)}function zw(n){var e=ef(n);if(m5(e))return n}function _X(n,e){if(n==="change")return e}var Y5=!1;if(qa){var HE;if(qa){var VE="oninput"in document;if(!VE){var hk=document.createElement("div");hk.setAttribute("oninput","return;"),VE=typeof hk.oninput=="function"}HE=VE}else HE=!1;Y5=HE&&(!document.documentMode||9<document.documentMode)}function fk(){dg&&(dg.detachEvent("onpropertychange",K5),Wg=dg=null)}function K5(n){if(n.propertyName==="value"&&zw(Wg)){var e=[];W5(e,Wg,n,nM(n)),b5(vX,e)}}function xX(n,e,t){n==="focusin"?(fk(),dg=e,Wg=t,dg.attachEvent("onpropertychange",K5)):n==="focusout"&&fk()}function yX(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return zw(Wg)}function wX(n,e){if(n==="click")return zw(e)}function SX(n,e){if(n==="input"||n==="change")return zw(e)}function EX(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var _o=typeof Object.is=="function"?Object.is:EX;function Yg(n,e){if(_o(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!zC.call(e,i)||!_o(n[i],e[i]))return!1}return!0}function pk(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function mk(n,e){var t=pk(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=pk(t)}}function $5(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?$5(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function X5(){for(var n=window,e=jx();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=jx(n.document)}return e}function dM(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function TX(n){var e=X5(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&$5(t.ownerDocument.documentElement,t)){if(r!==null&&dM(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=mk(t,s);var o=mk(t,r);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var CX=qa&&"documentMode"in document&&11>=document.documentMode,Qh=null,sb=null,hg=null,ob=!1;function gk(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;ob||Qh==null||Qh!==jx(r)||(r=Qh,"selectionStart"in r&&dM(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),hg&&Yg(hg,r)||(hg=r,r=Yx(sb,"onSelect"),0<r.length&&(e=new lM("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Qh)))}function I0(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Jh={animationend:I0("Animation","AnimationEnd"),animationiteration:I0("Animation","AnimationIteration"),animationstart:I0("Animation","AnimationStart"),transitionend:I0("Transition","TransitionEnd")},GE={},q5={};qa&&(q5=document.createElement("div").style,"AnimationEvent"in window||(delete Jh.animationend.animation,delete Jh.animationiteration.animation,delete Jh.animationstart.animation),"TransitionEvent"in window||delete Jh.transitionend.transition);function Bw(n){if(GE[n])return GE[n];if(!Jh[n])return n;var e=Jh[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in q5)return GE[n]=e[t];return n}var Z5=Bw("animationend"),Q5=Bw("animationiteration"),J5=Bw("animationstart"),e4=Bw("transitionend"),t4=new Map,vk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pc(n,e){t4.set(n,e),xd(e,[n])}for(var WE=0;WE<vk.length;WE++){var YE=vk[WE],bX=YE.toLowerCase(),AX=YE[0].toUpperCase()+YE.slice(1);Pc(bX,"on"+AX)}Pc(Z5,"onAnimationEnd");Pc(Q5,"onAnimationIteration");Pc(J5,"onAnimationStart");Pc("dblclick","onDoubleClick");Pc("focusin","onFocus");Pc("focusout","onBlur");Pc(e4,"onTransitionEnd");Qf("onMouseEnter",["mouseout","mouseover"]);Qf("onMouseLeave",["mouseout","mouseover"]);Qf("onPointerEnter",["pointerout","pointerover"]);Qf("onPointerLeave",["pointerout","pointerover"]);xd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));xd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));xd("onBeforeInput",["compositionend","keypress","textInput","paste"]);xd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));xd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));xd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),MX=new Set("cancel close invalid load scroll toggle".split(" ").concat(zm));function _k(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,b$(r,e,void 0,n),n.currentTarget=null}function n4(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;_k(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;_k(i,a,c),s=l}}}if(Bx)throw n=tb,Bx=!1,tb=null,n}function wn(n,e){var t=e[db];t===void 0&&(t=e[db]=new Set);var r=n+"__bubble";t.has(r)||(r4(e,n,2,!1),t.add(r))}function KE(n,e,t){var r=0;e&&(r|=4),r4(t,n,r,e)}var P0="_reactListening"+Math.random().toString(36).slice(2);function Kg(n){if(!n[P0]){n[P0]=!0,u5.forEach(function(t){t!=="selectionchange"&&(MX.has(t)||KE(t,!1,n),KE(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[P0]||(e[P0]=!0,KE("selectionchange",!1,e))}}function r4(n,e,t,r){switch(z5(e)){case 1:var i=H$;break;case 4:i=V$;break;default:i=oM}t=i.bind(null,e,t,n),i=void 0,!eb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function $E(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Mu(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}b5(function(){var c=s,u=nM(t),h=[];e:{var f=t4.get(n);if(f!==void 0){var p=lM,_=n;switch(n){case"keypress":if($_(t)===0)break e;case"keydown":case"keyup":p=iX;break;case"focusin":_="focus",p=BE;break;case"focusout":_="blur",p=BE;break;case"beforeblur":case"afterblur":p=BE;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=ok;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Y$;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=aX;break;case Z5:case Q5:case J5:p=X$;break;case e4:p=cX;break;case"scroll":p=G$;break;case"wheel":p=dX;break;case"copy":case"cut":case"paste":p=Z$;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=lk}var y=(e&4)!==0,g=!y&&n==="scroll",m=y?f!==null?f+"Capture":null:f;y=[];for(var v=c,x;v!==null;){x=v;var w=x.stateNode;if(x.tag===5&&w!==null&&(x=w,m!==null&&(w=Bg(v,m),w!=null&&y.push($g(v,w,x)))),g)break;v=v.return}0<y.length&&(f=new p(f,_,null,t,u),h.push({event:f,listeners:y}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",p=n==="mouseout"||n==="pointerout",f&&t!==QC&&(_=t.relatedTarget||t.fromElement)&&(Mu(_)||_[Za]))break e;if((p||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,p?(_=t.relatedTarget||t.toElement,p=c,_=_?Mu(_):null,_!==null&&(g=yd(_),_!==g||_.tag!==5&&_.tag!==6)&&(_=null)):(p=null,_=c),p!==_)){if(y=ok,w="onMouseLeave",m="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(y=lk,w="onPointerLeave",m="onPointerEnter",v="pointer"),g=p==null?f:ef(p),x=_==null?f:ef(_),f=new y(w,v+"leave",p,t,u),f.target=g,f.relatedTarget=x,w=null,Mu(u)===c&&(y=new y(m,v+"enter",_,t,u),y.target=x,y.relatedTarget=g,w=y),g=w,p&&_)t:{for(y=p,m=_,v=0,x=y;x;x=nh(x))v++;for(x=0,w=m;w;w=nh(w))x++;for(;0<v-x;)y=nh(y),v--;for(;0<x-v;)m=nh(m),x--;for(;v--;){if(y===m||m!==null&&y===m.alternate)break t;y=nh(y),m=nh(m)}y=null}else y=null;p!==null&&xk(h,f,p,y,!1),_!==null&&g!==null&&xk(h,g,_,y,!0)}}e:{if(f=c?ef(c):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var E=_X;else if(dk(f))if(Y5)E=SX;else{E=yX;var S=xX}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(E=wX);if(E&&(E=E(n,c))){W5(h,E,t,u);break e}S&&S(n,f,c),n==="focusout"&&(S=f._wrapperState)&&S.controlled&&f.type==="number"&&KC(f,"number",f.value)}switch(S=c?ef(c):window,n){case"focusin":(dk(S)||S.contentEditable==="true")&&(Qh=S,sb=c,hg=null);break;case"focusout":hg=sb=Qh=null;break;case"mousedown":ob=!0;break;case"contextmenu":case"mouseup":case"dragend":ob=!1,gk(h,t,u);break;case"selectionchange":if(CX)break;case"keydown":case"keyup":gk(h,t,u)}var C;if(uM)e:{switch(n){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else Zh?V5(n,t)&&(A="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(A="onCompositionStart");A&&(H5&&t.locale!=="ko"&&(Zh||A!=="onCompositionStart"?A==="onCompositionEnd"&&Zh&&(C=B5()):(Zl=u,aM="value"in Zl?Zl.value:Zl.textContent,Zh=!0)),S=Yx(c,A),0<S.length&&(A=new ak(A,n,null,t,u),h.push({event:A,listeners:S}),C?A.data=C:(C=G5(t),C!==null&&(A.data=C)))),(C=fX?pX(n,t):mX(n,t))&&(c=Yx(c,"onBeforeInput"),0<c.length&&(u=new ak("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:c}),u.data=C))}n4(h,e)})}function $g(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Yx(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Bg(n,t),s!=null&&r.unshift($g(n,s,i)),s=Bg(n,e),s!=null&&r.push($g(n,s,i))),n=n.return}return r}function nh(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function xk(n,e,t,r,i){for(var s=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Bg(t,s),l!=null&&o.unshift($g(t,l,a))):i||(l=Bg(t,s),l!=null&&o.push($g(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var RX=/\r\n?/g,NX=/\u0000|\uFFFD/g;function yk(n){return(typeof n=="string"?n:""+n).replace(RX,`
`).replace(NX,"")}function k0(n,e,t){if(e=yk(e),yk(n)!==e&&t)throw Error(Me(425))}function Kx(){}var ab=null,lb=null;function cb(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ub=typeof setTimeout=="function"?setTimeout:void 0,IX=typeof clearTimeout=="function"?clearTimeout:void 0,wk=typeof Promise=="function"?Promise:void 0,PX=typeof queueMicrotask=="function"?queueMicrotask:typeof wk<"u"?function(n){return wk.resolve(null).then(n).catch(kX)}:ub;function kX(n){setTimeout(function(){throw n})}function XE(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),Gg(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Gg(e)}function uc(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function Sk(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Pp=Math.random().toString(36).slice(2),Bo="__reactFiber$"+Pp,Xg="__reactProps$"+Pp,Za="__reactContainer$"+Pp,db="__reactEvents$"+Pp,LX="__reactListeners$"+Pp,OX="__reactHandles$"+Pp;function Mu(n){var e=n[Bo];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Za]||t[Bo]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Sk(n);n!==null;){if(t=n[Bo])return t;n=Sk(n)}return e}n=t,t=n.parentNode}return null}function Rv(n){return n=n[Bo]||n[Za],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ef(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Me(33))}function Hw(n){return n[Xg]||null}var hb=[],tf=-1;function kc(n){return{current:n}}function Rn(n){0>tf||(n.current=hb[tf],hb[tf]=null,tf--)}function _n(n,e){tf++,hb[tf]=n.current,n.current=e}var Tc={},ai=kc(Tc),zi=kc(!1),td=Tc;function Jf(n,e){var t=n.type.contextTypes;if(!t)return Tc;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function Bi(n){return n=n.childContextTypes,n!=null}function $x(){Rn(zi),Rn(ai)}function Ek(n,e,t){if(ai.current!==Tc)throw Error(Me(168));_n(ai,e),_n(zi,t)}function i4(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Me(108,x$(n)||"Unknown",i));return Bn({},t,r)}function Xx(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Tc,td=ai.current,_n(ai,n),_n(zi,zi.current),!0}function Tk(n,e,t){var r=n.stateNode;if(!r)throw Error(Me(169));t?(n=i4(n,e,td),r.__reactInternalMemoizedMergedChildContext=n,Rn(zi),Rn(ai),_n(ai,n)):Rn(zi),_n(zi,t)}var ba=null,Vw=!1,qE=!1;function s4(n){ba===null?ba=[n]:ba.push(n)}function DX(n){Vw=!0,s4(n)}function Lc(){if(!qE&&ba!==null){qE=!0;var n=0,e=an;try{var t=ba;for(an=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}ba=null,Vw=!1}catch(i){throw ba!==null&&(ba=ba.slice(n+1)),N5(rM,Lc),i}finally{an=e,qE=!1}}return null}var nf=[],rf=0,qx=null,Zx=0,Is=[],Ps=0,nd=null,La=1,Oa="";function au(n,e){nf[rf++]=Zx,nf[rf++]=qx,qx=n,Zx=e}function o4(n,e,t){Is[Ps++]=La,Is[Ps++]=Oa,Is[Ps++]=nd,nd=n;var r=La;n=Oa;var i=32-fo(r)-1;r&=~(1<<i),t+=1;var s=32-fo(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,La=1<<32-fo(e)+i|t<<i|r,Oa=s+n}else La=1<<s|t<<i|r,Oa=n}function hM(n){n.return!==null&&(au(n,1),o4(n,1,0))}function fM(n){for(;n===qx;)qx=nf[--rf],nf[rf]=null,Zx=nf[--rf],nf[rf]=null;for(;n===nd;)nd=Is[--Ps],Is[Ps]=null,Oa=Is[--Ps],Is[Ps]=null,La=Is[--Ps],Is[Ps]=null}var ds=null,ls=null,Ln=!1,io=null;function a4(n,e){var t=Ds(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Ck(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,ds=n,ls=uc(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,ds=n,ls=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=nd!==null?{id:La,overflow:Oa}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Ds(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,ds=n,ls=null,!0):!1;default:return!1}}function fb(n){return(n.mode&1)!==0&&(n.flags&128)===0}function pb(n){if(Ln){var e=ls;if(e){var t=e;if(!Ck(n,e)){if(fb(n))throw Error(Me(418));e=uc(t.nextSibling);var r=ds;e&&Ck(n,e)?a4(r,t):(n.flags=n.flags&-4097|2,Ln=!1,ds=n)}}else{if(fb(n))throw Error(Me(418));n.flags=n.flags&-4097|2,Ln=!1,ds=n}}}function bk(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ds=n}function L0(n){if(n!==ds)return!1;if(!Ln)return bk(n),Ln=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!cb(n.type,n.memoizedProps)),e&&(e=ls)){if(fb(n))throw l4(),Error(Me(418));for(;e;)a4(n,e),e=uc(e.nextSibling)}if(bk(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Me(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ls=uc(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ls=null}}else ls=ds?uc(n.stateNode.nextSibling):null;return!0}function l4(){for(var n=ls;n;)n=uc(n.nextSibling)}function ep(){ls=ds=null,Ln=!1}function pM(n){io===null?io=[n]:io.push(n)}var UX=cl.ReactCurrentBatchConfig;function to(n,e){if(n&&n.defaultProps){e=Bn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var Qx=kc(null),Jx=null,sf=null,mM=null;function gM(){mM=sf=Jx=null}function vM(n){var e=Qx.current;Rn(Qx),n._currentValue=e}function mb(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function bf(n,e){Jx=n,mM=sf=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Li=!0),n.firstContext=null)}function Bs(n){var e=n._currentValue;if(mM!==n)if(n={context:n,memoizedValue:e,next:null},sf===null){if(Jx===null)throw Error(Me(308));sf=n,Jx.dependencies={lanes:0,firstContext:n}}else sf=sf.next=n;return e}var Ru=null;function _M(n){Ru===null?Ru=[n]:Ru.push(n)}function c4(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,_M(e)):(t.next=i.next,i.next=t),e.interleaved=t,Qa(n,r)}function Qa(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Ul=!1;function xM(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function u4(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ja(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function dc(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Vt&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Qa(n,t)}return i=r.interleaved,i===null?(e.next=e,_M(r)):(e.next=i.next,i.next=e),r.interleaved=e,Qa(n,t)}function X_(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,iM(n,t)}}function Ak(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function ey(n,e,t,r){var i=n.updateQueue;Ul=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=i.baseState;o=0,u=c=l=null,a=s;do{var f=a.lane,p=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var _=n,y=a;switch(f=e,p=t,y.tag){case 1:if(_=y.payload,typeof _=="function"){h=_.call(p,h,f);break e}h=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=y.payload,f=typeof _=="function"?_.call(p,h,f):_,f==null)break e;h=Bn({},h,f);break e;case 2:Ul=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else p={eventTime:p,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=p,l=h):u=u.next=p,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(u===null&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);id|=o,n.lanes=o,n.memoizedState=h}}function Mk(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(Me(191,i));i.call(r)}}}var d4=new c5.Component().refs;function gb(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Bn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Gw={isMounted:function(n){return(n=n._reactInternals)?yd(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Si(),i=fc(n),s=ja(r,i);s.payload=e,t!=null&&(s.callback=t),e=dc(n,s,i),e!==null&&(po(e,n,i,r),X_(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Si(),i=fc(n),s=ja(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=dc(n,s,i),e!==null&&(po(e,n,i,r),X_(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Si(),r=fc(n),i=ja(t,r);i.tag=2,e!=null&&(i.callback=e),e=dc(n,i,r),e!==null&&(po(e,n,r,t),X_(e,n,r))}};function Rk(n,e,t,r,i,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Yg(t,r)||!Yg(i,s):!0}function h4(n,e,t){var r=!1,i=Tc,s=e.contextType;return typeof s=="object"&&s!==null?s=Bs(s):(i=Bi(e)?td:ai.current,r=e.contextTypes,s=(r=r!=null)?Jf(n,i):Tc),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Gw,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function Nk(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Gw.enqueueReplaceState(e,e.state,null)}function vb(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs=d4,xM(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Bs(s):(s=Bi(e)?td:ai.current,i.context=Jf(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(gb(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Gw.enqueueReplaceState(i,i.state,null),ey(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Jp(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Me(309));var r=t.stateNode}if(!r)throw Error(Me(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;a===d4&&(a=i.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(Me(284));if(!t._owner)throw Error(Me(290,n))}return n}function O0(n,e){throw n=Object.prototype.toString.call(e),Error(Me(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Ik(n){var e=n._init;return e(n._payload)}function f4(n){function e(m,v){if(n){var x=m.deletions;x===null?(m.deletions=[v],m.flags|=16):x.push(v)}}function t(m,v){if(!n)return null;for(;v!==null;)e(m,v),v=v.sibling;return null}function r(m,v){for(m=new Map;v!==null;)v.key!==null?m.set(v.key,v):m.set(v.index,v),v=v.sibling;return m}function i(m,v){return m=pc(m,v),m.index=0,m.sibling=null,m}function s(m,v,x){return m.index=x,n?(x=m.alternate,x!==null?(x=x.index,x<v?(m.flags|=2,v):x):(m.flags|=2,v)):(m.flags|=1048576,v)}function o(m){return n&&m.alternate===null&&(m.flags|=2),m}function a(m,v,x,w){return v===null||v.tag!==6?(v=rT(x,m.mode,w),v.return=m,v):(v=i(v,x),v.return=m,v)}function l(m,v,x,w){var E=x.type;return E===qh?u(m,v,x.props.children,w,x.key):v!==null&&(v.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Dl&&Ik(E)===v.type)?(w=i(v,x.props),w.ref=Jp(m,v,x),w.return=m,w):(w=tx(x.type,x.key,x.props,null,m.mode,w),w.ref=Jp(m,v,x),w.return=m,w)}function c(m,v,x,w){return v===null||v.tag!==4||v.stateNode.containerInfo!==x.containerInfo||v.stateNode.implementation!==x.implementation?(v=iT(x,m.mode,w),v.return=m,v):(v=i(v,x.children||[]),v.return=m,v)}function u(m,v,x,w,E){return v===null||v.tag!==7?(v=zu(x,m.mode,w,E),v.return=m,v):(v=i(v,x),v.return=m,v)}function h(m,v,x){if(typeof v=="string"&&v!==""||typeof v=="number")return v=rT(""+v,m.mode,x),v.return=m,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case T0:return x=tx(v.type,v.key,v.props,null,m.mode,x),x.ref=Jp(m,null,v),x.return=m,x;case Xh:return v=iT(v,m.mode,x),v.return=m,v;case Dl:var w=v._init;return h(m,w(v._payload),x)}if(Fm(v)||$p(v))return v=zu(v,m.mode,x,null),v.return=m,v;O0(m,v)}return null}function f(m,v,x,w){var E=v!==null?v.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return E!==null?null:a(m,v,""+x,w);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case T0:return x.key===E?l(m,v,x,w):null;case Xh:return x.key===E?c(m,v,x,w):null;case Dl:return E=x._init,f(m,v,E(x._payload),w)}if(Fm(x)||$p(x))return E!==null?null:u(m,v,x,w,null);O0(m,x)}return null}function p(m,v,x,w,E){if(typeof w=="string"&&w!==""||typeof w=="number")return m=m.get(x)||null,a(v,m,""+w,E);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case T0:return m=m.get(w.key===null?x:w.key)||null,l(v,m,w,E);case Xh:return m=m.get(w.key===null?x:w.key)||null,c(v,m,w,E);case Dl:var S=w._init;return p(m,v,x,S(w._payload),E)}if(Fm(w)||$p(w))return m=m.get(x)||null,u(v,m,w,E,null);O0(v,w)}return null}function _(m,v,x,w){for(var E=null,S=null,C=v,A=v=0,k=null;C!==null&&A<x.length;A++){C.index>A?(k=C,C=null):k=C.sibling;var T=f(m,C,x[A],w);if(T===null){C===null&&(C=k);break}n&&C&&T.alternate===null&&e(m,C),v=s(T,v,A),S===null?E=T:S.sibling=T,S=T,C=k}if(A===x.length)return t(m,C),Ln&&au(m,A),E;if(C===null){for(;A<x.length;A++)C=h(m,x[A],w),C!==null&&(v=s(C,v,A),S===null?E=C:S.sibling=C,S=C);return Ln&&au(m,A),E}for(C=r(m,C);A<x.length;A++)k=p(C,m,A,x[A],w),k!==null&&(n&&k.alternate!==null&&C.delete(k.key===null?A:k.key),v=s(k,v,A),S===null?E=k:S.sibling=k,S=k);return n&&C.forEach(function(R){return e(m,R)}),Ln&&au(m,A),E}function y(m,v,x,w){var E=$p(x);if(typeof E!="function")throw Error(Me(150));if(x=E.call(x),x==null)throw Error(Me(151));for(var S=E=null,C=v,A=v=0,k=null,T=x.next();C!==null&&!T.done;A++,T=x.next()){C.index>A?(k=C,C=null):k=C.sibling;var R=f(m,C,T.value,w);if(R===null){C===null&&(C=k);break}n&&C&&R.alternate===null&&e(m,C),v=s(R,v,A),S===null?E=R:S.sibling=R,S=R,C=k}if(T.done)return t(m,C),Ln&&au(m,A),E;if(C===null){for(;!T.done;A++,T=x.next())T=h(m,T.value,w),T!==null&&(v=s(T,v,A),S===null?E=T:S.sibling=T,S=T);return Ln&&au(m,A),E}for(C=r(m,C);!T.done;A++,T=x.next())T=p(C,m,A,T.value,w),T!==null&&(n&&T.alternate!==null&&C.delete(T.key===null?A:T.key),v=s(T,v,A),S===null?E=T:S.sibling=T,S=T);return n&&C.forEach(function($){return e(m,$)}),Ln&&au(m,A),E}function g(m,v,x,w){if(typeof x=="object"&&x!==null&&x.type===qh&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case T0:e:{for(var E=x.key,S=v;S!==null;){if(S.key===E){if(E=x.type,E===qh){if(S.tag===7){t(m,S.sibling),v=i(S,x.props.children),v.return=m,m=v;break e}}else if(S.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Dl&&Ik(E)===S.type){t(m,S.sibling),v=i(S,x.props),v.ref=Jp(m,S,x),v.return=m,m=v;break e}t(m,S);break}else e(m,S);S=S.sibling}x.type===qh?(v=zu(x.props.children,m.mode,w,x.key),v.return=m,m=v):(w=tx(x.type,x.key,x.props,null,m.mode,w),w.ref=Jp(m,v,x),w.return=m,m=w)}return o(m);case Xh:e:{for(S=x.key;v!==null;){if(v.key===S)if(v.tag===4&&v.stateNode.containerInfo===x.containerInfo&&v.stateNode.implementation===x.implementation){t(m,v.sibling),v=i(v,x.children||[]),v.return=m,m=v;break e}else{t(m,v);break}else e(m,v);v=v.sibling}v=iT(x,m.mode,w),v.return=m,m=v}return o(m);case Dl:return S=x._init,g(m,v,S(x._payload),w)}if(Fm(x))return _(m,v,x,w);if($p(x))return y(m,v,x,w);O0(m,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,v!==null&&v.tag===6?(t(m,v.sibling),v=i(v,x),v.return=m,m=v):(t(m,v),v=rT(x,m.mode,w),v.return=m,m=v),o(m)):t(m,v)}return g}var tp=f4(!0),p4=f4(!1),Nv={},qo=kc(Nv),qg=kc(Nv),Zg=kc(Nv);function Nu(n){if(n===Nv)throw Error(Me(174));return n}function yM(n,e){switch(_n(Zg,e),_n(qg,n),_n(qo,Nv),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:XC(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=XC(e,n)}Rn(qo),_n(qo,e)}function np(){Rn(qo),Rn(qg),Rn(Zg)}function m4(n){Nu(Zg.current);var e=Nu(qo.current),t=XC(e,n.type);e!==t&&(_n(qg,n),_n(qo,t))}function wM(n){qg.current===n&&(Rn(qo),Rn(qg))}var jn=kc(0);function ty(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ZE=[];function SM(){for(var n=0;n<ZE.length;n++)ZE[n]._workInProgressVersionPrimary=null;ZE.length=0}var q_=cl.ReactCurrentDispatcher,QE=cl.ReactCurrentBatchConfig,rd=0,zn=null,dr=null,Ar=null,ny=!1,fg=!1,Qg=0,FX=0;function Wr(){throw Error(Me(321))}function EM(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!_o(n[t],e[t]))return!1;return!0}function TM(n,e,t,r,i,s){if(rd=s,zn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,q_.current=n===null||n.memoizedState===null?HX:VX,n=t(r,i),fg){s=0;do{if(fg=!1,Qg=0,25<=s)throw Error(Me(301));s+=1,Ar=dr=null,e.updateQueue=null,q_.current=GX,n=t(r,i)}while(fg)}if(q_.current=ry,e=dr!==null&&dr.next!==null,rd=0,Ar=dr=zn=null,ny=!1,e)throw Error(Me(300));return n}function CM(){var n=Qg!==0;return Qg=0,n}function Lo(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ar===null?zn.memoizedState=Ar=n:Ar=Ar.next=n,Ar}function Hs(){if(dr===null){var n=zn.alternate;n=n!==null?n.memoizedState:null}else n=dr.next;var e=Ar===null?zn.memoizedState:Ar.next;if(e!==null)Ar=e,dr=n;else{if(n===null)throw Error(Me(310));dr=n,n={memoizedState:dr.memoizedState,baseState:dr.baseState,baseQueue:dr.baseQueue,queue:dr.queue,next:null},Ar===null?zn.memoizedState=Ar=n:Ar=Ar.next=n}return Ar}function Jg(n,e){return typeof e=="function"?e(n):e}function JE(n){var e=Hs(),t=e.queue;if(t===null)throw Error(Me(311));t.lastRenderedReducer=n;var r=dr,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((rd&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,zn.lanes|=u,id|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,_o(r,e.memoizedState)||(Li=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,zn.lanes|=s,id|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function eT(n){var e=Hs(),t=e.queue;if(t===null)throw Error(Me(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=n(s,o.action),o=o.next;while(o!==i);_o(s,e.memoizedState)||(Li=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function g4(){}function v4(n,e){var t=zn,r=Hs(),i=e(),s=!_o(r.memoizedState,i);if(s&&(r.memoizedState=i,Li=!0),r=r.queue,bM(y4.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||Ar!==null&&Ar.memoizedState.tag&1){if(t.flags|=2048,ev(9,x4.bind(null,t,r,i,e),void 0,null),Nr===null)throw Error(Me(349));rd&30||_4(t,e,i)}return i}function _4(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=zn.updateQueue,e===null?(e={lastEffect:null,stores:null},zn.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function x4(n,e,t,r){e.value=t,e.getSnapshot=r,w4(e)&&S4(n)}function y4(n,e,t){return t(function(){w4(e)&&S4(n)})}function w4(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!_o(n,t)}catch{return!0}}function S4(n){var e=Qa(n,1);e!==null&&po(e,n,1,-1)}function Pk(n){var e=Lo();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Jg,lastRenderedState:n},e.queue=n,n=n.dispatch=BX.bind(null,zn,n),[e.memoizedState,n]}function ev(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=zn.updateQueue,e===null?(e={lastEffect:null,stores:null},zn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function E4(){return Hs().memoizedState}function Z_(n,e,t,r){var i=Lo();zn.flags|=n,i.memoizedState=ev(1|e,t,void 0,r===void 0?null:r)}function Ww(n,e,t,r){var i=Hs();r=r===void 0?null:r;var s=void 0;if(dr!==null){var o=dr.memoizedState;if(s=o.destroy,r!==null&&EM(r,o.deps)){i.memoizedState=ev(e,t,s,r);return}}zn.flags|=n,i.memoizedState=ev(1|e,t,s,r)}function kk(n,e){return Z_(8390656,8,n,e)}function bM(n,e){return Ww(2048,8,n,e)}function T4(n,e){return Ww(4,2,n,e)}function C4(n,e){return Ww(4,4,n,e)}function b4(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function A4(n,e,t){return t=t!=null?t.concat([n]):null,Ww(4,4,b4.bind(null,e,n),t)}function AM(){}function M4(n,e){var t=Hs();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&EM(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function R4(n,e){var t=Hs();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&EM(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function N4(n,e,t){return rd&21?(_o(t,e)||(t=k5(),zn.lanes|=t,id|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Li=!0),n.memoizedState=t)}function jX(n,e){var t=an;an=t!==0&&4>t?t:4,n(!0);var r=QE.transition;QE.transition={};try{n(!1),e()}finally{an=t,QE.transition=r}}function I4(){return Hs().memoizedState}function zX(n,e,t){var r=fc(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},P4(n))k4(e,t);else if(t=c4(n,e,t,r),t!==null){var i=Si();po(t,n,r,i),L4(t,e,r)}}function BX(n,e,t){var r=fc(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(P4(n))k4(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,_o(a,o)){var l=e.interleaved;l===null?(i.next=i,_M(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=c4(n,e,i,r),t!==null&&(i=Si(),po(t,n,r,i),L4(t,e,r))}}function P4(n){var e=n.alternate;return n===zn||e!==null&&e===zn}function k4(n,e){fg=ny=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function L4(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,iM(n,t)}}var ry={readContext:Bs,useCallback:Wr,useContext:Wr,useEffect:Wr,useImperativeHandle:Wr,useInsertionEffect:Wr,useLayoutEffect:Wr,useMemo:Wr,useReducer:Wr,useRef:Wr,useState:Wr,useDebugValue:Wr,useDeferredValue:Wr,useTransition:Wr,useMutableSource:Wr,useSyncExternalStore:Wr,useId:Wr,unstable_isNewReconciler:!1},HX={readContext:Bs,useCallback:function(n,e){return Lo().memoizedState=[n,e===void 0?null:e],n},useContext:Bs,useEffect:kk,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Z_(4194308,4,b4.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Z_(4194308,4,n,e)},useInsertionEffect:function(n,e){return Z_(4,2,n,e)},useMemo:function(n,e){var t=Lo();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Lo();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=zX.bind(null,zn,n),[r.memoizedState,n]},useRef:function(n){var e=Lo();return n={current:n},e.memoizedState=n},useState:Pk,useDebugValue:AM,useDeferredValue:function(n){return Lo().memoizedState=n},useTransition:function(){var n=Pk(!1),e=n[0];return n=jX.bind(null,n[1]),Lo().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=zn,i=Lo();if(Ln){if(t===void 0)throw Error(Me(407));t=t()}else{if(t=e(),Nr===null)throw Error(Me(349));rd&30||_4(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,kk(y4.bind(null,r,s,n),[n]),r.flags|=2048,ev(9,x4.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=Lo(),e=Nr.identifierPrefix;if(Ln){var t=Oa,r=La;t=(r&~(1<<32-fo(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Qg++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=FX++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},VX={readContext:Bs,useCallback:M4,useContext:Bs,useEffect:bM,useImperativeHandle:A4,useInsertionEffect:T4,useLayoutEffect:C4,useMemo:R4,useReducer:JE,useRef:E4,useState:function(){return JE(Jg)},useDebugValue:AM,useDeferredValue:function(n){var e=Hs();return N4(e,dr.memoizedState,n)},useTransition:function(){var n=JE(Jg)[0],e=Hs().memoizedState;return[n,e]},useMutableSource:g4,useSyncExternalStore:v4,useId:I4,unstable_isNewReconciler:!1},GX={readContext:Bs,useCallback:M4,useContext:Bs,useEffect:bM,useImperativeHandle:A4,useInsertionEffect:T4,useLayoutEffect:C4,useMemo:R4,useReducer:eT,useRef:E4,useState:function(){return eT(Jg)},useDebugValue:AM,useDeferredValue:function(n){var e=Hs();return dr===null?e.memoizedState=n:N4(e,dr.memoizedState,n)},useTransition:function(){var n=eT(Jg)[0],e=Hs().memoizedState;return[n,e]},useMutableSource:g4,useSyncExternalStore:v4,useId:I4,unstable_isNewReconciler:!1};function rp(n,e){try{var t="",r=e;do t+=_$(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function tT(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function _b(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var WX=typeof WeakMap=="function"?WeakMap:Map;function O4(n,e,t){t=ja(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){sy||(sy=!0,Mb=r),_b(n,e)},t}function D4(n,e,t){t=ja(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){_b(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){_b(n,e),typeof r!="function"&&(hc===null?hc=new Set([this]):hc.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Lk(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new WX;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=sq.bind(null,n,e,t),e.then(n,n))}function Ok(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Dk(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ja(-1,1),e.tag=2,dc(t,e,1))),t.lanes|=1),n)}var YX=cl.ReactCurrentOwner,Li=!1;function pi(n,e,t,r){e.child=n===null?p4(e,null,t,r):tp(e,n.child,t,r)}function Uk(n,e,t,r,i){t=t.render;var s=e.ref;return bf(e,i),r=TM(n,e,t,r,s,i),t=CM(),n!==null&&!Li?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Ja(n,e,i)):(Ln&&t&&hM(e),e.flags|=1,pi(n,e,r,i),e.child)}function Fk(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!OM(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,U4(n,e,s,r,i)):(n=tx(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:Yg,t(o,r)&&n.ref===e.ref)return Ja(n,e,i)}return e.flags|=1,n=pc(s,r),n.ref=e.ref,n.return=e,e.child=n}function U4(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(Yg(s,r)&&n.ref===e.ref)if(Li=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(Li=!0);else return e.lanes=n.lanes,Ja(n,e,i)}return xb(n,e,t,r,i)}function F4(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_n(af,ss),ss|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,_n(af,ss),ss|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,_n(af,ss),ss|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,_n(af,ss),ss|=r;return pi(n,e,i,t),e.child}function j4(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function xb(n,e,t,r,i){var s=Bi(t)?td:ai.current;return s=Jf(e,s),bf(e,i),t=TM(n,e,t,r,s,i),r=CM(),n!==null&&!Li?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Ja(n,e,i)):(Ln&&r&&hM(e),e.flags|=1,pi(n,e,t,i),e.child)}function jk(n,e,t,r,i){if(Bi(t)){var s=!0;Xx(e)}else s=!1;if(bf(e,i),e.stateNode===null)Q_(n,e),h4(e,t,r),vb(e,t,r,i),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=Bs(c):(c=Bi(t)?td:ai.current,c=Jf(e,c));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&Nk(e,o,r,c),Ul=!1;var f=e.memoizedState;o.state=f,ey(e,r,o,i),l=e.memoizedState,a!==r||f!==l||zi.current||Ul?(typeof u=="function"&&(gb(e,t,u,r),l=e.memoizedState),(a=Ul||Rk(e,t,a,r,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,u4(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:to(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Bs(l):(l=Bi(t)?td:ai.current,l=Jf(e,l));var p=t.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&Nk(e,o,r,l),Ul=!1,f=e.memoizedState,o.state=f,ey(e,r,o,i);var _=e.memoizedState;a!==h||f!==_||zi.current||Ul?(typeof p=="function"&&(gb(e,t,p,r),_=e.memoizedState),(c=Ul||Rk(e,t,c,r,f,_,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,_,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,_,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=_),o.props=r,o.state=_,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return yb(n,e,t,r,s,i)}function yb(n,e,t,r,i,s){j4(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Tk(e,t,!1),Ja(n,e,s);r=e.stateNode,YX.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=tp(e,n.child,null,s),e.child=tp(e,null,a,s)):pi(n,e,a,s),e.memoizedState=r.state,i&&Tk(e,t,!0),e.child}function z4(n){var e=n.stateNode;e.pendingContext?Ek(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Ek(n,e.context,!1),yM(n,e.containerInfo)}function zk(n,e,t,r,i){return ep(),pM(i),e.flags|=256,pi(n,e,t,r),e.child}var wb={dehydrated:null,treeContext:null,retryLane:0};function Sb(n){return{baseLanes:n,cachePool:null,transitions:null}}function B4(n,e,t){var r=e.pendingProps,i=jn.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),_n(jn,i&1),n===null)return pb(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=$w(o,r,0,null),n=zu(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=Sb(t),e.memoizedState=wb,n):MM(e,o));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return KX(n,e,o,r,a,i,t);if(s){s=r.fallback,o=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=pc(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=pc(a,s):(s=zu(s,o,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=n.child.memoizedState,o=o===null?Sb(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=wb,r}return s=n.child,n=s.sibling,r=pc(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function MM(n,e){return e=$w({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function D0(n,e,t,r){return r!==null&&pM(r),tp(e,n.child,null,t),n=MM(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function KX(n,e,t,r,i,s,o){if(t)return e.flags&256?(e.flags&=-257,r=tT(Error(Me(422))),D0(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=$w({mode:"visible",children:r.children},i,0,null),s=zu(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&tp(e,n.child,null,o),e.child.memoizedState=Sb(o),e.memoizedState=wb,s);if(!(e.mode&1))return D0(n,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(Me(419)),r=tT(s,r,void 0),D0(n,e,o,r)}if(a=(o&n.childLanes)!==0,Li||a){if(r=Nr,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Qa(n,i),po(r,n,i,-1))}return LM(),r=tT(Error(Me(421))),D0(n,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=oq.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,ls=uc(i.nextSibling),ds=e,Ln=!0,io=null,n!==null&&(Is[Ps++]=La,Is[Ps++]=Oa,Is[Ps++]=nd,La=n.id,Oa=n.overflow,nd=e),e=MM(e,r.children),e.flags|=4096,e)}function Bk(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),mb(n.return,e,t)}function nT(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function H4(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(pi(n,e,r.children,t),r=jn.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Bk(n,t,e);else if(n.tag===19)Bk(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(_n(jn,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&ty(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),nT(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&ty(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}nT(e,!0,t,null,s);break;case"together":nT(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Q_(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Ja(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),id|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Me(153));if(e.child!==null){for(n=e.child,t=pc(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=pc(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function $X(n,e,t){switch(e.tag){case 3:z4(e),ep();break;case 5:m4(e);break;case 1:Bi(e.type)&&Xx(e);break;case 4:yM(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;_n(Qx,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(_n(jn,jn.current&1),e.flags|=128,null):t&e.child.childLanes?B4(n,e,t):(_n(jn,jn.current&1),n=Ja(n,e,t),n!==null?n.sibling:null);_n(jn,jn.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return H4(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),_n(jn,jn.current),r)break;return null;case 22:case 23:return e.lanes=0,F4(n,e,t)}return Ja(n,e,t)}var V4,Eb,G4,W4;V4=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Eb=function(){};G4=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Nu(qo.current);var s=null;switch(t){case"input":i=WC(n,i),r=WC(n,r),s=[];break;case"select":i=Bn({},i,{value:void 0}),r=Bn({},r,{value:void 0}),s=[];break;case"textarea":i=$C(n,i),r=$C(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Kx)}qC(t,r);var o;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(jg.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(jg.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&wn("scroll",n),s||a===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};W4=function(n,e,t,r){t!==r&&(e.flags|=4)};function em(n,e){if(!Ln)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Yr(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function XX(n,e,t){var r=e.pendingProps;switch(fM(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yr(e),null;case 1:return Bi(e.type)&&$x(),Yr(e),null;case 3:return r=e.stateNode,np(),Rn(zi),Rn(ai),SM(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(L0(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,io!==null&&(Ib(io),io=null))),Eb(n,e),Yr(e),null;case 5:wM(e);var i=Nu(Zg.current);if(t=e.type,n!==null&&e.stateNode!=null)G4(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Me(166));return Yr(e),null}if(n=Nu(qo.current),L0(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[Bo]=e,r[Xg]=s,n=(e.mode&1)!==0,t){case"dialog":wn("cancel",r),wn("close",r);break;case"iframe":case"object":case"embed":wn("load",r);break;case"video":case"audio":for(i=0;i<zm.length;i++)wn(zm[i],r);break;case"source":wn("error",r);break;case"img":case"image":case"link":wn("error",r),wn("load",r);break;case"details":wn("toggle",r);break;case"input":qP(r,s),wn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},wn("invalid",r);break;case"textarea":QP(r,s),wn("invalid",r)}qC(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&k0(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&k0(r.textContent,a,n),i=["children",""+a]):jg.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&wn("scroll",r)}switch(t){case"input":C0(r),ZP(r,s,!0);break;case"textarea":C0(r),JP(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Kx)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=_5(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Bo]=e,n[Xg]=r,V4(n,e,!1,!1),e.stateNode=n;e:{switch(o=ZC(t,r),t){case"dialog":wn("cancel",n),wn("close",n),i=r;break;case"iframe":case"object":case"embed":wn("load",n),i=r;break;case"video":case"audio":for(i=0;i<zm.length;i++)wn(zm[i],n);i=r;break;case"source":wn("error",n),i=r;break;case"img":case"image":case"link":wn("error",n),wn("load",n),i=r;break;case"details":wn("toggle",n),i=r;break;case"input":qP(n,r),i=WC(n,r),wn("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Bn({},r,{value:void 0}),wn("invalid",n);break;case"textarea":QP(n,r),i=$C(n,r),wn("invalid",n);break;default:i=r}qC(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?w5(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&x5(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&zg(n,l):typeof l=="number"&&zg(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(jg.hasOwnProperty(s)?l!=null&&s==="onScroll"&&wn("scroll",n):l!=null&&QA(n,s,l,o))}switch(t){case"input":C0(n),ZP(n,r,!1);break;case"textarea":C0(n),JP(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Ec(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?Sf(n,!!r.multiple,s,!1):r.defaultValue!=null&&Sf(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Kx)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Yr(e),null;case 6:if(n&&e.stateNode!=null)W4(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Me(166));if(t=Nu(Zg.current),Nu(qo.current),L0(e)){if(r=e.stateNode,t=e.memoizedProps,r[Bo]=e,(s=r.nodeValue!==t)&&(n=ds,n!==null))switch(n.tag){case 3:k0(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&k0(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Bo]=e,e.stateNode=r}return Yr(e),null;case 13:if(Rn(jn),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ln&&ls!==null&&e.mode&1&&!(e.flags&128))l4(),ep(),e.flags|=98560,s=!1;else if(s=L0(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(Me(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Me(317));s[Bo]=e}else ep(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Yr(e),s=!1}else io!==null&&(Ib(io),io=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||jn.current&1?mr===0&&(mr=3):LM())),e.updateQueue!==null&&(e.flags|=4),Yr(e),null);case 4:return np(),Eb(n,e),n===null&&Kg(e.stateNode.containerInfo),Yr(e),null;case 10:return vM(e.type._context),Yr(e),null;case 17:return Bi(e.type)&&$x(),Yr(e),null;case 19:if(Rn(jn),s=e.memoizedState,s===null)return Yr(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)em(s,!1);else{if(mr!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=ty(n),o!==null){for(e.flags|=128,em(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return _n(jn,jn.current&1|2),e.child}n=n.sibling}s.tail!==null&&Zn()>ip&&(e.flags|=128,r=!0,em(s,!1),e.lanes=4194304)}else{if(!r)if(n=ty(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),em(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Ln)return Yr(e),null}else 2*Zn()-s.renderingStartTime>ip&&t!==1073741824&&(e.flags|=128,r=!0,em(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Zn(),e.sibling=null,t=jn.current,_n(jn,r?t&1|2:t&1),e):(Yr(e),null);case 22:case 23:return kM(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ss&1073741824&&(Yr(e),e.subtreeFlags&6&&(e.flags|=8192)):Yr(e),null;case 24:return null;case 25:return null}throw Error(Me(156,e.tag))}function qX(n,e){switch(fM(e),e.tag){case 1:return Bi(e.type)&&$x(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return np(),Rn(zi),Rn(ai),SM(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return wM(e),null;case 13:if(Rn(jn),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Me(340));ep()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Rn(jn),null;case 4:return np(),null;case 10:return vM(e.type._context),null;case 22:case 23:return kM(),null;case 24:return null;default:return null}}var U0=!1,ni=!1,ZX=typeof WeakSet=="function"?WeakSet:Set,qe=null;function of(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Gn(n,e,r)}else t.current=null}function Tb(n,e,t){try{t()}catch(r){Gn(n,e,r)}}var Hk=!1;function QX(n,e){if(ab=Gx,n=X5(),dM(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=n,f=null;t:for(;;){for(var p;h!==t||i!==0&&h.nodeType!==3||(a=o+i),h!==s||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(p=h.firstChild)!==null;)f=h,h=p;for(;;){if(h===n)break t;if(f===t&&++c===i&&(a=o),f===s&&++u===r&&(l=o),(p=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=p}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(lb={focusedElem:n,selectionRange:t},Gx=!1,qe=e;qe!==null;)if(e=qe,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,qe=n;else for(;qe!==null;){e=qe;try{var _=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var y=_.memoizedProps,g=_.memoizedState,m=e.stateNode,v=m.getSnapshotBeforeUpdate(e.elementType===e.type?y:to(e.type,y),g);m.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Me(163))}}catch(w){Gn(e,e.return,w)}if(n=e.sibling,n!==null){n.return=e.return,qe=n;break}qe=e.return}return _=Hk,Hk=!1,_}function pg(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&Tb(e,t,s)}i=i.next}while(i!==r)}}function Yw(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Cb(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function Y4(n){var e=n.alternate;e!==null&&(n.alternate=null,Y4(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Bo],delete e[Xg],delete e[db],delete e[LX],delete e[OX])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function K4(n){return n.tag===5||n.tag===3||n.tag===4}function Vk(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||K4(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function bb(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Kx));else if(r!==4&&(n=n.child,n!==null))for(bb(n,e,t),n=n.sibling;n!==null;)bb(n,e,t),n=n.sibling}function Ab(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Ab(n,e,t),n=n.sibling;n!==null;)Ab(n,e,t),n=n.sibling}var Dr=null,no=!1;function _l(n,e,t){for(t=t.child;t!==null;)$4(n,e,t),t=t.sibling}function $4(n,e,t){if(Xo&&typeof Xo.onCommitFiberUnmount=="function")try{Xo.onCommitFiberUnmount(Fw,t)}catch{}switch(t.tag){case 5:ni||of(t,e);case 6:var r=Dr,i=no;Dr=null,_l(n,e,t),Dr=r,no=i,Dr!==null&&(no?(n=Dr,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Dr.removeChild(t.stateNode));break;case 18:Dr!==null&&(no?(n=Dr,t=t.stateNode,n.nodeType===8?XE(n.parentNode,t):n.nodeType===1&&XE(n,t),Gg(n)):XE(Dr,t.stateNode));break;case 4:r=Dr,i=no,Dr=t.stateNode.containerInfo,no=!0,_l(n,e,t),Dr=r,no=i;break;case 0:case 11:case 14:case 15:if(!ni&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Tb(t,e,o),i=i.next}while(i!==r)}_l(n,e,t);break;case 1:if(!ni&&(of(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Gn(t,e,a)}_l(n,e,t);break;case 21:_l(n,e,t);break;case 22:t.mode&1?(ni=(r=ni)||t.memoizedState!==null,_l(n,e,t),ni=r):_l(n,e,t);break;default:_l(n,e,t)}}function Gk(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new ZX),e.forEach(function(r){var i=aq.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function Xs(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Dr=a.stateNode,no=!1;break e;case 3:Dr=a.stateNode.containerInfo,no=!0;break e;case 4:Dr=a.stateNode.containerInfo,no=!0;break e}a=a.return}if(Dr===null)throw Error(Me(160));$4(s,o,i),Dr=null,no=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){Gn(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)X4(e,n),e=e.sibling}function X4(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Xs(e,n),Mo(n),r&4){try{pg(3,n,n.return),Yw(3,n)}catch(y){Gn(n,n.return,y)}try{pg(5,n,n.return)}catch(y){Gn(n,n.return,y)}}break;case 1:Xs(e,n),Mo(n),r&512&&t!==null&&of(t,t.return);break;case 5:if(Xs(e,n),Mo(n),r&512&&t!==null&&of(t,t.return),n.flags&32){var i=n.stateNode;try{zg(i,"")}catch(y){Gn(n,n.return,y)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&g5(i,s),ZC(a,o);var c=ZC(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?w5(i,h):u==="dangerouslySetInnerHTML"?x5(i,h):u==="children"?zg(i,h):QA(i,u,h,c)}switch(a){case"input":YC(i,s);break;case"textarea":v5(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?Sf(i,!!s.multiple,p,!1):f!==!!s.multiple&&(s.defaultValue!=null?Sf(i,!!s.multiple,s.defaultValue,!0):Sf(i,!!s.multiple,s.multiple?[]:"",!1))}i[Xg]=s}catch(y){Gn(n,n.return,y)}}break;case 6:if(Xs(e,n),Mo(n),r&4){if(n.stateNode===null)throw Error(Me(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(y){Gn(n,n.return,y)}}break;case 3:if(Xs(e,n),Mo(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Gg(e.containerInfo)}catch(y){Gn(n,n.return,y)}break;case 4:Xs(e,n),Mo(n);break;case 13:Xs(e,n),Mo(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(IM=Zn())),r&4&&Gk(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(ni=(c=ni)||u,Xs(e,n),ni=c):Xs(e,n),Mo(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(qe=n,u=n.child;u!==null;){for(h=qe=u;qe!==null;){switch(f=qe,p=f.child,f.tag){case 0:case 11:case 14:case 15:pg(4,f,f.return);break;case 1:of(f,f.return);var _=f.stateNode;if(typeof _.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,_.props=e.memoizedProps,_.state=e.memoizedState,_.componentWillUnmount()}catch(y){Gn(r,t,y)}}break;case 5:of(f,f.return);break;case 22:if(f.memoizedState!==null){Yk(h);continue}}p!==null?(p.return=f,qe=p):Yk(h)}u=u.sibling}e:for(u=null,h=n;;){if(h.tag===5){if(u===null){u=h;try{i=h.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=y5("display",o))}catch(y){Gn(n,n.return,y)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(y){Gn(n,n.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Xs(e,n),Mo(n),r&4&&Gk(n);break;case 21:break;default:Xs(e,n),Mo(n)}}function Mo(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(K4(t)){var r=t;break e}t=t.return}throw Error(Me(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(zg(i,""),r.flags&=-33);var s=Vk(n);Ab(n,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Vk(n);bb(n,a,o);break;default:throw Error(Me(161))}}catch(l){Gn(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function JX(n,e,t){qe=n,q4(n)}function q4(n,e,t){for(var r=(n.mode&1)!==0;qe!==null;){var i=qe,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||U0;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||ni;a=U0;var c=ni;if(U0=o,(ni=l)&&!c)for(qe=i;qe!==null;)o=qe,l=o.child,o.tag===22&&o.memoizedState!==null?Kk(i):l!==null?(l.return=o,qe=l):Kk(i);for(;s!==null;)qe=s,q4(s),s=s.sibling;qe=i,U0=a,ni=c}Wk(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,qe=s):Wk(n)}}function Wk(n){for(;qe!==null;){var e=qe;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ni||Yw(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ni)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:to(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Mk(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Mk(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Gg(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Me(163))}ni||e.flags&512&&Cb(e)}catch(f){Gn(e,e.return,f)}}if(e===n){qe=null;break}if(t=e.sibling,t!==null){t.return=e.return,qe=t;break}qe=e.return}}function Yk(n){for(;qe!==null;){var e=qe;if(e===n){qe=null;break}var t=e.sibling;if(t!==null){t.return=e.return,qe=t;break}qe=e.return}}function Kk(n){for(;qe!==null;){var e=qe;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Yw(4,e)}catch(l){Gn(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){Gn(e,i,l)}}var s=e.return;try{Cb(e)}catch(l){Gn(e,s,l)}break;case 5:var o=e.return;try{Cb(e)}catch(l){Gn(e,o,l)}}}catch(l){Gn(e,e.return,l)}if(e===n){qe=null;break}var a=e.sibling;if(a!==null){a.return=e.return,qe=a;break}qe=e.return}}var eq=Math.ceil,iy=cl.ReactCurrentDispatcher,RM=cl.ReactCurrentOwner,Fs=cl.ReactCurrentBatchConfig,Vt=0,Nr=null,sr=null,jr=0,ss=0,af=kc(0),mr=0,tv=null,id=0,Kw=0,NM=0,mg=null,Ii=null,IM=0,ip=1/0,Ea=null,sy=!1,Mb=null,hc=null,F0=!1,Ql=null,oy=0,gg=0,Rb=null,J_=-1,ex=0;function Si(){return Vt&6?Zn():J_!==-1?J_:J_=Zn()}function fc(n){return n.mode&1?Vt&2&&jr!==0?jr&-jr:UX.transition!==null?(ex===0&&(ex=k5()),ex):(n=an,n!==0||(n=window.event,n=n===void 0?16:z5(n.type)),n):1}function po(n,e,t,r){if(50<gg)throw gg=0,Rb=null,Error(Me(185));Av(n,t,r),(!(Vt&2)||n!==Nr)&&(n===Nr&&(!(Vt&2)&&(Kw|=t),mr===4&&zl(n,jr)),Hi(n,r),t===1&&Vt===0&&!(e.mode&1)&&(ip=Zn()+500,Vw&&Lc()))}function Hi(n,e){var t=n.callbackNode;U$(n,e);var r=Vx(n,n===Nr?jr:0);if(r===0)t!==null&&nk(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&nk(t),e===1)n.tag===0?DX($k.bind(null,n)):s4($k.bind(null,n)),PX(function(){!(Vt&6)&&Lc()}),t=null;else{switch(L5(r)){case 1:t=rM;break;case 4:t=I5;break;case 16:t=Hx;break;case 536870912:t=P5;break;default:t=Hx}t=iF(t,Z4.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function Z4(n,e){if(J_=-1,ex=0,Vt&6)throw Error(Me(327));var t=n.callbackNode;if(Af()&&n.callbackNode!==t)return null;var r=Vx(n,n===Nr?jr:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=ay(n,r);else{e=r;var i=Vt;Vt|=2;var s=J4();(Nr!==n||jr!==e)&&(Ea=null,ip=Zn()+500,ju(n,e));do try{rq();break}catch(a){Q4(n,a)}while(!0);gM(),iy.current=s,Vt=i,sr!==null?e=0:(Nr=null,jr=0,e=mr)}if(e!==0){if(e===2&&(i=nb(n),i!==0&&(r=i,e=Nb(n,i))),e===1)throw t=tv,ju(n,0),zl(n,r),Hi(n,Zn()),t;if(e===6)zl(n,r);else{if(i=n.current.alternate,!(r&30)&&!tq(i)&&(e=ay(n,r),e===2&&(s=nb(n),s!==0&&(r=s,e=Nb(n,s))),e===1))throw t=tv,ju(n,0),zl(n,r),Hi(n,Zn()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(Me(345));case 2:lu(n,Ii,Ea);break;case 3:if(zl(n,r),(r&130023424)===r&&(e=IM+500-Zn(),10<e)){if(Vx(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Si(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=ub(lu.bind(null,n,Ii,Ea),e);break}lu(n,Ii,Ea);break;case 4:if(zl(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var o=31-fo(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Zn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*eq(r/1960))-r,10<r){n.timeoutHandle=ub(lu.bind(null,n,Ii,Ea),r);break}lu(n,Ii,Ea);break;case 5:lu(n,Ii,Ea);break;default:throw Error(Me(329))}}}return Hi(n,Zn()),n.callbackNode===t?Z4.bind(null,n):null}function Nb(n,e){var t=mg;return n.current.memoizedState.isDehydrated&&(ju(n,e).flags|=256),n=ay(n,e),n!==2&&(e=Ii,Ii=t,e!==null&&Ib(e)),n}function Ib(n){Ii===null?Ii=n:Ii.push.apply(Ii,n)}function tq(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!_o(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function zl(n,e){for(e&=~NM,e&=~Kw,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-fo(e),r=1<<t;n[t]=-1,e&=~r}}function $k(n){if(Vt&6)throw Error(Me(327));Af();var e=Vx(n,0);if(!(e&1))return Hi(n,Zn()),null;var t=ay(n,e);if(n.tag!==0&&t===2){var r=nb(n);r!==0&&(e=r,t=Nb(n,r))}if(t===1)throw t=tv,ju(n,0),zl(n,e),Hi(n,Zn()),t;if(t===6)throw Error(Me(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,lu(n,Ii,Ea),Hi(n,Zn()),null}function PM(n,e){var t=Vt;Vt|=1;try{return n(e)}finally{Vt=t,Vt===0&&(ip=Zn()+500,Vw&&Lc())}}function sd(n){Ql!==null&&Ql.tag===0&&!(Vt&6)&&Af();var e=Vt;Vt|=1;var t=Fs.transition,r=an;try{if(Fs.transition=null,an=1,n)return n()}finally{an=r,Fs.transition=t,Vt=e,!(Vt&6)&&Lc()}}function kM(){ss=af.current,Rn(af)}function ju(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,IX(t)),sr!==null)for(t=sr.return;t!==null;){var r=t;switch(fM(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&$x();break;case 3:np(),Rn(zi),Rn(ai),SM();break;case 5:wM(r);break;case 4:np();break;case 13:Rn(jn);break;case 19:Rn(jn);break;case 10:vM(r.type._context);break;case 22:case 23:kM()}t=t.return}if(Nr=n,sr=n=pc(n.current,null),jr=ss=e,mr=0,tv=null,NM=Kw=id=0,Ii=mg=null,Ru!==null){for(e=0;e<Ru.length;e++)if(t=Ru[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}t.pending=r}Ru=null}return n}function Q4(n,e){do{var t=sr;try{if(gM(),q_.current=ry,ny){for(var r=zn.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}ny=!1}if(rd=0,Ar=dr=zn=null,fg=!1,Qg=0,RM.current=null,t===null||t.return===null){mr=1,tv=e,sr=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=jr,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=Ok(o);if(p!==null){p.flags&=-257,Dk(p,o,a,s,e),p.mode&1&&Lk(s,c,e),e=p,l=c;var _=e.updateQueue;if(_===null){var y=new Set;y.add(l),e.updateQueue=y}else _.add(l);break e}else{if(!(e&1)){Lk(s,c,e),LM();break e}l=Error(Me(426))}}else if(Ln&&a.mode&1){var g=Ok(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),Dk(g,o,a,s,e),pM(rp(l,a));break e}}s=l=rp(l,a),mr!==4&&(mr=2),mg===null?mg=[s]:mg.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=O4(s,l,e);Ak(s,m);break e;case 1:a=l;var v=s.type,x=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(hc===null||!hc.has(x)))){s.flags|=65536,e&=-e,s.lanes|=e;var w=D4(s,a,e);Ak(s,w);break e}}s=s.return}while(s!==null)}tF(t)}catch(E){e=E,sr===t&&t!==null&&(sr=t=t.return);continue}break}while(!0)}function J4(){var n=iy.current;return iy.current=ry,n===null?ry:n}function LM(){(mr===0||mr===3||mr===2)&&(mr=4),Nr===null||!(id&268435455)&&!(Kw&268435455)||zl(Nr,jr)}function ay(n,e){var t=Vt;Vt|=2;var r=J4();(Nr!==n||jr!==e)&&(Ea=null,ju(n,e));do try{nq();break}catch(i){Q4(n,i)}while(!0);if(gM(),Vt=t,iy.current=r,sr!==null)throw Error(Me(261));return Nr=null,jr=0,mr}function nq(){for(;sr!==null;)eF(sr)}function rq(){for(;sr!==null&&!M$();)eF(sr)}function eF(n){var e=rF(n.alternate,n,ss);n.memoizedProps=n.pendingProps,e===null?tF(n):sr=e,RM.current=null}function tF(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=qX(t,e),t!==null){t.flags&=32767,sr=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{mr=6,sr=null;return}}else if(t=XX(t,e,ss),t!==null){sr=t;return}if(e=e.sibling,e!==null){sr=e;return}sr=e=n}while(e!==null);mr===0&&(mr=5)}function lu(n,e,t){var r=an,i=Fs.transition;try{Fs.transition=null,an=1,iq(n,e,t,r)}finally{Fs.transition=i,an=r}return null}function iq(n,e,t,r){do Af();while(Ql!==null);if(Vt&6)throw Error(Me(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Me(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(F$(n,s),n===Nr&&(sr=Nr=null,jr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||F0||(F0=!0,iF(Hx,function(){return Af(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Fs.transition,Fs.transition=null;var o=an;an=1;var a=Vt;Vt|=4,RM.current=null,QX(n,t),X4(t,n),TX(lb),Gx=!!ab,lb=ab=null,n.current=t,JX(t),R$(),Vt=a,an=o,Fs.transition=s}else n.current=t;if(F0&&(F0=!1,Ql=n,oy=i),s=n.pendingLanes,s===0&&(hc=null),P$(t.stateNode),Hi(n,Zn()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(sy)throw sy=!1,n=Mb,Mb=null,n;return oy&1&&n.tag!==0&&Af(),s=n.pendingLanes,s&1?n===Rb?gg++:(gg=0,Rb=n):gg=0,Lc(),null}function Af(){if(Ql!==null){var n=L5(oy),e=Fs.transition,t=an;try{if(Fs.transition=null,an=16>n?16:n,Ql===null)var r=!1;else{if(n=Ql,Ql=null,oy=0,Vt&6)throw Error(Me(331));var i=Vt;for(Vt|=4,qe=n.current;qe!==null;){var s=qe,o=s.child;if(qe.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(qe=c;qe!==null;){var u=qe;switch(u.tag){case 0:case 11:case 15:pg(8,u,s)}var h=u.child;if(h!==null)h.return=u,qe=h;else for(;qe!==null;){u=qe;var f=u.sibling,p=u.return;if(Y4(u),u===c){qe=null;break}if(f!==null){f.return=p,qe=f;break}qe=p}}}var _=s.alternate;if(_!==null){var y=_.child;if(y!==null){_.child=null;do{var g=y.sibling;y.sibling=null,y=g}while(y!==null)}}qe=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,qe=o;else e:for(;qe!==null;){if(s=qe,s.flags&2048)switch(s.tag){case 0:case 11:case 15:pg(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,qe=m;break e}qe=s.return}}var v=n.current;for(qe=v;qe!==null;){o=qe;var x=o.child;if(o.subtreeFlags&2064&&x!==null)x.return=o,qe=x;else e:for(o=v;qe!==null;){if(a=qe,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Yw(9,a)}}catch(E){Gn(a,a.return,E)}if(a===o){qe=null;break e}var w=a.sibling;if(w!==null){w.return=a.return,qe=w;break e}qe=a.return}}if(Vt=i,Lc(),Xo&&typeof Xo.onPostCommitFiberRoot=="function")try{Xo.onPostCommitFiberRoot(Fw,n)}catch{}r=!0}return r}finally{an=t,Fs.transition=e}}return!1}function Xk(n,e,t){e=rp(t,e),e=O4(n,e,1),n=dc(n,e,1),e=Si(),n!==null&&(Av(n,1,e),Hi(n,e))}function Gn(n,e,t){if(n.tag===3)Xk(n,n,t);else for(;e!==null;){if(e.tag===3){Xk(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(hc===null||!hc.has(r))){n=rp(t,n),n=D4(e,n,1),e=dc(e,n,1),n=Si(),e!==null&&(Av(e,1,n),Hi(e,n));break}}e=e.return}}function sq(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Si(),n.pingedLanes|=n.suspendedLanes&t,Nr===n&&(jr&t)===t&&(mr===4||mr===3&&(jr&130023424)===jr&&500>Zn()-IM?ju(n,0):NM|=t),Hi(n,e)}function nF(n,e){e===0&&(n.mode&1?(e=M0,M0<<=1,!(M0&130023424)&&(M0=4194304)):e=1);var t=Si();n=Qa(n,e),n!==null&&(Av(n,e,t),Hi(n,t))}function oq(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),nF(n,t)}function aq(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Me(314))}r!==null&&r.delete(e),nF(n,t)}var rF;rF=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||zi.current)Li=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Li=!1,$X(n,e,t);Li=!!(n.flags&131072)}else Li=!1,Ln&&e.flags&1048576&&o4(e,Zx,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Q_(n,e),n=e.pendingProps;var i=Jf(e,ai.current);bf(e,t),i=TM(null,e,r,n,i,t);var s=CM();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Bi(r)?(s=!0,Xx(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,xM(e),i.updater=Gw,e.stateNode=i,i._reactInternals=e,vb(e,r,n,t),e=yb(null,e,r,!0,s,t)):(e.tag=0,Ln&&s&&hM(e),pi(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Q_(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=cq(r),n=to(r,n),i){case 0:e=xb(null,e,r,n,t);break e;case 1:e=jk(null,e,r,n,t);break e;case 11:e=Uk(null,e,r,n,t);break e;case 14:e=Fk(null,e,r,to(r.type,n),t);break e}throw Error(Me(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:to(r,i),xb(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:to(r,i),jk(n,e,r,i,t);case 3:e:{if(z4(e),n===null)throw Error(Me(387));r=e.pendingProps,s=e.memoizedState,i=s.element,u4(n,e),ey(e,r,null,t);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=rp(Error(Me(423)),e),e=zk(n,e,r,t,i);break e}else if(r!==i){i=rp(Error(Me(424)),e),e=zk(n,e,r,t,i);break e}else for(ls=uc(e.stateNode.containerInfo.firstChild),ds=e,Ln=!0,io=null,t=p4(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ep(),r===i){e=Ja(n,e,t);break e}pi(n,e,r,t)}e=e.child}return e;case 5:return m4(e),n===null&&pb(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,o=i.children,cb(r,i)?o=null:s!==null&&cb(r,s)&&(e.flags|=32),j4(n,e),pi(n,e,o,t),e.child;case 6:return n===null&&pb(e),null;case 13:return B4(n,e,t);case 4:return yM(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=tp(e,null,r,t):pi(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:to(r,i),Uk(n,e,r,i,t);case 7:return pi(n,e,e.pendingProps,t),e.child;case 8:return pi(n,e,e.pendingProps.children,t),e.child;case 12:return pi(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,_n(Qx,r._currentValue),r._currentValue=o,s!==null)if(_o(s.value,o)){if(s.children===i.children&&!zi.current){e=Ja(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=ja(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),mb(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Me(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),mb(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}pi(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,bf(e,t),i=Bs(i),r=r(i),e.flags|=1,pi(n,e,r,t),e.child;case 14:return r=e.type,i=to(r,e.pendingProps),i=to(r.type,i),Fk(n,e,r,i,t);case 15:return U4(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:to(r,i),Q_(n,e),e.tag=1,Bi(r)?(n=!0,Xx(e)):n=!1,bf(e,t),h4(e,r,i),vb(e,r,i,t),yb(null,e,r,!0,n,t);case 19:return H4(n,e,t);case 22:return F4(n,e,t)}throw Error(Me(156,e.tag))};function iF(n,e){return N5(n,e)}function lq(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ds(n,e,t,r){return new lq(n,e,t,r)}function OM(n){return n=n.prototype,!(!n||!n.isReactComponent)}function cq(n){if(typeof n=="function")return OM(n)?1:0;if(n!=null){if(n=n.$$typeof,n===eM)return 11;if(n===tM)return 14}return 2}function pc(n,e){var t=n.alternate;return t===null?(t=Ds(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function tx(n,e,t,r,i,s){var o=2;if(r=n,typeof n=="function")OM(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case qh:return zu(t.children,i,s,e);case JA:o=8,i|=8;break;case BC:return n=Ds(12,t,e,i|2),n.elementType=BC,n.lanes=s,n;case HC:return n=Ds(13,t,e,i),n.elementType=HC,n.lanes=s,n;case VC:return n=Ds(19,t,e,i),n.elementType=VC,n.lanes=s,n;case f5:return $w(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case d5:o=10;break e;case h5:o=9;break e;case eM:o=11;break e;case tM:o=14;break e;case Dl:o=16,r=null;break e}throw Error(Me(130,n==null?n:typeof n,""))}return e=Ds(o,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function zu(n,e,t,r){return n=Ds(7,n,r,e),n.lanes=t,n}function $w(n,e,t,r){return n=Ds(22,n,r,e),n.elementType=f5,n.lanes=t,n.stateNode={isHidden:!1},n}function rT(n,e,t){return n=Ds(6,n,null,e),n.lanes=t,n}function iT(n,e,t){return e=Ds(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function uq(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=FE(0),this.expirationTimes=FE(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=FE(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function DM(n,e,t,r,i,s,o,a,l){return n=new uq(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Ds(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},xM(s),n}function dq(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Xh,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function sF(n){if(!n)return Tc;n=n._reactInternals;e:{if(yd(n)!==n||n.tag!==1)throw Error(Me(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Bi(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Me(171))}if(n.tag===1){var t=n.type;if(Bi(t))return i4(n,t,e)}return e}function oF(n,e,t,r,i,s,o,a,l){return n=DM(t,r,!0,n,i,s,o,a,l),n.context=sF(null),t=n.current,r=Si(),i=fc(t),s=ja(r,i),s.callback=e??null,dc(t,s,i),n.current.lanes=i,Av(n,i,r),Hi(n,r),n}function Xw(n,e,t,r){var i=e.current,s=Si(),o=fc(i);return t=sF(t),e.context===null?e.context=t:e.pendingContext=t,e=ja(s,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=dc(i,e,o),n!==null&&(po(n,i,o,s),X_(n,i,o)),o}function ly(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function qk(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function UM(n,e){qk(n,e),(n=n.alternate)&&qk(n,e)}function hq(){return null}var aF=typeof reportError=="function"?reportError:function(n){console.error(n)};function FM(n){this._internalRoot=n}qw.prototype.render=FM.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Me(409));Xw(n,e,null,null)};qw.prototype.unmount=FM.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;sd(function(){Xw(null,n,null,null)}),e[Za]=null}};function qw(n){this._internalRoot=n}qw.prototype.unstable_scheduleHydration=function(n){if(n){var e=U5();n={blockedOn:null,target:n,priority:e};for(var t=0;t<jl.length&&e!==0&&e<jl[t].priority;t++);jl.splice(t,0,n),t===0&&j5(n)}};function jM(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Zw(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Zk(){}function fq(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=ly(o);s.call(c)}}var o=oF(e,r,n,0,null,!1,!1,"",Zk);return n._reactRootContainer=o,n[Za]=o.current,Kg(n.nodeType===8?n.parentNode:n),sd(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=ly(l);a.call(c)}}var l=DM(n,0,!1,null,null,!1,!1,"",Zk);return n._reactRootContainer=l,n[Za]=l.current,Kg(n.nodeType===8?n.parentNode:n),sd(function(){Xw(e,l,t,r)}),l}function Qw(n,e,t,r,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=ly(o);a.call(l)}}Xw(e,o,n,i)}else o=fq(t,e,n,i,r);return ly(o)}O5=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=jm(e.pendingLanes);t!==0&&(iM(e,t|1),Hi(e,Zn()),!(Vt&6)&&(ip=Zn()+500,Lc()))}break;case 13:sd(function(){var r=Qa(n,1);if(r!==null){var i=Si();po(r,n,1,i)}}),UM(n,1)}};sM=function(n){if(n.tag===13){var e=Qa(n,134217728);if(e!==null){var t=Si();po(e,n,134217728,t)}UM(n,134217728)}};D5=function(n){if(n.tag===13){var e=fc(n),t=Qa(n,e);if(t!==null){var r=Si();po(t,n,e,r)}UM(n,e)}};U5=function(){return an};F5=function(n,e){var t=an;try{return an=n,e()}finally{an=t}};JC=function(n,e,t){switch(e){case"input":if(YC(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=Hw(r);if(!i)throw Error(Me(90));m5(r),YC(r,i)}}}break;case"textarea":v5(n,t);break;case"select":e=t.value,e!=null&&Sf(n,!!t.multiple,e,!1)}};T5=PM;C5=sd;var pq={usingClientEntryPoint:!1,Events:[Rv,ef,Hw,S5,E5,PM]},tm={findFiberByHostInstance:Mu,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},mq={bundleType:tm.bundleType,version:tm.version,rendererPackageName:tm.rendererPackageName,rendererConfig:tm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:cl.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=M5(n),n===null?null:n.stateNode},findFiberByHostInstance:tm.findFiberByHostInstance||hq,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var j0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!j0.isDisabled&&j0.supportsFiber)try{Fw=j0.inject(mq),Xo=j0}catch{}}vs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pq;vs.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!jM(e))throw Error(Me(200));return dq(n,e,null,t)};vs.createRoot=function(n,e){if(!jM(n))throw Error(Me(299));var t=!1,r="",i=aF;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=DM(n,1,!1,null,null,t,!1,r,i),n[Za]=e.current,Kg(n.nodeType===8?n.parentNode:n),new FM(e)};vs.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Me(188)):(n=Object.keys(n).join(","),Error(Me(268,n)));return n=M5(e),n=n===null?null:n.stateNode,n};vs.flushSync=function(n){return sd(n)};vs.hydrate=function(n,e,t){if(!Zw(e))throw Error(Me(200));return Qw(null,n,e,!0,t)};vs.hydrateRoot=function(n,e,t){if(!jM(n))throw Error(Me(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",o=aF;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=oF(e,null,n,1,t??null,i,!1,s,o),n[Za]=e.current,Kg(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new qw(e)};vs.render=function(n,e,t){if(!Zw(e))throw Error(Me(200));return Qw(null,n,e,!1,t)};vs.unmountComponentAtNode=function(n){if(!Zw(n))throw Error(Me(40));return n._reactRootContainer?(sd(function(){Qw(null,null,n,!1,function(){n._reactRootContainer=null,n[Za]=null})}),!0):!1};vs.unstable_batchedUpdates=PM;vs.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Zw(t))throw Error(Me(200));if(n==null||n._reactInternals===void 0)throw Error(Me(38));return Qw(n,e,t,!1,r)};vs.version="18.2.0-next-9e3b772b8-20220608";function lF(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(lF)}catch(n){console.error(n)}}lF(),o5.exports=vs;var li=o5.exports;function gq(){const n=[];for(let e=0;e<70;e++)n.push({key:e,no:e});return n}const nm=gq();let xl=0,Lh=null;function vq(n){Lh=n}let Qk=null;function _q(n){const[e,t]=ee.useState(!1),r=mn().treeViewWidth,[i,s]=ee.useState(xl),o=n.rowheight,a=n.length;Lh!==null&&(clearTimeout(Qk),Qk=setTimeout(()=>{if(typeof Lh=="number"){xl=Lh*o;const u=document.getElementById("scroller");u&&(Lh===0&&(nm.forEach((h,f)=>{h.no=f}),t(!e)),xl>u.scrollTop+u.offsetHeight&&s(xl-u.offsetHeight/2),xl<u.scrollTop&&s(xl-u.offsetHeight/2)),Lh=null}})),ee.useEffect(()=>{const u=document.getElementById("scroller");u&&(u.scrollTop=i)});function l(u){li.flushSync(()=>{const h=u.target,f=Math.floor(h.scrollTop/o),p=h.scrollTop>xl;xl=h.scrollTop,p?nm.sort((_,y)=>_.no<y.no?-1:1):nm.sort((_,y)=>_.no<y.no?1:-1),nm.forEach((_,y)=>{_.no=f+y}),t(!e),s(h.scrollTop)})}function c(u){const h=u.clientX;function f(_){var m;let y=_.clientX;(m=_.changedTouches)!=null&&m[0]&&(y=_.changedTouches[0].clientX);const g=y-h;mn.setState({treeViewWidth:r+g})}function p(){window.removeEventListener("mouseup",p),window.removeEventListener("mousemove",f),window.removeEventListener("touchend",p),window.removeEventListener("touchmove",f)}window.addEventListener("mouseup",p),window.addEventListener("mousemove",f),window.addEventListener("touchend",p),window.addEventListener("touchmove",f)}return d.jsx("div",{id:"scroller",onScroll:l,className:"threeView-container scrollbar bg-gray-800 pt-1 pointer-events-auto border-t border-gray-900",style:{overflow:"auto",width:`${r}px`},children:d.jsxs("div",{className:"threeView-body",style:{height:`${a*o}px`,overflow:"hidden",position:"relative"},children:[d.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-[10px] cursor-col-resize z-30 pointer-events-auto",onPointerDown:c}),nm.map(u=>{const h={position:"absolute",transform:`translate3d(0px, ${u.no*o}px, 0px)`,height:`${o}px`,display:"block",overflow:"hidden",width:"100%"};return d.jsx("div",{style:h,className:"threeView-row hover:bg-gray-700",children:n.addRowElements(u)},u.key)})]})})}const Mt=Ir(n=>({update:!1,updateToggel:(e=null)=>{vq(e),n(t=>({update:!t.update}))}})),cy=new Set;let cF;function xq(){return cF}function yq(n){return cF=n,new Promise(async e=>{Array.from(cy).forEach(r=>{r.handleEvent&&(r.handleEvent(n)||cy.delete(r))}),e(null)})}const Kc=new qU,Xr=new N,yl=new N,Pn=new Wn,Jk={X:new N(1,0,0),Y:new N(0,1,0),Z:new N(0,0,1)},sT={type:"change"},eL={type:"mouseDown"},tL={type:"mouseUp",mode:null},nL={type:"objectChange"};class uF extends ar{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const r=new bq;this._gizmo=r,this.add(r);const i=new Aq;this._plane=i,this.add(i);const s=this;function o(v,x){let w=x;Object.defineProperty(s,v,{get:function(){return w!==void 0?w:x},set:function(E){w!==E&&(w=E,i[v]=E,r[v]=E,s.dispatchEvent({type:v+"-changed",value:E}),s.dispatchEvent(sT))}}),s[v]=x,i[v]=x,r[v]=x}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new N,l=new N,c=new Wn,u=new Wn,h=new N,f=new Wn,p=new N,_=new N,y=new N,g=0,m=new N;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",c),o("worldQuaternionStart",u),o("cameraPosition",h),o("cameraQuaternion",f),o("pointStart",p),o("pointEnd",_),o("rotationAxis",y),o("rotationAngle",g),o("eye",m),this._offset=new N,this._startNorm=new N,this._endNorm=new N,this._cameraScale=new N,this._parentPosition=new N,this._parentQuaternion=new Wn,this._parentQuaternionInv=new Wn,this._parentScale=new N,this._worldScaleStart=new N,this._worldQuaternionInv=new Wn,this._worldScale=new N,this._positionStart=new N,this._quaternionStart=new Wn,this._scaleStart=new N,this._getPointer=wq.bind(this),this._onPointerDown=Eq.bind(this),this._onPointerHover=Sq.bind(this),this._onPointerMove=Tq.bind(this),this._onPointerUp=Cq.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&Kc.setFromCamera(e,this.camera);const t=oT(this._gizmo.picker[this.mode],Kc);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&Kc.setFromCamera(e,this.camera);const t=oT(this._plane,Kc,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,eL.mode=this.mode,this.dispatchEvent(eL)}}pointerMove(e){const t=this.axis,r=this.mode,i=this.object;let s=this.space;if(r==="scale"?s="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(s="world"),i===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&Kc.setFromCamera(e,this.camera);const o=oT(this._plane,Kc,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),r==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),s==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),s==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(s==="local"&&(i.position.applyQuaternion(Pn.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),s==="world"&&(i.parent&&i.position.add(Xr.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Xr.setFromMatrixPosition(i.parent.matrixWorld))));else if(r==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),yl.set(a,a,a)}else Xr.copy(this.pointStart),yl.copy(this.pointEnd),Xr.applyQuaternion(this._worldQuaternionInv),yl.applyQuaternion(this._worldQuaternionInv),yl.divide(Xr),t.search("X")===-1&&(yl.x=1),t.search("Y")===-1&&(yl.y=1),t.search("Z")===-1&&(yl.z=1);i.scale.copy(this._scaleStart).multiply(yl),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(r==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(Xr.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Xr.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Jk[t]),Xr.copy(Jk[t]),s==="local"&&Xr.applyQuaternion(this.worldQuaternion),Xr.cross(this.eye),Xr.length()===0?l=!0:this.rotationAngle=this._offset.dot(Xr.normalize())*a),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),s==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Pn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Pn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(sT),this.dispatchEvent(nL)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(tL.mode=this.mode,this.dispatchEvent(tL)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(sT),this.dispatchEvent(nL),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Kc}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function wq(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const e=this.domElement.getBoundingClientRect();return{x:(n.clientX-e.left)/e.width*2-1,y:-(n.clientY-e.top)/e.height*2+1,button:n.button}}}function Sq(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function Eq(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function Tq(n){this.enabled&&this.pointerMove(this._getPointer(n))}function Cq(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function oT(n,e,t){const r=e.intersectObject(n,!0);for(let i=0;i<r.length;i++)if(r[i].object.visible||t)return r[i];return!1}const z0=new vo,fn=new N(0,1,0),rL=new N(0,0,0),iL=new ot,B0=new Wn,nx=new Wn,Ro=new N,sL=new ot,Bm=new N(1,0,0),cu=new N(0,1,0),Hm=new N(0,0,1),H0=new N,rm=new N,im=new N;class bq extends ar{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new al({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new ll({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;const i=t.clone();i.opacity=.5;const s=e.clone();s.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const h=e.clone();h.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const _=e.clone();_.color.setHex(7895160);const y=new Or(0,.04,.1,12);y.translate(0,.05,0);const g=new En(.08,.08,.08);g.translate(0,.04,0);const m=new xn;m.setAttribute("position",new Wt([0,0,0,1,0,0],3));const v=new Or(.0075,.0075,.5,3);v.translate(0,.25,0);function x(I,j){const O=new _u(I,.0075,3,64,j*Math.PI*2);return O.rotateY(Math.PI/2),O.rotateX(Math.PI/2),O}function w(){const I=new xn;return I.setAttribute("position",new Wt([0,0,0,1,1,1],3)),I}const E={X:[[new Be(y,s),[.5,0,0],[0,0,-Math.PI/2]],[new Be(y,s),[-.5,0,0],[0,0,Math.PI/2]],[new Be(v,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Be(y,o),[0,.5,0]],[new Be(y,o),[0,-.5,0],[Math.PI,0,0]],[new Be(v,o)]],Z:[[new Be(y,a),[0,0,.5],[Math.PI/2,0,0]],[new Be(y,a),[0,0,-.5],[-Math.PI/2,0,0]],[new Be(v,a),null,[Math.PI/2,0,0]]],XYZ:[[new Be(new $h(.1,0),h.clone()),[0,0,0]]],XY:[[new Be(new En(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new Be(new En(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Be(new En(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},S={X:[[new Be(new Or(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new Be(new Or(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Be(new Or(.2,0,.6,4),r),[0,.3,0]],[new Be(new Or(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Be(new Or(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new Be(new Or(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Be(new $h(.2,0),r)]],XY:[[new Be(new En(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new Be(new En(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Be(new En(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},C={START:[[new Be(new $h(.01,2),i),null,null,null,"helper"]],END:[[new Be(new $h(.01,2),i),null,null,null,"helper"]],DELTA:[[new As(w(),i),null,null,null,"helper"]],X:[[new As(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new As(m,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new As(m,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={XYZE:[[new Be(x(.5,1),_),null,[0,Math.PI/2,0]]],X:[[new Be(x(.5,.5),s)]],Y:[[new Be(x(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new Be(x(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new Be(x(.75,1),f),null,[0,Math.PI/2,0]]]},k={AXIS:[[new As(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},T={XYZE:[[new Be(new YA(.25,10,8),r)]],X:[[new Be(new _u(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Be(new _u(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Be(new _u(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Be(new _u(.75,.1,2,24),r)]]},R={X:[[new Be(g,s),[.5,0,0],[0,0,-Math.PI/2]],[new Be(v,s),[0,0,0],[0,0,-Math.PI/2]],[new Be(g,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Be(g,o),[0,.5,0]],[new Be(v,o)],[new Be(g,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Be(g,a),[0,0,.5],[Math.PI/2,0,0]],[new Be(v,a),[0,0,0],[Math.PI/2,0,0]],[new Be(g,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Be(new En(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new Be(new En(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Be(new En(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Be(new En(.1,.1,.1),h.clone())]]},$={X:[[new Be(new Or(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new Be(new Or(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Be(new Or(.2,0,.6,4),r),[0,.3,0]],[new Be(new Or(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Be(new Or(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new Be(new Or(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Be(new En(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new Be(new En(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Be(new En(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Be(new En(.2,.2,.2),r),[0,0,0]]]},P={X:[[new As(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new As(m,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new As(m,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function M(I){const j=new ar;for(const O in I)for(let z=I[O].length;z--;){const B=I[O][z][0].clone(),L=I[O][z][1],D=I[O][z][2],W=I[O][z][3],H=I[O][z][4];B.name=O,B.tag=H,L&&B.position.set(L[0],L[1],L[2]),D&&B.rotation.set(D[0],D[1],D[2]),W&&B.scale.set(W[0],W[1],W[2]),B.updateMatrix();const K=B.geometry.clone();K.applyMatrix4(B.matrix),B.geometry=K,B.renderOrder=1/0,B.position.set(0,0,0),B.rotation.set(0,0,0),B.scale.set(1,1,1),j.add(B)}return j}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=M(E)),this.add(this.gizmo.rotate=M(A)),this.add(this.gizmo.scale=M(R)),this.add(this.picker.translate=M(S)),this.add(this.picker.rotate=M(T)),this.add(this.picker.scale=M($)),this.add(this.helper.translate=M(C)),this.add(this.helper.rotate=M(k)),this.add(this.helper.scale=M(P)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const r=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:nx;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let s=0;s<i.length;s++){const o=i[s];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(Pn.setFromEuler(z0.set(0,0,0)),o.quaternion.copy(r).multiply(Pn),Math.abs(fn.copy(Bm).applyQuaternion(r).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Pn.setFromEuler(z0.set(0,0,Math.PI/2)),o.quaternion.copy(r).multiply(Pn),Math.abs(fn.copy(cu).applyQuaternion(r).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Pn.setFromEuler(z0.set(0,Math.PI/2,0)),o.quaternion.copy(r).multiply(Pn),Math.abs(fn.copy(Hm).applyQuaternion(r).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Pn.setFromEuler(z0.set(0,Math.PI/2,0)),fn.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(iL.lookAt(rL,fn,cu)),o.quaternion.multiply(Pn),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Xr.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Xr.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Xr),o.visible=this.dragging):(o.quaternion.copy(r),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(r),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(fn.copy(Bm).applyQuaternion(r).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(fn.copy(cu).applyQuaternion(r).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(fn.copy(Hm).applyQuaternion(r).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(fn.copy(Hm).applyQuaternion(r).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(fn.copy(Bm).applyQuaternion(r).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(fn.copy(cu).applyQuaternion(r).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(B0.copy(r),fn.copy(this.eye).applyQuaternion(Pn.copy(r).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(iL.lookAt(this.eye,rL,cu)),o.name==="X"&&(Pn.setFromAxisAngle(Bm,Math.atan2(-fn.y,fn.z)),Pn.multiplyQuaternions(B0,Pn),o.quaternion.copy(Pn)),o.name==="Y"&&(Pn.setFromAxisAngle(cu,Math.atan2(fn.x,fn.z)),Pn.multiplyQuaternions(B0,Pn),o.quaternion.copy(Pn)),o.name==="Z"&&(Pn.setFromAxisAngle(Hm,Math.atan2(fn.y,fn.x)),Pn.multiplyQuaternions(B0,Pn),o.quaternion.copy(Pn))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}class Aq extends Be{constructor(){super(new Rp(1e5,1e5,2,2),new al({visible:!1,wireframe:!0,side:gi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),H0.copy(Bm).applyQuaternion(t==="local"?this.worldQuaternion:nx),rm.copy(cu).applyQuaternion(t==="local"?this.worldQuaternion:nx),im.copy(Hm).applyQuaternion(t==="local"?this.worldQuaternion:nx),fn.copy(rm),this.mode){case"translate":case"scale":switch(this.axis){case"X":fn.copy(this.eye).cross(H0),Ro.copy(H0).cross(fn);break;case"Y":fn.copy(this.eye).cross(rm),Ro.copy(rm).cross(fn);break;case"Z":fn.copy(this.eye).cross(im),Ro.copy(im).cross(fn);break;case"XY":Ro.copy(im);break;case"YZ":Ro.copy(H0);break;case"XZ":fn.copy(im),Ro.copy(rm);break;case"XYZ":case"E":Ro.set(0,0,0);break}break;case"rotate":default:Ro.set(0,0,0)}Ro.length()===0?this.quaternion.copy(this.cameraQuaternion):(sL.lookAt(Xr.set(0,0,0),Ro,fn),this.quaternion.setFromRotationMatrix(sL)),super.updateMatrixWorld(e)}}const Jr=Ir(()=>({mode:"translate",enabled:!1,helperEnabled:!0,minX:0,minY:0,minZ:0,maxX:0,maxY:0,maxZ:0}));function Mq(n){cy.delete(n)}function Rq(n){cy.add(n)}class Nq{constructor(){Q(this,"controls");Q(this,"selectionMap",new Map);Q(this,"originalPosition");Q(this,"originalRotation");Q(this,"transform");Q(this,"isProcessing",!1);Q(this,"originalScale")}toggleMode(e){this.controls&&this.controls.setMode(e)}async resizeToSelected(){const e=await ae.get_bounding_box_from_selection();Jr.setState({minX:e.x,minY:e.y,minZ:e.z,maxX:e.X,maxY:e.Y,maxZ:e.Z}),F().forceRenderNextFrame()}toggleHelper(){const t=!Jr.getState().helperEnabled;Jr.setState({helperEnabled:t}),this.updateClippingHelper()}handleEvent(e){return this.selectionMap=e,this.resizeToSelected().then(()=>{this.updateClippingHelper()}),!0}enable(){Jr.setState({enabled:!0}),Rq(this),this.resizeToSelected().then(()=>{this.updateClippingHelper()}),this.handleEvent(xq())}disable(){Jr.setState({enabled:!1}),Mq(this),this.updateClippingHelper()}updateClippingHelper(){let e=Jr.getState();const t=e.enabled;if(F().getSceneController().clearModelGroup("ITEM_TRANSFORM"),F().getSceneController().clearModelGroup("ITEM_CONTROLS"),this.controls&&(this.controls.dispose(),this.controls=null),t){const r=new et(new N(e.minX,e.minY,e.minZ),new N(e.maxX,e.maxY,e.maxZ)),i=new En(Math.abs(e.maxX-e.minX),Math.abs(e.maxY-e.minY),Math.abs(e.maxZ-e.minZ)),s=new ll({color:"yellow",linewidth:5,depthTest:!0,linecap:"round",linejoin:"round"}),o=new WU(i),a=new Cv(o,s);a.setPicking=c=>{a.visible=!c},r.getCenter(a.position),this.originalPosition=a.position.clone();const l=new Wn;a.getWorldQuaternion(l),this.originalRotation=l,this.originalScale=a.scale.clone(),F().getSceneController().addMeshToScene(a,"ITEM_TRANSFORM"),this.controls=new uF(F().getActiveCamera(),F().getRender().domElement),this.controls.addEventListener("change",()=>{if(this.isProcessing)return;const c=new et().setFromObject(a);Jr.setState({minX:c.min.x,minY:c.min.y,minZ:c.min.z,maxX:c.max.x,maxY:c.max.y,maxZ:c.max.z}),e=Jr.getState(),this.selectionMap.forEach((u,h)=>{const f=F().getSceneController().getIndexMesh(h);u[0].forEach(p=>{if(p.is_sel){const _=f==null?void 0:f.$getMeshMaterialFromRange(p.material_index,p.transformation,p.is_sel);if(_!=null&&_.$shader){const g=_.$shader.uniforms.transform.value,m=a.position.x-this.originalPosition.x,v=a.position.y-this.originalPosition.y,x=a.position.z-this.originalPosition.z,w=1+(a.scale.x-this.originalScale.x),E=1+(a.scale.y-this.originalScale.y),S=1+(a.scale.z-this.originalScale.z),C=new Wn;a.getWorldQuaternion(C),C.multiply(this.originalRotation.clone().conjugate());const A=new ot().makeTranslation(this.originalPosition),k=new ot().makeRotationFromQuaternion(C),T=new ot().makeTranslation(this.originalPosition.clone().negate()),R=new ot().makeScale(w,E,S),$=new ot().makeTranslation(new N(m,v,x)),P=new ot;P.multiply(A),P.multiply(R),P.multiply(T),P.multiply(A),P.multiply(k),P.multiply(T),P.multiply($),P.elements.forEach((M,I)=>{g.elements[I]=M}),this.transform=P}}})}),F().forceRenderNextFrame()}),this.controls.setSize(.5),this.controls.addEventListener("mouseDown",function(){const c=F().getActiveControls();c.enabled=!1,c.saveState()}),this.controls.addEventListener("mouseUp",async()=>{var p;const c=F().getActiveControls();c.enabled=!0,c.saveState();let u=!1;const h=new Wn;if(a.getWorldQuaternion(h),this.originalRotation.x!==h.x&&(u=!0),this.originalRotation.y!==h.y&&(u=!0),this.originalRotation.z!==h.z&&(u=!0),this.originalRotation.w!==h.w&&(u=!0),this.originalRotation=h,this.originalPosition.x!==a.position.x&&(u=!0),this.originalPosition.y!==a.position.y&&(u=!0),this.originalPosition.z!==a.position.z&&(u=!0),this.originalPosition.x=a.position.x,this.originalPosition.y=a.position.y,this.originalPosition.z=a.position.z,this.originalScale.x!==a.scale.x&&(u=!0),this.originalScale.y!==a.scale.y&&(u=!0),this.originalScale.z!==a.scale.z&&(u=!0),this.originalScale.x=a.scale.x,this.originalScale.y=a.scale.y,this.originalScale.z=a.scale.z,!u)return;this.selectionMap.forEach((_,y)=>{const g=F().getSceneController().getIndexMesh(y);_[0].forEach(m=>{if(m.is_sel){const v=g==null?void 0:g.$getMeshMaterialFromRange(m.material_index,m.transformation,m.is_sel);if(v!=null&&v.$shader){const x=v.$shader;x.uniforms.transform.value=new ot}}})});const f=this.transform.elements;this.isProcessing=!0,this.selectionMap=await ae.selection_save_transformation(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]),((p=this.controls)==null?void 0:p.mode)==="scale"&&(xo.disable(),xo.enable()),this.isProcessing=!1}),this.controls.attach(a),this.controls.setMode(e.mode),this.controls.enabled=!0,F().getSceneController().addMeshToScene(this.controls,"ITEM_CONTROLS")}F().forceRenderNextFrame()}}const xo=new Nq,Xe=Ir(()=>({enabled:!1,transformHelperEnabled:!1,lineHelperEnabled:!0,axisHelperEnabled:!1,inverted:!1,minX:0,minY:0,minZ:0,maxX:0,maxY:0,maxZ:0}));async function zM(){const n=F();if(n){const e=We.getState(),t=n.getActiveCamera();if(e.freezeCurrentCulling)return;await ae.cull_items(t.projectionMatrix,t.matrixWorldInverse,e.cullingDistance,e.cullingSize,t.position.clone(),e.occlusionCulling?n.getSceneController().getOccludedVolume_IDs():new Uint32Array,e.skipFustrumCulling)}}function Iq(n=20){return new Promise(e=>{setTimeout(()=>{e()},n)})}function oL(){return new Promise(n=>{requestAnimationFrame(()=>{n()})})}var wv;class Pq{constructor(){Q(this,"dataStore");Q(this,"rows_local_cache",[]);Q(this,"isWorking",0);Q(this,"updateIndexes",new Set);YS(this,wv,!1);this.getStore()}showSelectionColor(){return qv(this,wv)}async getStore(){if(!this.dataStore){const e=new t$,t=bv(e);this.dataStore=await new t}return this.dataStore}async meshes_set_mesh_as_loaded(e,t,r){return await(await this.getStore()).meshes_set_mesh_as_loaded(e,t,r)}async getBoundingBoxFromName(e,t){return await(await this.getStore()).getBoundingBoxFromName(e,t)}async update_hidden_groups(){const t=await(await this.getStore()).update_hidden_groups();this.updateMaterial(t)}async get_fullnames_from_selection(e=!1){return await(await this.getStore()).get_fullnames_from_selection(e)}async getBoundingBoxFromKey(e){return await(await this.getStore()).getBoundingBoxFromKey(e)}async getBoundingBoxFromKeys(e){return await(await this.getStore()).getBoundingBoxFromKeys(e)}async get_bounding_box_from_selection(e=!1){return await(await this.getStore()).get_bounding_box_from_selection(e)}async all_sites_loaded(){await(await this.getStore()).all_sites_loaded()}async selection_save_transformation(e,t,r,i,s,o,a,l,c,u,h,f,p,_,y,g){const v=await(await this.getStore()).selection_save_transformation(e,t,r,i,s,o,a,l,c,u,h,f,p,_,y,g);return this.updateMaterial(v,!0),v}async filterFullname(e,t=0,r=5){return await(await this.getStore()).filterFullname(e,t,r)}async add_model_groups(e,t){await(await this.getStore()).add_model_groups(e,t)}async getKeyChildrenFromItem(e){return await(await this.getStore()).get_all_ids_from_ids(e)}async clear(){await(await this.getStore()).clear(),this.rows_local_cache=[]}length(){return this.rows_local_cache.length}async selection_is_hidden(e){return await(await this.getStore()).selection_is_hidden(e)}async undo_transform(){const t=await(await this.getStore()).undo_transform();this.updateMaterial(t,!0)}async selection_is_selected(e){return await(await this.getStore()).selection_is_selected(e)}async selection_add(e,t=!1){return await(await this.getStore()).selection_add(e,t)}async selection_remove(e){return await(await this.getStore()).selection_remove(e)}async selection_clear(e=!1){return await(await this.getStore()).selection_clear(e)}async unhide_all(){const e=await this.getStore(),t=await e.unhide_all();console.log("unhide all",t),this.updateMaterial(t,!0),this.rows_local_cache=await e.treeview_get_local_cache()}async selection_reset(e,t,r,i){const s=await this.getStore(),o=await s.selection_reset(e,t,r,i);this.updateMaterial(o,t||r),this.rows_local_cache=await s.treeview_get_local_cache()}async selection_show_only_selected(e){const r=await(await this.getStore()).selection_show_only_selected(e);this.updateMaterial(r)}async selection_allow_selection_of_hidden(e){await(await this.getStore()).selection_allow_selection_of_hidden(e)}async reset_culling_all_meshes(){if(!this.isWorking)try{this.isWorking=1;const t=await(await this.getStore()).reset_culling_all_meshes();this.updateMaterial(t),this.isWorking=0}catch(e){console.log(e),this.isWorking=0}}async get_bounding_boxes_from_selection(){return await(await this.getStore()).get_bounding_boxes_from_selection()}async set_occlusion_boxes(e){(await this.getStore()).set_occlusion_boxes(e)}async cull_items(e,t,r,i,s,o,a){if(this.isWorking===0)try{this.isWorking=1;const c=Xe.getState(),u=c.enabled&&new et().setFromArray([c.minX,c.minY,c.minZ,c.maxX,c.maxY,c.maxZ]),f=await(await this.getStore()).cull_items(e,t,r,i,s,o,u,a);await this.updateMaterialAsync(f),this.isWorking>1?(this.isWorking=0,zM()):this.isWorking=0}catch{this.isWorking=0}else this.isWorking=this.isWorking+1}updateMaterial(e,t=!1){KS(this,wv,t),t&&yq(e),Array.from(e.keys()).forEach(i=>this.updateIndexes.delete(i)),e.forEach(([i,s,o],a)=>{const c=F().getSceneController().getIndexMesh(a);c==null||c.$updateGroups(i,s,o)}),F().forceRenderNextFrame()}waitAnimation(){}updateMaterialAsyncInternal(e,t,r,i){const o=F().getSceneController().getIndexMesh(i);o==null||o.$updateGroups(e,t,r)}async updateMaterialAsync(e){const t=Array.from(e.keys()),r=Array.from(e.values());this.updateIndexes=new Set(t),await oL();let i=performance.now();for(let s=0;s<t.length;s++){const o=t[s],[a,l,c]=r[s];performance.now()-i>10&&(await oL(),i=performance.now()),this.updateIndexes.has(o)&&(this.updateIndexes.delete(o),this.updateMaterialAsyncInternal(a,l,c,o))}F().forceRenderNextFrame()}async selection_set_color(e){const t=await this.getStore(),r=await t.selection_set_color(e);this.updateMaterial(r),this.rows_local_cache=await t.treeview_get_local_cache()}async selection_invert(){const e=await this.getStore(),t=await e.selection_invert();this.updateMaterial(t,!0),this.rows_local_cache=await e.treeview_get_local_cache()}async selection_append(){const e=await this.getStore(),t=await e.selection_append();this.updateMaterial(t,!0),this.rows_local_cache=await e.treeview_get_local_cache()}async meta_find_key_from_face_index(e,t){return await(await this.getStore()).meta_find_key_from_face_index(e,t)}async treeview_collapse(){await(await this.getStore()).treeview_collapse(),await this.treeview_reset_rows(),Mt.getState().updateToggel()}async treeview_reset_rows(){const e=await this.getStore();await e.treeview_reset_rows(),this.rows_local_cache=await e.treeview_get_local_cache()}async get_ids_from_fullnames(e){return await(await this.getStore()).get_ids_from_fullnames(e)}async get_fullname_from_keys(e,t=!1){return await(await this.getStore()).get_fullname_from_keys(e,t)}getRow(e){return this.rows_local_cache[e]?this.rows_local_cache[e]:null}getRowOfKey(e){let t=null;for(let r=0;r<this.rows_local_cache.length;r++)if(this.rows_local_cache[r].key===e){t=r;break}return t}async getDataExt(e){return await(await this.getStore()).getDataExt(e)}async treeview_toggle_id(e){const t=await this.getStore();await t.treeview_toggle_id(e),this.rows_local_cache=await t.treeview_get_local_cache()}async treeview_expand_from_id(e){const t=await this.getStore();await t.treeview_expand_from_id(e),this.rows_local_cache=await t.treeview_get_local_cache()}async filter_geometry(e,t){return xo.disable(),await(await this.getStore()).filter_geometry(e,t)}}wv=new WeakMap;const ae=new Pq;class kq{constructor(e){Q(this,"__scene");Q(this,"__ambientLight");Q(this,"__pointLight");Q(this,"__gridHelper");Q(this,"__mainObjects",[]);Q(this,"__occludeTesters",[]);Q(this,"__occludedVolumes",new Map);Q(this,"__meshes",[]);Q(this,"__meshesGroups",{});Q(this,"__meshIndexes",new Map);Q(this,"__planeHelpers",[]);Q(this,"__selectionListeners",new Set);Q(this,"sceneBoundingBox",{max:null,min:null});Q(this,"toolsController");Q(this,"__occludeBoxes",[]);Q(this,"allwaysOcclude",!1);this.canvasController=e,this.__addScene(),this.__addLights(),this.__addPlane(),this.toolsController=new e$}showOccludeVolumes(){this.__occludeTesters.forEach(e=>{Array.isArray(e.material)||(e.material.colorWrite=!0,e.material.depthWrite=!0)})}hideOccludeVolumes(){this.__occludeTesters.forEach(e=>{Array.isArray(e.material)||(e.material.colorWrite=!1,e.material.depthWrite=!1)})}getOccluders(){return this.__occludeBoxes}clearOccluders(){this.__occludeBoxes=[],this.__occludedVolumes.clear(),this.__occludeTesters.forEach(e=>{this.__scene.remove(e)})}forceOccludeOn(e){this.__occludedVolumes.clear(),this.allwaysOcclude=e,e&&this.__occludeBoxes.forEach((t,r)=>{this.__occludedVolumes.set(r,t)})}getOccludedVolume_IDs(){return new Uint32Array(this.__occludedVolumes.keys())}getOccludedVolumes(){const e=[];return this.__occludedVolumes.forEach(t=>{t.min.toArray().forEach(r=>{e.push(r)}),t.max.toArray().forEach(r=>{e.push(r)})}),new Float32Array(e)}getCurrentOccludeBoxes(){return this.__occludeBoxes}addOccludeTesters(e){this.__occludeBoxes=e;const t=[];e.forEach(r=>{t.push(r.min.x),t.push(r.min.y),t.push(r.min.z),t.push(r.max.x),t.push(r.max.y),t.push(r.max.z)}),ae.set_occlusion_boxes(t),this.__occludedVolumes.clear(),this.__occludeTesters.forEach(r=>{this.__scene.remove(r)}),this.__occludeTesters=[],e.forEach((r,i)=>{const s=new N;r.getCenter(s);const o=new N;r.getSize(o);const a=new En(o.x,o.y,o.z),l=new al({color:new at().setHex(Math.random()*16777215),visible:!0,side:gi,colorWrite:!1,depthWrite:!1}),c=new Be(a,l);c.position.copy(s),c.renderOrder=10,c.onBeforeRender=(u,h,f,p)=>{const _=p;if(_.enabled=We.getState().occlusionCulling,_.enabled?_.drawRange.count=1/0:_.drawRange.count=0,this.allwaysOcclude)return;const y=u.getContext();if(_.enabled&&!_.query&&(_.query=y.createQuery()),_.enabled&&_.query&&_.queryInProgress&&y.getQueryParameter(_.query,y.QUERY_RESULT_AVAILABLE)){if(_.occluded=!y.getQueryParameter(_.query,y.QUERY_RESULT),_.occluded&&!this.__occludedVolumes.has(i)){const g=F().getActiveCamera();r.containsPoint(g.position)||this.__occludedVolumes.set(i,r)}_.occluded||this.__occludedVolumes.delete(i),_.queryInProgress=!1}_.enabled&&!_.queryInProgress&&_.query&&y.beginQuery(y.ANY_SAMPLES_PASSED_CONSERVATIVE,_.query)},c.onAfterRender=function(u,h,f,p){const _=p;if(_.allwaysOcclude)return;const y=u.getContext();_.enabled&&!_.queryInProgress&&(_.queryInProgress=!0,y.endQuery(y.ANY_SAMPLES_PASSED_CONSERVATIVE))},this.__occludeTesters.push(c),this.__scene.add(c)})}__addScene(){this.__scene=new Lx,this.__scene.background=new at(We.getState().backgroundColor)}__addLights(){const e=new MK(14540287,We.getState().lightPoint,0,0);e.position.x=0,e.position.y=0,e.position.z=0,this.__scene.add(e),this.__pointLight=e,this.__ambientLight=new RK(16777198,We.getState().lightAmbient),this.__mainObjects.push(this.__ambientLight),this.__scene.add(this.__ambientLight)}__addPlane(e=100,t=50){this.__gridHelper=new zK(e,t),this.__gridHelper.rotateX(-Math.PI/2),this.__mainObjects.push(this.__gridHelper),this.__scene.add(this.__gridHelper),this.__gridHelper.visible=!1}clearScene(){this.__meshes.forEach(e=>{var t,r;(t=e==null?void 0:e.geometry)==null||t.dispose(),(r=e==null?void 0:e.$geometry)==null||r.dispose(),e.remove(),e.__modelDBKeyIndex&&this.__meshIndexes.delete(e.__modelDBKeyIndex),this.__scene.remove(e)}),this.__meshes=[],this.__meshesGroups={},this.updateBB()}clearModelGroup(e,t=!0){if(Array.isArray(this.__meshesGroups[e])){const r=this.__meshesGroups[e];this.__meshesGroups[e]=[],r.forEach(i=>{i.remove(),this.__scene.remove(i),i.__modelDBKeyIndex&&this.__meshIndexes.delete(i.__modelDBKeyIndex);const s=this.__meshes.indexOf(i);s!==-1&&this.__meshes.splice(s,1)})}t||this.updateBB()}getMeshes(e,t){if(e)return this.__meshesGroups[e];if(Array.isArray(t)){const r=Object.keys(this.__meshesGroups).filter(s=>!t.includes(s)),i=[];return r.forEach(s=>{this.__meshesGroups[s].forEach(o=>i.push(o))}),i}return this.__meshes}getIndexMesh(e){return this.__meshIndexes.get(e)}currentScene(){return this.__scene}updateBB(){this.sceneBoundingBox={max:null,min:null},this.__meshes.forEach(e=>{if(e.name==="BoundingBoxHelper")return;const t=e.$getGeometryBoundingBox&&e.$getGeometryBoundingBox();t?(this.sceneBoundingBox.max===null&&(this.sceneBoundingBox.max=new N,this.sceneBoundingBox.max.copy(t.max)),this.sceneBoundingBox.min===null&&(this.sceneBoundingBox.min=new N,this.sceneBoundingBox.min.copy(t.min)),this.sceneBoundingBox.max.x<t.max.x&&(this.sceneBoundingBox.max.x=t.max.x),this.sceneBoundingBox.max.y<t.max.y&&(this.sceneBoundingBox.max.y=t.max.y),this.sceneBoundingBox.max.z<t.max.z&&(this.sceneBoundingBox.max.z=t.max.z),this.sceneBoundingBox.min.x>t.min.x&&(this.sceneBoundingBox.min.x=t.min.x),this.sceneBoundingBox.min.y>t.min.y&&(this.sceneBoundingBox.min.y=t.min.y),this.sceneBoundingBox.min.z>t.min.z&&(this.sceneBoundingBox.min.z=t.min.z)):console.warn("some geometry is missing boundingbox")})}addMeshToScene(e,t){e.$updateClippingPlanes&&e.$updateClippingPlanes(this.canvasController.getClipping().getClippingPlanes()),this.__meshes.push(e),this.__scene.add(e),e.__modelDBKeyIndex&&this.__meshIndexes.set(e.__modelDBKeyIndex,e),t&&(Array.isArray(this.__meshesGroups[t])||(this.__meshesGroups[t]=[]),this.__meshesGroups[t].push(e))}getMeshGroups(){return Object.keys(this.__meshesGroups)}enablePlane(){this.__gridHelper.visible=!0}disablePlane(){this.__gridHelper.visible=!1}togglePlane(){this.__gridHelper.visible=!this.__gridHelper.visible}}const De=Ir(()=>({z_plane_visible:!1,y_plane_visible:!1,x_plane_visible:!1,z_plane_enable:!1,y_plane_enable:!1,x_plane_enable:!1,z_plane_neg:!0,y_plane_neg:!0,x_plane_neg:!0,z_plane_offset:0,y_plane_offset:0,x_plane_offset:0})),ui=[new Fo(new N(1,0,0),0),new Fo(new N(0,1,0),0),new Fo(new N(0,0,1),0)];class aT extends As{constructor(t,r=1,i=16776960){const s=i,o=[1,1,1],a=new xn;a.setAttribute("position",new Wt(o,3)),a.computeBoundingSphere();super(a,new ll({color:s,toneMapped:!1}));Q(this,"plane");Q(this,"size");this.plane=t,this.size=r;const l=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],c=new xn;c.setAttribute("position",new Wt(l,3)),c.computeBoundingSphere(),this.add(new Be(c,new al({color:s,opacity:0,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let r=-this.plane.constant;Math.abs(r)<1e-8&&(r=1e-8),this.scale.set(.5*this.size,.5*this.size,r),this.children[0].material.side=gi,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}}class Lq{constructor(){Q(this,"controls")}updateClipShader(e=!0){let t=Xe.getState();const r=t.enabled;if(t.minX===0&&t.minY===0&&t.minZ===0&&t.maxX===0&&t.maxY===0&&t.maxZ===0){const s=F().getSceneController().sceneBoundingBox;Xe.setState({minX:s.min.x,minY:s.min.y,minZ:s.min.z,maxX:s.max.x,maxY:s.max.y,maxZ:s.max.z}),t=Xe.getState()}F().getSceneController().getMeshes().forEach(s=>{const o=s.$getMaterials&&s.$getMaterials();Array.isArray(o)&&o.forEach(a=>{if(a!=null&&a.$shader){const l=a.$shader.uniforms;l.boxEnabled.value=r,l.boxmax.value=new N(t.maxX,t.maxY,t.maxZ),l.boxmin.value=new N(t.minX,t.minY,t.minZ)}})}),e&&t.transformHelperEnabled&&(this.toggleTransformHelper(),this.toggleTransformHelper())}toggleMode(){this.controls&&(this.controls.getMode()==="translate"?this.controls.setMode("scale"):this.controls.setMode("translate"))}filter(e){const t=Xe.getState(),r=t.enabled,i=new et(new N(t.minX,t.minY,t.minZ),new N(t.maxX,t.maxY,t.maxZ)),s=o=>o.object.visible?r?i.containsPoint(o.point):!0:!1;return e.filter(s)}beforeRender(){const e=Xe.getState(),t=e.enabled,r=new et(new N(e.minX,e.minY,e.minZ),new N(e.maxX,e.maxY,e.maxZ));t&&F().getSceneController().getMeshes().forEach(s=>{if(s.$getMaterials){const o=s.$getMaterials(),a=s.$getGeometryBoundingBox();a&&Array.isArray(o)&&(r.intersectsBox(a)||(s.visible=!1))}})}afterRender(){Xe.getState().enabled&&F().getSceneController().getMeshes().forEach(i=>{i.visible=!0})}async resizeToLoaded(){const e=F().getSceneController().sceneBoundingBox;Xe.setState({minX:e.min.x,minY:e.min.y,minZ:e.min.z,maxX:e.max.x,maxY:e.max.y,maxZ:e.max.z}),this.updateAxisGeometry(),this.updateLineGeometry(),this.updateClipShader(),F().forceRenderNextFrame()}async resizeToSelected(e=new N(0,0,0),t=new N(0,0,0)){const r=await ae.get_bounding_box_from_selection(),i=new et(new N(r.x,r.y,r.z),new N(r.X,r.Y,r.Z));return i.expandByVector(e),i.translate(t),li.flushSync(()=>{Xe.setState({minX:i.min.x,minY:i.min.y,minZ:i.min.z,maxX:i.max.x,maxY:i.max.y,maxZ:i.max.z})}),this.updateAxisGeometry(),this.updateLineGeometry(),this.updateClipShader(),F().forceRenderNextFrame(),i}toggleClipping(){const e=Xe.getState();e.enabled&&F().getSceneController().getMeshes().forEach(r=>{r.visible=!0}),Xe.setState({enabled:!e.enabled}),this.updateClipShader(),this.updateClippingHelper(),F().forceRenderNextFrame()}disable(){Xe.getState().enabled&&this.toggleClipping()}toggleTransformHelper(){const t=!Xe.getState().transformHelperEnabled;Xe.setState({transformHelperEnabled:t}),this.updateClippingHelper()}toggleLineHelper(){const t=!Xe.getState().lineHelperEnabled;Xe.setState({lineHelperEnabled:t}),this.updateClippingHelper()}toggleAxisHelper(){const t=!Xe.getState().axisHelperEnabled;Xe.setState({axisHelperEnabled:t}),this.updateAxisGeometry(),my.forceRenderNextFrame()}updateAxisGeometry(){let e=Xe.getState();if(F().getSceneController().clearModelGroup("AXES_CLIPPING"),!e.enabled||!e.axisHelperEnabled||e.transformHelperEnabled)return;if(e.minX===0&&e.minY===0&&e.minZ===0&&e.maxX===0&&e.maxY===0&&e.maxZ===0){const s=F().getSceneController().sceneBoundingBox;Xe.setState({minX:s.min.x,minY:s.min.y,minZ:s.min.z,maxX:s.max.x,maxY:s.max.y,maxZ:s.max.z}),e=Xe.getState()}const t=new et(new N(e.minX,e.minY,e.minZ),new N(e.maxX,e.maxY,e.maxZ)),r=new BK(5);Array.isArray(r.material)||(r.material.depthTest=!1),t.getCenter(r.position),r.matrixWorldNeedsUpdate=!0;const i=r;return i.setPicking=s=>{r.visible=!s},F().getSceneController().addMeshToScene(r,"AXES_CLIPPING"),r}updateLineGeometry(){let e=Xe.getState();const t=e.enabled;if(F().getSceneController().clearModelGroup("BOX_CLIPPING"),!t)return;if(e.minX===0&&e.minY===0&&e.minZ===0&&e.maxX===0&&e.maxY===0&&e.maxZ===0){const l=F().getSceneController().sceneBoundingBox;Xe.setState({minX:l.min.x,minY:l.min.y,minZ:l.min.z,maxX:l.max.x,maxY:l.max.y,maxZ:l.max.z}),e=Xe.getState()}const r=new et(new N(e.minX,e.minY,e.minZ),new N(e.maxX,e.maxY,e.maxZ)),i=new En(Math.abs(e.maxX-e.minX),Math.abs(e.maxY-e.minY),Math.abs(e.maxZ-e.minZ)),s=new ll({color:"yellow",linewidth:2,visible:e.lineHelperEnabled,depthTest:!0,linecap:"round",linejoin:"round"}),o=new WU(i),a=new Cv(o,s);return a.setPicking=l=>{a.visible=!l},r.getCenter(a.position),F().getSceneController().addMeshToScene(a,"BOX_CLIPPING"),a}updateClippingHelper(){const e=Xe.getState(),t=e.transformHelperEnabled,r=e.enabled;F().getSceneController().clearModelGroup("BOX_CONTROLS"),this.controls&&(this.controls.dispose(),this.controls=null);const i=this.updateLineGeometry();t&&r&&i&&(this.controls=new uF(F().getActiveCamera(),F().getRender().domElement),this.controls.addEventListener("change",()=>{let s=Xe.getState();const o=s.enabled,a=new et().setFromObject(i);Xe.setState({minX:a.min.x,minY:a.min.y,minZ:a.min.z,maxX:a.max.x,maxY:a.max.y,maxZ:a.max.z}),s=Xe.getState(),o&&this.updateClipShader(!1),this.updateAxisGeometry(),F().forceRenderNextFrame()}),this.controls.setSize(.75),this.controls.addEventListener("mouseDown",function(){const s=F().getActiveControls();s.enabled=!1,s.saveState()}),this.controls.addEventListener("mouseUp",function(){const s=F().getActiveControls();s.enabled=!0,s.saveState()}),this.controls.attach(i),this.controls.setMode("translate"),this.controls.enabled=!0,F().getSceneController().addMeshToScene(this.controls,"BOX_CONTROLS")),F().forceRenderNextFrame()}}const Bt=new Lq;class Oq{constructor(e){Q(this,"__planeHelpers",[]);this.__canvasController=e,this.__planeHelpers.push(new aT(ui[0],500,16711680)),this.__planeHelpers.push(new aT(ui[1],500,65280)),this.__planeHelpers.push(new aT(ui[2],500,255)),this.__addClipping()}getClippingPlanes(){const e=De.getState(),t=[];return e.x_plane_enable&&t.push(ui[0]),e.y_plane_enable&&t.push(ui[1]),e.z_plane_enable&&t.push(ui[2]),t}filterClippingPlanes(e){const t=this.getClippingPlanes();function r(i){if(!i.object.visible)return!1;if(!t.length)return!0;let o=!1,a=0;return t.forEach(l=>{const c=parseFloat(l.distanceToPoint(i.point));o||c>0&&a++}),a===t.length&&(o=!0),o}return Bt.filter(e.filter(r))}__addClipping(){this.__canvasController.getRender().localClippingEnabled=!0,this.__planeHelpers.forEach(r=>{r.visible=!1,this.__canvasController.getSceneController().currentScene().add(r)});function e(r){return JSON.parse(JSON.stringify(r))}let t=e(De.getState());De.subscribe(()=>{const r=De.getState();if(r.x_plane_neg!==t.x_plane_neg&&ui[0].negate(),r.y_plane_neg!==t.y_plane_neg&&ui[1].negate(),r.z_plane_neg!==t.z_plane_neg&&ui[2].negate(),r.x_plane_visible!==t.x_plane_visible&&(this.__planeHelpers[0].visible=r.x_plane_visible),r.y_plane_visible!==t.y_plane_visible&&(this.__planeHelpers[1].visible=r.y_plane_visible),r.z_plane_visible!==t.z_plane_visible&&(this.__planeHelpers[2].visible=r.z_plane_visible),r.x_plane_offset!==t.x_plane_offset&&(ui[0].constant=r.x_plane_offset),r.y_plane_offset!==t.y_plane_offset&&(ui[1].constant=r.y_plane_offset),r.z_plane_offset!==t.z_plane_offset&&(ui[2].constant=r.z_plane_offset),r.x_plane_enable!==t.x_plane_enable||r.y_plane_enable!==t.y_plane_enable||r.z_plane_enable!==t.z_plane_enable){const i=[];r.x_plane_enable&&i.push(ui[0]),r.y_plane_enable&&i.push(ui[1]),r.z_plane_enable&&i.push(ui[2]),this.__canvasController.getSceneController().getMeshes().forEach(s=>{const o=s.$getMaterials();Array.isArray(o)&&o.forEach(a=>{a.clippingPlanes=i})})}t=e(De.getState()),this.__canvasController.forceRenderNextFrame()})}}const sp=Ir(()=>({mode:"3D"}));function Dq(n){return new Worker(""+new URL("rayCasterWorker-BPpAp16m.js",import.meta.url).href,{name:n==null?void 0:n.name})}async function Uq(){const n=new Dq,e=bv(n);return[await new e,n]}class aL extends HTMLElement{constructor(e,t){super(),this.camera=e,this.options=Object.assign({size:200,padding:8,bubbleSizePrimary:10,bubbleSizeSeconday:10,showSecondary:!0,lineWidth:2,fontSize:"10px",fontFamily:"arial",fontWeight:"bold",fontColor:"#151515",fontYAdjust:0,colors:{x:["#f73c3c","#942424"],y:["#6ccb26","#417a17"],z:["#178cf0","#0e5490"]}},t),this.onAxisSelected=null,this.bubbles=[{axis:"x",direction:new N(1,0,0),size:this.options.bubbleSizePrimary,color:this.options.colors.x,line:this.options.lineWidth,label:"E"},{axis:"y",direction:new N(0,1,0),size:this.options.bubbleSizePrimary,color:this.options.colors.y,line:this.options.lineWidth,label:"N"},{axis:"z",direction:new N(0,0,1),size:this.options.bubbleSizePrimary,color:this.options.colors.z,line:this.options.lineWidth,label:"A"},{axis:"-x",direction:new N(-1,0,0),size:this.options.bubbleSizeSeconday,color:this.options.colors.x,label:"W"},{axis:"-y",direction:new N(0,-1,0),size:this.options.bubbleSizeSeconday,color:this.options.colors.y,label:"S"},{axis:"-z",direction:new N(0,0,-1),size:this.options.bubbleSizeSeconday,color:this.options.colors.z,label:"U"}],this.center=new N(this.options.size/2,this.options.size/2,0),this.selectedAxis=null,this.innerHTML="<canvas width='"+this.options.size+"' height='"+this.options.size+"'></canvas>",this.onMouseMove=this.onMouseMove.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseClick=this.onMouseClick.bind(this)}connectedCallback(){this.canvas=this.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.addEventListener("mousemove",this.onMouseMove,!1),this.canvas.addEventListener("mouseout",this.onMouseOut,!1),this.canvas.addEventListener("click",this.onMouseClick,!1)}disconnectedCallback(){this.canvas.removeEventListener("mousemove",this.onMouseMove,!1),this.canvas.removeEventListener("mouseout",this.onMouseOut,!1),this.canvas.removeEventListener("click",this.onMouseClick,!1)}onMouseMove(e){const t=this.canvas.getBoundingClientRect();this.mouse=new N(e.clientX-t.left,e.clientY-t.top,0)}onMouseOut(){this.mouse=null}onMouseClick(){this.onAxisSelected&&typeof this.onAxisSelected=="function"&&this.onAxisSelected({axis:this.selectedAxis.axis,direction:this.selectedAxis.direction.clone()})}clear(){this.canvas&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}drawCircle(e,t=10,r="#FF0000"){this.context.beginPath(),this.context.arc(e.x,e.y,t,0,2*Math.PI,!1),this.context.fillStyle=r,this.context.fill(),this.context.closePath()}drawLine(e,t,r=1,i="#FF0000"){this.context.beginPath(),this.context.moveTo(e.x,e.y),this.context.lineTo(t.x,t.y),this.context.lineWidth=r,this.context.strokeStyle=i,this.context.stroke(),this.context.closePath()}update(){this.clear();const t=new ot().makeRotationFromEuler(this.camera.rotation).clone().invert();for(const i of this.bubbles)i.position=this.getBubblePosition(i.direction.clone().applyMatrix4(t));const r=[];for(const i in this.bubbles)(this.options.showSecondary===!0||i[0]!=="-")&&r.push(this.bubbles[i]);if(r.sort((i,s)=>i.position.z>s.position.z?1:-1),this.selectedAxis=null,this.mouse){let i=1/0;for(const s of r){const o=this.mouse.distanceTo(s.position);(o<i||o<s.size)&&(i=o,this.selectedAxis=s)}}this.drawLayers(r)}drawLayers(e){for(const t of e){let r=t.color;this.selectedAxis===t?r="#FFFFFF":t.position.z>=-.01?r=t.color[0]:r=t.color[1],this.drawCircle(t.position,t.size,r),t.line&&this.drawLine(this.center,t.position,t.line,r),t.label&&(this.context.font=[this.options.fontWeight,this.options.fontSize,this.options.fontFamily].join(" "),this.context.fillStyle=this.options.fontColor,this.context.textBaseline="middle",this.context.textAlign="center",this.context.fillText(t.label,t.position.x,t.position.y+this.options.fontYAdjust))}}getBubblePosition(e){return new N(e.x*(this.center.x-this.options.bubbleSizePrimary/2-this.options.padding)+this.center.x,this.center.y-e.y*(this.center.y-this.options.bubbleSizePrimary/2-this.options.padding),e.z)}}function lL(n){if(!window.customElements.get("orientation-gizmo"))window.customElements.define("orientation-gizmo",aL);else{const t=document.getElementById("gizmo");t&&document.body.removeChild(t)}n.__orientationGizmo=new aL(n.__activeCamera,{size:150,padding:8,bubbleSizePrimary:12,bubbleSizeSeconday:12,showSecondary:!0,lineWidth:2,fontSize:"11px",fontFamily:"arial",fontWeight:"bold",fontColor:"#151515",colors:{x:["#f73c3c","#942424"],y:["#6ccb26","#417a17"],z:["#178cf0","#0e5490"]}}),n.__orientationGizmo.id="gizmo";const e=n.__orientationGizmo;e.onAxisSelected=async t=>{const r=n.getSceneController().sceneBoundingBox,i=Xe.getState();if(i.enabled&&(r.max=new N(i.maxX,i.maxY,i.maxZ),r.min=new N(i.minX,i.minY,i.minZ)),!r.max)return;const s=new et(r.min,r.max);if(!s.max)return;n.getActiveControls().smoothTime=.5,n.getActiveControls().saveState();const o=Math.PI*.5,a=Math.PI,l=h=>{switch(h){case"front":return n.getActiveControls().rotateTo(0,o,!0);case"back":return n.getActiveControls().rotateTo(a,o,!0);case"up":return n.getActiveControls().rotateTo(0,0,!0);case"down":return n.getActiveControls().rotateTo(0,a,!0);case"right":return n.getActiveControls().rotateTo(o,o,!0);case"left":return n.getActiveControls().rotateTo(-o,o,!0)}};let c;switch(t.axis){case"x":n.__lastmove==="right"&&!t.noSmartLogic?(c=l("left"),n.__lastmove="left"):(c=l("right"),n.__lastmove="right");break;case"-x":n.__lastmove==="left"&&!t.noSmartLogic?(c=l("right"),n.__lastmove="right"):(c=l("left"),n.__lastmove="left");break;case"z":n.__lastmove==="up"&&!t.noSmartLogic?(c=l("down"),n.__lastmove="down"):(c=l("up"),n.__lastmove="up");break;case"-z":n.__lastmove==="down"&&!t.noSmartLogic?(c=l("up"),n.__lastmove="up"):(c=l("down"),n.__lastmove="down");break;case"y":n.__lastmove==="back"&&!t.noSmartLogic?(c=l("front"),n.__lastmove="front"):(c=l("back"),n.__lastmove="back");break;case"-y":n.__lastmove==="front"&&!t.noSmartLogic?(c=l("back"),n.__lastmove="back"):(c=l("front"),n.__lastmove="front");break}const u=n.getActiveControls().fitToBox(s,!0,{paddingBottom:25,paddingLeft:25,paddingTop:25,paddingRight:25});Promise.all([c,u]).then(()=>{n.getActiveControls().smoothTime=1,n.getActiveControls().saveState()})},document.body.appendChild(n.__orientationGizmo)}/*!
 * hold-event
 * https://github.com/yomotsu/hold-event
 * (c) 2020 @yomotsu
 * Released under the MIT License.
 */var St;(function(n){n.HOLD_START="holdStart",n.HOLD_END="holdEnd",n.HOLDING="holding"})(St||(St={}));let Fq=class{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}removeEventListener(e,t){const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e)}}};class dF extends Fq{constructor(e){super(),this._enabled=!0,this._holding=!1,this._intervalId=-1,this._deltaTime=0,this._elapsedTime=0,this._lastTime=0,this._holdStart=t=>{if(!this._enabled||this._holding)return;this._deltaTime=0,this._elapsedTime=0,this._lastTime=performance.now(),this.dispatchEvent({type:St.HOLD_START,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:t}),this._holding=!0;const r=()=>{this._intervalId=this.holdIntervalDelay?window.setTimeout(r,this.holdIntervalDelay):window.requestAnimationFrame(r);const i=performance.now();this._deltaTime=i-this._lastTime,this._elapsedTime+=this._deltaTime,this._lastTime=performance.now(),this.dispatchEvent({type:St.HOLDING,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:t})};this._intervalId=this.holdIntervalDelay?window.setTimeout(r,this.holdIntervalDelay):window.requestAnimationFrame(r)},this._holdEnd=t=>{if(!this._enabled||!this._holding)return;const r=performance.now();this._deltaTime=r-this._lastTime,this._elapsedTime+=this._deltaTime,this._lastTime=performance.now(),this.dispatchEvent({type:St.HOLD_END,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:t}),window.clearTimeout(this._intervalId),window.cancelAnimationFrame(this._intervalId),this._holding=!1},this.holdIntervalDelay=e}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._enabled||this._holdEnd())}get holding(){return this._holding}}class rh extends dF{constructor(e,t){super(t),this._activePointerIds=[];const r=a=>{this._holdStart(a)},i=a=>{this._activePointerIds.length=0,this._holdEnd(a)},s=a=>{this._activePointerIds.push(a.pointerId),r(a)},o=a=>{const l=this._activePointerIds.indexOf(a.pointerId);l!==-1&&(this._activePointerIds.splice(l,1),this._activePointerIds.length===0&&i(a))};e.addEventListener("pointerdown",s),document.addEventListener("pointerup",o),window.addEventListener("blur",i)}}class ih extends dF{constructor(e,t){if(typeof e!="string"){console.error("KeyboardKeyHold: the first argument has to be a KeyboardEvent.code string.");return}super(t),this._holdStart=this._holdStart.bind(this),this._holdEnd=this._holdEnd.bind(this);const r=s=>{jq(s)||s.code===e&&this._holdStart(s)},i=s=>{s.code===e&&this._holdEnd(s)};document.addEventListener("keydown",r),document.addEventListener("keyup",i),window.addEventListener("blur",this._holdEnd)}}function jq(n){const e=n.target;return e.tagName==="INPUT"||e.tagName==="SELECT"||e.tagName==="TEXTAREA"||e.isContentEditable}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Fn={LEFT:1,RIGHT:2,MIDDLE:4},_e=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),sh={NONE:0,IN:1,OUT:-1};function $c(n){return n.isPerspectiveCamera}function Il(n){return n.isOrthographicCamera}const oh=Math.PI*2,cL=Math.PI/2,hF=1e-5,sm=Math.PI/180;function Qs(n,e,t){return Math.max(e,Math.min(t,n))}function gn(n,e=hF){return Math.abs(n)<e}function Qt(n,e,t=hF){return gn(n-e,t)}function uL(n,e){return Math.round(n/e)*e}function om(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function am(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function V0(n,e,t,r,i=1/0,s){r=Math.max(1e-4,r);const o=2/r,a=o*s,l=1/(1+a+.48*a*a+.235*a*a*a);let c=n-e;const u=e,h=i*r;c=Qs(c,-h,h),e=n-c;const f=(t.value+o*c)*s;t.value=(t.value-o*f)*l;let p=e+(c+f)*l;return u-n>0==p>u&&(p=u,t.value=(p-u)/s),p}function dL(n,e,t,r,i=1/0,s,o){r=Math.max(1e-4,r);const a=2/r,l=a*s,c=1/(1+l+.48*l*l+.235*l*l*l);let u=e.x,h=e.y,f=e.z,p=n.x-u,_=n.y-h,y=n.z-f;const g=u,m=h,v=f,x=i*r,w=x*x,E=p*p+_*_+y*y;if(E>w){const I=Math.sqrt(E);p=p/I*x,_=_/I*x,y=y/I*x}u=n.x-p,h=n.y-_,f=n.z-y;const S=(t.x+a*p)*s,C=(t.y+a*_)*s,A=(t.z+a*y)*s;t.x=(t.x-a*S)*c,t.y=(t.y-a*C)*c,t.z=(t.z-a*A)*c,o.x=u+(p+S)*c,o.y=h+(_+C)*c,o.z=f+(y+A)*c;const k=g-n.x,T=m-n.y,R=v-n.z,$=o.x-g,P=o.y-m,M=o.z-v;return k*$+T*P+R*M>0&&(o.x=g,o.y=m,o.z=v,t.x=(o.x-g)/s,t.y=(o.y-m)/s,t.z=(o.z-v)/s),o}function lT(n,e){e.set(0,0),n.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=n.length,e.y/=n.length}function cT(n,e){return Il(n)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}let zq=class{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e)}}};var uT;const Bq="2.8.3",G0=1/8,Hq=/Mac/.test((uT=globalThis==null?void 0:globalThis.navigator)===null||uT===void 0?void 0:uT.platform);let lt,hL,W0,dT,bi,wt,Yt,ah,lm,No,Io,Xc,fL,pL,Ss,cm,lh,mL,hT,gL,fT,pT,Y0;class Cr extends zq{static install(e){lt=e.THREE,hL=Object.freeze(new lt.Vector3(0,0,0)),W0=Object.freeze(new lt.Vector3(0,1,0)),dT=Object.freeze(new lt.Vector3(0,0,1)),bi=new lt.Vector2,wt=new lt.Vector3,Yt=new lt.Vector3,ah=new lt.Vector3,lm=new lt.Vector3,No=new lt.Vector3,Io=new lt.Vector3,Xc=new lt.Vector3,fL=new lt.Vector3,pL=new lt.Vector3,Ss=new lt.Spherical,cm=new lt.Spherical,lh=new lt.Box3,mL=new lt.Box3,hT=new lt.Sphere,gL=new lt.Quaternion,fT=new lt.Quaternion,pT=new lt.Matrix4,Y0=new lt.Raycaster}static get ACTION(){return _e}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=_e.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=sh.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new lt.Vector3,this._focalOffsetVelocity=new lt.Vector3,this._zoomVelocity={value:0},this._truckInternal=(m,v,x)=>{let w,E;if($c(this._camera)){const S=wt.copy(this._camera.position).sub(this._target),C=this._camera.getEffectiveFOV()*sm,A=S.length()*Math.tan(C*.5);w=this.truckSpeed*m*A/this._elementRect.height,E=this.truckSpeed*v*A/this._elementRect.height}else if(Il(this._camera)){const S=this._camera;w=m*(S.right-S.left)/S.zoom/this._elementRect.width,E=v*(S.top-S.bottom)/S.zoom/this._elementRect.height}else return;this.verticalDragToForward?(x?this.setFocalOffset(this._focalOffsetEnd.x+w,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(w,0,!0),this.forward(-E,!0)):x?this.setFocalOffset(this._focalOffsetEnd.x+w,this._focalOffsetEnd.y+E,this._focalOffsetEnd.z,!0):this.truck(w,E,!0)},this._rotateInternal=(m,v)=>{const x=oh*this.azimuthRotateSpeed*m/this._elementRect.height,w=oh*this.polarRotateSpeed*v/this._elementRect.height;this.rotate(x,w,!0)},this._dollyInternal=(m,v,x)=>{const w=Math.pow(.95,-m*this.dollySpeed),E=this._sphericalEnd.radius,S=this._sphericalEnd.radius*w,C=Qs(S,this.minDistance,this.maxDistance),A=C-S;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(S,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(A,!0),this._dollyToNoClamp(C,!0)):this._dollyToNoClamp(C,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?S:C)-E,this._dollyControlCoord.set(v,x)),this._lastDollyDirection=Math.sign(-m)},this._zoomInternal=(m,v,x)=>{const w=Math.pow(.95,m*this.dollySpeed),E=this._zoom,S=this._zoom*w;this.zoomTo(S,!0),this.dollyToCursor&&(this._changedZoom+=S-E,this._dollyControlCoord.set(v,x))},typeof lt>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new lt.Quaternion().setFromUnitVectors(this._camera.up,W0),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=_e.NONE,this._target=new lt.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new lt.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new lt.Spherical().setFromVector3(wt.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new lt.Vector3,new lt.Vector3,new lt.Vector3,new lt.Vector3],this._updateNearPlaneCorners(),this._boundary=new lt.Box3(new lt.Vector3(-1/0,-1/0,-1/0),new lt.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new lt.Vector2,this.mouseButtons={left:_e.ROTATE,middle:_e.DOLLY,right:_e.TRUCK,wheel:$c(this._camera)?_e.DOLLY:Il(this._camera)?_e.ZOOM:_e.NONE},this.touches={one:_e.TOUCH_ROTATE,two:$c(this._camera)?_e.TOUCH_DOLLY_TRUCK:Il(this._camera)?_e.TOUCH_ZOOM_TRUCK:_e.NONE,three:_e.TOUCH_TRUCK};const r=new lt.Vector2,i=new lt.Vector2,s=new lt.Vector2,o=m=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const w=this._domElement.getBoundingClientRect(),E=m.clientX/w.width,S=m.clientY/w.height;if(E<this._interactiveArea.left||E>this._interactiveArea.right||S<this._interactiveArea.top||S>this._interactiveArea.bottom)return}const v=m.pointerType!=="mouse"?null:(m.buttons&Fn.LEFT)===Fn.LEFT?Fn.LEFT:(m.buttons&Fn.MIDDLE)===Fn.MIDDLE?Fn.MIDDLE:(m.buttons&Fn.RIGHT)===Fn.RIGHT?Fn.RIGHT:null;if(v!==null){const w=this._findPointerByMouseButton(v);w&&this._disposePointer(w)}if((m.buttons&Fn.LEFT)===Fn.LEFT&&this._lockedPointer)return;const x={pointerId:m.pointerId,clientX:m.clientX,clientY:m.clientY,deltaX:0,deltaY:0,mouseButton:v};this._activePointers.push(x),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,f(m)},a=m=>{m.cancelable&&m.preventDefault();const v=m.pointerId,x=this._lockedPointer||this._findPointerById(v);if(x){if(x.clientX=m.clientX,x.clientY=m.clientY,x.deltaX=m.movementX,x.deltaY=m.movementY,this._state=0,m.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(m.buttons&Fn.LEFT)===Fn.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(m.buttons&Fn.MIDDLE)===Fn.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(m.buttons&Fn.RIGHT)===Fn.RIGHT&&(this._state=this._state|this.mouseButtons.right);p()}},l=m=>{const v=this._findPointerById(m.pointerId);if(!(v&&v===this._lockedPointer)){if(v&&this._disposePointer(v),m.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=_e.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=_e.NONE;_()}};let c=-1;const u=m=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===_e.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const S=this._domElement.getBoundingClientRect(),C=m.clientX/S.width,A=m.clientY/S.height;if(C<this._interactiveArea.left||C>this._interactiveArea.right||A<this._interactiveArea.top||A>this._interactiveArea.bottom)return}if(m.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===_e.ROTATE||this.mouseButtons.wheel===_e.TRUCK){const S=performance.now();c-S<1e3&&this._getClientRect(this._elementRect),c=S}const v=Hq?-1:-3,x=m.deltaMode===1?m.deltaY/v:m.deltaY/(v*10),w=this.dollyToCursor?(m.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,E=this.dollyToCursor?(m.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case _e.ROTATE:{this._rotateInternal(m.deltaX,m.deltaY),this._isUserControllingRotate=!0;break}case _e.TRUCK:{this._truckInternal(m.deltaX,m.deltaY,!1),this._isUserControllingTruck=!0;break}case _e.OFFSET:{this._truckInternal(m.deltaX,m.deltaY,!0),this._isUserControllingOffset=!0;break}case _e.DOLLY:{this._dollyInternal(-x,w,E),this._isUserControllingDolly=!0;break}case _e.ZOOM:{this._zoomInternal(-x,w,E),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},h=m=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Cr.ACTION.NONE){const v=m instanceof PointerEvent?m.pointerId:0,x=this._findPointerById(v);x&&this._disposePointer(x),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}m.preventDefault()}},f=m=>{if(!this._enabled)return;if(lT(this._activePointers,bi),this._getClientRect(this._elementRect),r.copy(bi),i.copy(bi),this._activePointers.length>=2){const x=bi.x-this._activePointers[1].clientX,w=bi.y-this._activePointers[1].clientY,E=Math.sqrt(x*x+w*w);s.set(0,E);const S=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,C=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(S,C)}if(this._state=0,!m)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in m&&m.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(m.buttons&Fn.LEFT)===Fn.LEFT&&(this._state=this._state|this.mouseButtons.left),(m.buttons&Fn.MIDDLE)===Fn.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(m.buttons&Fn.RIGHT)===Fn.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&_e.ROTATE)===_e.ROTATE||(this._state&_e.TOUCH_ROTATE)===_e.TOUCH_ROTATE||(this._state&_e.TOUCH_DOLLY_ROTATE)===_e.TOUCH_DOLLY_ROTATE||(this._state&_e.TOUCH_ZOOM_ROTATE)===_e.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&_e.TRUCK)===_e.TRUCK||(this._state&_e.TOUCH_TRUCK)===_e.TOUCH_TRUCK||(this._state&_e.TOUCH_DOLLY_TRUCK)===_e.TOUCH_DOLLY_TRUCK||(this._state&_e.TOUCH_ZOOM_TRUCK)===_e.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&_e.DOLLY)===_e.DOLLY||(this._state&_e.TOUCH_DOLLY)===_e.TOUCH_DOLLY||(this._state&_e.TOUCH_DOLLY_TRUCK)===_e.TOUCH_DOLLY_TRUCK||(this._state&_e.TOUCH_DOLLY_OFFSET)===_e.TOUCH_DOLLY_OFFSET||(this._state&_e.TOUCH_DOLLY_ROTATE)===_e.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&_e.ZOOM)===_e.ZOOM||(this._state&_e.TOUCH_ZOOM)===_e.TOUCH_ZOOM||(this._state&_e.TOUCH_ZOOM_TRUCK)===_e.TOUCH_ZOOM_TRUCK||(this._state&_e.TOUCH_ZOOM_OFFSET)===_e.TOUCH_ZOOM_OFFSET||(this._state&_e.TOUCH_ZOOM_ROTATE)===_e.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&_e.OFFSET)===_e.OFFSET||(this._state&_e.TOUCH_OFFSET)===_e.TOUCH_OFFSET||(this._state&_e.TOUCH_DOLLY_OFFSET)===_e.TOUCH_DOLLY_OFFSET||(this._state&_e.TOUCH_ZOOM_OFFSET)===_e.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},p=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,lT(this._activePointers,bi);const v=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,x=v?-v.deltaX:i.x-bi.x,w=v?-v.deltaY:i.y-bi.y;if(i.copy(bi),((this._state&_e.ROTATE)===_e.ROTATE||(this._state&_e.TOUCH_ROTATE)===_e.TOUCH_ROTATE||(this._state&_e.TOUCH_DOLLY_ROTATE)===_e.TOUCH_DOLLY_ROTATE||(this._state&_e.TOUCH_ZOOM_ROTATE)===_e.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(x,w),this._isUserControllingRotate=!0),(this._state&_e.DOLLY)===_e.DOLLY||(this._state&_e.ZOOM)===_e.ZOOM){const E=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,S=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0,C=this.dollyDragInverted?-1:1;(this._state&_e.DOLLY)===_e.DOLLY?(this._dollyInternal(C*w*G0,E,S),this._isUserControllingDolly=!0):(this._zoomInternal(C*w*G0,E,S),this._isUserControllingZoom=!0)}if((this._state&_e.TOUCH_DOLLY)===_e.TOUCH_DOLLY||(this._state&_e.TOUCH_ZOOM)===_e.TOUCH_ZOOM||(this._state&_e.TOUCH_DOLLY_TRUCK)===_e.TOUCH_DOLLY_TRUCK||(this._state&_e.TOUCH_ZOOM_TRUCK)===_e.TOUCH_ZOOM_TRUCK||(this._state&_e.TOUCH_DOLLY_OFFSET)===_e.TOUCH_DOLLY_OFFSET||(this._state&_e.TOUCH_ZOOM_OFFSET)===_e.TOUCH_ZOOM_OFFSET||(this._state&_e.TOUCH_DOLLY_ROTATE)===_e.TOUCH_DOLLY_ROTATE||(this._state&_e.TOUCH_ZOOM_ROTATE)===_e.TOUCH_ZOOM_ROTATE){const E=bi.x-this._activePointers[1].clientX,S=bi.y-this._activePointers[1].clientY,C=Math.sqrt(E*E+S*S),A=s.y-C;s.set(0,C);const k=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,T=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&_e.TOUCH_DOLLY)===_e.TOUCH_DOLLY||(this._state&_e.TOUCH_DOLLY_ROTATE)===_e.TOUCH_DOLLY_ROTATE||(this._state&_e.TOUCH_DOLLY_TRUCK)===_e.TOUCH_DOLLY_TRUCK||(this._state&_e.TOUCH_DOLLY_OFFSET)===_e.TOUCH_DOLLY_OFFSET?(this._dollyInternal(A*G0,k,T),this._isUserControllingDolly=!0):(this._zoomInternal(A*G0,k,T),this._isUserControllingZoom=!0)}((this._state&_e.TRUCK)===_e.TRUCK||(this._state&_e.TOUCH_TRUCK)===_e.TOUCH_TRUCK||(this._state&_e.TOUCH_DOLLY_TRUCK)===_e.TOUCH_DOLLY_TRUCK||(this._state&_e.TOUCH_ZOOM_TRUCK)===_e.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(x,w,!1),this._isUserControllingTruck=!0),((this._state&_e.OFFSET)===_e.OFFSET||(this._state&_e.TOUCH_OFFSET)===_e.TOUCH_OFFSET||(this._state&_e.TOUCH_DOLLY_OFFSET)===_e.TOUCH_DOLLY_OFFSET||(this._state&_e.TOUCH_ZOOM_OFFSET)===_e.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(x,w,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},_=()=>{lT(this._activePointers,bi),i.copy(bi),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",y),this._domElement.ownerDocument.addEventListener("pointerlockerror",g),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),f())},this.unlockPointer=()=>{var m,v,x;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(m=this._domElement)===null||m===void 0||m.ownerDocument.exitPointerLock(),(v=this._domElement)===null||v===void 0||v.ownerDocument.removeEventListener("pointerlockchange",y),(x=this._domElement)===null||x===void 0||x.ownerDocument.removeEventListener("pointerlockerror",g),this.cancel()};const y=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},g=()=>{this.unlockPointer()};this._addAllEventListeners=m=>{this._domElement=m,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",u,{passive:!1}),this._domElement.addEventListener("contextmenu",h)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",u,{passive:!1}),this._domElement.removeEventListener("contextmenu",h),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",y),this._domElement.ownerDocument.removeEventListener("pointerlockerror",g))},this.cancel=()=>{this._state!==_e.NONE&&(this._state=_e.NONE,this._activePointers.length=0,_())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Qs(e.width,0,1),this._interactiveArea.height=Qs(e.height,0,1),this._interactiveArea.x=Qs(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Qs(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,r=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,r)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,r=!1){this._isUserControllingRotate=!1;const i=Qs(e,this.minAzimuthAngle,this.maxAzimuthAngle),s=Qs(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=s,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,r||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!r||Qt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Qt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=sh.NONE,this._changedDolly=0,this._dollyToNoClamp(Qs(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const r=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=Qt(o,this._spherical.radius);if(!(r>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const s=!t||Qt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(lm).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const r=!t||Qt(this._target.x,this._targetEnd.x,this.restThreshold)&&Qt(this._target.y,this._targetEnd.y,this.restThreshold)&&Qt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Qs(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const r=!t||Qt(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(r)}pan(e,t,r=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,r)}truck(e,t,r=!1){this._camera.updateMatrix(),No.setFromMatrixColumn(this._camera.matrix,0),Io.setFromMatrixColumn(this._camera.matrix,1),No.multiplyScalar(e),Io.multiplyScalar(-t);const i=wt.copy(No).add(Io),s=Yt.copy(this._targetEnd).add(i);return this.moveTo(s.x,s.y,s.z,r)}forward(e,t=!1){wt.setFromMatrixColumn(this._camera.matrix,0),wt.crossVectors(this._camera.up,wt),wt.multiplyScalar(e);const r=Yt.copy(this._targetEnd).add(wt);return this.moveTo(r.x,r.y,r.z,t)}elevate(e,t=!1){return wt.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+wt.x,this._targetEnd.y+wt.y,this._targetEnd.z+wt.z,t)}moveTo(e,t,r,i=!1){this._isUserControllingTruck=!1;const s=wt.set(e,t,r).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,s,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const o=!i||Qt(this._target.x,this._targetEnd.x,this.restThreshold)&&Qt(this._target.y,this._targetEnd.y,this.restThreshold)&&Qt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,r,i=!1){const a=wt.set(e,t,r).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,i)}fitToBox(e,t,{cover:r=!1,paddingLeft:i=0,paddingRight:s=0,paddingBottom:o=0,paddingTop:a=0}={}){const l=[],c=e.isBox3?lh.copy(e):lh.setFromObject(e);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const u=uL(this._sphericalEnd.theta,cL),h=uL(this._sphericalEnd.phi,cL);l.push(this.rotateTo(u,h,t));const f=wt.setFromSpherical(this._sphericalEnd).normalize(),p=gL.setFromUnitVectors(f,dT),_=Qt(Math.abs(f.y),1);_&&p.multiply(fT.setFromAxisAngle(W0,u)),p.multiply(this._yAxisUpSpaceInverse);const y=mL.makeEmpty();Yt.copy(c.min).applyQuaternion(p),y.expandByPoint(Yt),Yt.copy(c.min).setX(c.max.x).applyQuaternion(p),y.expandByPoint(Yt),Yt.copy(c.min).setY(c.max.y).applyQuaternion(p),y.expandByPoint(Yt),Yt.copy(c.max).setZ(c.min.z).applyQuaternion(p),y.expandByPoint(Yt),Yt.copy(c.min).setZ(c.max.z).applyQuaternion(p),y.expandByPoint(Yt),Yt.copy(c.max).setY(c.min.y).applyQuaternion(p),y.expandByPoint(Yt),Yt.copy(c.max).setX(c.min.x).applyQuaternion(p),y.expandByPoint(Yt),Yt.copy(c.max).applyQuaternion(p),y.expandByPoint(Yt),y.min.x-=i,y.min.y-=o,y.max.x+=s,y.max.y+=a,p.setFromUnitVectors(dT,f),_&&p.premultiply(fT.invert()),p.premultiply(this._yAxisUpSpace);const g=y.getSize(wt),m=y.getCenter(Yt).applyQuaternion(p);if($c(this._camera)){const v=this.getDistanceToFitBox(g.x,g.y,g.z,r);l.push(this.moveTo(m.x,m.y,m.z,t)),l.push(this.dollyTo(v,t)),l.push(this.setFocalOffset(0,0,0,t))}else if(Il(this._camera)){const v=this._camera,x=v.right-v.left,w=v.top-v.bottom,E=r?Math.max(x/g.x,w/g.y):Math.min(x/g.x,w/g.y);l.push(this.moveTo(m.x,m.y,m.z,t)),l.push(this.zoomTo(E,t)),l.push(this.setFocalOffset(0,0,0,t))}return Promise.all(l)}fitToSphere(e,t){const r=[],s=e instanceof lt.Sphere?hT.copy(e):Cr.createBoundingSphere(e,hT);if(r.push(this.moveTo(s.center.x,s.center.y,s.center.z,t)),$c(this._camera)){const o=this.getDistanceToFitSphere(s.radius);r.push(this.dollyTo(o,t))}else if(Il(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,l=2*s.radius,c=Math.min(o/l,a/l);r.push(this.zoomTo(c,t))}return r.push(this.setFocalOffset(0,0,0,t)),Promise.all(r)}setLookAt(e,t,r,i,s,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=sh.NONE,this._changedDolly=0;const l=Yt.set(i,s,o),c=wt.set(e,t,r);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(c.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const u=!a||Qt(this._target.x,this._targetEnd.x,this.restThreshold)&&Qt(this._target.y,this._targetEnd.y,this.restThreshold)&&Qt(this._target.z,this._targetEnd.z,this.restThreshold)&&Qt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Qt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Qt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(e,t,r,i,s,o,a,l,c,u,h,f,p,_=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=sh.NONE,this._changedDolly=0;const y=wt.set(i,s,o),g=Yt.set(e,t,r);Ss.setFromVector3(g.sub(y).applyQuaternion(this._yAxisUpSpace));const m=ah.set(u,h,f),v=Yt.set(a,l,c);cm.setFromVector3(v.sub(m).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(y.lerp(m,p));const x=cm.theta-Ss.theta,w=cm.phi-Ss.phi,E=cm.radius-Ss.radius;this._sphericalEnd.set(Ss.radius+E*p,Ss.phi+w*p,Ss.theta+x*p),this.normalizeRotations(),this._needsUpdate=!0,_||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const S=!_||Qt(this._target.x,this._targetEnd.x,this.restThreshold)&&Qt(this._target.y,this._targetEnd.y,this.restThreshold)&&Qt(this._target.z,this._targetEnd.z,this.restThreshold)&&Qt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Qt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Qt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(S)}setPosition(e,t,r,i=!1){return this.setLookAt(e,t,r,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,r,i=!1){const s=this.getPosition(wt),o=this.setLookAt(s.x,s.y,s.z,e,t,r,i);return this._sphericalEnd.phi=Qs(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,r,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,r),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const s=!i||Qt(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Qt(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Qt(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}setOrbitPoint(e,t,r){this._camera.updateMatrixWorld(),No.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Io.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Xc.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=wt.set(e,t,r),s=i.distanceTo(this._camera.position),o=i.sub(this._camera.position);No.multiplyScalar(o.x),Io.multiplyScalar(o.y),Xc.multiplyScalar(o.z),wt.copy(No).add(Io).add(Xc),wt.z=wt.z+s,this.dollyTo(s,!1),this.setFocalOffset(-wt.x,wt.y,-wt.z,!1),this.moveTo(e,t,r,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,r,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new lt.Vector4,typeof e=="number"?this._viewport.set(e,t,r,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,r,i=!1){if(cT(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const s=e/t,o=this._camera.getEffectiveFOV()*sm,a=this._camera.aspect;return((i?s>a:s<a)?t:e/a)*.5/Math.tan(o*.5)+r*.5}getDistanceToFitSphere(e){if(cT(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*sm,r=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:r;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new lt.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new lt.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof lt.Spherical?e:new lt.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new lt.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%oh,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=oh),this._spherical.theta+=oh*Math.round((this._sphericalEnd.theta-this._spherical.theta)/oh)}reset(e=!1){if(!Qt(this._camera.up.x,this._cameraUp0.x)||!Qt(this._camera.up.y,this._cameraUp0.y)||!Qt(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const r=this.getPosition(wt);this.updateCameraUp(),this.setPosition(r.x,r.y,r.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,W0),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=wt.subVectors(this._target,this._camera.position).normalize(),t=Yt.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const r=this.getPosition(wt);this.updateCameraUp(),this.setPosition(r.x,r.y,r.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,r=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,s=fL.subVectors(this._targetEnd,this._target),o=pL.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(gn(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=V0(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,e),this._needsUpdate=!0}if(gn(r))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=V0(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,e),this._needsUpdate=!0}if(gn(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=V0(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,e),this._needsUpdate=!0}if(gn(s.x)&&gn(s.y)&&gn(s.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;dL(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(gn(o.x)&&gn(o.y)&&gn(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;dL(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(gn(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=V0(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,e)}if(this.dollyToCursor){if($c(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,f=this._camera,p=this._getCameraDirection(lm),_=wt.copy(p).cross(f.up).normalize();_.lengthSq()===0&&(_.x=1);const y=Yt.crossVectors(_,p),g=this._sphericalEnd.radius*Math.tan(f.getEffectiveFOV()*sm*.5),v=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,x=ah.copy(this._targetEnd).add(_.multiplyScalar(this._dollyControlCoord.x*g*f.aspect)).add(y.multiplyScalar(this._dollyControlCoord.y*g)),w=wt.copy(this._targetEnd).lerp(x,v),E=this._lastDollyDirection===sh.IN&&this._spherical.radius<=this.minDistance,S=this._lastDollyDirection===sh.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(E||S)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const A=Yt.copy(p).multiplyScalar(-h);w.add(A)}this._boundary.clampPoint(w,w);const C=Yt.subVectors(w,this._targetEnd);this._targetEnd.copy(w),this._target.add(C),this._changedDolly-=h,gn(this._changedDolly)&&(this._changedDolly=0)}else if(Il(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,f=this._camera,p=wt.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(f.near+f.far)/(f.near-f.far)).unproject(f),_=Yt.set(0,0,-1).applyQuaternion(f.quaternion),y=ah.copy(p).add(_.multiplyScalar(-p.dot(f.up))),m=-(this._zoom-h-this._zoom)/this._zoom,v=this._getCameraDirection(lm),x=this._targetEnd.dot(v),w=wt.copy(this._targetEnd).lerp(y,m),E=w.dot(v),S=v.multiplyScalar(E-x);w.sub(S),this._boundary.clampPoint(w,w);const C=Yt.subVectors(w,this._targetEnd);this._targetEnd.copy(w),this._target.add(C),this._changedZoom-=h,gn(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!gn(this._focalOffset.x)||!gn(this._focalOffset.y)||!gn(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),No.setFromMatrixColumn(this._camera.matrix,0),Io.setFromMatrixColumn(this._camera.matrix,1),Xc.setFromMatrixColumn(this._camera.matrix,2),No.multiplyScalar(this._focalOffset.x),Io.multiplyScalar(-this._focalOffset.y),Xc.multiplyScalar(this._focalOffset.z),wt.copy(No).add(Io).add(Xc),this._camera.position.add(wt)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),wt.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const u=this._needsUpdate;return u&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):u?(this.dispatchEvent({type:"update"}),gn(t,this.restThreshold)&&gn(r,this.restThreshold)&&gn(i,this.restThreshold)&&gn(s.x,this.restThreshold)&&gn(s.y,this.restThreshold)&&gn(s.z,this.restThreshold)&&gn(o.x,this.restThreshold)&&gn(o.y,this.restThreshold)&&gn(o.z,this.restThreshold)&&gn(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!u&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=u,this._needsUpdate=!1,u}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:om(this.maxDistance),minZoom:this.minZoom,maxZoom:om(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:om(this.maxPolarAngle),minAzimuthAngle:om(this.minAzimuthAngle),maxAzimuthAngle:om(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:wt.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const r=JSON.parse(e);this.enabled=r.enabled,this.minDistance=r.minDistance,this.maxDistance=am(r.maxDistance),this.minZoom=r.minZoom,this.maxZoom=am(r.maxZoom),this.minPolarAngle=r.minPolarAngle,this.maxPolarAngle=am(r.maxPolarAngle),this.minAzimuthAngle=am(r.minAzimuthAngle),this.maxAzimuthAngle=am(r.maxAzimuthAngle),this.smoothTime=r.smoothTime,this.draggingSmoothTime=r.draggingSmoothTime,this.dollySpeed=r.dollySpeed,this.truckSpeed=r.truckSpeed,this.dollyToCursor=r.dollyToCursor,this.verticalDragToForward=r.verticalDragToForward,this._target0.fromArray(r.target0),this._position0.fromArray(r.position0),this._zoom0=r.zoom0,this._focalOffset0.fromArray(r.focalOffset0),this.moveTo(r.target[0],r.target[1],r.target[2],t),Ss.setFromVector3(wt.fromArray(r.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Ss.theta,Ss.phi,t),this.dollyTo(Ss.radius,t),this.zoomTo(r.zoom,t),this.setFocalOffset(r.focalOffset[0],r.focalOffset[1],r.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Bq),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,r){const i=t.lengthSq();if(i===0)return e;const s=Yt.copy(t).add(e),a=this._boundary.clampPoint(s,ah).sub(s),l=a.lengthSq();if(l===0)return e.add(t);if(l===i)return e;if(r===0)return e.add(t).add(a);{const c=1+r*l/t.dot(a);return e.add(Yt.copy(t).multiplyScalar(c)).add(a.multiplyScalar(1-r))}}_updateNearPlaneCorners(){if($c(this._camera)){const e=this._camera,t=e.near,r=e.getEffectiveFOV()*sm,i=Math.tan(r*.5)*t,s=i*e.aspect;this._nearPlaneCorners[0].set(-s,-i,0),this._nearPlaneCorners[1].set(s,-i,0),this._nearPlaneCorners[2].set(s,i,0),this._nearPlaneCorners[3].set(-s,i,0)}else if(Il(this._camera)){const e=this._camera,t=1/e.zoom,r=e.left*t,i=e.right*t,s=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(r,s,0),this._nearPlaneCorners[1].set(i,s,0),this._nearPlaneCorners[2].set(i,o,0),this._nearPlaneCorners[3].set(r,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||cT(this._camera,"_collisionTest"))return e;const r=this._getTargetDirection(lm);pT.lookAt(hL,r,this._camera.up);for(let i=0;i<4;i++){const s=Yt.copy(this._nearPlaneCorners[i]);s.applyMatrix4(pT);const o=ah.addVectors(this._target,s);Y0.set(o,r),Y0.far=this._spherical.radius+1;const a=Y0.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const r=()=>{this.removeEventListener("rest",r),t()};this.addEventListener("rest",r)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new lt.Sphere){const r=t,i=r.center;lh.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&lh.expandByObject(o)}),lh.getCenter(i);let s=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o,l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const u=l.attributes.position;for(let h=0,f=u.count;h<f;h++)wt.fromBufferAttribute(u,h),s=Math.max(s,i.distanceToSquared(wt))}),r.radius=Math.sqrt(s),r}}async function uu(n=1e-4){const e=F().getActiveCamera(),t=F().getActiveControls(),r=t.azimuthAngle,i=t.polarAngle;e.position.set(e.position.x+n,e.position.y+n,e.position.z+n),await t.setTarget(e.position.x,e.position.y,e.position.z),t.azimuthAngle=r,t.polarAngle=i,e.position.set(e.position.x-n,e.position.y-n,e.position.z-n)}function Vq(){const n=F().getActiveCamera(),e=new N;F().getActiveControls().getPosition(e);const t=e.x.toFixed(1),r=e.y.toFixed(1),i=e.z.toFixed(1),s=n.position.x.toFixed(1),o=n.position.y.toFixed(1),a=n.position.z.toFixed(1);if(t===s&&r===o&&a===i){const l=new N;F().getActiveControls().getTarget(l);const c=new N;c.subVectors(l,e).normalize();const u=new N;u.copy(e).addScaledVector(c,3),F().getActiveControls().setTarget(u.x,u.y,u.z)}}function Gq(n){const e={MOUSE:n9,Vector2:gt,Vector3:N,Vector4:Cn,Quaternion:Wn,Matrix4:ot,Spherical:jK,Box3:et,Sphere:Tv,Raycaster:qU,MathUtils:{DEG2RAD:Fg.DEG2RAD,clamp:Fg.clamp}};Cr.install({THREE:e}),n.__controls3d=new Cr(n.__camera3d,n.__renderer.domElement),n.__controls3d.mouseButtons.wheel=Cr.ACTION.DOLLY,n.__controls3d.infinityDolly=!0,n.__controls3d.dollySpeed=We.getState().controllerDollySpeed,n.__controls3d.minDistance=We.getState().controllerDollyMinDistance,n.__controls3d.dollyToCursor=!0,n.__controls3d.boundaryFriction=0,n.__controls3d.truckSpeed=2,n.__controls3d.smoothTime=0,n.__controls3d.touches.one=Cr.ACTION.TOUCH_ROTATE,n.__controls3d.touches.two=Cr.ACTION.TOUCH_DOLLY_TRUCK,n.__controls3d.touches.three=Cr.ACTION.TOUCH_TRUCK,n.__controls3d.saveState(),document.addEventListener("mousewheel",()=>{n.__camera3d===n.__activeCamera&&Vq()}),n.__controls3d.setPosition(0,0,0,!0);const t=new ih("KeyW"),r=new ih("KeyA"),i=new ih("KeyS"),s=new ih("KeyD"),o=new ih("KeyE"),a=new ih("KeyQ");let l=!1,c=!1;const u=new Set;window.addEventListener("keydown",_=>{_.shiftKey&&(l=_.shiftKey),_.code==="Space"&&(c=!0),u.add(_.key)}),window.addEventListener("keyup",_=>{l=_.shiftKey,c=!1,u.delete(_.key)}),t.addEventListener(St.HOLD_START,()=>{uu()}),o.addEventListener(St.HOLD_START,()=>{u.has("w")||uu()}),a.addEventListener(St.HOLD_START,()=>{u.has("w")||uu()}),r.addEventListener(St.HOLD_START,()=>{uu()}),i.addEventListener(St.HOLD_START,()=>{uu()}),s.addEventListener(St.HOLD_START,()=>{uu()});const h=.002,f=.006,p=.006;r.addEventListener(St.HOLDING,_=>{const y=l?f:h;n.__controls3d.truck(-y*_.deltaTime,0,!1)}),s.addEventListener(St.HOLDING,_=>{const y=l?f:h;n.__controls3d.truck(y*_.deltaTime,0,!1)}),o.addEventListener(St.HOLDING,_=>{const g=(l?f:h)*_.deltaTime;n.__controls3d.elevate(-g,!1)}),a.addEventListener(St.HOLDING,_=>{const g=(l?f:h)*_.deltaTime;n.__controls3d.elevate(+g,!1)}),t.addEventListener(St.HOLDING,_=>{const y=l?f:h;c?(n.__controls3d.dollyInFixed(p*_.deltaTime,!1),n.forceRenderNextFrame()):n.__controls3d.forward(y*_.deltaTime,!1)}),i.addEventListener(St.HOLDING,_=>{const y=l?f:h;c?(n.__controls3d.dollyInFixed(-p*_.deltaTime,!1),n.forceRenderNextFrame()):n.__controls3d.forward(-y*_.deltaTime,!1)}),n.__controls3d.addEventListener("wake",()=>{n.__sceneController.toolsController.activeTool&&(n.__cameraMoving=!0)}),n.__controls3d.addEventListener("controlend",()=>{n.__cameraMoving=!1}),n.__controls2d=new Cr(n.__camera2d,n.__renderer.domElement),n.__controls2d.mouseButtons.wheel=Cr.ACTION.ZOOM,n.__controls2d.mouseButtons.left=Cr.ACTION.TRUCK,n.__controls2d.minDistance=1,n.__controls2d.boundaryFriction=5,n.__controls2d.truckSpeed=2,n.__controls2d.smoothTime=1,n.__controls2d.enabled=!1,n.__controls2d.saveState(),n.__controls2d.addEventListener("wake",async()=>{n.__sceneController.toolsController.activeTool&&(n.__cameraMoving=!0)}),n.__controls2d.addEventListener("controlend",()=>{n.__cameraMoving=!1}),n.__controlsActive=n.__controls3d}const Kn=Ir(n=>({activated:!1,activate:()=>n(()=>({activated:!0})),deactivate:()=>n(()=>({activated:!1})),message:"",header:""}));Jt.enabled=!1;function Wq(n,e){typeof e=="string"?(n.__threeCanvas=document.getElementById(e),n.__renderer=new kx({antialias:!UC,canvas:n.__threeCanvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"})):(n.__threeCanvas=e,n.__renderer=new kx({antialias:!UC,canvas:e,logarithmicDepthBuffer:!1,powerPreference:"high-performance"})),n.__renderer.outputColorSpace=ol,n.__renderer.setSize(window.innerWidth,window.innerHeight),n.__renderer.setPixelRatio(n.__pixelRatio),n.__renderer.localClippingEnabled=!0,n.__css2DRenderer=new HK,n.__css2DRenderer.domElement.style.position="absolute",n.__css2DRenderer.domElement.style.pointerEvents="none",document.body.appendChild(n.__css2DRenderer.domElement),n.__renderer.getContext().canvas.addEventListener("webglcontextlost",function(t){t.preventDefault(),Kn.setState({activated:!0,message:`Ohh no! Looks like we ran out of resources.
 This can happen if you load to big model for you hardware/or just to many open at the same time.
Refresh page and try and not have to many models open at the same time.`,header:"Lost context"})},!1)}function Yq(n){n.__camera3d=new Ni(60,window.innerWidth/window.innerHeight,.1,1e4),n.__camera2d=new VA(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,.1,1e4),n.__camera2d.zoom=0,n.__activeCamera=n.__camera3d}const uy=new Set,it=Ir(n=>({loadingData:!1,activateLoadingData:()=>n(()=>({loadingData:!0})),deactivateLoadingData:()=>n(()=>({loadingData:!1})),dialogContent:"",dialogHeader:""}));var fF=Symbol.for("immer-nothing"),vL=Symbol.for("immer-draftable"),ms=Symbol.for("immer-state");function co(n,...e){throw new Error(`[Immer] minified error nr: ${n}. Full error at: https://bit.ly/3cXEKWf`)}var op=Object.getPrototypeOf;function ap(n){return!!n&&!!n[ms]}function od(n){var e;return n?pF(n)||Array.isArray(n)||!!n[vL]||!!((e=n.constructor)!=null&&e[vL])||eS(n)||tS(n):!1}var Kq=Object.prototype.constructor.toString();function pF(n){if(!n||typeof n!="object")return!1;const e=op(n);if(e===null)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===Kq}function dy(n,e){Jw(n)===0?Reflect.ownKeys(n).forEach(t=>{e(t,n[t],n)}):n.forEach((t,r)=>e(r,t,n))}function Jw(n){const e=n[ms];return e?e.type_:Array.isArray(n)?1:eS(n)?2:tS(n)?3:0}function Pb(n,e){return Jw(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function mF(n,e,t){const r=Jw(n);r===2?n.set(e,t):r===3?n.add(t):n[e]=t}function $q(n,e){return n===e?n!==0||1/n===1/e:n!==n&&e!==e}function eS(n){return n instanceof Map}function tS(n){return n instanceof Set}function du(n){return n.copy_||n.base_}function kb(n,e){if(eS(n))return new Map(n);if(tS(n))return new Set(n);if(Array.isArray(n))return Array.prototype.slice.call(n);if(!e&&pF(n))return op(n)?{...n}:Object.assign(Object.create(null),n);const t=Object.getOwnPropertyDescriptors(n);delete t[ms];let r=Reflect.ownKeys(t);for(let i=0;i<r.length;i++){const s=r[i],o=t[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:n[s]})}return Object.create(op(n),t)}function BM(n,e=!1){return nS(n)||ap(n)||!od(n)||(Jw(n)>1&&(n.set=n.add=n.clear=n.delete=Xq),Object.freeze(n),e&&Object.entries(n).forEach(([t,r])=>BM(r,!0))),n}function Xq(){co(2)}function nS(n){return Object.isFrozen(n)}var qq={};function ad(n){const e=qq[n];return e||co(0,n),e}var nv;function gF(){return nv}function Zq(n,e){return{drafts_:[],parent_:n,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function _L(n,e){e&&(ad("Patches"),n.patches_=[],n.inversePatches_=[],n.patchListener_=e)}function Lb(n){Ob(n),n.drafts_.forEach(Qq),n.drafts_=null}function Ob(n){n===nv&&(nv=n.parent_)}function xL(n){return nv=Zq(nv,n)}function Qq(n){const e=n[ms];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function yL(n,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return n!==void 0&&n!==t?(t[ms].modified_&&(Lb(e),co(4)),od(n)&&(n=hy(e,n),e.parent_||fy(e,n)),e.patches_&&ad("Patches").generateReplacementPatches_(t[ms].base_,n,e.patches_,e.inversePatches_)):n=hy(e,t,[]),Lb(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),n!==fF?n:void 0}function hy(n,e,t){if(nS(e))return e;const r=e[ms];if(!r)return dy(e,(i,s)=>wL(n,r,e,i,s,t)),e;if(r.scope_!==n)return e;if(!r.modified_)return fy(n,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const i=r.copy_;let s=i,o=!1;r.type_===3&&(s=new Set(i),i.clear(),o=!0),dy(s,(a,l)=>wL(n,r,i,a,l,t,o)),fy(n,i,!1),t&&n.patches_&&ad("Patches").generatePatches_(r,t,n.patches_,n.inversePatches_)}return r.copy_}function wL(n,e,t,r,i,s,o){if(ap(i)){const a=s&&e&&e.type_!==3&&!Pb(e.assigned_,r)?s.concat(r):void 0,l=hy(n,i,a);if(mF(t,r,l),ap(l))n.canAutoFreeze_=!1;else return}else o&&t.add(i);if(od(i)&&!nS(i)){if(!n.immer_.autoFreeze_&&n.unfinalizedDrafts_<1)return;hy(n,i),(!e||!e.scope_.parent_)&&typeof r!="symbol"&&Object.prototype.propertyIsEnumerable.call(t,r)&&fy(n,i)}}function fy(n,e,t=!1){!n.parent_&&n.immer_.autoFreeze_&&n.canAutoFreeze_&&BM(e,t)}function Jq(n,e){const t=Array.isArray(n),r={type_:t?1:0,scope_:e?e.scope_:gF(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:n,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,s=HM;t&&(i=[r],s=rv);const{revoke:o,proxy:a}=Proxy.revocable(i,s);return r.draft_=a,r.revoke_=o,a}var HM={get(n,e){if(e===ms)return n;const t=du(n);if(!Pb(t,e))return eZ(n,t,e);const r=t[e];return n.finalized_||!od(r)?r:r===mT(n.base_,e)?(gT(n),n.copy_[e]=Ub(r,n)):r},has(n,e){return e in du(n)},ownKeys(n){return Reflect.ownKeys(du(n))},set(n,e,t){const r=vF(du(n),e);if(r!=null&&r.set)return r.set.call(n.draft_,t),!0;if(!n.modified_){const i=mT(du(n),e),s=i==null?void 0:i[ms];if(s&&s.base_===t)return n.copy_[e]=t,n.assigned_[e]=!1,!0;if($q(t,i)&&(t!==void 0||Pb(n.base_,e)))return!0;gT(n),Db(n)}return n.copy_[e]===t&&(t!==void 0||e in n.copy_)||Number.isNaN(t)&&Number.isNaN(n.copy_[e])||(n.copy_[e]=t,n.assigned_[e]=!0),!0},deleteProperty(n,e){return mT(n.base_,e)!==void 0||e in n.base_?(n.assigned_[e]=!1,gT(n),Db(n)):delete n.assigned_[e],n.copy_&&delete n.copy_[e],!0},getOwnPropertyDescriptor(n,e){const t=du(n),r=Reflect.getOwnPropertyDescriptor(t,e);return r&&{writable:!0,configurable:n.type_!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty(){co(11)},getPrototypeOf(n){return op(n.base_)},setPrototypeOf(){co(12)}},rv={};dy(HM,(n,e)=>{rv[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});rv.deleteProperty=function(n,e){return rv.set.call(this,n,e,void 0)};rv.set=function(n,e,t){return HM.set.call(this,n[0],e,t,n[0])};function mT(n,e){const t=n[ms];return(t?du(t):n)[e]}function eZ(n,e,t){var i;const r=vF(e,t);return r?"value"in r?r.value:(i=r.get)==null?void 0:i.call(n.draft_):void 0}function vF(n,e){if(!(e in n))return;let t=op(n);for(;t;){const r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=op(t)}}function Db(n){n.modified_||(n.modified_=!0,n.parent_&&Db(n.parent_))}function gT(n){n.copy_||(n.copy_=kb(n.base_,n.scope_.immer_.useStrictShallowCopy_))}var tZ=class{constructor(n){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,r)=>{if(typeof e=="function"&&typeof t!="function"){const s=t;t=e;const o=this;return function(l=s,...c){return o.produce(l,u=>t.call(this,u,...c))}}typeof t!="function"&&co(6),r!==void 0&&typeof r!="function"&&co(7);let i;if(od(e)){const s=xL(this),o=Ub(e,void 0);let a=!0;try{i=t(o),a=!1}finally{a?Lb(s):Ob(s)}return _L(s,r),yL(i,s)}else if(!e||typeof e!="object"){if(i=t(e),i===void 0&&(i=e),i===fF&&(i=void 0),this.autoFreeze_&&BM(i,!0),r){const s=[],o=[];ad("Patches").generateReplacementPatches_(e,i,s,o),r(s,o)}return i}else co(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(o,...a)=>this.produceWithPatches(o,l=>e(l,...a));let r,i;return[this.produce(e,t,(o,a)=>{r=o,i=a}),r,i]},typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze),typeof(n==null?void 0:n.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(n.useStrictShallowCopy)}createDraft(n){od(n)||co(8),ap(n)&&(n=nZ(n));const e=xL(this),t=Ub(n,void 0);return t[ms].isManual_=!0,Ob(e),t}finishDraft(n,e){const t=n&&n[ms];(!t||!t.isManual_)&&co(9);const{scope_:r}=t;return _L(r,e),yL(void 0,r)}setAutoFreeze(n){this.autoFreeze_=n}setUseStrictShallowCopy(n){this.useStrictShallowCopy_=n}applyPatches(n,e){let t;for(t=e.length-1;t>=0;t--){const i=e[t];if(i.path.length===0&&i.op==="replace"){n=i.value;break}}t>-1&&(e=e.slice(t+1));const r=ad("Patches").applyPatches_;return ap(n)?r(n,e):this.produce(n,i=>r(i,e))}};function Ub(n,e){const t=eS(n)?ad("MapSet").proxyMap_(n,e):tS(n)?ad("MapSet").proxySet_(n,e):Jq(n,e);return(e?e.scope_:gF()).drafts_.push(t),t}function nZ(n){return ap(n)||co(10,n),_F(n)}function _F(n){if(!od(n)||nS(n))return n;const e=n[ms];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=kb(n,e.scope_.immer_.useStrictShallowCopy_)}else t=kb(n,!0);return dy(t,(r,i)=>{mF(t,r,_F(i))}),e&&(e.finalized_=!1),t}var gs=new tZ,kt=gs.produce;gs.produceWithPatches.bind(gs);gs.setAutoFreeze.bind(gs);gs.setUseStrictShallowCopy.bind(gs);gs.applyPatches.bind(gs);gs.createDraft.bind(gs);gs.finishDraft.bind(gs);function gr(){return crypto.randomUUID()}const Ot=Ir(n=>({isOpen:!1,viewModeListMode:!1,editMode:!0,activeTab:"FILTER",currentSet:{name:"Default set",projectKey:"",UUID:gr(),colorOverride:[],viewPoints:[],filter:[],layerFilter:null,setFilter:null},updateUUID:()=>n(kt(e=>{e.currentSet.UUID=gr()})),clearSet:()=>{n(kt(e=>{e.currentSet={name:"Default set",projectKey:"",UUID:gr(),colorOverride:[],viewPoints:[],filter:[],layerFilter:null,setFilter:null}}))},setProjectKey:e=>n(kt(t=>{t.currentSet.projectKey=e})),addLink:(e,t)=>n(kt(r=>{r.currentSet.viewPoints[t].links.push(e)})),deleteLink:(e,t)=>n(kt(r=>{r.currentSet.viewPoints[e].links.splice(t,1)})),updateLinkLabel:(e,t,r)=>n(kt(i=>{i.currentSet.viewPoints[e].links[t].label=r})),updateLinkUrl:(e,t,r)=>n(kt(i=>{i.currentSet.viewPoints[e].links[t].url=r})),addColor:e=>n(kt(t=>{t.currentSet.colorOverride.push(e)})),updateColorItemName:(e,t)=>n(kt(r=>{r.currentSet.colorOverride[e].name=t})),updateColorColorName:(e,t)=>n(kt(r=>{r.currentSet.colorOverride[e].color=t})),updateColorOperator:(e,t)=>n(kt(r=>{r.currentSet.colorOverride[e].operator=t})),deleteColor:e=>n(kt(t=>{t.currentSet.colorOverride.splice(e,1)})),pushDownColor:e=>n(kt(t=>{const r=t.currentSet.colorOverride.length-1;if(e<r){const i=t.currentSet.colorOverride.splice(e,1);t.currentSet.colorOverride.splice(e+1,0,i[0])}})),pushUpColor:e=>n(kt(t=>{if(e>0){const r=t.currentSet.colorOverride.splice(e,1);t.currentSet.colorOverride.splice(e-1,0,r[0])}})),addViewPoint:e=>n(kt(t=>{t.currentSet.viewPoints.push(e)})),updateViewpointName:(e,t)=>n(kt(r=>{r.currentSet.viewPoints[e].name=t})),updateViewpointComment:(e,t)=>n(kt(r=>{r.currentSet.viewPoints[e].comment=t})),updateViewpointSelect:(e,t)=>n(kt(r=>{r.currentSet.viewPoints[e].selectedFullName=t})),deleteViewpoint:e=>n(kt(t=>{t.currentSet.viewPoints.splice(e,1)})),updateViewpoint:(e,t)=>n(kt(r=>{r.currentSet.viewPoints[e].controllerPosition=t.controllerPosition,r.currentSet.viewPoints[e].controllerTarget=t.controllerTarget,r.currentSet.viewPoints[e].z_plane_visible=t.z_plane_visible,r.currentSet.viewPoints[e].y_plane_visible=t.y_plane_visible,r.currentSet.viewPoints[e].x_plane_visible=t.x_plane_visible,r.currentSet.viewPoints[e].z_plane_enable=t.z_plane_enable,r.currentSet.viewPoints[e].y_plane_enable=t.y_plane_enable,r.currentSet.viewPoints[e].x_plane_enable=t.x_plane_enable,r.currentSet.viewPoints[e].z_plane_neg=t.z_plane_neg,r.currentSet.viewPoints[e].y_plane_neg=t.y_plane_neg,r.currentSet.viewPoints[e].x_plane_neg=t.x_plane_neg,r.currentSet.viewPoints[e].z_plane_offset=t.z_plane_offset,r.currentSet.viewPoints[e].x_plane_offset=t.x_plane_offset,r.currentSet.viewPoints[e].y_plane_offset=t.y_plane_offset,r.currentSet.viewPoints[e].boxClippingEnabled=t.boxClippingEnabled,r.currentSet.viewPoints[e].boxClippingMaxX=t.boxClippingMaxX,r.currentSet.viewPoints[e].boxClippingMaxY=t.boxClippingMaxY,r.currentSet.viewPoints[e].boxClippingMaxZ=t.boxClippingMaxZ,r.currentSet.viewPoints[e].boxClippingMinX=t.boxClippingMinX,r.currentSet.viewPoints[e].boxClippingMinY=t.boxClippingMinY,r.currentSet.viewPoints[e].boxClippingMinZ=t.boxClippingMinZ})),pushDownViewpoint:e=>n(kt(t=>{const r=t.currentSet.viewPoints.length-1;if(e<r){const i=t.currentSet.viewPoints.splice(e,1);t.currentSet.viewPoints.splice(e+1,0,i[0])}})),pushUpViewpoint:e=>n(kt(t=>{if(e>0){const r=t.currentSet.viewPoints.splice(e,1);t.currentSet.viewPoints.splice(e-1,0,r[0])}})),addFilter:e=>n(kt(t=>{e?t.currentSet.filter.push([e]):t.currentSet.filter.push([{filtertype:"Append",max:{x:1,y:1,z:1},min:{x:1,y:1,z:1},type:"Standard",expression:[{input:"",operator:"Contains"}],uuid:gr()}])})),removeAllFilters:()=>n(kt(e=>{e.currentSet.filter=[]})),removeFilter:e=>n(kt(t=>{t.currentSet.filter.splice(e,1)})),addSubFilter:(e,t)=>n(kt(r=>{r.currentSet.filter[e].push(t)})),updateBoundingFilter:(e,t,r)=>n(kt(i=>{i.currentSet.filter[e][t].max.x=r.max.x,i.currentSet.filter[e][t].max.y=r.max.y,i.currentSet.filter[e][t].max.z=r.max.z,i.currentSet.filter[e][t].min.x=r.min.x,i.currentSet.filter[e][t].min.y=r.min.y,i.currentSet.filter[e][t].min.z=r.min.z})),filterPushUp:(e,t)=>n(kt(r=>{if(t>0){const i=r.currentSet.filter[e].splice(t,1);r.currentSet.filter[e].splice(t-1,0,i[0])}})),filterPushDown:(e,t)=>n(kt(r=>{const i=r.currentSet.filter[t].length-1;if(t<i){const s=r.currentSet.filter[e].splice(t,1);r.currentSet.filter[e].splice(t+1,0,s[0])}})),addExpression:(e,t,r)=>n(kt(i=>{i.currentSet.filter[e][t].expression.push(r)})),setFilterType:(e,t,r)=>n(kt(i=>{i.currentSet.filter[e][t].filtertype=r})),setExpressionValue:(e,t,r,i)=>n(kt(s=>{s.currentSet.filter[e][t].expression[r].input=i})),setExpressionOperator:(e,t,r,i)=>n(kt(s=>{s.currentSet.filter[e][t].expression[r].operator=i})),removeExpression:(e,t,r)=>n(kt(i=>{i.currentSet.filter[e][t].expression.splice(r,1),i.currentSet.filter[e][t].expression.length===0&&i.currentSet.filter[e].splice(t,1),i.currentSet.filter[e][0]||i.currentSet.filter.splice(e,1)})),removeBoundingFilter:(e,t)=>n(kt(r=>{r.currentSet.filter[e].splice(t,1),r.currentSet.filter[e][0]||r.currentSet.filter.splice(e,1)})),setAsBoundingboxFilter:(e,t)=>n(kt(r=>{r.currentSet.filter[e][t].type="Boundingbox"})),setAsStandardFilter:(e,t)=>n(kt(r=>{r.currentSet.filter[e][t].type="Standard"}))}));let xF="no file opened";function rZ(){return xF}async function iZ(n,e,t){if(typeof showOpenFilePicker!="function"){Kn.setState({header:"error",message:"Your browser does not support filesystem Access Api, use newest Chrome/Edge"});return}const r={types:[{description:n,accept:{[e]:[t]}}],excludeAcceptAllOption:!0,multiple:!1},i=await showOpenFilePicker(r);if((i==null?void 0:i.length)>0){const s=await i[0].getFile();return xF=s==null?void 0:s.name,await s.arrayBuffer()}}const py=new Set;function sZ(n,e){return new Promise(async t=>{Array.from(py).forEach(i=>{i.handleEvent&&(i.handleEvent(n,e)||py.delete(i))}),t(null)})}async function yF(){Xe.getState().enabled||Bt.toggleClipping();const e=await Bt.resizeToSelected(new N(2,2,2)),t=new N;e.getCenter(t),F().setOrbitOn(t)}async function oZ(){Xe.getState().enabled||Bt.toggleClipping();const e=await Bt.resizeToSelected(new N(2,2,2),new N(0,0,-1)),t=new N;e.getCenter(t),F().setOrbitOn(t)}async function aZ(){Xe.getState().enabled||Bt.toggleClipping();const e=await Bt.resizeToSelected(new N(2,2,2),new N(0,0,1)),t=new N;e.getCenter(t),F().setOrbitOn(t)}async function wF(){Xe.getState().enabled||Bt.toggleClipping();const e=await Bt.resizeToSelected(new N(3,3,3)),t=new N;e.getCenter(t),F().setOrbitOn(t)}async function lZ(){Xe.getState().enabled||Bt.toggleClipping();const e=await Bt.resizeToSelected(new N(3,3,3),new N(0,0,-2)),t=new N;e.getCenter(t),F().setOrbitOn(t)}async function cZ(){Xe.getState().enabled||Bt.toggleClipping();const e=await Bt.resizeToSelected(new N(3,3,3),new N(0,0,2)),t=new N;e.getCenter(t),F().setOrbitOn(t)}const rS=gr(),uZ=rS+"=CHILDREN";if(window.web3dEvent!==!0){window.web3dEvent=!0;const n=new BroadcastChannel(rS);n.onmessage=async function(e){dZ(e)},window.addEventListener("beforeunload",async function(){SF({type:"window-closed",data:null})})}function SF(n){const e=new BroadcastChannel(uZ);e.postMessage(n),e.close()}async function dZ(n){var i,s,o,a,l,c,u,h,f,p,_;function e(y){if(typeof y=="string")try{return JSON.parse(y)}catch{return{}}else return(n==null?void 0:n.data)||{}}const t=e(n.data);if((globalThis.DEBUG||!1)&&console.log(t),(t==null?void 0:t.type)==="web3d-goto-selected"&&Array.isArray(t==null?void 0:t.rows)){if((t==null?void 0:t.rows.length)<1){Kn.setState({activated:!0,message:"You need to select one row"});return}it.setState({loadingData:!0,dialogContent:"please wait, collecting model data",dialogHeader:"Generating Model"}),await ae.selection_clear(!1);const y=t.rows[0],g=await ae.get_ids_from_fullnames([y]);if(g.length){const m=g[0];await ae.treeview_expand_from_id(m);const v=await ae.getKeyChildrenFromItem(m),x=await ae.getBoundingBoxFromName(y,!0);if(x){const E=new et(new N(x.x,x.y,x.z),new N(x.X,x.Y,x.Z)),S=new N;E.getCenter(S);const C=new N,A=F().getActiveControls();A.getPosition(C);const k=C.distanceTo(S);A.saveState(),A.setTarget(S.x,S.y,S.z);const T=k-5;A.dolly(T,!0).then(()=>{A.smoothTime=.2,A.saveState()})}const w=[];(t.data==="box2x-transparent"||t.data==="box3x-transparent")&&w.push({uuid:"na",name:"",color:"gray:05",operator:"Contains"}),(t.data==="box2x-white"||t.data==="box3x-white")&&w.push({uuid:"na",name:"",color:"white",operator:"Contains"}),(i=t.data)!=null&&i.includes("normal-reset")&&(Bt.disable(),w.push({uuid:"na",name:"!RESET!",color:"white",operator:"Equal"})),w.length&&await ae.filter_geometry([],w),await ae.selection_add([m].concat(v)),await ae.selection_append(),(s=t.data)!=null&&s.startsWith("box")&&(t.data.includes("box2x")?yF():wF()),Mt.getState().updateToggel()}else Kn.setState({activated:!0,message:`Unable to find tag: ${y}`});it.setState({loadingData:!1,dialogContent:"please wait, collecting model data",dialogHeader:"Generating Model"})}if((o=t==null?void 0:t.type)!=null&&o.includes("web3d-add-to-set")&&Array.isArray(t==null?void 0:t.rows)){await ae.selection_clear(!1);const y=[],g=[],m=((a=t==null?void 0:t.colors)==null?void 0:a.map(x=>x||"yellow:100"))||[];for(let x=0;x<t.rows.length;x++){const w=t.rows[x];if(w){y.push(w);const E=m[x];E&&g.push(`${w}	${E}`)}}const v=Ot.getState();Ot.setState({activeTab:"FILTER",isOpen:!0}),v.addFilter({filtertype:"Append",max:{x:1,y:1,z:1},min:{x:1,y:1,z:1},type:"Standard",expression:[{input:y.join(`
`),operator:"In"}],uuid:gr()}),g.length&&v.addColor({uuid:gr(),name:g.join(`
`),color:"",operator:"In"}),v.updateUUID(),Mt.getState().updateToggel()}if((l=t==null?void 0:t.type)!=null&&l.includes("web3d-add-selection")&&Array.isArray(t==null?void 0:t.rows)){const y=await ae.get_ids_from_fullnames(t==null?void 0:t.rows);await ae.selection_add(y),await ae.selection_append(),Mt.getState().updateToggel()}if((c=t==null?void 0:t.type)!=null&&c.includes("web3d-replace-selection")&&Array.isArray(t==null?void 0:t.rows)){await ae.selection_clear(!1);const y=await ae.get_ids_from_fullnames(t==null?void 0:t.rows);await ae.selection_add(y),await ae.selection_append(),Mt.getState().updateToggel()}if((u=t==null?void 0:t.type)!=null&&u.includes("web3d-set-color")&&Array.isArray(t==null?void 0:t.rows)){it.setState({loadingData:!0,dialogHeader:"please wait",dialogContent:"searching for elements add color"}),await ae.selection_clear(!1);const y=t==null?void 0:t.rows.map((v,x)=>({uuid:"na",name:v,color:(t==null?void 0:t.colors[x])||"yellow",operator:"Equal"}));let g=[];t.data==="transparent"&&g.push({uuid:"na",name:"",color:"gray:05",operator:"Contains"}),t.data==="white"&&g.push({uuid:"na",name:"",color:"white",operator:"Contains"}),t.data==="hide"&&g.push({uuid:"na",name:"",color:"green:0",operator:"Contains"}),Array.isArray(t.extra)&&(g=g.concat(t.extra));const m=g.concat(y);await ae.filter_geometry([],m),await ae.selection_append(),Mt.getState().updateToggel(),it.setState({loadingData:!1})}if((h=t==null?void 0:t.type)!=null&&h.includes("web3d-iframe-info")&&sZ(t.name,t.data),(f=t==null?void 0:t.type)!=null&&f.includes("web3d-treeview-toggle")&&mn.setState({treeViewActive:!mn.getState().treeViewActive}),(p=t==null?void 0:t.type)!=null&&p.includes("web3d-open-url")&&typeof(t==null?void 0:t.data)=="string"&&t!=null&&t.data.includes("http")&&window.open(t==null?void 0:t.data),(_=t==null?void 0:t.type)!=null&&_.includes("web3d-request-open-file")){const y=t==null?void 0:t.data;if(y&&t.responseChannel){const g=await iZ(y.description||"Missing",y.mime||"missing",y.extension||".unknown"),m=new BroadcastChannel(t.responseChannel);m.postMessage({type:"web3d-response-open-file",data:g}),m.close()}}if((t==null?void 0:t.type)==="web3d-request-selected-fullname-without-parents"){const y=await ae.get_fullnames_from_selection();if(t.responseChannel){const g=new BroadcastChannel(t.responseChannel);g.postMessage({type:"web3d-response-selected-fullname-without-parents",data:y}),g.close()}}if((t==null?void 0:t.type)==="web3d-request-selected-fullname-include-parents"){const y=await ae.get_fullnames_from_selection(!0);if(t.responseChannel){const g=new BroadcastChannel(t.responseChannel);g.postMessage({type:"web3d-response-selected-fullname-include-parents",data:y}),g.close()}}if((t==null?void 0:t.type)==="ping"&&t.responseChannel){const y=new BroadcastChannel(t.responseChannel);y.postMessage({type:"pong",data:null}),y.close()}}function ld(n,e){return new Promise(async t=>{const r=Array.from(uy),i=await ae.getDataExt(n);i.append=e,r.forEach(s=>{s.handleEvent&&(s.handleEvent(i)||uy.delete(s))}),SF({type:"web3d-user-select",data:i}),t(null)})}function hZ(n){n.__activeCamera.updateProjectionMatrix(),n.__threeCanvas.onpointerdown=async e=>{if(e.button!=0)return;const t=e.ctrlKey;if(e.altKey){const r=await Ox(e);if(r&&(n.__lastClick=r.point,e.altKey)){setTimeout(()=>{n.setOrbitOn()},20);return}}n.__sceneController.toolsController.isMeasureMode()||(setTimeout(()=>{n.__threeCanvas.onpointerup=null},300),n.__threeCanvas.onpointerup=async()=>{const r=await Ox(e);if(r!=null&&r.object&&r.object.__modelDBKeyIndex){if(typeof r.instanceId!="number"){n.__lastClick=r.point;const i=await ae.meta_find_key_from_face_index(r.object.__modelDBKeyIndex,r.faceIndex);if(i){t||await ae.selection_clear(!1),await ae.selection_is_selected(i)?await ae.selection_remove([i]):await ae.selection_add([i]),ld(i,t),await ae.selection_append(),await ae.treeview_expand_from_id(i);const s=ae.getRowOfKey(i);Mt.getState().updateToggel(s)}}else console.warn("intances mesh not supported atm");n.__forceRender=!0}})}}const EF=Ir(()=>({calls:0,frame:0,lines:0,points:0,triangles:0}));function rx(n){if(n.__renderDisabled){requestAnimationFrame(()=>rx(n));return}const e=bZ.getDelta(),t=n.__controlsActive.update(e);let r=!0;if(n.__animationCallback&&(r=n.__animationCallback(e,n)),!r){requestAnimationFrame(()=>rx(n));return}if((n.__forceRender||n.__sceneController.toolsController.isDisplayActive())&&n.__css2DRenderer.render(n.__sceneController.currentScene(),n.__activeCamera),t||n.__forceRender||n.__sceneController.toolsController.isMeasureMode()){clearTimeout(n.renderEffectTimer),n.__monitors&&n.__monitors.begin(),n.__forceRender=!1,n.__sceneController.toolsController.render(),t&&We.getState().enableItemCulling&&zM();const i=n.getActiveCamera().position.clone();n.__sceneController.__pointLight&&(n.__sceneController.__pointLight.position.x=i.x,n.__sceneController.__pointLight.position.y=i.y,n.__sceneController.__pointLight.position.z=i.z),Bt.beforeRender(),n.__renderer.render(n.__sceneController.currentScene(),n.__activeCamera),Bt.afterRender(),n.__monitors&&(EF.setState(n.__renderer.info.render),n.__monitors.end()),We.getState().enableAntiAliasing&&We.getState().enableAlphaHash&&(n.renderEffectTimer=setTimeout(()=>{n.renderEffect()},250))}n.__getGizmo().update(),requestAnimationFrame(()=>rx(n))}const TF={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class kp{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const fZ=new VA(-1,1,1,-1,0,1);class pZ extends xn{constructor(){super(),this.setAttribute("position",new Wt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Wt([0,2,0,0,2,0],2))}}const mZ=new pZ;class VM{constructor(e){this._mesh=new Be(mZ,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,fZ)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class gZ extends kp{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof fs?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Lw.clone(e.uniforms),this.material=new fs({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new VM(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class SL extends kp{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class vZ extends kp{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class _Z{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new gt);this._width=r.width,this._height=r.height,t=new zs(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Xa}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new gZ(TF),this.copyPass.material.blending=Fa,this.clock=new XU}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let i=0,s=this.passes.length;i<s;i++){const o=this.passes[i];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),o.needsSwap){if(r){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}SL!==void 0&&(o instanceof SL?r=!0:o instanceof vZ&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new gt);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class xZ extends kp{constructor(e,t,r=null,i=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new at}render(e,t,r){const i=e.autoClear;e.autoClear=!1;let s,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=i}}class yZ extends kp{constructor(e,t,r,i){super(),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=r!==void 0?r:0,this.clearAlpha=i!==void 0?i:0,this._oldClearColor=new at;const s=TF;this.copyUniforms=Lw.clone(s.uniforms),this.copyMaterial=new fs({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,premultipliedAlpha:!0,blending:CC}),this.fsQuad=new VM(this.copyMaterial)}dispose(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null),this.copyMaterial.dispose(),this.fsQuad.dispose()}setSize(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)}render(e,t,r){this.sampleRenderTarget||(this.sampleRenderTarget=new zs(r.width,r.height,{type:Xa}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");const i=wZ[Math.max(0,Math.min(this.sampleLevel,5))],s=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);const o=e.getClearAlpha(),a=1/i.length,l=1/32;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;const c={fullWidth:r.width,fullHeight:r.height,offsetX:0,offsetY:0,width:r.width,height:r.height},u=Object.assign({},this.camera.view);u.enabled&&Object.assign(c,u);for(let h=0;h<i.length;h++){const f=i[h];this.camera.setViewOffset&&this.camera.setViewOffset(c.fullWidth,c.fullHeight,c.offsetX+f[0]*.0625,c.offsetY+f[1]*.0625,c.width,c.height);let p=a;if(this.unbiased){const _=-.5+(h+.5)/i.length;p+=l*_}this.copyUniforms.opacity.value=p,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),h===0&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.setViewOffset&&u.enabled?this.camera.setViewOffset(u.fullWidth,u.fullHeight,u.offsetX,u.offsetY,u.width,u.height):this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=s,e.setClearColor(this._oldClearColor,o)}}const wZ=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];class SZ extends yZ{constructor(e,t,r,i){super(e,t,r,i),this.sampleLevel=0,this.accumulate=!1,this.accumulateIndex=-1}render(e,t,r,i){if(this.accumulate===!1){super.render(e,t,r,i),this.accumulateIndex=-1;return}const s=EZ[5];this.sampleRenderTarget===void 0&&(this.sampleRenderTarget=new zs(r.width,r.height,{type:Xa}),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget===void 0&&(this.holdRenderTarget=new zs(r.width,r.height,{type:Xa}),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulateIndex===-1&&(super.render(e,this.holdRenderTarget,r,i),this.accumulateIndex=0);const o=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);const a=e.getClearAlpha(),l=1/s.length;if(this.accumulateIndex>=0&&this.accumulateIndex<s.length){this.copyUniforms.opacity.value=l,this.copyUniforms.tDiffuse.value=t.texture;const u=Math.pow(2,this.sampleLevel);for(let h=0;h<u;h++){const f=this.accumulateIndex,p=s[f];if(this.camera.setViewOffset&&this.camera.setViewOffset(r.width,r.height,p[0]*.0625,p[1]*.0625,r.width,r.height),e.setRenderTarget(t),e.setClearColor(this.clearColor,this.clearAlpha),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.sampleRenderTarget),this.accumulateIndex===0&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e),this.accumulateIndex++,this.accumulateIndex>=s.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}e.setClearColor(this.clearColor,this.clearAlpha);const c=this.accumulateIndex*l;c>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,e.setRenderTarget(t),e.clear(),this.fsQuad.render(e)),c<1&&(this.copyUniforms.opacity.value=1-c,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,e.setRenderTarget(t),this.fsQuad.render(e)),e.autoClear=o,e.setClearColor(this._oldClearColor,a)}dispose(){super.dispose(),this.holdRenderTarget&&this.holdRenderTarget.dispose()}}const EZ=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]],TZ={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	
		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = OptimizedCineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class CZ extends kp{constructor(){super();const e=TZ;this.uniforms=Lw.clone(e.uniforms),this.material=new CK({name:e.name,uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fsQuad=new VM(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,(this._outputColorSpace!==e.outputColorSpace||this._toneMapping!==e.toneMapping)&&(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},Jt.getTransfer(this._outputColorSpace)===vn&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===fU?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===pU?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===mU?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===gU?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===vU?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===_U&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const bZ=new XU;class AZ{constructor(e){Q(this,"__renderer");Q(this,"__activeCamera");Q(this,"__camera3d");Q(this,"__controlsActive");Q(this,"__monitors");Q(this,"__threeCanvas");Q(this,"__spaceNavigatorEnabled");Q(this,"__sceneController");Q(this,"__orientationGizmo");Q(this,"__forceRender",!1);Q(this,"__clippingPlaneHelper");Q(this,"__offsetLeft",0);Q(this,"__offsetTop",0);Q(this,"__camera2d");Q(this,"__controls2d");Q(this,"__controls3d");Q(this,"__lastClick",new N);Q(this,"__css2DRenderer");Q(this,"__cameraMoving",!1);Q(this,"__movementHelperTimer");Q(this,"__rayWorker");Q(this,"__pixelRatio");Q(this,"__renderDisabled",!1);Q(this,"__animationCallback");Q(this,"__lastmove");Q(this,"renderEffect");Q(this,"renderEffectTimer",null);Uq().then(([t])=>{this.__rayWorker=t}),this.__pixelRatio=window.devicePixelRatio>1?1:window.devicePixelRatio,Wq(this,e),this.__sceneController=new kq(this),Yq(this),Gq(this),lL(this),hZ(this),this.__clippingPlaneHelper=new Oq(this),rx(this),this.setCameraMode("3D"),We.getState().isWebGlStatsActive&&this.__addStats(),this.renderEffect=()=>{const t=this.__renderer,r=this.__sceneController.currentScene(),i=this.__activeCamera,s=new _Z(t),o=new xZ(r,i);o.enabled=!1;const a=new SZ(r,i),l=new CZ;s.addPass(o),s.addPass(a),s.addPass(l),a.enabled=!0,a.sampleLevel=We.getState().enableAntiAliasingSamples,s.render()}}disableRender(){this.__renderDisabled=!0}enableRender(){this.__renderDisabled=!1,this.forceRenderNextFrame()}getClipping(){if(this.__clippingPlaneHelper)return this.__clippingPlaneHelper;throw"clipping not inisiated"}getCanvas(){return this.__threeCanvas}getActiveCamera(){return this.__activeCamera}setGizmoAxis(e){this.__orientationGizmo.onAxisSelected({axis:e,noSmartLogic:!0})}getActiveControls(){return this.__controlsActive}__getGizmo(){return this.__orientationGizmo}getRender(){return this.__renderer}async fitModelToCanvas(e=!1){const t=new N;if(this.getActiveControls().getTarget(t),e||t.x===0&&t.y===0&&t.y===0||isNaN(t.x)){const r=this.getSceneController().sceneBoundingBox;if(!r.max)return;const i=new et(r.min,r.max);if(!i.max)return;const s=this.getActiveControls().setPosition(0,0,500,!1),o=this.getActiveControls().fitToBox(i,!1,{paddingBottom:25,paddingLeft:25,paddingTop:25,paddingRight:25});await Promise.all([s,o]).then(()=>{this.getActiveControls().smoothTime=1,this.getActiveControls().saveState(),this.__forceRender=!0})}else this.__forceRender=!0}cameraToggle(){this.getCameraMode()==="3D"?this.setCameraMode("2D"):this.setCameraMode("3D")}getCameraMode(){return this.__activeCamera===this.__camera2d?"2D":"3D"}setCameraMode(e){e==="3D"?(this.__activeCamera=this.__camera3d,this.__controlsActive=this.__controls3d,this.__controls2d.enabled=!1,this.__controls3d.enabled=!0,this.__controls2d.saveState(),this.__controls3d.saveState(),sp.setState({mode:"3D"})):(this.__activeCamera=this.__camera2d,this.__controlsActive=this.__controls2d,this.__controls3d.enabled=!1,this.__controls2d.enabled=!0,this.__controls2d.saveState(),this.__controls3d.saveState(),sp.setState({mode:"2D"})),lL(this)}forceRenderNextFrame(){this.__forceRender=!0}addAnimationCallback(e){this.__animationCallback=e}async setOrbitOn(e){(this.__lastClick||e)&&(this.getActiveControls().smoothTime=.2,this.getActiveControls().saveState(),e?await this.__controlsActive.setTarget(e.x,e.y,e.z,!0):await this.__controlsActive.setTarget(this.__lastClick.x,this.__lastClick.y,this.__lastClick.z,!0),this.getActiveControls().smoothTime=1,this.getActiveControls().saveState())}setSize(e,t,r,i){this.__camera3d.aspect=e/t,this.__camera3d.updateProjectionMatrix(),this.__camera2d.left=window.innerWidth/-2,this.__camera2d.right=window.innerWidth/2,this.__camera2d.top=window.innerHeight/2,this.__camera2d.bottom=window.innerHeight/-2,this.__camera2d.updateProjectionMatrix(),this.__renderer.setSize(e,t),this.__renderer.domElement.style.left=r+"px",this.__renderer.domElement.style.top=i+"px",this.__css2DRenderer.setSize(e,t),this.__css2DRenderer.domElement.style.top=i+"px",this.__css2DRenderer.domElement.style.left=r+"px",this.__offsetLeft=r,this.__offsetTop=i,this.__forceRender=!0}__addStats(){this.__monitors||(this.__monitors=new ag,this.__monitors.showPanel(0),this.__monitors.dom.style.left=null,this.__monitors.dom.style.right="0px",this.__monitors.dom.style.top="125px",document.body.appendChild(this.__monitors.dom))}addStats(){this.__addStats()}removeStats(){this.__monitors&&(document.body.removeChild(this.__monitors.dom),this.__monitors=null)}getSceneController(){return this.__sceneController}enableSpaceNavigator(){this.__spaceNavigatorEnabled=!0}disableSpaceNavigator(){this.__spaceNavigatorEnabled=!1}toggleSpaceNavigator(){this.__spaceNavigatorEnabled=!this.__spaceNavigatorEnabled}}let my;function MZ(n){my||(my=new AZ(n))}function F(){return my}async function Ts(n){We.getState().enableItemCulling?await zM():await ae.reset_culling_all_meshes(),n&&F().forceRenderNextFrame()}function lp(n,e,t,r=0,i=!1,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){n&&n.r===0&&n.g===0&&n.b===0&&e===1&&(n=new at("gray"));let o=!0;e!==1&&(o=!1),We.getState().enableAlphaHash&&(o=!0);const a={transparent:e===1?!1:!We.getState().enableAlphaHash,depthWrite:o,wireframe:!1,alphaHash:e===1?!1:We.getState().enableAlphaHash,side:WK?$a:gi,color:n||void 0,vertexColors:t,opacity:e,polygonOffset:r!==0,polygonOffsetFactor:-r,polygonOffsetUnits:-r,flatShading:!0};t||delete a.vertexColors,t&&delete a.color;let l;return i?(delete a.flatShading,l=new al(a)):l=new YU(a),l.onBeforeCompile=c=>{const u=Xe.getState();c.batching=!1,c.uniforms.boxmin=new Ca(new N(u.minX,u.minY,u.minZ)),c.uniforms.boxmax=new Ca(new N(u.maxX,u.maxY,u.maxZ)),c.uniforms.boxEnabled=new Ca(u.enabled),c.uniforms.boxInverted=new Ca(u.inverted),c.uniforms.transformOverride=new Ca(new ot().fromArray(s)),c.uniforms.transform=new Ca(new ot),c.vertexShader=c.vertexShader.replace("#include <project_vertex>",`
            vec4 mvPosition = vec4( transformed, 1.0 );

            #ifdef USE_INSTANCING
            
                mvPosition = instanceMatrix * mvPosition;
            
            #endif
            
           mvPosition = transformOverride * mvPosition;

            mvPosition = transform * mvPosition;

            vPosition = mvPosition.xyz;

            mvPosition = modelViewMatrix * mvPosition;
            
            gl_Position = projectionMatrix * mvPosition;

            

            `),c.vertexShader=c.vertexShader.replace("void main() {",`
           
            uniform mat4 transform;
            uniform mat4 transformOverride;
            void main() {
            `),a.alphaHash?c.fragmentShader=c.fragmentShader.replace("void main() {",`
                uniform vec3 boxmin;
                uniform vec3 boxmax;
                uniform bool boxEnabled;
                uniform bool boxInverted;
             
                bool boxCheck = false;
                void main() {
                    if(boxEnabled){
                        if(vPosition.x<boxmin.x) {
                            boxCheck=true;
                        }
                        if(vPosition.x>boxmax.x) {
                            boxCheck=true;
                        }
                        if(vPosition.z<boxmin.z) {
                            boxCheck=true;
                        }
                        if(vPosition.z>boxmax.z) {
                            boxCheck=true;
                        }
                        if(vPosition.y<boxmin.y) {
                            boxCheck=true;
                        }
                        if(vPosition.y>boxmax.y) {
                            boxCheck=true;
                        }
    
                        if(boxInverted){
                            if(!boxCheck){
                                discard;
                            }
                        } else {
                            if(boxCheck){
                                discard;
                            }
                        }
                  
                    }
                    
            `):(c.vertexShader=c.vertexShader.replace("void main() {",`
                varying vec3 vPosition;
                void main() {
                    
                `),c.fragmentShader=c.fragmentShader.replace("void main() {",`
                uniform vec3 boxmin;
                uniform vec3 boxmax;
                uniform bool boxEnabled;
                uniform bool boxInverted;
                varying vec3 vPosition;
                bool boxCheck = false;
                void main() {
                    if(boxEnabled){
                        if(vPosition.x<boxmin.x) {
                            boxCheck=true;
                        }
                        if(vPosition.x>boxmax.x) {
                            boxCheck=true;
                        }
                        if(vPosition.z<boxmin.z) {
                            boxCheck=true;
                        }
                        if(vPosition.z>boxmax.z) {
                            boxCheck=true;
                        }
                        if(vPosition.y<boxmin.y) {
                            boxCheck=true;
                        }
                        if(vPosition.y>boxmax.y) {
                            boxCheck=true;
                        }
    
                        if(boxInverted){
                            if(!boxCheck){
                                discard;
                            }
                        } else {
                            if(boxCheck){
                                discard;
                            }
                        }
                  
                    }
                    
            `)),l.$shader=c},l}const CF="settingsStore_v4";function tn(){const n=JSON.parse(JSON.stringify(We.getState()));n.isOpen=!1,localStorage.setItem(CF,JSON.stringify(n))}async function RZ(){We.setState({isOpen:!0,lightAmbient:.8,lightPoint:2,backgroundColor:"#393939",controllerDollySpeed:.7,controllerDollyMinDistance:5,isWebGlStatsActive:!1,enableAlphaHash:!1,enableAntiAliasing:!1,enableAntiAliasingSamples:6,skipFustrumCulling:!1,freezeCurrentCulling:!1,enableItemCulling:!1,cullingDistance:25,cullingSize:2,occlusionCulling:!1}),tn(),We.getState().isWebGlStatsActive&&F().removeStats(),await Ts(!0);const n=F().getSceneController().currentScene();n.background=new at(We.getState().backgroundColor);const e=F().getSceneController();e.__ambientLight.intensity=We.getState().lightAmbient,e.__pointLight.intensity=We.getState().lightPoint,e.getMeshGroups().forEach(r=>{e.getMeshes(r).forEach(s=>{s.children.forEach(o=>{const a=o;a.material.opacity<1&&(a.material=lp(a.material.color,a.material.opacity,!1),a.$backupMaterial=a.material)})})}),F().forceRenderNextFrame()}const We=Ir(n=>({isOpen:!1,backgroundColor:"#393939",lightAmbient:.8,lightPoint:2,controllerDollySpeed:.7,controllerDollyMinDistance:5,isWebGlStatsActive:!1,enableAlphaHash:!1,enableAntiAliasing:!1,enableAntiAliasingSamples:6,enableItemCulling:!1,freezeCurrentCulling:!1,skipFustrumCulling:!0,occlusionCulling:!1,cullingSize:2,cullingDistance:25,settingsToggle:()=>{n(e=>({isOpen:!e.isOpen}))}})),EL=localStorage.getItem(CF);if(EL){const n=JSON.parse(EL);We.setState(n)}const un=Ir(n=>({modelGroups:null,unsyncedCount:0,groupLoadInfo:"",isOpen:!1,activateSyncDialog:()=>n(()=>({isOpen:!0})),deactivateSyncDialog:()=>n(()=>({isOpen:!1}))}));function TL(){const n=EF(),e=un();if(!We().isWebGlStatsActive)return null;function r(i){return new Intl.NumberFormat("de-DE",{style:"decimal"}).format(i).toString().replaceAll("."," ")}return d.jsx(d.Fragment,{children:d.jsx("div",{className:"fixed z-[90] right-[120px] top-[120px]",children:d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{children:[d.jsxs("span",{className:"m-2 text-white ",children:["calls:",n.calls]}),d.jsxs("span",{className:"m-2 text-white ",children:["triangles:",r(n.triangles)]})]}),e.groupLoadInfo?d.jsxs("span",{className:"m-2 text-white ",children:["loading model: ",e.groupLoadInfo]}):null]})})})}class oi{constructor(e,t=1,r="DATA"){Q(this,"__name");Q(this,"__version");Q(this,"__storeName");Q(this,"__logEnabled");Q(this,"__db");this.__name=e,this.__version=t,this.__storeName=r,this.__logEnabled=!1}enableLog(){this.__logEnabled=!0}__logStart(e){this.__logEnabled&&console.time(`ModelStoreLog_${this.__name}_${this.__storeName}_${e}`)}__logEnd(e){this.__logEnabled&&console.timeEnd(`ModelStoreLog_${this.__name}_${this.__storeName}_${e}`)}close(){return new Promise(e=>{this.__db&&(this.__db.close(),e(!0))})}__open(){return new Promise((e,t)=>{if(this.__db)e(this.__db);else{const r=indexedDB.open(this.__name,this.__version);r.onupgradeneeded=()=>{const i=r.result;i.objectStoreNames.contains(this.__name)||i.createObjectStore(this.__storeName)},r.onblocked=i=>{this.__logEnd("getKey"),t({type:"onblocked",event:i})},r.onerror=i=>{this.__logEnd("getKey"),t({type:"onblocked",event:i})},r.onsuccess=()=>{this.__db=r.result,e(r.result)}}})}getUUID(){return crypto.randomUUID()}getKey(e){return new Promise(async(t,r)=>{this.__logStart("getKey");try{const s=(await this.__open()).transaction(this.__storeName);s.onerror=l=>{this.__logEnd("getKey"),r({type:"store tx error",event:l})};const a=s.objectStore(this.__storeName).get(e);a.onsuccess=()=>{this.__logEnd("getKey"),t(a.result)}}catch(i){this.__logEnd("getKey"),r(i)}})}setKey(e,t){return new Promise(async(r,i)=>{var s;this.__logStart("setKey");try{const a=(await this.__open()).transaction(this.__storeName,"readwrite");a.onerror=u=>{this.__logEnd("setKey"),i({type:"store tx error",event:u})};const c=a.objectStore(this.__storeName).put(t,e);c.onsuccess=()=>{this.__logEnd("setKey"),r(c.result)},(s=c.transaction)==null||s.commit()}catch(o){this.__logEnd("setKey"),i(o)}})}getAllKeys(){return new Promise(async(e,t)=>{this.__logStart("getAllKeys");try{const i=(await this.__open()).transaction(this.__storeName,"readwrite");i.onerror=a=>{this.__logEnd("getAllKeys"),t({type:"store tx error",event:a})};const o=i.objectStore(this.__storeName).getAllKeys();o.onsuccess=()=>{this.__logEnd("getAllKeys"),e(o.result)}}catch(r){this.__logEnd("getAllKeys"),t(r)}})}deleteKey(e){return new Promise(async(t,r)=>{this.__logStart("deleteKey");try{const s=(await this.__open()).transaction(this.__storeName,"readwrite");s.onerror=l=>{this.__logEnd("deleteKey"),r({type:"store tx error",event:l})};const a=s.objectStore(this.__storeName).delete(e);a.onsuccess=()=>{this.__logEnd("deleteKey"),t(a.result)}}catch(i){this.__logEnd("deleteKey"),r(i)}})}deleteDB(){return new Promise((e,t)=>{this.__logStart("deleteDB");const r=indexedDB.deleteDatabase(this.__name);r.onsuccess=()=>{this.__logEnd("deleteDB"),e(!0)},r.onerror=i=>{this.__logEnd("deleteDB"),t({type:"onblocked",event:i})}})}}let Fb=!0;function bF(){const n=Fb;return Fb=!1,n}function AF(n){Fb=!0,n==="This request is not authorized to perform this operation using this permission."?Kn.setState({activated:!0,header:"Access error",message:"You do not have access, if you just recived access then try again in 1 minute"}):Kn.setState({activated:!0,header:"Nettwork error",message:n})}/*! @azure/msal-common v14.8.0 2024-03-22 */const de={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},K0={SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR_RANGE_START:400,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR_RANGE_START:500,SERVER_ERROR_RANGE_END:599},Lp=[de.OPENID_SCOPE,de.PROFILE_SCOPE,de.OFFLINE_ACCESS_SCOPE],CL=[...Lp,de.EMAIL_SCOPE],Go={CONTENT_TYPE:"Content-Type",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},Tr={ID_TOKEN:"idtoken",CLIENT_INFO:"client.info",ADAL_ID_TOKEN:"adal.idtoken",ERROR:"error",ERROR_DESC:"error.description",ACTIVE_ACCOUNT:"active-account",ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},mc={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},$0={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},Rr={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},bL={PLAIN:"plain",S256:"S256"},Iv={QUERY:"query",FRAGMENT:"fragment"},NZ={...Iv,FORM_POST:"form_post"},MF={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},X0={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},ri={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},ut={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},GM="appmetadata",IZ="client_info",vg="1",gy={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},ns={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},Lr={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},dn={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},_g={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},AL={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},ML={username:"username",password:"password"},q0={httpSuccess:200,httpBadRequest:400},ch={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},vT={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},Pl={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},PZ={Jwt:"JWT",Jwk:"JWK",Pop:"pop"};/*! @azure/msal-common v14.8.0 2024-03-22 */const WM="unexpected_error",kZ="post_request_failed";/*! @azure/msal-common v14.8.0 2024-03-22 */const RL={[WM]:"Unexpected error in authentication.",[kZ]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class Yn extends Error{constructor(e,t,r){const i=t?`${e}: ${t}`:e;super(i),Object.setPrototypeOf(this,Yn.prototype),this.errorCode=e||de.EMPTY_STRING,this.errorMessage=t||de.EMPTY_STRING,this.subError=r||de.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function RF(n,e){return new Yn(n,e?`${RL[n]} ${e}`:RL[n])}/*! @azure/msal-common v14.8.0 2024-03-22 */const YM="client_info_decoding_error",NF="client_info_empty_error",KM="token_parsing_error",IF="null_or_empty_token",Ta="endpoints_resolution_error",PF="network_error",kF="openid_config_error",LF="hash_not_deserialized",cp="invalid_state",OF="state_mismatch",vy="state_not_found",DF="nonce_mismatch",$M="auth_time_not_found",UF="max_age_transpired",LZ="multiple_matching_tokens",OZ="multiple_matching_accounts",FF="multiple_matching_appMetadata",jF="request_cannot_be_made",zF="cannot_remove_empty_scope",BF="cannot_append_scopeset",jb="empty_input_scopeset",DZ="device_code_polling_cancelled",UZ="device_code_expired",FZ="device_code_unknown_error",XM="no_account_in_silent_request",HF="invalid_cache_record",qM="invalid_cache_environment",zb="no_account_found",Bb="no_crypto_object",Hb="unexpected_credential_type",jZ="invalid_assertion",zZ="invalid_client_credential",Jl="token_refresh_required",BZ="user_timeout_reached",VF="token_claims_cnf_required_for_signedjwt",GF="authorization_code_missing_from_server_response",WF="binding_key_not_removed",YF="end_session_endpoint_not_supported",ZM="key_id_missing",HZ="no_network_connectivity",VZ="user_canceled",GZ="missing_tenant_id_error",Nt="method_not_implemented",WZ="nested_app_auth_bridge_disabled";/*! @azure/msal-common v14.8.0 2024-03-22 */const NL={[YM]:"The client info could not be parsed/decoded correctly",[NF]:"The client info was empty",[KM]:"Token cannot be parsed",[IF]:"The token is null or empty",[Ta]:"Endpoints cannot be resolved",[PF]:"Network request failed",[kF]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[LF]:"The hash parameters could not be deserialized",[cp]:"State was not the expected format",[OF]:"State mismatch error",[vy]:"State not found",[DF]:"Nonce mismatch error",[$M]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[UF]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[LZ]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[OZ]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[FF]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[jF]:"Token request cannot be made without authorization code or refresh token.",[zF]:"Cannot remove null or empty scope from ScopeSet",[BF]:"Cannot append ScopeSet",[jb]:"Empty input ScopeSet cannot be processed",[DZ]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[UZ]:"Device code is expired.",[FZ]:"Device code stopped polling for unknown reasons.",[XM]:"Please pass an account object, silent flow is not supported without account information",[HF]:"Cache record object was null or undefined.",[qM]:"Invalid environment when attempting to create cache entry",[zb]:"No account found in cache for given key.",[Bb]:"No crypto object detected.",[Hb]:"Unexpected credential type.",[jZ]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[zZ]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[Jl]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[BZ]:"User defined timeout for device code polling reached",[VF]:"Cannot generate a POP jwt if the token_claims are not populated",[GF]:"Server response does not contain an authorization code to proceed",[WF]:"Could not remove the credential's binding key from storage.",[YF]:"The provided authority does not support logout",[ZM]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[HZ]:"No network connectivity. Check your internet connection.",[VZ]:"User cancelled the flow.",[GZ]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[Nt]:"This method has not been implemented",[WZ]:"The nested app auth bridge is disabled"};class iS extends Yn{constructor(e,t){super(e,t?`${NL[e]}: ${t}`:NL[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,iS.prototype)}}function be(n,e){return new iS(n,e)}/*! @azure/msal-common v14.8.0 2024-03-22 */const _y={createNewGuid:()=>{throw be(Nt)},base64Decode:()=>{throw be(Nt)},base64Encode:()=>{throw be(Nt)},async getPublicKeyThumbprint(){throw be(Nt)},async removeTokenBindingKey(){throw be(Nt)},async clearKeystore(){throw be(Nt)},async signJwt(){throw be(Nt)},async hashString(){throw be(Nt)}};/*! @azure/msal-common v14.8.0 2024-03-22 */var kn;(function(n){n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace"})(kn||(kn={}));class cd{constructor(e,t,r){this.level=kn.Info;const i=()=>{},s=e||cd.createDefaultLoggerOptions();this.localCallback=s.loggerCallback||i,this.piiLoggingEnabled=s.piiLoggingEnabled||!1,this.level=typeof s.logLevel=="number"?s.logLevel:kn.Info,this.correlationId=s.correlationId||de.EMPTY_STRING,this.packageName=t||de.EMPTY_STRING,this.packageVersion=r||de.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:kn.Info}}clone(e,t,r){return new cd({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const s=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${kn[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,s,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:kn.Error,containsPii:!1,correlationId:t||de.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:kn.Error,containsPii:!0,correlationId:t||de.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:kn.Warning,containsPii:!1,correlationId:t||de.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:kn.Warning,containsPii:!0,correlationId:t||de.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:kn.Info,containsPii:!1,correlationId:t||de.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:kn.Info,containsPii:!0,correlationId:t||de.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:kn.Verbose,containsPii:!1,correlationId:t||de.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:kn.Verbose,containsPii:!0,correlationId:t||de.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:kn.Trace,containsPii:!1,correlationId:t||de.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:kn.Trace,containsPii:!0,correlationId:t||de.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-common v14.8.0 2024-03-22 */const KF="@azure/msal-common",QM="14.8.0";/*! @azure/msal-common v14.8.0 2024-03-22 */const JM={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};/*! @azure/msal-common v14.8.0 2024-03-22 */function wd(n,e){const t=YZ(n);try{const r=e(t);return JSON.parse(r)}catch{throw be(KM)}}function YZ(n){if(!n)throw be(IF);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(n);if(!t||t.length<4)throw be(KM);return t[2]}function $F(n,e){if(e===0||Date.now()-3e5>n+e)throw be(UF)}/*! @azure/msal-common v14.8.0 2024-03-22 */function ia(){return Math.round(new Date().getTime()/1e3)}function Vb(n,e){const t=Number(n)||0;return ia()+e>t}function KZ(n){return Number(n)>ia()}/*! @azure/msal-common v14.8.0 2024-03-22 */function lf(n){return[$Z(n),XZ(n),qZ(n),ZZ(n),QZ(n)].join(ri.CACHE_KEY_SEPARATOR).toLowerCase()}function sS(n,e,t,r,i){return{credentialType:ut.ID_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t,realm:i}}function oS(n,e,t,r,i,s,o,a,l,c,u,h,f,p,_){var g,m;const y={homeAccountId:n,credentialType:ut.ACCESS_TOKEN,secret:t,cachedAt:ia().toString(),expiresOn:o.toString(),extendedExpiresOn:a.toString(),environment:e,clientId:r,realm:i,target:s,tokenType:u||dn.BEARER};if(h&&(y.userAssertionHash=h),c&&(y.refreshOn=c.toString()),p&&(y.requestedClaims=p,y.requestedClaimsHash=_),((g=y.tokenType)==null?void 0:g.toLowerCase())!==dn.BEARER.toLowerCase())switch(y.credentialType=ut.ACCESS_TOKEN_WITH_AUTH_SCHEME,y.tokenType){case dn.POP:const v=wd(t,l);if(!((m=v==null?void 0:v.cnf)!=null&&m.kid))throw be(VF);y.keyId=v.cnf.kid;break;case dn.SSH:y.keyId=f}return y}function XF(n,e,t,r,i,s,o){const a={credentialType:ut.REFRESH_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t};return s&&(a.userAssertionHash=s),i&&(a.familyId=i),o&&(a.expiresOn=o.toString()),a}function eR(n){return n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("credentialType")&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("secret")}function IL(n){return n?eR(n)&&n.hasOwnProperty("realm")&&n.hasOwnProperty("target")&&(n.credentialType===ut.ACCESS_TOKEN||n.credentialType===ut.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function PL(n){return n?eR(n)&&n.hasOwnProperty("realm")&&n.credentialType===ut.ID_TOKEN:!1}function kL(n){return n?eR(n)&&n.credentialType===ut.REFRESH_TOKEN:!1}function $Z(n){return[n.homeAccountId,n.environment].join(ri.CACHE_KEY_SEPARATOR).toLowerCase()}function XZ(n){const e=n.credentialType===ut.REFRESH_TOKEN&&n.familyId||n.clientId;return[n.credentialType,e,n.realm||""].join(ri.CACHE_KEY_SEPARATOR).toLowerCase()}function qZ(n){return(n.target||"").toLowerCase()}function ZZ(n){return(n.requestedClaimsHash||"").toLowerCase()}function QZ(n){return n.tokenType&&n.tokenType.toLowerCase()!==dn.BEARER.toLowerCase()?n.tokenType.toLowerCase():""}function JZ(n,e){const t=n.indexOf(Lr.CACHE_KEY)===0;let r=!0;return e&&(r=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&r}function eQ(n,e){let t=!1;n&&(t=n.indexOf(_g.THROTTLING_PREFIX)===0);let r=!0;return e&&(r=e.hasOwnProperty("throttleTime")),t&&r}function tQ({environment:n,clientId:e}){return[GM,n,e].join(ri.CACHE_KEY_SEPARATOR).toLowerCase()}function nQ(n,e){return e?n.indexOf(GM)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function rQ(n,e){return e?n.indexOf(gy.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function LL(){return ia()+gy.REFRESH_TIME_SECONDS}function Z0(n,e,t){n.authorization_endpoint=e.authorization_endpoint,n.token_endpoint=e.token_endpoint,n.end_session_endpoint=e.end_session_endpoint,n.issuer=e.issuer,n.endpointsFromNetwork=t,n.jwks_uri=e.jwks_uri}function _T(n,e,t){n.aliases=e.aliases,n.preferred_cache=e.preferred_cache,n.preferred_network=e.preferred_network,n.aliasesFromNetwork=t}function OL(n){return n.expiresAt<=ia()}/*! @azure/msal-common v14.8.0 2024-03-22 */const qF="redirect_uri_empty",iQ="claims_request_parsing_error",ZF="authority_uri_insecure",Vm="url_parse_error",QF="empty_url_error",JF="empty_input_scopes_error",ej="invalid_prompt_value",tR="invalid_claims",tj="token_request_empty",nj="logout_request_empty",rj="invalid_code_challenge_method",nR="pkce_params_missing",rR="invalid_cloud_discovery_metadata",ij="invalid_authority_metadata",sj="untrusted_authority",aS="missing_ssh_jwk",oj="missing_ssh_kid",sQ="missing_nonce_authentication_header",oQ="invalid_authentication_header",aj="cannot_set_OIDCOptions",lj="cannot_allow_native_broker",cj="authority_mismatch";/*! @azure/msal-common v14.8.0 2024-03-22 */const aQ={[qF]:"A redirect URI is required for all calls, and none has been set.",[iQ]:"Could not parse the given claims request object.",[ZF]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[Vm]:"URL could not be parsed into appropriate segments.",[QF]:"URL was empty or null.",[JF]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[ej]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[tR]:"Given claims parameter must be a stringified JSON object.",[tj]:"Token request was empty and not found in cache.",[nj]:"The logout request was null or undefined.",[rj]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[nR]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[rR]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[ij]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[sj]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[aS]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[oj]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[sQ]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[oQ]:"Invalid authentication header provided",[aj]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[lj]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[cj]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class iR extends Yn{constructor(e){super(e,aQ[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,iR.prototype)}}function pn(n){return new iR(n)}/*! @azure/msal-common v14.8.0 2024-03-22 */class mo{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},r=e.split("&"),i=s=>decodeURIComponent(s.replace(/\+/g," "));return r.forEach(s=>{if(s.trim()){const[o,a]=s.split(/=(.+)/g,2);o&&a&&(t[i(o)]=i(a))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}/*! @azure/msal-common v14.8.0 2024-03-22 */class ir{constructor(e){const t=e?mo.trimArrayEntries([...e]):[],r=t?mo.removeEmptyStringsFromArray(t):[];this.validateInputScopes(r),this.scopes=new Set,r.forEach(i=>this.scopes.add(i))}static fromString(e){const r=(e||de.EMPTY_STRING).split(" ");return new ir(r)}static createSearchScopes(e){const t=new ir(e);return t.containsOnlyOIDCScopes()?t.removeScope(de.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw pn(JF)}containsScope(e){const t=this.printScopesLowerCase().split(" "),r=new ir(t);return e?r.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return CL.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw be(BF)}}removeScope(e){if(!e)throw be(zF);this.scopes.delete(e.trim())}removeOIDCScopes(){CL.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw be(jb);const t=new Set;return e.scopes.forEach(r=>t.add(r.toLowerCase())),this.scopes.forEach(r=>t.add(r.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw be(jb);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),r=e.getScopeCount(),i=this.getScopeCount();return t.size<i+r}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):de.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}/*! @azure/msal-common v14.8.0 2024-03-22 */function xy(n,e){if(!n)throw be(NF);try{const t=e(n);return JSON.parse(t)}catch{throw be(YM)}}function cf(n){if(!n)throw be(YM);const e=n.split(ri.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?de.EMPTY_STRING:e[1]}}/*! @azure/msal-common v14.8.0 2024-03-22 */function Gb(n,e){return!!n&&!!e&&n===e.split(".")[1]}function sR(n,e){const{oid:t,sub:r,tid:i,name:s,tfp:o,acr:a}=e,l=i||o||a||"";return{tenantId:l,localAccountId:t||r||"",name:s,isHomeTenant:Gb(l,n)}}function oR(n,e,t,r){let i=n;if(e){const{isHomeTenant:s,...o}=e;i={...n,...o}}if(t){const{isHomeTenant:s,...o}=sR(n.homeAccountId,t);return i={...i,...o,idTokenClaims:t,idToken:r},i}return i}/*! @azure/msal-common v14.8.0 2024-03-22 */const ro={Default:0,Adfs:1,Dsts:2,Ciam:3};/*! @azure/msal-common v14.8.0 2024-03-22 */function uj(n){return n&&(n.tid||n.tfp||n.acr)||null}/*! @azure/msal-common v14.8.0 2024-03-22 */const za={AAD:"AAD",OIDC:"OIDC"};/*! @azure/msal-common v14.8.0 2024-03-22 */class _r{generateAccountId(){return[this.homeAccountId,this.environment].join(ri.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return _r.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){const t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(ri.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,r){const i=new _r;t.authorityType===ro.Adfs?i.authorityType=X0.ADFS_ACCOUNT_TYPE:t.protocolMode===za.AAD?i.authorityType=X0.MSSTS_ACCOUNT_TYPE:i.authorityType=X0.GENERIC_ACCOUNT_TYPE;let s;e.clientInfo&&r&&(s=xy(e.clientInfo,r)),i.clientInfo=e.clientInfo,i.homeAccountId=e.homeAccountId,i.nativeAccountId=e.nativeAccountId;const o=e.environment||t&&t.getPreferredCache();if(!o)throw be(qM);i.environment=o,i.realm=(s==null?void 0:s.utid)||uj(e.idTokenClaims)||"",i.localAccountId=(s==null?void 0:s.uid)||e.idTokenClaims.oid||e.idTokenClaims.sub||"";const a=e.idTokenClaims.preferred_username||e.idTokenClaims.upn,l=e.idTokenClaims.emails?e.idTokenClaims.emails[0]:null;if(i.username=a||l||"",i.name=e.idTokenClaims.name,i.cloudGraphHostName=e.cloudGraphHostName,i.msGraphHost=e.msGraphHost,e.tenantProfiles)i.tenantProfiles=e.tenantProfiles;else{const c=[];if(e.idTokenClaims){const u=sR(e.homeAccountId,e.idTokenClaims);c.push(u)}i.tenantProfiles=c}return i}static createFromAccountInfo(e,t,r){var s;const i=new _r;return i.authorityType=e.authorityType||X0.GENERIC_ACCOUNT_TYPE,i.homeAccountId=e.homeAccountId,i.localAccountId=e.localAccountId,i.nativeAccountId=e.nativeAccountId,i.realm=e.tenantId,i.environment=e.environment,i.username=e.username,i.name=e.name,i.cloudGraphHostName=t,i.msGraphHost=r,i.tenantProfiles=Array.from(((s=e.tenantProfiles)==null?void 0:s.values())||[]),i}static generateHomeAccountId(e,t,r,i,s){if(!(t===ro.Adfs||t===ro.Dsts)){if(e)try{const o=xy(e,i.base64Decode);if(o.uid&&o.utid)return`${o.uid}.${o.utid}`}catch{}r.warning("No client info in response")}return(s==null?void 0:s.sub)||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;let i=!0;if(r){const s=e.idTokenClaims||{},o=t.idTokenClaims||{};i=s.iat===o.iat&&s.nonce===o.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&i}}/*! @azure/msal-common v14.8.0 2024-03-22 */function dj(n){return n.startsWith("#/")?n.substring(2):n.startsWith("#")||n.startsWith("?")?n.substring(1):n}function yy(n){if(!n||n.indexOf("=")<0)return null;try{const e=dj(n),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.error||t.error_description||t.state)return t}catch{throw be(LF)}return null}/*! @azure/msal-common v14.8.0 2024-03-22 */class Ht{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw pn(QF);e.includes("#")||(this._urlString=Ht.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return mo.endsWith(t,"?")?t=t.slice(0,-1):mo.endsWith(t,"?/")&&(t=t.slice(0,-2)),mo.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw pn(Vm)}if(!e.HostNameAndPort||!e.PathSegments)throw pn(Vm);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw pn(ZF)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return Ht.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),r=t.PathSegments;return e&&r.length!==0&&(r[0]===mc.COMMON||r[0]===mc.ORGANIZATIONS)&&(r[0]=e),Ht.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw pn(Vm);const r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let i=r.AbsolutePath.split("/");return i=i.filter(s=>s&&s.length>0),r.PathSegments=i,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw pn(Vm);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===de.FORWARD_SLASH){const i=new Ht(t).getUrlComponents();return i.Protocol+"//"+i.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new Ht(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!yy(e)}}/*! @azure/msal-common v14.8.0 2024-03-22 */const hj={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},DL=hj.endpointMetadata,aR=hj.instanceDiscoveryMetadata,fj=new Set;aR.metadata.forEach(n=>{n.aliases.forEach(e=>{fj.add(e)})});function lQ(n,e){var i;let t;const r=n.canonicalAuthority;if(r){const s=new Ht(r).getUrlComponents().HostNameAndPort;t=UL(s,(i=n.cloudDiscoveryMetadata)==null?void 0:i.metadata,ns.CONFIG,e)||UL(s,aR.metadata,ns.HARDCODED_VALUES,e)||n.knownAuthorities}return t||[]}function UL(n,e,t,r){if(r==null||r.trace(`getAliasesFromMetadata called with source: ${t}`),n&&e){const i=wy(e,n);if(i)return r==null||r.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),i.aliases;r==null||r.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function cQ(n){return wy(aR.metadata,n)}function wy(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(r.aliases.includes(e))return r}return null}/*! @azure/msal-common v14.8.0 2024-03-22 */class up{constructor(e,t,r,i){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(KF,QM),this.staticAuthorityOptions=i}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){const t=this.getAllAccounts(e);return t.length>1?t.sort(i=>i.idTokenClaims?-1:1)[0]:t.length===1?t[0]:null}getBaseAccountInfo(e){const t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(r=>this.getAccountInfoForTenantProfiles(r,t))}getAccountInfoForTenantProfiles(e,t){return this.getTenantProfilesFromAccountEntity(e,t==null?void 0:t.tenantId,t)}getTenantedAccountInfoByFilter(e,t,r,i){let s=null,o;if(i&&!this.tenantProfileMatchesFilter(r,i))return null;const a=this.getIdToken(e,t,r.tenantId);return a&&(o=wd(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(o,i))?null:(s=oR(e,r,o,a==null?void 0:a.secret),s)}getTenantProfilesFromAccountEntity(e,t,r){const i=e.getAccountInfo();let s=i.tenantProfiles||new Map;const o=this.getTokenKeys();if(t){const l=s.get(t);if(l)s=new Map([[t,l]]);else return[]}const a=[];return s.forEach(l=>{const c=this.getTenantedAccountInfoByFilter(i,o,l,r);c&&a.push(c)}),a}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t){if(!e)throw be(HF);e.account&&this.setAccount(e.account),e.idToken&&(t==null?void 0:t.idToken)!==!1&&this.setIdTokenCredential(e.idToken),e.accessToken&&(t==null?void 0:t.accessToken)!==!1&&await this.saveAccessToken(e.accessToken),e.refreshToken&&(t==null?void 0:t.refreshToken)!==!1&&this.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&this.setAppMetadata(e.appMetadata)}async saveAccessToken(e){const t={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},r=this.getTokenKeys(),i=ir.fromString(e.target),s=[];r.accessToken.forEach(o=>{if(!this.accessTokenKeyMatchesFilter(o,t,!1))return;const a=this.getAccessTokenCredential(o);a&&this.credentialMatchesFilter(a,t)&&ir.fromString(a.target).intersectingScopeSets(i)&&s.push(this.removeAccessToken(o))}),await Promise.all(s),this.setAccessTokenCredential(e)}getAccountsFilteredBy(e){const t=this.getAccountKeys(),r=[];return t.forEach(i=>{var l;if(!this.isAccountKey(i,e.homeAccountId))return;const s=this.getAccount(i,this.commonLogger);if(!s||e.homeAccountId&&!this.matchHomeAccountId(s,e.homeAccountId)||e.username&&!this.matchUsername(s.username,e.username)||e.environment&&!this.matchEnvironment(s,e.environment)||e.realm&&!this.matchRealm(s,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(s,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(s,e.authorityType))return;const o={localAccountId:e==null?void 0:e.localAccountId,name:e==null?void 0:e.name},a=(l=s.tenantProfiles)==null?void 0:l.filter(c=>this.tenantProfileMatchesFilter(c,o));a&&a.length===0||r.push(s)}),r}isAccountKey(e,t,r){return!(e.split(ri.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||r&&!e.toLowerCase().includes(r.toLowerCase()))}isCredentialKey(e){if(e.split(ri.CACHE_KEY_SEPARATOR).length<6)return!1;const t=e.toLowerCase();if(t.indexOf(ut.ID_TOKEN.toLowerCase())===-1&&t.indexOf(ut.ACCESS_TOKEN.toLowerCase())===-1&&t.indexOf(ut.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&t.indexOf(ut.REFRESH_TOKEN.toLowerCase())===-1)return!1;if(t.indexOf(ut.REFRESH_TOKEN.toLowerCase())>-1){const r=`${ut.REFRESH_TOKEN}${ri.CACHE_KEY_SEPARATOR}${this.clientId}${ri.CACHE_KEY_SEPARATOR}`,i=`${ut.REFRESH_TOKEN}${ri.CACHE_KEY_SEPARATOR}${vg}${ri.CACHE_KEY_SEPARATOR}`;if(t.indexOf(r.toLowerCase())===-1&&t.indexOf(i.toLowerCase())===-1)return!1}else if(t.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===ut.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===dn.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),r={};return t.forEach(i=>{if(!this.isAppMetadata(i))return;const s=this.getAppMetadata(i);s&&(e.environment&&!this.matchEnvironment(s,e.environment)||e.clientId&&!this.matchClientId(s,e.clientId)||(r[i]=s))}),r}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let r=null;return t.forEach(i=>{if(!this.isAuthorityMetadata(i)||i.indexOf(this.clientId)===-1)return;const s=this.getAuthorityMetadata(i);s&&s.aliases.indexOf(e)!==-1&&(r=s)}),r}async removeAllAccounts(){const e=this.getAccountKeys(),t=[];e.forEach(r=>{t.push(this.removeAccount(r))}),await Promise.all(t)}async removeAccount(e){const t=this.getAccount(e,this.commonLogger);t&&(await this.removeAccountContext(t),this.removeItem(e))}async removeAccountContext(e){const t=this.getTokenKeys(),r=e.generateAccountId(),i=[];t.idToken.forEach(s=>{s.indexOf(r)===0&&this.removeIdToken(s)}),t.accessToken.forEach(s=>{s.indexOf(r)===0&&i.push(this.removeAccessToken(s))}),t.refreshToken.forEach(s=>{s.indexOf(r)===0&&this.removeRefreshToken(s)}),await Promise.all(i)}updateOutdatedCachedAccount(e,t,r){var i;if(t&&t.isSingleTenant()){(i=this.commonLogger)==null||i.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");const s=this.getAccountKeys().filter(u=>u.startsWith(t.homeAccountId)),o=[];s.forEach(u=>{const h=this.getCachedAccountEntity(u);h&&o.push(h)});const a=o.find(u=>Gb(u.realm,u.homeAccountId))||o[0];a.tenantProfiles=o.map(u=>({tenantId:u.realm,localAccountId:u.localAccountId,name:u.name,isHomeTenant:Gb(u.realm,u.homeAccountId)}));const l=up.toObject(new _r,{...a}),c=l.generateAccountKey();return s.forEach(u=>{u!==c&&this.removeOutdatedAccount(e)}),this.setAccount(l),r==null||r.verbose("Updated an outdated account entity in the cache"),l}return t}async removeAccessToken(e){const t=this.getAccessTokenCredential(e);if(t){if(t.credentialType.toLowerCase()===ut.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&t.tokenType===dn.POP){const i=t.keyId;if(i)try{await this.cryptoImpl.removeTokenBindingKey(i)}catch{throw be(WF)}}return this.removeItem(e)}}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readAccountFromCache(e){const t=_r.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,r,i,s){this.commonLogger.trace("CacheManager - getIdToken called");const o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:ut.ID_TOKEN,clientId:this.clientId,realm:r},a=this.getIdTokensByFilter(o,t),l=a.size;if(l<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(l>1){let c=a;if(!r){const u=new Map;a.forEach((f,p)=>{f.realm===e.tenantId&&u.set(p,f)});const h=u.size;if(h<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),a.values().next().value;if(h===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),u.values().next().value;c=u}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),c.forEach((u,h)=>{this.removeIdToken(h)}),i&&s&&i.addFields({multiMatchedID:a.size},s),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),a.values().next().value}getIdTokensByFilter(e,t){const r=t&&t.idToken||this.getTokenKeys().idToken,i=new Map;return r.forEach(s=>{if(!this.idTokenKeyMatchesFilter(s,{clientId:this.clientId,...e}))return;const o=this.getIdTokenCredential(s);o&&this.credentialMatchesFilter(o,e)&&i.set(s,o)}),i}idTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,r,i,s,o){this.commonLogger.trace("CacheManager - getAccessToken called");const a=ir.createSearchScopes(t.scopes),l=t.authenticationScheme||dn.BEARER,c=l&&l.toLowerCase()!==dn.BEARER.toLowerCase()?ut.ACCESS_TOKEN_WITH_AUTH_SCHEME:ut.ACCESS_TOKEN,u={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:c,clientId:this.clientId,realm:i||e.tenantId,target:a,tokenType:l,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=r&&r.accessToken||this.getTokenKeys().accessToken,f=[];h.forEach(_=>{if(this.accessTokenKeyMatchesFilter(_,u,!0)){const y=this.getAccessTokenCredential(_);y&&this.credentialMatchesFilter(y,u)&&f.push(y)}});const p=f.length;return p<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):p>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),f.forEach(_=>{this.removeAccessToken(lf(_))}),s&&o&&s.addFields({multiMatchedAT:f.length},o),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),f[0])}accessTokenKeyMatchesFilter(e,t,r){const i=e.toLowerCase();if(t.clientId&&i.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&i.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&i.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&i.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const s=t.target.asArray();for(let o=0;o<s.length;o++){if(r&&!i.includes(s[o].toLowerCase()))return!1;if(!r&&i.includes(s[o].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e){const t=this.getTokenKeys(),r=[];return t.accessToken.forEach(i=>{if(!this.accessTokenKeyMatchesFilter(i,e,!0))return;const s=this.getAccessTokenCredential(i);s&&this.credentialMatchesFilter(s,e)&&r.push(s)}),r}getRefreshToken(e,t,r,i,s){this.commonLogger.trace("CacheManager - getRefreshToken called");const o=t?vg:void 0,a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:ut.REFRESH_TOKEN,clientId:this.clientId,familyId:o},l=r&&r.refreshToken||this.getTokenKeys().refreshToken,c=[];l.forEach(h=>{if(this.refreshTokenKeyMatchesFilter(h,a)){const f=this.getRefreshTokenCredential(h);f&&this.credentialMatchesFilter(f,a)&&c.push(f)}});const u=c.length;return u<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(u>1&&i&&s&&i.addFields({multiMatchedRT:u},s),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),c[0])}refreshTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.familyId&&r.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(t),i=Object.keys(r).map(o=>r[o]),s=i.length;if(s<1)return null;if(s>1)throw be(FF);return i[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===vg)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const r=e.oid||e.sub;return t===r}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var r;return t.toLowerCase()===((r=e.name)==null?void 0:r.toLowerCase())}matchUsername(e,t){return!!(e&&typeof e=="string"&&(t==null?void 0:t.toLowerCase())===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const i=lQ(this.staticAuthorityOptions,this.commonLogger);if(i.includes(t)&&i.includes(e.environment))return!0}const r=this.getAuthorityMetadataByAlias(t);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){var r;return((r=e.realm)==null?void 0:r.toLowerCase())===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==ut.ACCESS_TOKEN&&e.credentialType!==ut.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:ir.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(GM)!==-1}isAuthorityMetadata(e){return e.indexOf(gy.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${gy.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const r in t)e[r]=t[r];return e}}class uQ extends up{setAccount(){throw be(Nt)}getAccount(){throw be(Nt)}getCachedAccountEntity(){throw be(Nt)}setIdTokenCredential(){throw be(Nt)}getIdTokenCredential(){throw be(Nt)}setAccessTokenCredential(){throw be(Nt)}getAccessTokenCredential(){throw be(Nt)}setRefreshTokenCredential(){throw be(Nt)}getRefreshTokenCredential(){throw be(Nt)}setAppMetadata(){throw be(Nt)}getAppMetadata(){throw be(Nt)}setServerTelemetry(){throw be(Nt)}getServerTelemetry(){throw be(Nt)}setAuthorityMetadata(){throw be(Nt)}getAuthorityMetadata(){throw be(Nt)}getAuthorityMetadataKeys(){throw be(Nt)}setThrottlingCache(){throw be(Nt)}getThrottlingCache(){throw be(Nt)}removeItem(){throw be(Nt)}getKeys(){throw be(Nt)}getAccountKeys(){throw be(Nt)}getTokenKeys(){throw be(Nt)}async clear(){throw be(Nt)}updateCredentialCacheKey(){throw be(Nt)}removeOutdatedAccount(){throw be(Nt)}}/*! @azure/msal-common v14.8.0 2024-03-22 */const dQ=300,pj={tokenRenewalOffsetSeconds:dQ,preventCorsPreflight:!1},hQ={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:kn.Info,correlationId:de.EMPTY_STRING},fQ={claimsBasedCachingEnabled:!1},pQ={async sendGetRequestAsync(){throw be(Nt)},async sendPostRequestAsync(){throw be(Nt)}},mQ={sku:de.SKU,version:QM,cpu:de.EMPTY_STRING,os:de.EMPTY_STRING},gQ={clientSecret:de.EMPTY_STRING,clientAssertion:void 0},vQ={azureCloudInstance:JM.None,tenant:`${de.DEFAULT_COMMON_TENANT}`},_Q={application:{appName:"",appVersion:""}};function xQ({authOptions:n,systemOptions:e,loggerOptions:t,cacheOptions:r,storageInterface:i,networkInterface:s,cryptoInterface:o,clientCredentials:a,libraryInfo:l,telemetry:c,serverTelemetryManager:u,persistencePlugin:h,serializableCache:f}){const p={...hQ,...t};return{authOptions:yQ(n),systemOptions:{...pj,...e},loggerOptions:p,cacheOptions:{...fQ,...r},storageInterface:i||new uQ(n.clientId,_y,new cd(p)),networkInterface:s||pQ,cryptoInterface:o||_y,clientCredentials:a||gQ,libraryInfo:{...mQ,...l},telemetry:{..._Q,...c},serverTelemetryManager:u||null,persistencePlugin:h||null,serializableCache:f||null}}function yQ(n){return{clientCapabilities:[],azureCloudOptions:vQ,skipAuthorityMetadataCache:!1,...n}}function Wb(n){return n.authOptions.authority.options.protocolMode===za.OIDC}/*! @azure/msal-common v14.8.0 2024-03-22 */class Cc extends Yn{constructor(e,t,r){super(e,t,r),this.name="ServerError",Object.setPrototypeOf(this,Cc.prototype)}}/*! @azure/msal-common v14.8.0 2024-03-22 */class Ho{static generateThrottlingStorageKey(e){return`${_g.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){var s;const r=Ho.generateThrottlingStorageKey(t),i=e.getThrottlingCache(r);if(i){if(i.throttleTime<Date.now()){e.removeItem(r);return}throw new Cc(((s=i.errorCodes)==null?void 0:s.join(" "))||de.EMPTY_STRING,i.errorMessage,i.subError)}}static postProcess(e,t,r){if(Ho.checkResponseStatus(r)||Ho.checkResponseForRetryAfter(r)){const i={throttleTime:Ho.calculateThrottleTime(parseInt(r.headers[Go.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(Ho.generateThrottlingStorageKey(t),i)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(Go.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(Math.min(r+(t||_g.DEFAULT_THROTTLE_TIME_SECONDS),r+_g.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,r,i){const s={clientId:t,authority:r.authority,scopes:r.scopes,homeAccountIdentifier:i,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid},o=this.generateThrottlingStorageKey(s);e.removeItem(o)}}/*! @azure/msal-common v14.8.0 2024-03-22 */class wQ{constructor(e,t){this.networkClient=e,this.cacheManager=t}async sendPostRequest(e,t,r){Ho.preProcess(this.cacheManager,e);let i;try{i=await this.networkClient.sendPostRequestAsync(t,r)}catch(s){throw s instanceof Yn?s:be(PF)}return Ho.postProcess(this.cacheManager,e,i),i}}/*! @azure/msal-common v14.8.0 2024-03-22 */const cs={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};/*! @azure/msal-common v14.8.0 2024-03-22 */const dp="client_id",SQ="redirect_uri",FL="response_type",EQ="response_mode",TQ="grant_type",CQ="claims",bQ="scope",AQ="refresh_token",MQ="state",RQ="nonce",NQ="prompt",IQ="code",PQ="code_challenge",kQ="code_challenge_method",LQ="code_verifier",OQ="client-request-id",DQ="x-client-SKU",UQ="x-client-VER",FQ="x-client-OS",jQ="x-client-CPU",zQ="x-client-current-telemetry",BQ="x-client-last-telemetry",HQ="x-ms-lib-capability",VQ="x-app-name",GQ="x-app-ver",WQ="post_logout_redirect_uri",YQ="id_token_hint",KQ="device_code",$Q="client_secret",XQ="client_assertion",qQ="client_assertion_type",jL="token_type",zL="req_cnf",ZQ="assertion",QQ="requested_token_use",BL="return_spa_code",JQ="nativebroker",eJ="logout_hint",tJ="sid",nJ="login_hint",rJ="domain_hint";/*! @azure/msal-common v14.8.0 2024-03-22 */class hu{static validateRedirectUri(e){if(!e)throw pn(qF)}static validatePrompt(e){const t=[];for(const r in Rr)t.push(Rr[r]);if(t.indexOf(e)<0)throw pn(ej)}static validateClaims(e){try{JSON.parse(e)}catch{throw pn(tR)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw pn(nR);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([bL.PLAIN,bL.S256].indexOf(e)<0)throw pn(rj)}static sanitizeEQParams(e,t){return e?(t.forEach((r,i)=>{e[i]&&delete e[i]}),Object.fromEntries(Object.entries(e).filter(r=>r[1]!==""))):{}}}/*! @azure/msal-common v14.8.0 2024-03-22 */class xg{constructor(){this.parameters=new Map}addResponseTypeCode(){this.parameters.set(FL,encodeURIComponent(de.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(FL,encodeURIComponent(`${de.TOKEN_RESPONSE_TYPE} ${de.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set(EQ,encodeURIComponent(e||NZ.QUERY))}addNativeBroker(){this.parameters.set(JQ,encodeURIComponent("1"))}addScopes(e,t=!0,r=Lp){t&&!r.includes("openid")&&!e.includes("openid")&&r.push("openid");const i=t?[...e||[],...r]:e||[],s=new ir(i);this.parameters.set(bQ,encodeURIComponent(s.printScopes()))}addClientId(e){this.parameters.set(dp,encodeURIComponent(e))}addRedirectUri(e){hu.validateRedirectUri(e),this.parameters.set(SQ,encodeURIComponent(e))}addPostLogoutRedirectUri(e){hu.validateRedirectUri(e),this.parameters.set(WQ,encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set(YQ,encodeURIComponent(e))}addDomainHint(e){this.parameters.set(rJ,encodeURIComponent(e))}addLoginHint(e){this.parameters.set(nJ,encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(Go.CCS_HEADER,encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set(Go.CCS_HEADER,encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set(tJ,encodeURIComponent(e))}addClaims(e,t){const r=this.addClientCapabilitiesToClaims(e,t);hu.validateClaims(r),this.parameters.set(CQ,encodeURIComponent(r))}addCorrelationId(e){this.parameters.set(OQ,encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set(DQ,e.sku),this.parameters.set(UQ,e.version),e.os&&this.parameters.set(FQ,e.os),e.cpu&&this.parameters.set(jQ,e.cpu)}addApplicationTelemetry(e){e!=null&&e.appName&&this.parameters.set(VQ,e.appName),e!=null&&e.appVersion&&this.parameters.set(GQ,e.appVersion)}addPrompt(e){hu.validatePrompt(e),this.parameters.set(`${NQ}`,encodeURIComponent(e))}addState(e){e&&this.parameters.set(MQ,encodeURIComponent(e))}addNonce(e){this.parameters.set(RQ,encodeURIComponent(e))}addCodeChallengeParams(e,t){if(hu.validateCodeChallengeParams(e,t),e&&t)this.parameters.set(PQ,encodeURIComponent(e)),this.parameters.set(kQ,encodeURIComponent(t));else throw pn(nR)}addAuthorizationCode(e){this.parameters.set(IQ,encodeURIComponent(e))}addDeviceCode(e){this.parameters.set(KQ,encodeURIComponent(e))}addRefreshToken(e){this.parameters.set(AQ,encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set(LQ,encodeURIComponent(e))}addClientSecret(e){this.parameters.set($Q,encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set(XQ,encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set(qQ,encodeURIComponent(e))}addOboAssertion(e){this.parameters.set(ZQ,encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set(QQ,encodeURIComponent(e))}addGrantType(e){this.parameters.set(TQ,encodeURIComponent(e))}addClientInfo(){this.parameters.set(IZ,"1")}addExtraQueryParameters(e){const t=hu.sanitizeEQParams(e,this.parameters);Object.keys(t).forEach(r=>{this.parameters.set(r,e[r])})}addClientCapabilitiesToClaims(e,t){let r;if(!e)r={};else try{r=JSON.parse(e)}catch{throw pn(tR)}return t&&t.length>0&&(r.hasOwnProperty($0.ACCESS_TOKEN)||(r[$0.ACCESS_TOKEN]={}),r[$0.ACCESS_TOKEN][$0.XMS_CC]={values:t}),JSON.stringify(r)}addUsername(e){this.parameters.set(ML.username,encodeURIComponent(e))}addPassword(e){this.parameters.set(ML.password,encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(jL,dn.POP),this.parameters.set(zL,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(jL,dn.SSH),this.parameters.set(zL,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set(zQ,e.generateCurrentRequestHeaderValue()),this.parameters.set(BQ,e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set(HQ,_g.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(e){this.parameters.set(eJ,encodeURIComponent(e))}createQueryString(){const e=new Array;return this.parameters.forEach((t,r)=>{e.push(`${r}=${t}`)}),e.join("&")}}/*! @azure/msal-common v14.8.0 2024-03-22 */function iJ(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}/*! @azure/msal-common v14.8.0 2024-03-22 */function sJ(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}/*! @azure/msal-common v14.8.0 2024-03-22 */function oJ(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}/*! @azure/msal-common v14.8.0 2024-03-22 */const le={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues"},aJ={NotStarted:0,InProgress:1,Completed:2};/*! @azure/msal-common v14.8.0 2024-03-22 */const Sd=(n,e,t,r,i)=>(...s)=>{t.trace(`Executing function ${e}`);const o=r==null?void 0:r.startMeasurement(e,i);if(i){const a=e+"CallCount";r==null||r.incrementFields({[a]:1},i)}try{const a=n(...s);return o==null||o.end({success:!0}),t.trace(`Returning result from ${e}`),a}catch(a){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw o==null||o.end({success:!1},a),a}},Fe=(n,e,t,r,i)=>(...s)=>{t.trace(`Executing function ${e}`);const o=r==null?void 0:r.startMeasurement(e,i);if(i){const a=e+"CallCount";r==null||r.incrementFields({[a]:1},i)}return r==null||r.setPreQueueTime(e,i),n(...s).then(a=>(t.trace(`Returning result from ${e}`),o==null||o.end({success:!0}),a)).catch(a=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw o==null||o.end({success:!1},a),a})};/*! @azure/msal-common v14.8.0 2024-03-22 */class lS{constructor(e,t,r,i){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=i}async detectRegion(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(le.RegionDiscoveryDetectRegion,this.correlationId);let r=e;if(r)t.region_source=ch.ENVIRONMENT_VARIABLE;else{const s=lS.IMDS_OPTIONS;try{const o=await Fe(this.getRegionFromIMDS.bind(this),le.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(de.IMDS_VERSION,s);if(o.status===q0.httpSuccess&&(r=o.body,t.region_source=ch.IMDS),o.status===q0.httpBadRequest){const a=await Fe(this.getCurrentVersion.bind(this),le.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(s);if(!a)return t.region_source=ch.FAILED_AUTO_DETECTION,null;const l=await Fe(this.getRegionFromIMDS.bind(this),le.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(a,s);l.status===q0.httpSuccess&&(r=l.body,t.region_source=ch.IMDS)}}catch{return t.region_source=ch.FAILED_AUTO_DETECTION,null}}return r||(t.region_source=ch.FAILED_AUTO_DETECTION),r||null}async getRegionFromIMDS(e,t){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(le.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${de.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,de.IMDS_TIMEOUT)}async getCurrentVersion(e){var t;(t=this.performanceClient)==null||t.addQueueMeasurement(le.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const r=await this.networkInterface.sendGetRequestAsync(`${de.IMDS_ENDPOINT}?format=json`,e);return r.status===q0.httpBadRequest&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}}}lS.IMDS_OPTIONS={headers:{Metadata:"true"}};/*! @azure/msal-common v14.8.0 2024-03-22 */class Zr{constructor(e,t,r,i,s,o,a){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=i,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=s,this.performanceClient=a,this.correlationId=o,this.regionDiscovery=new lS(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(de.CIAM_AUTH_URL))return ro.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case de.ADFS:return ro.Adfs;case de.DSTS:return ro.Dsts}return ro.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new Ht(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw be(Ta)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw be(Ta)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw be(Ta)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw be(YF);return this.replacePath(this.metadata.end_session_endpoint)}else throw be(Ta)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw be(Ta)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw be(Ta)}canReplaceTenant(e){return e.PathSegments.length===1&&!Zr.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===ro.Default&&this.protocolMode===za.AAD}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const i=new Ht(this.metadata.canonical_authority).getUrlComponents(),s=i.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((a,l)=>{let c=s[l];if(l===0&&this.canReplaceTenant(i)){const u=new Ht(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];c!==u&&(this.logger.verbose(`Replacing tenant domain name ${c} with id ${u}`),c=u)}a!==c&&(t=t.replace(`/${c}/`,`/${a}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===ro.Adfs||this.protocolMode!==za.AAD&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){var i,s;(i=this.performanceClient)==null||i.addQueueMeasurement(le.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await Fe(this.updateCloudDiscoveryMetadata.bind(this),le.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const r=await Fe(this.updateEndpointMetadata.bind(this),le.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),(s=this.performanceClient)==null||s.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:LL(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==ns.CACHE&&(r==null?void 0:r.source)!==ns.CACHE&&(e.expiresAt=LL(),e.canonical_authority=this.canonicalAuthority);const i=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(i,e),this.metadata=e}async updateEndpointMetadata(e){var i,s,o;(i=this.performanceClient)==null||i.addQueueMeasurement(le.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===ns.HARDCODED_VALUES&&(s=this.authorityOptions.azureRegionConfiguration)!=null&&s.azureRegion&&t.metadata){const a=await Fe(this.updateMetadataWithRegionalInformation.bind(this),le.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);Z0(e,a,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let r=await Fe(this.getEndpointMetadataFromNetwork.bind(this),le.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return(o=this.authorityOptions.azureRegionConfiguration)!=null&&o.azureRegion&&(r=await Fe(this.updateMetadataWithRegionalInformation.bind(this),le.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(r)),Z0(e,r,!0),ns.NETWORK;throw be(kF,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),Z0(e,t,!1),{source:ns.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const i=this.getEndpointMetadataFromHardcodedValues();if(i)return Z0(e,i,!1),{source:ns.HARDCODED_VALUES,metadata:i};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const r=OL(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!r?(this.logger.verbose("Found endpoint metadata in the cache."),{source:ns.CACHE}):(r&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new Ht(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw pn(ij)}return null}async getEndpointMetadataFromNetwork(){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(le.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const i=await this.networkInterface.sendGetRequestAsync(t,e);return iJ(i.body)?i.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(i){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${i}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in DL?DL[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){var r,i,s;(r=this.performanceClient)==null||r.addQueueMeasurement(le.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=(i=this.authorityOptions.azureRegionConfiguration)==null?void 0:i.azureRegion;if(t){if(t!==de.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=vT.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,Zr.replaceWithRegionalInformation(e,t);const o=await Fe(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),le.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)((s=this.authorityOptions.azureRegionConfiguration)==null?void 0:s.environmentRegion,this.regionDiscoveryMetadata);if(o)return this.regionDiscoveryMetadata.region_outcome=vT.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=o,Zr.replaceWithRegionalInformation(e,o);this.regionDiscoveryMetadata.region_outcome=vT.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(le.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const r=await Fe(this.getCloudDiscoveryMetadataFromNetwork.bind(this),le.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return _T(e,r,!0),ns.NETWORK;throw pn(sj)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||de.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||de.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||de.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),_T(e,t,!1),ns.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const i=cQ(this.hostnameAndPort);if(i)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),_T(e,i,!1),ns.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const r=OL(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!r?(this.logger.verbose("Found cloud discovery metadata in the cache."),ns.CACHE):(r&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===ro.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),Zr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=wy(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),pn(rR)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),Zr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(le.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${de.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let r=null;try{const s=await this.networkInterface.sendGetRequestAsync(e,t);let o,a;if(sJ(s.body))o=s.body,a=o.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${o.tenant_discovery_endpoint}`);else if(oJ(s.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${s.status}`),o=s.body,o.error===de.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${o.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${o.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),a=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=wy(a,this.hostnameAndPort)}catch(s){if(s instanceof Yn)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${s.errorCode}
Error Description: ${s.errorMessage}`);else{const o=s;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${o.name}
Error Description: ${o.message}`)}return null}return r||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),r=Zr.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&Ht.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==JM.None){const i=t.tenant?t.tenant:de.DEFAULT_COMMON_TENANT;r=`${t.azureCloudInstance}/${i}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.discoveryComplete())return this.metadata.preferred_cache;throw be(Ta)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return fj.has(e)}static isPublicCloudAuthority(e){return de.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){const i=new Ht(e);i.validateAsUri();const s=i.getUrlComponents();let o=`${t}.${s.HostNameAndPort}`;this.isPublicCloudAuthority(s.HostNameAndPort)&&(o=`${t}.${de.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const a=Ht.constructAuthorityUriFromObject({...i.getUrlComponents(),HostNameAndPort:o}).urlString;return r?`${a}?${r}`:a}static replaceWithRegionalInformation(e,t){const r={...e};return r.authorization_endpoint=Zr.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=Zr.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=Zr.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e;const i=new Ht(e).getUrlComponents();if(i.PathSegments.length===0&&i.HostNameAndPort.endsWith(de.CIAM_AUTH_URL)){const s=i.HostNameAndPort.split(".")[0];t=`${t}${s}${de.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}Zr.reservedTenantDomains=new Set(["{tenant}","{tenantid}",mc.COMMON,mc.CONSUMERS,mc.ORGANIZATIONS]);function lJ(n){var i;const r=(i=new Ht(n).getUrlComponents().PathSegments.slice(-1)[0])==null?void 0:i.toLowerCase();switch(r){case mc.COMMON:case mc.ORGANIZATIONS:case mc.CONSUMERS:return;default:return r}}function mj(n){return n.endsWith(de.FORWARD_SLASH)?n:`${n}${de.FORWARD_SLASH}`}function cJ(n){const e=n.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw pn(rR)}return{canonicalAuthority:n.authority?mj(n.authority):void 0,knownAuthorities:n.knownAuthorities,cloudDiscoveryMetadata:t}}/*! @azure/msal-common v14.8.0 2024-03-22 */async function gj(n,e,t,r,i,s,o){o==null||o.addQueueMeasurement(le.AuthorityFactoryCreateDiscoveredInstance,s);const a=Zr.transformCIAMAuthority(mj(n)),l=new Zr(a,e,t,r,i,s,o);try{return await Fe(l.resolveEndpointsAsync.bind(l),le.AuthorityResolveEndpointsAsync,i,o,s)(),l}catch{throw be(Ta)}}/*! @azure/msal-common v14.8.0 2024-03-22 */class lR{constructor(e,t){this.config=xQ(e),this.logger=new cd(this.config.loggerOptions,KF,QM),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new wQ(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[Go.CONTENT_TYPE]=de.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case cs.HOME_ACCOUNT_ID:try{const r=cf(e.credential);t[Go.CCS_HEADER]=`Oid:${r.uid}@${r.utid}`}catch(r){this.logger.verbose("Could not parse home account ID for CCS Header: "+r)}break;case cs.UPN:t[Go.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,r,i,s,o){var l,c,u,h;o&&((l=this.performanceClient)==null||l.addQueueMeasurement(o,s));const a=await this.networkManager.sendPostRequest(i,e,{body:t,headers:r});return(h=this.performanceClient)==null||h.addFields({refreshTokenSize:((c=a.body.refresh_token)==null?void 0:c.length)||0,httpVerToken:((u=a.headers)==null?void 0:u[Go.X_MS_HTTP_VERSION])||""},s),this.config.serverTelemetryManager&&a.status<500&&a.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),a}async updateAuthority(e,t){var s;(s=this.performanceClient)==null||s.addQueueMeasurement(le.UpdateTokenEndpointAuthority,t);const r=`https://${e}/${this.authority.tenant}/`,i=await gj(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=i}createTokenQueryParameters(e){const t=new xg;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()}}/*! @azure/msal-common v14.8.0 2024-03-22 */const Sy="no_tokens_found",vj="native_account_unavailable",cR="refresh_token_expired",uJ="interaction_required",dJ="consent_required",hJ="login_required",cS="bad_token";/*! @azure/msal-common v14.8.0 2024-03-22 */const HL=[uJ,dJ,hJ,cS],fJ=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],pJ={[Sy]:"No refresh token found in the cache. Please sign-in.",[vj]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[cR]:"Refresh token has expired.",[cS]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class yo extends Yn{constructor(e,t,r,i,s,o,a){super(e,t,r),Object.setPrototypeOf(this,yo.prototype),this.timestamp=i||de.EMPTY_STRING,this.traceId=s||de.EMPTY_STRING,this.correlationId=o||de.EMPTY_STRING,this.claims=a||de.EMPTY_STRING,this.name="InteractionRequiredAuthError"}}function VL(n,e,t){const r=!!n&&HL.indexOf(n)>-1,i=!!t&&fJ.indexOf(t)>-1,s=!!e&&HL.some(o=>e.indexOf(o)>-1);return r||s||i}function Yb(n){return new yo(n,pJ[n])}/*! @azure/msal-common v14.8.0 2024-03-22 */class Mf{constructor(e,t,r,i,s){this.account=e||null,this.idToken=t||null,this.accessToken=r||null,this.refreshToken=i||null,this.appMetadata=s||null}}/*! @azure/msal-common v14.8.0 2024-03-22 */class go{static setRequestState(e,t,r){const i=go.generateLibraryState(e,r);return t?`${i}${de.RESOURCE_DELIM}${t}`:i}static generateLibraryState(e,t){if(!e)throw be(Bb);const r={id:e.createNewGuid()};t&&(r.meta=t);const i=JSON.stringify(r);return e.base64Encode(i)}static parseRequestState(e,t){if(!e)throw be(Bb);if(!t)throw be(cp);try{const r=t.split(de.RESOURCE_DELIM),i=r[0],s=r.length>1?r.slice(1).join(de.RESOURCE_DELIM):de.EMPTY_STRING,o=e.base64Decode(i),a=JSON.parse(o);return{userRequestState:s||de.EMPTY_STRING,libraryState:a}}catch{throw be(cp)}}}/*! @azure/msal-common v14.8.0 2024-03-22 */const mJ={SW:"sw",UHW:"uhw"};class hp{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){var s;(s=this.performanceClient)==null||s.addQueueMeasurement(le.PopTokenGenerateCnf,e.correlationId);const r=await Fe(this.generateKid.bind(this),le.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),i=this.cryptoUtils.base64Encode(JSON.stringify(r));return{kid:r.kid,reqCnfString:i,reqCnfHash:await this.cryptoUtils.hashString(i)}}async generateKid(e){var r;return(r=this.performanceClient)==null||r.addQueueMeasurement(le.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:mJ.SW}}async signPopToken(e,t,r){return this.signPayload(e,t,r)}async signPayload(e,t,r,i){const{resourceRequestMethod:s,resourceRequestUri:o,shrClaims:a,shrNonce:l,shrOptions:c}=r,u=o?new Ht(o):void 0,h=u==null?void 0:u.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:ia(),m:s==null?void 0:s.toUpperCase(),u:h==null?void 0:h.HostNameAndPort,nonce:l||this.cryptoUtils.createNewGuid(),p:h==null?void 0:h.AbsolutePath,q:h!=null&&h.QueryString?[[],h.QueryString]:void 0,client_claims:a||void 0,...i},t,c,r.correlationId)}}/*! @azure/msal-common v14.8.0 2024-03-22 */class gJ{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}/*! @azure/msal-common v14.8.0 2024-03-22 */class ud{constructor(e,t,r,i,s,o,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=i,this.serializableCache=s,this.persistencePlugin=o,this.performanceClient=a}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw e.state?be(vy,"Cached State"):be(vy,"Server State");let r,i;try{r=decodeURIComponent(e.state)}catch{throw be(cp,e.state)}try{i=decodeURIComponent(t)}catch{throw be(cp,e.state)}if(r!==i)throw be(OF);if(e.error||e.error_description||e.suberror)throw VL(e.error,e.error_description,e.suberror)?new yo(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||""):new Cc(e.error||"",e.error_description,e.suberror)}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){const r=`${e.error_codes} - [${e.timestamp}]: ${e.error_description} - Correlation ID: ${e.correlation_id} - Trace ID: ${e.trace_id}`,i=new Cc(e.error,r,e.suberror);if(t&&e.status&&e.status>=K0.SERVER_ERROR_RANGE_START&&e.status<=K0.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${i}`);return}else if(t&&e.status&&e.status>=K0.CLIENT_ERROR_RANGE_START&&e.status<=K0.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${i}`);return}throw VL(e.error,e.error_description,e.suberror)?new yo(e.error,e.error_description,e.suberror,e.timestamp||de.EMPTY_STRING,e.trace_id||de.EMPTY_STRING,e.correlation_id||de.EMPTY_STRING,e.claims||de.EMPTY_STRING):i}}async handleServerTokenResponse(e,t,r,i,s,o,a,l,c){var _;(_=this.performanceClient)==null||_.addQueueMeasurement(le.HandleServerTokenResponse,e.correlation_id);let u;if(e.id_token){if(u=wd(e.id_token||de.EMPTY_STRING,this.cryptoObj.base64Decode),s&&s.nonce&&u.nonce!==s.nonce)throw be(DF);if(i.maxAge||i.maxAge===0){const y=u.auth_time;if(!y)throw be($M);$F(y,i.maxAge)}}this.homeAccountIdentifier=_r.generateHomeAccountId(e.client_info||de.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,u);let h;s&&s.state&&(h=go.parseRequestState(this.cryptoObj,s.state)),e.key_id=e.key_id||i.sshKid||void 0;const f=this.generateCacheRecord(e,t,r,i,u,o,s);let p;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),p=new gJ(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(p)),a&&!l&&f.account){const y=f.account.generateAccountKey();if(!this.cacheStorage.getAccount(y,this.logger))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await ud.generateAuthenticationResult(this.cryptoObj,t,f,!1,i,u,h,void 0,c)}await this.cacheStorage.saveCacheRecord(f,i.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&p&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(p))}return ud.generateAuthenticationResult(this.cryptoObj,t,f,!1,i,u,h,e,c)}generateCacheRecord(e,t,r,i,s,o,a){const l=t.getPreferredCache();if(!l)throw be(qM);const c=uj(s);let u,h;e.id_token&&s&&(u=sS(this.homeAccountIdentifier,l,e.id_token,this.clientId,c||""),h=uR(this.cacheStorage,t,this.homeAccountIdentifier,s,this.cryptoObj.base64Decode,e.client_info,l,c,a,void 0,this.logger));let f=null;if(e.access_token){const y=e.scope?ir.fromString(e.scope):new ir(i.scopes||[]),g=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,m=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,v=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,x=r+g,w=x+m,E=v&&v>0?r+v:void 0;f=oS(this.homeAccountIdentifier,l,e.access_token,this.clientId,c||t.tenant||"",y.printScopes(),x,w,this.cryptoObj.base64Decode,E,e.token_type,o,e.key_id,i.claims,i.requestedClaimsHash)}let p=null;if(e.refresh_token){let y;if(e.refresh_token_expires_in){const g=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;y=r+g}p=XF(this.homeAccountIdentifier,l,e.refresh_token,this.clientId,e.foci,o,y)}let _=null;return e.foci&&(_={clientId:this.clientId,environment:l,familyId:e.foci}),new Mf(h,u,f,p,_)}static async generateAuthenticationResult(e,t,r,i,s,o,a,l,c){var x,w,E,S,C;let u=de.EMPTY_STRING,h=[],f=null,p,_,y=de.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType===dn.POP){const A=new hp(e),{secret:k,keyId:T}=r.accessToken;if(!T)throw be(ZM);u=await A.signPopToken(k,T,s)}else u=r.accessToken.secret;h=ir.fromString(r.accessToken.target).asArray(),f=new Date(Number(r.accessToken.expiresOn)*1e3),p=new Date(Number(r.accessToken.extendedExpiresOn)*1e3),r.accessToken.refreshOn&&(_=new Date(Number(r.accessToken.refreshOn)*1e3))}r.appMetadata&&(y=r.appMetadata.familyId===vg?vg:"");const g=(o==null?void 0:o.oid)||(o==null?void 0:o.sub)||"",m=(o==null?void 0:o.tid)||"";l!=null&&l.spa_accountid&&r.account&&(r.account.nativeAccountId=l==null?void 0:l.spa_accountid);const v=r.account?oR(r.account.getAccountInfo(),void 0,o,(x=r.idToken)==null?void 0:x.secret):null;return{authority:t.canonicalAuthority,uniqueId:g,tenantId:m,scopes:h,account:v,idToken:((w=r==null?void 0:r.idToken)==null?void 0:w.secret)||"",idTokenClaims:o||{},accessToken:u,fromCache:i,expiresOn:f,extExpiresOn:p,refreshOn:_,correlationId:s.correlationId,requestId:c||de.EMPTY_STRING,familyId:y,tokenType:((E=r.accessToken)==null?void 0:E.tokenType)||de.EMPTY_STRING,state:a?a.userRequestState:de.EMPTY_STRING,cloudGraphHostName:((S=r.account)==null?void 0:S.cloudGraphHostName)||de.EMPTY_STRING,msGraphHost:((C=r.account)==null?void 0:C.msGraphHost)||de.EMPTY_STRING,code:l==null?void 0:l.spa_code,fromNativeBroker:!1}}}function uR(n,e,t,r,i,s,o,a,l,c,u){u==null||u.verbose("setCachedAccount called");const f=n.getAccountKeys().find(g=>g.startsWith(t));let p=null;f&&(p=n.getAccount(f,u));const _=p||_r.createAccount({homeAccountId:t,idTokenClaims:r,clientInfo:s,environment:o,cloudGraphHostName:l==null?void 0:l.cloud_graph_host_name,msGraphHost:l==null?void 0:l.msgraph_host,nativeAccountId:c},e,i),y=_.tenantProfiles||[];if(a&&!y.find(g=>g.tenantId===a)){const g=sR(t,r);y.push(g)}return _.tenantProfiles=y,_}/*! @azure/msal-common v14.8.0 2024-03-22 */class _j extends lR{constructor(e,t){var r;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=(r=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:r.defaultScopes}async getAuthCodeUrl(e){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(le.GetAuthCodeUrl,e.correlationId);const t=await Fe(this.createAuthCodeUrlQueryString.bind(this),le.AuthClientCreateQueryString,this.logger,this.performanceClient,e.correlationId)(e);return Ht.appendQueryString(this.authority.authorizationEndpoint,t)}async acquireToken(e,t){var a,l;if((a=this.performanceClient)==null||a.addQueueMeasurement(le.AuthClientAcquireToken,e.correlationId),!e.code)throw be(jF);const r=ia(),i=await Fe(this.executeTokenRequest.bind(this),le.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),s=(l=i.headers)==null?void 0:l[Go.X_MS_REQUEST_ID],o=new ud(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return o.validateTokenResponse(i.body),Fe(o.handleServerTokenResponse.bind(o),le.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(i.body,this.authority,r,e,t,void 0,void 0,void 0,s)}handleFragmentResponse(e,t){if(new ud(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw be(GF);return e}getLogoutUri(e){if(!e)throw pn(nj);const t=this.createLogoutUrlQueryString(e);return Ht.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){var c,u;(c=this.performanceClient)==null||c.addQueueMeasurement(le.AuthClientExecuteTokenRequest,t.correlationId);const r=this.createTokenQueryParameters(t),i=Ht.appendQueryString(e.tokenEndpoint,r),s=await Fe(this.createTokenRequestBody.bind(this),le.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let o;if(t.clientInfo)try{const h=xy(t.clientInfo,this.cryptoUtils.base64Decode);o={credential:`${h.uid}${ri.CLIENT_INFO_SEPARATOR}${h.utid}`,type:cs.HOME_ACCOUNT_ID}}catch(h){this.logger.verbose("Could not parse client info for CCS Header: "+h)}const a=this.createTokenRequestHeaders(o||t.ccsCredential),l={clientId:((u=t.tokenBodyParameters)==null?void 0:u.clientId)||this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return Fe(this.executePostToTokenEndpoint.bind(this),le.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(i,s,a,l,t.correlationId,le.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var s,o;(s=this.performanceClient)==null||s.addQueueMeasurement(le.AuthClientCreateTokenRequestBody,e.correlationId);const t=new xg;if(t.addClientId(((o=e.tokenBodyParameters)==null?void 0:o[dp])||this.config.authOptions.clientId),this.includeRedirectUri?t.addRedirectUri(e.redirectUri):hu.validateRedirectUri(e.redirectUri),t.addScopes(e.scopes,!0,this.oidcDefaultScopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addThrottling(),this.serverTelemetryManager&&!Wb(this.config)&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&t.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;t.addClientAssertion(a.assertion),t.addClientAssertionType(a.assertionType)}if(t.addGrantType(MF.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),e.authenticationScheme===dn.POP){const a=new hp(this.cryptoUtils,this.performanceClient),l=await Fe(a.generateCnf.bind(a),le.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger);t.addPopToken(l.reqCnfString)}else if(e.authenticationScheme===dn.SSH)if(e.sshJwk)t.addSshJwk(e.sshJwk);else throw pn(aS);const r=e.correlationId||this.config.cryptoInterface.createNewGuid();t.addCorrelationId(r),(!mo.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities);let i;if(e.clientInfo)try{const a=xy(e.clientInfo,this.cryptoUtils.base64Decode);i={credential:`${a.uid}${ri.CLIENT_INFO_SEPARATOR}${a.utid}`,type:cs.HOME_ACCOUNT_ID}}catch(a){this.logger.verbose("Could not parse client info for CCS Header: "+a)}else i=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&i)switch(i.type){case cs.HOME_ACCOUNT_ID:try{const a=cf(i.credential);t.addCcsOid(a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case cs.UPN:t.addCcsUpn(i.credential);break}return e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[BL])&&t.addExtraQueryParameters({[BL]:"1"}),t.createQueryString()}async createAuthCodeUrlQueryString(e){var s,o;(s=this.performanceClient)==null||s.addQueueMeasurement(le.AuthClientCreateQueryString,e.correlationId);const t=new xg;t.addClientId(((o=e.extraQueryParameters)==null?void 0:o[dp])||this.config.authOptions.clientId);const r=[...e.scopes||[],...e.extraScopesToConsent||[]];t.addScopes(r,!0,this.oidcDefaultScopes),t.addRedirectUri(e.redirectUri);const i=e.correlationId||this.config.cryptoInterface.createNewGuid();if(t.addCorrelationId(i),t.addResponseMode(e.responseMode),t.addResponseTypeCode(),t.addLibraryInfo(this.config.libraryInfo),Wb(this.config)||t.addApplicationTelemetry(this.config.telemetry.application),t.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&t.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&t.addPrompt(e.prompt),e.domainHint&&t.addDomainHint(e.domainHint),e.prompt!==Rr.SELECT_ACCOUNT)if(e.sid&&e.prompt===Rr.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),t.addSid(e.sid);else if(e.account){const a=this.extractAccountSid(e.account),l=this.extractLoginHint(e.account);if(l){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),t.addLoginHint(l);try{const c=cf(e.account.homeAccountId);t.addCcsOid(c)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(a&&e.prompt===Rr.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),t.addSid(a);try{const c=cf(e.account.homeAccountId);t.addCcsOid(c)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),t.addLoginHint(e.account.username);try{const c=cf(e.account.homeAccountId);t.addCcsOid(c)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),t.addLoginHint(e.loginHint),t.addCcsUpn(e.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&t.addNonce(e.nonce),e.state&&t.addState(e.state),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),e.nativeBroker&&(t.addNativeBroker(),e.authenticationScheme===dn.POP)){const a=new hp(this.cryptoUtils),l=await Fe(a.generateCnf.bind(a),le.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger);t.addPopToken(l.reqCnfHash)}return t.createQueryString()}createLogoutUrlQueryString(e){const t=new xg;return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),t.createQueryString()}extractAccountSid(e){var t;return((t=e.idTokenClaims)==null?void 0:t.sid)||null}extractLoginHint(e){var t;return((t=e.idTokenClaims)==null?void 0:t.login_hint)||null}}/*! @azure/msal-common v14.8.0 2024-03-22 */const vJ=300;class Kb extends lR{constructor(e,t){super(e,t)}async acquireToken(e){var o,a;(o=this.performanceClient)==null||o.addQueueMeasurement(le.RefreshTokenClientAcquireToken,e.correlationId);const t=ia(),r=await Fe(this.executeTokenRequest.bind(this),le.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),i=(a=r.headers)==null?void 0:a[Go.X_MS_REQUEST_ID],s=new ud(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return s.validateTokenResponse(r.body),Fe(s.handleServerTokenResponse.bind(s),le.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,i)}async acquireTokenByRefreshToken(e){var r;if(!e)throw pn(tj);if((r=this.performanceClient)==null||r.addQueueMeasurement(le.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw be(XM);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await Fe(this.acquireTokenWithCachedRefreshToken.bind(this),le.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(i){const s=i instanceof yo&&i.errorCode===Sy,o=i instanceof Cc&&i.errorCode===AL.INVALID_GRANT_ERROR&&i.subError===AL.CLIENT_MISMATCH_ERROR;if(s||o)return Fe(this.acquireTokenWithCachedRefreshToken.bind(this),le.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw i}return Fe(this.acquireTokenWithCachedRefreshToken.bind(this),le.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){var s;(s=this.performanceClient)==null||s.addQueueMeasurement(le.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const r=Sd(this.cacheManager.getRefreshToken.bind(this.cacheManager),le.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,void 0,this.performanceClient,e.correlationId);if(!r)throw Yb(Sy);if(r.expiresOn&&Vb(r.expiresOn,e.refreshTokenExpirationOffsetSeconds||vJ))throw Yb(cR);const i={...e,refreshToken:r.secret,authenticationScheme:e.authenticationScheme||dn.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:cs.HOME_ACCOUNT_ID}};try{return await Fe(this.acquireToken.bind(this),le.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(i)}catch(o){if(o instanceof yo&&o.subError===cS){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const a=lf(r);this.cacheManager.removeRefreshToken(a)}throw o}}async executeTokenRequest(e,t){var l,c;(l=this.performanceClient)==null||l.addQueueMeasurement(le.RefreshTokenClientExecuteTokenRequest,e.correlationId);const r=this.createTokenQueryParameters(e),i=Ht.appendQueryString(t.tokenEndpoint,r),s=await Fe(this.createTokenRequestBody.bind(this),le.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),o=this.createTokenRequestHeaders(e.ccsCredential),a={clientId:((c=e.tokenBodyParameters)==null?void 0:c.clientId)||this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return Fe(this.executePostToTokenEndpoint.bind(this),le.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(i,s,o,a,e.correlationId,le.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var i,s,o;(i=this.performanceClient)==null||i.addQueueMeasurement(le.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=e.correlationId,r=new xg;if(r.addClientId(((s=e.tokenBodyParameters)==null?void 0:s[dp])||this.config.authOptions.clientId),e.redirectUri&&r.addRedirectUri(e.redirectUri),r.addScopes(e.scopes,!0,(o=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:o.defaultScopes),r.addGrantType(MF.REFRESH_TOKEN_GRANT),r.addClientInfo(),r.addLibraryInfo(this.config.libraryInfo),r.addApplicationTelemetry(this.config.telemetry.application),r.addThrottling(),this.serverTelemetryManager&&!Wb(this.config)&&r.addServerTelemetry(this.serverTelemetryManager),r.addCorrelationId(t),r.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&r.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;r.addClientAssertion(a.assertion),r.addClientAssertionType(a.assertionType)}if(e.authenticationScheme===dn.POP){const a=new hp(this.cryptoUtils,this.performanceClient),l=await Fe(a.generateCnf.bind(a),le.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger);r.addPopToken(l.reqCnfString)}else if(e.authenticationScheme===dn.SSH)if(e.sshJwk)r.addSshJwk(e.sshJwk);else throw pn(aS);if((!mo.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case cs.HOME_ACCOUNT_ID:try{const a=cf(e.ccsCredential.credential);r.addCcsOid(a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case cs.UPN:r.addCcsUpn(e.ccsCredential.credential);break}return e.tokenBodyParameters&&r.addExtraQueryParameters(e.tokenBodyParameters),r.createQueryString()}}/*! @azure/msal-common v14.8.0 2024-03-22 */class _J extends lR{constructor(e,t){super(e,t)}async acquireToken(e){var t;try{const[r,i]=await this.acquireCachedToken({...e,scopes:(t=e.scopes)!=null&&t.length?e.scopes:[...Lp]});return i===Pl.PROACTIVELY_REFRESHED&&(this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new Kb(this.config,this.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),r}catch(r){if(r instanceof iS&&r.errorCode===Jl)return new Kb(this.config,this.performanceClient).acquireTokenByRefreshToken(e);throw r}}async acquireCachedToken(e){var l;(l=this.performanceClient)==null||l.addQueueMeasurement(le.SilentFlowClientAcquireCachedToken,e.correlationId);let t=Pl.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!mo.isEmptyObj(e.claims))throw this.setCacheOutcome(Pl.FORCE_REFRESH_OR_CLAIMS,e.correlationId),be(Jl);if(!e.account)throw be(XM);const r=e.account.tenantId||lJ(e.authority),i=this.cacheManager.getTokenKeys(),s=this.cacheManager.getAccessToken(e.account,e,i,r,this.performanceClient,e.correlationId);if(s){if(KZ(s.cachedAt)||Vb(s.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(Pl.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),be(Jl);s.refreshOn&&Vb(s.refreshOn,0)&&(t=Pl.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(Pl.NO_CACHED_ACCESS_TOKEN,e.correlationId),be(Jl);const o=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.readAccountFromCache(e.account),accessToken:s,idToken:this.cacheManager.getIdToken(e.account,i,r,this.performanceClient,e.correlationId),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(o)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await Fe(this.generateResultFromCacheRecord.bind(this),le.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(a,e),t]}setCacheOutcome(e,t){var r,i;(r=this.serverTelemetryManager)==null||r.setCacheOutcome(e),(i=this.performanceClient)==null||i.addFields({cacheOutcome:e},t),e!==Pl.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(le.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let r;if(e.idToken&&(r=wd(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const s=r==null?void 0:r.auth_time;if(!s)throw be($M);$F(s,t.maxAge)}return ud.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)}}/*! @azure/msal-common v14.8.0 2024-03-22 */const xJ={sendGetRequestAsync:()=>Promise.reject(be(Nt)),sendPostRequestAsync:()=>Promise.reject(be(Nt))};/*! @azure/msal-common v14.8.0 2024-03-22 */const xj="missing_kid_error",yj="missing_alg_error";/*! @azure/msal-common v14.8.0 2024-03-22 */const yJ={[xj]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[yj]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class dR extends Yn{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,dR.prototype)}}function GL(n){return new dR(n,yJ[n])}/*! @azure/msal-common v14.8.0 2024-03-22 */class hR{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw GL(xj);if(!e.alg)throw GL(yj);const t=new hR({typ:e.typ||PZ.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}/*! @azure/msal-common v14.8.0 2024-03-22 */class Ey{constructor(e,t){this.cacheOutcome=Pl.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||de.EMPTY_STRING,this.wrapperVer=e.wrapperVer||de.EMPTY_STRING,this.telemetryCacheKey=Lr.CACHE_KEY+ri.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${Lr.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer].join(Lr.VALUE_SEPARATOR),r=this.getRegionDiscoveryFields(),i=[e,r].join(Lr.VALUE_SEPARATOR);return[Lr.SCHEMA_VERSION,i,t].join(Lr.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Ey.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(Lr.VALUE_SEPARATOR),i=e.errors.slice(0,t).join(Lr.VALUE_SEPARATOR),s=e.errors.length,o=t<s?Lr.OVERFLOW_TRUE:Lr.OVERFLOW_FALSE,a=[s,o].join(Lr.VALUE_SEPARATOR);return[Lr.SCHEMA_VERSION,e.cacheHits,r,i,a].join(Lr.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=Lr.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof Yn?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(Lr.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=Ey.maxErrorsToSend(e),r=e.errors.length;if(t===r)this.cacheManager.removeItem(this.telemetryCacheKey);else{const i={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,i)}}static maxErrorsToSend(e){let t,r=0,i=0;const s=e.errors.length;for(t=0;t<s;t++){const o=e.failedRequests[2*t]||de.EMPTY_STRING,a=e.failedRequests[2*t+1]||de.EMPTY_STRING,l=e.errors[t]||de.EMPTY_STRING;if(i+=o.toString().length+a.toString().length+l.length+3,i<Lr.MAX_LAST_HEADER_BYTES)r+=1;else break}return r}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||de.EMPTY_STRING),e.push(this.regionSource||de.EMPTY_STRING),e.push(this.regionOutcome||de.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}}/*! @azure/msal-common v14.8.0 2024-03-22 */class WL{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class wJ{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:aJ.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new WL}}startPerformanceMeasurement(){return new WL}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}/*! @azure/msal-browser v3.11.0 2024-03-22 */const fR="pkce_not_created",wj="crypto_nonexistent",uS="empty_navigate_uri",Sj="hash_empty_error",pR="no_state_in_hash",Ej="hash_does_not_contain_known_properties",Tj="unable_to_parse_state",Cj="state_interaction_type_mismatch",bj="interaction_in_progress",Aj="popup_window_error",Mj="empty_window_error",dd="user_cancelled",SJ="monitor_popup_timeout",Rj="monitor_window_timeout",Nj="redirect_in_iframe",Ij="block_iframe_reload",Pj="block_nested_popups",EJ="iframe_closed_prematurely",dS="silent_logout_unsupported",kj="no_account_error",TJ="silent_prompt_value_error",Lj="no_token_request_cache_error",Oj="unable_to_parse_token_request_cache_error",mR="no_cached_authority_error",CJ="auth_request_not_set_error",bJ="invalid_cache_type",Dj="non_browser_environment",Oh="database_not_open",Ty="no_network_connectivity",Uj="post_request_failed",Fj="get_request_failed",$b="failed_to_parse_response",Js="unable_to_load_token",gR="crypto_key_not_found",jj="auth_code_required",zj="auth_code_or_nativeAccountId_required",Bj="spa_code_and_nativeAccountId_present",vR="database_unavailable",Hj="unable_to_acquire_token_from_native_platform",Vj="native_handshake_timeout",Gj="native_extension_not_installed",Pv="native_connection_not_established",Wj="uninitialized_public_client_application",Yj="native_prompt_not_supported",Kj="invalid_base64_string";/*! @azure/msal-browser v3.11.0 2024-03-22 */const va="For more visit: aka.ms/msaljs/browser-errors",AJ={[fR]:"The PKCE code challenge and verifier could not be generated.",[wj]:"The crypto object or function is not available.",[uS]:"Navigation URI is empty. Please check stack trace for more info.",[Sj]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${va}`,[pR]:"Hash does not contain state. Please verify that the request originated from msal.",[Ej]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${va}`,[Tj]:"Unable to parse state. Please verify that the request originated from msal.",[Cj]:"Hash contains state but the interaction type does not match the caller.",[bj]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${va}`,[Aj]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[Mj]:"window.open returned null or undefined window object.",[dd]:"User cancelled the flow.",[SJ]:`Token acquisition in popup failed due to timeout.  ${va}`,[Rj]:`Token acquisition in iframe failed due to timeout.  ${va}`,[Nj]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[Ij]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${va}`,[Pj]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[EJ]:"The iframe being monitored was closed prematurely.",[dS]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[kj]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[TJ]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[Lj]:"No token request found in cache.",[Oj]:"The cached token request could not be parsed.",[mR]:"No cached authority found.",[CJ]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[bJ]:"Invalid cache type",[Dj]:"Login and token requests are not supported in non-browser environments.",[Oh]:"Database is not open!",[Ty]:"No network connectivity. Check your internet connection.",[Uj]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[Fj]:"Network request failed. Please check the network trace to determine root cause.",[$b]:"Failed to parse network response. Check network trace.",[Js]:"Error loading token to cache.",[gR]:"Cryptographic Key or Keypair not found in browser storage.",[jj]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[zj]:"An authorization code or nativeAccountId must be provided to this flow.",[Bj]:"Request cannot contain both spa code and native account id.",[vR]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[Hj]:`Unable to acquire token from native platform.  ${va}`,[Vj]:"Timed out while attempting to establish connection to browser extension",[Gj]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[Pv]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${va}`,[Wj]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${va}`,[Yj]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Kj]:"Invalid base64 encoded string."};class kv extends Yn{constructor(e){super(e,AJ[e]),Object.setPrototypeOf(this,kv.prototype),this.name="BrowserAuthError"}}function Ye(n){return new kv(n)}/*! @azure/msal-browser v3.11.0 2024-03-22 */const so={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},Gm={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},Iu={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},hr={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},YL={GET:"GET",POST:"POST"},rn={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},wl={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},Q0={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},Tn={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var rt;(function(n){n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none"})(rt||(rt={}));const KL={scopes:Lp},$j="jwk",Xb="msal.db",MJ=1,RJ=`${Xb}.keys`,Cs={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},NJ=[Cs.Default,Cs.Skip,Cs.RefreshTokenAndNetwork],IJ="msal.browser.log.level",PJ="msal.browser.log.pii";/*! @azure/msal-browser v3.11.0 2024-03-22 */function xT(n){return encodeURIComponent(_R(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function hS(n){return Xj(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function _R(n){return Xj(new TextEncoder().encode(n))}function Xj(n){const e=Array.from(n,t=>String.fromCodePoint(t)).join("");return btoa(e)}/*! @azure/msal-browser v3.11.0 2024-03-22 */const kJ="RSASSA-PKCS1-v1_5",qj="SHA-256",LJ=2048,OJ=new Uint8Array([1,0,1]),$L="0123456789abcdef",XL=new Uint32Array(1),xR={name:kJ,hash:qj,modulusLength:LJ,publicExponent:OJ};function DJ(n){if("crypto"in window)n.verbose("BrowserCrypto: modern crypto interface available");else throw n.error("BrowserCrypto: crypto interface is unavailable"),Ye(wj)}async function Zj(n,e,t){e==null||e.addQueueMeasurement(le.Sha256Digest,t);const i=new TextEncoder().encode(n);return window.crypto.subtle.digest(qj,i)}function UJ(n){return window.crypto.getRandomValues(n)}function yT(){return window.crypto.getRandomValues(XL),XL[0]}function el(){const n=Date.now(),e=yT()*1024+(yT()&1023),t=new Uint8Array(16),r=Math.trunc(e/2**30),i=e&2**30-1,s=yT();t[0]=n/2**40,t[1]=n/2**32,t[2]=n/2**24,t[3]=n/2**16,t[4]=n/2**8,t[5]=n,t[6]=112|r>>>8,t[7]=r,t[8]=128|i>>>24,t[9]=i>>>16,t[10]=i>>>8,t[11]=i,t[12]=s>>>24,t[13]=s>>>16,t[14]=s>>>8,t[15]=s;let o="";for(let a=0;a<t.length;a++)o+=$L.charAt(t[a]>>>4),o+=$L.charAt(t[a]&15),(a===3||a===5||a===7||a===9)&&(o+="-");return o}async function FJ(n,e){return window.crypto.subtle.generateKey(xR,n,e)}async function wT(n){return window.crypto.subtle.exportKey($j,n)}async function jJ(n,e,t){return window.crypto.subtle.importKey($j,n,xR,e,t)}async function zJ(n,e){return window.crypto.subtle.sign(xR,n,e)}async function Qj(n){const e=await Zj(n),t=new Uint8Array(e);return hS(t)}/*! @azure/msal-browser v3.11.0 2024-03-22 */const Jj="storage_not_supported",BJ="stubbed_public_client_application_called",ez="in_mem_redirect_unavailable";/*! @azure/msal-browser v3.11.0 2024-03-22 */const HJ={[Jj]:"Given storage configuration option was not supported.",[BJ]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[ez]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class yR extends Yn{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,yR.prototype)}}function tz(n){return new yR(n,HJ[n])}/*! @azure/msal-browser v3.11.0 2024-03-22 */function VJ(n){n.location.hash="",typeof n.history.replaceState=="function"&&n.history.replaceState(null,"",`${n.location.origin}${n.location.pathname}${n.location.search}`)}function GJ(n){const e=n.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function wR(){return window.parent!==window}function WJ(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${so.POPUP_NAME_PREFIX}.`)===0}function Da(){return window.location.href.split("?")[0].split("#")[0]}function YJ(){const e=new Ht(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function KJ(){if(Ht.hashContainsKnownProperties(window.location.hash)&&wR())throw Ye(Ij)}function $J(n){if(wR()&&!n)throw Ye(Nj)}function XJ(){if(WJ())throw Ye(Pj)}function qJ(){if(typeof window>"u")throw Ye(Dj)}function nz(n){if(!n)throw Ye(Wj)}function Dh(n){qJ(),KJ(),XJ(),nz(n)}function qL(n,e){if(Dh(n),$J(e.system.allowRedirectInIframe),e.cache.cacheLocation===hr.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw tz(ez)}function rz(n){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(n).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}const ZJ="modulepreload",QJ=function(n,e){return new URL(n,e).href},ZL={},JJ=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){const s=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.all(t.map(l=>{if(l=QJ(l,r),l in ZL)return;ZL[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(!!r)for(let p=s.length-1;p>=0;p--){const _=s[p];if(_.href===l&&(!c||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${u}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":ZJ,c||(f.as="script",f.crossOrigin=""),f.href=l,a&&f.setAttribute("nonce",a),document.head.appendChild(f),c)return new Promise((p,_)=>{f.addEventListener("load",p),f.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${l}`)))})}))}return i.then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};/*! @azure/msal-browser v3.11.0 2024-03-22 */class Cy{navigateInternal(e,t){return Cy.defaultNavigateWindow(e,t)}navigateExternal(e,t){return Cy.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(r=>{setTimeout(()=>{r(!0)},t.timeout)})}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class eee{async sendGetRequestAsync(e,t){let r;try{r=await fetch(e,{method:YL.GET,headers:this.getFetchHeaders(t)})}catch{throw window.navigator.onLine?Ye(Fj):Ye(Ty)}try{return{headers:this.getHeaderDict(r.headers),body:await r.json(),status:r.status}}catch{throw Ye($b)}}async sendPostRequestAsync(e,t){const r=t&&t.body||de.EMPTY_STRING;let i;try{i=await fetch(e,{method:YL.POST,headers:this.getFetchHeaders(t),body:r})}catch{throw window.navigator.onLine?Ye(Uj):Ye(Ty)}try{return{headers:this.getHeaderDict(i.headers),body:await i.json(),status:i.status}}catch{throw Ye($b)}}getFetchHeaders(e){const t=new Headers;if(!(e&&e.headers))return t;const r=e.headers;return Object.keys(r).forEach(i=>{t.append(i,r[i])}),t}getHeaderDict(e){const t={};return e.forEach((r,i)=>{t[i]=r}),t}}/*! @azure/msal-browser v3.11.0 2024-03-22 */const tee=6e4,qb=1e4,nee=3e4,ree=2e3;function iee({auth:n,cache:e,system:t,telemetry:r},i){const s={clientId:de.EMPTY_STRING,authority:`${de.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:de.EMPTY_STRING,authorityMetadata:de.EMPTY_STRING,redirectUri:de.EMPTY_STRING,postLogoutRedirectUri:de.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:za.AAD,OIDCOptions:{serverResponseType:Iv.FRAGMENT,defaultScopes:[de.OPENID_SCOPE,de.PROFILE_SCOPE,de.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:JM.None,tenant:de.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1},o={cacheLocation:hr.SessionStorage,temporaryCacheLocation:hr.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===hr.LocalStorage),claimsBasedCachingEnabled:!1},a={loggerCallback:()=>{},logLevel:kn.Info,piiLoggingEnabled:!1},c={...{...pj,loggerOptions:a,networkClient:i?new eee:xJ,navigationClient:new Cy,loadFrameTimeout:0,windowHashTimeout:(t==null?void 0:t.loadFrameTimeout)||tee,iframeHashTimeout:(t==null?void 0:t.loadFrameTimeout)||qb,navigateFrameWait:0,redirectNavigationTimeout:nee,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:(t==null?void 0:t.nativeBrokerHandshakeTimeout)||ree,pollIntervalMilliseconds:so.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:(t==null?void 0:t.loggerOptions)||a},u={application:{appName:de.EMPTY_STRING,appVersion:de.EMPTY_STRING},client:new wJ};if((n==null?void 0:n.protocolMode)!==za.OIDC&&(n!=null&&n.OIDCOptions)&&new cd(c.loggerOptions).warning(JSON.stringify(pn(aj))),n!=null&&n.protocolMode&&n.protocolMode!==za.AAD&&(c!=null&&c.allowNativeBroker))throw pn(lj);return{auth:{...s,...n,OIDCOptions:{...s.OIDCOptions,...n==null?void 0:n.OIDCOptions}},cache:{...o,...e},system:c,telemetry:{...u,...r}}}/*! @azure/msal-browser v3.11.0 2024-03-22 */const see="@azure/msal-browser",SR="3.11.0";/*! @azure/msal-browser v3.11.0 2024-03-22 */class ER{static loggerCallback(e,t){switch(e){case kn.Error:console.error(t);return;case kn.Info:console.info(t);return;case kn.Verbose:console.debug(t);return;case kn.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){var l;this.browserEnvironment=typeof window<"u",this.config=iee(e,this.browserEnvironment);let t;try{t=window[hr.SessionStorage]}catch{}const r=t==null?void 0:t.getItem(IJ),i=(l=t==null?void 0:t.getItem(PJ))==null?void 0:l.toLowerCase(),s=i==="true"?!0:i==="false"?!1:void 0,o={...this.config.system.loggerOptions},a=r&&Object.keys(kn).includes(r)?kn[r]:void 0;a&&(o.loggerCallback=ER.loggerCallback,o.logLevel=a),s!==void 0&&(o.piiLoggingEnabled=s),this.logger=new cd(o,see,SR),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class hd extends ER{getModuleName(){return hd.MODULE_NAME}getId(){return hd.ID}async initialize(){return this.available=typeof window<"u",this.available}}hd.MODULE_NAME="";hd.ID="StandardOperatingContext";async function oee(n){const e=new hd(n);return await e.initialize(),(await JJ(()=>Promise.resolve().then(()=>zee),void 0,import.meta.url)).StandardController.createController(e)}/*! @azure/msal-browser v3.11.0 2024-03-22 */function Zo(n){return new TextDecoder().decode(aee(n))}function aee(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw Ye(Kj)}const t=atob(e);return Uint8Array.from(t,r=>r.codePointAt(0)||0)}/*! @azure/msal-browser v3.11.0 2024-03-22 */class lee{constructor(){this.dbName=Xb,this.version=MJ,this.tableName=RJ,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",i=>{i.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",i=>{const s=i;this.db=s.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t(Ye(vR)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(Ye(Oh));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);o.addEventListener("success",a=>{const l=a;this.closeConnection(),t(l.target.result)}),o.addEventListener("error",a=>{this.closeConnection(),r(a)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((r,i)=>{if(!this.db)return i(Ye(Oh));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);a.addEventListener("success",()=>{this.closeConnection(),r()}),a.addEventListener("error",l=>{this.closeConnection(),i(l)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(Ye(Oh));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);o.addEventListener("success",()=>{this.closeConnection(),t()}),o.addEventListener("error",a=>{this.closeConnection(),r(a)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(Ye(Oh));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();s.addEventListener("success",o=>{const a=o;this.closeConnection(),e(a.target.result)}),s.addEventListener("error",o=>{this.closeConnection(),t(o)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(Ye(Oh));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);o.addEventListener("success",a=>{const l=a;this.closeConnection(),t(l.target.result===1)}),o.addEventListener("error",a=>{this.closeConnection(),r(a)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const r=window.indexedDB.deleteDatabase(Xb),i=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(i),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(i),e(!0))),r.addEventListener("error",()=>(clearTimeout(i),t(!1)))})}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class Zb{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class cee{constructor(e){this.inMemoryCache=new Zb,this.indexedDBCache=new lee,this.logger=e}handleDatabaseAccessError(e){if(e instanceof kv&&e.errorCode===vR)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(r){this.handleDatabaseAccessError(r)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(r){this.handleDatabaseAccessError(r)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(r){this.handleDatabaseAccessError(r)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class fp{constructor(e,t){this.logger=e,DJ(e),this.cache=new cee(this.logger),this.performanceClient=t}createNewGuid(){return el()}base64Encode(e){return _R(e)}base64Decode(e){return Zo(e)}async getPublicKeyThumbprint(e){var u;const t=(u=this.performanceClient)==null?void 0:u.startMeasurement(le.CryptoOptsGetPublicKeyThumbprint,e.correlationId),r=await FJ(fp.EXTRACTABLE,fp.POP_KEY_USAGES),i=await wT(r.publicKey),s={e:i.e,kty:i.kty,n:i.n},o=QL(s),a=await this.hashString(o),l=await wT(r.privateKey),c=await jJ(l,!1,["sign"]);return await this.cache.setItem(a,{privateKey:c,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),a}async removeTokenBindingKey(e){return await this.cache.removeItem(e),!await this.cache.containsKey(e)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,r,i){var x;const s=(x=this.performanceClient)==null?void 0:x.startMeasurement(le.CryptoOptsSignJwt,i),o=await this.cache.getItem(t);if(!o)throw Ye(gR);const a=await wT(o.publicKey),l=QL(a),c=xT(JSON.stringify({kid:t})),u=hR.getShrHeaderString({...r==null?void 0:r.header,alg:a.alg,kid:c}),h=xT(u);e.cnf={jwk:JSON.parse(l)};const f=xT(JSON.stringify(e)),p=`${h}.${f}`,y=new TextEncoder().encode(p),g=await zJ(o.privateKey,y),m=hS(new Uint8Array(g)),v=`${p}.${m}`;return s&&s.end({success:!0}),v}async hashString(e){return Qj(e)}}fp.POP_KEY_USAGES=["sign","verify"];fp.EXTRACTABLE=!0;function QL(n){return JSON.stringify(n,Object.keys(n).sort())}/*! @azure/msal-browser v3.11.0 2024-03-22 */class JL{constructor(e){this.validateWindowStorage(e),this.windowStorage=window[e]}validateWindowStorage(e){if(e!==hr.LocalStorage&&e!==hr.SessionStorage||!window[e])throw tz(Jj)}getItem(e){return this.windowStorage.getItem(e)}setItem(e,t){this.windowStorage.setItem(e,t)}removeItem(e){this.windowStorage.removeItem(e)}getKeys(){return Object.keys(this.windowStorage)}containsKey(e){return this.windowStorage.hasOwnProperty(e)}}/*! @azure/msal-browser v3.11.0 2024-03-22 */function iz(n,e){if(!e)return null;try{return go.parseRequestState(n,e).libraryState.meta}catch{throw be(cp)}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class Qb extends up{constructor(e,t,r,i,s){super(e,r,i,s),this.COOKIE_LIFE_MULTIPLIER=24*60*60*1e3,this.cacheConfig=t,this.logger=i,this.internalStorage=new Zb,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupTemporaryCacheStorage(this.cacheConfig.temporaryCacheLocation,this.cacheConfig.cacheLocation),t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps())}setupBrowserStorage(e){switch(e){case hr.LocalStorage:case hr.SessionStorage:try{return new JL(e)}catch(t){this.logger.verbose(t);break}}return this.cacheConfig.cacheLocation=hr.MemoryStorage,new Zb}setupTemporaryCacheStorage(e,t){switch(t){case hr.LocalStorage:case hr.SessionStorage:try{return new JL(e||hr.SessionStorage)}catch(r){return this.logger.verbose(r),this.internalStorage}case hr.MemoryStorage:default:return this.internalStorage}}migrateCacheEntries(){const e=`${de.CACHE_PREFIX}.${Tr.ID_TOKEN}`,t=`${de.CACHE_PREFIX}.${Tr.CLIENT_INFO}`,r=`${de.CACHE_PREFIX}.${Tr.ERROR}`,i=`${de.CACHE_PREFIX}.${Tr.ERROR_DESC}`,s=this.browserStorage.getItem(e),o=this.browserStorage.getItem(t),a=this.browserStorage.getItem(r),l=this.browserStorage.getItem(i),c=[s,o,a,l];[Tr.ID_TOKEN,Tr.CLIENT_INFO,Tr.ERROR,Tr.ERROR_DESC].forEach((h,f)=>{const p=c[f];p&&this.setTemporaryCache(h,p,!0)})}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");const e=this.getItem(wl.ACCOUNT_KEYS),t=this.getItem(`${wl.TOKEN_KEYS}.${this.clientId}`);if(e&&t){this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration.");return}this.browserStorage.getKeys().forEach(i=>{if(this.isCredentialKey(i)){const s=this.getItem(i);if(s){const o=this.validateAndParseJson(s);if(o&&o.hasOwnProperty("credentialType"))switch(o.credentialType){case ut.ID_TOKEN:if(PL(o)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${i} found, saving key to token key map`);const a=o,l=this.updateCredentialCacheKey(i,a);this.addTokenKey(l,ut.ID_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${i}`);break;case ut.ACCESS_TOKEN:case ut.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(IL(o)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${i} found, saving key to token key map`);const a=o,l=this.updateCredentialCacheKey(i,a);this.addTokenKey(l,ut.ACCESS_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${i}`);break;case ut.REFRESH_TOKEN:if(kL(o)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${i} found, saving key to token key map`);const a=o,l=this.updateCredentialCacheKey(i,a);this.addTokenKey(l,ut.REFRESH_TOKEN);return}else this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${i}`);break}}}if(this.isAccountKey(i)){const s=this.getItem(i);if(s){const o=this.validateAndParseJson(s);o&&_r.isAccountEntity(o)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${i} found, saving key to account key map`),this.addAccountKeyToMap(i))}}})}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t){this.browserStorage.setItem(e,t)}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const r=this.getCachedAccountEntity(e);return this.updateOutdatedCachedAccount(e,r,t)}getCachedAccountEntity(e){const t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;const r=this.validateAndParseJson(t);return!r||!_r.isAccountEntity(r)?(this.removeAccountKeyFromMap(e),null):up.toObject(new _r,r)}setAccount(e){this.logger.trace("BrowserCacheManager.setAccount called");const t=e.generateAccountKey();this.setItem(t,JSON.stringify(e)),this.addAccountKeyToMap(t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");const e=this.getItem(wl.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const t=this.getAccountKeys();t.indexOf(e)===-1?(t.push(e),this.setItem(wl.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const t=this.getAccountKeys(),r=t.indexOf(e);r>-1?(t.splice(r,1),this.setItem(wl.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}async removeAccount(e){super.removeAccount(e),this.removeAccountKeyFromMap(e)}removeOutdatedAccount(e){this.removeItem(e),this.removeAccountKeyFromMap(e)}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,ut.ID_TOKEN)}async removeAccessToken(e){super.removeAccessToken(e),this.removeTokenKey(e,ut.ACCESS_TOKEN)}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,ut.REFRESH_TOKEN)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");const e=this.getItem(`${wl.TOKEN_KEYS}.${this.clientId}`);if(e){const t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");const r=this.getTokenKeys();switch(t){case ut.ID_TOKEN:r.idToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),r.idToken.push(e));break;case ut.ACCESS_TOKEN:r.accessToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),r.accessToken.push(e));break;case ut.REFRESH_TOKEN:r.refreshToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),r.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),be(Hb)}this.setItem(`${wl.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");const r=this.getTokenKeys();switch(t){case ut.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const i=r.idToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),r.idToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case ut.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const s=r.accessToken.indexOf(e);s>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),r.accessToken.splice(s,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case ut.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const o=r.refreshToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),r.refreshToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),be(Hb)}this.setItem(`${wl.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}getIdTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,ut.ID_TOKEN),null;const r=this.validateAndParseJson(t);return!r||!PL(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,ut.ID_TOKEN),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),r)}setIdTokenCredential(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const t=lf(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,ut.ID_TOKEN)}getAccessTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,ut.ACCESS_TOKEN),null;const r=this.validateAndParseJson(t);return!r||!IL(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,ut.ACCESS_TOKEN),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),r)}setAccessTokenCredential(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const t=lf(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,ut.ACCESS_TOKEN)}getRefreshTokenCredential(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,ut.REFRESH_TOKEN),null;const r=this.validateAndParseJson(t);return!r||!kL(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,ut.REFRESH_TOKEN),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),r)}setRefreshTokenCredential(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const t=lf(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,ut.REFRESH_TOKEN)}getAppMetadata(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!nQ(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");const t=tQ(e);this.setItem(t,JSON.stringify(e))}getServerTelemetry(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!JZ(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const r=this.validateAndParseJson(t);return r&&rQ(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(Q0.WRAPPER_SKU,e),this.internalStorage.setItem(Q0.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(Q0.WRAPPER_SKU)||de.EMPTY_STRING,t=this.internalStorage.getItem(Q0.WRAPPER_VER)||de.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){const e=this.generateCacheKey(Tr.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(e);if(!t){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");const i=this.generateCacheKey(Tr.ACTIVE_ACCOUNT),s=this.getItem(i);if(!s)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;const o=this.getAccountInfoFilteredBy({localAccountId:s});return o?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(o),o):null}const r=this.validateAndParseJson(t);return r?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:r.homeAccountId,localAccountId:r.localAccountId,tenantId:r.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){const t=this.generateCacheKey(Tr.ACTIVE_ACCOUNT_FILTERS),r=this.generateCacheKey(Tr.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");const i={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.browserStorage.setItem(t,JSON.stringify(i)),this.browserStorage.setItem(r,e.localAccountId)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(r)}getThrottlingCache(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const r=this.validateAndParseJson(t);return!r||!eQ(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){const r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const s=this.getItemCookie(r);if(s)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),s}const i=this.temporaryCacheStorage.getItem(r);if(!i){if(this.cacheConfig.cacheLocation===hr.LocalStorage){const s=this.browserStorage.getItem(r);if(s)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),s}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),i}setTemporaryCache(e,t,r){const i=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(i,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(i,t))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(e))}getKeys(){return this.browserStorage.getKeys()}async clear(){await this.removeAllAccounts(),this.removeAppMetadata(),this.temporaryCacheStorage.getKeys().forEach(e=>{(e.indexOf(de.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{(e.indexOf(de.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(e)}),this.internalStorage.clear()}async clearTokensAndKeysWithClaims(e){e.addQueueMeasurement(le.ClearTokensAndKeysWithClaims);const t=this.getTokenKeys(),r=[];t.accessToken.forEach(i=>{const s=this.getAccessTokenCredential(i);s!=null&&s.requestedClaimsHash&&i.includes(s.requestedClaimsHash.toLowerCase())&&r.push(this.removeAccessToken(i))}),await Promise.all(r),r.length>0&&this.logger.warning(`${r.length} access tokens with claims in the cache keys have been removed from the cache.`)}setItemCookie(e,t,r){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;if(r){const s=this.getCookieExpirationTime(r);i+=`expires=${s};`}this.cacheConfig.secureCookies&&(i+="Secure;"),document.cookie=i}getItemCookie(e){const t=`${encodeURIComponent(e)}=`,r=document.cookie.split(";");for(let i=0;i<r.length;i++){let s=r[i];for(;s.charAt(0)===" ";)s=s.substring(1);if(s.indexOf(t)===0)return decodeURIComponent(s.substring(t.length,s.length))}return de.EMPTY_STRING}clearMsalCookies(){const e=`${de.CACHE_PREFIX}.${this.clientId}`;document.cookie.split(";").forEach(r=>{for(;r.charAt(0)===" ";)r=r.substring(1);if(r.indexOf(e)===0){const i=r.split("=")[0];this.clearItemCookie(i)}})}clearItemCookie(e){this.setItemCookie(e,de.EMPTY_STRING,-1)}getCookieExpirationTime(e){const t=new Date;return new Date(t.getTime()+e*this.COOKIE_LIFE_MULTIPLIER).toUTCString()}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):mo.startsWith(e,de.CACHE_PREFIX)||mo.startsWith(e,Tr.ADAL_ID_TOKEN)?e:`${de.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=go.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${rn.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=go.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${rn.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=go.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${rn.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),r=this.getTemporaryCache(t);if(!r)return null;const i=this.generateAuthorityKey(r);return this.getTemporaryCache(i)}updateCacheEntries(e,t,r,i,s){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const o=this.generateStateKey(e);this.setTemporaryCache(o,e,!1);const a=this.generateNonceKey(e);this.setTemporaryCache(a,t,!1);const l=this.generateAuthorityKey(e);if(this.setTemporaryCache(l,r,!1),s){const c={credential:s.homeAccountId,type:cs.HOME_ACCOUNT_ID};this.setTemporaryCache(rn.CCS_CREDENTIAL,JSON.stringify(c),!0)}else if(i){const c={credential:i,type:cs.UPN};this.setTemporaryCache(rn.CCS_CREDENTIAL,JSON.stringify(c),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{t.indexOf(e)!==-1&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(rn.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(rn.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(rn.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(rn.CORRELATION_ID)),this.removeTemporaryItem(this.generateCacheKey(rn.CCS_CREDENTIAL)),this.removeTemporaryItem(this.generateCacheKey(rn.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),r=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r||de.EMPTY_STRING)}this.clearMsalCookies()}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(t.indexOf(rn.REQUEST_STATE)===-1)return;const r=this.temporaryCacheStorage.getItem(t);if(!r)return;const i=iz(this.cryptoImpl,r);i&&i.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r))}),this.clearMsalCookies(),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=_R(JSON.stringify(e));this.setTemporaryCache(rn.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(rn.REQUEST_PARAMS,!0);if(!t)throw Ye(Lj);let r;try{r=JSON.parse(Zo(t))}catch(i){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${i}`),Ye(Oj)}if(this.removeTemporaryItem(this.generateCacheKey(rn.REQUEST_PARAMS)),!r.authority){const i=this.generateAuthorityKey(e),s=this.getTemporaryCache(i);if(!s)throw Ye(mR);r.authority=s}return r}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(rn.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${de.CACHE_PREFIX}.${rn.INTERACTION_STATUS_KEY}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){const t=`${de.CACHE_PREFIX}.${rn.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw Ye(bj);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}getLegacyLoginHint(){const e=this.getTemporaryCache(Tr.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(Tr.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));const t=this.getTemporaryCache(Tr.ID_TOKEN,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(Tr.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));const r=t||e;if(r){const i=wd(r,Zo);if(i.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),i.preferred_username;if(i.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),i.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t){const r=lf(t);if(e!==r){const i=this.getItem(e);if(i)return this.browserStorage.removeItem(e),this.setItem(r,i),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),r;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}async hydrateCache(e,t){var a,l,c,u,h;const r=sS((a=e.account)==null?void 0:a.homeAccountId,(l=e.account)==null?void 0:l.environment,e.idToken,this.clientId,e.tenantId);let i;t.claims&&(i=await this.cryptoImpl.hashString(t.claims));const s=oS((c=e.account)==null?void 0:c.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),((u=e.expiresOn)==null?void 0:u.getTime())||0,((h=e.extExpiresOn)==null?void 0:h.getTime())||0,Zo,void 0,e.tokenType,void 0,t.sshKid,t.claims,i),o=new Mf(void 0,r,s);return this.saveCacheRecord(o)}}const uee=(n,e)=>{const t={cacheLocation:hr.MemoryStorage,temporaryCacheLocation:hr.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new Qb(n,t,_y,e)};/*! @azure/msal-browser v3.11.0 2024-03-22 */const ct={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"};/*! @azure/msal-browser v3.11.0 2024-03-22 */class dee{constructor(e,t){this.eventCallbacks=new Map,this.logger=e,this.browserCrypto=t,this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}addEventCallback(e){if(typeof window<"u"){const t=el();return this.eventCallbacks.set(t,e),this.logger.verbose(`Event callback registered with id: ${t}`),t}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}enableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}emitEvent(e,t,r,i){if(typeof window<"u"){const s={eventType:e,interactionType:t||null,payload:r||null,error:i||null,timestamp:Date.now()};this.logger.info(`Emitting event: ${e}`),this.eventCallbacks.forEach((o,a)=>{this.logger.verbose(`Emitting event to callback ${a}: ${e}`),o.apply(null,[s])})}}handleAccountCacheChange(e){var t;try{(t=e.key)!=null&&t.includes(Tr.ACTIVE_ACCOUNT_FILTERS)&&this.emitEvent(ct.ACTIVE_ACCOUNT_CHANGED);const r=e.newValue||e.oldValue;if(!r)return;const i=JSON.parse(r);if(typeof i!="object"||!_r.isAccountEntity(i))return;const o=up.toObject(new _r,i).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.emitEvent(ct.ACCOUNT_ADDED,void 0,o)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.emitEvent(ct.ACCOUNT_REMOVED,void 0,o))}catch{return}}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class sz{constructor(e,t,r,i,s,o,a,l,c){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=s,this.navigationClient=o,this.nativeMessageHandler=l,this.correlationId=c||el(),this.logger=i.clone(so.MSAL_SKU,SR,this.correlationId),this.performanceClient=a}async clearCacheOnLogout(e){if(e){_r.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null));try{await this.browserStorage.removeAccount(_r.generateAccountCacheKey(e)),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),await this.browserStorage.clear(),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri||Da();return Ht.getAbsoluteUrl(t,Da())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Ey(r,this.browserStorage)}async getDiscoveredAuthority(e,t,r){this.performanceClient.addQueueMeasurement(le.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const i={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},s=e||this.config.auth.authority,o=Zr.generateAuthority(s,t||this.config.auth.azureCloudOptions),a=await Fe(gj,le.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(o,this.config.system.networkClient,this.browserStorage,i,this.logger,this.correlationId,this.performanceClient);if(r&&!a.isAlias(r.environment))throw pn(cj);return a}}/*! @azure/msal-browser v3.11.0 2024-03-22 */const hee=32;async function fee(n,e,t){n.addQueueMeasurement(le.GeneratePkceCodes,t);const r=Sd(pee,le.GenerateCodeVerifier,e,n,t)(n,e,t),i=await Fe(mee,le.GenerateCodeChallengeFromVerifier,e,n,t)(r,n,e,t);return{verifier:r,challenge:i}}function pee(n,e,t){try{const r=new Uint8Array(hee);return Sd(UJ,le.GetRandomValues,e,n,t)(r),hS(r)}catch{throw Ye(fR)}}async function mee(n,e,t,r){e.addQueueMeasurement(le.GenerateCodeChallengeFromVerifier,r);try{const i=await Fe(Zj,le.Sha256Digest,t,e,r)(n,e,r);return hS(new Uint8Array(i))}catch{throw Ye(fR)}}/*! @azure/msal-browser v3.11.0 2024-03-22 */async function TR(n,e,t,r){t.addQueueMeasurement(le.InitializeBaseRequest,n.correlationId);const i=n.authority||e.auth.authority,s=[...n&&n.scopes||[]],o={...n,correlationId:n.correlationId,authority:i,scopes:s};if(!o.authenticationScheme)o.authenticationScheme=dn.BEARER,r.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(o.authenticationScheme===dn.SSH){if(!n.sshJwk)throw pn(aS);if(!n.sshKid)throw pn(oj)}r.verbose(`Authentication Scheme set to "${o.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&n.claims&&!mo.isEmptyObj(n.claims)&&(o.requestedClaimsHash=await Qj(n.claims)),o}async function gee(n,e,t,r,i){r.addQueueMeasurement(le.InitializeSilentRequest,n.correlationId);const s=await Fe(TR,le.InitializeBaseRequest,i,r,n.correlationId)(n,t,r,i);return{...n,...s,account:e,forceRefresh:n.forceRefresh||!1}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class Op extends sz{async initializeAuthorizationCodeRequest(e){this.performanceClient.addQueueMeasurement(le.StandardInteractionClientInitializeAuthorizationCodeRequest,this.correlationId);const t=await Fe(fee,le.GeneratePkceCodes,this.logger,this.performanceClient,this.correlationId)(this.performanceClient,this.logger,this.correlationId),r={...e,redirectUri:e.redirectUri,code:de.EMPTY_STRING,codeVerifier:t.verifier};return e.codeChallenge=t.challenge,e.codeChallengeMethod=de.S256_CODE_CHALLENGE_METHOD,r}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e==null?void 0:e.correlationId);const t={correlationId:this.correlationId||el(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=Ht.getAbsoluteUrl(e.postLogoutRedirectUri,Da())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=Ht.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Da())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=Ht.getAbsoluteUrl(Da(),Da())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e,t,r,i){this.performanceClient.addQueueMeasurement(le.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const s=await Fe(this.getClientConfiguration.bind(this),le.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e,t,r,i);return new _j(s,this.performanceClient)}async getClientConfiguration(e,t,r,i){this.performanceClient.addQueueMeasurement(le.StandardInteractionClientGetClientConfiguration,this.correlationId);const s=await Fe(this.getDiscoveredAuthority.bind(this),le.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)(t,r,i),o=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:s,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:o.loggerCallback,piiLoggingEnabled:o.piiLoggingEnabled,logLevel:o.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:e,libraryInfo:{sku:so.MSAL_SKU,version:SR,cpu:de.EMPTY_STRING,os:de.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(le.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const r=this.getRedirectUri(e.redirectUri),i={interactionType:t},s=go.setRequestState(this.browserCrypto,e&&e.state||de.EMPTY_STRING,i),a={...await Fe(TR,le.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:r,state:s,nonce:e.nonce||el(),responseMode:this.config.auth.OIDCOptions.serverResponseType},l=e.account||this.browserStorage.getActiveAccount();if(l&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${l.homeAccountId}`,this.correlationId),a.account=l),!a.loginHint&&!l){const c=this.browserStorage.getLegacyLoginHint();c&&(a.loginHint=c)}return a}}/*! @azure/msal-browser v3.11.0 2024-03-22 */const vee="ContentError",oz="user_switch";/*! @azure/msal-browser v3.11.0 2024-03-22 */const _ee="USER_INTERACTION_REQUIRED",xee="USER_CANCEL",yee="NO_NETWORK",wee="PERSISTENT_ERROR",See="DISABLED",Eee="ACCOUNT_UNAVAILABLE";/*! @azure/msal-browser v3.11.0 2024-03-22 */const Tee=-2147186943,Cee={[oz]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Pa extends Yn{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,Pa.prototype),this.name="NativeAuthError",this.ext=r}}function Uh(n){if(n.ext&&n.ext.status&&(n.ext.status===wee||n.ext.status===See)||n.ext&&n.ext.error&&n.ext.error===Tee)return!0;switch(n.errorCode){case vee:return!0;default:return!1}}function Jb(n,e,t){if(t&&t.status)switch(t.status){case Eee:return Yb(vj);case _ee:return new yo(n,e);case xee:return Ye(dd);case yee:return Ye(Ty)}return new Pa(n,Cee[n]||e,t)}/*! @azure/msal-browser v3.11.0 2024-03-22 */class az extends Op{async acquireToken(e){this.performanceClient.addQueueMeasurement(le.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(Tn.acquireTokenSilent_silentFlow),r=await Fe(this.getClientConfiguration.bind(this),le.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(t,e.authority,e.azureCloudOptions,e.account),i=new _J(r,this.performanceClient);this.logger.verbose("Silent auth client created");try{const o=(await Fe(i.acquireCachedToken.bind(i),le.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),o}catch(s){throw s instanceof kv&&s.errorCode===gR&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),s}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t==null?void 0:t.account)}}/*! @azure/msal-browser v3.11.0 2024-03-22 */const ST={BROKER_CLIENT_ID:"brk_client_id",BROKER_REDIRECT_URI:"brk_redirect_uri"};class Rf extends sz{constructor(e,t,r,i,s,o,a,l,c,u,h,f){super(e,t,r,i,s,o,l,c,f),this.apiId=a,this.accountId=u,this.nativeMessageHandler=c,this.nativeStorageManager=h,this.silentCacheClient=new az(e,this.nativeStorageManager,r,i,s,o,l,c,f)}async acquireToken(e){this.performanceClient.addQueueMeasurement(le.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const t=this.performanceClient.startMeasurement(le.NativeInteractionClientAcquireToken,e.correlationId),r=ia(),i=await this.initializeNativeRequest(e);try{const l=await this.acquireTokensFromCache(this.accountId,i);return t.end({success:!0,isNativeBroker:!1,fromCache:!0}),l}catch{this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const s={method:Iu.GetToken,request:i},o=await this.nativeMessageHandler.sendMessage(s),a=this.validateNativeResponse(o);return this.handleNativeResponse(a,i,r).then(l=>(t.end({success:!0,isNativeBroker:!0,requestId:l.requestId}),l)).catch(l=>{throw t.end({success:!1,errorCode:l.errorCode,subErrorCode:l.subError,isNativeBroker:!0}),l})}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:ir.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),be(zb);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!r)throw be(zb);try{const i=this.createSilentCacheRequest(t,r),s=await this.silentCacheClient.acquireToken(i),o={...r,idTokenClaims:s==null?void 0:s.idTokenClaims,idToken:s==null?void 0:s.idToken};return{...s,account:o}}catch(i){throw i}}async acquireTokenRedirect(e){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const t=await this.initializeNativeRequest(e),r={method:Iu.GetToken,request:t};try{const o=await this.nativeMessageHandler.sendMessage(r);this.validateNativeResponse(o)}catch(o){if(o instanceof Pa&&Uh(o))throw o}this.browserStorage.setTemporaryCache(rn.NATIVE_REQUEST,JSON.stringify(t),!0);const i={apiId:Tn.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},s=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);await this.navigationClient.navigateExternal(s,i)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(e==null||e.addFields({errorCode:"no_cached_request"},t)),null;const{prompt:i,...s}=r;i&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(rn.NATIVE_REQUEST));const o={method:Iu.GetToken,request:s},a=ia();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const l=await this.nativeMessageHandler.sendMessage(o);this.validateNativeResponse(l);const c=this.handleNativeResponse(l,s,a);return this.browserStorage.setInteractionInProgress(!1),await c}catch(l){throw this.browserStorage.setInteractionInProgress(!1),l}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){var u;this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const i=wd(e.id_token,Zo),s=this.createHomeAccountIdentifier(e,i),o=(u=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId}))==null?void 0:u.homeAccountId;if(s!==o&&e.account.id!==t.accountId)throw Jb(oz);const a=await this.getDiscoveredAuthority(t.authority),l=uR(this.browserStorage,a,s,i,Zo,e.client_info,void 0,i.tid,void 0,e.account.id,this.logger),c=await this.generateAuthenticationResult(e,t,i,l,a.canonicalAuthority,r);return this.cacheAccount(l),this.cacheNativeTokens(e,t,s,i,c.accessToken,c.tenantId,r),c}createHomeAccountIdentifier(e,t){return _r.generateHomeAccountId(e.client_info||de.EMPTY_STRING,ro.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?ir.fromString(e.scope):ir.fromString(t.scope)}async generatePopAccessToken(e,t){if(t.tokenType===dn.POP){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const r=new hp(this.browserCrypto),i={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw be(ZM);return r.signPopToken(e.access_token,t.keyId,i)}else return e.access_token}async generateAuthenticationResult(e,t,r,i,s,o){const a=this.addTelemetryFromNativeResponse(e),l=e.scope?ir.fromString(e.scope):ir.fromString(t.scope),c=e.account.properties||{},u=c.UID||r.oid||r.sub||de.EMPTY_STRING,h=c.TenantId||r.tid||de.EMPTY_STRING,f=oR(i.getAccountInfo(),void 0,r,e.id_token);f.nativeAccountId!==e.account.id&&(f.nativeAccountId=e.account.id);const p=await this.generatePopAccessToken(e,t),_=t.tokenType===dn.POP?dn.POP:dn.BEARER;return{authority:s,uniqueId:u,tenantId:h,scopes:l.asArray(),account:f,idToken:e.id_token,idTokenClaims:r,accessToken:p,fromCache:a?this.isResponseFromCache(a):!1,expiresOn:new Date(Number(o+e.expires_in)*1e3),tokenType:_,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}cacheAccount(e){this.browserStorage.setAccount(e),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,r,i,s,o,a){const l=sS(r,t.authority,e.id_token||"",t.clientId,i.tid||""),c=t.tokenType===dn.POP?de.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,u=a+c,h=this.generateScopes(e,t),f=oS(r,t.authority,s,t.clientId,i.tid||o,h.printScopes(),u,0,Zo),p=new Mf(void 0,l,f);this.nativeStorageManager.saveCacheRecord(p,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw RF(WM,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority(t,e.azureCloudOptions,e.account);const r=new Ht(t);r.validateAsUri();const{scopes:i,...s}=e,o=new ir(i||[]);o.appendScopes(Lp);const a=()=>{switch(this.apiId){case Tn.ssoSilent:case Tn.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),Rr.NONE}if(!e.prompt){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e.prompt){case Rr.NONE:case Rr.CONSENT:case Rr.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),Ye(Yj)}},l={...s,accountId:this.accountId,clientId:this.config.auth.clientId,authority:r.urlString,scope:o.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:a(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1};if(this.handleExtraBrokerParams(l),l.extraParameters=l.extraParameters||{},l.extraParameters.telemetry=Gm.MATS_TELEMETRY,e.authenticationScheme===dn.POP){const c={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},u=new hp(this.browserCrypto),h=await Fe(u.generateCnf.bind(u),le.PopTokenGenerateCnf,this.logger,this.performanceClient,this.correlationId)(c,this.logger);l.reqCnf=h.reqCnfHash,l.keyId=h.kid}return l}handleExtraBrokerParams(e){if(e.extraParameters&&e.extraParameters.hasOwnProperty(ST.BROKER_CLIENT_ID)&&e.extraParameters.hasOwnProperty(ST.BROKER_REDIRECT_URI)&&e.extraParameters.hasOwnProperty(dp)){const t=e.extraParameters[dp],r=e.redirectUri,i=e.extraParameters[ST.BROKER_REDIRECT_URI];e.extraParameters={child_client_id:t,child_redirect_uri:r},e.redirectUri=i}}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class Wo{constructor(e,t,r,i){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=i,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(le.NativeMessageHandlerHandshake)}async sendMessage(e){this.logger.trace("NativeMessageHandler - sendMessage called.");const t={channel:Gm.CHANNEL_ID,extensionId:this.extensionId,responseId:el(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise((r,i)=>{this.resolvers.set(t.responseId,{resolve:r,reject:i})})}static async createProvider(e,t,r){e.trace("NativeMessageHandler - createProvider called.");try{const i=new Wo(e,t,r,Gm.PREFERRED_EXTENSION_ID);return await i.sendHandshakeRequest(),i}catch{const s=new Wo(e,t,r);return await s.sendHandshakeRequest(),s}}async sendHandshakeRequest(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:Gm.CHANNEL_ID,extensionId:this.extensionId,responseId:el(),body:{method:Iu.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(Ye(Vj)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==Gm.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===Iu.HandshakeRequest){const r=this.handshakeResolvers.get(t.responseId);if(!r){this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),r.reject(Ye(Gj))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,r=this.resolvers.get(t.responseId),i=this.handshakeResolvers.get(t.responseId);try{const s=t.body.method;if(s===Iu.Response){if(!r)return;const o=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(o)}`),o.status!=="Success")r.reject(Jb(o.code,o.description,o.ext));else if(o.result)o.result.code&&o.result.description?r.reject(Jb(o.result.code,o.result.description,o.result.ext)):r.resolve(o.result);else throw RF(WM,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(s===Iu.HandshakeResponse){if(!i){this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(s){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${s}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(s):i&&i.reject(s)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,r,i){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!r)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(i)switch(i){case dn.BEARER:case dn.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class CR{constructor(e,t,r,i,s){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=s}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(le.HandleCodeResponse,t.correlationId);let r;try{r=this.authModule.handleFragmentResponse(e,t.state)}catch(i){throw i instanceof Cc&&i.subError===dd?Ye(dd):i}return Fe(this.handleCodeResponseFromServer.bind(this),le.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(r,t)}async handleCodeResponseFromServer(e,t,r=!0){if(this.performanceClient.addQueueMeasurement(le.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await Fe(this.authModule.updateAuthority.bind(this.authModule),le.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const s=this.createCcsCredentials(t);s&&(this.authCodeRequest.ccsCredential=s)}return await Fe(this.authModule.acquireToken.bind(this.authModule),le.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:cs.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:cs.UPN}:null}}/*! @azure/msal-browser v3.11.0 2024-03-22 */function lz(n,e,t){const r=yy(n);if(!r)throw dj(n)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${n}`),Ye(Ej)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),Ye(Sj));return r}function bee(n,e,t){if(!n.state)throw Ye(pR);const r=iz(e,n.state);if(!r)throw Ye(Tj);if(r.interactionType!==t)throw Ye(Cj)}/*! @azure/msal-browser v3.11.0 2024-03-22 */class Aee extends Op{constructor(e,t,r,i,s,o,a,l,c,u){super(e,t,r,i,s,o,a,c,u),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=l}acquireToken(e){try{const t=this.generatePopupName(e.scopes||Lp,e.authority||this.config.auth.authority),r=e.popupWindowAttributes||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,t,r);{this.logger.verbose("asyncPopup set to false, opening popup before acquiring token");const i=this.openSizedPopup("about:blank",t,r);return this.acquireTokenPopupAsync(e,t,r,i)}}catch(t){return Promise.reject(t)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),r=this.generateLogoutPopupName(t),i=e&&e.authority,s=e&&e.mainWindowRedirectUri,o=(e==null?void 0:e.popupWindowAttributes)||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,o,i,void 0,s);{this.logger.verbose("asyncPopup set to false, opening popup");const a=this.openSizedPopup("about:blank",r,o);return this.logoutPopupAsync(t,r,o,i,a,s)}}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t,r,i){this.logger.verbose("acquireTokenPopupAsync called");const s=this.initializeServerTelemetryManager(Tn.acquireTokenPopup),o=await Fe(this.initializeAuthorizationRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,rt.Popup);rz(o.authority);try{const a=await Fe(this.initializeAuthorizationCodeRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(o),l=await Fe(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(s,o.authority,o.azureCloudOptions,o.account),c=Wo.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let u;c&&(u=this.performanceClient.startMeasurement(le.FetchAccountIdWithNativeBroker,e.correlationId));const h=await l.getAuthCodeUrl({...o,nativeBroker:c}),f=new CR(l,this.browserStorage,a,this.logger,this.performanceClient),p={popup:i,popupName:t,popupWindowAttributes:r},_=this.initiateAuthRequest(h,p);this.eventHandler.emitEvent(ct.POPUP_OPENED,rt.Popup,{popupWindow:_},null);const y=await this.monitorPopupForHash(_),g=Sd(lz,le.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(y,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(Ho.removeThrottle(this.browserStorage,this.config.auth.clientId,a),g.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),u&&u.end({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw Ye(Pv);const v=new Rf(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Tn.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,g.accountId,this.nativeStorage,o.correlationId),{userRequestState:x}=go.parseRequestState(this.browserCrypto,o.state);return await v.acquireToken({...o,state:x,prompt:void 0})}return await f.handleCodeResponse(g,o)}catch(a){throw i&&i.close(),a instanceof Yn&&(a.setCorrelationId(this.correlationId),s.cacheFailedRequest(a)),a}}async logoutPopupAsync(e,t,r,i,s,o){var l,c;this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(ct.LOGOUT_START,rt.Popup,e);const a=this.initializeServerTelemetryManager(Tn.logoutPopup);try{await this.clearCacheOnLogout(e.account);const u=await Fe(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(a,i,void 0,e.account||void 0);try{u.authority.endSessionEndpoint}catch{if((l=e.account)!=null&&l.homeAccountId&&e.postLogoutRedirectUri&&u.authority.protocolMode===za.OIDC){if(this.browserStorage.removeAccount((c=e.account)==null?void 0:c.homeAccountId),this.eventHandler.emitEvent(ct.LOGOUT_SUCCESS,rt.Popup,e),o){const p={apiId:Tn.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},_=Ht.getAbsoluteUrl(o,Da());await this.navigationClient.navigateInternal(_,p)}s&&s.close();return}}const h=u.getLogoutUri(e);this.eventHandler.emitEvent(ct.LOGOUT_SUCCESS,rt.Popup,e);const f=this.openPopup(h,{popupName:t,popupWindowAttributes:r,popup:s});if(this.eventHandler.emitEvent(ct.POPUP_OPENED,rt.Popup,{popupWindow:f},null),await this.monitorPopupForHash(f).catch(()=>{}),o){const p={apiId:Tn.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},_=Ht.getAbsoluteUrl(o,Da());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${_}`),await this.navigationClient.navigateInternal(_,p)}else this.logger.verbose("No main window navigation requested")}catch(u){throw s&&s.close(),u instanceof Yn&&(u.setCorrelationId(this.correlationId),a.cacheFailedRequest(u)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(ct.LOGOUT_FAILURE,rt.Popup,null,u),this.eventHandler.emitEvent(ct.LOGOUT_END,rt.Popup),u}this.eventHandler.emitEvent(ct.LOGOUT_END,rt.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),Ye(uS)}monitorPopupForHash(e){return new Promise((t,r)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const i=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(i),r(Ye(dd));return}let s="";try{s=e.location.href}catch{}if(!s||s==="about:blank")return;clearInterval(i);let o="";const a=this.config.auth.OIDCOptions.serverResponseType;e&&(a===Iv.QUERY?o=e.location.search:o=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(o)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e)})}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t.popupName,t.popupWindowAttributes)),!r)throw Ye(Mj);return r.focus&&r.focus(),this.currentWindow=r,window.addEventListener("beforeunload",this.unloadWindow),r}catch(r){throw this.logger.error("error opening popup "+r.message),this.browserStorage.setInteractionInProgress(!1),Ye(Aj)}}openSizedPopup(e,t,r){var f,p,_,y;const i=window.screenLeft?window.screenLeft:window.screenX,s=window.screenTop?window.screenTop:window.screenY,o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let l=(f=r.popupSize)==null?void 0:f.width,c=(p=r.popupSize)==null?void 0:p.height,u=(_=r.popupPosition)==null?void 0:_.top,h=(y=r.popupPosition)==null?void 0:y.left;return(!l||l<0||l>o)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),l=so.POPUP_WIDTH),(!c||c<0||c>a)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),c=so.POPUP_HEIGHT),(!u||u<0||u>a)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),u=Math.max(0,a/2-so.POPUP_HEIGHT/2+s)),(!h||h<0||h>o)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),h=Math.max(0,o/2-so.POPUP_WIDTH/2+i)),window.open(e,t,`width=${l}, height=${c}, top=${u}, left=${h}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(rt.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e){e&&e.close(),window.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${so.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${so.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class eO{constructor(e,t,r,i,s){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=i,this.performanceClient=s}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(rn.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(rn.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const r={apiId:Tn.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};if(typeof t.onRedirectNavigate=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),t.onRedirectNavigate(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await t.navigationClient.navigateExternal(e,r);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await t.navigationClient.navigateExternal(e,r);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),Ye(uS)}async handleCodeResponse(e,t){this.logger.verbose("RedirectHandler.handleCodeResponse called"),this.browserStorage.setInteractionInProgress(!1);const r=this.browserStorage.generateStateKey(t),i=this.browserStorage.getTemporaryCache(r);if(!i)throw be(vy,"Cached State");let s;try{s=this.authModule.handleFragmentResponse(e,i)}catch(c){throw c instanceof Cc&&c.subError===dd?Ye(dd):c}const o=this.browserStorage.generateNonceKey(i),a=this.browserStorage.getTemporaryCache(o);if(this.authCodeRequest.code=s.code,s.cloud_instance_host_name&&await Fe(this.authModule.updateAuthority.bind(this.authModule),le.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,this.authCodeRequest.correlationId)(s.cloud_instance_host_name,this.authCodeRequest.correlationId),s.nonce=a||void 0,s.state=i,s.client_info)this.authCodeRequest.clientInfo=s.client_info;else{const c=this.checkCcsCredentials();c&&(this.authCodeRequest.ccsCredential=c)}const l=await this.authModule.acquireToken(this.authCodeRequest,s);return this.browserStorage.cleanRequestByState(t),l}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(rn.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class Mee extends Op{constructor(e,t,r,i,s,o,a,l,c,u){super(e,t,r,i,s,o,a,c,u),this.nativeStorage=l}async acquireToken(e){const t=await Fe(this.initializeAuthorizationRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,rt.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null);const r=this.initializeServerTelemetryManager(Tn.acquireTokenRedirect),i=s=>{s.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent(ct.RESTORE_FROM_BFCACHE,rt.Redirect))};try{const s=await Fe(this.initializeAuthorizationCodeRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(t),o=await Fe(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(r,t.authority,t.azureCloudOptions,t.account),a=new eO(o,this.browserStorage,s,this.logger,this.performanceClient),l=await o.getAuthCodeUrl({...t,nativeBroker:Wo.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}),c=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${c}`),window.addEventListener("pageshow",i),await a.initiateAuthRequest(l,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:c,onRedirectNavigate:e.onRedirectNavigate})}catch(s){throw s instanceof Yn&&(s.setCorrelationId(this.correlationId),r.cacheFailedRequest(s)),window.removeEventListener("pageshow",i),this.browserStorage.cleanRequestByState(t.state),s}}async handleRedirectPromise(e,t,r){const i=this.initializeServerTelemetryManager(Tn.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[s,o]=this.getRedirectResponse(e||"");if(!s)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(rt.Redirect),t&&r&&(t==null||t.addFields({errorCode:"no_server_response"},r)),null;const a=this.browserStorage.getTemporaryCache(rn.ORIGIN_URI,!0)||de.EMPTY_STRING,l=Ht.removeHashFromUrl(a),c=Ht.removeHashFromUrl(window.location.href);if(l===c&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),a.indexOf("#")>-1&&GJ(a),await this.handleResponse(s,i);if(this.config.auth.navigateToLoginRequestUrl){if(!wR()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(rn.URL_HASH,o,!0);const u={apiId:Tn.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let h=!0;if(!a||a==="null"){const f=YJ();this.browserStorage.setTemporaryCache(rn.ORIGIN_URI,f,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),h=await this.navigationClient.navigateInternal(f,u)}else this.logger.verbose(`Navigating to loginRequestUrl: ${a}`),h=await this.navigationClient.navigateInternal(a,u);if(!h)return await this.handleResponse(s,i)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(s,i);return null}catch(s){throw s instanceof Yn&&(s.setCorrelationId(this.correlationId),i.cacheFailedRequest(s)),this.browserStorage.cleanRequestByInteractionType(rt.Redirect),s}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===Iv.QUERY?t=window.location.search:t=window.location.hash);let r=yy(t);if(r){try{bee(r,this.browserCrypto,rt.Redirect)}catch(s){return s instanceof Yn&&this.logger.error(`Interaction type validation failed due to ${s.errorCode}: ${s.errorMessage}`),[null,""]}return VJ(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}const i=this.browserStorage.getTemporaryCache(rn.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(rn.URL_HASH)),i&&(r=yy(i),r)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,i]):[null,""]}async handleResponse(e,t){const r=e.state;if(!r)throw Ye(pR);const i=this.browserStorage.getCachedRequest(r);if(this.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw Ye(Pv);const l=new Rf(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Tn.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,e.accountId,this.nativeStorage,i.correlationId),{userRequestState:c}=go.parseRequestState(this.browserCrypto,r);return l.acquireToken({...i,state:c,prompt:void 0}).finally(()=>{this.browserStorage.cleanRequestByState(r)})}const s=this.browserStorage.getCachedAuthority(r);if(!s)throw Ye(mR);const o=await Fe(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(t,s);return Ho.removeThrottle(this.browserStorage,this.config.auth.clientId,i),new eO(o,this.browserStorage,i,this.logger,this.performanceClient).handleCodeResponse(e,r)}async logout(e){var i,s;this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(Tn.logout);try{this.eventHandler.emitEvent(ct.LOGOUT_START,rt.Redirect,e),await this.clearCacheOnLogout(t.account);const o={apiId:Tn.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=await Fe(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)(r,e&&e.authority,void 0,e&&e.account||void 0);if(a.authority.protocolMode===za.OIDC)try{a.authority.endSessionEndpoint}catch{if((i=t.account)!=null&&i.homeAccountId){this.browserStorage.removeAccount((s=t.account)==null?void 0:s.homeAccountId),this.eventHandler.emitEvent(ct.LOGOUT_SUCCESS,rt.Redirect,t);return}}const l=a.getLogoutUri(t);if(this.eventHandler.emitEvent(ct.LOGOUT_SUCCESS,rt.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(l)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,o);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,o);return}}catch(o){throw o instanceof Yn&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),this.eventHandler.emitEvent(ct.LOGOUT_FAILURE,rt.Redirect,null,o),this.eventHandler.emitEvent(ct.LOGOUT_END,rt.Redirect),o}this.eventHandler.emitEvent(ct.LOGOUT_END,rt.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return Ht.getAbsoluteUrl(t,Da())}}/*! @azure/msal-browser v3.11.0 2024-03-22 */async function Ree(n,e,t,r,i){if(e.addQueueMeasurement(le.SilentHandlerInitiateAuthRequest,r),!n)throw t.info("Navigate url is empty"),Ye(uS);return i?Fe(Iee,le.SilentHandlerLoadFrame,t,e,r)(n,i,e,r):Sd(Pee,le.SilentHandlerLoadFrameSync,t,e,r)(n)}async function Nee(n,e,t,r,i,s,o){return r.addQueueMeasurement(le.SilentHandlerMonitorIframeForHash,s),new Promise((a,l)=>{e<qb&&i.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${qb}ms). This may result in timeouts.`);const c=window.setTimeout(()=>{window.clearInterval(u),l(Ye(Rj))},e),u=window.setInterval(()=>{let h="";const f=n.contentWindow;try{h=f?f.location.href:""}catch{}if(!h||h==="about:blank")return;let p="";f&&(o===Iv.QUERY?p=f.location.search:p=f.location.hash),window.clearTimeout(c),window.clearInterval(u),a(p)},t)}).finally(()=>{Sd(kee,le.RemoveHiddenIframe,i,r,s)(n)})}function Iee(n,e,t,r){return t.addQueueMeasurement(le.SilentHandlerLoadFrame,r),new Promise((i,s)=>{const o=cz();window.setTimeout(()=>{if(!o){s("Unable to load iframe");return}o.src=n,i(o)},e)})}function Pee(n){const e=cz();return e.src=n,e}function cz(){const n=document.createElement("iframe");return n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(n),n}function kee(n){document.body===n.parentNode&&document.body.removeChild(n)}/*! @azure/msal-browser v3.11.0 2024-03-22 */class Lee extends Op{constructor(e,t,r,i,s,o,a,l,c,u,h){super(e,t,r,i,s,o,l,u,h),this.apiId=a,this.nativeStorage=c}async acquireToken(e){this.performanceClient.addQueueMeasurement(le.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==Rr.NONE&&t.prompt!==Rr.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${Rr.NONE}`),t.prompt=Rr.NONE):t.prompt=Rr.NONE;const r=await Fe(this.initializeAuthorizationRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,rt.Silent);rz(r.authority);const i=this.initializeServerTelemetryManager(this.apiId);try{const s=await Fe(this.createAuthCodeClient.bind(this),le.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)(i,r.authority,r.azureCloudOptions,r.account);return await Fe(this.silentTokenHelper.bind(this),le.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(s,r)}catch(s){throw s instanceof Yn&&(s.setCorrelationId(this.correlationId),i.cacheFailedRequest(s)),s}}logout(){return Promise.reject(Ye(dS))}async silentTokenHelper(e,t){const r=t.correlationId;this.performanceClient.addQueueMeasurement(le.SilentIframeClientTokenHelper,r);const i=await Fe(this.initializeAuthorizationCodeRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,r)(t),s=await Fe(e.getAuthCodeUrl.bind(e),le.GetAuthCodeUrl,this.logger,this.performanceClient,r)({...t,nativeBroker:Wo.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}),o=new CR(e,this.browserStorage,i,this.logger,this.performanceClient),a=await Fe(Ree,le.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(s,this.performanceClient,this.logger,r,this.config.system.navigateFrameWait),l=this.config.auth.OIDCOptions.serverResponseType,c=await Fe(Nee,le.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,r,l),u=Sd(lz,le.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(c,l,this.logger);if(u.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw Ye(Pv);const h=new Rf(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,u.accountId,this.browserStorage,r),{userRequestState:f}=go.parseRequestState(this.browserCrypto,t.state);return Fe(h.acquireToken.bind(h),le.NativeInteractionClientAcquireToken,this.logger,this.performanceClient,r)({...t,state:f,prompt:t.prompt||Rr.NONE})}return Fe(o.handleCodeResponse.bind(o),le.HandleCodeResponse,this.logger,this.performanceClient,r)(u,t)}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class Oee extends Op{async acquireToken(e){this.performanceClient.addQueueMeasurement(le.SilentRefreshClientAcquireToken,e.correlationId);const t=await Fe(TR,le.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),r={...e,...t};e.redirectUri&&(r.redirectUri=this.getRedirectUri(e.redirectUri));const i=this.initializeServerTelemetryManager(Tn.acquireTokenSilent_silentFlow),s=await this.createRefreshTokenClient(i,r.authority,r.azureCloudOptions,r.account);return Fe(s.acquireTokenByRefreshToken.bind(s),le.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(r).catch(o=>{throw o.setCorrelationId(this.correlationId),i.cacheFailedRequest(o),o})}logout(){return Promise.reject(Ye(dS))}async createRefreshTokenClient(e,t,r,i){const s=await Fe(this.getClientConfiguration.bind(this),le.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e,t,r,i);return new Kb(s,this.performanceClient)}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class Dee{constructor(e,t,r,i){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=i}loadExternalTokens(e,t,r){if(this.logger.info("TokenCache - loadExternalTokens called"),!t.id_token)throw Ye(Js);const i=wd(t.id_token,Zo);let s,o,a;if(e.account)a=_r.createFromAccountInfo(e.account),s=new Mf(a,this.loadIdToken(t.id_token,a.homeAccountId,e.account.environment,e.account.tenantId),this.loadAccessToken(e,t,a.homeAccountId,e.account.environment,e.account.tenantId,r),this.loadRefreshToken(e,t,a.homeAccountId,e.account.environment));else if(e.authority){const l=Zr.generateAuthority(e.authority,e.azureCloudOptions),c={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache};if(o=new Zr(l,this.config.system.networkClient,this.storage,c,this.logger,e.correlationId||el()),r.clientInfo)this.logger.trace("TokenCache - homeAccountId from options"),a=this.loadAccount(i,o,r.clientInfo),s=new Mf(a,this.loadIdToken(t.id_token,a.homeAccountId,o.hostnameAndPort,o.tenant),this.loadAccessToken(e,t,a.homeAccountId,o.hostnameAndPort,o.tenant,r),this.loadRefreshToken(e,t,a.homeAccountId,o.hostnameAndPort));else if(t.client_info)this.logger.trace("TokenCache - homeAccountId from response"),a=this.loadAccount(i,o,t.client_info),s=new Mf(a,this.loadIdToken(t.id_token,a.homeAccountId,o.hostnameAndPort,o.tenant),this.loadAccessToken(e,t,a.homeAccountId,o.hostnameAndPort,o.tenant,r),this.loadRefreshToken(e,t,a.homeAccountId,o.hostnameAndPort));else throw Ye(Js)}else throw Ye(Js);return this.generateAuthenticationResult(e,i,s,a,o)}loadAccount(e,t,r,i){if(this.isBrowserEnvironment){this.logger.verbose("TokenCache - loading account");let s;if(i?s=i:t.authorityType!==void 0&&r&&(s=_r.generateHomeAccountId(r,t.authorityType,this.logger,this.cryptoObj,e)),!s)throw Ye(Js);const o=e.tid,a=uR(this.storage,t,s,e,Zo,r,t.hostnameAndPort,o,void 0,void 0,this.logger);return this.storage.setAccount(a),a}else throw Ye(Js)}loadIdToken(e,t,r,i){const s=sS(t,r,e,this.config.auth.clientId,i);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading id token"),this.storage.setIdTokenCredential(s),s;throw Ye(Js)}loadAccessToken(e,t,r,i,s,o){if(!t.access_token)return this.logger.verbose("TokenCache - No access token provided for caching"),null;if(!t.expires_in||!o.extendedExpiresOn)throw Ye(Js);const a=new ir(e.scopes).printScopes(),l=o.expiresOn||t.expires_in+new Date().getTime()/1e3,c=o.extendedExpiresOn,u=oS(r,i,t.access_token,this.config.auth.clientId,s,a,l,c,Zo);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading access token"),this.storage.setAccessTokenCredential(u),u;throw Ye(Js)}loadRefreshToken(e,t,r,i){if(!t.refresh_token)return this.logger.verbose("TokenCache - No refresh token provided for caching"),null;const s=XF(r,i,t.refresh_token,this.config.auth.clientId);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading refresh token"),this.storage.setRefreshTokenCredential(s),s;throw Ye(Js)}generateAuthenticationResult(e,t,r,i,s){var f,p;let o=de.EMPTY_STRING,a=[],l=null,c;r!=null&&r.accessToken&&(o=r.accessToken.secret,a=ir.fromString(r.accessToken.target).asArray(),l=new Date(Number(r.accessToken.expiresOn)*1e3),c=new Date(Number(r.accessToken.extendedExpiresOn)*1e3));const u=t.oid||t.sub||de.EMPTY_STRING,h=t.tid||de.EMPTY_STRING;return{authority:s?s.canonicalAuthority:de.EMPTY_STRING,uniqueId:u,tenantId:h,scopes:a,account:i.getAccountInfo(),idToken:((f=r.idToken)==null?void 0:f.secret)||"",idTokenClaims:t||{},accessToken:o,fromCache:!0,expiresOn:l,correlationId:e.correlationId||de.EMPTY_STRING,requestId:de.EMPTY_STRING,extExpiresOn:c,familyId:de.EMPTY_STRING,tokenType:((p=r==null?void 0:r.accessToken)==null?void 0:p.tokenType)||de.EMPTY_STRING,state:de.EMPTY_STRING,cloudGraphHostName:i.cloudGraphHostName||de.EMPTY_STRING,msGraphHost:i.msGraphHost||de.EMPTY_STRING,code:void 0,fromNativeBroker:!1}}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class Uee extends _j{constructor(e){super(e),this.includeRedirectUri=!1}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class Fee extends Op{constructor(e,t,r,i,s,o,a,l,c,u){super(e,t,r,i,s,o,l,c,u),this.apiId=a}async acquireToken(e){if(!e.code)throw Ye(jj);const t=await Fe(this.initializeAuthorizationRequest.bind(this),le.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,rt.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{const i={...t,code:e.code},s=await Fe(this.getClientConfiguration.bind(this),le.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)(r,t.authority,t.azureCloudOptions,t.account),o=new Uee(s);this.logger.verbose("Auth code client created");const a=new CR(o,this.browserStorage,i,this.logger,this.performanceClient);return await Fe(a.handleCodeResponseFromServer.bind(a),le.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(i){throw i instanceof Yn&&(i.setCorrelationId(this.correlationId),r.cacheFailedRequest(i)),i}}logout(){return Promise.reject(Ye(dS))}}/*! @azure/msal-browser v3.11.0 2024-03-22 */class fS{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new fp(this.logger,this.performanceClient):_y,this.eventHandler=new dee(this.logger,this.browserCrypto),this.browserStorage=this.isBrowserEnvironment?new Qb(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,cJ(this.config.auth)):uee(this.config.auth.clientId,this.logger);const t={cacheLocation:hr.MemoryStorage,temporaryCacheLocation:hr.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new Qb(this.config.auth.clientId,t,this.browserCrypto,this.logger),this.tokenCache=new Dee(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e){const t=new fS(e);return await t.initialize(),t}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}const e=this.config.system.allowNativeBroker,t=this.performanceClient.startMeasurement(le.InitializeClientApplication);if(this.eventHandler.emitEvent(ct.INITIALIZE_START),e)try{this.nativeExtensionProvider=await Wo.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(r){this.logger.verbose(r)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),await Fe(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),le.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient)(this.performanceClient)),this.initialized=!0,this.eventHandler.emitEvent(ct.INITIALIZE_END),t.end({allowNativeBroker:e,success:!0})}async handleRedirectPromise(e){this.logger.verbose("handleRedirectPromise called"),nz(this.initialized);const t=this.getAllAccounts();if(this.isBrowserEnvironment){const r=e||"";let i=this.redirectResponse.get(r);if(typeof i>"u"){const s=this.browserStorage.getCachedNativeRequest(),o=s&&Wo.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e,a=o?s==null?void 0:s.correlationId:this.browserStorage.getTemporaryCache(rn.CORRELATION_ID,!0)||"",l=this.performanceClient.startMeasurement("acquireTokenRedirect",a);this.eventHandler.emitEvent(ct.HANDLE_REDIRECT_START,rt.Redirect),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise");let c;if(o&&this.nativeExtensionProvider){this.logger.trace("handleRedirectPromise - acquiring token from native platform");const u=new Rf(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Tn.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,s.accountId,this.nativeInternalStorage,s.correlationId);c=Fe(u.handleRedirectPromise.bind(u),le.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,l.event.correlationId)(this.performanceClient,l.event.correlationId)}else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");const u=this.createRedirectClient(a);c=Fe(u.handleRedirectPromise.bind(u),le.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,l.event.correlationId)(e,this.performanceClient,l.event.correlationId)}i=c.then(u=>(u&&(t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(ct.LOGIN_SUCCESS,rt.Redirect,u),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_SUCCESS,rt.Redirect,u),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),l.end({success:!0})),this.eventHandler.emitEvent(ct.HANDLE_REDIRECT_END,rt.Redirect),l.end({success:!1}),u)).catch(u=>{const h=u;throw t.length>0?this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_FAILURE,rt.Redirect,null,h):this.eventHandler.emitEvent(ct.LOGIN_FAILURE,rt.Redirect,null,h),this.eventHandler.emitEvent(ct.HANDLE_REDIRECT_END,rt.Redirect),l.end({success:!1},h),u}),this.redirectResponse.set(r,i)}else this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call");return i}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t),qL(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0);const r=this.getAllAccounts().length>0;r?this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_START,rt.Redirect,e):this.eventHandler.emitEvent(ct.LOGIN_START,rt.Redirect,e);let i;return this.nativeExtensionProvider&&this.canUseNative(e)?i=new Rf(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Tn.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e).catch(o=>{if(o instanceof Pa&&Uh(o))return this.nativeExtensionProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(o instanceof yo)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),o}):i=this.createRedirectClient(t).acquireToken(e),i.catch(s=>{throw r?this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_FAILURE,rt.Redirect,null,s):this.eventHandler.emitEvent(ct.LOGIN_FAILURE,rt.Redirect,null,s),s})}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(le.AcquireTokenPopup,t);try{this.logger.verbose("acquireTokenPopup called",t),Dh(this.initialized),this.browserStorage.setInteractionInProgress(!0)}catch(o){return Promise.reject(o)}const i=this.getAllAccounts();i.length>0?this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_START,rt.Popup,e):this.eventHandler.emitEvent(ct.LOGIN_START,rt.Popup,e);let s;return this.canUseNative(e)?s=this.acquireTokenNative({...e,correlationId:t},Tn.acquireTokenPopup).then(o=>(this.browserStorage.setInteractionInProgress(!1),r.end({success:!0,isNativeBroker:!0,requestId:o.requestId}),o)).catch(o=>{if(o instanceof Pa&&Uh(o))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(o instanceof yo)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),o}):s=this.createPopupClient(t).acquireToken(e),s.then(o=>(i.length<this.getAllAccounts().length?this.eventHandler.emitEvent(ct.LOGIN_SUCCESS,rt.Popup,o):this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_SUCCESS,rt.Popup,o),r.add({accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length}),r.end({success:!0,requestId:o.requestId}),o)).catch(o=>(i.length>0?this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_FAILURE,rt.Popup,null,o):this.eventHandler.emitEvent(ct.LOGIN_FAILURE,rt.Popup,null,o),r.end({success:!1},o),Promise.reject(o)))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){var s;const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};Dh(this.initialized),this.ssoSilentMeasurement=this.performanceClient.startMeasurement(le.SsoSilent,t),(s=this.ssoSilentMeasurement)==null||s.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(ct.SSO_SILENT_START,rt.Silent,r);let i;return this.canUseNative(r)?i=this.acquireTokenNative(r,Tn.ssoSilent).catch(o=>{if(o instanceof Pa&&Uh(o))return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw o}):i=this.createSilentIframeClient(r.correlationId).acquireToken(r),i.then(o=>{var a,l;return this.eventHandler.emitEvent(ct.SSO_SILENT_SUCCESS,rt.Silent,o),(a=this.ssoSilentMeasurement)==null||a.add({accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length}),(l=this.ssoSilentMeasurement)==null||l.end({success:!0,isNativeBroker:o.fromNativeBroker,requestId:o.requestId}),o}).catch(o=>{var a;throw this.eventHandler.emitEvent(ct.SSO_SILENT_FAILURE,rt.Silent,null,o),(a=this.ssoSilentMeasurement)==null||a.end({success:!1},o),o}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t),Dh(this.initialized),this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_BY_CODE_START,rt.Silent,e);const r=this.performanceClient.startMeasurement(le.AcquireTokenByCode,t);try{if(e.code&&e.nativeAccountId)throw Ye(Bj);if(e.code){const i=e.code;let s=this.hybridAuthCodeResponses.get(i);return s?(this.logger.verbose("Existing acquireTokenByCode request found",t),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),s=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(o=>(this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_BY_CODE_SUCCESS,rt.Silent,o),this.hybridAuthCodeResponses.delete(i),r.add({accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length}),r.end({success:!0,isNativeBroker:o.fromNativeBroker,requestId:o.requestId}),o)).catch(o=>{throw this.hybridAuthCodeResponses.delete(i),this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_BY_CODE_FAILURE,rt.Silent,null,o),r.end({success:!1},o),o}),this.hybridAuthCodeResponses.set(i,s)),await s}else if(e.nativeAccountId){if(this.canUseNative(e,e.nativeAccountId))return await this.acquireTokenNative({...e,correlationId:t},Tn.acquireTokenByCode,e.nativeAccountId).catch(i=>{throw i instanceof Pa&&Uh(i)&&(this.nativeExtensionProvider=void 0),i});throw Ye(Hj)}else throw Ye(zj)}catch(i){throw this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_BY_CODE_FAILURE,rt.Silent,null,i),r.end({success:!1},i),i}}async acquireTokenByCodeAsync(e){var i;return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(le.AcquireTokenByCodeAsync,e.correlationId),(i=this.acquireTokenByCodeAsyncMeasurement)==null||i.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(s=>{var o;return(o=this.acquireTokenByCodeAsyncMeasurement)==null||o.end({success:!0,fromCache:s.fromCache,isNativeBroker:s.fromNativeBroker,requestId:s.requestId}),s}).catch(s=>{var o;throw(o=this.acquireTokenByCodeAsyncMeasurement)==null||o.end({success:!1},s),s}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(le.AcquireTokenFromCache,e.correlationId),t){case Cs.Default:case Cs.AccessToken:case Cs.AccessTokenAndRefreshToken:const r=this.createSilentCacheClient(e.correlationId);return Fe(r.acquireToken.bind(r),le.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw be(Jl)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(le.AcquireTokenByRefreshToken,e.correlationId),t){case Cs.Default:case Cs.AccessTokenAndRefreshToken:case Cs.RefreshToken:case Cs.RefreshTokenAndNetwork:const r=this.createSilentRefreshClient(e.correlationId);return Fe(r.acquireToken.bind(r),le.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw be(Jl)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(le.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return Fe(t.acquireToken.bind(t),le.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return qL(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return Dh(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(t){return Promise.reject(t)}}async clearCache(e){const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return this.logger.verbose("getAllAccounts called"),this.isBrowserEnvironment?this.browserStorage.getAllAccounts(e):[]}getAccount(e){if(this.logger.trace("getAccount called"),Object.keys(e).length===0)return this.logger.warning("getAccount: No accountFilter provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy(e);return t?(this.logger.verbose("getAccount: Account matching provided filter found, returning"),t):(this.logger.verbose("getAccount: No matching account found, returning null"),null)}getAccountByUsername(e){if(this.logger.trace("getAccountByUsername called"),!e)return this.logger.warning("getAccountByUsername: No username provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy({username:e});return t?(this.logger.verbose("getAccountByUsername: Account matching username found, returning"),this.logger.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${e}`),t):(this.logger.verbose("getAccountByUsername: No matching account found, returning null"),null)}getAccountByHomeId(e){if(this.logger.trace("getAccountByHomeId called"),!e)return this.logger.warning("getAccountByHomeId: No homeAccountId provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy({homeAccountId:e});return t?(this.logger.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),this.logger.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${e}`),t):(this.logger.verbose("getAccountByHomeId: No matching account found, returning null"),null)}getAccountByLocalId(e){if(this.logger.trace("getAccountByLocalId called"),!e)return this.logger.warning("getAccountByLocalId: No localAccountId provided"),null;const t=this.browserStorage.getAccountInfoFilteredBy({localAccountId:e});return t?(this.logger.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),this.logger.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${e}`),t):(this.logger.verbose("getAccountByLocalId: No matching account found, returning null"),null)}setActiveAccount(e){this.browserStorage.setActiveAccount(e)}getActiveAccount(){return this.browserStorage.getActiveAccount()}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const r=_r.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return this.browserStorage.setAccount(r),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw Ye(Pv);return new Rf(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!Wo.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case Rr.NONE:case Rr.CONSENT:case Rr.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Aee(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new Mee(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new Lee(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Tn.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new az(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new Oee(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new Fee(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Tn.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e){return this.eventHandler.addEventCallback(e)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){this.eventHandler.enableAccountStorageEvents()}disableAccountStorageEvents(){this.eventHandler.disableAccountStorageEvents()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getEventHandler(){return this.eventHandler}getRequestCorrelationId(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?el():de.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||KL})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||KL})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(le.AcquireTokenSilent,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy}),Dh(this.initialized),this.logger.verbose("acquireTokenSilent called",t);const i=e.account||this.getActiveAccount();if(!i)throw Ye(kj);const s={clientId:this.config.auth.clientId,authority:e.authority||de.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:i.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},o=JSON.stringify(s),a=this.activeSilentTokenRequests.get(o);if(typeof a>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t);const l=Fe(this.acquireTokenSilentAsync.bind(this),le.AcquireTokenSilentAsync,this.logger,this.performanceClient,t)({...e,correlationId:t},i).then(c=>(this.activeSilentTokenRequests.delete(o),r.add({accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length}),r.end({success:!0,fromCache:c.fromCache,isNativeBroker:c.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,requestId:c.requestId}),c)).catch(c=>{throw this.activeSilentTokenRequests.delete(o),r.end({success:!1},c),c});return this.activeSilentTokenRequests.set(o,l),{...await l,state:e.state}}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),r.discard(),{...await a,state:e.state}}async acquireTokenSilentAsync(e,t){this.performanceClient.addQueueMeasurement(le.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_START,rt.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",()=>this.trackPageVisibility(e.correlationId));let r;if(Wo.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&t.nativeAccountId){this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform");const i={...e,account:t};r=this.acquireTokenNative(i,Tn.acquireTokenSilent_silentFlow).catch(async s=>{if(s instanceof Pa&&Uh(s))return this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,this.createSilentIframeClient(e.correlationId).acquireToken(e);throw s})}else{this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow");const i=await Fe(gee,le.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),s=e.cacheLookupPolicy||Cs.Default;r=Fe(this.acquireTokenFromCache.bind(this),le.AcquireTokenFromCache,this.logger,this.performanceClient,i.correlationId)(i,s).catch(o=>{if(e.cacheLookupPolicy===Cs.AccessToken)throw o;return this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_NETWORK_START,rt.Silent,i),Fe(this.acquireTokenByRefreshToken.bind(this),le.AcquireTokenByRefreshToken,this.logger,this.performanceClient,i.correlationId)(i,s).catch(a=>{if(jee(a,i,s))return this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",i.correlationId),Fe(this.acquireTokenBySilentIframe.bind(this),le.AcquireTokenBySilentIframe,this.logger,this.performanceClient,i.correlationId)(i);throw a})})}return r.then(i=>(this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_SUCCESS,rt.Silent,i),e.correlationId&&this.performanceClient.addFields({fromCache:i.fromCache,isNativeBroker:i.fromNativeBroker,requestId:i.requestId},e.correlationId),i)).catch(i=>{throw this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_FAILURE,rt.Silent,null,i),i}).finally(()=>{document.removeEventListener("visibilitychange",()=>this.trackPageVisibility(e.correlationId))})}}function jee(n,e,t){const r=!(n instanceof yo&&n.subError!==cS),i=n.errorCode===so.INVALID_GRANT_ERROR||n.errorCode===Jl,s=r&&i||n.errorCode===Sy||n.errorCode===cR,o=NJ.includes(t);return s&&o}const zee=Object.freeze(Object.defineProperty({__proto__:null,StandardController:fS},Symbol.toStringTag,{value:"Module"}));/*! @azure/msal-browser v3.11.0 2024-03-22 */class bR{static async createPublicClientApplication(e){const t=await oee(e);return new bR(e,t)}constructor(e,t){if(t)this.controller=t;else{const r=new hd(e);this.controller=new fS(r)}}async initialize(){return this.controller.initialize()}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e){return this.controller.addEventCallback(e)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}const ET="APP_CONFIG";function AR(){return window.__APP_DEV_ENV&&(window.__APP_ENV=window.__APP_DEV_ENV),window.__APP_ENV.ENV__AZURE_CLIENT_ID!==void 0}async function Ed(n=!1){const e=new oi(ET);if(n){window||console.error("update storage can only be used on main tread"),window.__APP_DEV_ENV&&(window.__APP_ENV=window.__APP_DEV_ENV);const t=window.__APP_ENV||{};return await e.setKey(ET,t),t}return await e.getKey(ET)}let TT,Xi,um;async function MR(){return new Promise(async n=>{if(TT)n(Xi);else{const e=await Ed(!0);TT={auth:{clientId:e.ENV__AZURE_CLIENT_ID,authority:`${e.ENV__AZURE_LOGIN_URL}/${e.ENV__AZURE_TENANT_ID}/`,redirectUri:"/",postLogoutRedirectUri:"/"}},Xi=new bR(TT),await Xi.initialize(),Xi.addEventCallback(t=>{if(t.eventType===ct.LOGIN_SUCCESS&&t.payload){const i=t.payload.account;Xi.setActiveAccount(i),n(Xi)}return null}),Xi.handleRedirectPromise().then(()=>{Xi.getActiveAccount()||(XK?Xi.loginPopup():Xi.loginRedirect())}).catch(t=>{console.log(t)}),um=Xi.getAllAccounts(),(um==null?void 0:um.length)>0&&(Xi.setActiveAccount(um[0]),n(Xi))}})}const e2={scopes:["https://storage.azure.com/.default","openid","profile","offline_access"]};async function Td(){try{const e=await(await MR()).acquireTokenSilent({scopes:e2.scopes,forceRefresh:bF()}).then(function(t){return t});return e==null?void 0:e.accessToken}catch(n){console.error(n),Kn.setState({header:"login",message:n==null?void 0:n.errorMessage})}return""}async function Bee(n,e,t){const r=await Ed();return await fetch(`${r.ENV__AZURE_STORAGE_URL}/${e}/${t}`,{headers:{"cache-control":"no-cache",pragma:"no-cache","x-ms-version":"2021-04-10","x-ms-date":new Date().toUTCString(),authorization:`Bearer ${n}`}})}var as=Uint8Array,uf=Uint16Array,Hee=Int32Array,uz=new as([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),dz=new as([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Vee=new as([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hz=function(n,e){for(var t=new uf(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var i=new Hee(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return{b:t,r:i}},fz=hz(uz,2),pz=fz.b,Gee=fz.r;pz[28]=258,Gee[258]=28;var Wee=hz(dz,0),Yee=Wee.b,t2=new uf(32768);for(var An=0;An<32768;++An){var Sl=(An&43690)>>1|(An&21845)<<1;Sl=(Sl&52428)>>2|(Sl&13107)<<2,Sl=(Sl&61680)>>4|(Sl&3855)<<4,t2[An]=((Sl&65280)>>8|(Sl&255)<<8)>>1}var yg=function(n,e,t){for(var r=n.length,i=0,s=new uf(e);i<r;++i)n[i]&&++s[n[i]-1];var o=new uf(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(t){a=new uf(1<<e);var l=15-e;for(i=0;i<r;++i)if(n[i])for(var c=i<<4|n[i],u=e-n[i],h=o[n[i]-1]++<<u,f=h|(1<<u)-1;h<=f;++h)a[t2[h]>>l]=c}else for(a=new uf(r),i=0;i<r;++i)n[i]&&(a[i]=t2[o[n[i]-1]++]>>15-n[i]);return a},Lv=new as(288);for(var An=0;An<144;++An)Lv[An]=8;for(var An=144;An<256;++An)Lv[An]=9;for(var An=256;An<280;++An)Lv[An]=7;for(var An=280;An<288;++An)Lv[An]=8;var mz=new as(32);for(var An=0;An<32;++An)mz[An]=5;var Kee=yg(Lv,9,1),$ee=yg(mz,5,1),CT=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},qs=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},bT=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},Xee=function(n){return(n+7)/8|0},RR=function(n,e,t){return(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length),new as(n.subarray(e,t))},qee=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ms=function(n,e,t){var r=new Error(e||qee[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,Ms),!t)throw r;return r},Zee=function(n,e,t,r){var i=n.length,s=r?r.length:0;if(!i||e.f&&!e.l)return t||new as(0);var o=!t,a=o||e.i!=2,l=e.i;o&&(t=new as(i*3));var c=function(ve){var Y=t.length;if(ve>Y){var Ne=new as(Math.max(Y*2,ve));Ne.set(t),t=Ne}},u=e.f||0,h=e.p||0,f=e.b||0,p=e.l,_=e.d,y=e.m,g=e.n,m=i*8;do{if(!p){u=qs(n,h,1);var v=qs(n,h+1,3);if(h+=3,v)if(v==1)p=Kee,_=$ee,y=9,g=5;else if(v==2){var S=qs(n,h,31)+257,C=qs(n,h+10,15)+4,A=S+qs(n,h+5,31)+1;h+=14;for(var k=new as(A),T=new as(19),R=0;R<C;++R)T[Vee[R]]=qs(n,h+R*3,7);h+=C*3;for(var $=CT(T),P=(1<<$)-1,M=yg(T,$,1),R=0;R<A;){var I=M[qs(n,h,P)];h+=I&15;var x=I>>4;if(x<16)k[R++]=x;else{var j=0,O=0;for(x==16?(O=3+qs(n,h,3),h+=2,j=k[R-1]):x==17?(O=3+qs(n,h,7),h+=3):x==18&&(O=11+qs(n,h,127),h+=7);O--;)k[R++]=j}}var z=k.subarray(0,S),B=k.subarray(S);y=CT(z),g=CT(B),p=yg(z,y,1),_=yg(B,g,1)}else Ms(1);else{var x=Xee(h)+4,w=n[x-4]|n[x-3]<<8,E=x+w;if(E>i){l&&Ms(0);break}a&&c(f+w),t.set(n.subarray(x,E),f),e.b=f+=w,e.p=h=E*8,e.f=u;continue}if(h>m){l&&Ms(0);break}}a&&c(f+131072);for(var L=(1<<y)-1,D=(1<<g)-1,W=h;;W=h){var j=p[bT(n,h)&L],H=j>>4;if(h+=j&15,h>m){l&&Ms(0);break}if(j||Ms(2),H<256)t[f++]=H;else if(H==256){W=h,p=null;break}else{var K=H-254;if(H>264){var R=H-257,oe=uz[R];K=qs(n,h,(1<<oe)-1)+pz[R],h+=oe}var me=_[bT(n,h)&D],Se=me>>4;me||Ms(3),h+=me&15;var B=Yee[Se];if(Se>3){var oe=dz[Se];B+=bT(n,h)&(1<<oe)-1,h+=oe}if(h>m){l&&Ms(0);break}a&&c(f+131072);var Te=f+K;if(f<B){var G=s-B,he=Math.min(B,Te);for(G+f<0&&Ms(3);f<he;++f)t[f]=r[G+f]}for(;f<Te;++f)t[f]=t[f-B]}}e.l=p,e.p=W,e.b=f,e.f=u,p&&(u=1,e.m=y,e.d=_,e.n=g)}while(!u);return f!=t.length&&o?RR(t,0,f):t.subarray(0,f)},Qee=new as(0),Vo=function(n,e){return n[e]|n[e+1]<<8},oo=function(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0},AT=function(n,e){return oo(n,e)+oo(n,e+4)*4294967296};function Jee(n,e){return Zee(n,{i:2},e&&e.out,e&&e.dictionary)}var n2=typeof TextDecoder<"u"&&new TextDecoder,ete=0;try{n2.decode(Qee,{stream:!0}),ete=1}catch{}var tte=function(n){for(var e="",t=0;;){var r=n[t++],i=(r>127)+(r>223)+(r>239);if(t+i>n.length)return{s:e,r:RR(n,t-1)};i?i==3?(r=((r&15)<<18|(n[t++]&63)<<12|(n[t++]&63)<<6|n[t++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?e+=String.fromCharCode((r&31)<<6|n[t++]&63):e+=String.fromCharCode((r&15)<<12|(n[t++]&63)<<6|n[t++]&63):e+=String.fromCharCode(r)}};function gz(n,e){if(e){for(var t="",r=0;r<n.length;r+=16384)t+=String.fromCharCode.apply(null,n.subarray(r,r+16384));return t}else{if(n2)return n2.decode(n);var i=tte(n),s=i.s,t=i.r;return t.length&&Ms(8),s}}var nte=function(n,e){return e+30+Vo(n,e+26)+Vo(n,e+28)},rte=function(n,e,t){var r=Vo(n,e+28),i=gz(n.subarray(e+46,e+46+r),!(Vo(n,e+8)&2048)),s=e+46+r,o=oo(n,e+20),a=t&&o==4294967295?ite(n,s):[o,oo(n,e+24),oo(n,e+42)],l=a[0],c=a[1],u=a[2];return[Vo(n,e+10),l,c,i,s+Vo(n,e+30)+Vo(n,e+32),u]},ite=function(n,e){for(;Vo(n,e)!=1;e+=4+Vo(n,e+2));return[AT(n,e+12),AT(n,e+4),AT(n,e+20)]};function ste(n,e){for(var t={},r=n.length-22;oo(n,r)!=101010256;--r)(!r||n.length-r>65558)&&Ms(13);var i=Vo(n,r+8);if(!i)return{};var s=oo(n,r+16),o=s==4294967295||i==65535;if(o){var a=oo(n,r-12);o=oo(n,a)==101075792,o&&(i=oo(n,a+32),s=oo(n,a+48))}for(var l=e&&e.filter,c=0;c<i;++c){var u=rte(n,s,o),h=u[0],f=u[1],p=u[2],_=u[3],y=u[4],g=u[5],m=nte(n,g);s=y,(!l||l({name:_,size:f,originalSize:p,compression:h}))&&(h?h==8?t[_]=Jee(n.subarray(m,m+f),{out:new as(p)}):Ms(14,"unknown compression type "+h):t[_]=RR(n,m,m+f))}return t}async function ote(n){const e=new FileReader;return new Promise((t,r)=>{e.onloadend=i=>{var s;i.target?t((s=i.target)==null?void 0:s.result):t(null)},e.onerror=r,e.readAsArrayBuffer(n)})}async function ate(n){const e=new FileReader;return new Promise((t,r)=>{e.onloadend=i=>{i.target?t(i.target.result):t(null)},e.onerror=r,e.readAsText(n)})}async function lte(n,e){if(e){const t=await ote(n);if(t instanceof ArrayBuffer){const r=ste(new Uint8Array(t)),i=Object.keys(r)[0];if(i){const s=gz(r[i]);if(s&&typeof s=="string")return JSON.parse(s)}}return null}else{const t=await ate(n);return t&&typeof t=="string"?JSON.parse(t):null}}async function pS(n,e,t,r=!1){const i=await Bee(n,e,t);if(i.ok)return lte(await i.blob(),t.includes(".zip"));throw r||(console.warn("error"),console.warn(t)),i.statusText}async function NR(n,e,t,r,i){const s=new oi("ALL_PROJECTS"),o=await pS(await Td(),n,e,!0).catch(()=>{console.log(`No access to ${e} in container ${n} `)});if(o!=null&&o.model_data){if(o.project_code=r,o.project_name=i,o.project_key=t,o.container=n,o.model_layer||(o.model_layer=[{name:"ALL_SITES",description:"All sites",groups:[]}]),o.model_layer.sort((a,l)=>{const c=a.description+a.description,u=l.description+l.description;return c<u?-1:c>u?1:0}),ZU&&location.origin.includes("localhost")){const a={dialogHeader:"localhost:2080 /tool-ext-detail/",tabButtonName:"localhost:2080 /tool-ext-detail/",right:0,width:600,height:500,bottom:170,url:"http://localhost:2080/tool-ext-detail/",urlProd:"http://localhost:2080/tool-ext-detail/",urlTest:"http://localhost:2080/tool-ext-detail/",urlBeta:"http://localhost:2080/tool-ext-detail/",allowExternal:!0},l={dialogHeader:"localhost:2080 /tool-ext-reports/",tabButtonName:"localhost:2080 /tool-ext-reports/",right:0,width:600,height:500,bottom:170,url:"http://localhost:2080/tool-ext-reports/",urlProd:"http://localhost:2080/tool-ext-reports/",urlTest:"http://localhost:2080/tool-ext-reports/",urlBeta:"http://localhost:2080/tool-ext-reports/",allowExternal:!0},c={dialogHeader:"localhost:2080 /tool-ext-dolwin-cable/",tabButtonName:"localhost:2080 /tool-ext-dolwin-cable/",right:0,width:600,height:500,bottom:170,url:"http://localhost:2080/tool-ext-dolwin-cable/",urlProd:"http://localhost:2080/tool-ext-dolwin-cable/",urlTest:"http://localhost:2080/tool-ext-dolwin-cable/",urlBeta:"http://localhost:2080/tool-ext-dolwin-cable/",allowExternal:!0};o.tools?(o.tools.dev1=a,o.tools.dev2=l,o.tools.dev4=c):o.tools={dev1:a,dev2:l,dev3:c}}return await s.setKey("PROJECT"+n+e,o),o}else return null}var Pi=void 0,Oi=null,IR="",mS="function",Ov="object",Ba="prototype",r2="__proto__",Pu="undefined",i2="constructor",PR="Symbol",cte="_polyfill",Nf="length",by="name",Br="call",kR="toString",To=Object,LR=To[Ba],vz=String,Cd=vz[Ba],ute=Math,_z=Array,gS=_z[Ba],tl=gS.slice;function Gi(n,e){try{return{v:n.apply(this,e)}}catch(t){return{e:t}}}function dte(n,e){var t=Gi(n);return t.e?e:t.v}var MT;function vS(n){return function(e){return typeof e===n}}function xz(n){var e="[object "+n+"]";return function(t){return!!(t&&hte(t)===e)}}function hte(n){return LR.toString.call(n)}function bn(n){return typeof n===Pu||n===Pu}function Ae(n){return n===Oi||bn(n)}function fte(n){return n===Oi||!yz(n)}function yz(n){return!!n||n!==Pi}function pte(n){return!MT&&(MT=["string","number","boolean",Pu,"symbol","bigint"]),n!==Ov&&MT.indexOf(n)!==-1}var ht=vS("string"),mt=vS(mS);function Wi(n){return!n&&Ae(n)?!1:!!n&&typeof n===Ov}var Dt=_z.isArray,mte=xz("Date"),_S=vS("number"),wz=vS("boolean"),OR=xz("Error");function Ay(n){return!!(n&&n.then&&mt(n.then))}function My(n){return!(!n||dte(function(){return!(n&&0+n)},!n))}var DR=To.getOwnPropertyDescriptor;function Vs(n,e){return!!n&&LR.hasOwnProperty[Br](n,e)}var gc=To.hasOwn||gte;function gte(n,e){return Vs(n,e)||!!DR(n,e)}function Pt(n,e,t){if(n&&Wi(n)){for(var r in n)if(gc(n,r)&&e[Br](t||n,r,n[r])===-1)break}}function Sz(n,e,t,r){var i={};return Pt(n,function(s,o){i[s]=e?o:s,i[o]=t?o:s}),r(i)}function rs(n){throw new Error(n)}function la(n){throw new TypeError(n)}var s2=To.freeze;function vte(n){return n}function _te(n){return n[r2]||Oi}var o2=To.assign,Ha=To.keys;function Oc(n){return s2&&Pt(n,function(e,t){(Dt(t)||Wi(t))&&s2(t)}),pp(n)}var pp=s2||vte,a2=To.getPrototypeOf||_te;function xte(n){return Sz(n,1,0,Oc)}function yte(n){return Sz(n,0,0,Oc)}function wte(n){var e={};return Pt(n,function(t,r){e[t]=r[1],e[r[0]]=r[1]}),Oc(e)}function Ste(n){return wte(n)}var Ez=yte({asyncIterator:0,hasInstance:1,isConcatSpreadable:2,iterator:3,match:4,matchAll:5,replace:6,search:7,species:8,split:9,toPrimitive:10,toStringTag:11,unscopables:12}),Di=vz,tO="__tsUtils$gblCfg",RT;function Tz(){var n;return typeof globalThis!==Pu&&(n=globalThis),!n&&typeof self!==Pu&&(n=self),!n&&typeof window!==Pu&&(n=window),!n&&typeof global!==Pu&&(n=global),n}function Cz(){if(!RT){var n=Gi(Tz).v||{};RT=n[tO]=n[tO]||{}}return RT}var Ete="[object Error]";function Ke(n,e){var t=IR,r=LR[kR][Br](n);r===Ete&&(n={stack:Di(n.stack),message:Di(n.message),name:Di(n.name)});try{t=JSON.stringify(n,Oi,e?typeof e=="number"?e:4:Pi),t=t&&t.replace(/"(\w+)"\s*:\s{0,1}/g,"$1: ")||Di(n)}catch(i){t=" - "+Ke(i,e)}return r+": "+t}var bd=xS;function xS(n,e,t){var r=e&&e[n];return function(i){var s=i&&i[n]||r;if(s||t){var o=arguments;return(s||t).apply(i,s?tl[Br](o,1):o)}la('"'+Di(n)+'" not defined for '+Ke(i))}}function Tte(n){return function(e){return e[n]}}var Cte=ute.max,nO=bd("slice",Cd),Co=bd("substring",Cd),Bl=xS("substr",Cd,bte);function bte(n,e,t){return Ae(n)&&la("'polyStrSubstr called with invalid "+Ke(n)),t<0?IR:(e=e||0,e<0&&(e=Cte(e+n[Nf],0)),bn(t)?nO(n,e):nO(n,e,e+t))}function UR(n,e){return Co(n,0,e)}var rO="_urid",NT;function Ate(){if(!NT){var n=Cz();NT=n.gblSym=n.gblSym||{k:{},s:{}}}return NT}var J0;function FR(n){var e={description:Di(n),toString:function(){return PR+"("+n+")"}};return e[cte]=!0,e}function Mte(n){var e=Ate();if(!gc(e.k,n)){var t=FR(n),r=Ha(e.s).length;t[rO]=function(){return r+"_"+t[kR]()},e.k[n]=t,e.s[t[rO]()]=Di(n)}return e.k[n]}function Rte(n){!J0&&(J0={});var e,t=Ez[n];return t&&(e=J0[t]=J0[t]||FR(PR+"."+t)),e}var e_={e:"enumerable",c:"configurable",v:"value",w:"writable",g:"get",s:"set"};function Nte(n){var e={};if(e[e_.c]=!0,e[e_.e]=!0,n.l){e.get=function(){return n.l.v};var t=DR(n.l,"v");t&&t.set&&(e.set=function(r){n.l.v=r})}return Pt(n,function(r,i){e[e_[r]]=bn(i)?e[e_[r]]:i}),e}var bc=To.defineProperty;function Gt(n,e,t){return bc(n,e,Nte(t))}var vr;function Dc(){vr=Cz()}function Dv(n){var e={};return!vr&&Dc(),e.b=vr.lzy,bc(e,"v",{configurable:!0,get:function(){var t=n();return vr.lzy||bc(e,"v",{value:t}),e.b=vr.lzy,t}}),e}function bz(n,e){return Dv(function(){var t=Gi(n);return t.e?e:t.v})}function jR(n){return bc({toJSON:function(){return n}},"v",{value:n})}var Az="window",wg;function Dp(n,e){var t;return function(){return!vr&&Dc(),(!t||vr.lzy)&&(t=jR(Gi(n,e).v)),t.v}}function yS(n){return Dv(function(){return Gi(cr,[n]).v||Pi})}function js(n){return!vr&&Dc(),(!wg||n===!1||vr.lzy)&&(wg=jR(Gi(Tz).v||Oi)),wg.v}function cr(n,e){var t=!wg||e===!1?js(e):wg.v;return t&&t[n]?t[n]:n===Az?Vi():Oi}function Mz(){return!!ii()}var ii=Dp(cr,["document"]);function wS(){return!!Vi()}var Vi=Dp(cr,[Az]);function Ite(){return!!ca()}var ca=Dp(cr,["navigator"]);function Pte(){return!!Rz()}var Rz=Dp(cr,["history"]),kte=Dp(function(){return!!Gi(function(){return process&&(process.versions||{}).node}).v}),Nz=Dp(function(){return!!Gi(function(){return self&&self instanceof WorkerGlobalScope}).v}),ki,l2;function SS(){(!ki||!ki.b)&&(ki=yS(PR),l2=bz(function(){return ki.v?ki.v.for:Pi},Pi))}function Lte(){return!!Ote()}function Ote(){return!vr&&Dc(),(!ki||vr.lzy)&&SS(),ki.v}function zR(n,e){var t=Ez[n];return!vr&&Dc(),(!ki||vr.lzy)&&SS(),ki.v?ki.v[t||n]:e?Pi:Rte(n)}function dm(n,e){return!vr&&Dc(),(!ki||vr.lzy)&&SS(),ki.v?ki.v(n):e?Oi:FR(n)}function BR(n){return!vr&&Dc(),(!l2||!ki||vr.lzy)&&SS(),(l2.v||Mte)(n)}function c2(n){return!!n&&mt(n.next)}function Dte(n){return!fte(n)&&mt(n[zR(3)])}var t_;function Ute(n,e,t){if(n&&(c2(n)||(!t_&&(t_=jR(zR(3))),n=n[t_.v]?n[t_.v]():null),c2(n))){var r=void 0,i=void 0;try{for(var s=0;!(i=n.next()).done&&e[Br](t||n,i.value,s,n)!==-1;)s++}catch(o){r={e:o},n.throw&&(i=null,n.throw(r))}finally{try{i&&!i.done&&n.return&&n.return(i)}finally{if(r)throw r.e}}}}function df(n,e,t){return n.apply(e,t)}function hf(n,e){return!bn(e)&&n&&(Dt(e)?df(n.push,n,e):c2(e)||Dte(e)?Ute(e,function(t){n.push(t)}):n.push(e)),n}function Ze(n,e,t){if(n)for(var r=n[Nf]>>>0,i=0;i<r&&!(i in n&&e[Br](t||n,n[i],i,n)===-1);i++);}var ci=bd("indexOf",gS),Sg=bd("map",gS);function HR(n,e,t){return(n&&n.slice||tl).apply(n,tl[Br](arguments,1))}var Fte=bd("reduce",gS),Ac=To.create||jte;function jte(n){if(!n)return{};var e=typeof n;e!==Ov&&e!==mS&&la("Prototype must be an Object or function: "+Ke(n));function t(){}return t[Ba]=n,new t}var IT;function Iz(n,e){var t=To.setPrototypeOf||function(r,i){!IT&&(IT=Dv(function(){var s;return s={},s[r2]=[],s instanceof Array})),IT.v?r[r2]=i:Pt(i,function(s,o){return r[s]=o})};return t(n,e)}function zte(n,e,t){Gi(Gt,[e,by,{v:n,c:!0,e:!1}]),e=Iz(e,t);function r(){this.constructor=e,Gi(Gt,[this,by,{v:n,c:!0,e:!1}])}return e[Ba]=t===Oi?Ac(t):(r[Ba]=t[Ba],new r),e}function iO(n,e){e&&(n[by]=e)}function Pz(n,e,t){var r=t||Error,i=r[Ba][by],s=Error.captureStackTrace;return zte(n,function(){var o=this,a=arguments;try{Gi(iO,[r,n]);var l=df(r,o,tl[Br](a))||o;if(l!==o){var c=a2(o);c!==a2(l)&&Iz(l,c)}return s&&s(l,o[i2]),e&&e(l,a),l}finally{Gi(iO,[r,i])}},r)}var PT;function Bte(n){throw PT||(PT=Pz("UnsupportedError")),new PT(n)}function sa(){return(Date.now||Hte)()}function Hte(){return new Date().getTime()}function Vte(n){return function(t){return Ae(t)&&la("strTrim called ["+Ke(t)+"]"),t&&t.replace&&(t=t.replace(n,IR)),t}}var Gte=Vte(/^\s+|(?=\s)\s+$/g),or=xS("trim",Cd,Gte),kT,LT,OT;function Ui(n){if(!n||typeof n!==Ov)return!1;OT||(OT=wS()?Vi():!0);var e=!1;if(n!==OT){LT||(kT=Function[Ba][kR],LT=kT[Br](To));try{var t=a2(n);e=!t,e||(Vs(t,i2)&&(t=t[i2]),e=t&&typeof t===mS&&kT[Br](t)===LT)}catch{}}return e}function Wte(n){return n.value&&Lz(n),!0}var sO=[Xte,Lz,Zte,qte];function Yte(n,e,t,r){var i;return Ze(n,function(s){if(s.k===e)return i=s,-1}),i||(i={k:e,v:e},n.push(i),r(i)),i.v}function VR(n,e,t,r){var i=t.handler,s=t.path?r?t.path.concat(r):t.path:[],o={handler:t.handler,src:t.src,path:s},a=typeof e,l=!1,c=!1;e&&a===Ov?l=Ui(e):c=e===Oi||pte(a);var u={type:a,isPrim:c,isPlain:l,value:e,result:e,path:s,origin:t.src,copy:function(h,f){return VR(n,h,f?o:t,f)},copyTo:function(h,f){return kz(n,h,f,o)}};return u.isPrim?i&&i[Br](t,u)?u.result:e:Yte(n,e,s,function(h){Gt(u,"result",{g:function(){return h.v},s:function(_){h.v=_}});for(var f=0,p=i;!(p||(f<sO.length?sO[f++]:Wte))[Br](t,u);)p=Oi})}function kz(n,e,t,r){if(!Ae(t))for(var i in t)e[i]=VR(n,t[i],r,i);return e}function Kte(n,e,t){var r={handler:t,src:e,path:[]};return kz([],n,e,r)}function $te(n,e){var t={handler:e,src:n};return VR([],n,t)}function Xte(n){var e=n.value;if(Dt(e)){var t=n.result=[];return t.length=e.length,n.copyTo(t,e),!0}return!1}function qte(n){var e=n.value;return mte(e)?(n.result=new Date(e.getTime()),!0):!1}function Zte(n){return n.type===mS}function Lz(n){var e=n.value;if(e&&n.isPlain){var t=n.result={};return n.copyTo(t,e),!0}return!1}function Oz(n,e){return Ze(e,function(t){Kte(n,t)}),n}function oO(n,e,t,r,i,s,o){return Oz($te(n)||{},tl[Br](arguments))}function Qte(n,e,t,r,i,s,o){return Oz(n||{},tl[Br](arguments))}var Jte=Tte(Nf),n_;function nl(){return!vr&&Dc(),(!n_||!n_.b&&vr.lzy)&&(n_=yS("performance")),n_.v}var Dz=bd("split",Cd);function Uz(n,e,t){if(n&&e){var r=Dz(e,"."),i=r.pop();Ze(r,function(s){Ae(n[s])&&(n[s]={}),n=n[s]}),n[i]=t}}var Fz=xS("endsWith",Cd,ene);function ene(n,e,t){ht(n)||la("'"+Ke(n)+"' is not a string");var r=ht(e)?e:Di(e),i=!bn(t)&&t<n[Nf]?t:n[Nf];return Co(n,i-r[Nf],i)===r}var Fi=bd("indexOf",Cd),DT="ref",UT="unref",FT="hasRef",tne="enabled";function nne(n,e,t){var r=!0,i=n?e(Oi):Oi,s;function o(){return r=!1,i&&i[UT]&&i[UT](),s}function a(){i&&t(i),i=Oi}function l(){return i=e(i),r||o(),s}function c(u){!u&&i&&a(),u&&!i&&l()}return s={cancel:a,refresh:l},s[FT]=function(){return i&&i[FT]?i[FT]():r},s[DT]=function(){return r=!0,i&&i[DT]&&i[DT](),s},s[UT]=o,s=bc(s,tne,{get:function(){return!!i},set:c}),{h:s,dn:function(){i=Oi}}}function jz(n,e,t){var r=Dt(e),i=r?e.length:0,s=(i>0?e[0]:r?Pi:e)||setTimeout,o=(i>1?e[1]:Pi)||clearTimeout,a=t[0];t[0]=function(){l.dn(),df(a,Pi,tl[Br](arguments))};var l=nne(n,function(c){if(c){if(c.refresh)return c.refresh(),c;df(o,Pi,[c])}return df(s,Pi,t)},function(c){df(o,Pi,[c])});return l.h}function bo(n,e){return jz(!0,Pi,tl[Br](arguments))}function rne(n,e){return jz(!1,Pi,tl[Br](arguments))}var r_,Ry="constructor",rl="prototype",Ny="function",Iy="_dynInstFuncs",u2="_isDynProxy",If="_dynClass",ine="_dynCls$",d2="_dynInstChk",iv=d2,zz="_dfOpts",aO="_unknown_",GR="__proto__",i_="_dyn"+GR,lO="__dynProto$Gbl",jT="_dynInstProto",ix="useBaseInst",h2="setInstFuncs",WR=Object,sv=WR.getPrototypeOf,cO=WR.getOwnPropertyNames,uO=js(),f2=uO[lO]||(uO[lO]={o:(r_={},r_[h2]=!0,r_[ix]=!0,r_),n:1e3});function sx(n){return n&&(n===WR[rl]||n===Array[rl])}function YR(n){return sx(n)||n===Function[rl]}function fd(n){var e;if(n){if(sv)return sv(n);var t=n[GR]||n[rl]||(n[Ry]?n[Ry][rl]:null);e=n[i_]||t,Vs(n,i_)||(delete n[jT],e=n[i_]=n[jT]||n[i_],n[jT]=t)}return e}function Py(n,e){var t=[];if(cO)t=cO(n);else for(var r in n)typeof r=="string"&&Vs(n,r)&&t.push(r);if(t&&t.length>0)for(var i=0;i<t.length;i++)e(t[i])}function KR(n,e,t){return e!==Ry&&typeof n[e]===Ny&&(t||Vs(n,e))&&e!==GR&&e!==rl}function ky(n){la("DynamicProto: "+n)}function sne(n){var e=Ac(null);return Py(n,function(t){!e[t]&&KR(n,t,!1)&&(e[t]=n[t])}),e}function $R(n,e){for(var t=n.length-1;t>=0;t--)if(n[t]===e)return!0;return!1}function one(n,e,t,r){function i(l,c,u){var h=c[u];if(h[u2]&&r){var f=l[Iy]||{};f[iv]!==!1&&(h=(f[c[If]]||{})[u]||h)}return function(){return h.apply(l,arguments)}}var s=Ac(null);Py(t,function(l){s[l]=i(e,t,l)});for(var o=fd(n),a=[];o&&!YR(o)&&!$R(a,o);)Py(o,function(l){!s[l]&&KR(o,l,!sv)&&(s[l]=i(e,o,l))}),a.push(o),o=fd(o);return s}function ane(n,e,t,r){var i=null;if(n&&Vs(t,If)){var s=n[Iy]||Ac(null);if(i=(s[t[If]]||Ac(null))[e],i||ky("Missing ["+e+"] "+Ny),!i[d2]&&s[iv]!==!1){for(var o=!Vs(n,e),a=fd(n),l=[];o&&a&&!YR(a)&&!$R(l,a);){var c=a[e];if(c){o=c===r;break}l.push(a),a=fd(a)}try{o&&(n[e]=i),i[d2]=1}catch{s[iv]=!1}}}return i}function lne(n,e,t){var r=e[n];return r===t&&(r=fd(e)[n]),typeof r!==Ny&&ky("["+n+"] is not a "+Ny),r}function cne(n,e,t,r,i){function s(l,c){var u=function(){var h=ane(this,c,l,u)||lne(c,l,u);return h.apply(this,arguments)};return u[u2]=1,u}if(!sx(n)){var o=t[Iy]=t[Iy]||Ac(null);if(!sx(o)){var a=o[e]=o[e]||Ac(null);o[iv]!==!1&&(o[iv]=!!i),sx(a)||Py(t,function(l){KR(t,l,!1)&&t[l]!==r[l]&&(a[l]=t[l],delete t[l],(!Vs(n,l)||n[l]&&!n[l][u2])&&(n[l]=s(n,l)))})}}}function une(n,e){if(sv){for(var t=[],r=fd(e);r&&!YR(r)&&!$R(t,r);){if(r===n)return!0;t.push(r),r=fd(r)}return!1}return!0}function zT(n,e){return Vs(n,rl)?n.name||e||aO:((n||{})[Ry]||{}).name||e||aO}function yn(n,e,t,r){Vs(n,rl)||ky("theClass is an invalid class definition.");var i=n[rl];une(i,e)||ky("["+zT(n)+"] not in hierarchy of ["+zT(e)+"]");var s=null;Vs(i,If)?s=i[If]:(s=ine+zT(n,"_")+"$"+f2.n,f2.n++,i[If]=s);var o=yn[zz],a=!!o[ix];a&&r&&r[ix]!==void 0&&(a=!!r[ix]);var l=sne(e),c=one(i,e,l,a);t(e,c);var u=!!sv&&!!o[h2];u&&r&&(u=!!r[h2]),cne(i,s,e,l,u!==!1)}yn[zz]=f2.o;var Bz="function",Hz="object",XR="undefined",Qo="prototype",qR=Object,dne=qR[Qo];(js()||{}).Symbol;(js()||{}).Reflect;var Vz="hasOwnProperty",hne=function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)dne[Vz].call(e,i)&&(n[i]=e[i])}return n},yi=o2||hne,p2=function(n,e){return p2=qR.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r[Vz](i)&&(t[i]=r[i])},p2(n,e)};function ul(n,e){typeof e!==Bz&&e!==null&&la("Class extends value "+String(e)+" is not a constructor or null"),p2(n,e);function t(){this.constructor=n}n[Qo]=e===null?Ac(e):(t[Qo]=e[Qo],new t)}function dO(n,e){for(var t=0,r=e.length,i=n.length;t<r;t++,i++)n[i]=e[t];return n}var fne=xte,pne=Ste,mp="toLowerCase",Ly="blkVal",_t="length",Oy="rdOnly",Dy="notify",Uy="warnToConsole",Uv="throwInternal",Up="setDf",vc="watch",qn="logger",pd="apply",en="push",Fp="splice",Gz="hdlr",ff="cancel",Fv="initialize",Hl="identifier",Fy="removeNotificationListener",jy="addNotificationListener",Yo="isInitialized",s_="getNotifyMgr",ov="getPlugin",hO="pollInternalLogs",Va="name",Pf="time",vi="processNext",Wz="getProcessTelContext",pf="enabled",fO="stopPollingInternalLogs",Mc="unload",o_="onComplete",zy="version",Yz="loggingLevelConsole",md="createNew",Aa="teardown",By="messageId",Bu="message",gp="isAsync",Ga="diagLog",Hy="_doTeardown",av="update",Jo="getNext",lv="setNextPlugin",Kz="protocol",m2="userAgent",vp="split",BT="nodeType",Hu="replace",$z="logInternalMessage",Wa="type",ZR="handler",Wm="status",pO="getResponseHeader",mO="getAllResponseHeaders",g2="isChildEvt",Fh="data",kf="getCtx",Oo="setCtx",v2="complete",gO="itemsReceived",hm="urlString",vO="sendPOST",HT="headers",uh="timeout",_O="setRequestHeader",_2="traceId",x2="spanId",y2="traceFlags",VT;function mne(n,e){VT||(VT=Pz("AggregationError",function(r,i){i[_t]>1&&(r.errors=i[1])}));var t=n||"One or more errors occurred.";throw Ze(e,function(r,i){t+=`
`.concat(i," > ").concat(Ke(r))}),new VT(t,e||[])}function _p(n,e){return Xz(n,function(t){return e?e({value:t,rejected:!1}):t},function(t){return e?e({rejected:!0,reason:t}):t})}function Xz(n,e,t,r){var i=n;return Ay(n)?(e||t)&&(i=n.then(e,t)):e&&(i=e(n)),r&&gne(i,r),i}function gne(n,e){var t=n;return e&&(Ay(n)?n.finally?t=n.finally(e):t=n.then(function(r){return e(),r},function(r){throw e(),r}):e()),t}var qz=["pending","resolving","resolved","rejected"],xO="dispatchEvent",a_;function vne(n,e,t,r){var i=ii();!a_&&(a_=bz(function(){var l;return i&&i.createEvent&&(l=i.createEvent("Event")),!!l&&l.initEvent},null));var s=a_.v?i.createEvent("Event"):r?new Event(e):{};if(t&&t(s),a_.v&&s.initEvent(e,!1,!0),s&&n[xO])n[xO](s);else{var o=n["on"+e];if(o)o(s);else{var a=cr("console");a&&(a.error||a.log)(e,Ke(s))}}}var Vy="Promise",Zz="unhandledRejection",_ne=Zz.toLowerCase(),yO=[],xne=0,yne=10,GT;function wO(n){return mt(n)?n.toString():Ke(n)}function wne(n,e,t){var r=HR(arguments,3),i=0,s=!1,o,a=[],l=xne++,c=!1,u=null,h;!GT&&(GT=yS(Vy+"RejectionEvent"));var f=function(w,E){try{yO.push(l),c=!0,u&&u.cancel(),u=null;var S=n(function(C,A){a.push(function(){try{var k=i===2?w:E,T=bn(k)?o:mt(k)?k(o):k;Ay(T)?T.then(C,A):k?C(T):i===3?A(T):C(T)}catch(R){A(R)}}),s&&g()},r);return S}finally{yO.pop()}},p=function(w){return f(void 0,w)},_=function(w){var E=w,S=w;return mt(w)&&(E=function(C){return w&&w(),C},S=function(C){throw w&&w(),C}),f(E,S)},y=function(){return qz[i]},g=function(){if(a.length>0){var w=a.slice();a=[],c=!0,e(w),u&&u.cancel(),u=null}},m=function(w,E){return function(S){if(i===E){if(w===2&&Ay(S)){i=1,S.then(m(2,1),m(3,1));return}i=w,s=!0,o=S,g(),!c&&w===3&&!u&&(u=bo(v,yne))}}},v=function(){if(!c)if(kte())process.emit(Zz,o,h);else{var w=Vi()||js();vne(w,_ne,function(E){return Gt(E,"promise",{g:function(){return h}}),E.reason=o,E},!!GT.v)}};h={then:f,catch:p,finally:_},bc(h,"state",{get:y}),Lte()&&(h[zR(11)]="IPromise");var x=function(){return"IPromise "+y()+(s?" - "+wO(o):"")};return h.toString=x,function(){mt(t)||la(Vy+": executor is not a function - "+wO(t));var E=m(3,0);try{t.call(h,m(2,0),E)}catch(S){E(S)}}(),h}function Sne(n){return function(e){var t=HR(arguments,1);return n(function(r,i){try{var s=[],o=1;Ze(e,function(a,l){a&&(o++,Xz(a,function(c){s[l]=c,--o===0&&r(s)},i))}),o--,o===0&&r(s)}catch(a){i(a)}},t)}}var Ene=function(n){Ze(n,function(e){try{e()}catch{}})};function Tne(n){var e=_S(n)?n:0;return function(t){bo(function(){Ene(t)},e)}}function Qz(n,e){return wne(Qz,Tne(e),n,e)}var WT;function Cne(n,e){!WT&&(WT=yS(Vy));var t=WT.v;if(!t)return Qz(n);mt(n)||la(Vy+": executor is not a function - "+Ke(n));var r=0;function i(){return qz[r]}var s=new t(function(o,a){function l(u){r=2,o(u)}function c(u){r=3,a(u)}n(l,c)});return bc(s,"state",{get:i}),s}var YT;function Rc(n,e){return!YT&&(YT=Dv(function(){return Cne})),YT.v.call(this,n,e)}var bne=Sne(Rc),zo=void 0,zt="",yu="channels",pr="core",w2="createPerfMgr",S2="disabled",Lf="extensionConfig",jh="extensions",oa="processTelemetry",Gy="priority",ox="eventsSent",Eg="eventsDiscarded",ax="eventsSendRequest",ku="perfEvent",KT="offlineEventsStored",$T="offlineBatchSent",XT="offlineBatchDrop",Wy="getPerfMgr",E2="domain",qT="path",Ane="Not dynamic - ",Mne="getPrototypeOf",Rne=/-([a-z])/g,Nne=/([^\w\d_$])/g,Ine=/^(\d+[\w\d_$])/,Pne=Object[Mne];function Of(n){return!Ae(n)}function Yy(n){var e=n;return e&&ht(e)&&(e=e[Hu](Rne,function(t,r){return r.toUpperCase()}),e=e[Hu](Nne,"_"),e=e[Hu](Ine,function(t,r){return"_"+r})),e}function qr(n,e){return n&&e?Fi(n,e)!==-1:!1}function xp(n){return n&&n.toISOString()||""}function Zt(n){return OR(n)?n[Va]:zt}function hn(n,e,t,r,i){var s=t;return n&&(s=n[e],s!==t&&(!i||i(s))&&(!r||r(t))&&(s=t,n[e]=s)),s}function fi(n,e,t){var r;return n?(r=n[e],!r&&Ae(r)&&(r=bn(t)?{}:t,n[e]=r)):r=bn(t)?{}:t,r}function Jz(n,e){var t=null,r=null;return mt(n)?t=n:r=n,function(){var i=arguments;if(t&&(r=t()),r)return r[e][pd](r,i)}}function kne(n,e,t){if(n&&e&&Wi(n)&&Wi(e)){var r=function(s){if(ht(s)){var o=e[s];mt(o)?(!t||t(s,!0,e,n))&&(n[s]=Jz(e,s)):(!t||t(s,!1,e,n))&&(gc(n,s)&&delete n[s],Gt(n,s,{g:function(){return e[s]},s:function(a){e[s]=a}}))}};for(var i in e)r(i)}return n}function Ky(n,e,t,r,i){n&&e&&t&&(i!==!1||bn(n[e]))&&(n[e]=Jz(t,r))}function Ym(n,e,t,r){return n&&e&&Wi(n)&&Dt(t)&&Ze(t,function(i){ht(i)&&Ky(n,i,e,i,r)}),n}function Lne(n){return function(){function e(){var t=this;n&&Pt(n,function(r,i){t[r]=i})}return e}()}function eB(n){return n&&o2&&(n=qR(o2({},n))),n}function tB(n,e,t,r,i,s){var o=arguments,a=o[0]||{},l=o[_t],c=!1,u=1;for(l>0&&wz(a)&&(c=a,a=o[u]||{},u++),Wi(a)||(a={});u<l;u++){var h=o[u],f=Dt(h),p=Wi(h);for(var _ in h){var y=f&&_ in h||p&&gc(h,_);if(y){var g=h[_],m=void 0;if(c&&g&&((m=Dt(g))||Ui(g))){var v=a[_];m?Dt(v)||(v=[]):Ui(v)||(v={}),g=tB(c,v,g)}g!==void 0&&(a[_]=g)}}}return a}function ZT(n,e){var t=!1,r=e&&e.featureOptIn&&e.featureOptIn[n];if(n&&r){var i=r.mode;t=i==3||i==1}return t}function $y(n){try{return n.responseText}catch{}return null}function nB(n,e){return n?"XDomainRequest,Response:"+$y(n)||"":e}function Xy(n,e){return n?"XMLHttpRequest,Status:"+n[Wm]+",Response:"+$y(n)||n.response||"":e}function SO(n,e){return e&&(_S(e)?n=[e].concat(n):Dt(e)&&(n=e.concat(n))),n}var One="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",EO="withCredentials",Dne="timeout";function Une(n,e,t,r,i,s){r===void 0&&(r=!1),i===void 0&&(i=!1);function o(l,c,u){try{l[c]=u}catch{}}var a=new XMLHttpRequest;return r&&o(a,One,r),t&&o(a,EO,t),a.open(n,e,!i),t&&o(a,EO,t),!i&&s&&o(a,Dne,s),a}function Fne(n){var e={};if(ht(n)){var t=or(n)[vp](/[\r\n]+/);Ze(t,function(r){if(r){var i=r.indexOf(": ");if(i!==-1){var s=or(r.substring(0,i))[mp](),o=or(r.substring(i+1));e[s]=o}else e[or(r)]=1}})}return e}function QT(n,e,t){if(!n[t]&&e&&e[pO]){var r=e[pO](t);r&&(n[t]=or(r))}return n}var jne="kill-duration",zne="kill-duration-seconds",Bne="time-delta-millis";function JT(n,e){var t={};return n[mO]?t=Fne(n[mO]()):e&&(t=QT(t,n,Bne),t=QT(t,n,jne),t=QT(t,n,zne)),t}var Hne="documentMode",Vne="location",Gne="console",rB="JSON",Wne="crypto",Yne="msCrypto",Kne="ReactNative",T2="msie",C2="trident/",iB="XMLHttpRequest",e1=null,t1=null,$ne=!1,dh=null,n1=null;function sB(n,e){var t=!1;if(n){try{if(t=e in n,!t){var r=n[Qo];r&&(t=e in r)}}catch{}if(!t)try{var i=new n;t=!bn(i[e])}catch{}}return t}function Ko(n){if(n&&$ne){var e=cr("__mockLocation");if(e)return e}return typeof location===Hz&&location?location:cr(Vne)}function Xne(){return typeof console!==XR?console:cr(Gne)}function jv(){return!!(typeof JSON===Hz&&JSON||cr(rB)!==null)}function wo(){return jv()?JSON||cr(rB):null}function qne(){return cr(Wne)}function Zne(){return cr(Yne)}function Qne(){var n=ca();return n&&n.product?n.product===Kne:!1}function b2(){var n=ca();if(n&&(n[m2]!==t1||e1===null)){t1=n[m2];var e=(t1||zt)[mp]();e1=qr(e,T2)||qr(e,C2)}return e1}function oB(n){if(n===void 0&&(n=null),!n){var e=ca()||{};n=e?(e.userAgent||zt)[mp]():zt}var t=(n||zt)[mp]();if(qr(t,T2)){var r=ii()||{};return Math.max(parseInt(t[vp](T2)[1]),r[Hne]||0)}else if(qr(t,C2)){var i=parseInt(t[vp](C2)[1]);if(i)return i+4}return null}function Km(n){return(n1===null||n===!1)&&(n1=Ite()&&!!ca().sendBeacon),n1}function QR(n){var e=!1;try{e=!!cr("fetch");var t=cr("Request");e&&n&&t&&(e=sB(t,"keepalive"))}catch{}return e}function Jne(){return dh===null&&(dh=typeof XDomainRequest!==XR,dh&&ES()&&(dh=dh&&!sB(cr(iB),"withCredentials"))),dh}function ES(){var n=!1;try{var e=cr(iB);n=!!e}catch{}return n}function ere(n,e){return n&&n.dispatchEvent&&e?(n.dispatchEvent(e),!0):!1}function tre(n,e){var t=null,r={detail:e||null};if(mt(CustomEvent))t=new CustomEvent(n,r);else{var i=ii();i&&i.createEvent&&(t=i.createEvent("CustomEvent"),t.initCustomEvent(n,!0,!0,r))}return t}function nre(n,e,t){var r=js();if(r&&r.CustomEvent)try{var i={cfg:e||null,customDetails:t||null};return ere(r,tre(n,i))}catch{}return!1}var aB=4294967296,_c=4294967295,lB=123456789,cB=987654321,uB=!1,$m=lB,Xm=cB;function rre(n){n<0&&(n>>>=0),$m=lB+n&_c,Xm=cB-n&_c,uB=!0}function ire(){try{var n=sa()&2147483647;rre((Math.random()*aB^n)+n)}catch{}}function sre(n){return n>0?Math.floor(cv()/_c*(n+1))>>>0:0}function cv(n){var e=0,t=qne()||Zne();return t&&t.getRandomValues&&(e=t.getRandomValues(new Uint32Array(1))[0]&_c),e===0&&b2()&&(uB||ire(),e=ore()&_c),e===0&&(e=Math.floor(aB*Math.random()|0)),n||(e>>>=0),e}function ore(n){Xm=36969*(Xm&65535)+(Xm>>16)&_c,$m=18e3*($m&65535)+($m>>16)&_c;var e=(Xm<<16)+($m&65535)>>>0&_c|0;return n||(e>>>=0),e}function JR(n){n===void 0&&(n=22);for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=cv()>>>0,r=0,i=zt;i[_t]<n;)r++,i+=e.charAt(t&63),t>>>=6,r===5&&(t=(cv()<<2&4294967295|t&3)>>>0,r=0);return i}var dB="3.0.5",are="."+JR(6),lre=0;function hB(n){return n[BT]===1||n[BT]===9||!+n[BT]}function cre(n,e){var t=e[n.id];if(!t){t={};try{hB(e)&&Gt(e,n.id,{e:!1,v:t})}catch{}}return t}function Gs(n,e){return e===void 0&&(e=!1),Yy(n+lre+++(e?"."+dB:zt)+are)}function fB(n){var e={id:Gs("_aiData-"+(n||zt)+"."+dB),accept:function(t){return hB(t)},get:function(t,r,i,s){var o=t[e.id];return o?o[Yy(r)]:(s&&(o=cre(e,t),o[Yy(r)]=i),i)},kill:function(t,r){if(t&&t[r])try{delete t[r]}catch{}}};return e}function lx(n){return n&&Wi(n)&&(n.isVal||n.fb||gc(n,"v")||gc(n,"mrg")||gc(n,"ref")||n.set)}function pB(n,e,t){var r,i=t.dfVal||yz;if(e&&t.fb){var s=t.fb;Dt(s)||(s=[s]);for(var o=0;o<s[_t];o++){var a=s[o],l=e[a];if(i(l)?r=l:n&&(l=n.cfg[a],i(l)&&(r=l),n.set(n.cfg,Di(a),l)),i(r))break}}return!i(r)&&i(t.v)&&(r=t.v),r}function A2(n,e,t){var r=t;if(t&&lx(t)&&(r=pB(n,e,t)),r){lx(r)&&(r=A2(n,e,r));var i;Dt(r)?(i=[],i[_t]=r[_t]):Ui(r)&&(i={}),i&&(Pt(r,function(s,o){o&&lx(o)&&(o=A2(n,e,o)),i[s]=o}),r=i)}return r}function eN(n,e,t,r){var i,s,o,a=r,l,c,u,h;lx(a)?(i=a.isVal,s=a.set,u=a[Oy],h=a[Ly],l=a.mrg,c=a.ref,!c&&bn(c)&&(c=!!l),o=pB(n,e,a)):o=r,h&&n[Ly](e,t);var f,p=!0,_=e[t];(_||!Ae(_))&&(f=_,p=!1,i&&f!==o&&!i(f)&&(f=o,p=!0),s&&(f=s(f,o,e),p=f===o)),p?o?f=A2(n,e,o):f=o:(Ui(f)||Dt(o))&&l&&o&&(Ui(o)||Dt(o))&&Pt(o,function(y,g){eN(n,f,y,g)}),n.set(e,t,f),c&&n.ref(e,t),u&&n[Oy](e,t)}var Nc=BR("[[ai_dynCfg_1]]"),mB=BR("[[ai_blkDynCfg_1]]"),ure=BR("[[ai_frcDynCfg_1]]");function gB(n){if(n){var e;if(Dt(n)?(e=[],e[_t]=n[_t]):Ui(n)&&(e={}),e)return Pt(n,function(t,r){e[t]=gB(r)}),e}return n}function dre(n){if(n){var e=n[Nc]||n;if(e.cfg&&(e.cfg===n||e.cfg[Nc]===e))return e}return null}function hre(n){if(n&&(Ui(n)||Dt(n)))try{n[mB]=!0}catch{}return n}function r1(n,e,t){var r=!1;return t&&!n[e.blkVal]&&(r=t[ure],!r&&!t[mB]&&(r=Ui(t)||Dt(t))),r}function vB(n){la("InvalidAccess:"+n)}var fre=["push","pop","shift","unshift","splice"],uv=function(n,e,t,r){n&&n[Uv](3,108,"".concat(t," [").concat(e,"] failed - ")+Ke(r))};function pre(n,e,t){Dt(e)&&Ze(fre,function(r){var i=e[r];e[r]=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=i[pd](this,s);return Zy(n,e,t,"Patching"),a}})}function qy(n,e){var t=DR(n,e);return t&&t.get}function mre(n,e,t,r){var i={n:t,h:[],trk:function(c){c&&c.fn&&(ci(i.h,c)===-1&&i.h[en](c),n.trk(c,i))},clr:function(c){var u=ci(i.h,c);u!==-1&&i.h[Fp](u,1)}},s=!0,o=!1;function a(){s&&(o=o||r1(a,n,r),r&&!r[Nc]&&o&&(r=Zy(n,r,t,"Converting")),s=!1);var c=n.act;return c&&i.trk(c),r}a[n.prop]={chng:function(){n.add(i)}};function l(c){if(r!==c){a[n.ro]&&!n.upd&&vB("["+t+"] is read-only:"+Ke(e)),s&&(o=o||r1(a,n,r),s=!1);var u=o&&a[n.rf];if(o)if(u){Pt(r,function(f){r[f]=c?c[f]:zo});try{Pt(c,function(f,p){TS(n,r,f,p)}),c=r}catch(f){uv((n.hdlr||{})[qn],t,"Assigning",f),o=!1}}else r&&r[Nc]&&Pt(r,function(f){var p=qy(r,f);if(p){var _=p[n.prop];_&&_.chng()}});if(c!==r){var h=c&&r1(a,n,c);!u&&h&&(c=Zy(n,c,t,"Converting")),r=c,o=h}n.add(i)}}Gt(e,i.n,{g:a,s:l})}function TS(n,e,t,r){if(e){var i=qy(e,t),s=i&&!!i[n.prop];s?e[t]=r:mre(n,e,t,r)}return e}function i1(n,e,t,r){if(e){var i=qy(e,t),s=i&&!!i[n.prop],o=r&&r[0],a=r&&r[1],l=r&&r[2];if(!s){if(l)try{hre(e)}catch(c){uv((n.hdlr||{})[qn],t,"Blocking",c)}try{TS(n,e,t,e[t]),i=qy(e,t)}catch(c){uv((n.hdlr||{})[qn],t,"State",c)}}o&&(i[n.rf]=o),a&&(i[n.ro]=a),l&&(i[n.blkVal]=!0)}return e}function Zy(n,e,t,r){try{Pt(e,function(i,s){TS(n,e,i,s)}),e[Nc]||(bc(e,Nc,{get:function(){return n[Gz]}}),pre(n,e,t))}catch(i){uv((n.hdlr||{})[qn],t,r,i)}return e}var fm="[[ai_",pm="]]";function gre(n){var e,t=dm(fm+"get"+n.uid+pm),r=dm(fm+"ro"+n.uid+pm),i=dm(fm+"rf"+n.uid+pm),s=dm(fm+"blkVal"+n.uid+pm),o=dm(fm+"dtl"+n.uid+pm),a=null,l=null,c;function u(_,y){var g=c.act;try{c.act=_,_&&_[o]&&(Ze(_[o],function(v){v.clr(_)}),_[o]=[]),y({cfg:n.cfg,set:n.set.bind(n),setDf:n[Up].bind(n),ref:n.ref.bind(n),rdOnly:n[Oy].bind(n)})}catch(v){var m=n[qn];throw m&&m[Uv](1,107,Ke(v)),v}finally{c.act=g||null}}function h(){if(a){var _=a;a=null,l&&l[ff](),l=null;var y=[];if(Ze(_,function(g){if(g&&(g[o]&&(Ze(g[o],function(m){m.clr(g)}),g[o]=null),g.fn))try{u(g,g.fn)}catch(m){y[en](m)}}),a)try{h()}catch(g){y[en](g)}y[_t]>0&&mne("Watcher error(s): ",y)}}function f(_){if(_&&_.h[_t]>0){a||(a=[]),l||(l=bo(function(){l=null,h()},0));for(var y=0;y<_.h[_t];y++){var g=_.h[y];g&&ci(a,g)===-1&&a[en](g)}}}function p(_,y){if(_){var g=_[o]=_[o]||[];ci(g,y)===-1&&g[en](y)}}return c=(e={prop:t,ro:r,rf:i},e[Ly]=s,e[Gz]=n,e.add=f,e[Dy]=h,e.use=u,e.trk=p,e),c}function vre(n,e){var t={fn:e,rm:function(){t.fn=null,n=null,e=null}};return Gt(t,"toJSON",{v:function(){return"WatcherHandler"+(t.fn?"":"[X]")}}),n.use(t,e),t}function _re(n,e,t){var r,i=dre(e);if(i)return i;var s=Gs("dyncfg",!0),o=e&&t!==!1?e:gB(e),a;function l(){a[Dy]()}function c(m,v,x){try{m=TS(a,m,v,x)}catch(w){uv(n,v,"Setting value",w)}return m[v]}function u(m){return vre(a,m)}function h(m,v){a.use(null,function(x){var w=a.upd;try{bn(v)||(a.upd=v),m(x)}finally{a.upd=w}})}function f(m,v){var x;return i1(a,m,v,(x={},x[0]=!0,x))[v]}function p(m,v){var x;return i1(a,m,v,(x={},x[1]=!0,x))[v]}function _(m,v){var x;return i1(a,m,v,(x={},x[2]=!0,x))[v]}function y(m,v){return v&&Pt(v,function(x,w){eN(g,m,x,w)}),m}var g=(r={uid:null,cfg:o},r[qn]=n,r[Dy]=l,r.set=c,r[Up]=y,r[vc]=u,r.ref=f,r[Oy]=p,r[Ly]=_,r._block=h,r);return Gt(g,"uid",{c:!1,e:!1,w:!1,v:s}),a=gre(g),Zy(a,o,"config","Creating"),g}function xre(n,e){n?(n[Uy](e),n[Uv](2,108,e)):vB(e)}function Ws(n,e,t,r){var i=_re(t,n||{},r);return e&&i[Up](i.cfg,e),i}function Jn(n,e,t){var r=n[Nc]||n;return r.cfg&&(r.cfg===n||r.cfg[Nc]===r)?r[vc](e):(xre(t,Ane+Ke(n)),Ws(n,null,t)[vc](e))}function mf(n,e){if(n&&n[Mc])return n[Mc](e)}function _B(n,e,t){var r;return t||(r=Rc(function(i){t=i})),n&&Jte(n)>0?_p(mf(n[0],e),function(){_B(HR(n,1),e,t)}):t(),r}var yre=500,TO="Microsoft_ApplicationInsights_BypassAjaxInstrumentation";function wre(n,e,t){return!n&&Ae(n)?e:wz(n)?n:Di(n)[mp]()==="true"}function Vl(n){return{mrg:!0,v:n}}function CO(n,e){return{set:n,v:e}}function Qy(n,e,t){return{fb:t,isVal:n,v:e}}function rr(n,e){return{fb:e,set:wre,v:!!n}}function Sre(n){return{isVal:ht,v:Di(n||zt)}}var s1=[ox,Eg,ax,ku],Jy=null,l_;function Ere(n,e){return function(){var t=arguments,r=xB(e);if(r){var i=r.listener;i&&i[n]&&i[n][pd](i,t)}}}function Tre(){var n=cr("Microsoft");return n&&(Jy=n.ApplicationInsights),Jy}function xB(n){var e=Jy;return!e&&n.disableDbgExt!==!0&&(e=Jy||Tre()),e?e.ChromeDbgExt:null}function Cre(n){if(!l_){l_={};for(var e=0;e<s1[_t];e++)l_[s1[e]]=Ere(s1[e],n)}return l_}var hh,yB="warnToConsole",bre="AI (Internal): ",Are="AI: ",Mre="AITR_",Rre={loggingLevelConsole:0,loggingLevelTelemetry:1,maxMessageLimit:25,enableDebug:!1},Nre=(hh={},hh[0]=null,hh[1]="errorToConsole",hh[2]=yB,hh[3]="debugToConsole",hh);function bO(n){return n?'"'+n[Hu](/\"/g,zt)+'"':zt}function o1(n,e){var t=Xne();if(t){var r="log";t[n]&&(r=n),mt(t[r])&&t[r](e)}}var dv=function(){function n(e,t,r,i){r===void 0&&(r=!1);var s=this;s[By]=e,s[Bu]=(r?Are:bre)+e;var o=zt;jv()&&(o=wo().stringify(i));var a=(t?" message:"+bO(t):zt)+(i?" props:"+bO(o):zt);s[Bu]+=a}return n.dataType="MessageData",n}();function Ad(n,e){return(n||{})[qn]||new ew(e)}var ew=function(){function n(e){this.identifier="DiagnosticLogger",this.queue=[];var t=0,r={},i,s,o,a,l;yn(n,this,function(c){l=h(e||{}),c.consoleLoggingLevel=function(){return i},c[Uv]=function(_,y,g,m,v){v===void 0&&(v=!1);var x=new dv(y,g,v,m);if(a)throw Ke(x);var w=Nre[_]||yB;if(bn(x[Bu]))p("throw"+(_===1?"Critical":"Warning"),x);else{if(v){var E=+x[By];!r[E]&&i>=_&&(c[w](x[Bu]),r[E]=!0)}else i>=_&&c[w](x[Bu]);u(_,x)}},c.debugToConsole=function(_){o1("debug",_),p("warning",_)},c[Uy]=function(_){o1("warn",_),p("warning",_)},c.errorToConsole=function(_){o1("error",_),p("error",_)},c.resetInternalMessageCount=function(){t=0,r={}},c[$z]=u,c[Mc]=function(_){l&&l.rm(),l=null};function u(_,y){if(!f()){var g=!0,m=Mre+y[By];if(r[m]?g=!1:r[m]=!0,g&&(_<=s&&(c.queue[en](y),t++,p(_===1?"error":"warn",y)),t===o)){var v="Internal events throttle limit per PageView reached for this app.",x=new dv(23,v,!1);c.queue[en](x),_===1?c.errorToConsole(v):c[Uy](v)}}}function h(_){return Jn(Ws(_,Rre,c).cfg,function(y){var g=y.cfg;i=g[Yz],s=g.loggingLevelTelemetry,o=g.maxMessageLimit,a=g.enableDebug})}function f(){return t>=o}function p(_,y){var g=xB(e||{});g&&g[Ga]&&g[Ga](_,y)}})}return n.__ieDyn=1,n}();function tN(n){return n||new ew}function He(n,e,t,r,i,s){s===void 0&&(s=!1),tN(n)[Uv](e,t,r,i,s)}function Vu(n,e){tN(n)[Uy](e)}function Ire(n,e,t){tN(n)[$z](e,t)}var a1,qc,AO="toGMTString",MO="toUTCString",nN="cookie",l1="expires",RO="isCookieUseDisabled",M2="disableCookiesUsage",ec="_ckMgr",c_=null,c1=null,NO=null,ea,IO={},tw={},Pre=(a1={cookieCfg:Vl((qc={},qc[E2]={fb:"cookieDomain",dfVal:Of},qc.path={fb:"cookiePath",dfVal:Of},qc.enabled=zo,qc.ignoreCookies=zo,qc.blockedCookies=zo,qc)),cookieDomain:zo,cookiePath:zo},a1[M2]=zo,a1);function rN(){!ea&&(ea=Dv(function(){return ii()}))}function kre(n,e){var t=Tg[ec]||tw[ec];return t||(t=Tg[ec]=Tg(n,e),tw[ec]=t),t}function u_(n){return n?n.isEnabled():!0}function wB(n,e){return e&&n&&Dt(n.ignoreCookies)?ci(n.ignoreCookies,e)!==-1:!1}function Lre(n,e){return e&&n&&Dt(n.blockedCookies)&&ci(n.blockedCookies,e)!==-1?!0:wB(n,e)}function PO(n,e){var t=e[pf];if(Ae(t)){var r=void 0;bn(n[RO])||(r=!n[RO]),bn(n[M2])||(r=!n[M2]),t=r}return t}function iN(n,e){var t;if(n)t=n.getCookieMgr();else if(e){var r=e.cookieCfg;r&&r[ec]?t=r[ec]:t=Tg(e)}return t||(t=kre(e,(n||{})[qn])),t}function Tg(n,e){var t,r,i,s,o,a,l,c,u;n=Ws(n||tw,null,e).cfg,o=Jn(n,function(f){f[Up](f.cfg,Pre),r=f.ref(f.cfg,"cookieCfg"),i=r[qT]||"/",s=r[E2],a=PO(n,r)!==!1,l=r.getCookie||Ore,c=r.setCookie||DO,u=r.delCookie||DO},e);var h=(t={isEnabled:function(){var f=PO(n,r)!==!1&&a&&kO(e),p=tw[ec];return f&&p&&h!==p&&(f=u_(p)),f},setEnabled:function(f){a=f!==!1,r[pf]=f},set:function(f,p,_,y,g){var m=!1;if(u_(h)&&!Lre(r,f)){var v={},x=or(p||zt),w=Fi(x,";");if(w!==-1&&(x=or(UR(p,w)),v=SB(Co(p,w+1))),hn(v,E2,y||s,My,bn),!Ae(_)){var E=b2();if(bn(v[l1])){var S=sa(),C=S+_*1e3;if(C>0){var A=new Date;A.setTime(C),hn(v,l1,LO(A,E?AO:MO)||LO(A,E?AO:MO)||zt,My)}}E||hn(v,"max-age",zt+_,null,bn)}var k=Ko();k&&k[Kz]==="https:"&&(hn(v,"secure",null,null,bn),c1===null&&(c1=!Dre((ca()||{})[m2])),c1&&hn(v,"SameSite","None",null,bn)),hn(v,qT,g||i,null,bn),c(f,OO(x,v)),m=!0}return m},get:function(f){var p=zt;return u_(h)&&!wB(r,f)&&(p=l(f)),p},del:function(f,p){var _=!1;return u_(h)&&(_=h.purge(f,p)),_},purge:function(f,p){var _,y=!1;if(kO(e)){var g=(_={},_[qT]=p||"/",_[l1]="Thu, 01 Jan 1970 00:00:01 GMT",_);b2()||(g["max-age"]="0"),u(f,OO(zt,g)),y=!0}return y}},t[Mc]=function(f){o&&o.rm(),o=null},t);return h[ec]=h,h}function kO(n){if(c_===null){c_=!1,!ea&&rN();try{var e=ea.v||{};c_=e[nN]!==void 0}catch(t){He(n,2,68,"Cannot access document.cookie - "+Zt(t),{exception:Ke(t)})}}return c_}function SB(n){var e={};if(n&&n[_t]){var t=or(n)[vp](";");Ze(t,function(r){if(r=or(r||zt),r){var i=Fi(r,"=");i===-1?e[r]=null:e[or(UR(r,i))]=or(Co(r,i+1))}})}return e}function LO(n,e){return mt(n[e])?n[e]():null}function OO(n,e){var t=n||zt;return Pt(e,function(r,i){t+="; "+r+(Ae(i)?zt:"="+i)}),t}function Ore(n){var e=zt;if(!ea&&rN(),ea.v){var t=ea.v[nN]||zt;NO!==t&&(IO=SB(t),NO=t),e=or(IO[n]||zt)}return e}function DO(n,e){!ea&&rN(),ea.v&&(ea.v[nN]=n+"="+e)}function Dre(n){return ht(n)?!!(qr(n,"CPU iPhone OS 12")||qr(n,"iPad; CPU OS 12")||qr(n,"Macintosh; Intel Mac OS X 10_14")&&qr(n,"Version/")&&qr(n,"Safari")||qr(n,"Macintosh; Intel Mac OS X 10_14")&&Fz(n,"AppleWebKit/605.1.15 (KHTML, like Gecko)")||qr(n,"Chrome/5")||qr(n,"Chrome/6")||qr(n,"UnrealEngine")&&!qr(n,"Chrome")||qr(n,"UCBrowser/12")||qr(n,"UCBrowser/11")):!1}var Ure={perfEvtsSendAll:!1};function Fre(n){n.h=null;var e=n.cb;n.cb=[],Ze(e,function(t){Gi(t.fn,[t.arg])})}function El(n,e,t,r){Ze(n,function(i){i&&i[e]&&(t?(t.cb[en]({fn:r,arg:i}),t.h=t.h||bo(Fre,0,t)):Gi(r,[i]))})}var jre=function(){function n(e){this.listeners=[];var t,r,i=[],s={h:null,cb:[]},o=Ws(e,Ure);r=o[vc](function(a){t=!!a.cfg.perfEvtsSendAll}),yn(n,this,function(a){Gt(a,"listeners",{g:function(){return i}}),a[jy]=function(l){i[en](l)},a[Fy]=function(l){for(var c=ci(i,l);c>-1;)i[Fp](c,1),c=ci(i,l)},a[ox]=function(l){El(i,ox,s,function(c){c[ox](l)})},a[Eg]=function(l,c){El(i,Eg,s,function(u){u[Eg](l,c)})},a[ax]=function(l,c){El(i,ax,c?s:null,function(u){u[ax](l,c)})},a[ku]=function(l){l&&(t||!l[g2]())&&El(i,ku,null,function(c){l[gp]?bo(function(){return c[ku](l)},0):c[ku](l)})},a[KT]=function(l){l&&l[_t]&&El(i,KT,s,function(c){c[KT](l)})},a[$T]=function(l){l&&l[Fh]&&El(i,$T,s,function(c){c[$T](l)})},a[XT]=function(l,c){if(l>0){var u=c||0;El(i,XT,s,function(h){h[XT](l,u)})}},a[Mc]=function(l){var c=function(){r&&r.rm(),r=null,i=[],s.h&&s.h[ff](),s.h=null,s.cb=[]},u;if(El(i,"unload",null,function(h){var f=h[Mc](l);f&&(u||(u=[]),u[en](f))}),u)return Rc(function(h){return _p(bne(u),function(){c(),h()})});c()}})}return n.__ieDyn=1,n}(),Df="ctx",R2="ParentContextKey",Cg="ChildrenContextKey",zre=null,cx=function(){function n(e,t,r){var i=this;if(i.start=sa(),i[Va]=e,i[gp]=r,i[g2]=function(){return!1},mt(t)){var s;Gt(i,"payload",{g:function(){return!s&&mt(t)&&(s=t(),t=null),s}})}i[kf]=function(o){return o?o===n[R2]||o===n[Cg]?i[o]:(i[Df]||{})[o]:null},i[Oo]=function(o,a){if(o)if(o===n[R2])i[o]||(i[g2]=function(){return!0}),i[o]=a;else if(o===n[Cg])i[o]=a;else{var l=i[Df]=i[Df]||{};l[o]=a}},i[v2]=function(){var o=0,a=i[kf](n[Cg]);if(Dt(a))for(var l=0;l<a[_t];l++){var c=a[l];c&&(o+=c[Pf])}i[Pf]=sa()-i.start,i.exTime=i[Pf]-o,i[v2]=function(){}}}return n.ParentContextKey="parent",n.ChildrenContextKey="childEvts",n}(),Bre=function(){function n(e){this.ctx={},yn(n,this,function(t){t.create=function(r,i,s){return new cx(r,i,s)},t.fire=function(r){r&&(r[v2](),e&&mt(e[ku])&&e[ku](r))},t[Oo]=function(r,i){if(r){var s=t[Df]=t[Df]||{};s[r]=i}},t[kf]=function(r){return(t[Df]||{})[r]}})}return n.__ieDyn=1,n}(),u1="CoreUtils.doPerf";function nw(n,e,t,r,i){if(n){var s=n;if(s[Wy]&&(s=s[Wy]()),s){var o=void 0,a=s[kf](u1);try{if(o=s.create(e(),r,i),o){if(a&&o[Oo]&&(o[Oo](cx[R2],a),a[kf]&&a[Oo])){var l=a[kf](cx[Cg]);l||(l=[],a[Oo](cx[Cg],l)),l[en](o)}return s[Oo](u1,o),t(o)}}catch(c){o&&o[Oo]&&o[Oo]("exception",c)}finally{o&&s.fire(o),s[Oo](u1,a)}}}return t()}function Hre(){return zre}function tc(){for(var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],e=zt,t,r=0;r<4;r++)t=cv(),e+=n[t&15]+n[t>>4&15]+n[t>>8&15]+n[t>>12&15]+n[t>>16&15]+n[t>>20&15]+n[t>>24&15]+n[t>>28&15];var i=n[8+(cv()&3)|0];return Bl(e,0,8)+Bl(e,9,4)+"4"+Bl(e,13,3)+i+Bl(e,16,3)+Bl(e,19,12)}var N2="00",Vre="ff",EB="00000000000000000000000000000000",TB="0000000000000000";function zv(n,e,t){return n&&n[_t]===e&&n!==t?!!n.match(/^[\da-f]*$/i):!1}function UO(n,e,t){return zv(n,e)?n:t}function Gre(n){(isNaN(n)||n<0||n>255)&&(n=1);for(var e=n.toString(16);e[_t]<2;)e="0"+e;return e}function FO(n,e,t,r){var i;return i={},i[zy]=zv(r,2,Vre)?r:N2,i[_2]=sN(n)?n:tc(),i[x2]=oN(e)?e:UR(tc(),16),i.traceFlags=t>=0&&t<=255?t:1,i}function sN(n){return zv(n,32,EB)}function oN(n){return zv(n,16,TB)}function jO(n){if(n){var e=Gre(n[y2]);zv(e,2)||(e="01");var t=n[zy]||N2;return t!=="00"&&t!=="ff"&&(t=N2),"".concat(t.toLowerCase(),"-").concat(UO(n.traceId,32,EB).toLowerCase(),"-").concat(UO(n.spanId,16,TB).toLowerCase(),"-").concat(e.toLowerCase())}return""}var Wre=fB("plugin");function Gu(n){return Wre.get(n,"state",{},!0)}function zO(n,e){for(var t=[],r=null,i=n[Jo](),s;i;){var o=i[ov]();if(o){r&&r[lv]&&o[oa]&&r[lv](o),s=Gu(o);var a=!!s[Yo];o[Yo]&&(a=o[Yo]()),a||t[en](o),r=o,i=i[Jo]()}}Ze(t,function(l){var c=n[pr]();l[Fv](n.getCfg(),c,e,n[Jo]()),s=Gu(l),!l[pr]&&!s[pr]&&(s[pr]=c),s[Yo]=!0,delete s[Aa]})}function d1(n){return n.sort(function(e,t){var r=0;if(t){var i=t[oa];e[oa]?r=i?e[Gy]-t[Gy]:1:i&&(r=-1)}else r=e?1:-1;return r})}function Yre(n){var e={};return{getName:function(){return e[Va]},setName:function(t){n&&n.setName(t),e[Va]=t},getTraceId:function(){return e[_2]},setTraceId:function(t){n&&n.setTraceId(t),sN(t)&&(e[_2]=t)},getSpanId:function(){return e[x2]},setSpanId:function(t){n&&n.setSpanId(t),oN(t)&&(e[x2]=t)},getTraceFlags:function(){return e[y2]},setTraceFlags:function(t){n&&n.setTraceFlags(t),e[y2]=t}}}var Kre="TelemetryPluginChain",BO="_hasRun",HO="_getTelCtx",VO=0;function $re(n,e,t){for(;n;){if(n[ov]()===t)return n;n=n[Jo]()}return gd([t],e.config||{},e)}function aN(n,e,t,r){var i=null,s=[];e||(e=Ws({},null,t[qn])),r!==null&&(i=r?$re(n,t,r):n);var o={_next:l,ctx:{core:function(){return t},diagLog:function(){return Ad(t,e.cfg)},getCfg:function(){return e.cfg},getExtCfg:u,getConfig:h,hasNext:function(){return!!i},getNext:function(){return i},setNext:function(p){i=p},iterate:f,onComplete:a}};function a(p,_){for(var y=[],g=2;g<arguments.length;g++)y[g-2]=arguments[g];p&&s[en]({func:p,self:bn(_)?o.ctx:_,args:y})}function l(){var p=i;if(i=p?p[Jo]():null,!p){var _=s;_&&_[_t]>0&&(Ze(_,function(y){try{y.func.call(y.self,y.args)}catch(g){He(t[qn],2,73,"Unexpected Exception during onComplete - "+Ke(g))}}),s=[])}return p}function c(p,_){var y=null,g=e.cfg;if(g&&p){var m=g[Lf];!m&&_&&(m={}),g[Lf]=m,m=e.ref(g,Lf),m&&(y=m[p],!y&&_&&(y={}),m[p]=y,y=e.ref(m,p))}return y}function u(p,_){var y=c(p,!0);return _&&Pt(_,function(g,m){if(Ae(y[g])){var v=e.cfg[g];(v||!Ae(v))&&(y[g]=v)}eN(e,y,g,m)}),e[Up](y,_)}function h(p,_,y){y===void 0&&(y=!1);var g,m=c(p,!1),v=e.cfg;return m&&(m[_]||!Ae(m[_]))?g=m[_]:(v[_]||!Ae(v[_]))&&(g=v[_]),g||!Ae(g)?g:y}function f(p){for(var _;_=o._next();){var y=_[ov]();y&&p(y)}}return o}function So(n,e,t,r){var i=Ws(e),s=aN(n,i,t,r),o=s.ctx;function a(c){var u=s._next();return u&&u[oa](c,o),!u}function l(c,u){return c===void 0&&(c=null),Dt(c)&&(c=gd(c,i.cfg,t,u)),So(c||o[Jo](),i.cfg,t,u)}return o[vi]=a,o[md]=l,o}function rw(n,e,t){var r=Ws(e.config),i=aN(n,r,e,t),s=i.ctx;function o(l){var c=i._next();return c&&c[Mc](s,l),!c}function a(l,c){return l===void 0&&(l=null),Dt(l)&&(l=gd(l,r.cfg,e,c)),rw(l||s[Jo](),e,c)}return s[vi]=o,s[md]=a,s}function lN(n,e,t){var r=Ws(e.config),i=aN(n,r,e,t),s=i.ctx;function o(l){return s.iterate(function(c){mt(c[av])&&c[av](s,l)})}function a(l,c){return l===void 0&&(l=null),Dt(l)&&(l=gd(l,r.cfg,e,c)),lN(l||s[Jo](),e,c)}return s[vi]=o,s[md]=a,s}function gd(n,e,t,r){var i=null,s=!r;if(Dt(n)&&n[_t]>0){var o=null;Ze(n,function(a){if(!s&&r===a&&(s=!0),s&&a&&mt(a[oa])){var l=Xre(a,e,t);i||(i=l),o&&o._setNext(l),o=l}})}return r&&!i?gd([r],e,t):i}function Xre(n,e,t){var r=null,i=mt(n[oa]),s=mt(n[lv]),o;n?o=n[Hl]+"-"+n[Gy]+"-"+VO++:o="Unknown-0-"+VO++;var a={getPlugin:function(){return n},getNext:function(){return r},processTelemetry:u,unload:h,update:f,_id:o,_setNext:function(p){r=p}};function l(){var p;return n&&mt(n[HO])&&(p=n[HO]()),p||(p=So(a,e,t)),p}function c(p,_,y,g,m){var v=!1,x=n?n[Hl]:Kre,w=p[BO];return w||(w=p[BO]={}),p.setNext(r),n&&nw(p[pr](),function(){return x+":"+y},function(){w[o]=!0;try{var E=r?r._id:zt;E&&(w[E]=!1),v=_(p)}catch(C){var S=r?w[r._id]:!0;S&&(v=!0),(!r||!S)&&He(p[Ga](),1,73,"Plugin ["+x+"] failed during "+y+" - "+Ke(C)+", run flags: "+Ke(w))}},g,m),v}function u(p,_){_=_||l();function y(g){if(!n||!i)return!1;var m=Gu(n);return m[Aa]||m[S2]?!1:(s&&n[lv](r),n[oa](p,g),!0)}c(_,y,"processTelemetry",function(){return{item:p}},!p.sync)||_[vi](p)}function h(p,_){function y(){var g=!1;if(n){var m=Gu(n),v=n[pr]||m[pr];n&&(!v||v===p.core())&&!m[Aa]&&(m[pr]=null,m[Aa]=!0,m[Yo]=!1,n[Aa]&&n[Aa](p,_)===!0&&(g=!0))}return g}c(p,y,"unload",function(){},_[gp])||p[vi](_)}function f(p,_){function y(){var g=!1;if(n){var m=Gu(n),v=n[pr]||m[pr];n&&(!v||v===p.core())&&!m[Aa]&&n[av]&&n[av](p,_)===!0&&(g=!0)}return g}c(p,y,"update",function(){},!1)||p[vi](_)}return pp(a)}function CB(){var n=[];function e(r){r&&n[en](r)}function t(r,i){Ze(n,function(s){try{s(r,i)}catch(o){He(r[Ga](),2,73,"Unexpected error calling unload handler - "+Ke(o))}}),n=[]}return{add:e,run:t}}function bB(){var n=[];function e(r){var i=n;n=[],Ze(i,function(s){try{(s.rm||s.remove).call(s)}catch(o){He(r,2,73,"Unloading:"+Ke(o))}})}function t(r){r&&hf(n,r)}return{run:e,add:t}}var h1,Tl="getPlugin",qre=(h1={},h1[Lf]={isVal:Of,v:{}},h1),jp=function(){function n(){var e=this,t,r,i,s,o;c(),yn(n,e,function(u){u[Fv]=function(h,f,p,_){l(h,f,_),t=!0},u[Aa]=function(h,f){var p,_=u[pr];if(!_||h&&_!==h[pr]())return;var y,g=!1,m=h||rw(null,_,i&&i[Tl]?i[Tl]():i),v=f||(p={reason:0},p[gp]=!1,p);function x(){g||(g=!0,s.run(m,f),o.run(m[Ga]()),y===!0&&m[vi](v),c())}return!u[Hy]||u[Hy](m,v,x)!==!0?x():y=!0,y},u[av]=function(h,f){var p=u[pr];if(!p||h&&p!==h[pr]())return;var _,y=!1,g=h||lN(null,p,i&&i[Tl]?i[Tl]():i),m=f||{reason:0};function v(){y||(y=!0,l(g.getCfg(),g.core(),g[Jo]()))}return!u._doUpdate||u._doUpdate(g,m,v)!==!0?v():_=!0,_},Ky(u,"_addUnloadCb",function(){return s},"add"),Ky(u,"_addHook",function(){return o},"add"),Gt(u,"_unloadHooks",{g:function(){return o}})}),e[Ga]=function(u){return a(u)[Ga]()},e[Yo]=function(){return t},e.setInitialized=function(u){t=u},e[lv]=function(u){i=u},e[vi]=function(u,h){h?h[vi](u):i&&mt(i[oa])&&i[oa](u,null)},e._getTelCtx=a;function a(u){u===void 0&&(u=null);var h=u;if(!h){var f=r||So(null,{},e[pr]);i&&i[Tl]?h=f[md](null,i[Tl]):h=f[md](null,i)}return h}function l(u,h,f){Ws(u,qre,Ad(h)),!f&&h&&(f=h[Wz]()[Jo]());var p=i;i&&i[Tl]&&(p=i[Tl]()),e[pr]=h,r=So(f,u,h,p)}function c(){t=!1,e[pr]=null,r=null,i=null,o=bB(),s=CB()}}return n.__ieDyn=1,n}();function Zre(n,e,t){var r={id:e,fn:t};hf(n,r);var i={remove:function(){Ze(n,function(s,o){if(s.id===r.id)return n[Fp](o,1),-1})}};return i}function Qre(n,e,t){for(var r=!1,i=n[_t],s=0;s<i;++s){var o=n[s];if(o)try{if(o.fn[pd](null,[e])===!1){r=!0;break}}catch(a){He(t,2,64,"Telemetry initializer failed: "+Zt(a),{exception:Ke(a)},!0)}}return!r}var Jre=function(n){ul(e,n);function e(){var t=n.call(this)||this;t.identifier="TelemetryInitializerPlugin",t.priority=199;var r,i;s(),yn(e,t,function(o,a){o.addTelemetryInitializer=function(l){return Zre(i,r++,l)},o[oa]=function(l,c){Qre(i,l,c?c[Ga]():o[Ga]())&&o[vi](l,c)},o[Hy]=function(){s()}});function s(){r=0,i=[]}return t}return e.__ieDyn=1,e}(jp),Cl,AB="Plugins must provide initialize method",eie="_notificationManager",GO="SDK is still unloading...",tie="SDK is not initialized",f1=Oc((Cl={cookieCfg:{}},Cl[jh]={rdOnly:!0,ref:!0,v:[]},Cl[yu]={rdOnly:!0,ref:!0,v:[]},Cl[Lf]={ref:!0,v:{}},Cl[w2]=zo,Cl.loggingLevelConsole=0,Cl.diagnosticLogInterval=zo,Cl));function nie(n,e){return new Bre(e)}function rie(n,e,t){var r,i=[],s=[],o={};return Ze(t,function(a){(Ae(a)||Ae(a[Fv]))&&rs(AB);var l=a[Gy],c=a[Hl];a&&l&&(Ae(o[l])?o[l]=c:Vu(n,"Two extensions have same priority #"+l+" - "+o[l]+", "+c)),!l||l<e?i[en](a):s[en](a)}),r={},r[pr]=i,r[yu]=s,r}function WO(n,e){var t=!1;return Ze(e,function(r){if(r===n)return t=!0,-1}),t}function I2(n,e,t,r){t&&Pt(t,function(i,s){r&&Ui(s)&&Ui(e[i])&&I2(n,e[i],s,r),r&&Ui(s)&&Ui(e[i])?I2(n,e[i],s,r):n.set(e,i,s)})}function YO(n,e){var t=null,r=-1;return Ze(n,function(i,s){if(i.w===e)return t=i,r=s,-1}),{i:r,l:t}}function iie(n,e){var t=YO(n,e).l;return t||(t={w:e,rm:function(){var r=YO(n,e);r.i!==-1&&n[Fp](r.i,1)}},n[en](t)),t}function sie(n,e,t){Ze(e,function(r){var i=Jn(n,r.w,t);delete r.w,r.rm=function(){i.rm()}})}function oie(n,e,t,r){return e.add(n[vc](function(i){var s=i.cfg.disableDbgExt;s===!0&&r&&(t[Fy](r),r=null),t&&!r&&s!==!0&&(r=Cre(i.cfg),t[jy](r))})),r}function aie(n){return Gt({rm:function(){n.rm()}},"toJSON",{v:function(){return"aicore::onCfgChange<"+JSON.stringify(n)+">"}})}var lie=function(){function n(){var e,t,r,i,s,o,a,l,c,u,h,f,p,_,y,g,m,v,x,w,E,S,C,A,k,T,R,$;yn(n,this,function(P){j(),P._getDbgPlgTargets=function(){return[C]},P[Yo]=function(){return t},P[Fv]=function(G,he,ve,Y){p&&rs(GO),P[Yo]()&&rs("Core cannot be initialized more than once"),e=Ws(G,f1,ve||P[qn],!1),G=e.cfg,Te(e[vc](function(Ve){E=Ve.cfg.instrumentationKey;var Ue=Ve.ref(Ve.cfg,Lf);Pt(Ue,function(Je){Ve.ref(Ue,Je)}),Ae(E)&&rs("Please provide instrumentation key")})),s=Y,x=oie(e,v,s&&P[s_](),x),K(),P[qn]=ve;var Ne=G[jh];if(u=[],u[en].apply(u,dO(dO([],he,!1),Ne)),h=G[yu],z(null),(!f||f[_t]===0)&&rs("No "+yu+" available"),h&&h[_t]>1){var Re=P[ov]("TeeChannelController");(!Re||!Re.plugin)&&He(r,1,28,"TeeChannel required")}sie(G,S,r),S=null,t=!0,P.releaseQueue(),P[hO]()},P.getChannels=function(){var G=[];return f&&Ze(f,function(he){G[en](he)}),pp(G)},P.track=function(G){nw(P[Wy](),function(){return"AppInsightsCore:track"},function(){G===null&&(Se(G),rs("Invalid telemetry item")),!G[Va]&&Ae(G[Va])&&(Se(G),rs("telemetry name required")),G.iKey=G.iKey||E,G[Pf]=G[Pf]||xp(new Date),G.ver=G.ver||"4.0",!p&&P[Yo]()?O()[vi](G):i[en](G)},function(){return{item:G}},!G.sync)},P[Wz]=O,P[s_]=function(){return s||(s=new jre(e.cfg),P[eie]=s),s},P[jy]=function(G){P.getNotifyMgr()[jy](G)},P[Fy]=function(G){s&&s[Fy](G)},P.getCookieMgr=function(){return l||(l=Tg(e.cfg,P[qn])),l},P.setCookieMgr=function(G){l!==G&&(mf(l,!1),l=G)},P[Wy]=function(){return o||a||Hre()},P.setPerfMgr=function(G){o=G},P.eventCnt=function(){return i[_t]},P.releaseQueue=function(){if(t&&i[_t]>0){var G=i;i=[],Ze(G,function(he){O()[vi](he)})}},P[hO]=function(G){return y=G||null,$=!1,T&&T[ff](),M(!0)};function M(G){if((!T||!T[pf])&&!$){var he=G||r&&r.queue[_t]>0;he&&(R||(R=!0,Te(e[vc](function(ve){var Y=ve.cfg.diagnosticLogInterval;(!Y||!(Y>0))&&(Y=1e4);var Ne=!1;T&&(Ne=T[pf],T[ff]()),T=rne(W,Y),T.unref(),T[pf]=Ne}))),T[pf]=!0)}return T}P[fO]=function(){$=!0,T&&T[ff](),W()},Ym(P,function(){return _},["addTelemetryInitializer"]),P[Mc]=function(G,he,ve){var Y;G===void 0&&(G=!0),t||rs(tie),p&&rs(GO);var Ne=(Y={reason:50},Y[gp]=G,Y.flushComplete=!1,Y),Re;G&&!he&&(Re=Rc(function(Je){he=Je}));var Ve=rw(L(),P);Ve[o_](function(){v.run(P[qn]),_B([l,s,r],G,function(){j(),he&&he(Ne)})},P);function Ue(Je){Ne.flushComplete=Je,p=!0,m.run(Ve,Ne),P[fO](),Ve[vi](Ne)}return W(),H(G,Ue,6,ve),Re},P[ov]=B,P.addPlugin=function(G,he,ve,Y){if(!G){Y&&Y(!1),me(AB);return}var Ne=B(G[Hl]);if(Ne&&!he){Y&&Y(!1),me("Plugin ["+G[Hl]+"] is already loaded!");return}var Re={reason:16};function Ve(tt){u[en](G),Re.added=[G],z(Re),Y&&Y(!0)}if(Ne){var Ue=[Ne.plugin],Je={reason:2,isAsync:!!ve};D(Ue,Je,function(tt){tt?(Re.removed=Ue,Re.reason|=32,Ve()):Y&&Y(!1)})}else Ve()},P.updateCfg=function(G,he){he===void 0&&(he=!0);var ve;if(P[Yo]()){ve={reason:1,cfg:e.cfg,oldCfg:oO({},e.cfg),newConfig:oO({},G),merge:he},G=ve.newConfig;var Y=e.cfg;G[jh]=Y[jh],G[yu]=Y[yu]}e._block(function(Ne){var Re=Ne.cfg;I2(Ne,Re,G,he),he||Pt(Re,function(Ve){gc(G,Ve)||Ne.set(Re,Ve,zo)}),Ne[Up](Re,f1)},!0),e[Dy](),ve&&oe(ve)},P.evtNamespace=function(){return g},P.flush=H,P.getTraceCtx=function(G){return w||(w=Yre()),w},P.setTraceCtx=function(G){w=G||null},P.addUnloadHook=Te,Ky(P,"addUnloadCb",function(){return m},"add"),P.onCfgChange=function(G){var he;return t?he=Jn(e.cfg,G,P[qn]):he=iie(S,G),aie(he)},P.getWParam=function(){return Mz()||e.cfg.enableWParam?0:-1};function I(){var G={};A=[];var he=function(ve){ve&&Ze(ve,function(Y){if(Y[Hl]&&Y[zy]&&!G[Y.identifier]){var Ne=Y[Hl]+"="+Y[zy];A[en](Ne),G[Y.identifier]=Y}})};he(f),h&&Ze(h,function(ve){he(ve)}),he(u)}function j(){t=!1,e=Ws({},f1,P[qn]),e.cfg[Yz]=1,Gt(P,"config",{g:function(){return e.cfg},s:function(he){P.updateCfg(he,!1)}}),Gt(P,"pluginVersionStringArr",{g:function(){return A||I(),A}}),Gt(P,"pluginVersionString",{g:function(){return k||(A||I(),k=A.join(";")),k||zt}}),Gt(P,"logger",{g:function(){return r||(r=new ew(e.cfg),e[qn]=r),r},s:function(he){e[qn]=he,r!==he&&(mf(r,!1),r=he)}}),P[qn]=new ew(e.cfg),C=[];var G=P.config[jh]||[];G.splice(0,G[_t]),hf(G,C),_=new Jre,i=[],mf(s,!1),s=null,o=null,a=null,mf(l,!1),l=null,c=null,u=[],h=null,f=null,p=!1,y=null,g=Gs("AIBaseCore",!0),m=CB(),w=null,E=null,v=bB(),S=[],k=null,A=null,$=!1,T=null,R=!1}function O(){var G=So(L(),e.cfg,P);return G[o_](M),G}function z(G){var he=rie(P[qn],yre,u);c=null,k=null,A=null,f=(h||[])[0]||[],f=d1(hf(f,he[yu]));var ve=hf(d1(he[pr]),f);C=pp(ve);var Y=P.config[jh]||[];Y.splice(0,Y[_t]),hf(Y,C);var Ne=O();f&&f[_t]>0&&zO(Ne[md](f),ve),zO(Ne,ve),G&&oe(G)}function B(G){var he=null,ve=null,Y=[];return Ze(C,function(Ne){if(Ne[Hl]===G&&Ne!==_)return ve=Ne,-1;Ne.getChannel&&Y[en](Ne)}),!ve&&Y[_t]>0&&Ze(Y,function(Ne){if(ve=Ne.getChannel(G),!ve)return-1}),ve&&(he={plugin:ve,setEnabled:function(Ne){Gu(ve)[S2]=!Ne},isEnabled:function(){var Ne=Gu(ve);return!Ne[Aa]&&!Ne[S2]},remove:function(Ne,Re){var Ve;Ne===void 0&&(Ne=!0);var Ue=[ve],Je=(Ve={reason:1},Ve[gp]=Ne,Ve);D(Ue,Je,function(tt){tt&&z({reason:32,removed:Ue}),Re&&Re(tt)})}}),he}function L(){if(!c){var G=(C||[]).slice();ci(G,_)===-1&&G[en](_),c=gd(d1(G),e.cfg,P)}return c}function D(G,he,ve){if(G&&G[_t]>0){var Y=gd(G,e.cfg,P),Ne=rw(Y,P);Ne[o_](function(){var Re=!1,Ve=[];Ze(u,function(Je,tt){WO(Je,G)?Re=!0:Ve[en](Je)}),u=Ve,k=null,A=null;var Ue=[];h&&(Ze(h,function(Je,tt){var st=[];Ze(Je,function(nn){WO(nn,G)?Re=!0:st[en](nn)}),Ue[en](st)}),h=Ue),ve&&ve(Re),M()}),Ne[vi](he)}else ve(!1)}function W(){if(r&&r.queue){var G=r.queue.slice(0);r.queue[_t]=0,Ze(G,function(he){var ve,Y=(ve={},ve[Va]=y||"InternalMessageId: "+he[By],ve.iKey=E,ve[Pf]=xp(new Date),ve.baseType=dv.dataType,ve.baseData={message:he[Bu]},ve);P.track(Y)})}}function H(G,he,ve,Y){var Ne=1,Re=!1,Ve=null;Y=Y||5e3;function Ue(){Ne--,Re&&Ne===0&&(Ve&&Ve[ff](),Ve=null,he&&he(Re),he=null)}if(f&&f[_t]>0){var Je=O()[md](f);Je.iterate(function(tt){if(tt.flush){Ne++;var st=!1;tt.flush(G,function(){st=!0,Ue()},ve)||st||(G&&Ve==null?Ve=bo(function(){Ve=null,Ue()},Y):Ue())}})}return Re=!0,Ue(),!0}function K(){var G;Te(e[vc](function(he){var ve=he.cfg.enablePerfMgr;if(ve){var Y=he.cfg[w2];G!==Y&&(Y||(Y=nie),fi(he.cfg,w2,Y),G=Y,a=null),!o&&!a&&mt(Y)&&(a=Y(P,P[s_]()))}else a=null,G=null}))}function oe(G){var he=lN(L(),P);he[o_](M),(!P._updateHook||P._updateHook(he,G)!==!0)&&he[vi](G)}function me(G){var he=P[qn];he?(He(he,2,73,G),M()):rs(G)}function Se(G){var he=P[s_]();he&&he[Eg]([G],2)}function Te(G){v.add(G)}})}return n.__ieDyn=1,n}();function p1(n,e){try{if(n&&n!==""){var t=wo().parse(n);if(t&&t[gO]&&t[gO]>=t.itemsAccepted&&t.itemsReceived-t.itemsAccepted===t.errors[_t])return t}}catch(r){He(e,1,43,"Cannot parse the response. "+(r[Va]||Ke(r)),{response:n})}return null}var Po="",cie="NoResponseBody",KO="&"+cie+"=true",m1="POST",uie=function(){function n(){var e=0,t,r,i,s,o,a,l,c,u,h,f,p,_;yn(n,this,function(y,g){var m=!0;$(),y[Fv]=function(P,M){i=M,r&&He(i,1,28,"Sender is already initialized"),y.SetConfig(P),r=!0},y._getDbgPlgTargets=function(){return[r,s,a,t]},y.SetConfig=function(P){try{if(o=P.senderOnCompleteCallBack||{},a=!!P.disableCredentials,s=!!P.isOneDs,t=!!P.enableSendPromise,c=!!P.disableXhr,u=!!P.disableBeacon,h=!!P.disableBeaconSync,_=P.timeWrapper,p=!!P.addNoResponse,f=!!P.disableFetchKeepAlive,l={sendPOST:k},s||(m=!1),a){var M=Ko();M&&M.protocol&&M.protocol[mp]()==="file:"&&(m=!1)}return!0}catch{}return!1},y.getSyncFetchPayload=function(){return e},y.getSenderInst=function(P,M){return P&&P[_t]?E(P,M):null},y.getFallbackInst=function(){return l},y[Hy]=function(P,M){$()};function v(P,M){S(M,200,{},P)}function x(P,M){He(i,2,26,"Failed to send telemetry.",{message:P}),S(M,400,{})}function w(P){x("No endpoint url is provided for the batch",P)}function E(P,M){for(var I,j=0,O=null,z=0;O==null&&z<P[_t];)j=P[z],!c&&j===1?Jne()?O=R:ES()&&(O=k):j===2&&QR(M)&&(!M||!f)?O=T:j===3&&Km()&&(M?!h:!u)&&(O=A),z++;return O?(I={_transport:j,_isSync:M},I[vO]=O,I):null}function S(P,M,I,j){try{P&&P(M,I,j)}catch{}}function C(P,M){var I=ca(),j=P[hm];if(!j)return w(M),!0;j=P[hm]+(p?KO:Po);var O=P[Fh],z=s?O:new Blob([O],{type:"text/plain;charset=UTF-8"}),B=I.sendBeacon(j,z);return B}function A(P,M,I){var j=P[Fh];try{if(j)if(C(P,M))v(Po,M);else{var O=o&&o.beaconOnRetry;O&&mt(O)?O(P,M,C):(l&&l[vO](P,M,!0),He(i,2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}catch(z){s&&Vu(i,"Failed to send telemetry using sendBeacon API. Ex:"+Ke(z)),S(M,s?0:400,{},Po)}}function k(P,M,I){var j,O,z,B=P[HT]||{};!I&&t&&(j=Rc(function(H,K){O=H,z=K})),s&&I&&P.disableXhrSync&&(I=!1);var L=P[hm];if(!L){w(M),O&&O(!1);return}var D=Une(m1,L,m,!0,I,P[uh]);D[_O]("Content-type","application/json"),Ze(Ha(B),function(H){D[_O](H,B[H])}),D.onreadystatechange=function(){s||(W(D),D.readyState===4&&O&&O(!0))},D.onload=function(){s&&W(D)};function W(H){var K=o&&o.xhrOnComplete,oe=K&&mt(K);if(oe)K(H,M,P);else{var me=$y(H);S(M,H[Wm],JT(H,s),me)}}return D.onerror=function(H){S(M,s?D[Wm]:400,JT(D,s),s?Po:Xy(D)),z&&z(H)},D.ontimeout=function(){S(M,s?D[Wm]:500,JT(D,s),s?Po:Xy(D)),O&&O(!1)},D.send(P[Fh]),j}function T(P,M,I){var j,O=P[hm],z=P[Fh],B=s?z:new Blob([z],{type:"application/json"}),L,D,W,H=new Headers,K=z[_t],oe=!1,me=!1,Se=P[HT]||{},Te=(j={method:m1,body:B},j[TO]=!0,j);P.headers&&Ha(P.headers)[_t]>0&&(Ze(Ha(Se),function(Y){H.append(Y,Se[Y])}),Te[HT]=H),m&&s&&(Te.credentials="include"),I&&(Te.keepalive=!0,e+=K,s?P._sendReason===2&&(oe=!0,p&&(O+=KO)):oe=!0);var G=new Request(O,Te);try{G[TO]=!0}catch{}if(!I&&t&&(L=Rc(function(Y,Ne){D=Y,W=Ne})),!O){w(M),D&&D(!1);return}function he(Y){S(M,s?0:400,{},s?Po:Y)}function ve(Y,Ne,Re){var Ve=Y[Wm],Ue=o.fetchOnComplete;Ue&&mt(Ue)?Ue(Y,M,Re||Po,Ne):S(M,Ve,{},Re||Po)}try{_p(fetch(s?O:G,s?Te:null),function(Y){if(I&&(e-=K,K=0),!me)if(me=!0,Y.rejected)he(Y.reason&&Y.reason[Bu]),W&&W(Y.reason);else{var Ne=Y.value;try{!s&&!Ne.ok?(he(Ne.statusText),D&&D(!1)):s&&!Ne.body?(ve(Ne,null,Po),D&&D(!0)):_p(Ne.text(),function(Re){ve(Ne,P,Re.value),D&&D(!0)})}catch(Re){he(Ke(Re)),W&&W(Re)}}})}catch(Y){me||(he(Ke(Y)),W&&W(Y))}return oe&&!me&&(me=!0,S(M,200,{}),D&&D(!0)),s&&!me&&P[uh]>0&&_&&_.set(function(){me||(me=!0,S(M,500,{}),D&&D(!0))},P[uh]),L}function R(P,M,I){var j=Vi(),O=new XDomainRequest,z=P[Fh];O.onload=function(){var H=$y(O),K=o&&o.xdrOnComplete;K&&mt(K)?K(O,M,P):S(M,200,{},H)},O.onerror=function(){S(M,400,{},s?Po:nB(O))},O.ontimeout=function(){S(M,500,{})},O.onprogress=function(){};var B=j&&j.location&&j.location[Kz]||"",L=P[hm];if(!L){w(M);return}if(!s&&L.lastIndexOf(B,0)!==0){var D="Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol.";He(i,2,40,". "+D),x(D,M);return}var W=s?L:L[Hu](/^(https?:)/,"");O.open(m1,W),P[uh]&&(O[uh]=P[uh]),O.send(z),s&&I?_&&_.set(function(){O.send(z)},0):O.send(z)}function $(){e=0,r=!1,t=!1,i=null,s=null,o=null,a=null,l=null,c=!1,u=!1,h=!1,f=!1,p=!1,_=null}})}return n.__ieDyn=1,n}(),MB="on",$O="attachEvent",XO="addEventListener",qO="detachEvent",ZO="removeEventListener",P2="events",k2="visibilitychange",CS="pagehide",RB="unload",NB="beforeunload",IB=Gs("aiEvtPageHide");Gs("aiEvtPageShow");var die=/\.[\.]+/g,hie=/[\.]+$/,fie=1,iw=fB("events"),pie=/^([^.]*)(?:\.(.+)|)/;function QO(n){return n&&n[Hu]?n[Hu](/^[\s\.]+|(?=[\s\.])[\.\s]+$/g,zt):n}function cN(n,e){var t;if(e){var r=zt;Dt(e)?(r=zt,Ze(e,function(s){s=QO(s),s&&(s[0]!=="."&&(s="."+s),r+=s)})):r=QO(e),r&&(r[0]!=="."&&(r="."+r),n=(n||zt)+r)}var i=pie.exec(n||zt)||[];return t={},t[Wa]=i[1],t.ns=(i[2]||zt).replace(die,".").replace(hie,zt)[vp](".").sort().join("."),t}function PB(n,e,t){t===void 0&&(t=!0);var r=iw.get(n,P2,{},t),i=r[e];return i||(i=r[e]=[]),i}function kB(n,e,t,r){n&&e&&e[Wa]&&(n[ZO]?n[ZO](e[Wa],t,r):n[qO]&&n[qO](MB+e[Wa],t))}function mie(n,e,t,r){var i=!1;return n&&e&&e[Wa]&&t&&(n[XO]?(n[XO](e[Wa],t,r),i=!0):n[$O]&&(n[$O](MB+e[Wa],t),i=!0)),i}function JO(n,e,t,r){for(var i=e[_t];i--;){var s=e[i];s&&(!t.ns||t.ns===s.evtName.ns)&&(!r||r(s))&&(kB(n,s.evtName,s[ZR],s.capture),e[Fp](i,1))}}function gie(n,e,t){if(e[Wa])JO(n,PB(n,e[Wa]),e,t);else{var r=iw.get(n,P2,{});Pt(r,function(i,s){JO(n,s,e,t)}),Ha(r)[_t]===0&&iw.kill(n,P2)}}function Uc(n,e){var t;return e?(Dt(e)?t=[n].concat(e):t=[n,e],t=cN("xx",t).ns[vp](".")):t=n,t}function Ya(n,e,t,r,i){var s;i===void 0&&(i=!1);var o=!1;if(n)try{var a=cN(e,r);if(o=mie(n,a,t,i),o&&iw.accept(n)){var l=(s={guid:fie++,evtName:a},s[ZR]=t,s.capture=i,s);PB(n,a.type)[en](l)}}catch{}return o}function Uf(n,e,t,r,i){if(i===void 0&&(i=!1),n)try{var s=cN(e,r),o=!1;gie(n,s,function(a){return s.ns&&!t||a[ZR]===t?(o=!0,!0):!1}),o||kB(n,s,t,i)}catch{}}function vie(n,e,t){var r=!1,i=Vi();i&&(r=Ya(i,n,e,t),r=Ya(i.body,n,e,t)||r);var s=ii();return s&&(r=Ya(s,n,e,t)||r),r}function _ie(n,e,t){var r=Vi();r&&(Uf(r,n,e,t),Uf(r.body,n,e,t));var i=ii();i&&Uf(i,n,e,t)}function sw(n,e,t,r){var i=!1;return e&&n&&n[_t]>0&&Ze(n,function(s){s&&(!t||ci(t,s)===-1)&&(i=vie(s,e,r)||i)}),i}function xie(n,e,t,r){var i=!1;return e&&n&&Dt(n)&&(i=sw(n,e,t,r),!i&&t&&t[_t]>0&&(i=sw(n,e,null,r))),i}function L2(n,e,t){n&&Dt(n)&&Ze(n,function(r){r&&_ie(r,e,t)})}function yie(n,e,t){return xie([NB,RB,CS],n,e,t)}function wie(n,e){L2([NB,RB,CS],n,e)}function O2(n,e,t){function r(o){var a=ii();n&&a&&a.visibilityState==="hidden"&&n(o)}var i=Uc(IB,t),s=sw([CS],n,e,i);return(!e||ci(e,k2)===-1)&&(s=sw([k2],r,e,i)||s),!s&&e&&(s=O2(n,null,t)),s}function Sie(n,e){var t=Uc(IB,e);L2([CS],n,t),L2([k2],null,t)}var eD="_aiHooks",tD=["req","rsp","hkErr","fnErr"];function uN(n,e){if(n)for(var t=0;t<n[_t]&&!e(n[t],t);t++);}function g1(n,e,t,r,i){i>=0&&i<=2&&uN(n,function(s,o){var a=s.cbks,l=a[tD[i]];if(l){e.ctx=function(){var h=r[o]=r[o]||{};return h};try{l[pd](e.inst,t)}catch(h){var c=e.err;try{var u=a[tD[2]];u&&(e.err=h,u[pd](e.inst,t))}catch{}finally{e.err=c}}}})}function Eie(n){return function(){var e,t=this,r=arguments,i=n.h,s=(e={},e[Va]=n.n,e.inst=t,e.ctx=null,e.set=c,e),o=[],a=l([s],r);s.evt=cr("event");function l(h,f){return uN(f,function(p){h[en](p)}),h}function c(h,f){r=l([],r),r[h]=f,a=l([s],r)}g1(i,s,a,o,0);var u=n.f;if(u)try{s.rslt=u[pd](t,r)}catch(h){throw s.err=h,g1(i,s,a,o,3),h}return g1(i,s,a,o,1),s.rslt}}function dN(n,e,t,r){var i=null;return n&&(Vs(n,e)?i=n:t&&(i=dN(Pne(n),e,r,!1))),i}function Tie(n,e,t){return n?D2(n[Qo],e,t,!1):null}function LB(n,e,t,r){var i=t&&t[eD];if(!i){i={i:0,n:e,f:t,h:[]};var s=Eie(i);s[eD]=i,n[e]=s}var o={id:i.i,cbks:r,rm:function(){var a=this.id;uN(i.h,function(l,c){if(l.id===a)return i.h[Fp](c,1),1})}};return i.i++,i.h[en](o),o}function D2(n,e,t,r,i){if(r===void 0&&(r=!0),n&&e&&t){var s=dN(n,e,r,i);if(s){var o=s[e];if(typeof o===Bz)return LB(s,e,o,t)}}return null}function d_(n,e,t,r,i){if(n&&e&&t){var s=dN(n,e,r,i)||n;if(s)return LB(s,e,s[e],t)}return null}var h_="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",OB="sampleRate",v1="ProcessLegacy",nD="http.method",hN="https://dc.services.visualstudio.com",bg="/v2/track",aa="not_specified",_1="iKey",cn=pne({requestContextHeader:[0,"Request-Context"],requestContextTargetKey:[1,"appId"],requestContextAppIdFormat:[2,"appId=cid-v1:"],requestIdHeader:[3,"Request-Id"],traceParentHeader:[4,"traceparent"],traceStateHeader:[5,"tracestate"],sdkContextHeader:[6,"Sdk-Context"],sdkContextHeaderAppIdRequest:[7,"appId"],requestContextHeaderLowerCase:[8,"request-context"]}),yp="split",xt="length",hv="toLowerCase",Zc="ingestionendpoint",wp="toString",bS="push",fN="removeItem",Eo="name",nc="message",zh="count",x1="preTriggerDate",y1="disabled",w1="interval",rD="daysOfMonth",S1="date",E1="getUTCDate",ow="stringify",T1="pathname",iD="correlationHeaderExcludePatterns",fh="exceptions",Zs="parsedStack",$o="properties",Ka="measurements",Ff="sizeInBytes",Sa="typeName",qm="severityLevel",C1="problemGroup",b1="isManual",DB="CreateFromInterface",gf="assembly",wu="fileName",ux="hasFullStack",f_="level",ph="method",mm="line",aw="duration",sD="receivedResponse";function UB(n,e,t){var r=e[xt],i=Cie(n,e);if(i[xt]!==r){for(var s=0,o=i;t[o]!==void 0;)s++,o=Co(i,0,147)+Mie(s);i=o}return i}function Cie(n,e){var t;return e&&(e=or(Di(e)),e[xt]>150&&(t=Co(e,0,150),He(n,2,57,"name is too long.  It has been truncated to 150 characters.",{name:e},!0))),t||e}function lr(n,e,t){t===void 0&&(t=1024);var r;return e&&(t=t||1024,e=or(Di(e)),e[xt]>t&&(r=Co(e,0,t),He(n,2,61,"string value is too long. It has been truncated to "+t+" characters.",{value:e},!0))),r||e}function AS(n,e){return jB(n,e,2048,66)}function FB(n,e){var t;return e&&e[xt]>32768&&(t=Co(e,0,32768),He(n,2,56,"message is too long, it has been truncated to 32768 characters.",{message:e},!0)),t||e}function bie(n,e){var t;if(e){var r=""+e;r[xt]>32768&&(t=Co(r,0,32768),He(n,2,52,"exception is too long, it has been truncated to 32768 characters.",{exception:e},!0))}return t||e}function Md(n,e){if(e){var t={};Pt(e,function(r,i){if(Wi(i)&&jv())try{i=wo()[ow](i)}catch(s){He(n,2,49,"custom property is not valid",{exception:s},!0)}i=lr(n,i,8192),r=UB(n,r,t),t[r]=i}),e=t}return e}function Rd(n,e){if(e){var t={};Pt(e,function(r,i){r=UB(n,r,t),t[r]=i}),e=t}return e}function Aie(n,e){return e&&jB(n,e,128,69)[wp]()}function jB(n,e,t,r){var i;return e&&(e=or(Di(e)),e[xt]>t&&(i=Co(e,0,t),He(n,2,r,"input is too long, it has been truncated to "+t+" characters.",{data:e},!0))),i||e}function Mie(n){var e="00"+n;return Bl(e,e[xt]-3)}var oD=ii()||{},aD=0,Rie=[null,null,null,null,null];function pN(n){var e=aD,t=Rie,r=t[e];return oD.createElement?t[e]||(r=t[e]=oD.createElement("a")):r={host:Pie(n,!0)},r.href=n,e++,e>=t[xt]&&(e=0),aD=e,r}function Nie(n){var e,t=pN(n);return t&&(e=t.href),e}function Iie(n,e){return n?n.toUpperCase()+" "+e:e}function Pie(n,e){var t=zB(n,e)||"";if(t){var r=t.match(/(www\d{0,5}\.)?([^\/:]{1,256})(:\d{1,20})?/i);if(r!=null&&r[xt]>3&&ht(r[2])&&r[2][xt]>0)return r[2]+(r[3]||"")}return t}function zB(n,e){var t=null;if(n){var r=n.match(/(\w{1,150}):\/\/([^\/:]{1,256})(:\d{1,20})?/i);if(r!=null&&r[xt]>2&&ht(r[2])&&r[2][xt]>0&&(t=r[2]||"",e&&r[xt]>2)){var i=(r[1]||"")[hv](),s=r[3]||"";(i==="http"&&s===":80"||i==="https"&&s===":443")&&(s=""),t+=s}}return t}var kie=[hN+bg,"https://breeze.aimon.applicationinsights.io"+bg,"https://dc-int.services.visualstudio.com"+bg],Lie="cid-v1:";function U2(n){return ci(kie,n[hv]())!==-1}function lD(n,e,t){if(!e||n&&n.disableCorrelationHeaders)return!1;if(n&&n[iD]){for(var r=0;r<n.correlationHeaderExcludePatterns[xt];r++)if(n[iD][r].test(e))return!1}var i=pN(e).host[hv]();if(i&&(Fi(i,":443")!==-1||Fi(i,":80")!==-1)&&(i=(zB(e,!0)||"")[hv]()),(!n||!n.enableCorsCorrelation)&&i&&i!==t)return!1;var s=n&&n.correlationHeaderDomains;if(s){var o;if(Ze(s,function(c){var u=new RegExp(c.toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"));o=o||u.test(i)}),!o)return!1}var a=n&&n.correlationHeaderExcludedDomains;if(!a||a[xt]===0)return!0;for(var r=0;r<a[xt];r++){var l=new RegExp(a[r].toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"));if(l.test(i))return!1}return i&&i[xt]>0}function cD(n){if(n){var e=Oie(n,cn[1]);if(e&&e!==Lie)return e}}function Oie(n,e){if(n)for(var t=n[yp](","),r=0;r<t[xt];++r){var i=t[r][yp]("=");if(i[xt]===2&&i[0]===e)return i[1]}}function Die(n,e,t,r){var i,s=r,o=r;if(e&&e[xt]>0){var a=pN(e);if(i=a.host,!s)if(a[T1]!=null){var l=a.pathname[xt]===0?"/":a[T1];l.charAt(0)!=="/"&&(l="/"+l),o=a[T1],s=lr(n,t?t+" "+l:l)}else s=lr(n,e)}else i=r,s=r;return{target:i,name:s,data:o}}function p_(){var n=nl();if(n&&n.now&&n.timing){var e=n.now()+n.timing.navigationStart;if(e>0)return e}return sa()}function Mi(n,e){var t=null;return n!==0&&e!==0&&!Ae(n)&&!Ae(e)&&(t=e-n),t}function mN(n,e){var t=n||{};return{getName:function(){return t[Eo]},setName:function(r){e&&e.setName(r),t[Eo]=r},getTraceId:function(){return t.traceID},setTraceId:function(r){e&&e.setTraceId(r),sN(r)&&(t.traceID=r)},getSpanId:function(){return t.parentID},setSpanId:function(r){e&&e.setSpanId(r),oN(r)&&(t.parentID=r)},getTraceFlags:function(){return t.traceFlags},setTraceFlags:function(r){e&&e.setTraceFlags(r),t.traceFlags=r}}}var Bv=fne({LocalStorage:0,SessionStorage:1}),xc=void 0,yc=void 0,BB="";function gN(){return RS()?MS(Bv.LocalStorage):null}function MS(n){try{if(Ae(js()))return null;var e=new Date()[wp](),t=cr(n===Bv.LocalStorage?"localStorage":"sessionStorage"),r=BB+e;t.setItem(r,e);var i=t.getItem(r)!==e;if(t[fN](r),!i)return t}catch{}return null}function vN(){return fv()?MS(Bv.SessionStorage):null}function Uie(){xc=!1,yc=!1}function _N(n){BB=n||""}function Fie(){xc=RS(!0),yc=fv(!0)}function RS(n){return(n||xc===void 0)&&(xc=!!MS(Bv.LocalStorage)),xc}function HB(n,e){var t=gN();if(t!==null)try{return t.getItem(e)}catch(r){xc=!1,He(n,2,1,"Browser failed read of local storage. "+Zt(r),{exception:Ke(r)})}return null}function VB(n,e,t){var r=gN();if(r!==null)try{return r.setItem(e,t),!0}catch(i){xc=!1,He(n,2,3,"Browser failed write to local storage. "+Zt(i),{exception:Ke(i)})}return!1}function jie(n,e){var t=gN();if(t!==null)try{return t[fN](e),!0}catch(r){xc=!1,He(n,2,5,"Browser failed removal of local storage item. "+Zt(r),{exception:Ke(r)})}return!1}function fv(n){return(n||yc===void 0)&&(yc=!!MS(Bv.SessionStorage)),yc}function F2(n,e){var t=vN();if(t!==null)try{return t.getItem(e)}catch(r){yc=!1,He(n,2,2,"Browser failed read of session storage. "+Zt(r),{exception:Ke(r)})}return null}function GB(n,e,t){var r=vN();if(r!==null)try{return r.setItem(e,t),!0}catch(i){yc=!1,He(n,2,4,"Browser failed write to session storage. "+Zt(i),{exception:Ke(i)})}return!1}function zie(n,e){var t=vN();if(t!==null)try{return t[fN](e),!0}catch(r){yc=!1,He(n,2,6,"Browser failed removal of session storage item. "+Zt(r),{exception:Ke(r)})}return!1}var Bie="appInsightsThrottle",Hie=function(){function n(e,t){var r=this,i,s,o,a,l,c,u,h=!1,f=!1;_(),r._getDbgPlgTargets=function(){return[u]},r.getConfig=function(){return o},r.canThrottle=function(M){var I=R(M),j=y(M);return v(j,i,I)},r.isTriggered=function(M){return $(M)},r.isReady=function(){return h},r.flush=function(M){try{var I=P(M);if(I&&I[xt]>0){var j=I.slice(0);return u[M]=[],Ze(j,function(O){p(O.msgID,O[nc],O.severity,!1)}),!0}}catch{}return!1},r.flushAll=function(){try{if(u){var M=!0;return Pt(u,function(I){var j=r.flush(parseInt(I));M=M&&j}),M}}catch{}return!1},r.onReadyState=function(M,I){return I===void 0&&(I=!0),h=Ae(M)?!0:M,h&&I?r.flushAll():null},r.sendMessage=function(M,I,j){return p(M,I,j,!0)};function p(M,I,j,O){if(h){var z=T(M);if(!z)return;var B=y(M),L=R(M),D=v(B,i,L),W=!1,H=0,K=$(M);try{D&&!K?(H=Math.min(B.limit.maxSendNumber,L[zh]+1),L[zh]=0,W=!0,l[M]=!0,L[x1]=new Date):(l[M]=D,L[zh]+=1);var oe=x(M);C(s,oe,L);for(var me=0;me<H;me++)k(M,s,I,j)}catch{}return{isThrottled:W,throttleNum:H}}else if(O){var Se=P(M);Se[bS]({msgID:M,message:I,severity:j})}return null}function _(){s=Ad(e),l={},a={},u={},o={},g(109),c=Of(t)?t:"",e.addUnloadHook(Jn(e.config,function(M){var I=M.cfg;i=RS();var j=I.throttleMgrCfg||{};Pt(j,function(O,z){g(parseInt(O),z)})}))}function y(M){return o[M]||o[109]}function g(M,I){var j,O;try{var z=I||{},B={};B[y1]=!!z[y1];var L=z[w1]||{};f=(L==null?void 0:L.daysOfMonth)&&(L==null?void 0:L.daysOfMonth[xt])>0,B[w1]=m(L);var D={samplingRate:((j=z.limit)===null||j===void 0?void 0:j.samplingRate)||100,maxSendNumber:((O=z.limit)===null||O===void 0?void 0:O.maxSendNumber)||1};B.limit=D,o[M]=B}catch{}}function m(M){M=M||{};var I=M==null?void 0:M.monthInterval,j=M==null?void 0:M.dayInterval;return Ae(I)&&Ae(j)&&(M.monthInterval=3,f||(M[rD]=[28],f=!0)),M={monthInterval:M==null?void 0:M.monthInterval,dayInterval:M==null?void 0:M.dayInterval,daysOfMonth:M==null?void 0:M.daysOfMonth},M}function v(M,I,j){if(M&&!M[y1]&&I&&Of(j)){var O=S(),z=j[S1],B=M[w1],L=1;if(B!=null&&B.monthInterval){var D=(O.getUTCFullYear()-z.getUTCFullYear())*12+O.getUTCMonth()-z.getUTCMonth();L=A(B.monthInterval,0,D)}var W=1;if(f)W=ci(B[rD],O[E1]());else if(B!=null&&B.dayInterval){var H=Math.floor((O.getTime()-z.getTime())/864e5);W=A(B.dayInterval,0,H)}return L>=0&&W>=0}return!1}function x(M,I){var j=Of(I)?I:"";return M?Bie+j+"-"+M:null}function w(M){try{if(M){var I=new Date;return M.getUTCFullYear()===I.getUTCFullYear()&&M.getUTCMonth()===I.getUTCMonth()&&M[E1]()===I[E1]()}}catch{}return!1}function E(M,I,j){try{var O={date:S(),count:0};if(M){var z=JSON.parse(M),B={date:S(z[S1])||O[S1],count:z[zh]||O[zh],preTriggerDate:z.preTriggerDate?S(z[x1]):void 0};return B}else return C(I,j,O),O}catch{}return null}function S(M){try{if(M){var I=new Date(M);if(!isNaN(I.getDate()))return I}else return new Date}catch{}return null}function C(M,I,j){try{return VB(M,I,or(JSON[ow](j)))}catch{}return!1}function A(M,I,j){return M<=0?1:j>=I&&(j-I)%M==0?Math.floor((j-I)/M)+1:-1}function k(M,I,j,O){He(I,O||1,M,j)}function T(M){try{var I=y(M);return sre(1e6)<=I.limit.samplingRate}catch{}return!1}function R(M){try{var I=a[M];if(!I){var j=x(M,c);I=E(HB(s,j),s,j),a[M]=I}return a[M]}catch{}return null}function $(M){var I=l[M];if(Ae(I)){I=!1;var j=R(M);j&&(I=w(j[x1])),l[M]=I}return l[M]}function P(M){return u=u||{},Ae(u[M])&&(u[M]=[]),u[M]}}return n}(),Vie=";",Gie="=";function Wie(n){if(!n)return{};var e=n[yp](Vie),t=Fte(e,function(i,s){var o=s[yp](Gie);if(o[xt]===2){var a=o[0][hv](),l=o[1];i[a]=l}return i},{});if(Ha(t)[xt]>0){if(t.endpointsuffix){var r=t.location?t.location+".":"";t[Zc]=t[Zc]||"https://"+r+"dc."+t.endpointsuffix}t[Zc]=t[Zc]||hN,Fz(t[Zc],"/")&&(t[Zc]=t[Zc].slice(0,-1))}return t}var Yie=function(){function n(e,t,r){var i=this,s=this;s.ver=1,s.sampleRate=100,s.tags={},s[Eo]=lr(e,r)||aa,s.data=t,s.time=xp(new Date),s.aiDataContract={time:1,iKey:1,name:1,sampleRate:function(){return i.sampleRate===100?4:1},tags:1,data:1}}return n}(),Gl=function(){function n(e,t,r,i){this.aiDataContract={ver:1,name:1,properties:0,measurements:0};var s=this;s.ver=2,s[Eo]=lr(e,t)||aa,s[$o]=Md(e,r),s[Ka]=Rd(e,i)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Event",n.dataType="EventData",n}(),Kie="<no_method>",jf="error",Ri="stack",j2="stackDetails",uD="errorSrc",z2="message",WB="description";function B2(n,e){var t=n;return t&&!ht(t)&&(JSON&&JSON[ow]?(t=JSON[ow](n),e&&(!t||t==="{}")&&(mt(n[wp])?t=n[wp]():t=""+n)):t=""+n+" - (Missing JSON.stringify)"),t||""}function YB(n,e){var t=n;return n&&(t&&!ht(t)&&(t=n[z2]||n[WB]||t),t&&!ht(t)&&(t=B2(t,!0)),n.filename&&(t=t+" @"+(n.filename||"")+":"+(n.lineno||"?")+":"+(n.colno||"?"))),e&&e!=="String"&&e!=="Object"&&e!=="Error"&&Fi(t||"",e)===-1&&(t=e+": "+t),t||""}function $ie(n){try{if(Wi(n))return"hasFullStack"in n&&"typeName"in n}catch{}return!1}function Xie(n){try{if(Wi(n))return"ver"in n&&"exceptions"in n&&"properties"in n}catch{}return!1}function dD(n){return n&&n.src&&ht(n.src)&&n.obj&&Dt(n.obj)}function Qc(n){var e=n||"";ht(e)||(ht(e[Ri])?e=e[Ri]:e=""+e);var t=e[yp](`
`);return{src:e,obj:t}}function qie(n){for(var e=[],t=n[yp](`
`),r=0;r<t[xt];r++){var i=t[r];t[r+1]&&(i+="@"+t[r+1],r++),e[bS](i)}return{src:n,obj:e}}function KB(n){var e=null;if(n)try{if(n[Ri])e=Qc(n[Ri]);else if(n[jf]&&n[jf][Ri])e=Qc(n[jf][Ri]);else if(n.exception&&n.exception[Ri])e=Qc(n.exception[Ri]);else if(dD(n))e=n;else if(dD(n[j2]))e=n[j2];else if(Vi()&&Vi().opera&&n[z2])e=qie(n[nc]);else if(n.reason&&n.reason[Ri])e=Qc(n.reason[Ri]);else if(ht(n))e=Qc(n);else{var t=n[z2]||n[WB]||"";ht(n[uD])&&(t&&(t+=`
`),t+=" from "+n[uD]),t&&(e=Qc(t))}}catch(r){e=Qc(r)}return e||{src:"",obj:null}}function Zie(n){var e="";return n&&(n.obj?Ze(n.obj,function(t){e+=t+`
`}):e=n.src||""),e}function Qie(n){var e,t=n.obj;if(t&&t[xt]>0){e=[];var r=0,i=0;Ze(t,function(_){var y=_[wp]();if(H2.regex.test(y)){var g=new H2(y,r++);i+=g[Ff],e[bS](g)}});var s=32*1024;if(i>s)for(var o=0,a=e[xt]-1,l=0,c=o,u=a;o<a;){var h=e[o][Ff],f=e[a][Ff];if(l+=h+f,l>s){var p=u-c+1;e.splice(c,p);break}c=o,u=a,o++,a--}}return e}function lw(n){var e="";if(n&&(e=n.typeName||n[Eo]||"",!e))try{var t=/function (.{1,200})\(/,r=t.exec(n.constructor[wp]());e=r&&r[xt]>1?r[1]:""}catch{}return e}function A1(n){if(n)try{if(!ht(n)){var e=lw(n),t=B2(n,!1);return(!t||t==="{}")&&(n[jf]&&(n=n[jf],e=lw(n)),t=B2(n,!0)),Fi(t,e)!==0&&e!=="String"?e+":"+t:t}}catch{}return""+(n||"")}var Rs=function(){function n(e,t,r,i,s,o){this.aiDataContract={ver:1,exceptions:1,severityLevel:0,properties:0,measurements:0};var a=this;a.ver=2,Xie(t)?(a[fh]=t[fh]||[],a[$o]=t[$o],a[Ka]=t[Ka],t[qm]&&(a[qm]=t[qm]),t.id&&(a.id=t.id,t[$o].id=t.id),t[C1]&&(a[C1]=t[C1]),Ae(t[b1])||(a[b1]=t[b1])):(r||(r={}),o&&(r.id=o),a[fh]=[new hD(e,t,r)],a[$o]=Md(e,r),a[Ka]=Rd(e,i),s&&(a[qm]=s),o&&(a.id=o))}return n.CreateAutoException=function(e,t,r,i,s,o,a,l){var c,u=lw(s||o||e);return c={},c[nc]=YB(e,u),c.url=t,c.lineNumber=r,c.columnNumber=i,c.error=A1(s||o||e),c.evt=A1(o||e),c[Sa]=u,c.stackDetails=KB(a||s||o),c.errorSrc=l,c},n.CreateFromInterface=function(e,t,r,i){var s=t[fh]&&Sg(t[fh],function(a){return hD[DB](e,a)}),o=new n(e,yi(yi({},t),{exceptions:s}),r,i);return o},n.prototype.toInterface=function(){var e,t=this,r=t.exceptions,i=t.properties,s=t.measurements,o=t.severityLevel,a=t.problemGroup,l=t.id,c=t.isManual,u=r instanceof Array&&Sg(r,function(h){return h.toInterface()})||void 0;return e={ver:"4.0"},e[fh]=u,e.severityLevel=o,e.properties=i,e.measurements=s,e.problemGroup=a,e.id=l,e.isManual=c,e},n.CreateSimpleException=function(e,t,r,i,s,o){var a;return{exceptions:[(a={},a[ux]=!0,a.message=e,a.stack=s,a.typeName=t,a)]}},n.envelopeType="Microsoft.ApplicationInsights.{0}.Exception",n.dataType="ExceptionData",n.formatError=A1,n}(),hD=function(){function n(e,t,r){this.aiDataContract={id:0,outerId:0,typeName:1,message:1,hasFullStack:0,stack:0,parsedStack:2};var i=this;if($ie(t))i[Sa]=t[Sa],i[nc]=t[nc],i[Ri]=t[Ri],i[Zs]=t[Zs]||[],i[ux]=t[ux];else{var s=t,o=s&&s.evt;OR(s)||(s=s[jf]||o||s),i[Sa]=lr(e,lw(s))||aa,i[nc]=FB(e,YB(t||s,i[Sa]))||aa;var a=t[j2]||KB(t);i[Zs]=Qie(a),Dt(i[Zs])&&Sg(i[Zs],function(l){l[gf]=lr(e,l[gf]),l[wu]=lr(e,l[wu])}),i[Ri]=bie(e,Zie(a)),i.hasFullStack=Dt(i.parsedStack)&&i.parsedStack[xt]>0,r&&(r[Sa]=r[Sa]||i[Sa])}}return n.prototype.toInterface=function(){var e,t=this,r=t[Zs]instanceof Array&&Sg(t[Zs],function(s){return s.toInterface()}),i=(e={id:t.id,outerId:t.outerId,typeName:t[Sa],message:t[nc],hasFullStack:t[ux],stack:t[Ri]},e[Zs]=r||void 0,e);return i},n.CreateFromInterface=function(e,t){var r=t[Zs]instanceof Array&&Sg(t[Zs],function(s){return H2[DB](s)})||t[Zs],i=new n(e,yi(yi({},t),{parsedStack:r}));return i},n}(),H2=function(){function n(e,t){this.aiDataContract={level:1,method:1,assembly:0,fileName:0,line:0};var r=this;if(r[Ff]=0,typeof e=="string"){var i=e;r[f_]=t,r[ph]=Kie,r[gf]=or(i),r[wu]="",r[mm]=0;var s=i.match(n.regex);s&&s[xt]>=5&&(r[ph]=or(s[2])||r[ph],r[wu]=or(s[4]),r[mm]=parseInt(s[5])||0)}else r[f_]=e[f_],r[ph]=e[ph],r[gf]=e[gf],r[wu]=e[wu],r[mm]=e[mm],r[Ff]=0;r.sizeInBytes+=r.method[xt],r.sizeInBytes+=r.fileName[xt],r.sizeInBytes+=r.assembly[xt],r[Ff]+=n.baseSize,r.sizeInBytes+=r.level.toString()[xt],r.sizeInBytes+=r.line.toString()[xt]}return n.CreateFromInterface=function(e){return new n(e,null)},n.prototype.toInterface=function(){var e=this;return{level:e[f_],method:e[ph],assembly:e[gf],fileName:e[wu],line:e[mm]}},n.regex=/^([\s]+at)?[\s]{0,50}([^\@\()]+?)[\s]{0,50}(\@|\()([^\(\n]+):([0-9]+):([0-9]+)(\)?)$/,n.baseSize=58,n}(),Jie=function(){function n(){this.aiDataContract={name:1,kind:0,value:1,count:0,min:0,max:0,stdDev:0},this.kind=0}return n}(),Wu=function(){function n(e,t,r,i,s,o,a,l,c){this.aiDataContract={ver:1,metrics:1,properties:0};var u=this;u.ver=2;var h=new Jie;h[zh]=i>0?i:void 0,h.max=isNaN(o)||o===null?void 0:o,h.min=isNaN(s)||s===null?void 0:s,h[Eo]=lr(e,t)||aa,h.value=r,h.stdDev=isNaN(a)||a===null?void 0:a,u.metrics=[h],u[$o]=Md(e,l),u[Ka]=Rd(e,c)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Metric",n.dataType="MetricData",n}(),gm="";function Wl(n){(isNaN(n)||n<0)&&(n=0),n=Math.round(n);var e=gm+n%1e3,t=gm+Math.floor(n/1e3)%60,r=gm+Math.floor(n/(1e3*60))%60,i=gm+Math.floor(n/(1e3*60*60))%24,s=Math.floor(n/(1e3*60*60*24));return e=e[xt]===1?"00"+e:e[xt]===2?"0"+e:e,t=t[xt]<2?"0"+t:t,r=r[xt]<2?"0"+r:r,i=i[xt]<2?"0"+i:i,(s>0?s+".":gm)+i+":"+r+":"+t+"."+e}function ese(n,e,t,r,i){return!i&&ht(n)&&(n==="Script error."||n==="Script error")}var wc=function(){function n(e,t,r,i,s,o,a){this.aiDataContract={ver:1,name:0,url:0,duration:0,properties:0,measurements:0,id:0};var l=this;l.ver=2,l.id=Aie(e,a),l.url=AS(e,r),l[Eo]=lr(e,t)||aa,isNaN(i)||(l[aw]=Wl(i)),l[$o]=Md(e,s),l[Ka]=Rd(e,o)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Pageview",n.dataType="PageviewData",n}(),Yu=function(){function n(e,t,r,i,s,o,a,l,c,u,h,f){c===void 0&&(c="Ajax"),this.aiDataContract={id:1,ver:1,name:0,resultCode:0,duration:0,success:0,data:0,target:0,type:0,properties:0,measurements:0,kind:0,value:0,count:0,min:0,max:0,stdDev:0,dependencyKind:0,dependencySource:0,commandName:0,dependencyTypeName:0};var p=this;p.ver=2,p.id=t,p[aw]=Wl(s),p.success=o,p.resultCode=a+"",p.type=lr(e,c);var _=Die(e,r,l,i);p.data=AS(e,i)||_.data,p.target=lr(e,_.target),u&&(p.target="".concat(p.target," | ").concat(u)),p[Eo]=lr(e,_[Eo]),p[$o]=Md(e,h),p[Ka]=Rd(e,f)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.RemoteDependency",n.dataType="RemoteDependencyData",n}(),zf=function(){function n(e,t,r,i,s){this.aiDataContract={ver:1,message:1,severityLevel:0,properties:0};var o=this;o.ver=2,t=t||aa,o[nc]=FB(e,t),o[$o]=Md(e,i),o[Ka]=Rd(e,s),r&&(o[qm]=r)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.Message",n.dataType="MessageData",n}(),Bf=function(){function n(e,t,r,i,s,o,a){this.aiDataContract={ver:1,name:0,url:0,duration:0,perfTotal:0,networkConnect:0,sentRequest:0,receivedResponse:0,domProcessing:0,properties:0,measurements:0};var l=this;l.ver=2,l.url=AS(e,r),l[Eo]=lr(e,t)||aa,l[$o]=Md(e,s),l[Ka]=Rd(e,o),a&&(l.domProcessing=a.domProcessing,l[aw]=a[aw],l.networkConnect=a.networkConnect,l.perfTotal=a.perfTotal,l[sD]=a[sD],l.sentRequest=a.sentRequest)}return n.envelopeType="Microsoft.ApplicationInsights.{0}.PageviewPerformance",n.dataType="PageviewPerformanceData",n}(),Nd=function(){function n(e,t){this.aiDataContract={baseType:1,baseData:1},this.baseType=e,this.baseData=t}return n}();function Fc(n){var e="ai."+n+".";return function(t){return e+t}}var vm=Fc("application"),ur=Fc("device"),m_=Fc("location"),mh=Fc("operation"),M1=Fc("session"),bl=Fc("user"),Jc=Fc("cloud"),_m=Fc("internal"),$B=function(n){ul(e,n);function e(){return n.call(this)||this}return e}(Lne({applicationVersion:vm("ver"),applicationBuild:vm("build"),applicationTypeId:vm("typeId"),applicationId:vm("applicationId"),applicationLayer:vm("layer"),deviceId:ur("id"),deviceIp:ur("ip"),deviceLanguage:ur("language"),deviceLocale:ur("locale"),deviceModel:ur("model"),deviceFriendlyName:ur("friendlyName"),deviceNetwork:ur("network"),deviceNetworkName:ur("networkName"),deviceOEMName:ur("oemName"),deviceOS:ur("os"),deviceOSVersion:ur("osVersion"),deviceRoleInstance:ur("roleInstance"),deviceRoleName:ur("roleName"),deviceScreenResolution:ur("screenResolution"),deviceType:ur("type"),deviceMachineName:ur("machineName"),deviceVMName:ur("vmName"),deviceBrowser:ur("browser"),deviceBrowserVersion:ur("browserVersion"),locationIp:m_("ip"),locationCountry:m_("country"),locationProvince:m_("province"),locationCity:m_("city"),operationId:mh("id"),operationName:mh("name"),operationParentId:mh("parentId"),operationRootId:mh("rootId"),operationSyntheticSource:mh("syntheticSource"),operationCorrelationVector:mh("correlationVector"),sessionId:M1("id"),sessionIsFirst:M1("isFirst"),sessionIsNew:M1("isNew"),userAccountAcquisitionDate:bl("accountAcquisitionDate"),userAccountId:bl("accountId"),userAgent:bl("userAgent"),userId:bl("id"),userStoreRegion:bl("storeRegion"),userAuthUserId:bl("authUserId"),userAnonymousUserAcquisitionDate:bl("anonUserAcquisitionDate"),userAuthenticatedUserAcquisitionDate:bl("authUserAcquisitionDate"),cloudName:Jc("name"),cloudRole:Jc("role"),cloudRoleVer:Jc("roleVer"),cloudRoleInstance:Jc("roleInstance"),cloudEnvironment:Jc("environment"),cloudLocation:Jc("location"),cloudDeploymentUnit:Jc("deploymentUnit"),internalNodeName:_m("nodeName"),internalSdkVersion:_m("sdkVersion"),internalAgentVersion:_m("agentVersion"),internalSnippet:_m("snippet"),internalSdkSrc:_m("sdkSrc")}));function kl(n,e,t,r,i,s){var o;t=lr(r,t)||aa,(Ae(n)||Ae(e)||Ae(t))&&rs("Input doesn't contain all required fields");var a="";n[_1]&&(a=n[_1],delete n[_1]);var l=(o={},o[Eo]=t,o.time=xp(new Date),o.iKey=a,o.ext=s||{},o.tags=[],o.data={},o.baseType=e,o.baseData=n,o);return Ae(i)||Pt(i,function(c,u){l.data[c]=u}),l}var es={UserExt:"user",DeviceExt:"device",TraceExt:"trace",WebExt:"web",AppExt:"app",OSExt:"os",SessionExt:"ses",SDKExt:"sdk"},Sn=new $B;function xm(n){var e=null;if(mt(Event))e=new Event(n);else{var t=ii();t&&t.createEvent&&(e=t.createEvent("Event"),e.initEvent(n,!0,!0))}return e}function fD(n,e){Uf(n,null,null,e)}function tse(n){var e=ii(),t=ca(),r=!1,i=[],s=1;t&&!Ae(t.onLine)&&!t.onLine&&(s=2);var o=0,a=f(),l=Uc(Gs("OfflineListener"),n);try{if(u(Vi())&&(r=!0),e){var c=e.body||e;c.ononline&&u(c)&&(r=!0)}}catch{r=!1}function u(x){var w=!1;return x&&(w=Ya(x,"online",y,l),w&&Ya(x,"offline",g,l)),w}function h(){return a}function f(){return!(o===2||s===2)}function p(){var x=f();a!==x&&(a=x,Ze(i,function(w){var E={isOnline:a,rState:s,uState:o};try{w(E)}catch{}}))}function _(x){o=x,p()}function y(){s=1,p()}function g(){s=2,p()}function m(){var x=Vi();if(x&&r){if(fD(x,l),e){var w=e.body||e;bn(w.ononline)||fD(w,l)}r=!1}}function v(x){return i[bS](x),{rm:function(){var w=i.indexOf(x);if(w>-1)return i.splice(w,1)}}}return{isOnline:h,isListening:function(){return r},unload:m,addListener:v,setOnlineState:_}}var NS="AppInsightsPropertiesPlugin",XB="AppInsightsChannelPlugin",qB="ApplicationInsightsAnalytics",cw="toString",V2="isStorageUseDisabled",gh="_addHook",kr="core",Al="dataType",eu="envelopeType",qi="diagLog",tu="track",dx="trackPageView",G2="trackPreviousPageVisit",Su="sendPageViewInternal",Sp="startTime",W2="properties",Do="duration",Y2="sendPageViewPerformanceInternal",xN="populatePageViewPerformanceEvent",Bh="href",pD="sendExceptionInternal",R1="exception",ym="error",N1="_onerror",I1="errorSrc",P1="lineNumber",k1="columnNumber",mD="message",L1="CreateAutoException",g_="addTelemetryInitializer",nse="overridePageViewDuration",ZB="autoTrackPageVisitTime",QB="isBrowserLinkTrackingEnabled",pv="length",JB="enableAutoRouteTracking",eH="enableUnhandledPromiseRejectionTracking",K2="autoUnhandledPromiseInstrumented",$2="getEntriesByType",tH="isPerformanceTimingSupported",nH="getPerformanceTiming",uw="navigationStart",X2="shouldCollectDuration",rH="isPerformanceTimingDataReady",Zm="responseStart",rse="requestStart",hx="loadEventEnd",q2="responseEnd",fx="connectEnd",iH="pageVisitStartTime",ise=function(){function n(e,t,r,i){yn(n,this,function(s){var o=null,a=[],l=!1,c=!1,u;r&&(u=r.logger);function h(_){r&&r.flush(_,function(){})}function f(){o||(o=bo(function(){o=null;var _=a.slice(0),y=!1;a=[],Ze(_,function(g){g()?y=!0:a.push(g)}),a[pv]>0&&f(),y&&h(!0)},100))}function p(_){a.push(_),f()}s[dx]=function(_,y){var g=_.name;if(Ae(g)||typeof g!="string"){var m=ii();g=_.name=m&&m.title||""}var v=_.uri;if(Ae(v)||typeof v!="string"){var x=Ko();v=_.uri=x&&x[Bh]||""}if(!c){var w=nl(),E=w&&w[$2]&&w[$2]("navigation");if(E&&E[0]&&!bn(w.timeOrigin)){var S=E[0].loadEventStart;_[Sp]=new Date(w.timeOrigin+S)}else{var C=(y||_[W2]||{})[Do]||0;_[Sp]=new Date(new Date().getTime()-C)}c=!0}if(!i[tH]()){e[Su](_,y),h(!0),Nz()||He(u,2,25,"trackPageView: navigation timing API used for calculation of page duration is not supported in this browser. This page view will be collected without duration and timing info.");return}var A=!1,k,T=i[nH]()[uw];T>0&&(k=Mi(T,+new Date),i[X2](k)||(k=void 0));var R;!Ae(y)&&!Ae(y[Do])&&(R=y[Do]),(t||!isNaN(R))&&(isNaN(R)&&(y||(y={}),y[Do]=k),e[Su](_,y),h(!0),A=!0);var $=6e4;y||(y={}),p(function(){var P=!1;try{if(i[rH]()){P=!0;var M={name:g,uri:v};i[xN](M),!M.isValid&&!A?(y[Do]=k,e[Su](_,y)):(A||(y[Do]=M.durationMs,e[Su](_,y)),l||(e[Y2](M,y),l=!0))}else T>0&&Mi(T,+new Date)>$&&(P=!0,A||(y[Do]=$,e[Su](_,y)))}catch(I){He(u,1,38,"trackPageView failed on page load calculation: "+Zt(I),{exception:Ke(I)})}return P})},s.teardown=function(_,y){if(o){o.cancel(),o=null;var g=a.slice(0);a=[],Ze(g,function(m){m()})}}})}return n.__ieDyn=1,n}(),sse=36e5,gD=["googlebot","adsbot-google","apis-google","mediapartners-google"];function sH(){var n=nl();return n&&!!n.timing}function ose(){var n=nl();return n&&n.getEntriesByType&&n.getEntriesByType("navigation")[pv]>0}function ase(){var n=nl(),e=n?n.timing:0;return e&&e.domainLookupStart>0&&e[uw]>0&&e[Zm]>0&&e[rse]>0&&e[hx]>0&&e[q2]>0&&e[fx]>0&&e.domLoading>0}function vD(){return sH()?nl().timing:null}function lse(){return ose()?nl()[$2]("navigation")[0]:null}function cse(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=ca()||{},r=t.userAgent,i=!1;if(r)for(var s=0;s<gD[pv];s++)i=i||Fi(r.toLowerCase(),gD[s])!==-1;if(i)return!1;for(var s=0;s<n[pv];s++)if(n[s]<0||n[s]>=sse)return!1;return!0}var use=function(){function n(e){var t=Ad(e);yn(n,this,function(r){r[xN]=function(i){i.isValid=!1;var s=lse(),o=vD(),a=0,l=0,c=0,u=0,h=0;(s||o)&&(s?(a=s[Do],l=s[Sp]===0?s[fx]:Mi(s[Sp],s[fx]),c=Mi(s.requestStart,s[Zm]),u=Mi(s[Zm],s[q2]),h=Mi(s.responseEnd,s[hx])):(a=Mi(o[uw],o[hx]),l=Mi(o[uw],o[fx]),c=Mi(o.requestStart,o[Zm]),u=Mi(o[Zm],o[q2]),h=Mi(o.responseEnd,o[hx])),a===0?He(t,2,10,"error calculating page view performance.",{total:a,network:l,request:c,response:u,dom:h}):r[X2](a,l,c,u,h)?a<Math.floor(l)+Math.floor(c)+Math.floor(u)+Math.floor(h)?He(t,2,8,"client performance math error.",{total:a,network:l,request:c,response:u,dom:h}):(i.durationMs=a,i.perfTotal=i[Do]=Wl(a),i.networkConnect=Wl(l),i.sentRequest=Wl(c),i.receivedResponse=Wl(u),i.domProcessing=Wl(h),i.isValid=!0):He(t,2,45,"Invalid page load duration value. Browser perf data won't be sent.",{total:a,network:l,request:c,response:u,dom:h}))},r[nH]=vD,r[tH]=sH,r[rH]=ase,r[X2]=cse})}return n.__ieDyn=1,n}(),dse=function(){function n(e,t){var r="prevPageVisitData";yn(n,this,function(i){i[G2]=function(a,l){try{var c=s(a,l);c&&t(c.pageName,c.pageUrl,c.pageVisitTime)}catch(u){Vu(e,"Auto track page visit time failed, metric will not be collected: "+Ke(u))}};function s(a,l){var c=null;try{if(c=o(),fv()){F2(e,r)!=null&&rs("Cannot call startPageVisit consecutively without first calling stopPageVisit");var u=wo().stringify(new hse(a,l));GB(e,r,u)}}catch(h){Vu(e,"Call to restart failed: "+Ke(h)),c=null}return c}function o(){var a=null;try{if(fv()){var l=sa(),c=F2(e,r);c&&jv()&&(a=wo().parse(c),a.pageVisitTime=l-a[iH],zie(e,r))}}catch(u){Vu(e,"Stop page visit timer failed: "+Ke(u)),a=null}return a}Gt(i,"_logger",{g:function(){return e}}),Gt(i,"pageVisitTimeTrackingHandler",{g:function(){return t}})})}return n.__ieDyn=1,n}(),hse=function(){function n(e,t){this[iH]=sa(),this.pageName=e,this.pageUrl=t}return n}(),_D=function(){function n(e,t){var r=this,i={};r.start=function(s){typeof i[s]<"u"&&He(e,2,62,"start was called more than once for this event without calling stop.",{name:s,key:s},!0),i[s]=+new Date},r.stop=function(s,o,a,l){var c=i[s];if(isNaN(c))He(e,2,63,"stop was called without a corresponding start.",{name:s,key:s},!0);else{var u=+new Date,h=Mi(c,u);r.action(s,o,h,a,l)}delete i[s],i[s]=void 0}}return n}(),Ai,fse="event";function wm(n,e){n&&n.dispatchEvent&&e&&n.dispatchEvent(e)}function pse(n){if(n&&n.reason){var e=n.reason;return!ht(e)&&mt(e[cw])?e[cw]():Ke(e)}return n||""}var xD=6e4,mse=Oc((Ai={sessionRenewalMs:CO(yD,30*60*1e3),sessionExpirationMs:CO(yD,24*60*60*1e3),disableExceptionTracking:rr()},Ai[ZB]=rr(),Ai[nse]=rr(),Ai[eH]=rr(),Ai[K2]=!1,Ai.samplingPercentage=Qy(gse,100),Ai[V2]=rr(),Ai[QB]=rr(),Ai[JB]=rr(),Ai.namePrefix=Sre(),Ai.enableDebug=rr(),Ai.disableFlushOnBeforeUnload=rr(),Ai.disableFlushOnUnload=rr(!1,"disableFlushOnBeforeUnload"),Ai));function yD(n,e){return n=n||e,n<xD&&(n=xD),+n}function gse(n){return!isNaN(n)&&n>0&&n<=100}function vse(n){bn(n[V2])||(n[V2]?Uie():Fie())}var _se=function(n){ul(e,n);function e(){var t=n.call(this)||this;t.identifier=qB,t.priority=180,t.autoRoutePVDelay=500;var r,i,s,o,a,l,c,u,h,f,p,_,y,g,m,v,x,w,E;return yn(e,t,function(S,C){var A=C[gh];B(),S.getCookieMgr=function(){return iN(S[kr])},S.processTelemetry=function(L,D){S.processNext(L,D)},S.trackEvent=function(L,D){try{var W=kl(L,Gl[Al],Gl[eu],S[qi](),D);S[kr][tu](W)}catch(H){z(2,39,"trackTrace failed, trace will not be collected: "+Zt(H),{exception:Ke(H)})}},S.startTrackEvent=function(L){try{r.start(L)}catch(D){z(1,29,"startTrackEvent failed, event will not be collected: "+Zt(D),{exception:Ke(D)})}},S.stopTrackEvent=function(L,D,W){try{r.stop(L,void 0,D,W)}catch(H){z(1,30,"stopTrackEvent failed, event will not be collected: "+Zt(H),{exception:Ke(H)})}},S.trackTrace=function(L,D){try{var W=kl(L,zf[Al],zf[eu],S[qi](),D);S[kr][tu](W)}catch(H){z(2,39,"trackTrace failed, trace will not be collected: "+Zt(H),{exception:Ke(H)})}},S.trackMetric=function(L,D){try{var W=kl(L,Wu[Al],Wu[eu],S[qi](),D);S[kr][tu](W)}catch(H){z(1,36,"trackMetric failed, metric will not be collected: "+Zt(H),{exception:Ke(H)})}},S[dx]=function(L,D){try{var W=L||{};s[dx](W,yi(yi(yi({},W.properties),W.measurements),D)),v&&a[G2](W.name,W.uri)}catch(H){z(1,37,"trackPageView failed, page view will not be collected: "+Zt(H),{exception:Ke(H)})}},S[Su]=function(L,D,W){var H=ii();if(H&&(L.refUri=L.refUri===void 0?H.referrer:L.refUri),Ae(L[Sp])){var K=(D||L[W2]||{})[Do]||0;L[Sp]=new Date(new Date().getTime()-K)}var oe=kl(L,wc[Al],wc[eu],S[qi](),D,W);S[kr][tu](oe)},S[Y2]=function(L,D,W){var H=kl(L,Bf[Al],Bf[eu],S[qi](),D,W);S[kr][tu](H)},S.trackPageViewPerformance=function(L,D){var W=L||{};try{o[xN](W),S[Y2](W,D)}catch(H){z(1,37,"trackPageViewPerformance failed, page view will not be collected: "+Zt(H),{exception:Ke(H)})}},S.startTrackPage=function(L){try{if(typeof L!="string"){var D=ii();L=D&&D.title||""}i.start(L)}catch(W){z(1,31,"startTrackPage failed, page view may not be collected: "+Zt(W),{exception:Ke(W)})}},S.stopTrackPage=function(L,D,W,H){try{if(typeof L!="string"){var K=ii();L=K&&K.title||""}if(typeof D!="string"){var oe=Ko();D=oe&&oe[Bh]||""}i.stop(L,D,W,H),v&&a[G2](L,D)}catch(me){z(1,32,"stopTrackPage failed, page view will not be collected: "+Zt(me),{exception:Ke(me)})}},S[pD]=function(L,D,W){var H=L&&(L[R1]||L[ym])||OR(L)&&L||{name:L&&typeof L,message:L||aa};L=L||{};var K=new Rs(S[qi](),H,L[W2]||D,L.measurements,L.severityLevel,L.id).toInterface(),oe=kl(K,Rs[Al],Rs[eu],S[qi](),D,W);S[kr][tu](oe)},S.trackException=function(L,D){L&&!L[R1]&&L[ym]&&(L[R1]=L[ym]);try{S[pD](L,D)}catch(W){z(1,35,"trackException failed, exception will not be collected: "+Zt(W),{exception:Ke(W)})}},S[N1]=function(L){var D=L&&L[ym],W=L&&L.evt;try{if(!W){var H=Vi();H&&(W=H[fse])}var K=L&&L.url||(ii()||{}).URL,oe=L[I1]||"window.onerror@"+K+":"+(L[P1]||0)+":"+(L[k1]||0),me={errorSrc:oe,url:K,lineNumber:L[P1]||0,columnNumber:L[k1]||0,message:L[mD]};ese(L.message,L.url,L.lineNumber,L.columnNumber,L[ym])?$(Rs[L1]("Script error: The browser's same-origin policy prevents us from getting the details of this exception. Consider using the 'crossorigin' attribute.",K,L[P1]||0,L[k1]||0,D,W,null,oe),me):(L[I1]||(L[I1]=oe),S.trackException({exception:L,severityLevel:3},me))}catch(Te){var Se=D?D.name+", "+D[mD]:"null";z(1,11,"_onError threw exception while logging error, error will not be collected: "+Zt(Te),{exception:Ke(Te),errorString:Se})}},S[g_]=function(L){if(S[kr])return S[kr][g_](L);l||(l=[]),l.push(L)},S.initialize=function(L,D,W,H){if(!S.isInitialized()){Ae(D)&&rs("Error initializing"),C.initialize(L,D,W,H);try{E=Uc(Gs(S.identifier),D.evtNamespace&&D.evtNamespace()),l&&(Ze(l,function(K){D[g_](K)}),l=null),k(L),o=new use(S[kr]),s=new ise(S,m.overridePageViewDuration,S[kr],o),a=new dse(S[qi](),function(K,oe,me){return T(K,oe,me)}),r=new _D(S[qi](),"trackEvent"),r.action=function(K,oe,me,Se,Te){Se||(Se={}),Te||(Te={}),Se.duration=me[cw](),S.trackEvent({name:K,properties:Se,measurements:Te})},i=new _D(S[qi](),"trackPageView"),i.action=function(K,oe,me,Se,Te){Ae(Se)&&(Se={}),Se.duration=me[cw]();var G={name:K,uri:oe,properties:Se,measurements:Te};S[Su](G,Se)},wS()&&(P(),M())}catch(K){throw S.setInitialized(!1),K}}},S._doTeardown=function(L,D){s&&s.teardown(L,D),Uf(window,null,null,E),B()};function k(L){var D=S.identifier,W=S[kr];S[gh](Jn(L,function(){var H=So(null,L,W);m=H.getExtCfg(D,mse),v=m[ZB],L.storagePrefix&&_N(L.storagePrefix),vse(m),c=m[QB],R()}))}function T(L,D,W){var H={PageName:L,PageUrl:D};S.trackMetric({name:"PageVisitTime",average:W,max:W,min:W,sampleCount:1},H)}function R(){if(!u&&c){var L=["/browserLinkSignalR/","/__browserLink/"],D=function(W){if(c&&W.baseType===Yu[Al]){var H=W.baseData;if(H){for(var K=0;K<L[pv];K++)if(H.target&&Fi(H.target,L[K])>=0)return!1}}return!0};S[gh](S[g_](D)),u=!0}}function $(L,D){var W=kl(L,Rs[Al],Rs[eu],S[qi](),D);S[kr][tu](W)}function P(){var L=Vi(),D=Ko(!0);S[gh](Jn(m,function(){p=m.disableExceptionTracking,!p&&!_&&!m.autoExceptionInstrumented&&(A(d_(L,"onerror",{ns:E,rsp:function(W,H,K,oe,me,Se){!p&&W.rslt!==!0&&S[N1](Rs[L1](H,K,oe,me,Se,W.evt))}},!1)),_=!0)})),O(L,D)}function M(){var L=Vi(),D=Ko(!0);S[gh](Jn(m,function(){if(h=m[JB]===!0,L&&h&&!f&&Pte()){var W=Rz();mt(W.pushState)&&mt(W.replaceState)&&typeof Event!==XR&&j(L,W,D)}}))}function I(){var L=null;if(S[kr]&&S[kr].getTraceCtx&&(L=S[kr].getTraceCtx(!1)),!L){var D=S[kr].getPlugin(NS);if(D){var W=D.plugin.context;W&&(L=mN(W.telemetryTrace))}}return L}function j(L,D,W){if(f)return;var H=m.namePrefix||"";function K(){h&&wm(L,xm(H+"locationchange"))}function oe(){if(w&&(x=w),w=W&&W[Bh]||"",h){var me=I();if(me){me.setTraceId(tc());var Se="_unknown_";W&&W.pathname&&(Se=W.pathname+(W.hash||"")),me.setName(lr(S[qi](),Se))}bo((function(Te){S[dx]({refUri:Te,properties:{duration:0}})}).bind(S,x),S.autoRoutePVDelay)}}A(d_(D,"pushState",{ns:E,rsp:function(){h&&(wm(L,xm(H+"pushState")),wm(L,xm(H+"locationchange")))}},!0)),A(d_(D,"replaceState",{ns:E,rsp:function(){h&&(wm(L,xm(H+"replaceState")),wm(L,xm(H+"locationchange")))}},!0)),Ya(L,H+"popstate",K,E),Ya(L,H+"locationchange",oe,E),f=!0}function O(L,D){S[gh](Jn(m,function(){y=m[eH]===!0,_=_||m[K2],y&&!g&&(A(d_(L,"onunhandledrejection",{ns:E,rsp:function(W,H){y&&W.rslt!==!0&&S[N1](Rs[L1](pse(H),D?D[Bh]:"",0,0,H,W.evt))}},!1)),m[K2]=g=!0)}))}function z(L,D,W,H,K){S[qi]().throwInternal(L,D,W,H,K)}function B(){r=null,i=null,s=null,o=null,a=null,l=null,c=!1,u=!1,h=!1,f=!1,p=!1,_=!1,y=!1,g=!1,v=!1;var L=Ko(!0);x=L&&L[Bh]||"",w=null,E=null,m=null,Gt(S,"config",{g:function(){return m}})}Gt(S,"_pageViewManager",{g:function(){return s}}),Gt(S,"_pageViewPerformanceManager",{g:function(){return o}}),Gt(S,"_pageVisitTimeManager",{g:function(){return a}}),Gt(S,"_evtNamespace",{g:function(){return"."+E}})}),t}return e.Version="3.1.2",e}(jp),px="featureOptIn",oH="onCfgChangeReceive",aH="nonOverrideConfigs",lH="scheduleFetchTimeout";function cH(n,e,t,r){try{var i=t>r;i&&(n=null);var s=t==0?Qte({},n):n;return s&&e&&!i&&Pt(s,function(o){var a=e[o];a&&(Wi(s[o])&&Wi(a)?s[o]=cH(s[o],a,++t,r):delete s[o])}),s}catch{}return n}var Hf="featureOptIn.",uH=".mode",dH=".onCfg",hH=".offCfg";function xse(n,e,t){var r;if(!e||!e.enabled)return null;var i=(e[px]||{})[n]||{mode:1},s=i.mode,o=i.onCfg,a=i.offCfg,l=(t||{})[n]||{mode:2},c=l.mode,u=l.onCfg,h=l.offCfg,f=!!l.blockCdnCfg,p=Hf+n+uH,_=Hf+n+dH,y=Hf+n+hH,g=c,m=u,v=h;return f||(s===4||s===5?(g=s==4?3:2,m=o||u,v=a||h):s===2||c===2?(g=2,m=u||o,v=h||a):s===3?(g=3,m=u||o,v=h||a):s===1&&c===1&&(g=1)),r={},r[p]=g,r[_]=m,r[y]=v,r}function yse(n,e){try{if(!n||!n.enabled)return null;if(!n[px])return n.config;var t=n[px],r=n.config||{};return Pt(t,function(i){var s=xse(i,n,e.config[px]);Ae(s)||(Pt(s,function(o,a){Uz(r,o,a)}),wse(i,s,r))}),r}catch{}return null}function wse(n,e,t){var r=e[Hf+n+uH],i=e[Hf+n+dH],s=e[Hf+n+hH],o=null;r===3&&(o=i),r===2&&(o=s),o&&Pt(o,function(a,l){Uz(t,a,l)})}var Sm,Sse="ai_cfgsync",wD="GET",Ese=18e5,vh=void 0,Tse={instrumentationKey:!0,connectionString:!0,endpointUrl:!0},Cse=Oc((Sm={syncMode:1,blkCdnCfg:vh,customEvtName:vh,cfgUrl:vh,overrideSyncFn:vh,overrideFetchFn:vh},Sm[oH]=vh,Sm[lH]=Ese,Sm[aH]=Tse,Sm)),bse=function(n){ul(e,n);function e(){var t=n.call(this)||this;t.priority=198,t.identifier="AppInsightsCfgSyncPlugin";var r,i,s,o,a,l,c,u,h,f,p,_,y,g,m,v,x=!1;return yn(e,t,function(w,E){S(),w.initialize=function(D,W,H,K){E.initialize(D,W,H,K),o=Uc(Gs(w.identifier),W.evtNamespace&&W.evtNamespace()),C(D)},w.getCfg=function(){return i},w.pause=function(){x=!0,L()},w.resume=function(){x=!1,B()},w.setCfg=function(D){return A(D)},w.sync=function(D){return T(D)},w.updateEventListenerName=function(D){return R(D)},w._doTeardown=function(D,W){k(),L(),S()},w._getDbgPlgTargets=function(){return[u,c,s,h]};function S(){i=null,s=null,o=null,a=null,c=null,u=null,y=null,l=null,f=null,p=null,h=null,m=null,v=null,_=null}function C(D){var W=w.identifier,H=w.core;w._addHook(Jn(D,function(){var K=So(null,D,H);r=K.getExtCfg(W,Cse);var oe=h;h=!!r.blkCdnCfg,!Ae(oe)&&oe!==h&&(!h&&a?g&&g(a,I,u):L()),Ae(c)&&(c=r.syncMode===2),Ae(u)&&(u=r.syncMode===1);var me=r.customEvtName||Sse;s!==me&&(c?R(me):(k(),s=me)),Ae(a)&&(a=r.cfgUrl),a||(i=D,u&&T())})),v=r.overrideSyncFn,m=r.overrideFetchFn,_=r[oH],y=r[aH],f=r[lH],g=$(),p=0,a&&!h&&g&&g(a,I,u)}function A(D,W){if(D){if(i=D,W&&!x)return T();if(c&&!x)return w.core.updateCfg(D),!0}return!1}function k(){try{var D=js();D&&Uf(D,null,null,o)}catch{}}function T(D){try{return v&&mt(v)?v(i,D):nre(s,i,D)}catch{}return!1}function R(D){try{return k(),D&&(s=D,O()),!0}catch{}return!1}function $(){var D=m;return Ae(D)&&(QR()?D=P:ES()&&(D=M)),D}function P(D,W,H){var K=js(),oe=K&&K.fetch||null;if(D&&oe&&mt(oe))try{var me={method:wD},Se=new Request(D,me);_p(fetch(Se),function(Te){var G=Te.value;Te.rejected?j(W,400):G.ok?_p(G.text(),function(he){j(W,G.status,he.value,H)}):j(W,G.status,null,H)})}catch{}}function M(D,W,H){try{var K=new XMLHttpRequest;K.open(wD,D),K.onreadystatechange=function(){K.readyState===XMLHttpRequest.DONE&&j(W,K.status,K.responseText,H)},K.onerror=function(){j(W,400)},K.ontimeout=function(){j(W,400)},K.send()}catch{}}function I(D,W,H){try{if(D>=200&&D<400&&W){p=0;var K=wo();if(K){var oe=K.parse(W),me=yse(oe,w.core);me&&A(me,H)}}else p++;p<3&&B()}catch{}}function j(D,W,H,K){try{D(W,H,K)}catch{}}function O(){if(c){var D=js();if(D)try{Ya(D,s,function(W){var H=W&&W.detail;if(_&&H)_(H);else{var K=H&&H.cfg,oe=K&&Ui(K)&&z(K);oe&&A(oe)}},o,!0)}catch{}}}function z(D,W){var H=null;try{D&&(H=cH(D,y,0,5))}catch{}return H}function B(){!l&&f&&(l=bo(function(){l=null,g(a,I,u)},f),l.unref())}function L(){l&&l.cancel(),l=null,p=0}w.processTelemetry=function(D,W){w.processNext(D,W)}}),t}return e.__ieDyn=1,e}(jp),fu="duration",Ur="tags",O1="deviceType",_i="data",il="name",mv="traceID",Lt="length",gv="stringify",Id="measurements",ta="dataType",Pd="envelopeType",pu="toString",Qm="_get",Ku="enqueue",$u="count",fH="eventsLimitInMem",Vf="push",Z2="emitLineDelimitedJson",Gf="clear",yN="createNew",dw="markAsSent",Ag="clearSent",wN="bufferOverride",D1="BUFFER_KEY",Ml="SENT_BUFFER_KEY",Em="MAX_BUFFER_SIZE",Tm="triggerSend",Kr="diagLog",U1="initialize",Cm="_sender",Q2="customHeaders",pH="maxBatchSizeInBytes",J2="onunloadDisableBeacon",eA="isBeaconApiDisabled",mH="alwaysUseXhrOverride",tA="disableXhr",gH="enableSessionStorageBuffer",Rl="_buffer",vH="onunloadDisableFetch",_H="disableSendBeaconSplit",xH="instrumentationKey",SD="enableSendPromise",v_="getSenderInst",ED="unloadTransports",yH="convertUndefined",wH="maxBatchInterval",mx="serialize",nu="_onError",F1="_onPartialSuccess",__="_onSuccess",j1="itemsAccepted",Ase="itemsReceived",z1="oriPayload",B1="baseType",hw="sampleRate",TD="eventsSendRequest",SH="getSamplingScore",Mse="getHashCodeScore",H1="baseType",On="baseData",Mr="properties",CD="true";function nr(n,e,t){return hn(n,e,t,My)}function Rse(n,e,t){var r=t[Ur]=t[Ur]||{},i=e.ext=e.ext||{},s=e[Ur]=e[Ur]||[],o=i.user;o&&(nr(r,Sn.userAuthUserId,o.authId),nr(r,Sn.userId,o.id||o.localId));var a=i.app;a&&nr(r,Sn.sessionId,a.sesId);var l=i.device;l&&(nr(r,Sn.deviceId,l.id||l.localId),nr(r,Sn[O1],l.deviceClass),nr(r,Sn.deviceIp,l.ip),nr(r,Sn.deviceModel,l.model),nr(r,Sn[O1],l[O1]));var c=e.ext.web;if(c){nr(r,Sn.deviceLanguage,c.browserLang),nr(r,Sn.deviceBrowserVersion,c.browserVer),nr(r,Sn.deviceBrowser,c.browser);var u=t[_i]=t[_i]||{},h=u[On]=u[On]||{},f=h[Mr]=h[Mr]||{};nr(f,"domain",c.domain),nr(f,"isManual",c.isManual?CD:null),nr(f,"screenRes",c.screenRes),nr(f,"userConsent",c.userConsent?CD:null)}var p=i.os;p&&nr(r,Sn.deviceOS,p[il]);var _=i.trace;_&&(nr(r,Sn.operationParentId,_.parentID),nr(r,Sn.operationName,lr(n,_[il])),nr(r,Sn.operationId,_[mv]));for(var y={},g=s[Lt]-1;g>=0;g--){var m=s[g];Pt(m,function(x,w){y[x]=w}),s.splice(g,1)}Pt(s,function(x,w){y[x]=w});var v=yi(yi({},r),y);v[Sn.internalSdkVersion]||(v[Sn.internalSdkVersion]=lr(n,"javascript:".concat(Nse.Version),64)),t[Ur]=eB(v)}function Ic(n,e,t){Ae(n)||Pt(n,function(r,i){_S(i)?t[r]=i:ht(i)?e[r]=i:jv()&&(e[r]=wo()[gv](i))})}function kd(n,e){Ae(n)||Pt(n,function(t,r){n[t]=r||e})}function Ld(n,e,t,r){var i=new Yie(n,r,e);nr(i,"sampleRate",t[OB]),(t[On]||{}).startTime&&(i.time=xp(t[On].startTime)),i.iKey=t.iKey;var s=t.iKey.replace(/-/g,"");return i[il]=i[il].replace("{0}",s),Rse(n,t,i),t[Ur]=t[Ur]||[],eB(i)}function Od(n,e){Ae(e[On])&&He(n,1,46,"telemetryItem.baseData cannot be null.")}var Nse={Version:"3.1.2"};function Ise(n,e,t){Od(n,e);var r=e[On][Id]||{},i=e[On][Mr]||{};Ic(e[_i],i,r),Ae(t)||kd(i,t);var s=e[On];if(Ae(s))return Vu(n,"Invalid input for dependency data"),null;var o=s[Mr]&&s[Mr][nD]?s[Mr][nD]:"GET",a=new Yu(n,s.id,s.target,s[il],s[fu],s.success,s.responseCode,o,s.type,s.correlationContext,i,r),l=new Nd(Yu[ta],a);return Ld(n,Yu[Pd],e,l)}function EH(n,e,t){Od(n,e);var r={},i={};e[H1]!==Gl[ta]&&(r.baseTypeSource=e[H1]),e[H1]===Gl[ta]?(r=e[On][Mr]||{},i=e[On][Id]||{}):e[On]&&Ic(e[On],r,i),Ic(e[_i],r,i),Ae(t)||kd(r,t);var s=e[On][il],o=new Gl(n,s,r,i),a=new Nd(Gl[ta],o);return Ld(n,Gl[Pd],e,a)}function Pse(n,e,t){Od(n,e);var r=e[On][Id]||{},i=e[On][Mr]||{};Ic(e[_i],i,r),Ae(t)||kd(i,t);var s=e[On],o=Rs.CreateFromInterface(n,s,i,r),a=new Nd(Rs[ta],o);return Ld(n,Rs[Pd],e,a)}function kse(n,e,t){Od(n,e);var r=e[On],i=r[Mr]||{},s=r[Id]||{};Ic(e[_i],i,s),Ae(t)||kd(i,t);var o=new Wu(n,r[il],r.average,r.sampleCount,r.min,r.max,r.stdDev,i,s),a=new Nd(Wu[ta],o);return Ld(n,Wu[Pd],e,a)}function Lse(n,e,t){Od(n,e);var r,i=e[On];!Ae(i)&&!Ae(i[Mr])&&!Ae(i[Mr][fu])?(r=i[Mr][fu],delete i[Mr][fu]):!Ae(e[_i])&&!Ae(e[_i][fu])&&(r=e[_i][fu],delete e[_i][fu]);var s=e[On],o;((e.ext||{}).trace||{})[mv]&&(o=e.ext.trace[mv]);var a=s.id||o,l=s[il],c=s.uri,u=s[Mr]||{},h=s[Id]||{};if(Ae(s.refUri)||(u.refUri=s.refUri),Ae(s.pageType)||(u.pageType=s.pageType),Ae(s.isLoggedIn)||(u.isLoggedIn=s.isLoggedIn[pu]()),!Ae(s[Mr])){var f=s[Mr];Pt(f,function(y,g){u[y]=g})}Ic(e[_i],u,h),Ae(t)||kd(u,t);var p=new wc(n,l,c,r,u,h,a),_=new Nd(wc[ta],p);return Ld(n,wc[Pd],e,_)}function Ose(n,e,t){Od(n,e);var r=e[On],i=r[il],s=r.uri||r.url,o=r[Mr]||{},a=r[Id]||{};Ic(e[_i],o,a),Ae(t)||kd(o,t);var l=new Bf(n,i,s,void 0,o,a,r),c=new Nd(Bf[ta],l);return Ld(n,Bf[Pd],e,c)}function Dse(n,e,t){Od(n,e);var r=e[On].message,i=e[On].severityLevel,s=e[On][Mr]||{},o=e[On][Id]||{};Ic(e[_i],s,o),Ae(t)||kd(s,t);var a=new zf(n,r,i,s,o),l=new Nd(zf[ta],a);return Ld(n,zf[Pd],e,l)}var TH=function(){function n(e,t){var r=[],i=!1;this[Qm]=function(){return r},this._set=function(s){return r=s,r},yn(n,this,function(s){s[Ku]=function(o){if(s[$u]()>=t[fH]){i||(He(e,2,105,"Maximum in-memory buffer size reached: "+s[$u](),!0),i=!0);return}r[Vf](o)},s[$u]=function(){return r[Lt]},s.size=function(){for(var o=r[Lt],a=0;a<r[Lt];a++)o+=r[a][Lt];return t[Z2]||(o+=2),o},s[Gf]=function(){r=[],i=!1},s.getItems=function(){return r.slice(0)},s.batchPayloads=function(o){if(o&&o[Lt]>0){var a=t[Z2]?o.join(`
`):"["+o.join(",")+"]";return a}return null},s[yN]=function(o,a,l){var c=r.slice(0);o=o||e,a=a||{};var u=l?new CH(o,a):new SN(o,a);return Ze(c,function(h){u[Ku](h)}),u}})}return n.__ieDyn=1,n}(),SN=function(n){ul(e,n);function e(t,r){var i=n.call(this,t,r)||this;return yn(e,i,function(s,o){s[dw]=function(a){o[Gf]()},s[Ag]=function(a){}}),i}return e.__ieDyn=1,e}(TH),CH=function(n){ul(e,n);function e(t,r){var i=n.call(this,t,r)||this,s=!1,o=r==null?void 0:r.namePrefix,a=r[wN]||{getItem:F2,setItem:GB},l=a.getItem,c=a.setItem;return yn(e,i,function(u,h){var f=g(e[D1]),p=g(e[Ml]),_=u._set(f.concat(p));_[Lt]>e[Em]&&(_[Lt]=e[Em]),m(e[Ml],[]),m(e[D1],_),u[Ku]=function(v){if(u[$u]()>=e[Em]){s||(He(t,2,67,"Maximum buffer size reached: "+u[$u](),!0),s=!0);return}h[Ku](v),m(e.BUFFER_KEY,u[Qm]())},u[Gf]=function(){h[Gf](),m(e.BUFFER_KEY,u[Qm]()),m(e[Ml],[]),s=!1},u[dw]=function(v){m(e[D1],u._set(y(v,u[Qm]())));var x=g(e[Ml]);x instanceof Array&&v instanceof Array&&(x=x.concat(v),x[Lt]>e[Em]&&(He(t,1,67,"Sent buffer reached its maximum size: "+x[Lt],!0),x[Lt]=e[Em]),m(e[Ml],x))},u[Ag]=function(v){var x=g(e[Ml]);x=y(v,x),m(e[Ml],x)},u[yN]=function(v,x,w){w=!!w;var E=u[Qm]().slice(0),S=g(e[Ml]).slice(0);v=v||t,x=x||{},u[Gf]();var C=w?new e(v,x):new SN(v,x);return Ze(E,function(A){C[Ku](A)}),w&&C[dw](S),C};function y(v,x){var w=[];return Ze(x,function(E){!mt(E)&&ci(v,E)===-1&&w[Vf](E)}),w}function g(v){var x=v;try{x=o?o+"_"+x:x;var w=l(t,x);if(w){var E=wo().parse(w);if(ht(E)&&(E=wo().parse(E)),E&&Dt(E))return E}}catch(S){He(t,1,42," storage key: "+x+", "+Zt(S),{exception:Ke(S)})}return[]}function m(v,x){var w=v;try{w=o?o+"_"+w:w;var E=JSON[gv](x);c(t,w,E)}catch(S){c(t,w,JSON[gv]([])),He(t,2,41," storage key: "+w+", "+Zt(S)+". Buffer cleared",{exception:Ke(S)})}}}),i}return e.BUFFER_KEY="AI_buffer",e.SENT_BUFFER_KEY="AI_sentBuffer",e.MAX_BUFFER_SIZE=2e3,e}(TH),Use=function(){function n(e){yn(n,this,function(t){t[mx]=function(o){var a=r(o,"root");try{return wo()[gv](a)}catch(l){He(e,1,48,l&&mt(l[pu])?l[pu]():"Error serializing object",null,!0)}};function r(o,a){var l="__aiCircularRefCheck",c={};if(!o)return He(e,1,48,"cannot serialize object because it is null or undefined",{name:a},!0),c;if(o[l])return He(e,2,50,"Circular reference detected while serializing object",{name:a},!0),c;if(!o.aiDataContract){if(a==="measurements")c=s(o,"number",a);else if(a==="properties")c=s(o,"string",a);else if(a==="tags")c=s(o,"string",a);else if(Dt(o))c=i(o,a);else{He(e,2,49,"Attempting to serialize an object which does not implement ISerializable",{name:a},!0);try{wo()[gv](o),c=o}catch(u){He(e,1,48,u&&mt(u[pu])?u[pu]():"Error serializing object",null,!0)}}return c}return o[l]=!0,Pt(o.aiDataContract,function(u,h){var f=mt(h)?h()&1:h&1,p=mt(h)?h()&4:h&4,_=h&2,y=o[u]!==void 0,g=Wi(o[u])&&o[u]!==null;if(f&&!y&&!_)He(e,1,24,"Missing required field specification. The field is required but not present on source",{field:u,name:a});else if(!p){var m=void 0;g?_?m=i(o[u],u):m=r(o[u],u):m=o[u],m!==void 0&&(c[u]=m)}}),delete o[l],c}function i(o,a){var l;if(o)if(!Dt(o))He(e,1,54,`This field was specified as an array in the contract but the item is not an array.\r
`,{name:a},!0);else{l=[];for(var c=0;c<o[Lt];c++){var u=o[c],h=r(u,a+"["+c+"]");l[Vf](h)}}return l}function s(o,a,l){var c;return o&&(c={},Pt(o,function(u,h){if(a==="string")h===void 0?c[u]="undefined":h===null?c[u]="null":h[pu]?c[u]=h[pu]():c[u]="invalid field: toString() is not defined.";else if(a==="number")if(h===void 0)c[u]="undefined";else if(h===null)c[u]="null";else{var f=parseFloat(h);c[u]=f}else c[u]="invalid field: "+l+" is of unknown type.",He(e,1,c[u],null,!0)})),c}})}return n.__ieDyn=1,n}(),Fse=8,jse=function(){function n(){}return n.prototype.getHashCodeScore=function(e){var t=this.getHashCode(e)/n.INT_MAX_VALUE;return t*100},n.prototype.getHashCode=function(e){if(e==="")return 0;for(;e[Lt]<Fse;)e=e.concat(e);for(var t=5381,r=0;r<e[Lt];++r)t=(t<<5)+t+e.charCodeAt(r),t=t&t;return Math.abs(t)},n.INT_MAX_VALUE=2147483647,n}(),zse=function(){function n(){var e=this,t=new jse,r=new $B;e[SH]=function(i){var s=0;return i[Ur]&&i[Ur][r.userId]?s=t.getHashCodeScore(i[Ur][r.userId]):i.ext&&i.ext.user&&i.ext.user.id?s=t[Mse](i.ext.user.id):i[Ur]&&i[Ur][r.operationId]?s=t.getHashCodeScore(i[Ur][r.operationId]):i.ext&&i.ext.telemetryTrace&&i.ext.telemetryTrace[mv]?s=t.getHashCodeScore(i.ext.telemetryTrace[mv]):s=Math.random()*100,s}}return n}(),Bse=function(){function n(e,t){this.INT_MAX_VALUE=2147483647;var r=t||Ad(null);(e>100||e<0)&&(r.throwInternal(2,58,"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.",{samplingRate:e},!0),e=100),this[hw]=e,this.samplingScoreGenerator=new zse}return n.prototype.isSampledIn=function(e){var t=this[hw],r=!1;return t==null||t>=100||e.baseType===Wu[ta]?!0:(r=this.samplingScoreGenerator[SH](e)<t,r)},n}(),In,_a,Uo=void 0,bD="",Hse=65e3;function AD(n){try{return n.responseText}catch{}return null}function Vse(n){return n&&n.sendPOST}var MD=Oc((In={endpointUrl:Qy(My,hN+bg)},In[Z2]=rr(),In[wH]=15e3,In[pH]=102400,In.disableTelemetry=rr(),In[gH]=rr(!0),In.isRetryDisabled=rr(),In[eA]=rr(!0),In[_H]=rr(!0),In[tA]=rr(),In[vH]=rr(),In[J2]=rr(),In[xH]=Uo,In.namePrefix=Uo,In.samplingPercentage=Qy(Gse,100),In[Q2]=Uo,In[yH]=Uo,In[fH]=1e4,In[wN]=!1,In.httpXHROverride={isVal:Vse,v:Uo},In[mH]=rr(),In.transports=Uo,In.retryCodes=Uo,In));function Gse(n){return!isNaN(n)&&n>0&&n<=100}var Wse=(_a={},_a[Gl.dataType]=EH,_a[zf.dataType]=Dse,_a[wc.dataType]=Lse,_a[Bf.dataType]=Ose,_a[Rs.dataType]=Pse,_a[Wu.dataType]=kse,_a[Yu.dataType]=Ise,_a),Yse=function(n){ul(e,n);function e(){var t=n.call(this)||this;t.priority=1001,t.identifier=XB;var r,i,s,o,a,l,c,u,h=0,f,p,_,y,g,m,v,x,w,E,S,C,A,k,T,R,$,P,M,I,j,O,z,B,L,D,W;return yn(e,t,function(H,K){Rt(),H.pause=function(){Ee(),o=!0},H.resume=function(){o&&(o=!1,i=null,st(),Ce())},H.flush=function(q,ie,fe){if(q===void 0&&(q=!0),!o){Ee();try{return H[Tm](q,null,fe||1)}catch(ge){He(H[Kr](),1,22,"flush failed, telemetry will not be collected: "+Zt(ge),{exception:Ke(ge)})}}},H.onunloadFlush=function(){if(!o)if(v||I)try{return H[Tm](!0,b,2)}catch(q){He(H[Kr](),1,20,"failed to flush with beacon sender on page unload, telemetry will not be collected: "+Zt(q),{exception:Ke(q)})}else H.flush(!1)},H.addHeader=function(q,ie){u[q]=ie},H[U1]=function(q,ie,fe,ge){H.isInitialized()&&He(H[Kr](),1,28,"Sender is already initialized"),K[U1](q,ie,fe,ge);var Le=H.identifier;l=new Use(ie.logger),r=0,i=null,s=0,H[Cm]=null,c=0;var Ie=H[Kr]();_=Uc(Gs("Sender"),ie.evtNamespace&&ie.evtNamespace()),p=tse(_),H._addHook(Jn(q,function(Qe){var Z=Qe.cfg;Z.storagePrefix&&_N(Z.storagePrefix);var Oe=So(null,Z,ie),re=Oe.getExtCfg(Le,MD);Gt(H,"_senderConfig",{g:function(){return re}}),g!==re.endpointUrl&&(y=g=re.endpointUrl),E&&E!==re[Q2]&&Ze(E,function(Hn){delete u[Hn.header]}),m=re[pH],v=(re[J2]===!1||re[eA]===!1)&&Km(),x=re[J2]===!1&&Km(),w=re[eA]===!1&&Km(),I=re[mH],j=!!re[tA],W=re.retryCodes;var Pe=re[wN],ze=!!re[gH]&&(!!Pe||fv()),bt=re.namePrefix,ln=ze!==R||ze&&P!==bt||ze&&$!==Pe;if(H[Rl]){if(ln)try{H._buffer=H._buffer[yN](Ie,re,ze)}catch(Hn){He(H[Kr](),1,12,"failed to transfer telemetry to different buffer storage, telemetry will be lost: "+Zt(Hn),{exception:Ke(Hn)})}st()}else H[Rl]=ze?new CH(Ie,re):new SN(Ie,re);P=bt,R=ze,$=Pe,O=!re[vH]&&QR(!0),L=!!re[_H],H._sample=new Bse(re.samplingPercentage,Ie),C=re[xH],we(C,Z)||He(Ie,1,100,"Invalid Instrumentation key "+C),E=re[Q2],!U2(y)&&E&&E[Lt]>0?Ze(E,function(Hn){t.addHeader(Hn.header,Hn.value)}):E=null,M=re[SD];var er=me();D?D.SetConfig(er):(D=new uie,D[U1](er,Ie));var Pr=re.httpXHROverride,qt=null,$n=null,xs=SO([3,1,2],re.transports);qt=D&&D[v_](xs,!1);var Fd=D&&D.getFallbackInst();z=function(Hn,Ao){return Ue(Fd,Hn,Ao)},B=function(Hn,Ao){return Ue(Fd,Hn,Ao,!1)},qt=I?Pr:qt||Pr||Fd,H[Cm]=function(Hn,Ao){return Ue(qt,Hn,Ao)},O&&(f=J);var Bp=SO([3,1],re[ED]);O||(Bp=Bp.filter(function(Hn){return Hn!==2})),$n=D&&D[v_](Bp,!0),$n=I?Pr:$n||Pr,(I||re[ED]||!f)&&$n&&(f=function(Hn,Ao){return Ue($n,Hn,Ao)}),f||(f=z),S=re.disableTelemetry,A=re[yH]||Uo,k=re.isRetryDisabled,T=re[wH]}))},H.processTelemetry=function(q,ie){ie=H._getTelCtx(ie);var fe=ie[Kr]();try{var ge=G(q,fe);if(!ge)return;var Le=he(q,fe);if(!Le)return;var Ie=l[mx](Le),Qe=H[Rl];st(Ie),Qe[Ku](Ie),Ce()}catch(Z){He(fe,2,12,"Failed adding telemetry to the sender's buffer, some telemetry will be lost: "+Zt(Z),{exception:Ke(Z)})}H.processNext(q,ie)},H.isCompletelyIdle=function(){return!o&&h===0&&H._buffer[$u]()===0},H._xhrReadyStateChange=function(q,ie,fe){return Se(q,ie,fe)},H[Tm]=function(q,ie,fe){q===void 0&&(q=!0);var ge;if(!o)try{var Le=H[Rl];if(S)Le[Gf]();else{if(Le[$u]()>0){var Ie=Le.getItems();Ge(fe||0,q),ie?ge=ie.call(H,Ie,q):ge=H[Cm](Ie,q)}s=+new Date}Ee()}catch(Z){var Qe=oB();(!Qe||Qe>9)&&He(H[Kr](),1,40,"Telemetry transmission failed, some telemetry will be lost: "+Zt(Z),{exception:Ke(Z)})}return ge},H.getOfflineSupport=function(){var q;return q={getUrl:function(){return y},createPayload:Ne},q[mx]=ve,q.batch=Y,q.shouldProcess=function(ie){return!!G(ie)},q},H._doTeardown=function(q,ie){H.onunloadFlush(),mf(p,!1),Rt()},H[nu]=function(q,ie,fe){He(H[Kr](),2,26,"Failed to send telemetry.",{message:ie}),H._buffer&&H._buffer[Ag](q)},H[F1]=function(q,ie){for(var fe=[],ge=[],Le=ie.errors.reverse(),Ie=0,Qe=Le;Ie<Qe.length;Ie++){var Z=Qe[Ie],Oe=q.splice(Z.index,1)[0];ye(Z.statusCode)?ge[Vf](Oe):fe[Vf](Oe)}q[Lt]>0&&H[__](q,ie[j1]),fe[Lt]>0&&H[nu](fe,Xy(null,["partial success",ie[j1],"of",ie.itemsReceived].join(" "))),ge[Lt]>0&&(te(ge),He(H[Kr](),2,40,"Partial success. Delivered: "+q[Lt]+", Failed: "+fe[Lt]+". Will retry to send "+ge[Lt]+" our of "+ie[Ase]+" items"))},H[__]=function(q,ie){H._buffer&&H._buffer[Ag](q)},H._xdrOnLoad=function(q,ie){return oe(q,ie)};function oe(q,ie){var fe=AD(q);if(q&&(fe+""=="200"||fe===""))r=0,H[__](ie,0);else{var ge=p1(fe);ge&&ge.itemsReceived&&ge.itemsReceived>ge[j1]&&!k?H[F1](ie,ge):H[nu](ie,nB(q))}}function me(){var q;try{var ie={xdrOnComplete:function(ge,Le,Ie){var Qe=Te(Ie);if(Qe)return oe(ge,Qe)},fetchOnComplete:function(ge,Le,Ie,Qe){var Z=Te(Qe);if(Z)return nn(ge.status,Z,ge.url,Z[Lt],ge.statusText,Ie||"")},xhrOnComplete:function(ge,Le,Ie){var Qe=Te(Ie);if(Qe)return Se(ge,Qe,Qe[Lt])},beaconOnRetry:function(ge,Le,Ie){return X(ge,Le,Ie)}},fe=(q={},q[SD]=M,q.isOneDs=!1,q.disableCredentials=!1,q[tA]=j,q.disableBeacon=!w,q.disableBeaconSync=!x,q.senderOnCompleteCallBack=ie,q);return fe}catch{}return null}function Se(q,ie,fe){q.readyState===4&&nn(q.status,ie,q.responseURL,fe,Xy(q),AD(q)||q.response)}function Te(q){try{if(q){var ie=q,fe=ie[z1];return fe&&fe[Lt]?fe:null}}catch{}return null}function G(q,ie){if(S)return!1;if(!q)return ie&&He(ie,1,7,"Cannot send empty telemetry"),!1;if(q.baseData&&!q[B1])return ie&&He(ie,1,70,"Cannot send telemetry without baseData and baseType"),!1;if(q[B1]||(q[B1]="EventData"),!H[Cm])return ie&&He(ie,1,28,"Sender was not initialized"),!1;if(Re(q))q[OB]=H._sample[hw];else return ie&&He(ie,2,33,"Telemetry item was sampled out and not sent",{SampleRate:H._sample[hw]}),!1;return!0}function he(q,ie){var fe=q.iKey||C,ge=e.constructEnvelope(q,fe,ie,A);if(!ge){He(ie,1,47,"Unable to create an AppInsights envelope");return}var Le=!1;if(q[Ur]&&q[Ur][v1]&&(Ze(q[Ur][v1],function(Ie){try{Ie&&Ie(ge)===!1&&(Le=!0,Vu(ie,"Telemetry processor check returns false"))}catch(Qe){He(ie,1,64,"One of telemetry initializers failed, telemetry item will not be sent: "+Zt(Qe),{exception:Ke(Qe)},!0)}}),delete q[Ur][v1]),!Le)return ge}function ve(q){var ie=bD,fe=H[Kr]();try{var ge=G(q,fe),Le=null;ge&&(Le=he(q,fe)),Le&&(ie=l[mx](Le))}catch{}return ie}function Y(q){var ie=bD;return q&&q[Lt]&&(ie="["+q.join(",")+"]"),ie}function Ne(q){var ie,fe=tt();return ie={urlString:y},ie[_i]=q,ie.headers=fe,ie}function Re(q){return H._sample.isSampledIn(q)}function Ve(q,ie,fe,ge){ie===200&&q?H._onSuccess(q,q[Lt]):ge&&H[nu](q,ge)}function Ue(q,ie,fe,ge){ge===void 0&&(ge=!0);var Le=function(Z,Oe,re){return Ve(ie,Z,Oe,re)},Ie=Je(ie),Qe=q&&q.sendPOST;return Qe&&Ie?(ge&&H._buffer[dw](ie),Qe(Ie,Le,!fe)):null}function Je(q){var ie;if(Dt(q)&&q[Lt]>0){var fe=H[Rl].batchPayloads(q),ge=tt(),Le=(ie={},ie[_i]=fe,ie.urlString=y,ie.headers=ge,ie.disableXhrSync=j,ie.disableFetchKeepAlive=!O,ie[z1]=q,ie);return Le}return null}function tt(){try{var q=u||{};return U2(y)&&(q[cn[6]]=cn[7]),q}catch{}return null}function st(q){var ie=q?q[Lt]:0;return H[Rl].size()+ie>m?((!p||p.isOnline())&&H[Tm](!0,null,10),!0):!1}function nn(q,ie,fe,ge,Le,Ie){var Qe=null;if(H._appId||(Qe=p1(Ie),Qe&&Qe.appId&&(H._appId=Qe.appId)),(q<200||q>=300)&&q!==0){if((q===301||q===307||q===308)&&!V(fe)){H[nu](ie,Le);return}!k&&ye(q)?(te(ie),He(H[Kr](),2,40,". Response code "+q+". Will retry to send "+ie[Lt]+" items.")):H[nu](ie,Le)}else if(p&&!p.isOnline()){if(!k){var Z=10;te(ie,Z),He(H[Kr](),2,40,". Offline - Response Code: ".concat(q,". Offline status: ").concat(!p.isOnline(),". Will retry to send ").concat(ie.length," items."))}}else V(fe),q===206?(Qe||(Qe=p1(Ie)),Qe&&!k?H[F1](ie,Qe):H[nu](ie,Le)):(r=0,H[__](ie,ge))}function V(q){return c>=10?!1:!Ae(q)&&q!==""&&q!==y?(y=q,++c,!0):!1}function b(q,ie){if(f)f(q,!1);else{var fe=D&&D[v_]([3],!0);return Ue(fe,q,ie)}}function X(q,ie,fe){var ge=q,Le=ge&&ge[z1];if(L)B&&B(Le,!0),He(H[Kr](),2,40,". Failed to send telemetry with Beacon API, retried with normal sender.");else{for(var Ie=[],Qe=0;Qe<Le[Lt];Qe++){var Z=Le[Qe],Oe=[Z],re=Je(Oe);fe(re,ie)?H._onSuccess(Oe,Oe[Lt]):Ie[Vf](Z)}Ie[Lt]>0&&(B&&B(Ie,!0),He(H[Kr](),2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}function J(q,ie){var fe=null;if(Dt(q)){for(var ge=q[Lt],Le=0;Le<q[Lt];Le++)ge+=q[Le][Lt];var Ie=D.getSyncFetchPayload();Ie+ge<=Hse?fe=2:Km()?fe=3:(fe=1,He(H[Kr](),2,40,". Failed to send telemetry with Beacon API, retried with xhrSender."));var Qe=D&&D[v_]([fe],!0);return Ue(Qe,q,ie)}return null}function te(q,ie){if(ie===void 0&&(ie=1),!(!q||q[Lt]===0)){var fe=H[Rl];fe[Ag](q),r++;for(var ge=0,Le=q;ge<Le.length;ge++){var Ie=Le[ge];fe[Ku](Ie)}ne(ie),Ce()}}function ne(q){var ie=10,fe;if(r<=1)fe=ie;else{var ge=(Math.pow(2,r)-1)/2,Le=Math.floor(Math.random()*ge*ie)+1;Le=q*Le,fe=Math.max(Math.min(Le,3600),ie)}var Ie=sa()+fe*1e3;i=Ie}function Ce(){if(!a&&!o){var q=i?Math.max(0,i-sa()):0,ie=Math.max(T,q);a=bo(function(){a=null,H[Tm](!0,null,1)},ie)}}function Ee(){a&&a.cancel(),a=null,i=null}function ye(q){return Ae(W)?q===401||q===408||q===429||q===500||q===502||q===503||q===504:W[Lt]&&W.indexOf(q)>-1}function xe(){var q="getNotifyMgr";return H.core[q]?H.core[q]():H.core._notificationManager}function Ge(q,ie){var fe=xe();if(fe&&fe[TD])try{fe[TD](q,ie)}catch(ge){He(H[Kr](),1,74,"send request notification failed: "+Zt(ge),{exception:Ke(ge)})}}function we(q,ie){var fe=ie.disableInstrumentationKeyValidation,ge=Ae(fe)?!1:fe;if(ge)return!0;var Le="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",Ie=new RegExp(Le);return Ie.test(q)}function Rt(){H[Cm]=null,H[Rl]=null,H._appId=null,H._sample=null,u={},p=null,r=0,i=null,s=null,o=!1,a=null,l=null,c=0,h=0,f=null,_=null,y=null,g=null,m=0,v=!1,E=null,S=!1,C=null,A=Uo,k=!1,R=null,P=Uo,j=!1,O=!1,L=!1,z=null,B=null,D=null,Gt(H,"_senderConfig",{g:function(){return tB({},MD)}})}}),t}return e.constructEnvelope=function(t,r,i,s){var o;r!==t.iKey&&!Ae(r)?o=yi(yi({},t),{iKey:r}):o=t;var a=Wse[o.baseType]||EH;return a(i,o,s)},e}(jp),RD="duration",Xu="properties",uo="requestUrl",Jm="inst",Ma="length",Ua="traceID",rc="spanID",Os="traceFlags",Mg="context",Wf="aborted",gx="traceId",vx="spanId",x_="_addHook",eo="core",V1="includeCorrelationHeaders",nA="getAbsoluteUrl",ru="headers",bs="requestHeaders",G1="setRequestHeader",ND="trackDependencyDataInternal",Lu="startTime",_h="toLowerCase",rA="enableRequestHeaderTracking",bH="enableAjaxErrorStatusText",AH="enableAjaxPerfTracking",MH="maxAjaxCallsPerView",RH="excludeRequestFromAutoTrackingPatterns",NH="addRequestContext",iA="disableAjaxTracking",IH="ajaxPerfLookupDelay",PH="disableFetchTracking",kH="enableResponseHeaderTracking",ao="status",Eu="statusText",vf="headerMap",sA="openDone",oA="sendDone",Ou="requestSentTime",aA="abortDone",lA="getTraceId",cA="getTraceFlags",Yl="method",uA="errorStatusText",LH="stateChangeAttached",ID="responseText",eg="responseFinishedTime",dA="CreateTrackItem",OH="response",PD="getAllResponseHeaders",hA="getPartAProps",fw="perfMark",Hh="name",fA="perfTiming",Rg="exception",kD="ajaxDiagnosticsMessage",pA="correlationContext",W1="ajaxTotalDuration",Y1="eventTraceCtx";function DH(n,e,t){var r=0,i=n[e],s=n[t];return i&&s&&(r=Mi(i,s)),r}function iu(n,e,t,r,i){var s=0,o=DH(t,r,i);return o&&(s=Ll(n,e,Wl(o))),s}function Ll(n,e,t){var r="ajaxPerf",i=0;if(n&&e&&t){var s=n[r]=n[r]||{};s[e]=t,i=1}return i}function Kse(n,e){var t=n[fA],r=e[Xu]||{},i=0,s="name",o="Start",a="End",l="domainLookup",c="connect",u="redirect",h="request",f="response",p="startTime",_=l+o,y=l+a,g=c+o,m=c+a,v=h+o,x=h+a,w=f+o,E=f+a,S=u+o,C=u=a,A="transferSize",k="encodedBodySize",T="decodedBodySize",R="serverTiming";if(t){i|=iu(r,u,t,S,C),i|=iu(r,l,t,_,y),i|=iu(r,c,t,g,m),i|=iu(r,h,t,v,x),i|=iu(r,f,t,w,E),i|=iu(r,"networkConnect",t,p,m),i|=iu(r,"sentRequest",t,v,E);var $=t[RD];$||($=DH(t,p,E)||0),i|=Ll(r,RD,$),i|=Ll(r,"perfTotal",$);var P=t[R];if(P){var M={};Ze(P,function(I,j){var O=Yy(I[s]||""+j),z=M[O]||{};Pt(I,function(B,L){(B!==s&&ht(L)||_S(L))&&(z[B]&&(L=z[B]+";"+L),(L||!ht(L))&&(z[B]=L))}),M[O]=z}),i|=Ll(r,R,M)}i|=Ll(r,A,t[A]),i|=Ll(r,k,t[k]),i|=Ll(r,T,t[T])}else n[fw]&&(i|=Ll(r,"missing",n.perfAttempts));i&&(e[Xu]=r)}var $se=function(){function n(){var e=this;e[sA]=!1,e.setRequestHeaderDone=!1,e[oA]=!1,e[aA]=!1,e[LH]=!1}return n}(),LD=function(){function n(e,t,r,i){var s,o=this,a=r,l="responseText";o[fw]=null,o.completed=!1,o.requestHeadersSize=null,o[bs]=null,o.responseReceivingDuration=null,o.callbackDuration=null,o[W1]=null,o[Wf]=0,o.pageUrl=null,o[uo]=null,o.requestSize=0,o[Yl]=null,o[ao]=null,o[Ou]=null,o.responseStartedTime=null,o[eg]=null,o.callbackFinishedTime=null,o.endTime=null,o.xhrMonitoringState=new $se,o.clientFailure=0,o[Ua]=e,o[rc]=t,o[Os]=i==null?void 0:i.getTraceFlags(),i?o[Y1]=(s={},s[gx]=i[lA](),s[vx]=i.getSpanId(),s[Os]=i[cA](),s):o[Y1]=null,yn(n,o,function(c){c.getAbsoluteUrl=function(){return c[uo]?Nie(c[uo]):null},c.getPathName=function(){return c[uo]?AS(a,Iie(c[Yl],c[uo])):null},c[dA]=function(u,h,f){var p;if(c.ajaxTotalDuration=Math.round(Mi(c.requestSentTime,c.responseFinishedTime)*1e3)/1e3,c[W1]<0)return null;var _=(p={id:"|"+c[Ua]+"."+c[rc],target:c[nA]()},p[Hh]=c.getPathName(),p.type=u,p[Lu]=null,p.duration=c[W1],p.success=+c[ao]>=200&&+c[ao]<400,p.responseCode=+c[ao],p[Xu]={HttpMethod:c[Yl]},p),y=_[Xu];if(c[Wf]&&(y[Wf]=!0),c[Ou]&&(_[Lu]=new Date,_[Lu].setTime(c[Ou])),Kse(c,_),h&&Ha(c.requestHeaders)[Ma]>0&&(y[bs]=c[bs]),f){var g=f();if(g){var m=g[pA];if(m&&(_.correlationContext=m),g[vf]&&Ha(g.headerMap)[Ma]>0&&(y.responseHeaders=g[vf]),c[uA])if(c[ao]>=400){var v=g.type;(v===""||v==="text")&&(y.responseText=g.responseText?g[Eu]+" - "+g[l]:g[Eu]),v==="json"&&(y.responseText=g.response?g[Eu]+" - "+JSON.stringify(g[OH]):g[Eu])}else c[ao]===0&&(y.responseText=g[Eu]||"")}}return _},c[hA]=function(){var u,h=null,f=c[Y1];if(f&&(f[gx]||f[vx])){h={};var p=h[es.TraceExt]=(u={},u[Ua]=f[gx],u.parentID=f[vx],u);Ae(f[Os])||(p[Os]=f[Os])}return h}})}return n.__ieDyn=1,n}(),Vn,OD="ai.ajxmn.",Ng="diagLog",Sc="_ajaxData",Tu="fetch",bm="Failed to monitor XMLHttpRequest",UH=", monitoring data for this ajax call ",xh=UH+"may be incorrect.",DD=UH+"won't be sent.",UD="Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",FD="Failed to add custom defined request context as configured call back may missing a null check.",jD="Failed to calculate the duration of the ",zD=0;function Xse(){var n=js();return!n||Ae(n.Request)||Ae(n.Request[Qo])||Ae(n[Tu])?null:n[Tu]}function qse(n,e){var t,r,i=!1;if(ES()){var s=XMLHttpRequest[Qo];i=!Ae(s)&&!Ae(s.open)&&!Ae(s.send)&&!Ae(s.abort)}var o=oB();if(o&&o<9&&(i=!1),i)try{var a=new XMLHttpRequest,l={xh:[],i:(t={},t[e]={},t)};a[Sc]=l;var c=XMLHttpRequest[Qo].open;XMLHttpRequest[Qo].open=c}catch(u){i=!1,Ig(n,15,"Failed to enable XMLHttpRequest monitoring, extension is not supported",(r={},r[Rg]=Ke(u),r))}return i}var Vh=function(n,e){return n&&e&&n[Sc]?(n[Sc].i||{})[e]:null},Zse=function(n,e,t){if(n){var r=(n[Sc]||{}).xh;r&&r.push({n:e,v:t})}},K1=function(n,e){var t=!1;if(n){var r=(n[Sc]||{}).xh;r&&Ze(r,function(i){if(i.n===e)return t=!0,-1})}return t};function _x(n,e){var t="";try{var r=Vh(n,e);r&&r[uo]&&(t+="(url: '"+r[uo]+"')")}catch{}return t}function Ig(n,e,t,r,i){He(n[Ng](),1,e,t,r,i)}function xa(n,e,t,r,i){He(n[Ng](),2,e,t,r,i)}function Am(n,e,t){return function(r){var i;Ig(n,e,t,(i={ajaxDiagnosticsMessage:_x(r[Jm],n._ajaxDataId)},i[Rg]=Ke(r.err),i))}}function yh(n,e){return n&&e?Fi(n,e):-1}function BD(n,e,t){var r={id:e,fn:t};return n.push(r),{remove:function(){Ze(n,function(i,s){if(i.id===r.id)return n.splice(s,1),-1})}}}function FH(n,e,t,r){var i=!0;return Ze(e,function(s,o){try{s.fn.call(null,t)===!1&&(i=!1)}catch(a){He(n&&n.logger,1,64,"Dependency "+r+" [#"+o+"] failed: "+Zt(a),{exception:Ke(a)},!0)}}),i}function Qse(n,e,t,r,i,s){var o,a=n[Ma];if(a>0){var l=(o={},o[eo]=e,o.xhr=r,o.input=i,o.init=s,o.traceId=t[Ua],o.spanId=t[rc],o.traceFlags=t[Os],o.context=t[Mg]||{},o.aborted=!!t[Wf],o);FH(e,n,l,"listener"),t[Ua]=l[gx],t[rc]=l[vx],t[Os]=l[Os],t[Mg]=l[Mg]}}var y_="*.blob.core.",Jse=pp([y_+"windows.net",y_+"chinacloudapi.cn",y_+"cloudapi.de",y_+"usgovcloudapi.net"]),eoe=[/https:\/\/[^\/]*(\.pipe\.aria|aria\.pipe|events\.data|collector\.azure)\.[^\/]+\/(OneCollector\/1|Collector\/3)\.0/i],toe=pp((Vn={},Vn[MH]=500,Vn[iA]=!1,Vn[PH]=!1,Vn[RH]=void 0,Vn.disableCorrelationHeaders=!1,Vn.distributedTracingMode=1,Vn.correlationHeaderExcludedDomains=Jse,Vn.correlationHeaderDomains=void 0,Vn.correlationHeaderExcludePatterns=void 0,Vn.appId=void 0,Vn.enableCorsCorrelation=!1,Vn[rA]=!1,Vn[kH]=!1,Vn[bH]=!1,Vn[AH]=!1,Vn.maxAjaxPerfLookupAttempts=3,Vn[IH]=25,Vn.ignoreHeaders=["Authorization","X-API-Key","WWW-Authenticate"],Vn[NH]=void 0,Vn.addIntEndpoints=!0,Vn)),noe=function(n){ul(e,n);function e(){var t=n.call(this)||this;t.identifier=e.identifier,t.priority=120;var r,i,s,o,a,l,c,u,h,f,p,_,y,g,m,v,x,w,E,S,C,A,k,T,R,$,P,M,I,j;return yn(e,t,function(O,z){var B=z[x_];L(),O.initialize=function(b,X,J,te){O.isInitialized()||(z.initialize(b,X,J,te),S=Uc(Gs("ajax"),X&&X.evtNamespace&&X.evtNamespace()),D(b),me(),K(),W())},O._doTeardown=function(){L()},O.trackDependencyData=function(b,X){V(T,O[eo],null,b,X)},O[V1]=function(b,X,J,te){var ne=O._currentWindowHost||s;if(Qse(k,O[eo],b,te,X,J),X||X===""){if(lD(o,b[nA](),ne)){J||(J={});var Ce=new Headers(J[ru]||(X instanceof Request?X[ru]||{}:{}));if(f){var Ee="|"+b[Ua]+"."+b[rc];Ce.set(cn[3],Ee),a&&(b[bs][cn[3]]=Ee)}var ye=I||u&&u.appId();if(ye&&(Ce.set(cn[0],cn[2]+ye),a&&(b[bs][cn[0]]=cn[2]+ye)),h){var xe=b[Os];Ae(xe)&&(xe=1);var Ge=jO(FO(b[Ua],b[rc],xe));Ce.set(cn[4],Ge),a&&(b[bs][cn[4]]=Ge)}J[ru]=Ce}return J}else if(te){if(lD(o,b[nA](),ne)){if(f)if(K1(te,cn[3]))xa(O,71,"Unable to set ["+cn[3]+"] as it has already been set by another instance");else{var Ee="|"+b[Ua]+"."+b[rc];te[G1](cn[3],Ee),a&&(b[bs][cn[3]]=Ee)}var ye=I||u&&u.appId();if(ye&&(K1(te,cn[0])?xa(O,71,"Unable to set ["+cn[0]+"] as it has already been set by another instance"):(te[G1](cn[0],cn[2]+ye),a&&(b[bs][cn[0]]=cn[2]+ye))),h){var xe=b[Os];if(Ae(xe)&&(xe=1),K1(te,cn[4]))xa(O,71,"Unable to set ["+cn[4]+"] as it has already been set by another instance");else{var Ge=jO(FO(b[Ua],b[rc],xe));te[G1](cn[4],Ge),a&&(b[bs][cn[4]]=Ge)}}}return te}},O[ND]=function(b,X,J){if(y===-1||c<y){(M===2||M===1)&&typeof b.id=="string"&&b.id[b.id[Ma]-1]!=="."&&(b.id+="."),Ae(b[Lu])&&(b[Lu]=new Date);var te=kl(b,Yu.dataType,Yu.envelopeType,O[Ng](),X,J);O[eo].track(te)}else c===y&&Ig(O,55,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0);++c},O.addDependencyListener=function(b){return BD(k,A++,b)},O.addDependencyInitializer=function(b){return BD(T,A++,b)};function L(){var b=Ko();r=!1,i=!1,j=!1,s=b&&b.host&&b.host[_h](),o=null,a=!1,l=!1,c=0,u=null,h=!1,f=!1,p=null,_=!1,y=0,g=!1,m={},v=!1,x=!1,w=null,E=null,S=null,A=0,k=[],T=[],C=Gs("ajaxData"),O._ajaxDataId=C,R=null,$=1,P=1,M=1,I=null}function D(b){O[x_](Jn(b,function(X){var J=X.cfg,te=So(null,J,O[eo]);if(o=te.getExtCfg(e.identifier,toe),M=o.distributedTracingMode,a=o[rA],l=o[bH],_=o[AH],y=o[MH],w=[].concat(o[RH]||[],o.addIntEndpoints!==!1?eoe:[]),E=o[NH],f=M===0||M===1,h=M===1||M===2,_){var ne=J.instrumentationKey||"unkwn";ne[Ma]>5?p=OD+Co(ne,ne[Ma]-5)+".":p=OD+ne+"."}v=!!o[iA],$=o.maxAjaxPerfLookupAttempts,P=o[IH],R=o.ignoreHeaders,I=o.appId}))}function W(){var b=O[eo].getPlugin(NS);b&&(u=b.plugin[Mg])}function H(b){var X=!0;return(b||R)&&Ze(R,function(J){if(J[_h]()===b[_h]())return X=!1,-1}),X}function K(){var b=Xse();if(b){var X=js(),J=b.polyfill;O[x_](Jn(o,function(){x=!!o[PH],g=o[kH],!x&&!r?(B(D2(X,Tu,{ns:S,req:function(te,ne,Ce){var Ee;if(!x&&r&&!Se(null,ne,Ce)&&!(J&&i)){var ye=te.ctx();Ee=Je(ne,Ce);var xe=O[V1](Ee,ne,Ce);xe!==Ce&&te.set(1,xe),ye.data=Ee}},rsp:function(te,ne){if(!x){var Ce=te.ctx().data;Ce&&(te.rslt=te.rslt.then(function(Ee){return st(te,(Ee||{})[ao],ne,Ee,Ce,function(){var ye,xe=(ye={statusText:(Ee||{})[Eu]},ye[vf]=null,ye[pA]=nn(Ee),ye);if(g&&Ee){var Ge={};Ee.headers.forEach(function(we,Rt){H(Rt)&&(Ge[Rt]=we)}),xe[vf]=Ge}return xe}),Ee}).catch(function(Ee){throw st(te,0,ne,null,Ce,null,{error:Ee.message||Ke(Ee)}),Ee}))}},hkErr:Am(O,15,"Failed to monitor Window.fetch"+xh)},!0,Nz())),r=!0):J&&!j&&(B(D2(X,Tu,{ns:S,req:function(te,ne,Ce){Se(null,ne,Ce)}})),j=!0)})),J&&(X[Tu].polyfill=J)}}function oe(b,X,J){B(Tie(b,X,J))}function me(){qse(O,C)&&O[x_](Jn(o,function(){v=!!o[iA],a=o[rA],!v&&!i&&(oe(XMLHttpRequest,"open",{ns:S,req:function(b,X,J,te){if(!v){var ne=b[Jm],Ce=Vh(ne,C);!Se(ne,J)&&Te(ne,Ce,!0)&&((!Ce||!Ce.xhrMonitoringState[sA])&&(Ce=he(ne,X,J,te)),ve(ne,Ce))}},hkErr:Am(O,15,bm+".open"+xh)}),oe(XMLHttpRequest,"send",{ns:S,req:function(b,X){if(!v){var J=b[Jm],te=Vh(J,C);Te(J,te)&&!te.xhrMonitoringState[oA]&&(Ve("xhr",te),te[Ou]=p_(),O[V1](te,void 0,void 0,J),te.xhrMonitoringState[oA]=!0)}},hkErr:Am(O,17,bm+xh)}),oe(XMLHttpRequest,"abort",{ns:S,req:function(b){if(!v){var X=b[Jm],J=Vh(X,C);Te(X,J)&&!J.xhrMonitoringState[aA]&&(J[Wf]=1,J.xhrMonitoringState[aA]=!0)}},hkErr:Am(O,13,bm+".abort"+xh)}),oe(XMLHttpRequest,"setRequestHeader",{ns:S,req:function(b,X,J){if(!v){var te=b[Jm],ne=Vh(te,C);ne&&Te(te,ne)&&(Zse(te,X,J),a&&H(X)&&ne&&(ne[bs][X]=J))}},hkErr:Am(O,71,bm+".setRequestHeader"+xh)}),i=!0)}))}function Se(b,X,J){var te=!1,ne=((ht(X)?X:(X||{}).url||"")||"")[_h]();if(Ze(w,function(ye){var xe=ye;ht(ye)&&(xe=new RegExp(ye)),te||(te=xe.test(ne))}),te)return te;var Ce=yh(ne,"?"),Ee=yh(ne,"#");return(Ce===-1||Ee!==-1&&Ee<Ce)&&(Ce=Ee),Ce!==-1&&(ne=ne.substring(0,Ce)),Ae(b)?Ae(X)||(te=(typeof X=="object"?X[h_]===!0:!1)||(J?J[h_]===!0:!1)):te=b[h_]===!0||ne[h_]===!0,!te&&ne&&U2(ne)&&(te=!0),te?m[ne]||(m[ne]=1):m[ne]&&(te=!0),te}function Te(b,X,J){var te=!0,ne=i;return Ae(b)||(te=J===!0||!Ae(X)),ne&&te}function G(){var b=null;return O[eo]&&O[eo].getTraceCtx&&(b=O[eo].getTraceCtx(!1)),!b&&u&&u.telemetryTrace&&(b=mN(u.telemetryTrace)),b}function he(b,X,J,te){var ne,Ce=G(),Ee=Ce&&Ce[lA]()||tc(),ye=Bl(tc(),0,16),xe=b[Sc]=b[Sc]||{xh:[],i:{}},Ge=xe.i=xe.i||{},we=Ge[C]=Ge[C]||new LD(Ee,ye,O[Ng](),(ne=O.core)===null||ne===void 0?void 0:ne.getTraceCtx());return we[Os]=Ce&&Ce[cA](),we[Yl]=X,we[uo]=J,we.xhrMonitoringState[sA]=!0,we[bs]={},we.async=te,we[uA]=l,we}function ve(b,X){X.xhrMonitoringState[LH]=Ya(b,"readystatechange",function(){var J;try{b&&b.readyState===4&&Te(b,X)&&Ne(b)}catch(ne){var te=Ke(ne);(!te||yh(te[_h](),"c00c023f")===-1)&&Ig(O,16,bm+" 'readystatechange' event handler"+xh,(J={},J[kD]=_x(b,C),J[Rg]=te,J))}},S)}function Y(b){try{var X=b.responseType;if(X===""||X==="text")return b[ID]}catch{}return null}function Ne(b){var X=Vh(b,C);X[eg]=p_(),X[ao]=b[ao];function J(te,ne){var Ce=ne||{};Ce.ajaxDiagnosticsMessage=_x(b,C),te&&(Ce.exception=Ke(te)),xa(O,14,jD+"ajax call"+DD,Ce)}Ue("xmlhttprequest",X,function(){try{var te=X[dA]("Ajax",a,function(){var xe,Ge=(xe={statusText:b[Eu]},xe[vf]=null,xe[pA]=Re(b),xe.type=b.responseType,xe[ID]=Y(b),xe.response=b[OH],xe);if(g){var we=b[PD]();if(we){var Rt=or(we).split(/[\r\n]+/),q={};Ze(Rt,function(ie){var fe=ie.split(": "),ge=fe.shift(),Le=fe.join(": ");H(ge)&&(q[ge]=Le)}),Ge[vf]=q}}return Ge}),ne=void 0;try{E&&(ne=E({status:b[ao],xhr:b}))}catch{xa(O,104,FD)}if(te){ne!==void 0&&(te[Xu]=yi(yi({},te.properties),ne));var Ce=X[hA]();V(T,O[eo],X,te,null,Ce)}else J(null,{requestSentTime:X[Ou],responseFinishedTime:X[eg]})}finally{try{var Ee=b[Sc]||{i:{}},ye=Ee.i||{};ye[C]&&(ye[C]=null)}catch{}}},function(te){J(te,null)})}function Re(b){var X;try{var J=b[PD]();if(J!==null){var te=yh(J[_h](),cn[8]);if(te!==-1){var ne=b.getResponseHeader(cn[0]);return cD(ne)}}}catch(Ce){xa(O,18,UD,(X={},X[kD]=_x(b,C),X[Rg]=Ke(Ce),X))}}function Ve(b,X){if(X[uo]&&p&&_){var J=nl();if(J&&mt(J.mark)){zD++;var te=p+b+"#"+zD;J.mark(te);var ne=J.getEntriesByName(te);ne&&ne[Ma]===1&&(X[fw]=ne[0])}}}function Ue(b,X,J,te){var ne=X[fw],Ce=nl(),Ee=$,ye=P,xe=X[uo],Ge=0;(function we(){try{if(Ce&&ne){Ge++;for(var Rt=null,q=Ce.getEntries(),ie=q[Ma]-1;ie>=0;ie--){var fe=q[ie];if(fe){if(fe.entryType==="resource")fe.initiatorType===b&&(yh(fe[Hh],xe)!==-1||yh(xe,fe[Hh])!==-1)&&(Rt=fe);else if(fe.entryType==="mark"&&fe[Hh]===ne[Hh]){X[fA]=Rt;break}if(fe[Lu]<ne[Lu]-1e3)break}}}!ne||X[fA]||Ge>=Ee||X.async===!1?(ne&&mt(Ce.clearMarks)&&Ce.clearMarks(ne[Hh]),X.perfAttempts=Ge,J()):bo(we,ye)}catch(ge){te(ge)}})()}function Je(b,X){var J,te=G(),ne=te&&te[lA]()||tc(),Ce=Bl(tc(),0,16),Ee=new LD(ne,Ce,O[Ng](),(J=O.core)===null||J===void 0?void 0:J.getTraceCtx());Ee[Os]=te&&te[cA](),Ee[Ou]=p_(),Ee[uA]=l;var ye;if(b instanceof Request?ye=(b||{}).url||"":ye=b,ye===""){var xe=Ko();xe&&xe.href&&(ye=Dz(xe.href,"#")[0])}Ee[uo]=ye;var Ge="GET";X&&X[Yl]?Ge=X[Yl]:b&&b instanceof Request&&(Ge=b[Yl]),Ee[Yl]=Ge;var we={};if(a){var Rt=new Headers((X?X[ru]:0)||(b instanceof Request?b[ru]||{}:{}));Rt.forEach(function(q,ie){H(ie)&&(we[ie]=q)})}return Ee[bs]=we,Ve(Tu,Ee),Ee}function tt(b){var X="";try{Ae(b)||(typeof b=="string"?X+="(url: '".concat(b,"')"):X+="(url: '".concat(b.url,"')"))}catch(J){Ig(O,15,"Failed to grab failed fetch diagnostics message",{exception:Ke(J)})}return X}function st(b,X,J,te,ne,Ce,Ee){if(!ne)return;function ye(xe,Ge,we){var Rt=we||{};Rt.fetchDiagnosticsMessage=tt(J),Ge&&(Rt.exception=Ke(Ge)),xa(O,xe,jD+"fetch call"+DD,Rt)}ne[eg]=p_(),ne[ao]=X,Ue(Tu,ne,function(){var xe=ne[dA]("Fetch",a,Ce),Ge;try{E&&(Ge=E({status:X,request:J,response:te}))}catch{xa(O,104,FD)}if(xe){Ge!==void 0&&(xe[Xu]=yi(yi({},xe.properties),Ge));var we=ne[hA]();V(T,O[eo],ne,xe,null,we)}else ye(14,null,{requestSentTime:ne[Ou],responseFinishedTime:ne[eg]})},function(xe){ye(18,xe,null)})}function nn(b){var X;if(b&&b[ru])try{var J=b[ru].get(cn[0]);return cD(J)}catch(te){xa(O,18,UD,(X={fetchDiagnosticsMessage:tt(b)},X[Rg]=Ke(te),X))}}function V(b,X,J,te,ne,Ce){var Ee,ye=!0,xe=b[Ma];if(xe>0){var Ge=(Ee={item:te},Ee[Xu]=ne,Ee.sysProperties=Ce,Ee.context=J?J[Mg]:null,Ee.aborted=J?!!J[Wf]:!1,Ee);ye=FH(X,b,Ge,"initializer")}ye&&O[ND](te,ne,Ce)}}),t}return e.prototype.processTelemetry=function(t,r){this.processNext(t,r)},e.prototype.addDependencyInitializer=function(t){return null},e.identifier="AjaxDependencyPlugin",e}(jp),roe=function(){function n(){}return n}(),ioe=function(){function n(){this.id="browser",this.deviceClass="Browser"}return n}(),soe="3.1.2",ooe=function(){function n(e,t){var r=this,i=Jn(e,function(){var s=e.sdkExtension;r.sdkVersion=(s?s+"_":"")+"javascript:"+soe});t&&t.add(i)}return n}(),aoe=function(){function n(){}return n}(),pw="sessionManager",mw="update",xx="isUserCookieSet",gw="isNewUser",$1="getTraceCtx",mA="telemetryTrace",jH="applySessionContext",zH="applyApplicationContext",BH="applyDeviceContext",HH="applyOperationContext",VH="applyUserContext",GH="applyOperatingSystemContxt",WH="applyLocationContext",YH="applyInternalContext",Cu="accountId",yx="getSessionId",EN="namePrefix",loe="sessionCookiePostfix",KH="userCookiePostfix",vw="idLength",TN="getNewId",_w="length",Gh="automaticSession",Wh="authenticatedId",Mm="acquisitionDate",w_="renewalDate",Pg="join",Rm="cookieSeparator",X1="authUserCookieName",coe="ai_session",uoe=864e5,doe=18e5,hoe=6e4,$H=function(){function n(){}return n}(),foe=function(){function n(e,t,r){var i=this,s,o,a=Ad(t),l=iN(t),c,u;yn(n,i,function(h){e||(e={});var f=Jn(e,function(v){c=e.sessionExpirationMs||uoe,u=e.sessionRenewalMs||doe;var x=e.sessionCookiePostfix||e[EN]||"";s=coe+x});r&&r.add(f),h[Gh]=new $H,h[mw]=function(){var v=sa(),x=!1,w=h[Gh];if(w.id||(x=!p(w)),!x&&c>0){var E=v-w[Mm],S=v-w[w_];x=E<0||S<0,x=x||E>c,x=x||S>u}x?y(v):(!o||v-o>hoe)&&g(w,v)},h.backup=function(){var v=h[Gh];m(v.id,v[Mm],v[w_])};function p(v,x){var w=!1,E=l.get(s);if(E&&mt(E.split))w=_(v,E);else{var S=HB(a,s);S&&(w=_(v,S))}return w||!!v.id}function _(v,x){var w=!1,E=", session will be reset",S=x.split("|");if(S[_w]>=2)try{var C=+S[1]||0,A=+S[2]||0;isNaN(C)||C<=0?He(a,2,27,"AI session acquisition date is 0"+E):isNaN(A)||A<=0?He(a,2,27,"AI session renewal date is 0"+E):S[0]&&(v.id=S[0],v[Mm]=C,v[w_]=A,w=!0)}catch(k){He(a,1,9,"Error parsing ai_session value ["+(x||"")+"]"+E+" - "+Zt(k),{exception:Ke(k)})}return w}function y(v){var x=e[TN]||JR;h.automaticSession.id=x(e[vw]||22),h[Gh][Mm]=v,g(h[Gh],v),RS()||He(a,2,0,"Browser does not support local storage. Session durations will be inaccurate.")}function g(v,x){var w=v[Mm];v[w_]=x;var E=u,S=w+c-x,C=[v.id,w,x],A=0;S<E?A=S/1e3:A=E/1e3;var k=e.cookieDomain||null;l.set(s,C[Pg]("|"),c>0?A:null,k),o=x}function m(v,x,w){VB(a,s,[v,x,w][Pg]("|"))}})}return n.__ieDyn=1,n}(),poe=function(){function n(e,t,r,i){var s=this;s.traceID=e||tc(),s.parentID=t;var o=Ko();!r&&o&&o.pathname&&(r=o.pathname),s.name=lr(i,r)}return n}();function HD(n){return!(typeof n!="string"||!n||n.match(/,|;|=| |\|/))}var moe=function(){function n(e,t,r){this.isNewUser=!1,this.isUserCookieSet=!1;var i=Ad(t),s=iN(t),o;yn(n,this,function(a){Gt(a,"config",{g:function(){return e}});var l=Jn(e,function(){var f=e[KH]||"";o=n.userCookieName+f;var p=s.get(o);if(p){a[gw]=!1;var _=p.split(n[Rm]);_[_w]>0&&(a.id=_[0],a[xx]=!!a.id)}if(!a.id){a.id=c();var y=u(a.id);h(y[Pg](n[Rm]));var g=(e[EN]||"")+"ai_session";jie(i,g)}a[Cu]=e[Cu]||void 0;var m=s.get(n[X1]);if(m){m=decodeURI(m);var v=m.split(n[Rm]);v[0]&&(a[Wh]=v[0]),v[_w]>1&&v[1]&&(a[Cu]=v[1])}});r&&r.add(l);function c(){var f=e||{},p=f[TN]||JR,_=p(f[vw]?e[vw]:22);return _}function u(f){var p=xp(new Date);a.accountAcquisitionDate=p,a[gw]=!0;var _=[f,p];return _}function h(f){var p=31536e3;a[xx]=s.set(o,f,p)}a.setAuthenticatedUserContext=function(f,p,_){_===void 0&&(_=!1);var y=!HD(f)||p&&!HD(p);if(y){He(i,2,60,"Setting auth user context failed. User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.",!0);return}a[Wh]=f;var g=a[Wh];p&&(a[Cu]=p,g=[a[Wh],a.accountId][Pg](n[Rm])),_&&s.set(n[X1],encodeURI(g))},a.clearAuthenticatedUserContext=function(){a[Wh]=null,a[Cu]=null,s.del(n[X1])},a[mw]=function(f){if(a.id!==f||!a[xx]){var p=f||c(),_=u(p);h(_[Pg](n[Rm]))}}})}return n.cookieSeparator="|",n.userCookieName="ai_user",n.authUserCookieName="ai_authUser",n}(),S_="ext",E_="tags";function wh(n,e){n&&n[e]&&Ha(n[e])[_w]===0&&delete n[e]}function VD(){return null}var goe=function(){function n(e,t,r,i){var s=this,o=e.logger;yn(n,this,function(a){if(a.appId=VD,a[yx]=VD,a.application=new roe,a.internal=new ooe(t,i),wS()){a[pw]=new foe(t,e,i),a.device=new ioe,a.location=new aoe,a.user=new moe(t,e,i);var l=void 0,c=void 0,u;r&&(l=r.getTraceId(),c=r.getSpanId(),u=r.getName()),a[mA]=new poe(l,c,u,o),a.session=new $H}a[yx]=function(){var h=a.session,f=null;if(h&&ht(h.id))f=h.id;else{var p=(a[pw]||{})[Gh];f=p&&ht(p.id)?p.id:null}return f},a[jH]=function(h,f){hn(fi(h.ext,es.AppExt),"sesId",a[yx](),ht)},a[GH]=function(h,f){hn(h.ext,es.OSExt,a.os)},a[zH]=function(h,f){var p=a.application;if(p){var _=fi(h,E_);hn(_,Sn.applicationVersion,p.ver,ht),hn(_,Sn.applicationBuild,p.build,ht)}},a[BH]=function(h,f){var p=a.device;if(p){var _=fi(fi(h,S_),es.DeviceExt);hn(_,"localId",p.id,ht),hn(_,"ip",p.ip,ht),hn(_,"model",p.model,ht),hn(_,"deviceClass",p.deviceClass,ht)}},a[YH]=function(h,f){var p=a.internal;if(p){var _=fi(h,E_);hn(_,Sn.internalAgentVersion,p.agentVersion,ht),hn(_,Sn.internalSdkVersion,lr(o,p.sdkVersion,64),ht),(h.baseType===dv.dataType||h.baseType===wc.dataType)&&(hn(_,Sn.internalSnippet,p.snippetVer,ht),hn(_,Sn.internalSdkSrc,p.sdkSrc,ht))}},a[WH]=function(h,f){var p=s.location;p&&hn(fi(h,E_,[]),Sn.locationIp,p.ip,ht)},a[HH]=function(h,f){var p=a[mA];if(p){var _=fi(fi(h,S_),es.TraceExt,{traceID:void 0,parentID:void 0});hn(_,"traceID",p.traceID,ht,Ae),hn(_,"name",p.name,ht,Ae),hn(_,"parentID",p.parentID,ht,Ae)}},a.applyWebContext=function(h,f){var p=s.web;p&&hn(fi(h,S_),es.WebExt,p)},a[VH]=function(h,f){var p=a.user;if(p){var _=fi(h,E_,[]);hn(_,Sn.userAccountId,p[Cu],ht);var y=fi(fi(h,S_),es.UserExt);hn(y,"id",p.id,ht),hn(y,"authId",p[Wh],ht)}},a.cleanUp=function(h,f){var p=h.ext;p&&(wh(p,es.DeviceExt),wh(p,es.UserExt),wh(p,es.WebExt),wh(p,es.OSExt),wh(p,es.AppExt),wh(p,es.TraceExt))}})}return n.__ieDyn=1,n}(),$r,q1,Sh=null,voe=Oc(($r={},$r[Cu]=Sh,$r.sessionRenewalMs=30*60*1e3,$r.samplingPercentage=100,$r.sessionExpirationMs=24*60*60*1e3,$r.cookieDomain=Sh,$r.sdkExtension=Sh,$r.isBrowserLinkTrackingEnabled=!1,$r.appId=Sh,$r[yx]=Sh,$r[EN]=q1,$r[loe]=q1,$r[KH]=q1,$r[vw]=22,$r[TN]=Sh,$r)),_oe=function(n){ul(e,n);function e(){var t=n.call(this)||this;t.priority=110,t.identifier=NS;var r,i,s,o,a;return yn(e,t,function(l,c){u(),Gt(l,"context",{g:function(){return o}}),l.initialize=function(p,_,y,g){c.initialize(p,_,y,g),h(p)},l.processTelemetry=function(p,_){if(!Ae(p)){_=l._getTelCtx(_),p.name===wc.envelopeType&&_.diagLog().resetInternalMessageCount();var y=o||{};y.session&&typeof o.session.id!="string"&&y[pw]&&y[pw][mw]();var g=y.user;if(g&&!g[xx]&&g[mw](y.user.id),f(p,_),g&&g[gw]&&(g[gw]=!1,!a)){var m=new dv(72,(ca()||{}).userAgent||"");Ire(_.diagLog(),1,m)}l.processNext(p,_)}},l._doTeardown=function(p,_){var y=(p||{}).core();if(y&&y[$1]){var g=y[$1](!1);g===i&&y.setTraceCtx(s)}u()};function u(){r=null,i=null,s=null,o=null,a=!0}function h(p){var _=l.identifier,y=l.core;l._addHook(Jn(p,function(){var g=So(null,p,y);p.storagePrefix&&_N(p.storagePrefix),a=p.disableUserInitMessage!==!1,r=g.getExtCfg(_,voe),l._extConfig=r})),s=y[$1](!1),o=new goe(y,r,s,l._unloadHooks),i=mN(l.context[mA],s),y.setTraceCtx(i),l.context.appId=function(){var g=y.getPlugin(XB);return g?g.plugin._appId:null}}function f(p,_){fi(p,"tags",[]),fi(p,"ext",{});var y=l.context;y[jH](p,_),y[zH](p,_),y[BH](p,_),y[HH](p,_),y[VH](p,_),y[GH](p,_),y.applyWebContext(p,_),y[WH](p,_),y[YH](p,_),y.cleanUp(p,_)}}),t}return e.__ieDyn=1,e}(jp),XH="AuthenticatedUserContext",zp="track",gA="snippet",xoe="getCookieMgr",yoe="startTrackPage",woe="stopTrackPage",Z1="flush",Soe="startTrackEvent",Eoe="stopTrackEvent",Toe="addTelemetryInitializer",GD="pollInternalLogs",Q1="getPlugin",J1="evtNamespace",Coe=zp+"Event",boe=zp+"Trace",Aoe=zp+"Metric",Moe=zp+"PageView",Roe=zp+"Exception",Noe=zp+"DependencyData",Ioe="set"+XH,Poe="clear"+XH,eC="version",su="queue",wx="connectionString",Sx="endpointUrl",tg="userOverrideEndpointUrl",vA="instrumentationKey",Nm="onunloadFlush",Es="context",WD="addHousekeepingBeforeUnload",tC="sendMessage",koe="updateSnippetDefinitions",ya,Im,Eh,Pm,YD=[gA,"dependencies","properties","_snippetVersion","appInsightsNew","getSKUDefaults"],qH="iKeyUsage",ZH="CdnUsage",QH="SdkLoaderVer",T_=void 0,Loe={samplingRate:100,maxSendNumber:1},Ooe={monthInterval:3,daysOfMonth:[28]},C_={disabled:!0,limit:Vl(Loe),interval:Vl(Ooe)},Doe=(ya={},ya[wx]=T_,ya[Sx]=T_,ya[vA]=T_,ya[tg]=T_,ya.diagnosticLogInterval=Qy(Uoe,1e4),ya.featureOptIn=(Im={},Im[qH]={mode:2},Im[ZH]={mode:2},Im[QH]={mode:2},Im),ya.throttleMgrCfg=Vl((Eh={},Eh[109]=Vl(C_),Eh[106]=Vl(C_),Eh[111]=Vl(C_),Eh[110]=Vl(C_),Eh)),ya);function Uoe(n){return n&&n>0}var Foe=function(){function n(e){var t=this,r,i,s,o,a,l,c,u,h,f,p,_,y,g;yn(n,this,function(m){w(),Gt(m,"config",{g:function(){return u}}),Ze(["pluginVersionStringArr","pluginVersionString"],function(C){Gt(m,C,{g:function(){return c?c[C]:null}})}),o=""+(e.sv||e[eC]||""),e[su]=e[su]||[],e[eC]=e[eC]||2;var v=Ws(e.config||{},Doe);u=v.cfg,h=new _se,Gt(m,"appInsights",{g:function(){return h}}),i=new _oe,r=new noe,s=new Yse,c=new lie,Gt(m,"core",{g:function(){return c}}),S(Jn(v,function(){if(u[wx]){var C=Wie(u[wx]),A=C.ingestionendpoint;u[Sx]=u[tg]?u[tg]:A+bg,u[vA]=C.instrumentationkey||u[vA]}u[Sx]=u[tg]?u[tg]:u[Sx]})),m[gA]=e,m[Z1]=function(C,A){C===void 0&&(C=!0);var k;return nw(c,function(){return"AISKU.flush"},function(){C&&!A&&(k=Rc(function($){A=$}));var T=1,R=function(){T--,T===0&&A()};Ze(c.getChannels(),function($){$&&(T++,$[Z1](C,R))}),R()},null,C),k},m[Nm]=function(C){C===void 0&&(C=!0),Ze(c.getChannels(),function(A){A[Nm]?A[Nm]():A[Z1](C)})},m.loadAppInsights=function(C,A,k){C===void 0&&(C=!1),C&&Bte("Legacy Mode is no longer supported");function T(R){if(R){var $="";Ae(o)||($+=o),m[Es]&&m[Es].internal&&(m[Es].internal.snippetVer=$||"-"),Pt(m,function(P,M){ht(P)&&!mt(M)&&P&&P[0]!=="_"&&ci(YD,P)===-1&&R[P]!==M&&(R[P]=M)})}}return nw(m.core,function(){return"AISKU.loadAppInsights"},function(){c.initialize(u,[s,i,r,h,f],A,k),Gt(m,"context",{g:function(){return i[Es]}}),p||(p=new Hie(c));var R=joe();R&&m[Es]&&(m[Es].internal.sdkSrc=R),T(m[gA]),m.emptyQueue(),m[GD](),m[WD](m),S(Jn(v,function(){var $=!1;u.throttleMgrCfg[109]&&($=!u.throttleMgrCfg[109].disabled),!p.isReady()&&u.extensionConfig&&u.extensionConfig[f.identifier]&&$&&p.onReadyState(!0);var P;!_&&!u[wx]&&ZT(qH,u)&&(P=p[tC](106,"See Instrumentation key support at aka.ms/IkeyMigrate"),_=!0),!y&&m[Es].internal.sdkSrc&&m[Es].internal.sdkSrc.indexOf("az416426")!=-1&&ZT(ZH,u)&&(P=p[tC](110,"See Cdn support notice at aka.ms/JsActiveCdn"),y=!0),!g&&parseInt(o)<6&&ZT(QH,u)&&(P=p[tC](111,"An updated Sdk Loader is available, see aka.ms/SnippetVer"),g=!0)}))}),m},m[koe]=function(C){kne(C,m,function(A){return A&&ci(YD,A)===-1})},m.emptyQueue=function(){try{if(Dt(m.snippet[su])){for(var C=m.snippet[su].length,A=0;A<C;A++){var k=m.snippet[su][A];k()}m.snippet[su]=void 0,delete m.snippet[su]}}catch(R){var T={};R&&mt(R.toString)&&(T.exception=R.toString())}},m[WD]=function(C){if(wS()||Mz()){var A=function(){if(C[Nm](!1),mt(m.core[Q1])){var T=t.core[Q1](NS);if(T){var R=T.plugin;R&&R[Es]&&R[Es]._sessionManager&&R[Es]._sessionManager.backup()}}},k=!1;l||(l=Uc(a,c[J1]&&c[J1]())),S(Jn(u,function(T){var R=T.cfg,$=C.appInsights,P=So(null,R,$.core),M=P.getExtCfg($.identifier||qB);E();var I=R.disablePageUnloadEvents;M.disableFlushOnBeforeUnload||(yie(A,I,l)&&(k=!0),O2(A,I,l)&&(k=!0),!k&&!Qne()&&He(c.logger,1,19,"Could not add handler for beforeunload and pagehide")),!k&&!M.disableFlushOnUnload&&O2(A,I,l)}))}},m.getSender=function(){return s},m.unload=function(C,A,k){var T=!1,R;C&&!A&&(R=Rc(function(P){A=P}));function $(P){T||(T=!0,w(),A&&A(P))}return m[Nm](C),E(),c.unload&&c.unload(C,$,k),R},Ym(m,h,[xoe,Coe,Moe,"trackPageViewPerformance",Roe,"_onerror",boe,Aoe,yoe,woe,Soe,Eoe]),Ym(m,x,[Noe,"addDependencyListener","addDependencyInitializer"]),Ym(m,c,[Toe,GD,"stopPollingInternalLogs",Q1,"addPlugin",J1,"addUnloadCb","getTraceCtx","updateCfg","onCfgChange"]),Ym(m,function(){var C=i[Es];return C?C.user:null},[Ioe,Poe]);function x(){return r}function w(){a=Gs("AISKU"),l=null,r=null,i=null,s=null,o=null,p=null,_=!1,y=!1,g=!1,f=new bse}function E(){l&&(wie(null,l),Sie(null,l))}function S(C){c.addUnloadHook(C)}})}return n.prototype.addDependencyInitializer=function(e){return null},n}();function joe(){if(Pm)return Pm;var n=null,e=!1,t=["://js.monitor.azure.com/","://az416426.vo.msecnd.net/"];try{var r=(document||{}).currentScript;r&&(n=r.src)}catch{}if(n){try{var i=n.toLowerCase();if(i){var s="";Ze(t,function(o,a){if(Fi(i,o)!==-1)return s="cdn"+(a+1),Fi(i,"/scripts/")===-1&&(Fi(i,"/next/")!==-1?s+="-next":Fi(i,"/beta/")!==-1&&(s+="-beta")),Pm=s+(e?".mod":""),-1})}}catch{}Pm=n}return Pm}function zoe(n){if(!n)return{};const e=n.split(".")[1];if(!e)return{};const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(window.atob(t).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(r)}let _A;async function Boe(){if(!AR()){console.warn("Not configured for blob storage, running local mode only"),document.title="WEB3d - local mode only",ke.setState({selectedLayerTitle:"WEB3d - local mode only",localMode:!0});return}try{const n=await Ed(!0),e=await Td();if(!e)return;const t=zoe(e),r=location.host.toLocaleLowerCase().includes("localhost");if(n.ENV__AZURE_APP_INSIGHT&&!r){const i=new Foe({config:{connectionString:n.ENV__AZURE_APP_INSIGHT}});i.loadAppInsights(),i.trackPageView(),i.setAuthenticatedUserContext(t.oid),i.addTelemetryInitializer(s=>{s.tags&&(s.tags["ai.cloud.role"]=location.host)}),_A=i}else console.error("Missing insight config")}catch(n){console.error("ApplicationInsights",n)}}class Hoe{static selectedProject(e,t,r){_A&&_A.trackEvent({name:"PROJECT_SELECTED",properties:{projectCode:e,projectLayer:`${e} - ${t}`,userOID:r,domain:location.host,atDate:new Date().toISOString()}})}}let ts;const JH="PROJECT_SELECTOR_STATE",KD=localStorage.getItem(JH);KD&&(ts=JSON.parse(KD));function e6(){const n=ke.getState();localStorage.setItem(JH,JSON.stringify({projectFilter:n.projectFilter,projectSelectedKey:n.projectSelectedKey,projectSelectedCode:n.projectSelectedCode,projectSelectedName:n.projectSelectedName}))}const ke=Ir(n=>({allProjects:[],filteredProjects:[],projectFilter:(ts==null?void 0:ts.projectFilter)||"",projectSelectedKey:(ts==null?void 0:ts.projectSelectedKey)||null,projectSelectedCode:(ts==null?void 0:ts.projectSelectedCode)||null,projectSelectedName:(ts==null?void 0:ts.projectSelectedName)||null,selectedLayer:null,selectedLayerTitle:null,selectedProject:null,isOpen:!1,localMode:!1,setAllProjects:async e=>{const t=ke.getState(),r=e.filter(i=>i.unique_key===t.projectSelectedKey)[0];if(r){const i=await NR(r.container,r.config,r.unique_key,r.project_code,r.project_name);ke.setState({selectedProject:i,projectSelectedKey:r.unique_key,projectSelectedCode:r.project_code,projectSelectedName:r.project_name})}ke.setState({allProjects:e}),ke.getState().runFilter()},runFilter:()=>{const e=ke.getState();e6();const t=e.allProjects.filter(r=>{if(!e.projectFilter||r.project_code.toUpperCase().includes(e.projectFilter.toUpperCase())||r.project_name.toUpperCase().includes(e.projectFilter.toUpperCase()))return!0});t.sort((r,i)=>{const s=r.project_code+r.project_name,o=i.project_code+i.project_name;return s<o?-1:s>o?1:0}),n(r=>({...r,filteredProjects:t}))},activateProjectSelectDialog:()=>n(()=>({isOpen:!0})),deactivateProjectSelectDialog:()=>n(()=>({isOpen:!1}))}));let $D;ke.subscribe(async n=>{var t,r,i,s,o,a,l,c,u;if(!((t=n.selectedLayer)!=null&&t.name)||!((r=n.selectedProject)!=null&&r.project_code))return;const e=`${((i=n.selectedProject)==null?void 0:i.project_code)||"UNKNOWN"} - ${((s=n.selectedLayer)==null?void 0:s.name)||"UNKNOWN"}`;if($D!==e){$D=e;const f=(await MR()).getActiveAccount();f&&(console.log(`Project:${((o=n.selectedProject)==null?void 0:o.project_code)||"UNKNOWN"} - ${((a=n.selectedLayer)==null?void 0:a.name)||"UNKNOWN"}`),Hoe.selectedProject(((l=n.selectedProject)==null?void 0:l.project_code)||"UNKNOWN",((c=n.selectedLayer)==null?void 0:c.name)||"UNKNOWN",((u=f==null?void 0:f.idTokenClaims)==null?void 0:u.oid)||"UNKNOWN"))}});function Voe(n,e,t){return n?e?d.jsx("div",{className:"flex items-center",onClick:async()=>{await ae.treeview_toggle_id(t),Mt.getState().updateToggel()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-600 hover:text-gray-200",fill:"none","data-tooltip":"Collapse",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})}):d.jsx("div",{className:"flex items-center ",onClick:async()=>{await ae.treeview_toggle_id(t),Mt.getState().updateToggel()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-600 hover:text-gray-200",fill:"none","data-tooltip":"Expand",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5l7 7-7 7"})})}):d.jsx("div",{className:"flex items-center ml-4 mr-1"})}function Goe(n){return new Worker(""+new URL("modelLoaderWorker-WY2SHXL7.js",import.meta.url).href,{name:n==null?void 0:n.name})}function t6(){return new Promise(n=>{setTimeout(()=>{n(null)},200)})}let b_=0;async function Woe(n){if(b_>10)for(;b_>9;)await t6();b_++;const e=new Goe,t=bv(e);return[await new t(n),e,()=>{b_--}]}let XD=0;function Yoe(){return XD++,XD}class qD extends Be{constructor(t,r,i,s,o,a,l){super(t,r);Q(this,"isBatchedMesh");Q(this,"_multiDrawCounts");Q(this,"_multiDrawStarts");Q(this,"_multiDrawCount");Q(this,"material");Q(this,"boundingBox");Q(this,"boundingSphere");Q(this,"$pickingMaterial");Q(this,"$backupMaterial");Q(this,"$rgbId");Q(this,"$materialID");Q(this,"$isSelected");this.material=r,this.isBatchedMesh=!0,this.boundingBox=null,this.boundingSphere=null,this._multiDrawCounts=i,this._multiDrawStarts=s,this._multiDrawCount=o,this.frustumCulled=!l;const c=new at;this.$materialID=Yoe(),this.$rgbId=c.setHex(this.$materialID),this.$pickingMaterial=lp(this.$rgbId,1,!1,0,!0),this.$backupMaterial=r,this.$isSelected=a}$setPicking(t,r=!1){var i,s;if(t){const o=Xe.getState(),a=o.enabled;this.material=this.$pickingMaterial,this.material.visible=!0;const l=this.$backupMaterial.opacity;let c=!1;if(l!==1&&(l>=.1001?c=r:c=!r),c){this.material.visible=!1;return}const u=(i=this.$backupMaterial)==null?void 0:i.$shader,h=(s=u==null?void 0:u.uniforms)==null?void 0:s.transformOverride;h&&(this.material=lp(this.$rgbId,1,!1,0,!0,h.value.elements)),this.material.clippingPlanes=F().getClipping().getClippingPlanes();const f=this.material;if(f!=null&&f.$shader){const p=f.$shader.uniforms;p.boxEnabled.value=a,p.boxmax.value=new N(o.maxX,o.maxY,o.maxZ),p.boxmin.value=new N(o.minX,o.minY,o.minZ)}}else this.material=this.$backupMaterial;this.material.needsUpdate=!0}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=this.geometry.boundingBox)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=this.geometry.boundingSphere)}dispose(){return this.geometry.dispose(),this}}class n6 extends Au{constructor(){super(...arguments);Q(this,"__modelGroupKey");Q(this,"__modelDBKey");Q(this,"__modelDBKeyIndex");Q(this,"__modelDBKeyPosition");Q(this,"__modelDBStore");Q(this,"_materialid");Q(this,"$groups");Q(this,"$groupColors");Q(this,"$groupTransforms");Q(this,"$geometry");Q(this,"$pickingMesh");Q(this,"$meshes")}$initMesh(t,r,i,s){this.$groupColors=r,this.$groups=i,this.$groupTransforms=new Map,this.$geometry=t,this.__modelGroupKey=s.modelGroupKey,this.__modelDBKey=s.modelDBKey,this.__modelDBKeyIndex=s.modelDBKeyIndex,this.__modelDBKeyPosition=s.modelDBKeyPosition,this.__modelDBStore=s.modelDBStore,i.forEach(o=>{const a=this.$groupColors.get(o.material_index)||[0,1,0,.5],l=this.$groupTransforms.get(o.transformation),c=new at(a[0],a[1],a[2]),u=lp(c,a[3],!1,0,!1,l);o.transformation&&console.log(o.transformation);const h=new qD(t,u,new Int32Array([o.count]),new Int32Array([o.start]),1,!!o.is_sel,!!l);this.$meshes=new Map,this.$meshes.set(this.$getMeshKey(a,l,o.is_sel),h),this.add(h)})}$getMeshMaterialFromRange(t,r,i){var l;const s=this.$groupColors.get(t),o=this.$groupTransforms.get(r),a=this.$getMeshKey(s,o,i);return(l=this.$meshes.get(a))==null?void 0:l.material}$getMeshKey(t=[0,0,0,0],r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i){const s=((t[0]||.5019607843137255)*255).toFixed(),o=((t[1]||.5019607843137255)*255).toFixed(),a=((t[2]||.5019607843137255)*255).toFixed(),l=((t[3]||.5019607843137255)*255).toFixed();return`${i}_${s}_${o}_${a}_${l}_${r.join("_")}`}$updateGroups(t,r,i){if(this.$groups.length===0&&t.length===0)return;this.$groups=t,this.$groupColors=r,this.$groupTransforms=i;const s=new Map;ae.showSelectionColor()&&(this.$groupColors.set(-1,[0,0,1,1]),this.$groups.forEach(l=>{l.is_sel&&(l.material_index=-1)})),t.forEach(l=>{const c=this.$getMeshKey(this.$groupColors.get(l.material_index),this.$groupTransforms.get(l.transformation),l.is_sel),u=s.get(c);u?u.push(l):s.set(c,[l])});const a=new Set(Array.from(this.$meshes.keys()));s.forEach((l,c)=>{const u=this.$meshes.get(c),h=l.filter(_=>_.count),f=new Int32Array(h.length),p=new Int32Array(h.length);if(h.forEach((_,y)=>{f[y]=_.start*4,p[y]=_.count}),u)a.delete(c),u._multiDrawCount=h.length,u._multiDrawCounts=p,u._multiDrawStarts=f,u.visible=!0;else{console.warn("Mesh update");const _=this.$groupColors.get(h[0].material_index)||[0,1,0,.5],y=this.$groupTransforms.get(h[0].transformation),g=new at(_[0],_[1],_[2]),m=lp(g,_[3],!1,0,!1,y),v=new qD(this.$geometry,m,p,f,h.length,!!h[0].is_sel,!!y);v.visible=h.length>0;const x=m.color.toArray().concat([m.opacity]);this.$meshes.set(this.$getMeshKey(x,y,h[0].is_sel),v),this.add(v)}}),a.forEach(l=>{const c=this.$meshes.get(l);c&&c._multiDrawCount>0&&(c._multiDrawCount=0,c._multiDrawCounts=new Int32Array,c._multiDrawStarts=new Int32Array,c.visible=!1)})}$updateClippingPlanes(t){}$getGeometryBoundingBox(){return this.$geometry.boundingBox}$getMaterials(){const t=[];return this.children.forEach(r=>{const i=r;t.push(i.material)}),t}$getMeshById(t){let r=!1;return this.children.forEach(i=>{i.$materialID===t&&(r=!0)}),r}$getGroups(){return this.$groups}$getGroupsRaycast(){return this.$groups.map(t=>({start:t.start,count:t.count,material_index:t.material_index,transformation:this.$groupTransforms.get(t.transformation),is_sel:0}))}$setPicking(t,r){this.children.forEach(i=>{const s=i;s.$setPicking&&s.$setPicking(t,r)})}}ar.DEFAULT_UP=new N(0,0,1);async function xw(n,e,t){const i=await new oi(n).getKey(e),s=[];if(i&&i.length)for(let o=0;o<i.length;o++){const[a,l,c]=await Woe(n),u=a.getModel(i[o]).then(async h=>{if(a[XA](),l.terminate(),c(),!h){t&&t();return}const f=new xn,p=new Dn(h.index,1);p.onUploadCallback=function(){this.array=null},f.setIndex(p);const _=new Dn(h.position,3,!1);_.onUploadCallback=function(){this.array=null},f.setAttribute("position",_),h.matrix&&f.applyMatrix4(new ot().fromArray(h.matrix)),f.computeBoundingBox(),f.computeBoundingSphere();const y=new n6,g=new Map;g.set(0,h.color),y.$initMesh(f,g,[{start:0,count:h.index.length,material_index:0,transformation:0,is_sel:0}],{modelGroupKey:h.groupKey||h.indexdbKey,modelDBKey:h.indexdbKey,modelDBKeyIndex:h.indexID,modelDBKeyPosition:h.positionID,modelDBStore:n});const m=F().getSceneController();ae.meshes_set_mesh_as_loaded(y.__modelDBKeyIndex,[h.color],y.$groups.map(v=>({start:v.start,count:v.count,material_index:v.material_index,transformation:0,is_sel:0}))),m.addMeshToScene(y,e),t&&t()});s.push(u)}await Promise.all(s)}function Hv(n){if(n)return n.project_key;throw"getActiveProjectModelGroupKey called without active prosjekt selected"}class Koe{constructor(){Q(this,"siteNames",new Set)}clear(){this.siteNames.clear()}delete(e){this.siteNames.delete(e.replace("/",""))}add(e){this.siteNames.add(e.replace("/",""))}has(e){return this.siteNames.has(e.replace("/",""))}}const Ra=new Koe;function vv(n){return((n==null?void 0:n.project_key)||"unknown")+"_TEMP_SET"}function $oe(n){return n.loaded?d.jsx("div",{className:"flex items-center ",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  text-yellow-600 hover:text-gray-200 ml-2",fill:"none","data-tooltip":"Unloads Group",viewBox:"0 0 24 24",stroke:"currentColor",onClick:async()=>{var r;async function e(i){if(i.$loaded){F().getSceneController().clearModelGroup(i.name),i.$loaded=!1;const o=un.getState().modelGroups;un.setState({modelGroups:[]}),un.setState({modelGroups:o})}}const t=(r=un.getState().modelGroups)==null?void 0:r.filter(i=>Ra.has(i.name));if(t!=null&&t.length){for(let i=0;i<t.length;i++)await e(t[i]);await e(n.modelGroupName)}else await e(n.modelGroupName);F().getSceneController().updateBB(),F().forceRenderNextFrame()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}):d.jsx("div",{className:"flex items-center ",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-600 hover:text-gray-200 ml-2",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Load modelGroup from disk",stroke:"currentColor",onClick:async()=>{var s;it.setState({loadingData:!0,dialogContent:"please wait, depends on hardware/model details",dialogHeader:"Loading"});const e=F(),t=e.getSceneController().getMeshes().length===0;async function r(o){if(!o.$loaded){ke.getState().selectedProject&&(o.$isLocalFile?await xw(vv(ke.getState().selectedProject),o.name):await xw(Hv(ke.getState().selectedProject),o.name)),e.forceRenderNextFrame(),o.$loaded=!0;const l=un.getState().modelGroups;un.setState({modelGroups:[]}),un.setState({modelGroups:l})}}const i=(s=un.getState().modelGroups)==null?void 0:s.filter(o=>Ra.has(o.name));if(i!=null&&i.length)for(let o=0;o<i.length;o++)await r(i[o]),await r(n.modelGroupName);else await r(n.modelGroupName);e.getSceneController().updateBB(),t&&await e.fitModelToCanvas(!0),await ae.update_hidden_groups(),e.forceRenderNextFrame(),it.setState({loadingData:!1,dialogContent:"",dialogHeader:""})},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})})}function Xoe(n,e){var t;if(n===0){const r=e.replace("/",""),i=(t=un.getState().modelGroups)==null?void 0:t.filter(s=>s.name===r);if(i!=null&&i.length)return d.jsx($oe,{modelGroupName:i[0],loaded:i[0].$loaded})}return d.jsx("div",{className:"flex items-center",children:d.jsx("div",{className:"h-4 w-4 ml-2",children:" "})})}let km=null;function qoe(n){const e=ee.useRef(null),t=ae.getRow(n),r="threeView-row hover:bg-gray-700 hover:text-white bg-indigo-500 text-black ";if(ee.useEffect(()=>{const i=e.current;if(i!=null&&i.offsetParent){async function s(){if(t!=null&&t.data){const o=t==null?void 0:t.data[4],a=t==null?void 0:t.data[5],l=i==null?void 0:i.offsetParent;o&&l?l.className!==r&&(l.className=r):l&&l.className!=="threeView-row hover:bg-gray-700"&&(l.className="threeView-row hover:bg-gray-700"),a?l.style.opacity=.5:l.style.opacity=null}}t!=null&&t.key&&s()}}),t&&t.data){const i=t.data[3],s=t.data[2];return d.jsxs("div",{ref:e,className:"flex",style:{marginLeft:`${(t==null?void 0:t.lvl)*7}px`},children:[Xoe(t.lvl,t.data[0]),Voe(s,i,t.key),d.jsx("div",{"data-copyvalue":!0,"data-raw-value":t.data[0],className:"flex-1",onClick:async o=>{if(o.preventDefault(),o.stopPropagation(),!o.ctrlKey&&!o.shiftKey&&(Ra.clear(),await ae.selection_clear(!1)),ld(t.key,o.ctrlKey),o.shiftKey&&km!==null)if(km>n)for(let a=n;a<km+1;a++){const l=ae.getRow(a);if(l){const c=(l==null?void 0:l.data)&&(l==null?void 0:l.data[2]);if(l.lvl===0&&l.data&&Ra.add(l.data[0]),c){await ae.selection_add([l.key]);const u=await ae.getKeyChildrenFromItem(l.key);await ae.selection_add(u)}else await ae.selection_add([l.key])}}else for(let a=km;a<n+1;a++){const l=ae.getRow(a);if(l){const c=(l==null?void 0:l.data)&&(l==null?void 0:l.data[2]);if(l.lvl===0&&l.data&&Ra.add(l.data[0]),c){await ae.selection_add([l.key]);const u=await ae.getKeyChildrenFromItem(l.key);await ae.selection_add(u)}else await ae.selection_add([l.key])}}else if(t.lvl===0&&t.data&&(Ra.has(t.data[0])?Ra.delete(t.data[0]):Ra.add(t.data[0])),await ae.selection_is_selected(t.key)){if(await ae.selection_remove([t.key]),s){const a=await ae.getKeyChildrenFromItem(t.key);await ae.selection_remove(a)}}else if(await ae.selection_add([t.key]),s){const a=await ae.getKeyChildrenFromItem(t.key);await ae.selection_add(a)}await ae.selection_append(),Mt.getState().updateToggel(),km=n},children:d.jsx("div",{className:"flex",children:d.jsx("span",{children:t.data[0]})})})]})}else return null}function r6(){Mt();const n=mn(),e=un(),t=ke(),r=ae.length();return n.treeViewActive?t.selectedProject?!Array.isArray(e.modelGroups)||!e.modelGroups.filter(i=>i.$synced).length||!r?null:d.jsx(_q,{rowheight:17,length:r,addRowElements:i=>d.jsx("div",{className:"border-b block border-gray-700 w-full whitespace-nowrap text-xs ",children:qoe(i.no)})}):d.jsx("div",{className:"flex flex-col bg-gray-800 m-2 p-2",children:"No project selected"}):null}const i6=Ir(n=>({activeTab:"HOME",setActiveTab:e=>{n(()=>({activeTab:e}))}}));function Kt(n){return d.jsxs("div",{className:"m-1 flex flex-col min-w-20 ",children:[d.jsx("div",{className:"flex flex-1 m-auto",children:n.children}),d.jsx("div",{className:"text-center text-xs pl-1 pr-1 text-gray-200  bg-gray-700 rounded",children:n.name})]})}function Zoe(){const n=mn();return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":"Opens/closes the treeview menu on the left",onClick:async()=>{Mt.getState().updateToggel(0),n.treeViewToggle()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5  rotate-90",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"TreeView"})]})}function Qoe(){const n=ke();return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 pointer-events-auto rounded cursor-pointer","data-tooltip":"Opens project selector dialog",onClick:()=>{n.activateProjectSelectDialog()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5  rotate-90 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})}),d.jsx("span",{className:"text-center text-xs ",children:"Project"})]})}function Joe(){const n=un();return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":"Opens the sync dialog",onClick:()=>{ke.getState().selectedProject?n.activateSyncDialog():ke.getState().activateProjectSelectDialog()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-2m-4-1v8m0 0l3-3m-3 3L9 8m-5 5h2.586a1 1 0 01.707.293l2.414 2.414a1 1 0 00.707.293h3.172a1 1 0 00.707-.293l2.414-2.414a1 1 0 01.707-.293H20"})}),d.jsx("span",{className:"text-center text-xs",children:"Sync"})]})}function s6(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":["Clears all local files. Useful for:","- Reducing disk space","- Reset after issues with syncing/unexpected issues"].join(`
`),onClick:async()=>{confirm(" Are you sure, you will need to resync")&&(it.setState({loadingData:!0,dialogHeader:"cleanup",dialogContent:"Deleting all cached data in browser"}),(await indexedDB.databases()).forEach(t=>{t.name&&indexedDB.deleteDatabase(t.name)}),it.setState({loadingData:!1}),window.location.reload())},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d.jsx("span",{className:"text-center text-xs",children:"Cache"})]})}class CN{constructor(){this._listeners={}}addEventListener(e,t){const r=this._listeners;return r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t),this}removeEventListener(e,t){if(this._listeners===void 0)return this;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const r=this._listeners[e.type];if(r!==void 0){const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class Ep extends CN{constructor(e,t,r,i={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=r,this._attributes=i,!t.isOnGraph(r))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class eae extends CN{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(t=>t.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(t=>t.getChild())}disconnectParents(e,t){let r=this.listParentEdges(e);return t&&(r=r.filter(i=>t(i.getParent()))),r.forEach(i=>i.dispose()),this}createEdge(e,t,r,i){return this._registerEdge(new Ep(e,t,r,i))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const r=e.getChild();return this._childEdges.has(r)||this._childEdges.set(r,new Set),this._childEdges.get(r).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function kg(){return kg=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},kg.apply(this,arguments)}function xA(n){return n instanceof Ep}function ng(n){return Array.isArray(n)&&n[0]instanceof Ep}function rg(n){return!!(nae(n)&&tae(n)instanceof Ep)}function tae(n){for(const e in n)return n[e]}function nae(n){return!!n&&Object.getPrototypeOf(n)===Object.prototype}const sn=Symbol("attributes"),_f=Symbol("immutableKeys");class bN extends CN{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[sn]=void 0,this[_f]=void 0,this.graph=e,this[_f]=new Set,this[sn]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const r in e){const i=e[r];if(i instanceof bN){const s=this.graph.createEdge(r,this,i);s.addEventListener("dispose",()=>i.dispose()),this[_f].add(r),t[r]=s}else t[r]=i}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const r in this[sn]){const i=this[sn][r];if(xA(i)){const s=i;s.getChild()===e&&this.setRef(r,t,s.getAttributes())}else if(ng(i)){const o=i.find(a=>a.getChild()===e);if(o){const a=o.getAttributes();this.removeRef(r,e).addRef(r,t,a)}}else if(rg(i)){const s=i;for(const o in s){const a=s[o];a.getChild()===e&&this.setRefMap(r,o,t,a.getAttributes())}}}return this}get(e){return this[sn][e]}set(e,t){return this[sn][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[sn][e];return t?t.getChild():null}setRef(e,t,r){if(this[_f].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const i=this[sn][e];if(i&&i.dispose(),!t)return this;const s=this.graph.createEdge(e,this,t,r);return s.addEventListener("dispose",()=>{delete this[sn][e],this.dispatchEvent({type:"change",attribute:e})}),this[sn][e]=s,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[sn][e].map(r=>r.getChild())}addRef(e,t,r){const i=this.graph.createEdge(e,this,t,r),s=this[sn][e];return s.push(i),i.addEventListener("dispose",()=>{let o;for(;(o=s.indexOf(i))!==-1;)s.splice(o,1);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[sn][e].filter(s=>s.getChild()===t).forEach(s=>s.dispose()),this}listRefMapKeys(e){return Object.keys(this[sn][e])}listRefMapValues(e){return Object.values(this[sn][e]).map(t=>t.getChild())}getRefMap(e,t){const r=this[sn][e];return r[t]?r[t].getChild():null}setRefMap(e,t,r,i){const s=this[sn][e],o=s[t];if(o&&o.dispose(),!r)return this;i=Object.assign(i||{},{key:t});const a=this.graph.createEdge(e,this,r,kg({},i,{key:t}));return a.addEventListener("dispose",()=>{delete s[t],this.dispatchEvent({type:"change",attribute:e,key:t})}),s[t]=a,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(kg({},e,{target:this})),this.graph.dispatchEvent(kg({},e,{target:this,type:`node:${e.type}`})),this}}const o6="v3.10.1",yw="@glb.bin";var Ft,ww,hs,yA,qu;(function(n){n.ACCESSOR="Accessor",n.ANIMATION="Animation",n.ANIMATION_CHANNEL="AnimationChannel",n.ANIMATION_SAMPLER="AnimationSampler",n.BUFFER="Buffer",n.CAMERA="Camera",n.MATERIAL="Material",n.MESH="Mesh",n.PRIMITIVE="Primitive",n.PRIMITIVE_TARGET="PrimitiveTarget",n.NODE="Node",n.ROOT="Root",n.SCENE="Scene",n.SKIN="Skin",n.TEXTURE="Texture",n.TEXTURE_INFO="TextureInfo"})(Ft||(Ft={})),function(n){n.INTERLEAVED="interleaved",n.SEPARATE="separate"}(ww||(ww={})),function(n){n.ARRAY_BUFFER="ARRAY_BUFFER",n.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",n.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",n.OTHER="OTHER",n.SPARSE="SPARSE"}(hs||(hs={})),function(n){n[n.R=4096]="R",n[n.G=256]="G",n[n.B=16]="B",n[n.A=1]="A"}(yA||(yA={})),function(n){n.GLTF="GLTF",n.GLB="GLB"}(qu||(qu={}));const Sw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var A_,wA=typeof Float32Array<"u"?Float32Array:Array;function nC(n){return Math.hypot(n[0],n[1],n[2])}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)}),A_=new wA(3),wA!=Float32Array&&(A_[0]=0,A_[1]=0,A_[2]=0);class $t{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}{const t=e.split(",")[1],r=e.indexOf("base64")>=0;return Buffer.from(t,r?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const s of e)t+=s.byteLength;const r=new Uint8Array(t);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r}static pad(e,t=0){const r=this.padNumber(e.byteLength);if(r===e.byteLength)return e;const i=new Uint8Array(r);if(i.set(e),t!==0)for(let s=e.byteLength;s<r;s++)i[s]=t;return i}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let r=e.byteLength;for(;r--;)if(e[r]!==t[r])return!1;return!0}static toView(e,t=0,r=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,r))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}let M_=class{static hexToFactor(e,t){e=Math.floor(e);const r=t;return r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[r,i,s]=this.convertLinearToSRGB(e,t);return 255*r<<16^255*i<<8^255*s<<0}static convertSRGBToLinear(e,t){const r=e,i=t;for(let s=0;s<3;s++)i[s]=r[s]<.04045?.0773993808*r[s]:Math.pow(.9478672986*r[s]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const r=e,i=t;for(let s=0;s<3;s++)i[s]=r[s]<.0031308?12.92*r[s]:1.055*Math.pow(r[s],.41666)-.055;return t}},a6=class l6{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return $t.decodeText(e.slice(12,16))===l6.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}};a6.PNG_FRIED_CHUNK_NAME="CgBI";let Zu=class{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let r=0;const i=this.getSize(e,t);if(!i)return null;for(;i[0]>1||i[1]>1;)r+=i[0]*i[1]*4,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return r+=4,r}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}};function rae(n,e){if(e>n.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(n.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return n}Zu.impls={"image/jpeg":new class{match(n){return n.length>=3&&n[0]===255&&n[1]===216&&n[2]===255}getSize(n){let e,t,r=new DataView(n.buffer,n.byteOffset+4);for(;r.byteLength;){if(e=r.getUint16(0,!1),rae(r,e),t=r.getUint8(e+1),t===192||t===193||t===194)return[r.getUint16(e+7,!1),r.getUint16(e+5,!1)];r=new DataView(n.buffer,r.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(n){return 3}},"image/png":new a6};let Tp=class{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return Zu.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}};function ZD(n){return Object.prototype.toString.call(n)==="[object Object]"}function Du(n){if(ZD(n)===!1)return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return ZD(t)!==!1&&Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")!==!1}var rC,SA;(function(n){n[n.SILENT=4]="SILENT",n[n.ERROR=3]="ERROR",n[n.WARN=2]="WARN",n[n.INFO=1]="INFO",n[n.DEBUG=0]="DEBUG"})(SA||(SA={}));class Us{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Us.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Us.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Us.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Us.Verbosity.ERROR&&console.error(e)}}function iae(n,e,t){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=e[9],p=e[10],_=e[11],y=e[12],g=e[13],m=e[14],v=e[15],x=t[0],w=t[1],E=t[2],S=t[3];return n[0]=x*r+w*a+E*h+S*y,n[1]=x*i+w*l+E*f+S*g,n[2]=x*s+w*c+E*p+S*m,n[3]=x*o+w*u+E*_+S*v,n[4]=(x=t[4])*r+(w=t[5])*a+(E=t[6])*h+(S=t[7])*y,n[5]=x*i+w*l+E*f+S*g,n[6]=x*s+w*c+E*p+S*m,n[7]=x*o+w*u+E*_+S*v,n[8]=(x=t[8])*r+(w=t[9])*a+(E=t[10])*h+(S=t[11])*y,n[9]=x*i+w*l+E*f+S*g,n[10]=x*s+w*c+E*p+S*m,n[11]=x*o+w*u+E*_+S*v,n[12]=(x=t[12])*r+(w=t[13])*a+(E=t[14])*h+(S=t[15])*y,n[13]=x*i+w*l+E*f+S*g,n[14]=x*s+w*c+E*p+S*m,n[15]=x*o+w*u+E*_+S*v,n}rC=Us,Us.Verbosity=SA,Us.DEFAULT_INSTANCE=new rC(rC.Verbosity.INFO);class Qn{static identity(e){return e}static eq(e,t,r=1e-5){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(Math.abs(e[i]-t[i])>r)return!1;return!0}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,t){return Qn.decodeNormalizedInt(e,t)}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,t){return Qn.encodeNormalizedInt(e,t)}static decompose(e,t,r,i){let s=nC([e[0],e[1],e[2]]);const o=nC([e[4],e[5],e[6]]),a=nC([e[8],e[9],e[10]]);var l,c,u,h,f,p,_,y,g,m,v,x,w,E,S,C,A;((c=(l=e)[0])*(_=l[5])-(u=l[1])*(p=l[4]))*((x=l[10])*(A=l[15])-(w=l[11])*(C=l[14]))-(c*(y=l[6])-(h=l[2])*p)*((v=l[9])*A-w*(S=l[13]))+(c*(g=l[7])-(f=l[3])*p)*(v*C-x*S)+(u*y-h*_)*((m=l[8])*A-w*(E=l[12]))-(u*g-f*_)*(m*C-x*E)+(h*g-f*y)*(m*S-v*E)<0&&(s=-s),t[0]=e[12],t[1]=e[13],t[2]=e[14];const k=e.slice(),T=1/s,R=1/o,$=1/a;k[0]*=T,k[1]*=T,k[2]*=T,k[4]*=R,k[5]*=R,k[6]*=R,k[8]*=$,k[9]*=$,k[10]*=$,function(P,M){var I=new wA(3);(function(he,ve){var Y=ve[4],Ne=ve[5],Re=ve[6],Ve=ve[8],Ue=ve[9],Je=ve[10];he[0]=Math.hypot(ve[0],ve[1],ve[2]),he[1]=Math.hypot(Y,Ne,Re),he[2]=Math.hypot(Ve,Ue,Je)})(I,M);var j=1/I[0],O=1/I[1],z=1/I[2],B=M[0]*j,L=M[1]*O,D=M[2]*z,W=M[4]*j,H=M[5]*O,K=M[6]*z,oe=M[8]*j,me=M[9]*O,Se=M[10]*z,Te=B+H+Se,G=0;Te>0?(G=2*Math.sqrt(Te+1),P[3]=.25*G,P[0]=(K-me)/G,P[1]=(oe-D)/G,P[2]=(L-W)/G):B>H&&B>Se?(G=2*Math.sqrt(1+B-H-Se),P[3]=(K-me)/G,P[0]=.25*G,P[1]=(L+W)/G,P[2]=(oe+D)/G):H>Se?(G=2*Math.sqrt(1+H-B-Se),P[3]=(oe-D)/G,P[0]=(L+W)/G,P[1]=.25*G,P[2]=(K+me)/G):(G=2*Math.sqrt(1+Se-B-H),P[3]=(L-W)/G,P[0]=(oe+D)/G,P[1]=(K+me)/G,P[2]=.25*G)}(r,k),i[0]=s,i[1]=o,i[2]=a}static compose(e,t,r,i){const s=i,o=t[0],a=t[1],l=t[2],c=t[3],u=o+o,h=a+a,f=l+l,p=o*u,_=o*h,y=o*f,g=a*h,m=a*f,v=l*f,x=c*u,w=c*h,E=c*f,S=r[0],C=r[1],A=r[2];return s[0]=(1-(g+v))*S,s[1]=(_+E)*S,s[2]=(y-w)*S,s[3]=0,s[4]=(_-E)*C,s[5]=(1-(p+v))*C,s[6]=(m+x)*C,s[7]=0,s[8]=(y+w)*A,s[9]=(m-x)*A,s[10]=(1-(p+g))*A,s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s}}function sae(n,e){if(!!n!=!!e)return!1;const t=n.getChild(),r=e.getChild();return t===r||t.equals(r)}function oae(n,e){if(!!n!=!!e||n.length!==e.length)return!1;for(let t=0;t<n.length;t++){const r=n[t],i=e[t];if(r.getChild()!==i.getChild()&&!r.getChild().equals(i.getChild()))return!1}return!0}function aae(n,e){if(!!n!=!!e)return!1;const t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(const i in n){const s=n[i],o=e[i];if(!!s!=!!o)return!1;const a=s.getChild(),l=o.getChild();if(a!==l&&!a.equals(l))return!1}return!0}function c6(n,e){if(n===e)return!0;if(!!n!=!!e||!n||!e||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function u6(n,e){if(n===e)return!0;if(!!n!=!!e)return!1;if(!Du(n)||!Du(e))return n===e;const t=n,r=e;let i,s=0,o=0;for(i in t)s++;for(i in r)o++;if(s!==o)return!1;for(i in t){const a=t[i],l=r[i];if(Ew(a)&&Ew(l)){if(!c6(a,l))return!1}else if(Du(a)&&Du(l)){if(!u6(a,l))return!1}else if(a!==l)return!1}return!0}function Ew(n){return Array.isArray(n)||ArrayBuffer.isView(n)}const QD=new Set,lae=function(){let n="";for(let e=0;e<6;e++)n+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return n},cae=function(){for(let n=0;n<999;n++){const e=lae();if(!QD.has(e))return QD.add(e),e}return""},JD="https://null.example";let Lg=class{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return Tp.basename(new URL(e,JD).pathname)}static extension(e){return Tp.extension(new URL(e,JD).pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const r=e.split("/"),i=t.split("/");r.pop();for(let s=0;s<i.length;s++)i[s]!=="."&&(i[s]===".."?r.pop():r.push(i[s]));return r.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}};Lg.DEFAULT_INIT={},Lg.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const sl=n=>n,uae=new Set;class AN extends bN{constructor(e,t=""){super(e),this[sn].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,sl)}copy(e,t=sl){for(const r in this[sn]){const i=this[sn][r];if(i instanceof Ep)this[_f].has(r)||i.dispose();else if(ng(i))for(const s of i)s.dispose();else if(rg(i))for(const s in i)i[s].dispose()}for(const r in e[sn]){const i=this[sn][r],s=e[sn][r];if(s instanceof Ep)this[_f].has(r)?i.getChild().copy(t(s.getChild()),t):this.setRef(r,t(s.getChild()),s.getAttributes());else if(ng(s))for(const o of s)this.addRef(r,t(o.getChild()),o.getAttributes());else if(rg(s))for(const o in s){const a=s[o];this.setRefMap(r,o,t(a.getChild()),a.getAttributes())}else this[sn][r]=Du(s)?JSON.parse(JSON.stringify(s)):Array.isArray(s)||s instanceof ArrayBuffer||ArrayBuffer.isView(s)?s.slice():s}return this}equals(e,t=uae){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const r in this[sn]){if(t.has(r))continue;const i=this[sn][r],s=e[sn][r];if(xA(i)||xA(s)){if(!sae(i,s))return!1}else if(ng(i)||ng(s)){if(!oae(i,s))return!1}else if(rg(i)||rg(s)){if(!aae(i,s))return!1}else if(Du(i)||Du(s)){if(!u6(i,s))return!1}else if(Ew(i)||Ew(s)){if(!c6(i,s))return!1}else if(i!==s)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Ci extends AN{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class ft extends Ci{constructor(...e){super(...e),this.i=Qn.identity,this.o=Qn.identity}init(){this.propertyType=Ft.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:ft.Type.SCALAR,componentType:ft.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,t=sl){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case ft.Type.SCALAR:return 1;case ft.Type.VEC2:return 2;case ft.Type.VEC3:return 3;case ft.Type.VEC4:case ft.Type.MAT2:return 4;case ft.Type.MAT3:return 9;case ft.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case ft.ComponentType.BYTE:case ft.ComponentType.UNSIGNED_BYTE:return 1;case ft.ComponentType.SHORT:case ft.ComponentType.UNSIGNED_SHORT:return 2;case ft.ComponentType.UNSIGNED_INT:case ft.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMin(e){const t=this.get("array"),r=this.getCount(),i=this.getElementSize();for(let s=0;s<i;s++)e[s]=1/0;for(let s=0;s<r*i;s+=i)for(let o=0;o<i;o++){const a=t[s+o];Number.isFinite(a)&&(e[o]=Math.min(e[o],a))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let r=0;r<t;r++)e[r]=this.o(e[r]);return e}getMax(e){const t=this.get("array"),r=this.getCount(),i=this.getElementSize();for(let s=0;s<i;s++)e[s]=-1/0;for(let s=0;s<r*i;s+=i)for(let o=0;o<i;o++){const a=t[s+o];Number.isFinite(a)&&(e[o]=Math.max(e[o],a))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return ft.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=t=>Qn.decodeNormalizedInt(t,this.get("componentType")),this.i=t=>Qn.encodeNormalizedInt(t,this.get("componentType"))):(this.o=Qn.identity,this.i=Qn.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const r=this.getElementSize(),i=this.get("array");for(let s=0;s<r;s++)t[s]=this.o(i[e*r+s]);return t}setElement(e,t){const r=this.getElementSize(),i=this.get("array");for(let s=0;s<r;s++)i[e*r+s]=this.i(t[s]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(t){switch(t.constructor){case Float32Array:return ft.ComponentType.FLOAT;case Uint32Array:return ft.ComponentType.UNSIGNED_INT;case Uint16Array:return ft.ComponentType.UNSIGNED_SHORT;case Uint8Array:return ft.ComponentType.UNSIGNED_BYTE;case Int16Array:return ft.ComponentType.SHORT;case Int8Array:return ft.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):ft.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}ft.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},ft.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class d6 extends Ci{init(){this.propertyType=Ft.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}let h6=class extends Ci{init(){this.propertyType=Ft.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}};h6.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};let MN=class f6 extends Ci{init(){this.propertyType=Ft.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:f6.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:hs.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:hs.OTHER})}};MN.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};let p6=class extends Ci{init(){this.propertyType=Ft.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}},Vv=class m6 extends Ci{init(){this.propertyType=Ft.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:m6.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}};Vv.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};let dae=class extends AN{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}};dae.EXTENSION_NAME=void 0;let Kl=class EA extends Ci{init(){this.propertyType=Ft.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:EA.WrapMode.REPEAT,wrapT:EA.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}};Kl.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Kl.MagFilter={NEAREST:9728,LINEAR:9729},Kl.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:R_,G:N_,B:I_,A:hae}=yA;class vd extends Ci{init(){this.propertyType=Ft.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:vd.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Kl(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Kl(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Kl(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Kl(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Kl(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return M_.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",M_.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:R_|N_|I_|hae,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return M_.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",M_.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:R_|N_|I_,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:R_|N_|I_})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:R_})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:N_|I_})}}vd.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};let g6=class extends Ci{init(){this.propertyType=Ft.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}},v6=class extends Ci{constructor(...e){super(...e),this.u=null,this.h=new Set}init(){this.propertyType=Ft.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=sl){if(t===sl)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Qn.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),r=this.get("rotation").slice(),i=this.get("scale").slice();return Qn.decompose(e,t,r,i),this.set("translation",t).set("rotation",r).set("scale",i)}getWorldTranslation(){const e=[0,0,0];return Qn.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Qn.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Qn.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let i=this;i!=null;i=i.u)e.push(i);let t;const r=e.pop().getMatrix();for(;t=e.pop();)iae(r,r,t.getMatrix());return r}addChild(e){if(e.u&&e.u.removeChild(e),e.h.size)for(const r of e.h)r.removeChild(e);this.addRef("children",e),e.u=this;const t=this[sn].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===Ft.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}},_6=class x6 extends Ci{init(){this.propertyType=Ft.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:x6.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:hs.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:hs.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}};_6.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};let fae=class extends AN{init(){this.propertyType=Ft.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:hs.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}};function xi(){return xi=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},xi.apply(this,arguments)}let y6=class extends Ci{init(){this.propertyType=Ft.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=sl){if(t===sl)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.h.add(this);const t=this[sn].children;return t[t.length-1].addEventListener("dispose",()=>e.h.delete(this)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}};class w6 extends Ci{init(){this.propertyType=Ft.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:hs.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class S6 extends Ci{init(){this.propertyType=Ft.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Zu.extensionToMimeType(Tp.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=Zu.extensionToMimeType(Tp.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",$t.assertView(e))}getSize(){const e=this.get("image");return e?Zu.getSize(e,this.getMimeType()):null}}let pae=class extends Ci{init(){this.propertyType=Ft.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${o6}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.l=new Set,e.addEventListener("node:create",t=>{this.g(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=sl){if(t===sl)throw new Error("Root cannot be copied.");this.set("asset",xi({},e.get("asset"))),this.setName(e.getName()),this.setExtras(xi({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const r of e.listRefMapKeys("extensions")){const i=e.getExtension(r);this.setExtension(r,t(i))}return this}g(e){return e instanceof y6?this.addRef("scenes",e):e instanceof v6?this.addRef("nodes",e):e instanceof Vv?this.addRef("cameras",e):e instanceof w6?this.addRef("skins",e):e instanceof g6?this.addRef("meshes",e):e instanceof vd?this.addRef("materials",e):e instanceof S6?this.addRef("textures",e):e instanceof d6?this.addRef("animations",e):e instanceof ft?this.addRef("accessors",e):e instanceof p6&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.l)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}p(e){return this.l.add(e),this}m(e){return this.l.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}},E6=class Ex{static fromGraph(e){return Ex.v.get(e)||null}constructor(){this.T=new eae,this.S=new pae(this.T),this.M=Us.DEFAULT_INSTANCE,Ex.v.set(this.T,this)}getRoot(){return this.S}getGraph(){return this.T}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new Ex().setLogger(this.M).merge(this)}merge(e){for(const s of e.getRoot().listExtensionsUsed()){const o=this.createExtension(s.constructor);s.isRequired()&&o.setRequired(!0)}const t=new Set,r=new Map;t.add(e.S),r.set(e.S,this.S);for(const s of e.T.listEdges())for(const o of[s.getParent(),s.getChild()]){if(t.has(o))continue;let a;a=o.propertyType===Ft.TEXTURE_INFO?o:new o.constructor(this.T),r.set(o,a),t.add(o)}const i=s=>{const o=r.get(s);if(!o)throw new Error("Could resolve property.");return o};for(const s of t){const o=r.get(s);if(!o)throw new Error("Could resolve property.");o.propertyType!==Ft.TEXTURE_INFO&&o.copy(s,i)}return this}async transform(...e){const t=e.map(r=>r.name);for(const r of e)await r(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(r=>r.extensionName===t)||new e(this)}createScene(e=""){return new y6(this.T,e)}createNode(e=""){return new v6(this.T,e)}createCamera(e=""){return new Vv(this.T,e)}createSkin(e=""){return new w6(this.T,e)}createMesh(e=""){return new g6(this.T,e)}createPrimitive(){return new _6(this.T)}createPrimitiveTarget(e=""){return new fae(this.T,e)}createMaterial(e=""){return new vd(this.T,e)}createTexture(e=""){return new S6(this.T,e)}createAnimation(e=""){return new d6(this.T,e)}createAnimationChannel(e=""){return new h6(this.T,e)}createAnimationSampler(e=""){return new MN(this.T,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new ft(this.T,e).setBuffer(t)}createBuffer(e=""){return new p6(this.T,e)}};E6.v=new WeakMap;let mae=class{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const r=this.jsonDoc.json.textures[t.index];if(r.sampler===void 0)return;const i=this.jsonDoc.json.samplers[r.sampler];i.magFilter!==void 0&&e.setMagFilter(i.magFilter),i.minFilter!==void 0&&e.setMinFilter(i.minFilter),i.wrapS!==void 0&&e.setWrapS(i.wrapS),i.wrapT!==void 0&&e.setWrapT(i.wrapT)}};const e3={logger:Us.DEFAULT_INSTANCE,extensions:[],dependencies:{}};class gae{static read(e,t=e3){const r=xi({},e3,t),{json:i}=e,s=new E6().setLogger(r.logger);this.validate(e,r);const o=new mae(e),a=i.asset,l=s.getRoot().getAsset();a.copyright&&(l.copyright=a.copyright),a.extras&&(l.extras=a.extras),i.extras!==void 0&&s.getRoot().setExtras(xi({},i.extras));const c=i.extensionsUsed||[],u=i.extensionsRequired||[];for(const v of r.extensions)if(c.includes(v.EXTENSION_NAME)){const x=s.createExtension(v).setRequired(u.includes(v.EXTENSION_NAME));for(const w of x.readDependencies)x.install(w,r.dependencies[w])}const h=i.buffers||[];s.getRoot().listExtensionsUsed().filter(v=>v.prereadTypes.includes(Ft.BUFFER)).forEach(v=>v.preread(o,Ft.BUFFER)),o.buffers=h.map(v=>{const x=s.createBuffer(v.name);return v.extras&&x.setExtras(v.extras),v.uri&&v.uri.indexOf("__")!==0&&x.setURI(v.uri),x}),o.bufferViewBuffers=(i.bufferViews||[]).map((v,x)=>{if(!o.bufferViews[x]){const w=e.json.buffers[v.buffer];o.bufferViews[x]=$t.toView(w.uri?e.resources[w.uri]:e.resources[yw],v.byteOffset||0,v.byteLength)}return o.buffers[v.buffer]});const f=i.accessors||[];o.accessors=f.map(v=>{const x=s.createAccessor(v.name,o.bufferViewBuffers[v.bufferView]).setType(v.type);return v.extras&&x.setExtras(v.extras),v.normalized!==void 0&&x.setNormalized(v.normalized),v.bufferView===void 0||x.setArray(P_(v,o)),x});const p=i.images||[],_=i.textures||[];s.getRoot().listExtensionsUsed().filter(v=>v.prereadTypes.includes(Ft.TEXTURE)).forEach(v=>v.preread(o,Ft.TEXTURE)),o.textures=p.map(v=>{const x=s.createTexture(v.name);if(v.extras&&x.setExtras(v.extras),v.bufferView!==void 0){const w=i.bufferViews[v.bufferView],E=e.json.buffers[w.buffer],S=w.byteOffset||0,C=(E.uri?e.resources[E.uri]:e.resources[yw]).slice(S,S+w.byteLength);x.setImage(C)}else v.uri!==void 0&&(x.setImage(e.resources[v.uri]),v.uri.indexOf("__")!==0&&x.setURI(v.uri));if(v.mimeType!==void 0)x.setMimeType(v.mimeType);else if(v.uri){const w=Tp.extension(v.uri);x.setMimeType(Zu.extensionToMimeType(w))}return x}),o.materials=(i.materials||[]).map(v=>{const x=s.createMaterial(v.name);v.extras&&x.setExtras(v.extras),v.alphaMode!==void 0&&x.setAlphaMode(v.alphaMode),v.alphaCutoff!==void 0&&x.setAlphaCutoff(v.alphaCutoff),v.doubleSided!==void 0&&x.setDoubleSided(v.doubleSided);const w=v.pbrMetallicRoughness||{};if(w.baseColorFactor!==void 0&&x.setBaseColorFactor(w.baseColorFactor),v.emissiveFactor!==void 0&&x.setEmissiveFactor(v.emissiveFactor),w.metallicFactor!==void 0&&x.setMetallicFactor(w.metallicFactor),w.roughnessFactor!==void 0&&x.setRoughnessFactor(w.roughnessFactor),w.baseColorTexture!==void 0){const E=w.baseColorTexture;x.setBaseColorTexture(o.textures[_[E.index].source]),o.setTextureInfo(x.getBaseColorTextureInfo(),E)}if(v.emissiveTexture!==void 0){const E=v.emissiveTexture;x.setEmissiveTexture(o.textures[_[E.index].source]),o.setTextureInfo(x.getEmissiveTextureInfo(),E)}if(v.normalTexture!==void 0){const E=v.normalTexture;x.setNormalTexture(o.textures[_[E.index].source]),o.setTextureInfo(x.getNormalTextureInfo(),E),v.normalTexture.scale!==void 0&&x.setNormalScale(v.normalTexture.scale)}if(v.occlusionTexture!==void 0){const E=v.occlusionTexture;x.setOcclusionTexture(o.textures[_[E.index].source]),o.setTextureInfo(x.getOcclusionTextureInfo(),E),v.occlusionTexture.strength!==void 0&&x.setOcclusionStrength(v.occlusionTexture.strength)}if(w.metallicRoughnessTexture!==void 0){const E=w.metallicRoughnessTexture;x.setMetallicRoughnessTexture(o.textures[_[E.index].source]),o.setTextureInfo(x.getMetallicRoughnessTextureInfo(),E)}return x});const y=i.meshes||[];s.getRoot().listExtensionsUsed().filter(v=>v.prereadTypes.includes(Ft.PRIMITIVE)).forEach(v=>v.preread(o,Ft.PRIMITIVE)),o.meshes=y.map(v=>{const x=s.createMesh(v.name);return v.extras&&x.setExtras(v.extras),v.weights!==void 0&&x.setWeights(v.weights),(v.primitives||[]).forEach(w=>{const E=s.createPrimitive();w.extras&&E.setExtras(w.extras),w.material!==void 0&&E.setMaterial(o.materials[w.material]),w.mode!==void 0&&E.setMode(w.mode);for(const[C,A]of Object.entries(w.attributes||{}))E.setAttribute(C,o.accessors[A]);w.indices!==void 0&&E.setIndices(o.accessors[w.indices]);const S=v.extras&&v.extras.targetNames||[];(w.targets||[]).forEach((C,A)=>{const k=S[A]||A.toString(),T=s.createPrimitiveTarget(k);for(const[R,$]of Object.entries(C))T.setAttribute(R,o.accessors[$]);E.addTarget(T)}),x.addPrimitive(E)}),x}),o.cameras=(i.cameras||[]).map(v=>{const x=s.createCamera(v.name).setType(v.type);if(v.extras&&x.setExtras(v.extras),v.type===Vv.Type.PERSPECTIVE){const w=v.perspective;x.setYFov(w.yfov),x.setZNear(w.znear),w.zfar!==void 0&&x.setZFar(w.zfar),w.aspectRatio!==void 0&&x.setAspectRatio(w.aspectRatio)}else{const w=v.orthographic;x.setZNear(w.znear).setZFar(w.zfar).setXMag(w.xmag).setYMag(w.ymag)}return x});const g=i.nodes||[];s.getRoot().listExtensionsUsed().filter(v=>v.prereadTypes.includes(Ft.NODE)).forEach(v=>v.preread(o,Ft.NODE)),o.nodes=g.map(v=>{const x=s.createNode(v.name);if(v.extras&&x.setExtras(v.extras),v.translation!==void 0&&x.setTranslation(v.translation),v.rotation!==void 0&&x.setRotation(v.rotation),v.scale!==void 0&&x.setScale(v.scale),v.matrix!==void 0){const w=[0,0,0],E=[0,0,0,1],S=[1,1,1];Qn.decompose(v.matrix,w,E,S),x.setTranslation(w),x.setRotation(E),x.setScale(S)}return v.weights!==void 0&&x.setWeights(v.weights),x}),o.skins=(i.skins||[]).map(v=>{const x=s.createSkin(v.name);v.extras&&x.setExtras(v.extras),v.inverseBindMatrices!==void 0&&x.setInverseBindMatrices(o.accessors[v.inverseBindMatrices]),v.skeleton!==void 0&&x.setSkeleton(o.nodes[v.skeleton]);for(const w of v.joints)x.addJoint(o.nodes[w]);return x}),g.map((v,x)=>{const w=o.nodes[x];(v.children||[]).forEach(E=>w.addChild(o.nodes[E])),v.mesh!==void 0&&w.setMesh(o.meshes[v.mesh]),v.camera!==void 0&&w.setCamera(o.cameras[v.camera]),v.skin!==void 0&&w.setSkin(o.skins[v.skin])}),o.animations=(i.animations||[]).map(v=>{const x=s.createAnimation(v.name);v.extras&&x.setExtras(v.extras);const w=(v.samplers||[]).map(E=>{const S=s.createAnimationSampler().setInput(o.accessors[E.input]).setOutput(o.accessors[E.output]).setInterpolation(E.interpolation||MN.Interpolation.LINEAR);return E.extras&&S.setExtras(E.extras),x.addSampler(S),S});return(v.channels||[]).forEach(E=>{const S=s.createAnimationChannel().setSampler(w[E.sampler]).setTargetPath(E.target.path);E.target.node!==void 0&&S.setTargetNode(o.nodes[E.target.node]),E.extras&&S.setExtras(E.extras),x.addChannel(S)}),x});const m=i.scenes||[];return s.getRoot().listExtensionsUsed().filter(v=>v.prereadTypes.includes(Ft.SCENE)).forEach(v=>v.preread(o,Ft.SCENE)),o.scenes=m.map(v=>{const x=s.createScene(v.name);return v.extras&&x.setExtras(v.extras),(v.nodes||[]).map(w=>o.nodes[w]).forEach(w=>x.addChild(w)),x}),i.scene!==void 0&&s.getRoot().setDefaultScene(o.scenes[i.scene]),s.getRoot().listExtensionsUsed().forEach(v=>v.read(o)),f.forEach((v,x)=>{const w=o.accessors[x],E=!!v.sparse,S=!v.bufferView&&!w.getArray();(E||S)&&w.setSparse(!0).setArray(function(C,A){const k=Sw[C.componentType],T=ft.getElementSize(C.type);let R;R=C.bufferView!==void 0?P_(C,A):new k(C.count*T);const $=C.sparse;if(!$)return R;const P=$.count,M=xi({},C,$.indices,{count:P,type:"SCALAR"}),I=xi({},C,$.values,{count:P}),j=P_(M,A),O=P_(I,A);for(let z=0;z<M.count;z++)for(let B=0;B<T;B++)R[j[z]*T+B]=O[z*T+B];return R}(v,o))}),s}static validate(e,t){const r=e.json;if(r.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${r.asset.version}".`);if(r.extensionsRequired){for(const i of r.extensionsRequired)if(!t.extensions.find(s=>s.EXTENSION_NAME===i))throw new Error(`Missing required extension, "${i}".`)}if(r.extensionsUsed)for(const i of r.extensionsUsed)t.extensions.find(s=>s.EXTENSION_NAME===i)||t.logger.warn(`Missing optional extension, "${i}".`)}}function P_(n,e){const t=e.bufferViews[n.bufferView],r=e.jsonDoc.json.bufferViews[n.bufferView],i=Sw[n.componentType],s=ft.getElementSize(n.type),o=i.BYTES_PER_ELEMENT;if(r.byteStride!==void 0&&r.byteStride!==s*o)return function(l,c){const u=c.bufferViews[l.bufferView],h=c.jsonDoc.json.bufferViews[l.bufferView],f=Sw[l.componentType],p=ft.getElementSize(l.type),_=f.BYTES_PER_ELEMENT,y=l.byteOffset||0,g=new f(l.count*p),m=new DataView(u.buffer,u.byteOffset,u.byteLength),v=h.byteStride;for(let x=0;x<l.count;x++)for(let w=0;w<p;w++){const E=y+x*v+w*_;let S;switch(l.componentType){case ft.ComponentType.FLOAT:S=m.getFloat32(E,!0);break;case ft.ComponentType.UNSIGNED_INT:S=m.getUint32(E,!0);break;case ft.ComponentType.UNSIGNED_SHORT:S=m.getUint16(E,!0);break;case ft.ComponentType.UNSIGNED_BYTE:S=m.getUint8(E);break;case ft.ComponentType.SHORT:S=m.getInt16(E,!0);break;case ft.ComponentType.BYTE:S=m.getInt8(E);break;default:throw new Error(`Unexpected componentType "${l.componentType}".`)}g[x*p+w]=S}return g}(n,e);const a=t.byteOffset+(n.byteOffset||0);return new i(t.buffer.slice(a,a+n.count*s*o))}var Og;(function(n){n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Og||(Og={}));class Qu{constructor(e,t,r){this.C=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.F=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.C=e,this.jsonDoc=t,this.options=r;const i=e.getRoot(),s=i.listBuffers().length,o=i.listTextures().length;this.bufferURIGenerator=new t3(s>1,()=>r.basename||"buffer"),this.imageURIGenerator=new t3(o>1,a=>function(l,c){const u=l.getGraph().listParentEdges(c).find(h=>h.getParent()!==l.getRoot());return u?u.getName().replace(/texture$/i,""):""}(e,a)||r.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const r={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},i=JSON.stringify(r);this.samplerDefIndexMap.has(i)||(this.samplerDefIndexMap.set(i,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(r));const s={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(i)},o=JSON.stringify(s);this.textureDefIndexMap.has(o)||(this.textureDefIndexMap.set(o,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(s));const a={index:this.textureDefIndexMap.get(o)};return t.getTexCoord()!==0&&(a.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(a.extras=t.getExtras()),this.textureInfoDefMap.set(t,a),a}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.C.getGraph().listParentEdges(e).some(r=>r.getName()==="attributes"&&r.getAttributes().key==="POSITION"||r.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,r){if(this.options.format===qu.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const i=Zu.mimeTypeToExtension(r.getMimeType());e.uri=this.imageURIGenerator.createURI(r,i),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.F.get(e);if(t)return t;if(e.getSparse())return hs.SPARSE;for(const r of this.C.getGraph().listParentEdges(e)){const{usage:i}=r.getAttributes();if(i)return i;r.getParent().propertyType!==Ft.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${r.getName()}".`)}return hs.OTHER}addAccessorToUsageGroup(e,t){const r=this.F.get(e);if(r&&r!==t)throw new Error(`Accessor with usage "${r}" cannot be reused as "${t}".`);return this.F.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,r]of Array.from(this.F.entries()))e[r]=e[r]||[],e[r].push(t);return e}}Qu.BufferViewTarget=Og,Qu.BufferViewUsage=hs,Qu.USAGE_TO_TARGET={[hs.ARRAY_BUFFER]:Og.ARRAY_BUFFER,[hs.ELEMENT_ARRAY_BUFFER]:Og.ELEMENT_ARRAY_BUFFER};class t3{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const r=this.basename(e);return this.counter[r]=this.counter[r]||1,`${r}_${this.counter[r]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:k_}=Qu,{UNSIGNED_INT:vae,UNSIGNED_SHORT:_ae,UNSIGNED_BYTE:xae}=ft.ComponentType;class yae{static write(e,t){const r=e.getRoot(),i={asset:xi({generator:`glTF-Transform ${o6}`},r.getAsset()),extras:xi({},r.getExtras())},s={json:i,resources:{}},o=new Qu(e,s,t),a=t.logger||Us.DEFAULT_INSTANCE,l=new Set(t.extensions.map(g=>g.EXTENSION_NAME)),c=e.getRoot().listExtensionsUsed().filter(g=>l.has(g.extensionName)),u=e.getRoot().listExtensionsRequired().filter(g=>l.has(g.extensionName));c.length<e.getRoot().listExtensionsUsed().length&&a.warn("Some extensions were not registered for I/O, and will not be written.");for(const g of c)for(const m of g.writeDependencies)g.install(m,t.dependencies[m]);function h(g,m,v,x){const w=[];let E=0;for(const C of g){const A=o.createAccessorDef(C);A.bufferView=i.bufferViews.length;const k=C.getArray(),T=$t.pad($t.toView(k));A.byteOffset=E,E+=T.byteLength,w.push(T),o.accessorIndexMap.set(C,i.accessors.length),i.accessors.push(A)}const S={buffer:m,byteOffset:v,byteLength:$t.concat(w).byteLength};return x&&(S.target=x),i.bufferViews.push(S),{buffers:w,byteLength:E}}function f(g,m,v){const x=g[0].getCount();let w=0;for(const A of g){const k=o.createAccessorDef(A);k.bufferView=i.bufferViews.length,k.byteOffset=w;const T=A.getElementSize(),R=A.getComponentSize();w+=$t.padNumber(T*R),o.accessorIndexMap.set(A,i.accessors.length),i.accessors.push(k)}const E=x*w,S=new ArrayBuffer(E),C=new DataView(S);for(let A=0;A<x;A++){let k=0;for(const T of g){const R=T.getElementSize(),$=T.getComponentSize(),P=T.getComponentType(),M=T.getArray();for(let I=0;I<R;I++){const j=A*w+k+I*$,O=M[A*R+I];switch(P){case ft.ComponentType.FLOAT:C.setFloat32(j,O,!0);break;case ft.ComponentType.BYTE:C.setInt8(j,O);break;case ft.ComponentType.SHORT:C.setInt16(j,O,!0);break;case ft.ComponentType.UNSIGNED_BYTE:C.setUint8(j,O);break;case ft.ComponentType.UNSIGNED_SHORT:C.setUint16(j,O,!0);break;case ft.ComponentType.UNSIGNED_INT:C.setUint32(j,O,!0);break;default:throw new Error("Unexpected component type: "+P)}}k+=$t.padNumber(R*$)}}return i.bufferViews.push({buffer:m,byteOffset:v,byteLength:E,byteStride:w,target:Qu.BufferViewTarget.ARRAY_BUFFER}),{byteLength:E,buffers:[new Uint8Array(S)]}}function p(g,m,v){const x=[];let w=0;const E=new Map;let S=-1/0;for(const P of g){const M=o.createAccessorDef(P);i.accessors.push(M),o.accessorIndexMap.set(P,i.accessors.length-1);const I=[],j=[],O=[],z=new Array(P.getElementSize()).fill(0);for(let W=0,H=P.getCount();W<H;W++)if(P.getElement(W,O),!Qn.eq(O,z,0)){S=Math.max(W,S),I.push(W);for(let K=0;K<O.length;K++)j.push(O[K])}const B=I.length,L={accessorDef:M,count:B};if(E.set(P,L),B===0)continue;if(B>P.getCount()/3){const W=(100*I.length/P.getCount()).toFixed(1);a.warn(`Sparse accessor with many non-zero elements (${W}%) may increase file size.`)}const D=Sw[P.getComponentType()];L.indices=I,L.values=new D(j)}if(!Number.isFinite(S))return{buffers:x,byteLength:w};const C=S<255?Uint8Array:S<65535?Uint16Array:Uint32Array,A=S<255?xae:S<65535?_ae:vae,k={buffer:m,byteOffset:v+w,byteLength:0};for(const P of g){const M=E.get(P);if(M.count===0)continue;M.indicesByteOffset=k.byteLength;const I=$t.pad($t.toView(new C(M.indices)));x.push(I),w+=I.byteLength,k.byteLength+=I.byteLength}i.bufferViews.push(k);const T=i.bufferViews.length-1,R={buffer:m,byteOffset:v+w,byteLength:0};for(const P of g){const M=E.get(P);if(M.count===0)continue;M.valuesByteOffset=R.byteLength;const I=$t.pad($t.toView(M.values));x.push(I),w+=I.byteLength,R.byteLength+=I.byteLength}i.bufferViews.push(R);const $=i.bufferViews.length-1;for(const P of g){const M=E.get(P);M.count!==0&&(M.accessorDef.sparse={count:M.count,indices:{bufferView:T,byteOffset:M.indicesByteOffset,componentType:A},values:{bufferView:$,byteOffset:M.valuesByteOffset}})}return{buffers:x,byteLength:w}}const _=new Map;for(const g of e.getGraph().listEdges()){if(g.getParent()===r)continue;const m=g.getChild();if(m instanceof ft){const v=_.get(m)||[];v.push(g),_.set(m,v)}}if(i.accessors=[],i.bufferViews=[],i.samplers=[],i.textures=[],i.images=r.listTextures().map((g,m)=>{const v=o.createPropertyDef(g);g.getMimeType()&&(v.mimeType=g.getMimeType());const x=g.getImage();return x&&o.createImageData(v,x,g),o.imageIndexMap.set(g,m),v}),c.filter(g=>g.prewriteTypes.includes(Ft.ACCESSOR)).forEach(g=>g.prewrite(o,Ft.ACCESSOR)),r.listAccessors().forEach(g=>{const m=o.accessorUsageGroupedByParent,v=o.accessorParents;if(o.accessorIndexMap.has(g))return;const x=_.get(g)||[],w=o.getAccessorUsage(g);if(o.addAccessorToUsageGroup(g,w),m.has(w)){const E=x[0].getParent(),S=v.get(E)||new Set;S.add(g),v.set(E,S)}}),c.filter(g=>g.prewriteTypes.includes(Ft.BUFFER)).forEach(g=>g.prewrite(o,Ft.BUFFER)),(r.listAccessors().length>0||r.listTextures().length>0||o.otherBufferViews.size>0)&&r.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");i.buffers=[],r.listBuffers().forEach((g,m)=>{const v=o.createPropertyDef(g),x=o.accessorUsageGroupedByParent,w=o.accessorParents,E=g.listParents().filter(R=>R instanceof ft),S=new Set(E),C=[],A=i.buffers.length;let k=0;const T=o.listAccessorUsageGroups();for(const R in T)if(x.has(R))for(const $ of Array.from(w.values())){const P=Array.from($).filter(M=>S.has(M)).filter(M=>o.getAccessorUsage(M)===R);if(P.length)if(R!==k_.ARRAY_BUFFER||t.vertexLayout===ww.INTERLEAVED){const M=R===k_.ARRAY_BUFFER?f(P,A,k):h(P,A,k);k+=M.byteLength,C.push(...M.buffers)}else for(const M of P){const I=f([M],A,k);k+=I.byteLength,C.push(...I.buffers)}}else{const $=T[R].filter(I=>S.has(I));if(!$.length)continue;const P=R===k_.ELEMENT_ARRAY_BUFFER?Qu.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,M=R===k_.SPARSE?p($,A,k):h($,A,k,P);k+=M.byteLength,C.push(...M.buffers)}if(o.imageBufferViews.length&&m===0){for(let R=0;R<o.imageBufferViews.length;R++)if(i.bufferViews[i.images[R].bufferView].byteOffset=k,k+=o.imageBufferViews[R].byteLength,C.push(o.imageBufferViews[R]),k%8){const $=8-k%8;k+=$,C.push(new Uint8Array($))}}if(o.otherBufferViews.has(g))for(const R of o.otherBufferViews.get(g))i.bufferViews.push({buffer:A,byteOffset:k,byteLength:R.byteLength}),o.otherBufferViewsIndexMap.set(R,i.bufferViews.length-1),k+=R.byteLength,C.push(R);if(k){let R;t.format===qu.GLB?R=yw:(R=o.bufferURIGenerator.createURI(g,"bin"),v.uri=R),v.byteLength=k,s.resources[R]=$t.concat(C)}i.buffers.push(v),o.bufferIndexMap.set(g,m)}),r.listAccessors().find(g=>!g.getBuffer())&&a.warn("Skipped writing one or more Accessors: no Buffer assigned."),i.materials=r.listMaterials().map((g,m)=>{const v=o.createPropertyDef(g);if(g.getAlphaMode()!==vd.AlphaMode.OPAQUE&&(v.alphaMode=g.getAlphaMode()),g.getAlphaMode()===vd.AlphaMode.MASK&&(v.alphaCutoff=g.getAlphaCutoff()),g.getDoubleSided()&&(v.doubleSided=!0),v.pbrMetallicRoughness={},Qn.eq(g.getBaseColorFactor(),[1,1,1,1])||(v.pbrMetallicRoughness.baseColorFactor=g.getBaseColorFactor()),Qn.eq(g.getEmissiveFactor(),[0,0,0])||(v.emissiveFactor=g.getEmissiveFactor()),g.getRoughnessFactor()!==1&&(v.pbrMetallicRoughness.roughnessFactor=g.getRoughnessFactor()),g.getMetallicFactor()!==1&&(v.pbrMetallicRoughness.metallicFactor=g.getMetallicFactor()),g.getBaseColorTexture()){const x=g.getBaseColorTexture(),w=g.getBaseColorTextureInfo();v.pbrMetallicRoughness.baseColorTexture=o.createTextureInfoDef(x,w)}if(g.getEmissiveTexture()){const x=g.getEmissiveTexture(),w=g.getEmissiveTextureInfo();v.emissiveTexture=o.createTextureInfoDef(x,w)}if(g.getNormalTexture()){const x=g.getNormalTexture(),w=g.getNormalTextureInfo(),E=o.createTextureInfoDef(x,w);g.getNormalScale()!==1&&(E.scale=g.getNormalScale()),v.normalTexture=E}if(g.getOcclusionTexture()){const x=g.getOcclusionTexture(),w=g.getOcclusionTextureInfo(),E=o.createTextureInfoDef(x,w);g.getOcclusionStrength()!==1&&(E.strength=g.getOcclusionStrength()),v.occlusionTexture=E}if(g.getMetallicRoughnessTexture()){const x=g.getMetallicRoughnessTexture(),w=g.getMetallicRoughnessTextureInfo();v.pbrMetallicRoughness.metallicRoughnessTexture=o.createTextureInfoDef(x,w)}return o.materialIndexMap.set(g,m),v}),i.meshes=r.listMeshes().map((g,m)=>{const v=o.createPropertyDef(g);let x=null;return v.primitives=g.listPrimitives().map(w=>{const E={attributes:{}};E.mode=w.getMode();const S=w.getMaterial();S&&(E.material=o.materialIndexMap.get(S)),Object.keys(w.getExtras()).length&&(E.extras=w.getExtras());const C=w.getIndices();C&&(E.indices=o.accessorIndexMap.get(C));for(const A of w.listSemantics())E.attributes[A]=o.accessorIndexMap.get(w.getAttribute(A));for(const A of w.listTargets()){const k={};for(const T of A.listSemantics())k[T]=o.accessorIndexMap.get(A.getAttribute(T));E.targets=E.targets||[],E.targets.push(k)}return w.listTargets().length&&!x&&(x=w.listTargets().map(A=>A.getName())),E}),g.getWeights().length&&(v.weights=g.getWeights()),x&&(v.extras=v.extras||{},v.extras.targetNames=x),o.meshIndexMap.set(g,m),v}),i.cameras=r.listCameras().map((g,m)=>{const v=o.createPropertyDef(g);if(v.type=g.getType(),v.type===Vv.Type.PERSPECTIVE){v.perspective={znear:g.getZNear(),zfar:g.getZFar(),yfov:g.getYFov()};const x=g.getAspectRatio();x!==null&&(v.perspective.aspectRatio=x)}else v.orthographic={znear:g.getZNear(),zfar:g.getZFar(),xmag:g.getXMag(),ymag:g.getYMag()};return o.cameraIndexMap.set(g,m),v}),i.nodes=r.listNodes().map((g,m)=>{const v=o.createPropertyDef(g);return Qn.eq(g.getTranslation(),[0,0,0])||(v.translation=g.getTranslation()),Qn.eq(g.getRotation(),[0,0,0,1])||(v.rotation=g.getRotation()),Qn.eq(g.getScale(),[1,1,1])||(v.scale=g.getScale()),g.getWeights().length&&(v.weights=g.getWeights()),o.nodeIndexMap.set(g,m),v}),i.skins=r.listSkins().map((g,m)=>{const v=o.createPropertyDef(g),x=g.getInverseBindMatrices();x&&(v.inverseBindMatrices=o.accessorIndexMap.get(x));const w=g.getSkeleton();return w&&(v.skeleton=o.nodeIndexMap.get(w)),v.joints=g.listJoints().map(E=>o.nodeIndexMap.get(E)),o.skinIndexMap.set(g,m),v}),r.listNodes().forEach((g,m)=>{const v=i.nodes[m],x=g.getMesh();x&&(v.mesh=o.meshIndexMap.get(x));const w=g.getCamera();w&&(v.camera=o.cameraIndexMap.get(w));const E=g.getSkin();E&&(v.skin=o.skinIndexMap.get(E)),g.listChildren().length>0&&(v.children=g.listChildren().map(S=>o.nodeIndexMap.get(S)))}),i.animations=r.listAnimations().map((g,m)=>{const v=o.createPropertyDef(g),x=new Map;return v.samplers=g.listSamplers().map((w,E)=>{const S=o.createPropertyDef(w);return S.input=o.accessorIndexMap.get(w.getInput()),S.output=o.accessorIndexMap.get(w.getOutput()),S.interpolation=w.getInterpolation(),x.set(w,E),S}),v.channels=g.listChannels().map(w=>{const E=o.createPropertyDef(w);return E.sampler=x.get(w.getSampler()),E.target={node:o.nodeIndexMap.get(w.getTargetNode()),path:w.getTargetPath()},E}),o.animationIndexMap.set(g,m),v}),i.scenes=r.listScenes().map((g,m)=>{const v=o.createPropertyDef(g);return v.nodes=g.listChildren().map(x=>o.nodeIndexMap.get(x)),o.sceneIndexMap.set(g,m),v});const y=r.getDefaultScene();return y&&(i.scene=r.listScenes().indexOf(y)),i.extensionsUsed=c.map(g=>g.extensionName),i.extensionsRequired=u.map(g=>g.extensionName),c.forEach(g=>g.write(o)),function(g){const m=[];for(const v in g){const x=g[v];(Array.isArray(x)&&x.length===0||x===null||x===""||x&&typeof x=="object"&&Object.keys(x).length===0)&&m.push(v)}for(const v of m)delete g[v]}(i),s}}var Tw;(function(n){n[n.JSON=1313821514]="JSON",n[n.BIN=5130562]="BIN"})(Tw||(Tw={}));class wae{constructor(){this.M=Us.DEFAULT_INSTANCE,this.l=new Set,this.U={},this.P=ww.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const t of e)this.l.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.U,e),this}setVertexLayout(e){return this.P=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const r=n3(t)?this.L(t):{json:JSON.parse($t.decodeText(t)),resources:{}};return await this.j(r,this.dirname(e)),this.D(r),r}async readJSON(e){return e=this._(e),this.D(e),gae.read(e,{extensions:Array.from(this.l),dependencies:this.U,logger:this.M})}async binaryToJSON(e){const t=this.L($t.assertView(e));this.D(t);const r=t.json;if(r.buffers&&r.buffers.some(i=>function(s,o){return o.uri!==void 0&&!(o.uri in s.resources)}(t,i)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(r.images&&r.images.some(i=>function(s,o){return o.uri!==void 0&&!(o.uri in s.resources)&&o.bufferView===void 0}(t,i)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON($t.assertView(e)))}async writeJSON(e,t={}){if(t.format===qu.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return yae.write(e,{format:t.format||qu.GLTF,basename:t.basename||"",logger:this.M,vertexLayout:this.P,dependencies:xi({},this.U),extensions:Array.from(this.l)})}async writeBinary(e){const{json:t,resources:r}=await this.writeJSON(e,{format:qu.GLB}),i=new Uint32Array([1179937895,2,12]),s=JSON.stringify(t),o=$t.pad($t.encodeText(s),32),a=$t.toView(new Uint32Array([o.byteLength,1313821514])),l=$t.concat([a,o]);i[i.length-1]+=l.byteLength;const c=Object.values(r)[0];if(!c||!c.byteLength)return $t.concat([$t.toView(i),l]);const u=$t.pad(c,0),h=$t.toView(new Uint32Array([u.byteLength,5130562])),f=$t.concat([h,u]);return i[i.length-1]+=f.byteLength,$t.concat([$t.toView(i),l,f])}async j(e,t){var r=this;const i=[...e.json.images||[],...e.json.buffers||[]].map(async function(s){const o=s.uri;if(!o||o.match(/data:/))return Promise.resolve();e.resources[o]=await r.readURI(r.resolve(t,o),"view"),r.lastReadBytes+=e.resources[o].byteLength});await Promise.all(i)}D(e){function t(r){if(r.uri){if(r.uri in e.resources)$t.assertView(e.resources[r.uri]);else if(r.uri.match(/data:/)){const i=`__${cae()}.${Tp.extension(r.uri)}`;e.resources[i]=$t.createBufferFromDataURI(r.uri),r.uri=i}}}(e.json.images||[]).forEach(r=>{if(r.bufferView===void 0&&r.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(r)}),(e.json.buffers||[]).forEach(t)}_(e){const{images:t,buffers:r}=e.json;return e={json:xi({},e.json),resources:xi({},e.resources)},t&&(e.json.images=t.map(i=>xi({},i))),r&&(e.json.buffers=r.map(i=>xi({},i))),e}L(e){if(!n3(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==Tw.JSON)throw new Error("Missing required GLB JSON chunk.");const r=t[0],i=$t.decodeText($t.toView(e,20,r)),s=JSON.parse(i),o=20+r;if(e.byteLength<=o)return{json:s,resources:{}};const a=new Uint32Array(e.buffer,e.byteOffset+o,2);if(a[1]!==Tw.BIN)throw new Error("Expected GLB BIN in second chunk.");const l=$t.toView(e,o+8,a[0]);return{json:s,resources:{[yw]:l}}}}function n3(n){if(n.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(n.buffer,n.byteOffset,3);return e[0]===1179937895&&e[1]===2}class Sae extends wae{constructor(e=Lg.DEFAULT_INIT){super(),this.J=void 0,this.J=e}async readURI(e,t){const r=await fetch(e,this.J);switch(t){case"view":return new Uint8Array(await r.arrayBuffer());case"text":return r.text()}}resolve(e,t){return Lg.resolve(e,t)}dirname(e){return Lg.dirname(e)}}function T6(n){return`META_${n}`}function C6(n){var t,r;const e=(t=n==null?void 0:n.json)==null?void 0:t.scenes;return Array.isArray(e)&&e.length>0?(r=e[0].extras)==null?void 0:r.meta:null}function Eae(n,e,t){const r=e.byteOffset||0,i=t.byteOffset||0,s=r+i,o=t.componentType===5125?4:2,a=o*t.count;if(o===2){const l=new Uint16Array(n.slice(s,s+a).buffer),c=new Uint32Array(l.length);for(let u=0;u<l.length;u++)c[u]=l[u];return c}else return new Uint32Array(n.slice(s,s+a).buffer)}function Tae(n,e,t){const r=e.byteOffset||0,i=t.byteOffset||0,s=r+i,a=4*(t.count*3);return new Float32Array(n.slice(s,s+a).buffer)}function Cae(n,e){const t=new Set,r=new ot().makeRotationX(Math.PI/2).toArray();for(let i=0;i<n.length;i++){const s=n[i]*3;if(t.has(s))continue;const o=e[s],a=e[s+1],l=e[s+2],c=1/(r[3]*o+r[7]*a+r[11]*l+r[15]),u=(r[0]*o+r[4]*a+r[8]*l+r[12])/c,h=(r[1]*o+r[5]*a+r[9]*l+r[13])/c,f=(r[2]*o+r[6]*a+r[10]*l+r[14])/c;e[s]=u,e[s+1]=h,e[s+2]=f,t.add(s)}}function bae(n,e,t){const r=[];function i(o){var l,c,u,h,f,p;let a=o.json.scene||0;return(l=o.json.scenes)!=null&&l.length&&o.json.scenes[0]&&((c=o.json.scenes[0].nodes)!=null&&c.length)&&o.json.scenes[0].nodes[0]&&(a=o.json.scenes[0].nodes[0]),(h=(u=o==null?void 0:o.json)==null?void 0:u.nodes)!=null&&h.length&&((f=o==null?void 0:o.json)!=null&&f.nodes[a])?(p=o==null?void 0:o.json)==null?void 0:p.nodes[a]:(console.error("no main node found"),{})}const s=i(n);return Array.isArray(s.children)&&s.children.forEach(o=>{var A,k,T,R,$;const a=n.json.nodes&&n.json.nodes[o];if(!a||a.mesh===void 0)return;const l=n.json.meshes&&n.json.meshes[a.mesh];if(!l)return;const c=((A=a.name)==null?void 0:A.replace("node",""))||"";if(c==="")return;const u=parseInt(c);u===void 0&&console.warn("unexpected reult for nodename");const h=l.primitives[0].material;if(u!==h&&console.warn("test",u,h),h===void 0)return;const f=l.primitives[0].indices;if(f===void 0)return;const p=l.primitives[0].attributes.POSITION,_=n.json.accessors&&n.json.accessors[f];if(_===void 0||_.bufferView===void 0)return;const y=n.json.accessors&&n.json.accessors[p];if(y===void 0||y.bufferView===void 0)return;const g=n.json.bufferViews&&n.json.bufferViews[_.bufferView];if(!g)return;const m=n.json.bufferViews&&n.json.bufferViews[y.bufferView];if(!m)return;const x=((R=(((k=n==null?void 0:n.json)==null?void 0:k.materials)&&((T=n==null?void 0:n.json)==null?void 0:T.materials[h])||{}).pbrMetallicRoughness)==null?void 0:R.baseColorFactor)||[0,0,0,0],w=n.resources["@glb.bin"],E=Eae(w,g,_),S=Tae(w,m,y);if(!E.length){console.log("missing index",e,t,o);return}if(!S.length){console.log("missing position",e,t,o);return}Cae(E,S);const C=(($=n.json.scenes)==null?void 0:$.length)&&n.json.scenes[0].extras&&n.json.scenes[0].extras[`id_sequence${u}`];if(!C){console.log("missing id sequence",e,t,`id_sequence${u}`,o);return}r.push({position:S,index:E,color:x,id_sequence:C,indexdbKey:gr()})}),r}function b6(n){const e={x:null,y:null,z:null},t={x:null,y:null,z:null};let r=0;for(;r<n.length;)for(let i=0;i<3;i++,r++){const s=n[r]||0;i===0&&(e.x===null&&(e.x=s),t.x===null&&(t.x=s),e.x<s&&(e.x=s),t.x>s&&(t.x=s)),i===1&&(e.y===null&&(e.y=s),t.y===null&&(t.y=s),e.y<s&&(e.y=s),t.y>s&&(t.y=s)),i===2&&(e.z===null&&(e.z=s),t.z===null&&(t.z=s),e.z<s&&(e.z=s),t.z>s&&(t.z=s))}return{X:e.x||0,Y:e.y||0,Z:e.z||0,x:t.x||0,y:t.y||0,z:t.z||0}}function Aae(n,e,t,r,i){Object.keys(i).forEach(o=>{const a=[],[l,c]=i[o];for(let u=l;u<c+1;u++){const h=t[u]*3;a.push(r[h]),a.push(r[h+1]),a.push(r[h+2])}n.add(o),e[o]=b6(a)})}function Mae(n,e){let t=!0;for(;t&&n;){const r=new Set;Object.keys(n).forEach(s=>{const o=n[s];r.add(o[1])});let i=0;Object.keys(n).forEach(s=>{!r.has(s)&&!e.has(s)&&(i++,delete n[s])}),i===0&&(t=!1)}}async function Rae(n,e,t,r,i=null){try{const s=new oi(n),o=[],a=[],l=new Set,c={},u=`${t}_ALL_KEYS`;s.getKey(u).then(E=>{Array.isArray(E)&&E.forEach(S=>{s.deleteKey(S)})});const h=C6(r);if(!h)return console.log("Missing expected glb meta",e,t),null;const f=bae(r,e,t),p={};for(let E=0;E<f.length;E++){const S=f[E];Aae(l,c,S.index,S.position,S.id_sequence);const C=S.index,A=s.getUUID();await s.setKey(A,C.buffer),S.index=A,a.push(A);const k=S.position,T=s.getUUID();await s.setKey(T,k.buffer),S.position=T,a.push(T),S.id_sequence,o.push(S.indexdbKey),a.push(S.indexdbKey),p[A]={indexdb_key:S.indexdbKey,index:A,color:S.color,position:T,id_sequence:structuredClone(S.id_sequence)},S.id_sequence=null,await s.setKey(S.indexdbKey,S)}Mae(h,l);const _=Object.keys(h),y=[],g=new Map;let m=0;i?(g.set("*",1),m++):g.set("*",0),_.forEach(E=>{const S=c[E],C=h[E];let A,k;const T=C[0],R=C[1];g.has(E)?A=g.get(E):(m++,A=m,g.set(E,m)),g.has(R)?k=g.get(R):(m++,k=m,g.set(R,m)),y.push([A,T,k,S==null?void 0:S.x,S==null?void 0:S.y,S==null?void 0:S.z,S==null?void 0:S.X,S==null?void 0:S.Y,S==null?void 0:S.Z])}),i&&y.unshift([1,i,0,void 0,void 0,void 0,void 0,void 0,void 0]);const v={group_name:t,meshes:p,group_ref:y};Object.keys(v.meshes).forEach(E=>{const S=v.meshes[E];Object.keys(S.id_sequence).forEach(A=>{let k;g.has(A)?k=g.get(A):(m++,k=m,g.set(A,m)),S.id_sequence[k]=S.id_sequence[A],delete S.id_sequence[A]})});const w=new TextEncoder().encode(JSON.stringify(v));return await s.setKey(T6(t),w),await s.setKey(t,o),await s.setKey(u,a),await s.close(),t}catch(s){return console.error("error",t,s),null}}function RN(n){return((n==null?void 0:n.project_key)||"unknown")+"_TEMP_FILE"}function Nae(n){return n.json.nodes&&n.json.nodes||[]}function Iae(n){return n.json.meshes&&n.json.meshes||[]}function Pae(n){return n.json.materials&&n.json.materials||[]}function r3(n){return n.json.accessors&&n.json.accessors||[]}function i3(n){return n.json.bufferViews&&n.json.bufferViews||[]}function s3(n){return n.json.buffers&&n.json.buffers||[]}function o3(n,e){for(const t in n.resources)if(n.resources[t],n.resources[t].length===e)return n.resources[t]}function kae(n,e){var r,i,s,o,a,l,c;let t=null;if((r=n.matrix)!=null&&r.length)t=new ot().fromArray(n.matrix);else if((i=n.scale)!=null&&i.length||(s=n.rotation)!=null&&s.length||(o=n.translation)!=null&&o.length){let u=new N(1,1,1),h=new N,f=new Wn;(a=n.scale)!=null&&a.length&&(u=new N(n.scale[0],n.scale[1],n.scale[2])),(l=n.translation)!=null&&l.length&&(h=new N(n.translation[0],n.translation[1],n.translation[2])),(c=n.rotation)!=null&&c.length&&(f=new Wn(n.rotation[0],n.rotation[1],n.rotation[2],n.rotation[3]));const p=new ot().makeScale(u.x,u.y,u.z),_=new ot().makeTranslation(h.x,h.y,h.z),y=new ot().makeRotationFromQuaternion(f);t=new ot().identity(),t=t==null?void 0:t.multiply(_),t=t==null?void 0:t.multiply(y),t=t==null?void 0:t.multiply(p)}return e&&(t?t=new ot().multiplyMatrices(e,t):t=e),t}function Lae(n,e,t,r,i,s){const o=Iae(t)[n];if(!o)return;const a=i.next(),l=o.primitives.length>1,c={id:a,parent:e,name:o.name||"Mesh"+n};r.nodes.set(a,c),o.primitives.forEach((u,h)=>{var g;let f=a;if(l&&(f=i.next()),u.mode!==4&&u.mode!==void 0){console.log("dont know this mode",u.mode);return}if(u.indices===void 0){console.log("missing indecies, mesh",n,u);return}if(u.attributes.POSITION===void 0){console.log("missing positions, mesh",n,u);return}if(Array.isArray(u.targets)){console.log("dont know what target is",n,u);return}function p(m){return m===5120||m===5121?1:m===5122||m===5123?2:4}const _=Pae(t)[u.material];if(_){const m=((g=_.pbrMetallicRoughness)==null?void 0:g.baseColorFactor)||[0,0,0,1];r.materials.has(u.material)||r.materials.set(u.material,m)}else{console.log("missing material, mesh",n,u);const m=[0,0,0,1];r.materials.has(-1)||r.materials.set(-1,m),u.material=-1}let y=0;{const m=r3(t)[u.indices];if(m.bufferView===void 0){console.log("missing indicesAccessor.bufferView, mesh",n,u);return}m.type!=="SCALAR"&&console.log("index need to be scalar, mesh",n,u),m.sparse!==void 0&&console.log("accessor.sparse not supported, mesh",n,u);const v=i3(t)[m.bufferView];v.extensions!==void 0&&console.log("bufferView.extensions not supported, mesh",n,u);const x=p(m.componentType),w=s3(t)[v.buffer];if(!w){console.log("missing indicesBufferView.buffer, mesh",n,u,v);return}const E=o3(t,w.byteLength);if(!E){console.log("missing bin, mesh",n,u,E);return}let S=[];const C=r.buffersIndex.get(u.material);C?S=C:r.buffersIndex.set(u.material,S);const A=r.appendIndexStart[u.material]||0,k=S.length;let T=0;const R=(m.byteOffset||0)+(v.byteOffset||0)+(E.byteOffset||0);for(let M=0;M<m.count;M++){const I=M*((v==null?void 0:v.byteStride)||x);let j=0;x===1&&(j=new DataView(E.buffer).getUint8(R+I)),x===2&&(j=new DataView(E.buffer).getUint16(R+I,!0)),x===4&&(j=new DataView(E.buffer).getUint32(R+I,!0)),j+A>T&&(T=j+A),S.push(j+A)}r.appendIndexStart[u.material]=T+1;let $={};const P=r.ranges.get(u.material);P?$=P:r.ranges.set(u.material,$),l?(r.nodes.set(f,{id:f,parent:a,name:o.name||"Prim"+h}),$[f]=[k,S.length-1]):$[c.id]=[k,S.length-1],y=1}if(y){const m=r3(t)[u.attributes.POSITION];if(m.bufferView===void 0){console.log("missing indicesAccessor.bufferView, mesh",n,u);return}m.type!=="VEC3"&&console.log("index need to be scalar, mesh",n,u),m.sparse!==void 0&&console.log("accessor.sparse not supported, mesh",n,u);const v=i3(t)[m.bufferView];v.extensions!==void 0&&console.log("bufferView.extensions not supported, mesh",n,u);const x=p(m.componentType),w=s3(t)[v.buffer];if(!w){console.log("missing indicesBufferView.buffer, mesh",n,u,v);return}const E=o3(t,w.byteLength);if(!E){console.log("missing bin, mesh",n,u,E);return}let S=[];const C=r.buffersPosition.get(u.material);C?S=C:r.buffersPosition.set(u.material,S);const A=S.length,k=(m.byteOffset||0)+(v.byteOffset||0)+(E.byteOffset||0);for(let T=0;T<m.count;T++){const R=T*((v==null?void 0:v.byteStride)||x*3),$=k+R+0,P=k+R+x,M=k+R+x*2,I=new DataView(E.buffer).getFloat32($,!0),j=new DataView(E.buffer).getFloat32(P,!0),O=new DataView(E.buffer).getFloat32(M,!0);if(s){const B=new N(I,j,O).applyMatrix4(s);S.push(B.x,B.y,B.z)}else S.push(I,j,O)}r.bboxes[f]=b6(S.slice(A,S.length))}})}function TA(n,e,t,r,i,s){const o=Nae(t)[n];if(!o)return;const a={id:i.next(),parent:e,name:o.name||"Node"+n};if(o.children&&o.mesh)debugger;const l=kae(o,s);r.nodes.set(a.id,a),o.children&&o.children.forEach(c=>{TA(c,a.id,t,r,i,l)}),typeof o.mesh=="number"&&Lae(o.mesh,a.id,t,r,i,l)}class Oae{constructor(e){Q(this,"materials");Q(this,"buffersIndex");Q(this,"buffersPosition");Q(this,"ranges");Q(this,"nodes");Q(this,"appendIndexStart");Q(this,"bboxes");this.rootNode=e,this.materials=new Map,this.buffersIndex=new Map,this.appendIndexStart={},this.bboxes={},this.buffersPosition=new Map,this.nodes=new Map,this.ranges=new Map}addGroup(e,t){this.nodes.set(e,t)}}var Sv;class Dae{constructor(){YS(this,Sv,-1)}next(){return tI(this,Sv)._++,qv(this,Sv)}}Sv=new WeakMap;async function Uae(n,e,t,r,i){const s=new Dae,o=new Oae(s.next()),a=s.next(),l={id:a,parent:o.rootNode,name:i};if(o.nodes.set(a,l),Array.isArray(r.json.scenes)&&r.json.scenes.length)r.json.scenes.forEach(v=>{v.nodes.forEach(x=>{TA(x,a,r,o,s,null)})});else{if(typeof r.json.scene!="number")return null;TA(r.json.scene,a,r,o,s,null)}const c=new oi(n),u=[],h=[],f=`${t}_ALL_KEYS`,p={},_=Array.from(o.materials.keys());for(let v=0;v<_.length;v++){const x=_[v],w=c.getUUID(),E=o.materials.get(x)||[],S=o.ranges.get(x)||{},C=new Uint32Array(o.buffersIndex.get(x)||[]),A=c.getUUID();await c.setKey(A,C.buffer),h.push(A);const k=new Float32Array(o.buffersPosition.get(x)||[]),T=c.getUUID();await c.setKey(T,k.buffer),h.push(T),u.push(w),h.push(w),p[A]={indexdb_key:w,index:A,color:E,position:T,id_sequence:structuredClone(S)},await c.setKey(w,{index:A,position:T,indexdbKey:w,color:E})}const y=[];o.nodes.forEach(v=>{var x,w,E,S,C,A;y.push([v.id,v.name,v.parent,(x=o.bboxes[v.id])==null?void 0:x.x,(w=o.bboxes[v.id])==null?void 0:w.y,(E=o.bboxes[v.id])==null?void 0:E.z,(S=o.bboxes[v.id])==null?void 0:S.X,(C=o.bboxes[v.id])==null?void 0:C.Y,(A=o.bboxes[v.id])==null?void 0:A.Z])});const g={group_name:t,meshes:p,group_ref:y},m=new TextEncoder().encode(JSON.stringify(g));return await c.setKey(T6(t),m),await c.setKey(t,u),await c.setKey(f,h),await c.close(),t}async function Fae(){if(typeof showOpenFilePicker!="function"){Kn.setState({activated:!0,message:["Your browser does not support filesystem Access Api","Use newest Chrome/Edge","If you use brave, then you need to enable it under flags"].join(`
`),header:"Error"});return}const n={types:[{description:"Web3d glb files",accept:{"glb/glb":[".glb"]}}],excludeAcceptAllOption:!0,multiple:!0},e=ke.getState().selectedLayer;e||ke.setState({selectedLayer:[],selectedProject:{project_name:"LOCAL ONLY",project_key:"LOCAL ONLY"}});const t=await showOpenFilePicker(n);if((t==null?void 0:t.length)>0){mn.setState({treeViewActive:!1});for(let r=0;r<t.length;r++){it.setState({loadingData:!0,dialogContent:`Loading glb file no:${r+1} of ${t.length}`,dialogHeader:"Please wait"});const i=await t[r].getFile(),s=await i.arrayBuffer(),a=await new Sae({credentials:"include"}).binaryToJSON(new Uint8Array(s)),l=`${i.name}_ID${new Date().getTime()}`,c=ke.getState().selectedProject,u=RN(c),h=C6(a);let f=null;if(h?f=await Rae(u,l,l,a,l):f=await Uae(u,l,l,a,l),f){await ae.add_model_groups([{$synced:!0,name:l}],{project_key:u});const p=un.getState().modelGroups||[];p.push({$synced:!0,$loaded:!0,$isLocalFile:!0,name:l}),un.setState({modelGroups:structuredClone(p)}),await xw(u,l),F().forceRenderNextFrame()}}await ae.treeview_reset_rows(),mn.setState({treeViewActive:!0}),e||(F().getSceneController().updateBB(),await F().fitModelToCanvas(!0)),it.setState({loadingData:!1})}}function jae(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":["For loading/appending local glb file.","Needs to be merged glb with meta for web3d threeview/draw ranges","Service: http://asa-services.tapps.aibel.net supports converting Genie XML to supported glb format"].join(`
`),onClick:async()=>{await Fae()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Open GLB"})]})}class zae{constructor(e){Q(this,"collection",new Map);Q(this,"generationCount",0);Q(this,"collectionBoundingBox",null);Q(this,"groupNamesUsed",new Set);this.name=e}getkeys(){return Array.from(this.collection)}add(e){e.forEach(t=>this.collection.set(t.index,t))}clear(e=!1){this.generationCount=0,this.collection=new Map,this.groupNamesUsed=new Set,F().getSceneController().clearModelGroup(this.name,e),e||F().forceRenderNextFrame()}unload(){this.generationCount=0,F().getSceneController().clearModelGroup(this.name),F().forceRenderNextFrame()}async load(e=!1,t=!1,r=this.name){var a;this.groupNamesUsed.clear(),e||it.setState({loadingData:!e,dialogContent:"please wait, depends on hardware/model details",dialogHeader:"Generating Model"});const i=new oi(vv(ke.getState().selectedProject));this.generationCount=0,F().getSceneController().clearModelGroup(this.name),this.collectionBoundingBox=new et;const s=[],o=Array.from(this.collection.keys());for(let l=0;l<o.length;l++){const c=this.collection.get(o[l]);if(!c)return;this.groupNamesUsed.add(c.group_name);const u=(a=un.getState().modelGroups)==null?void 0:a.filter(A=>A.name===c.group_name);let h;u!=null&&u.length&&u[0].$isLocalFile?h=new oi(RN(ke.getState().selectedProject)):h=new oi(Hv(ke.getState().selectedProject));const f=c.index_ranges,p=c.materials;let _=[],y=[];if(c.full_mesh)_=new Uint32Array(await h.getKey(c.index)),y=new Float32Array(await h.getKey(c.position));else{const A=new Map,k=new Uint32Array(await h.getKey(c.index)),T=new Float32Array(await h.getKey(c.position));let R=0;for(let $=0;$<f.length;$++){const P=f[$];if(k.length===0&&P.length>0)console.error("index is 0 but have ranges, most likely a sync issue, resync and try again",k,P);else{const M=P[0]+P[1];for(let I=P[0];I<M;I++){const j=k[I]*3,O=T[j]+1,z=T[j+1]+1,B=T[j+2]+1,L=O*1e4*(z*1e3)*(B*100);A.has(L)?_.push(A.get(L)):(_.push(R),A.set(L,R),R++,y.push(T[j]),y.push(T[j+1]),y.push(T[j+2]))}}}}const g=new xn,m=new Float32Array(y),v=new Dn(m,3,!1);v.onUploadCallback=function(){this.array=null},g.setAttribute("position",v);const x=new Uint32Array(_),w=new Dn(x,1,!1);w.onUploadCallback=function(){this.array=null},g.setIndex(w),g.computeBoundingBox(),g.computeBoundingSphere();const E=c.groups.map(A=>({start:A.start,count:A.count,material_index:A.material_index,transformation:0,is_sel:0})),S=new n6,C={modelGroupKey:c.group_name,modelDBKey:`map(${l}):(${this.generationCount}):${r}`,modelDBKeyIndex:c.index,modelDBKeyPosition:c.position,modelDBStore:vv(ke.getState().selectedProject)};if(S.$initMesh(g,p,E,C),s.push(S.__modelDBKey),r){const A=Array.from(p.keys()),k={indexdbKey:S.__modelDBKey,groupKey:c.group_name,position:S.__modelDBKeyPosition,index:S.__modelDBKeyIndex,color:p.get(A[0])};i.setKey(k.position,m),i.setKey(k.index,x),i.setKey(k.indexdbKey,k)}this.collectionBoundingBox.expandByObject(S),F().getSceneController().addMeshToScene(S,this.name),li.flushSync(()=>{e||it.setState({loadingData:!e,dialogContent:`Processing mesh ${l}/${o.length}`,dialogHeader:"Generating Model "})})}r&&i.setKey(r,s),t||F().fitModelToCanvas(!0),F().forceRenderNextFrame(),e||it.setState({loadingData:!1,dialogContent:"",dialogHeader:""})}}const wi=new zae("USER_SET_01");async function Gv(){const n=un.getState().modelGroups;if(ke.getState().selectedProject&&(n!=null&&n.length)){for(let t=0;t<n.length;t++)n[t].$loaded=!1;un.setState({modelGroups:[]}),un.setState({modelGroups:n}),F().getSceneController().clearScene(),F().__forceRender=!0}wi.unload(),await ae.selection_clear(!0)}function iC(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":"Unloads all models displayed",onClick:async()=>{Gv(),await ae.selection_clear(!0),await ae.treeview_reset_rows()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Unload"})]})}function NN(n){return n.enable?d.jsx("div",{"data-tooltip":["Turns clipping plane off in selected axis"].join(`
`),className:"w-20 hover:bg-gray-500 text-2xl font-semibold text-center cursor-pointer ",onClick:n.onClick,children:"ON"}):d.jsx("div",{"data-tooltip":["Turns clipping plane on in selected axis"].join(`
`),className:" w-20 hover:bg-gray-500 text-2xl font-semibold text-center cursor-pointer ",onClick:n.onClick,children:"OFF"})}function IN(n){return n.enable?d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Inverts clipping plane",stroke:"currentColor",onClick:n.onClick,strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}):d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 rotate-45 hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Inverts clipping plane",stroke:"currentColor",onClick:n.onClick,strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})})}let Zi=!1;function Bae(n){return-n}function Hae(){const n=De();return d.jsxs("div",{className:"flex flex-1 bg-gray-800    select-none pointer-events-auto ml-5 mr-5",children:[d.jsx("div",{className:"flex flex-col flex-1 place-content-evenly p-2 text-red-700 hover:text-red-900",children:d.jsx(NN,{enable:n.x_plane_enable,onClick:()=>{const e=F().__lastClick,t=n.x_plane_neg?-e.x:e.x;n.x_plane_enable?De.setState({x_plane_offset:0,x_plane_enable:!1}):De.setState({x_plane_offset:t,x_plane_enable:!0})}})}),d.jsxs("div",{className:"flex flex-col flex-1 place-content-evenly p-2 text-gray-300 ml-3 mr-3",children:[d.jsx(IN,{enable:n.x_plane_neg,onClick:()=>{if(n.x_plane_enable){n.x_plane_neg?De.setState({x_plane_neg:!1}):De.setState({x_plane_neg:!0});const e=De.getState().x_plane_offset;De.setState({x_plane_offset:Bae(e)})}}}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500  hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping to last clicked point",onClick:()=>{if(n.x_plane_enable){const e=F().__lastClick,t=n.x_plane_neg?-e.x:e.x;De.setState({x_plane_offset:t})}},onMouseUp:()=>{Zi=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})})]}),d.jsxs("div",{className:"flex  flex-col flex-1 place-content-between p-2 m-2 ml-3 mr-3",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",onPointerDown:()=>{if(n.x_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().x_plane_offset-.1;De.setState({x_plane_offset:t}),Zi&&e()},50)};Zi=!0,e()}},onPointerUp:()=>{Zi=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.x_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().x_plane_offset+.1;De.setState({x_plane_offset:t}),Zi&&e()},50)};Zi=!0,e()}},onPointerUp:()=>{Zi=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),d.jsxs("div",{className:"flex  flex-col flex-1 place-content-between p-2 m-2 ml-3 mr-3",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",onPointerDown:()=>{if(n.x_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().x_plane_offset-1;De.setState({x_plane_offset:t}),Zi&&e()},50)};Zi=!0,e()}},onPointerUp:()=>{Zi=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.x_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().x_plane_offset+1;De.setState({x_plane_offset:t}),Zi&&e()},50)};Zi=!0,e()}},onPointerUp:()=>{Zi=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})]})]})}let Qi=!1;function Vae(n){return-n}function Gae(){const n=De();return d.jsxs("div",{className:"flex flex-1 bg-gray-800    select-none pointer-events-auto ml-5 mr-5",children:[d.jsx("div",{className:"flex flex-col flex-1 place-content-evenly p-2 text-green-700 hover:text-green-900",children:d.jsx(NN,{enable:n.y_plane_enable,onClick:()=>{const e=F().__lastClick,t=n.y_plane_neg?-e.y:e.y;n.y_plane_enable?De.setState({y_plane_offset:0,y_plane_enable:!1}):De.setState({y_plane_offset:t,y_plane_enable:!0})}})}),d.jsxs("div",{className:"flex flex-col flex-1 place-content-evenly p-2 text-gray-300 ml-3 mr-3",children:[d.jsx(IN,{enable:n.y_plane_neg,onClick:()=>{if(n.y_plane_enable){n.y_plane_neg?De.setState({y_plane_neg:!1}):De.setState({y_plane_neg:!0});const e=De.getState().y_plane_offset;De.setState({y_plane_offset:Vae(e)})}}}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping to last clicked point",onClick:()=>{if(n.y_plane_enable){const e=F().__lastClick,t=n.y_plane_neg?-e.y:e.y;De.setState({y_plane_offset:t})}},onMouseUp:()=>{Qi=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})})]}),d.jsxs("div",{className:"flex  flex-col flex-1 place-content-between p-2 m-2 ml-3 mr-3",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",onPointerDown:()=>{if(n.y_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().y_plane_offset-.1;De.setState({y_plane_offset:t}),Qi&&e()},50)};Qi=!0,e()}},onPointerUp:()=>{Qi=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.y_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().y_plane_offset+.1;De.setState({y_plane_offset:t}),Qi&&e()},50)};Qi=!0,e()}},onPointerUp:()=>{Qi=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),d.jsxs("div",{className:"flex  flex-col flex-1 place-content-between p-2 m-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",onPointerDown:()=>{if(n.y_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().y_plane_offset-1;De.setState({y_plane_offset:t}),Qi&&e()},50)};Qi=!0,e()}},onPointerUp:()=>{Qi=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.y_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().y_plane_offset+1;De.setState({y_plane_offset:t}),Qi&&e()},50)};Qi=!0,e()}},onPointerUp:()=>{Qi=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})]})]})}let Ji=!1;function Wae(n){return-n}function Yae(){const n=De();return d.jsxs("div",{className:"flex flex-1 bg-gray-800    select-none pointer-events-auto ml-5 mr-5",children:[d.jsx("div",{className:"flex flex-col flex-1 place-content-evenly p-2 text-blue-700 hover:text-blue-900",children:d.jsx(NN,{enable:n.z_plane_enable,onClick:()=>{const e=F().__lastClick,t=n.z_plane_neg?-e.z:e.z;n.z_plane_enable?De.setState({z_plane_offset:0,z_plane_enable:!1}):De.setState({z_plane_offset:t,z_plane_enable:!0})}})}),d.jsxs("div",{className:"flex flex-col flex-1 place-content-evenly p-2 text-gray-300 ml-3 mr-3",children:[d.jsx(IN,{enable:n.z_plane_neg,onClick:()=>{if(n.z_plane_enable){n.z_plane_neg?De.setState({z_plane_neg:!1}):De.setState({z_plane_neg:!0});const e=De.getState().z_plane_offset;De.setState({z_plane_offset:Wae(e)})}}}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 hover:bg-gray-500 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping to last clicked point",onClick:()=>{if(n.z_plane_enable){const e=F().__lastClick,t=n.z_plane_neg?-e.z:e.z;De.setState({z_plane_offset:t})}},onMouseUp:()=>{Ji=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})})]}),d.jsxs("div",{className:"flex  flex-col flex-1 place-content-between p-2 m-2 ml-3 mr-3",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Move clipping plane",stroke:"currentColor",onPointerDown:()=>{if(n.z_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().z_plane_offset+.1;De.setState({z_plane_offset:t}),Ji&&e()},50)};Ji=!0,e()}},onPointerUp:()=>{Ji=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.z_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().z_plane_offset-.1;De.setState({z_plane_offset:t}),Ji&&e()},50)};Ji=!0,e()}},onPointerUp:()=>{Ji=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),d.jsxs("div",{className:"flex  flex-col flex-1 place-content-between p-2 m-2",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Move clipping plane",stroke:"currentColor",onPointerDown:()=>{if(n.z_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().z_plane_offset+1;De.setState({z_plane_offset:t}),Ji&&e()},50)};Ji=!0,e()}},onPointerUp:()=>{Ji=!1},strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  hover:bg-gray-500 text-gray-300 hover:text-gray-900 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Move clipping plane",strokeWidth:2,onPointerDown:()=>{if(n.z_plane_enable){let e=function(){setTimeout(()=>{const t=De.getState().z_plane_offset-1;De.setState({z_plane_offset:t}),Ji&&e()},50)};Ji=!0,e()}},onPointerUp:()=>{Ji=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 13l-7 7-7-7m14-8l-7 7-7-7"})})]})]})}function Kae(){const n=We();return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":["Opens settings dialog"].join(`
`),onClick:()=>{n.settingsToggle()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),d.jsx("span",{className:"text-center text-xs",children:"Settings"})]})}let Lm,sC,Th,L_;function oC(n,e=1/0,t=null){sC||(sC=new Rp(2,2,1,1)),Th||(Th=new fs({uniforms:{blitTexture:new Ca(n)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),Th.uniforms.blitTexture.value=n,Th.defines.IS_SRGB=n.colorSpace==Ns,Th.needsUpdate=!0,L_||(L_=new Be(sC,Th),L_.frustrumCulled=!1);const r=new Ni,i=new Lx;i.add(L_),t===null&&(t=Lm=new kx({antialias:!1}));const s=Math.min(n.image.width,e),o=Math.min(n.image.height,e);t.setSize(s,o),t.clear(),t.render(i,r);const a=document.createElement("canvas"),l=a.getContext("2d");a.width=s,a.height=o,l.drawImage(t.domElement,0,0,s,o);const c=new TK(a);return c.minFilter=n.minFilter,c.magFilter=n.magFilter,c.wrapS=n.wrapS,c.wrapT=n.wrapT,c.name=n.name,Lm&&(Lm.forceContextLoss(),Lm.dispose(),Lm=null),c}const a3={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class PN{constructor(){this.pluginCallbacks=[],this.register(function(e){return new rle(e)}),this.register(function(e){return new ile(e)}),this.register(function(e){return new ale(e)}),this.register(function(e){return new lle(e)}),this.register(function(e){return new cle(e)}),this.register(function(e){return new ule(e)}),this.register(function(e){return new sle(e)}),this.register(function(e){return new ole(e)}),this.register(function(e){return new dle(e)}),this.register(function(e){return new hle(e)}),this.register(function(e){return new fle(e)}),this.register(function(e){return new ple(e)}),this.register(function(e){return new mle(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){const s=new nle,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](s));s.setPlugins(o),s.write(e,t,i).catch(r)}parseAsync(e,t){const r=this;return new Promise(function(i,s){r.parse(e,i,s,t)})}}const Ut={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},aC="KHR_mesh_quantization",us={};us[ei]=Ut.NEAREST;us[NC]=Ut.NEAREST_MIPMAP_NEAREST;us[Ih]=Ut.NEAREST_MIPMAP_LINEAR;us[mi]=Ut.LINEAR;us[V_]=Ut.LINEAR_MIPMAP_NEAREST;us[$l]=Ut.LINEAR_MIPMAP_LINEAR;us[ks]=Ut.CLAMP_TO_EDGE;us[Cx]=Ut.REPEAT;us[bx]=Ut.MIRRORED_REPEAT;const l3={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},$ae=new at,c3=12,Xae=1179937895,qae=2,u3=8,Zae=1313821514,Qae=5130562;function ig(n,e){return n.length===e.length&&n.every(function(t,r){return t===e[r]})}function Jae(n){return new TextEncoder().encode(n).buffer}function ele(n){return ig(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function tle(n,e,t){const r={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=e;i<e+t;i++)for(let s=0;s<n.itemSize;s++){let o;n.itemSize>4?o=n.array[i*n.itemSize+s]:(s===0?o=n.getX(i):s===1?o=n.getY(i):s===2?o=n.getZ(i):s===3&&(o=n.getW(i)),n.normalized===!0&&(o=Fg.normalize(o,n.array))),r.min[s]=Math.min(r.min[s],o),r.max[s]=Math.max(r.max[s],o)}return r}function A6(n){return Math.ceil(n/4)*4}function lC(n,e=0){const t=A6(n.byteLength);if(t!==n.byteLength){const r=new Uint8Array(t);if(r.set(new Uint8Array(n)),e!==0)for(let i=n.byteLength;i<t;i++)r[i]=e;return r.buffer}return n}function d3(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function h3(n,e){if(n.toBlob!==void 0)return new Promise(r=>n.toBlob(r,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),n.convertToBlob({type:e,quality:t})}class nle{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,r={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},r),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,s=i.buffers,o=i.json;r=i.options;const a=i.extensionsUsed,l=i.extensionsRequired,c=new Blob(s,{type:"application/octet-stream"}),u=Object.keys(a),h=Object.keys(l);if(u.length>0&&(o.extensionsUsed=u),h.length>0&&(o.extensionsRequired=h),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=c.size),r.binary===!0){const f=new FileReader;f.readAsArrayBuffer(c),f.onloadend=function(){const p=lC(f.result),_=new DataView(new ArrayBuffer(u3));_.setUint32(0,p.byteLength,!0),_.setUint32(4,Qae,!0);const y=lC(Jae(JSON.stringify(o)),32),g=new DataView(new ArrayBuffer(u3));g.setUint32(0,y.byteLength,!0),g.setUint32(4,Zae,!0);const m=new ArrayBuffer(c3),v=new DataView(m);v.setUint32(0,Xae,!0),v.setUint32(4,qae,!0);const x=c3+g.byteLength+y.byteLength+_.byteLength+p.byteLength;v.setUint32(8,x,!0);const w=new Blob([m,g,y,_,p],{type:"application/octet-stream"}),E=new FileReader;E.readAsArrayBuffer(w),E.onloadend=function(){t(E.result)}}}else if(o.buffers&&o.buffers.length>0){const f=new FileReader;f.readAsDataURL(c),f.onloadend=function(){const p=f.result;o.buffers[0].uri=p,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const r=this.options,i=this.extensionsUsed;try{const s=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&s.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in s.gltfExtensions)t.extensions[o]=s.gltfExtensions[o],i[o]=!0;delete s.gltfExtensions}Object.keys(s).length>0&&(t.extras=s)}catch(s){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+s.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(e,i)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const r=new N;for(let i=0,s=e.count;i<s;i++)if(Math.abs(r.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const r=e.clone(),i=new N;for(let s=0,o=r.count;s<o;s++)i.fromBufferAttribute(r,s),i.x===0&&i.y===0&&i.z===0?i.setX(1):i.normalize(),r.setXYZ(s,i.x,i.y,i.z);return t.attributesNormalized.set(e,r),r}applyTextureTransform(e,t){let r=!1;const i={};(t.offset.x!==0||t.offset.y!==0)&&(i.offset=t.offset.toArray(),r=!0),t.rotation!==0&&(i.rotation=t.rotation,r=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(i.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function r(p){return p.colorSpace===Ns?function(y){return y<.04045?y*.0773993808:Math.pow(y*.9478672986+.0521327014,2.4)}:function(y){return y}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof AE&&(e=oC(e)),t instanceof AE&&(t=oC(t));const i=e?e.image:null,s=t?t.image:null,o=Math.max(i?i.width:0,s?s.width:0),a=Math.max(i?i.height:0,s?s.height:0),l=d3();l.width=o,l.height=a;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const u=c.getImageData(0,0,o,a);if(i){c.drawImage(i,0,0,o,a);const p=r(e),_=c.getImageData(0,0,o,a).data;for(let y=2;y<_.length;y+=4)u.data[y]=p(_[y]/256)*256}if(s){c.drawImage(s,0,0,o,a);const p=r(t),_=c.getImageData(0,0,o,a).data;for(let y=1;y<_.length;y+=4)u.data[y]=p(_[y]/256)*256}c.putImageData(u,0,0);const f=(e||t).clone();return f.source=new jA(l),f.colorSpace=Ia,f.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),f}processBuffer(e){const t=this.json,r=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),r.push(e),0}processBufferView(e,t,r,i,s){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;switch(t){case Ut.BYTE:case Ut.UNSIGNED_BYTE:a=1;break;case Ut.SHORT:case Ut.UNSIGNED_SHORT:a=2;break;default:a=4}const l=A6(i*e.itemSize*a),c=new DataView(new ArrayBuffer(l));let u=0;for(let p=r;p<r+i;p++)for(let _=0;_<e.itemSize;_++){let y;e.itemSize>4?y=e.array[p*e.itemSize+_]:(_===0?y=e.getX(p):_===1?y=e.getY(p):_===2?y=e.getZ(p):_===3&&(y=e.getW(p)),e.normalized===!0&&(y=Fg.normalize(y,e.array))),t===Ut.FLOAT?c.setFloat32(u,y,!0):t===Ut.INT?c.setInt32(u,y,!0):t===Ut.UNSIGNED_INT?c.setUint32(u,y,!0):t===Ut.SHORT?c.setInt16(u,y,!0):t===Ut.UNSIGNED_SHORT?c.setUint16(u,y,!0):t===Ut.BYTE?c.setInt8(u,y):t===Ut.UNSIGNED_BYTE&&c.setUint8(u,y),u+=a}const h={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return s!==void 0&&(h.target=s),s===Ut.ARRAY_BUFFER&&(h.byteStride=e.itemSize*a),this.byteOffset+=l,o.bufferViews.push(h),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,r=t.json;return r.bufferViews||(r.bufferViews=[]),new Promise(function(i){const s=new FileReader;s.readAsArrayBuffer(e),s.onloadend=function(){const o=lC(s.result),a={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,i(r.bufferViews.push(a)-1)}})}processAccessor(e,t,r,i){const s=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=Ut.FLOAT;else if(e.array.constructor===Int32Array)a=Ut.INT;else if(e.array.constructor===Uint32Array)a=Ut.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=Ut.SHORT;else if(e.array.constructor===Uint16Array)a=Ut.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=Ut.BYTE;else if(e.array.constructor===Uint8Array)a=Ut.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(r===void 0&&(r=0),(i===void 0||i===1/0)&&(i=e.count),i===0)return null;const l=tle(e,r,i);let c;t!==void 0&&(c=e===t.index?Ut.ELEMENT_ARRAY_BUFFER:Ut.ARRAY_BUFFER);const u=this.processBufferView(e,a,r,i,c),h={bufferView:u.id,byteOffset:u.byteOffset,componentType:a,count:i,max:l.max,min:l.min,type:o[e.itemSize]};return e.normalized===!0&&(h.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(h)-1}processImage(e,t,r,i="image/png"){if(e!==null){const s=this,o=s.cache,a=s.json,l=s.options,c=s.pending;o.images.has(e)||o.images.set(e,{});const u=o.images.get(e),h=i+":flipY/"+r.toString();if(u[h]!==void 0)return u[h];a.images||(a.images=[]);const f={mimeType:i},p=d3();p.width=Math.min(e.width,l.maxTextureSize),p.height=Math.min(e.height,l.maxTextureSize);const _=p.getContext("2d");if(r===!0&&(_.translate(0,p.height),_.scale(1,-1)),e.data!==void 0){t!==Ls&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const g=new Uint8ClampedArray(e.height*e.width*4);for(let m=0;m<g.length;m+=4)g[m+0]=e.data[m+0],g[m+1]=e.data[m+1],g[m+2]=e.data[m+2],g[m+3]=e.data[m+3];_.putImageData(new ImageData(g,e.width,e.height),0,0)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap)_.drawImage(e,0,0,p.width,p.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement or ImageBitmap.");l.binary===!0?c.push(h3(p,i).then(g=>s.processBufferViewImage(g)).then(g=>{f.bufferView=g})):p.toDataURL!==void 0?f.uri=p.toDataURL(i):c.push(h3(p,i).then(g=>new FileReader().readAsDataURL(g)).then(g=>{f.uri=g}));const y=a.images.push(f)-1;return u[h]=y,y}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const r={magFilter:us[e.magFilter],minFilter:us[e.minFilter],wrapS:us[e.wrapS],wrapT:us[e.wrapT]};return t.samplers.push(r)-1}processTexture(e){const r=this.options,i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);s.textures||(s.textures=[]),e instanceof AE&&(e=oC(e,r.maxTextureSize));let o=e.userData.mimeType;o==="image/webp"&&(o="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,o)};e.name&&(a.name=e.name),this._invokeAll(function(c){c.writeTexture&&c.writeTexture(e,a)});const l=s.textures.push(a)-1;return i.textures.set(e,l),l}processMaterial(e){const t=this.cache,r=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;r.materials||(r.materials=[]);const i={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const s=e.color.toArray().concat([e.opacity]);if(ig(s,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=s),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),l={index:this.processTexture(a),channel:a.channel};this.applyTextureTransform(l,a),i.pbrMetallicRoughness.metallicRoughnessTexture=l}if(e.map){const a={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(a,e.map),i.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){const a=e.emissive;if(Math.max(a.r,a.g,a.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const c={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(c,e.emissiveMap),i.emissiveTexture=c}}if(e.normalMap){const a={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),i.normalTexture=a}if(e.aoMap){const a={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),i.occlusionTexture=a}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===gi&&(i.doubleSided=!0),e.name!==""&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,i)});const o=r.materials.push(i)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,r=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let w=0,E=e.material.length;w<E;w++)i.push(e.material[w].uuid);else i.push(e.material.uuid);const s=i.join(":");if(t.meshes.has(s))return t.meshes.get(s);const o=e.geometry;let a;e.isLineSegments?a=Ut.LINES:e.isLineLoop?a=Ut.LINE_LOOP:e.isLine?a=Ut.LINE_STRIP:e.isPoints?a=Ut.POINTS:a=e.material.wireframe?Ut.LINES:Ut.TRIANGLES;const l={},c={},u=[],h=[],f={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=o.getAttribute("normal");p!==void 0&&!this.isNormalizedNormalAttribute(p)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let _=null;for(let w in o.attributes){if(w.slice(0,5)==="morph")continue;const E=o.attributes[w];if(w=f[w]||w.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(w)||(w="_"+w),t.attributes.has(this.getUID(E))){c[w]=t.attributes.get(this.getUID(E));continue}_=null;const C=E.array;w==="JOINTS_0"&&!(C instanceof Uint16Array)&&!(C instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),_=new Dn(new Uint16Array(C),E.itemSize,E.normalized));const A=this.processAccessor(_||E,o);A!==null&&(w.startsWith("_")||this.detectMeshQuantization(w,E),c[w]=A,t.attributes.set(this.getUID(E),A))}if(p!==void 0&&o.setAttribute("normal",p),Object.keys(c).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const w=[],E=[],S={};if(e.morphTargetDictionary!==void 0)for(const C in e.morphTargetDictionary)S[e.morphTargetDictionary[C]]=C;for(let C=0;C<e.morphTargetInfluences.length;++C){const A={};let k=!1;for(const T in o.morphAttributes){if(T!=="position"&&T!=="normal"){k||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),k=!0);continue}const R=o.morphAttributes[T][C],$=T.toUpperCase(),P=o.attributes[T];if(t.attributes.has(this.getUID(R,!0))){A[$]=t.attributes.get(this.getUID(R,!0));continue}const M=R.clone();if(!o.morphTargetsRelative)for(let I=0,j=R.count;I<j;I++)for(let O=0;O<R.itemSize;O++)O===0&&M.setX(I,R.getX(I)-P.getX(I)),O===1&&M.setY(I,R.getY(I)-P.getY(I)),O===2&&M.setZ(I,R.getZ(I)-P.getZ(I)),O===3&&M.setW(I,R.getW(I)-P.getW(I));A[$]=this.processAccessor(M,o),t.attributes.set(this.getUID(P,!0),A[$])}h.push(A),w.push(e.morphTargetInfluences[C]),e.morphTargetDictionary!==void 0&&E.push(S[C])}l.weights=w,E.length>0&&(l.extras={},l.extras.targetNames=E)}const y=Array.isArray(e.material);if(y&&o.groups.length===0)return null;let g=!1;if(y&&o.index===null){const w=[];for(let E=0,S=o.attributes.position.count;E<S;E++)w[E]=E;o.setIndex(w),g=!0}const m=y?e.material:[e.material],v=y?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let w=0,E=v.length;w<E;w++){const S={mode:a,attributes:c};if(this.serializeUserData(o,S),h.length>0&&(S.targets=h),o.index!==null){let A=this.getUID(o.index);(v[w].start!==void 0||v[w].count!==void 0)&&(A+=":"+v[w].start+":"+v[w].count),t.attributes.has(A)?S.indices=t.attributes.get(A):(S.indices=this.processAccessor(o.index,o,v[w].start,v[w].count),t.attributes.set(A,S.indices)),S.indices===null&&delete S.indices}const C=this.processMaterial(m[v[w].materialIndex]);C!==null&&(S.material=C),u.push(S)}g===!0&&o.setIndex(null),l.primitives=u,r.meshes||(r.meshes=[]),this._invokeAll(function(w){w.writeMesh&&w.writeMesh(e,l)});const x=r.meshes.push(l)-1;return t.meshes.set(s,x),x}detectMeshQuantization(e,t){if(this.extensionsUsed[aC])return;let r;switch(t.array.constructor){case Int8Array:r="byte";break;case Uint8Array:r="unsigned byte";break;case Int16Array:r="short";break;case Uint16Array:r="unsigned short";break;default:return}t.normalized&&(r+=" normalized");const i=e.split("_",1)[0];a3[i]&&a3[i].includes(r)&&(this.extensionsUsed[aC]=!0,this.extensionsRequired[aC]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const r=e.isOrthographicCamera,i={type:r?"orthographic":"perspective"};return r?i.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:Fg.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const r=this.json,i=this.nodeMap;r.animations||(r.animations=[]),e=PN.Utils.mergeMorphTargetTracks(e.clone(),t);const s=e.tracks,o=[],a=[];for(let l=0;l<s.length;++l){const c=s[l],u=Xt.parseTrackName(c.name);let h=Xt.findNode(t,u.nodeName);const f=l3[u.propertyName];if(u.objectName==="bones"&&(h.isSkinnedMesh===!0?h=h.skeleton.getBoneByName(u.objectIndex):h=void 0),!h||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name),null;const p=1;let _=c.values.length/c.times.length;f===l3.morphTargetInfluences&&(_/=h.morphTargetInfluences.length);let y;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(y="CUBICSPLINE",_/=3):c.getInterpolation()===z9?y="STEP":y="LINEAR",a.push({input:this.processAccessor(new Dn(c.times,p)),output:this.processAccessor(new Dn(c.values,_)),interpolation:y}),o.push({sampler:a.length-1,target:{node:i.get(h),path:f}})}return r.animations.push({name:e.name||"clip_"+r.animations.length,samplers:a,channels:o}),r.animations.length-1}processSkin(e){const t=this.json,r=this.nodeMap,i=t.nodes[r.get(e)],s=e.skeleton;if(s===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const a=[],l=new Float32Array(s.bones.length*16),c=new ot;for(let h=0;h<s.bones.length;++h)a.push(r.get(s.bones[h])),c.copy(s.boneInverses[h]),c.multiply(e.bindMatrix).toArray(l,h*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new Dn(l,16)),joints:a,skeleton:r.get(o)}),i.skin=t.skins.length-1}processNode(e){const t=this.json,r=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const s={};if(r.trs){const a=e.quaternion.toArray(),l=e.position.toArray(),c=e.scale.toArray();ig(a,[0,0,0,1])||(s.rotation=a),ig(l,[0,0,0])||(s.translation=l),ig(c,[1,1,1])||(s.scale=c)}else e.matrixAutoUpdate&&e.updateMatrix(),ele(e.matrix)===!1&&(s.matrix=e.matrix.elements);if(e.name!==""&&(s.name=String(e.name)),this.serializeUserData(e,s),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(s.mesh=a)}else e.isCamera&&(s.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let l=0,c=e.children.length;l<c;l++){const u=e.children[l];if(u.visible||r.onlyVisible===!1){const h=this.processNode(u);h!==null&&a.push(h)}}a.length>0&&(s.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,s)});const o=t.nodes.push(s)-1;return i.set(e,o),o}processScene(e){const t=this.json,r=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};e.name!==""&&(i.name=e.name),t.scenes.push(i);const s=[];for(let o=0,a=e.children.length;o<a;o++){const l=e.children[o];if(l.visible||r.onlyVisible===!1){const c=this.processNode(l);c!==null&&s.push(c)}}s.length>0&&(i.nodes=s),this.serializeUserData(e,i)}processObjects(e){const t=new Lx;t.name="AuxScene";for(let r=0;r<e.length;r++)t.children.push(e[r]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(i){i.beforeParse&&i.beforeParse(e)});const r=[];for(let i=0;i<e.length;i++)e[i]instanceof Lx?this.processScene(e[i]):r.push(e[i]);r.length>0&&this.processObjects(r);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(i){i.afterParse&&i.afterParse(e)})}_invokeAll(e){for(let t=0,r=this.plugins.length;t<r;t++)e(this.plugins[t])}}class rle{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const r=this.writer,i=r.json,s=r.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(1-e.penumbra)*e.angle,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),s[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},s[this.name]=!0);const a=i.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class ile{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class sle{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const r=this.writer,i=r.extensionsUsed,s={};if(s.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:r.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};r.applyTextureTransform(o,e.clearcoatMap),s.clearcoatTexture=o}if(s.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:r.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};r.applyTextureTransform(o,e.clearcoatRoughnessMap),s.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:r.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};r.applyTextureTransform(o,e.clearcoatNormalMap),s.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class ole{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const r=this.writer,i=r.extensionsUsed,s={};if(s.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:r.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};r.applyTextureTransform(o,e.iridescenceMap),s.iridescenceTexture=o}if(s.iridescenceIor=e.iridescenceIOR,s.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],s.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:r.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};r.applyTextureTransform(o,e.iridescenceThicknessMap),s.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class ale{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const r=this.writer,i=r.extensionsUsed,s={};if(s.transmissionFactor=e.transmission,e.transmissionMap){const o={index:r.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};r.applyTextureTransform(o,e.transmissionMap),s.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class lle{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const r=this.writer,i=r.extensionsUsed,s={};if(s.thicknessFactor=e.thickness,e.thicknessMap){const o={index:r.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};r.applyTextureTransform(o,e.thicknessMap),s.thicknessTexture=o}s.attenuationDistance=e.attenuationDistance,s.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class cle{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const i=this.writer.extensionsUsed,s={};s.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class ule{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals($ae)&&!e.specularIntensityMap&&!e.specularColorMap)return;const r=this.writer,i=r.extensionsUsed,s={};if(e.specularIntensityMap){const o={index:r.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};r.applyTextureTransform(o,e.specularIntensityMap),s.specularTexture=o}if(e.specularColorMap){const o={index:r.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};r.applyTextureTransform(o,e.specularColorMap),s.specularColorTexture=o}s.specularFactor=e.specularIntensity,s.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class dle{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const r=this.writer,i=r.extensionsUsed,s={};if(e.sheenRoughnessMap){const o={index:r.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};r.applyTextureTransform(o,e.sheenRoughnessMap),s.sheenRoughnessTexture=o}if(e.sheenColorMap){const o={index:r.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};r.applyTextureTransform(o,e.sheenColorMap),s.sheenColorTexture=o}s.sheenRoughnessFactor=e.sheenRoughness,s.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class hle{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.anisotropy==0)return;const r=this.writer,i=r.extensionsUsed,s={};if(e.anisotropyMap){const o={index:r.processTexture(e.anisotropyMap)};r.applyTextureTransform(o,e.anisotropyMap),s.anisotropyTexture=o}s.anisotropyStrength=e.anisotropy,s.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class fle{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const i=this.writer.extensionsUsed,s={};s.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class ple{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===1&&!e.bumpMap)return;const r=this.writer,i=r.extensionsUsed,s={};if(e.bumpMap){const o={index:r.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};r.applyTextureTransform(o,e.bumpMap),s.bumpTexture=o}s.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class mle{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const r=this.writer,i=e,s=new Float32Array(i.count*3),o=new Float32Array(i.count*4),a=new Float32Array(i.count*3),l=new ot,c=new N,u=new Wn,h=new N;for(let p=0;p<i.count;p++)i.getMatrixAt(p,l),l.decompose(c,u,h),c.toArray(s,p*3),u.toArray(o,p*4),h.toArray(a,p*3);const f={TRANSLATION:r.processAccessor(new Dn(s,3)),ROTATION:r.processAccessor(new Dn(o,4)),SCALE:r.processAccessor(new Dn(a,3))};i.instanceColor&&(f._COLOR_0=r.processAccessor(i.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:f},r.extensionsUsed[this.name]=!0,r.extensionsRequired[this.name]=!0}}PN.Utils={insertKeyframe:function(n,e){const r=n.getValueSize(),i=new n.TimeBufferType(n.times.length+1),s=new n.ValueBufferType(n.values.length+r),o=n.createInterpolant(new n.ValueBufferType(r));let a;if(n.times.length===0){i[0]=e;for(let l=0;l<r;l++)s[l]=0;a=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;i[0]=e,i.set(n.times,1),s.set(o.evaluate(e),0),s.set(n.values,r),a=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;i[i.length-1]=e,i.set(n.times,0),s.set(n.values,0),s.set(o.evaluate(e),n.values.length),a=i.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-e)<.001)return l;if(n.times[l]<e&&n.times[l+1]>e){i.set(n.times.slice(0,l+1),0),i[l+1]=e,i.set(n.times.slice(l+1),l+2),s.set(n.values.slice(0,(l+1)*r),0),s.set(o.evaluate(e),(l+1)*r),s.set(n.values.slice((l+1)*r),(l+2)*r),a=l+1;break}}return n.times=i,n.values=s,a},mergeMorphTargetTracks:function(n,e){const t=[],r={},i=n.tracks;for(let s=0;s<i.length;++s){let o=i[s];const a=Xt.parseTrackName(o.name),l=Xt.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(B9)}const c=l.morphTargetInfluences.length,u=l.morphTargetDictionary[a.propertyIndex];if(u===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let h;if(r[l.uuid]===void 0){h=o.clone();const p=new h.ValueBufferType(c*h.times.length);for(let _=0;_<h.times.length;_++)p[_*c+u]=h.values[_];h.name=(a.nodeName||"")+".morphTargetInfluences",h.values=p,r[l.uuid]=h,t.push(h);continue}const f=o.createInterpolant(new o.ValueBufferType(1));h=r[l.uuid];for(let p=0;p<h.times.length;p++)h.values[p*c+u]=f.evaluate(h.times[p]);for(let p=0;p<o.times.length;p++){const _=this.insertKeyframe(h,o.times[p]);h.values[_*c+u]=o.values[p]}}return n.tracks=t,n}};async function gle(n){const e=new PN,t=document.createElement("a");t.style.display="none",document.body.appendChild(t),li.flushSync(()=>{it.setState({loadingData:!0,dialogContent:"please wait, collecting model data",dialogHeader:"Generating Model"})});function r(o,a){t.href=URL.createObjectURL(o),t.download=a,t.click()}function i(o,a){r(new Blob([o],{type:"application/octet-stream"}),a)}const s=[];for(let o=0;o<n.length;o++)if(li.flushSync(()=>{it.setState({loadingData:!0,dialogContent:`please wait, building group (${o+1}/${n.length})`,dialogHeader:"Generating Model"})}),n[o].__modelDBStore){const a=new oi(n[o].__modelDBStore),l=new Uint32Array(await a.getKey(n[o].__modelDBKeyIndex)),c=new Float32Array(await a.getKey(n[o].__modelDBKeyPosition));n[o].$groups.forEach(u=>{const h=new xn;if(!u.count)return;const f=new Uint32Array(l.slice(u.start,u.start+u.count)),p=[],_=[],y=new Map;let g=0;for(let x=0;x<f.length;x++){const w=f[x]*3,E=c[w].toString()+c[w+1].toString()+c[w+2].toString();y.has(E)?p.push(y.get(E)):(p.push(g),y.set(E,g),g++,_.push(c[w]),_.push(c[w+1]),_.push(c[w+2]))}if(h.setIndex(new Dn(new Uint32Array(p),1)),h.setAttribute("position",new Dn(new Float32Array(_),3,!0)),u.transformation){const x=new ot().fromArray(u.transformation);h.applyMatrix4(x)}h.computeBoundingBox();const m=n[o].$getMeshMaterialFromRange(u.material_index,u.transformation,u.is_sel),v=new Be(h,m);v.rotateX(-Math.PI/2),s.push(v)})}e.parse(s,function(o){i(o,"web3dExport.glb"),it.setState({loadingData:!1,dialogContent:"please wait, collecting model data",dialogHeader:"Generating Model"})},function(o){console.log(o)},{binary:!0,trs:!0})}globalThis.testing=function(){const e=F().getSceneController().getMeshes(),t=[];Array.isArray(e)&&(e.forEach(r=>t.push(r)),gle(t))};function vle(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded  pointer-events-auto cursor-pointer","data-tooltip":["Export displayed model as GLB file"].join(`
`),onClick:()=>{globalThis.testing()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),d.jsx("span",{className:"text-center text-xs",children:"GLTF"})]})}async function _le(n,e){const t=await Ed(),r=await Td();return await pS(r,t.ENV__AZURE_STORAGE_SHARE_CONTAINER_NAME,`${e}/${n}.Web3DVP`)}function xle(n){return new Worker(""+new URL("syncWorker-7M952tLE.js",import.meta.url).href,{name:n==null?void 0:n.name})}async function yle(){return new Promise(async(n,e)=>{const t=new xle,r=bv(t),i=new r,s=setTimeout(()=>{e("timeout")},1e3),o=await Promise.resolve(i);clearTimeout(s),n([o,t])})}async function wle(n,e){const t=new oi(n),r=await t.getKey(e);if(r&&r.length)for(let i=0;i<r.length;i++){const s=await t.getKey(r[i]);s!=null&&s.position&&await t.deleteKey(s.position),s!=null&&s.index&&await t.deleteKey(s.index),s!=null&&s.vertexColor&&await t.deleteKey(s.vertexColor)}}let O_=0;const f3=10;async function Sle(n,e,t,r){const i=Object.keys(t);i.sort();const s=[];for(let o=0;o<i.length;o++)try{const a=i[o],l=t[a],c=await Td(),[u,h]=await yle();if(wle(e,a),O_>f3)for(;O_>f3-1;)await t6();O_++;const f=u.downloadFromAzure(c,e,n,a,l.glb_url).then(p=>{r(p),u[XA](),h.terminate(),O_--});s.push(f)}catch{r("")}await Promise.all(s)}const CA=Ir(()=>({modelIssues:!1,modelIssuesMessages:[]}));async function p3(n,e,t,r){try{let i=!1;const s=[],o={};if(Array.isArray(t))for(let a=0;a<t.length;a++){const l=await pS(await Td(),e,t[a].path),c=Object.keys(l.models),u=new Date().getTime()-new Date(l.source_created_date).getTime();u>0&&t[a].warning_after_hours>0&&Math.floor(u/1e3/3600)>t[a].warning_after_hours&&(i=!0,s.push(`${t[a].name} is ${Math.floor(u/1e3/3600)} hours, warning is set at ${t[a].warning_after_hours} hours`)),Array.isArray(l.warnings)&&l.warnings.forEach(h=>{s.push(h)}),c.forEach(h=>{const f=l.models[h];f.source_md5_hash=l.source_md5_hash,f.source_created_date=l.source_created_date,f.source_checked_date=l.source_checked_date,f.blob_created_date=l.blob_created_date,f.blob_modified_date=l.blob_modified_date,o[h]=f})}if(o){const a=await n.getKey(r);a&&o&&Object.keys(o).forEach(c=>{const u=a[c],h=o[c];u&&u.glb_md5_hash===h.glb_md5_hash&&u.$synced&&(h.$synced=!0)}),await n.setKey(r,o)}return CA.setState({modelIssues:i,modelIssuesMessages:s}),o}catch(i){throw CA.setState({modelIssues:!1,modelIssuesMessages:[]}),i}}function Ele(n,e){const t=[];return e.length&&Object.keys(n).forEach(r=>{let i=!1;const s=r.toUpperCase();e.forEach(o=>{if(i)return;const a=o.toUpperCase();if(a.split("*").length>1){let l="";a[0]!=="*"&&(l="^");let c="";a[a.length-1]!=="*"&&(c="$"),new RegExp(`${l}${a.replace(/\*/g,".*")}${c}`,"").test(s)&&(i=!0)}else s===a&&(i=!0)}),i||t.push(r)}),t.forEach(r=>{delete n[r]}),n}async function kN(n){const e=ke.getState().selectedProject,t=ke.getState().selectedLayer;if(e){const r=e.container,i=e.model_data,s=(t==null?void 0:t.groups)||[],o=Hv(ke.getState().selectedProject),a=new oi(o);try{let l;return n?l=await p3(a,r,i,o):(l=await a.getKey(o),l||(l=await p3(a,r,i,o))),Ele(l||{},s)}catch(l){throw l}}else throw"getActiveProjectModelGroups called without active project"}function LN(n){if(n){const e=Object.keys(n),t=[];let r=0;e.forEach(i=>{n[i].name||(n[i].name=i),n[i].description||(n[i].description="..."),n[i].$synced||r++,t.push(n[i])}),un.setState({modelGroups:t,unsyncedCount:r})}}function Tle(n){const e=vv(n);new oi(e).deleteDB()}async function bA(n=!1){if(ke.getState().selectedProject){const t=await kN(n);LN(t)}}function Cle(){const n=[];F().getSceneController().getMeshes().forEach(t=>{var i;const r=(i=t.$geometry.boundingBox)==null?void 0:i.clone();r&&n.push(r)}),F().getSceneController().addOccludeTesters(n),F().forceRenderNextFrame()}async function ble(){const n=await ae.get_bounding_boxes_from_selection(),e=[];n.forEach(r=>{e.push(new et(new N(r.x_min,r.y_min,r.z_min),new N(r.x_max,r.y_max,r.z_max)))}),F().getSceneController().addOccludeTesters(e),F().forceRenderNextFrame()}function Ale(){const n=F().getSceneController(),e=[];n.getOccluders().forEach(t=>{e.push({minMaxArr:[t.min.x,t.min.y,t.min.z,t.max.x,t.max.y,t.max.z],autoSplit:!0})}),console.log(JSON.stringify(e))}window.injectOccuders=function(n){const e=JSON.parse(n),t=[];e.forEach(r=>{if(Array.isArray(r.minMaxArr)&&r.minMaxArr.length===6)if(r.autoSplit){const i=IS(new et().setFromArray(r.minMaxArr),0,r.maxDepth);i!=null&&i.length&&i.forEach(s=>t.push(s))}else t.push(new et().setFromArray(r.minMaxArr))}),t.length&&F().getSceneController().addOccludeTesters(t)};function Mle(){F().getSceneController().showOccludeVolumes(),F().forceRenderNextFrame()}function Rle(){F().getSceneController().hideOccludeVolumes(),F().forceRenderNextFrame()}function Nle(){F().getSceneController().clearOccluders()}let cC=!1;function Ile(){const n=F().getSceneController();cC=!cC,n.forceOccludeOn(cC);const e=new N;e.x=e.x+1e-6,F().getActiveControls().getPosition(e),F().getActiveControls().setPosition(e.x,e.y,e.z,!1),F().forceRenderNextFrame()}async function M6(n=!1){const e=Xe.getState();if(!e.maxX)return;console.log("NEW BOX"),console.log([e.minX,e.minY,e.minZ,e.maxX,e.maxY,e.maxZ]);let t=IS(new et(new N(e.minX,e.minY,e.minZ),new N(e.maxX,e.maxY,e.maxZ)));const r=F().getSceneController();n&&(t=t.concat(r.getCurrentOccludeBoxes())),r.addOccludeTesters(t),F().forceRenderNextFrame()}function IS(n,e=0,t=2){const r=[];r.length||r.push(n);const i=Ple(n,e+1,t);if(i)for(let s=0;s<i.length;s++){const o=i[s];r.push(i[s]);const a=IS(o,e+1,t);a&&a.forEach(l=>{r.push(l)})}return r}function Ple(n,e,t=1){if(e===t)return null;const r=n.min.x,i=n.min.y,s=n.min.z,o=n.max.x,a=n.max.y,l=n.max.z,c=(r+o)*.5,u=(i+a)*.5,h=(s+l)*.5,f=[],p=o-r,_=a-i,y=l-s;return p>20&&_>20&&y>20&&(f.push(new et(new N(r,i,s),new N(c,u,h))),f.push(new et(new N(c,i,s),new N(o,u,h))),f.push(new et(new N(r,u,s),new N(c,a,h))),f.push(new et(new N(c,u,s),new N(o,a,h))),f.push(new et(new N(r,i,h),new N(c,u,l))),f.push(new et(new N(c,i,h),new N(o,u,l))),f.push(new et(new N(r,u,h),new N(c,a,l))),f.push(new et(new N(c,u,h),new N(o,a,l)))),p<20&&_>20&&y>20&&(f.push(new et(new N(r,i,s),new N(o,u,h))),f.push(new et(new N(r,i,h),new N(o,u,l))),f.push(new et(new N(r,u,s),new N(o,a,h))),f.push(new et(new N(r,u,h),new N(o,a,l)))),p<20&&p>20&&y>20&&(f.push(new et(new N(r,i,s),new N(c,a,h))),f.push(new et(new N(r,i,h),new N(c,a,l))),f.push(new et(new N(c,i,s),new N(o,a,h))),f.push(new et(new N(c,i,h),new N(o,a,l)))),p<20&&_>20&&y<20&&(f.push(new et(new N(r,i,s),new N(o,u,l))),f.push(new et(new N(r,u,s),new N(o,a,l)))),p>20&&_<20&&y<20&&(f.push(new et(new N(r,i,s),new N(c,a,l))),f.push(new et(new N(c,i,s),new N(o,a,l)))),p>20&&_>20&&y<20&&(f.push(new et(new N(r,i,s),new N(o,u,l))),f.push(new et(new N(r,u,s),new N(o,a,l))),f.push(new et(new N(r,i,s),new N(c,a,l))),f.push(new et(new N(c,i,s),new N(o,a,l)))),p<20&&_<20&&y>20&&(f.push(new et(new N(r,i,s),new N(o,a,h))),f.push(new et(new N(r,i,h),new N(o,a,l)))),f}async function PS(n,e=!0,t=!0,r=!0){var i;if(it.setState({loadingData:!0,dialogContent:"Please wait while loading data",dialogHeader:"Loading project"}),ke.setState({selectedProject:n}),await Gv(),n){const s=ke.getState().selectedProject;if(s!=null&&s.controllerPosition&&(s!=null&&s.controllerTarget)){const a=ke.getState().selectedLayer,l=(a==null?void 0:a.controllerTarget)||(s==null?void 0:s.controllerTarget),c=(a==null?void 0:a.controllerPosition)||(s==null?void 0:s.controllerPosition);await F().getActiveControls().setLookAt(c[0],c[1],c[2],l[0],l[1],l[2],!1)}const o=await kN(r).catch(a=>{it.setState({loadingData:!1}),ke.setState({isOpen:!0}),AF(a)});if(LN(o||null),un.getState().unsyncedCount>0&&e)await Yf(!1);else if(o&&t){it.setState({loadingData:!0,dialogContent:`Please wait 
 Generating data 
 Speed of this depends on model size`,dialogHeader:"Loading metadata"}),await ae.clear();const a=new Promise(async c=>{var h;const u=((h=un.getState().modelGroups)==null?void 0:h.slice())||[];if(u!=null&&u.length){async function f(){const p=u.pop();it.setState({loadingData:!0,dialogContent:`Please wait 
 Generating data 
 Speed of this depends on model size
 Data to generate:`+u.length,dialogHeader:"Loading metadata"}),p?ae.add_model_groups([p],s).then(()=>{f()}):c(null)}f()}else c(null)});await bA(!0),await Promise.all([a]),it.setState({loadingData:!0,dialogContent:`Please wait 
 preparing volumnes`,dialogHeader:"Loading metadata"}),F().getSceneController().clearOccluders();const l=(i=ke.getState().selectedProject)==null?void 0:i.occlusionCullingBoxes;if(Array.isArray(l)){const c=[];l.forEach(u=>{if(Array.isArray(u.minMaxArr)&&u.minMaxArr.length===6)if(u.autoSplit){const h=IS(new et().setFromArray(u.minMaxArr),0,u.maxDepth);h!=null&&h.length&&h.forEach(f=>c.push(f))}else c.push(new et().setFromArray(u.minMaxArr))}),c.length&&F().getSceneController().addOccludeTesters(c)}await ae.all_sites_loaded(),mn.setState({treeViewActive:!QU}),await ae.treeview_reset_rows(),it.setState({loadingData:!1,dialogContent:"",dialogHeader:""})}}ke.setState({isOpen:!1})}function kle(n){const e=RN(n);new oi(e).deleteDB()}async function Yf(n,e){const t=ke.getState().selectedProject;if(t){const r=await kN(!1);if(r){it.getState().activateLoadingData(),it.setState({dialogHeader:"Syncing Models"});let i=0;const s=Hv(t),o=new oi(s);let a=n?r:{};if(!n)for(const f in r){const p=r[f];p.$synced||(a[f]=p)}e&&(a={},a[e]=r[e]);const l=Object.keys(a).length;it.setState({dialogContent:"downloading"});let c=!1,u=0;l&&(Tle(ke.getState().selectedProject),kle(ke.getState().selectedProject));const h=await o.getKey(s);return await Sle(t.container,s,a,async f=>{i++,f?(r[f].$synced=!0,h[f].$synced=!0,await o.setKey(s,h),it.setState({dialogContent:`Synced ${i}/${l}`})):(c=!0,u++)}),c&&(Kn.setState({activated:!0,header:"Sync error",message:[`${u} model groups had errors while trying to download.`,"This might be due to network issues or low diskspace",'Please click "Sync & Load" to try again'].join(`
`)}),it.setState({loadingData:!1})),LN(r),un.getState().unsyncedCount>0?un.getState().activateSyncDialog():await PS(t,!1,!0,!1),c}}}async function m3(){const n=new oi("ALL_PROJECTS"),e=await Ed(!0),t=await pS(await Td(),e.ENV__AZURE_STORAGE_PROJECT_CONTAINER_NAME,e.ENV__AZURE_STORAGE_PROJECT_CONFIG_JSON),r={};for(let i=0;i<t.length;i++){const s=t[i].active,o=t[i].container,a=t[i].unique_key,l=t[i].project_code,c=t[i].project_name,u=t[i].config;s&&(r[a]={},r[a].unique_key=a,r[a].container=o,r[a].project_code=l,r[a].project_name=c,r[a].config=u)}return r&&await n.setKey("PROJECTS",r),r}async function Lle(n){if(n)return await m3();{const t=await new oi("ALL_PROJECTS").getKey("PROJECTS");return t||await m3()}}async function ON(n){const e=await Lle(n).catch(t=>{AF(t)});if(e){const t=Object.keys(e),r=[];t.forEach(i=>{r.push(e[i])}),await ke.getState().setAllProjects(r)}}async function _v(n){var r;const e=(r=un.getState().modelGroups)==null?void 0:r.filter(i=>n?i.name===n:i.load_by_default);if(ke.getState().selectedProject&&(e!=null&&e.length)){it.setState({loadingData:!0,dialogContent:"please wait, depends on hardware/model details",dialogHeader:"Loading"});let i=0;const s=[];for(let o=0;o<e.length;o++)e[o].load_by_default&&e[o].$loaded!==!0&&s.push(xw(Hv(ke.getState().selectedProject),e[o].name).then(()=>{it.setState({loadingData:!0,dialogContent:`${i}/${e.length-1}`}),F().__forceRender=!0,e[o].$loaded=!0,i++}).catch(a=>{console.error(e[o].name,a)}));await Promise.all(s),await Ts(!0),it.setState({loadingData:!1,dialogContent:"",dialogHeader:"Loading"})}}async function R6(){var r;const n=Ot.getState(),e=n.currentSet.colorOverride.length&&n.currentSet.colorOverride||[];e.length===0&&e.push({uuid:"na",name:"!RESET!",color:"white",operator:"Equal"});const t=((r=ke.getState().selectedProject)==null?void 0:r.project_key)||"unknown";n.setProjectKey(t),await ae.filter_geometry([],e),await ae.selection_append(),F().forceRenderNextFrame()}function kS(n){n?document.title=`WEB-3D - ${n}`:document.title="WEB-3D"}async function N6(n,e,t=!1,r){var s,o,a,l;it.setState({loadingData:!0,dialogContent:"please wait",dialogHeader:""});const i=r||await _le(n,e).catch(()=>(it.setState({loadingData:!1,dialogContent:"",dialogHeader:""}),ke.setState({isOpen:!0}),Kn.setState({activated:!0,header:"Error",message:"unable to find set"}),null));if(i&&(Array.isArray(i.filter)||(i.filter=[]),Array.isArray(i.siteFilter)&&(delete i.lvl3Filter,delete i.lvl3Filter,delete i.lvl3Filter,delete i.siteFilter,delete i.zoneFilter,delete i.itemFilter),(s=i.viewPoints)==null||s.forEach(c=>{c.uuid||(c.uuid=gr())}),(o=i.colorOverride)==null||o.forEach(c=>{c.uuid||(c.uuid=gr())}),(a=i.filter)==null||a.forEach(c=>{c.forEach(u=>{u.uuid||(u.uuid=gr())})}),await ON(!0),it.setState({loadingData:!0,dialogContent:"",dialogHeader:""}),i!=null&&i.projectKey)){const c=ke.getState().allProjects.filter(f=>f.unique_key===(i==null?void 0:i.projectKey))[0],u=await NR(c.container,c.config,c.unique_key,c.project_code,c.project_name);if(!u){Kn.setState({activated:!0,header:"Unable to get project data",message:"Missing access"}),it.setState({loadingData:!1});return}ke.setState({selectedProject:u,projectSelectedKey:c.unique_key,projectSelectedCode:c.project_code,projectSelectedName:c.project_name}),!YK&&(i!=null&&i.layerFilter)&&ke.setState({selectedLayer:i==null?void 0:i.layerFilter,selectedLayerTitle:`${c.project_code} - ${c.project_name} - ${(l=i==null?void 0:i.layerFilter)==null?void 0:l.description}`}),KK&&(i!=null&&i.setFilter)&&ke.setState({selectedLayer:i==null?void 0:i.setFilter,selectedLayerTitle:`${c.project_code} - ${c.project_name} - SET_FILTER USED`});const h=ke.getState().selectedProject;if(h&&(h==null?void 0:h.project_key)===(i==null?void 0:i.projectKey)){await PS(h,!1,!1,!0),kS(h.project_code),it.setState({loadingData:!0,dialogContent:"",dialogHeader:""}),await Yf(!1),it.setState({loadingData:!0,dialogContent:"please wait",dialogHeader:""}),Ot.setState({currentSet:i,isOpen:!0,editMode:!1,activeTab:"VIEWPOINT"});const f=Ot.getState();if(F().disableRender(),i.filter.length){const _=await ae.filter_geometry(f.currentSet.filter,[]);wi.add(_),await wi.load(!1,!1,i.UUID),await ae.filter_geometry([],f.currentSet.colorOverride),await ae.selection_append()}t&&i.filter.length===0&&wi.getkeys().length===0&&await _v(),it.setState({loadingData:!0,dialogContent:"Applying colors",dialogHeader:""}),i.filter.length===0&&(await R6(),await ae.selection_clear(!0)),F().enableRender(),it.setState({loadingData:!1,dialogContent:"please wait",dialogHeader:""}),F().getSceneController().updateBB(),mn.setState({treeViewActive:!0});const p=f.currentSet.viewPoints[0];if(p){F().setCameraMode(p.cameraType==="PerspectiveCamera"?"3D":"2D"),De.setState({z_plane_visible:p.z_plane_visible,y_plane_visible:p.y_plane_visible,x_plane_visible:p.x_plane_visible,z_plane_enable:p.z_plane_enable,y_plane_enable:p.y_plane_enable,x_plane_enable:p.x_plane_enable,z_plane_neg:p.z_plane_neg,y_plane_neg:p.y_plane_neg,x_plane_neg:p.x_plane_neg,z_plane_offset:p.z_plane_offset,y_plane_offset:p.y_plane_offset,x_plane_offset:p.x_plane_offset}),p.boxClippingEnabled?Xe.setState({enabled:!0,transformHelperEnabled:!1,minX:p.boxClippingMinX,minY:p.boxClippingMinY,minZ:p.boxClippingMinZ,maxX:p.boxClippingMaxX,maxY:p.boxClippingMaxY,maxZ:p.boxClippingMaxZ}):Xe.setState({enabled:!1,transformHelperEnabled:!1}),Bt.updateClipShader(),Bt.updateClippingHelper(),F().getActiveControls().smoothTime=.5,F().getActiveControls().saveState(),p.cameraType!=="PerspectiveCamera"&&p.zoom!==void 0&&(F().getActiveControls()._zoomEnd=p.zoom);const _=F().getActiveControls().setLookAt(p.controllerPosition[0],p.controllerPosition[1],p.controllerPosition[2],p.controllerTarget[0],p.controllerTarget[1],p.controllerTarget[2],!0);let y=null;p.selectedFullName&&(y=ae.get_ids_from_fullnames([p.selectedFullName]).then(async g=>{if(g.length){await ae.selection_clear(!1),await ae.treeview_collapse(),await ae.selection_add(g),await ae.treeview_expand_from_id(g[0]),await ae.selection_append();const m=ae.getRowOfKey(g[0]);Mt.getState().updateToggel(m),ld(g[0],!1)}})),await Promise.all([_,y])}else{F().setCameraMode("3D"),De.setState({z_plane_enable:!1,y_plane_enable:!1,x_plane_enable:!1}),Xe.setState({enabled:!1,transformHelperEnabled:!1});const _=ke.getState().selectedProject;if(_!=null&&_.controllerPosition&&(_!=null&&_.controllerTarget)){const y=ke.getState().selectedLayer,g=(y==null?void 0:y.controllerTarget)||(_==null?void 0:_.controllerTarget),m=(y==null?void 0:y.controllerPosition)||(_==null?void 0:_.controllerPosition);await F().getActiveControls().setLookAt(m[0],m[1],m[2],g[0],g[1],g[2],!1)}else F().fitModelToCanvas(!0)}F().getActiveControls().smoothTime=1,F().getActiveControls().saveState();return}}}function Ole(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Unloads model
Reloads metadata for project
Regenerate set editor model`,onClick:()=>{var e,t;const n=Ot.getState();n.currentSet.UUID&&((t=(e=n.currentSet)==null?void 0:e.filter)==null?void 0:t.length)>0&&(Gv(),wi.clear(),N6(n.currentSet.UUID,vv(ke.getState().selectedProject),!1,n.currentSet))},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),d.jsx("span",{className:"text-center text-xs ",children:"Reload"})]})}function Dle(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":"Unloads model displayed model generated by set editor",onClick:()=>{wi.unload()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6M3 17V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Unload"})]})}function Ule(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Unloads model
And clears everything created in set editor`,onClick:async()=>{Ot.getState().clearSet(),wi.unload(),await ae.selection_clear(!0)},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d.jsx("span",{className:"text-center text-xs",children:"Clear"})]})}function Fle(){const n=Qr();let e;return n.isLengthMode?e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-500 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer":e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",d.jsxs("div",{className:"flex",children:[d.jsxs("div",{className:e,onClick:()=>{F().getSceneController().toolsController.setActive(n.isLengthMode?null:"length"),F().forceRenderNextFrame()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M19.875 12c.621 0 1.125 .512 1.125 1.143v5.714c0 .631 -.504 1.143 -1.125 1.143h-15.875a1 1 0 0 1 -1 -1v-5.857c0 -.631 .504 -1.143 1.125 -1.143h15.75z"}),d.jsx("path",{d:"M9 12v2"}),d.jsx("path",{d:"M6 12v3"}),d.jsx("path",{d:"M12 12v3"}),d.jsx("path",{d:"M18 12v3"}),d.jsx("path",{d:"M15 12v2"}),d.jsx("path",{d:"M3 3v4"}),d.jsx("path",{d:"M3 5h18"}),d.jsx("path",{d:"M21 3v4"})]}),d.jsx("span",{className:"text-center text-xs",children:n.isLengthMode?"Disable":"Enable"})]}),d.jsx(jle,{})]})}function jle(){const n=Qr();if(!n.isLengthMode)return null;const e="p-1 w-8 hover:bg-gray-500 text-gray-300 hover:text-gray-900 text-center m-1",t="p-1 w-8 hover:bg-gray-500 text-yellow-500 hover:text-gray-900 text-center m-1";return d.jsxs("div",{className:"flex pointer-events-auto flex-col",children:[d.jsx("div",{className:"flex m-auto mb-2 mt-1 text-gray-300 text-xs",children:"Lock axis"}),d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"flex",children:d.jsx("div",{"data-tooltip":"Keyboard shortcut is: A, this allows movement in All directions",onClick:()=>{F().getSceneController().toolsController.setLengthAxisLock("A"),Qr.setState({lengthAxisLock:"A"})},className:n.lengthAxisLock==="A"?t.replace("w-8",""):e.replace("w-8",""),children:"No-Lock"})}),d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:n.lengthAxisLock==="X"?t:e,"data-tooltip":"Keyboard shortcut is: X, this is same as W or E on rotation gizmo",onClick:()=>{F().getSceneController().toolsController.setLengthAxisLock("X"),Qr.setState({lengthAxisLock:"X"})},children:"X"}),d.jsx("div",{className:n.lengthAxisLock==="Y"?t:e,"data-tooltip":"Keyboard shortcut is: Y, this is same as N or S on rotation gizmo",onClick:()=>{F().getSceneController().toolsController.setLengthAxisLock("Y"),Qr.setState({lengthAxisLock:"Y"})},children:"Y"}),d.jsx("div",{className:n.lengthAxisLock==="Z"?t:e,"data-tooltip":"Keyboard shortcut is: Z , this is same as U or D on rotation gizmo",onClick:()=>{F().getSceneController().toolsController.setLengthAxisLock("Z"),Qr.setState({lengthAxisLock:"Z"})},children:"Z"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:n.lengthAxisLock==="U"?t:e,"data-tooltip":"Keyboard shortcut is: U, this sets same height in all directions",onClick:()=>{F().getSceneController().toolsController.setLengthAxisLock("U"),Qr.setState({lengthAxisLock:"U"})},children:"U"}),d.jsx("div",{className:n.lengthAxisLock==="N"?t:e,"data-tooltip":"Keyboard shortcut is: N, between North and South",onClick:()=>{F().getSceneController().toolsController.setLengthAxisLock("N"),Qr.setState({lengthAxisLock:"N"})},children:"NS"}),d.jsx("div",{className:n.lengthAxisLock==="W"?t:e,"data-tooltip":"Keyboard shortcut is: W, between West and East",onClick:()=>{F().getSceneController().toolsController.setLengthAxisLock("W"),Qr.setState({lengthAxisLock:"W"})},children:"WE"})]})]})]})}function zle(){const n=Qr();if(n.isLengthMode)return null;let e;return n.isLengthDisplayActive?e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-500 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer":e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",d.jsxs("div",{className:e,onClick:()=>{F().getSceneController().toolsController.toggleDisplayLengthTool(),F().forceRenderNextFrame()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),d.jsx("span",{className:"text-center text-xs",children:n.isLengthDisplayActive?"Hide":"Show"})]})}function Ble(){const n=Qr();let e;return n.isSquareMode?e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-500 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer":e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",d.jsxs("div",{className:e,onClick:()=>{F().getSceneController().toolsController.setActive(n.isSquareMode?null:"square"),F().forceRenderNextFrame()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("circle",{cx:5,cy:5,r:2}),d.jsx("circle",{cx:19,cy:5,r:2}),d.jsx("circle",{cx:5,cy:19,r:2}),d.jsx("circle",{cx:19,cy:19,r:2}),d.jsx("line",{x1:5,y1:7,x2:5,y2:17}),d.jsx("line",{x1:7,y1:5,x2:17,y2:5}),d.jsx("line",{x1:7,y1:19,x2:17,y2:19}),d.jsx("line",{x1:19,y1:7,x2:19,y2:17})]}),d.jsx("span",{className:"text-center text-xs",children:n.isSquareMode?"Disable":"Enable"})]})}function Hle(){const n=Qr();if(n.isSquareMode)return null;let e;return n.isSquareDisplayActive?e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-500 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer":e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",d.jsxs("div",{className:e,onClick:()=>{F().getSceneController().toolsController.toggleDisplaySquareTool(),F().forceRenderNextFrame()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),d.jsx("span",{className:"text-center text-xs",children:n.isSquareDisplayActive?"Hide":"Show"})]})}let Vle=0;function Gle(){var e,t;const n=ke();if((e=n.selectedProject)!=null&&e.tools){const r=Object.keys((t=n.selectedProject)==null?void 0:t.tools);return d.jsx(d.Fragment,{children:r.map((i,s)=>{var a,l;const o=(l=(a=n.selectedProject)==null?void 0:a.tools)==null?void 0:l[i];return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded  pointer-events-auto cursor-pointer ",onClick:()=>{var c,u,h;if(n.selectedProject){const f=`${i}:${Vle++}`;(c=n.selectedProject)!=null&&c.activeTools?n.selectedProject.activeTools.indexOf(i)!==-1||(Array.isArray((u=n.selectedProject)==null?void 0:u.activeTools)?n.selectedProject.activeTools.push(f):n.selectedProject.activeTools=[f]):Array.isArray((h=n.selectedProject)==null?void 0:h.activeTools)?n.selectedProject.activeTools.push(f):n.selectedProject.activeTools=[f],ke.setState({selectedProject:null}),ke.setState({selectedProject:n.selectedProject})}},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})}),d.jsx("span",{className:"text-center text-xs",children:o==null?void 0:o.tabButtonName})]},r[s])})})}return d.jsx("div",{className:"m-auto p-2",children:"No Tools configured for project"})}function Wle(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{console.log("--------------------------------------------------------------------"),console.log("these can be added to project json");const n=new N;F().getActiveControls().getTarget(n),console.log("controllerTarget:",n);const e=new N;F().getActiveControls().getPosition(e),console.log("controllerPosition:",e),console.log("--------------------------------------------------------------------")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-4 w-4 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"print target and position"})]})}function Yle(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":"Opens/closes the set editor",onClick:()=>{const n=Ot.getState().isOpen;Ot.setState({isOpen:!n})},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Set Editor"})]})}async function LS(){await ae.selection_set_color("green:0"),Mt.getState().updateToggel()}async function I6(){await ae.selection_reset(!1,!1,!0,!1),Mt.getState().updateToggel()}async function DN(){await ae.unhide_all(),Mt.getState().updateToggel()}function Kle(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":["Hides selected items, shortcut H"].join(`
`),onClick:async()=>{LS()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"})}),d.jsx("span",{className:"text-center text-xs",children:"Hide"})]})}function $le(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{await ae.selection_set_color("white"),await Mt.getState().updateToggel()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-4 w-4 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"White"})]})}function Xle(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{await ae.selection_set_color("seagreen"),await Mt.getState().updateToggel()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-4 w-4 text-green-500",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"Green"})]})}async function UN(){await ae.selection_reset(!0,!1,!1,!0),Mt.getState().updateToggel()}async function qle(){await ae.selection_reset(!1,!0,!1,!1),Mt.getState().updateToggel()}function Zle(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":"Resets colors of selected back to original color",onClick:async()=>{UN()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),d.jsx("span",{className:"text-center text-xs",children:"Reset Col"})]})}function Qle(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{await ae.selection_set_color("white:25"),await Mt.getState().updateToggel()},"data-tooltip":`Sets selected to 25% opacity. Opacity higher than 10% is selectable by default.
To select through transparent hold SHIFT key down.`,children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-4 w-4",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"White/0.25"})]})}function Jle(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{await ae.selection_set_color("yellow"),await Mt.getState().updateToggel()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-4 w-4 text-yellow-500",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"Yellow"})]})}async function FN(){await ae.selection_invert(),Mt.getState().updateToggel()}function ece(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":"Inverts selection",onClick:async()=>{FN()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Invert",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),d.jsx("span",{className:"text-center text-xs",children:"Invert Sel"})]})}function tce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{await ae.selection_set_color("red"),await Mt.getState().updateToggel()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-4 w-4 text-red-500",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"Red"})]})}function nce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{await ae.selection_set_color("gray"),await Mt.getState().updateToggel()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-4 w-4 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"Gray"})]})}async function P6(){await ae.selection_set_color("white:10"),await Mt.getState().updateToggel()}function rce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{P6()},"data-tooltip":`Sets selected to 10% opacity. Opacity 10% or less is not selectable by default.
To select transparent 10% or less hold SHIFT key down.`,children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-4 w-4",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"White/0.10"})]})}function ice(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{await ae.selection_set_color("brown"),await Mt.getState().updateToggel()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-4 w-4 text-amber-500",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"Brown"})]})}async function k6(){const n=mn.getState().allowSelectionOfHidden;ae.selection_allow_selection_of_hidden(!n),mn.setState({allowSelectionOfHidden:!n}),await ae.selection_append(),Mt.getState().updateToggel()}function sce(){const n=mn();let e="text-red-500 min-h-[30px] h-5 w-5 ";return n.allowSelectionOfHidden&&(e="text-green-500 min-h-[30px] h-5 w-5 "),d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":["Allow selection of hidden i treeview or when doing invert selection","They will show with selectino color, and be hidden when deselecting"].join(`
`),onClick:async()=>{k6()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zM12 2.25V4.5m5.834.166l-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243l-1.59-1.59"})}),d.jsx("span",{className:"text-center text-xs",children:"Hidden"})]})}function oce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{await ae.selection_set_color("darkorange"),await Mt.getState().updateToggel()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-4 w-4 text-orange-500",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"Orange"})]})}function ace(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{await ae.selection_set_color("indigo"),await Mt.getState().updateToggel()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-4 w-4 text-indigo-500 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"Indigo"})]})}function lce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{const n=F().getActiveCamera(),e=F().getActiveControls(),t=e.azimuthAngle,r=e.polarAngle;n.position.set(n.position.x,n.position.y+1e-7,n.position.z),e.setTarget(n.position.x,n.position.y,n.position.z).then(()=>{e.azimuthAngle=t,e.polarAngle=r})},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Center me"})]})}function cce(){const n=sp();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.mode==="2D"&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer"),d.jsxs("div",{className:e,onClick:()=>{F().setCameraMode("2D"),F().fitModelToCanvas(),F().forceRenderNextFrame()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"})}),d.jsx("span",{className:"text-center text-xs",children:"Orthographic"})]})}function uce(){const n=sp();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.mode==="3D"&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer"),d.jsxs("div",{className:e,onClick:()=>{F().setCameraMode("3D"),F().fitModelToCanvas(),F().forceRenderNextFrame()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"})}),d.jsx("span",{className:"text-center text-xs",children:"Perspective"})]})}function dce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{F().setGizmoAxis("-x")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"West"})]})}function hce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{F().setGizmoAxis("x")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"East"})]})}function fce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{F().setGizmoAxis("y")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"North"})]})}function pce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{F().setGizmoAxis("-y")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"South"})]})}function mce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{F().setGizmoAxis("-z")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Under"})]})}function gce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{F().setGizmoAxis("z")},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.03v.568c0 .334.148.65.405.864l1.068.89c.442.369.535 1.01.216 1.49l-.51.766a2.25 2.25 0 01-1.161.886l-.143.048a1.107 1.107 0 00-.57 1.664c.369.555.169 1.307-.427 1.605L9 13.125l.423 1.059a.956.956 0 01-1.652.928l-.679-.906a1.125 1.125 0 00-1.906.172L4.5 15.75l-.612.153M12.75 3.031a9 9 0 00-8.862 12.872M12.75 3.031a9 9 0 016.69 14.036m0 0l-.177-.529A2.25 2.25 0 0017.128 15H16.5l-.324-.324a1.453 1.453 0 00-2.328.377l-.036.073a1.586 1.586 0 01-.982.816l-.99.282c-.55.157-.894.702-.8 1.267l.073.438c.08.474.49.821.97.821.846 0 1.598.542 1.865 1.345l.215.643m5.276-3.67a9.012 9.012 0 01-5.276 3.67m0 0a9 9 0 01-10.275-4.835M15.75 9c0 .896-.393 1.7-1.016 2.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Above"})]})}function vce(){const n=Xe();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.enabled&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":"Toggle axes info on/off.",onClick:async()=>{Bt.toggleClipping()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 3.75H6.912a2.25 2.25 0 00-2.15 1.588L2.35 13.177a2.25 2.25 0 00-.1.661V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18v-4.162c0-.224-.034-.447-.1-.661L19.24 5.338a2.25 2.25 0 00-2.15-1.588H15M2.25 13.5h3.86a2.25 2.25 0 012.012 1.244l.256.512a2.25 2.25 0 002.013 1.244h3.218a2.25 2.25 0 002.013-1.244l.256-.512a2.25 2.25 0 012.013-1.244h3.859M12 3v8.25m0 0l-3-3m3 3l3-3"})}),d.jsx("span",{className:"text-center text-xs",children:n.enabled?"Disable":"Enable"})]})}function g3(){const n=Xe();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.transformHelperEnabled&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":`Toggle scale/move tools on/off. 
Shortcut for this is X.`,onClick:async()=>{Bt.toggleTransformHelper()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Tool toggle"})]})}function v3(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Resizes clippingbox to selected. 
Shortcut for this is F.`,onClick:async()=>{Xe.getState().enabled||Bt.toggleClipping();const e=await Bt.resizeToSelected(),t=new N;e.getCenter(t),F().setOrbitOn(t)},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Fit Selected"})]})}function _3(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Toggle between transform mode translate and scale. 
Sortcut for this is M`,onClick:async()=>{Bt.toggleMode()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-2.25-2.25l3.276-3.276a4.5 4.5 0 00-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437l1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008z"})}),d.jsx("span",{className:"text-center text-xs",children:"Tool Mode"})]})}function x3(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Resizes clippingbox to selected. 
No shortcut for this`,onClick:async()=>{Xe.getState().enabled||Bt.toggleClipping(),Bt.resizeToLoaded()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})}),d.jsx("span",{className:"text-center text-xs",children:"Fit Loaded"})]})}function _ce(){const n=Jr();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.enabled&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":"Enable/Disable transform tools",onClick:async()=>{n.enabled?xo.disable():xo.enable()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:n.enabled?"Disable":"Enable"})]})}let uC=!1;function xce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{uC=!uC,F().__sceneController.getMeshes().map(n=>n.$setPicking?n.$setPicking(uC,!1):null),F().forceRenderNextFrame()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-4 w-4 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),d.jsx("span",{className:"text-center text-xs ml-2 mr-2",children:"toggel picking colors"})]})}function yce(){const n=Jr();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.mode==="rotate"&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":"Set transform tool to rotation",onClick:async()=>{const t="rotate";Jr.setState({mode:t}),xo.toggleMode(t)},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Rotate"})]})}function wce(){const n=Jr();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.mode==="scale"&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":"Set transform tool to scaling",onClick:async()=>{const t="scale";Jr.setState({mode:t}),xo.toggleMode(t)},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Scale"})]})}function Sce(){const n=Jr();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.mode==="translate"&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":"Set transform tool to transform",onClick:async()=>{const t="translate";Jr.setState({mode:t}),xo.toggleMode(t)},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Translate"})]})}function Ece(){const n=Jr();return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":"Resets selected back to original position",onClick:async()=>{qle(),n.enabled&&(xo.disable(),xo.enable())},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),d.jsx("span",{className:"text-center text-xs",children:"Reset Sel."})]})}function Tce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{await ble()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Set selection as occluders (only use volume)"})]})}function Cce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{Ile()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Force Toggle Occulders on/off"})]})}function bce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{Rle()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Hide Occluders"})]})}function Ace(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{Mle()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Show Occluders"})]})}function Mce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{Cle()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Set sites as occluders"})]})}function Rce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{Nle()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Clear all occluders"})]})}function Nce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{M6()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Set clipbox as occluders (replace)"})]})}function Ice(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{M6(!0)},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Set clipbox as occluders (add)"})]})}function Pce(){return d.jsxs("div",{className:"w-34 flex  hover:bg-gray-500 text-gray-300  items-center pl-2 ml-2 mr-2 hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:async()=>{Ale()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Print Occulders To Console"})]})}function kce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await yF()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 2X"})]})}function Lce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await wF()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 3X"})]})}function Oce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await aZ()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 2X"})]})}function Dce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await cZ()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 3X"})]})}function Uce(){const n=Xe();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.lineHelperEnabled&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":`Toggle box lines on/off. 
`,onClick:async()=>{Bt.toggleLineHelper()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Box toggle"})]})}function Fce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await oZ()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 2X"})]})}function jce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Enables and sets clipping box 
No shortcut for this`,onClick:async()=>{await lZ()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"})}),d.jsx("span",{className:"text-center text-xs",children:"Size 3X"})]})}function zce(){const n=Xe();let e="w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer";return n.axisHelperEnabled&&(e="w-20 flex flex-col m-2 hover:bg-gray-500 text-yellow-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto"),d.jsxs("div",{className:e,"data-tooltip":`Toggle scale/move tools on/off. 
Shortcut for this is X.`,onClick:async()=>{Bt.toggleAxisHelper()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[" ",d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Axis toggle"})]})}function Bce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":"Undo last transform if any",onClick:async()=>{await ae.undo_transform(),xo.updateClippingHelper()},children:[d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.867 19.125h.008v.008h-.008v-.008z"})]}),d.jsx("span",{className:"text-center text-xs",children:"Undo last"})]})}function Hce(){const[n,e]=ee.useState("zoom");return sp().mode!=="2D"?null:d.jsxs("div",{"data-tooltip":["You might need dolly mode if you start getting clipping issues","Model will also start turning dark","This might happend due to angle/camera offset when using left button rotate mode"].join(`
`),className:"w-25 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{const i=F().__controls2d;i.mouseButtons.wheel===Cr.ACTION.ZOOM?(i.mouseButtons.wheel=Cr.ACTION.DOLLY,e("dolly")):(i.mouseButtons.wheel=Cr.ACTION.ZOOM,e("zoom")),i.saveState()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"})}),d.jsxs("span",{className:"text-center text-xs",children:["Wheel ",n]})]})}function Vce(){const[n,e]=ee.useState("pan");return sp().mode!=="2D"?null:d.jsxs("div",{className:"w-25 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{const i=F().__controls2d;i.mouseButtons.left===Cr.ACTION.TRUCK?(i.mouseButtons.left=Cr.ACTION.ROTATE,e("rotate")):(i.mouseButtons.left=Cr.ACTION.TRUCK,e("pan")),i.saveState()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",d:"M15.75 10.5l4.72-4.72a.75.75 0 011.28.53v11.38a.75.75 0 01-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 002.25-2.25v-9a2.25 2.25 0 00-2.25-2.25h-9A2.25 2.25 0 002.25 7.5v9a2.25 2.25 0 002.25 2.25z"})}),d.jsxs("span",{className:"text-center text-xs",children:["left ",n]})]})}function Gce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":["Hides unselected items, shortcut J"].join(`
`),onClick:async()=>{I6()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"})}),d.jsx("span",{className:"text-center text-xs",children:"Unhide"})]})}function Wce(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":["Unhides manualy hidden before, shortcut K"].join(`
`),onClick:async()=>{DN()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"min-h-[30px] h-5 w-5 ",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"})}),d.jsx("span",{className:"text-center text-xs",children:"Unhide All"})]})}async function jN(){const n=ke.getState().selectedProject;if(n!=null&&n.controllerPosition&&(n!=null&&n.controllerTarget)){Gv(),await ae.selection_clear(!0);const e=ke.getState().selectedLayer,t=(e==null?void 0:e.controllerTarget)||(n==null?void 0:n.controllerTarget),r=(e==null?void 0:e.controllerPosition)||(n==null?void 0:n.controllerPosition);await F().getActiveControls().setLookAt(r[0],r[1],r[2],t[0],t[1],t[2],!1),await _v()}else await _v(),F().fitModelToCanvas(!0);F().getSceneController().updateBB(),Ra.clear(),Mt.setState({update:!0})}function dC(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer","data-tooltip":`Loads model, if model is already loaded,
model will be unloaded/loaded`,onClick:async()=>{await jN()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5 ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),d.jsx("span",{className:"text-center text-xs",children:"Load"})]})}function Yce(){var t;const n=i6(),e=ke();switch(n.activeTab){case"HOME":return d.jsxs("div",{className:"flex",children:[d.jsxs(Kt,{name:e.selectedLayerTitle||"No project/layer selected",children:[e.localMode?d.jsx(d.Fragment,{}):d.jsx(Qoe,{}),e.localMode?d.jsx(d.Fragment,{}):d.jsx(Joe,{}),d.jsx(Zoe,{}),d.jsx(s6,{}),d.jsx(Kae,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsxs(Kt,{name:"Load and unload all",children:[d.jsx(dC,{}),d.jsx(iC,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsx(Kt,{name:"Append local file",children:d.jsx(jae,{})})]});case"SELECTION_TRANSFORM":return d.jsxs("div",{className:"flex",children:[d.jsx(Kt,{name:"Status",children:d.jsx(_ce,{})}),d.jsxs(Kt,{name:"Mode",children:[d.jsx(yce,{}),d.jsx(wce,{}),d.jsx(Sce,{})]}),d.jsx(Kt,{name:"Reset Selected",children:d.jsx(Ece,{})}),d.jsx(Kt,{name:"Undo",children:d.jsx(Bce,{})}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"})]});case"SELECTION_COLOR":return d.jsxs("div",{className:"flex",children:[d.jsxs(Kt,{name:"Hidden items",children:[d.jsx(Kle,{}),d.jsx(Gce,{}),d.jsx(Wce,{}),d.jsx(sce,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsxs(Kt,{name:"Quick Coloring, sets color of selected",children:[d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx($le,{}),d.jsx(Xle,{})]}),d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(Jle,{}),d.jsx(tce,{})]}),d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(nce,{}),d.jsx(ice,{})]}),d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(ace,{}),d.jsx(oce,{})]}),d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(Qle,{}),d.jsx(rce,{})]}),d.jsx(Zle,{}),d.jsx(ece,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsxs(Kt,{name:"Load and unload all",children:[d.jsx(dC,{}),d.jsx(iC,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"})]});case"CLIPPING_BOX":return d.jsxs("div",{className:"flex",children:[d.jsxs(Kt,{name:"Enable/Disable",children:[d.jsx(vce,{}),d.jsx(g3,{}),d.jsx(_3,{}),d.jsx(Uce,{}),d.jsx(zce,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsxs(Kt,{name:"From Selection - center",children:[d.jsx(x3,{}),d.jsx(v3,{}),d.jsx(kce,{}),d.jsx(Lce,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsxs(Kt,{name:"From Selection - buttom - 1m",children:[d.jsx(Oce,{}),d.jsx(Dce,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsxs(Kt,{name:"From Selection - top - 1m",children:[d.jsx(Fce,{}),d.jsx(jce,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"})]});case"CLIPPING_PLANE":return d.jsxs("div",{className:"flex",children:[d.jsx(Kt,{name:"West & East",children:d.jsx(Hae,{})}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsx(Kt,{name:"North & South",children:d.jsx(Gae,{})}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsx(Kt,{name:"Above & Under",children:d.jsx(Yae,{})}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"})]});case"SET":return d.jsxs("div",{className:"flex",children:[d.jsxs(Kt,{name:"Generate Sharable Model/URL",children:[d.jsx(Ole,{}),d.jsx(Dle,{}),d.jsx(Ule,{}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[55px]"}),d.jsx(Yle,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsxs(Kt,{name:"Load and unload all",children:[d.jsx(dC,{}),d.jsx(iC,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),(t=ke.getState().selectedProject)!=null&&t.enable_glb?d.jsxs(d.Fragment,{children:[d.jsx(Kt,{name:"File export",children:d.jsx(vle,{})}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"})]}):d.jsx("div",{})]});case"MEASURE":return d.jsxs("div",{className:"flex",children:[d.jsxs(Kt,{name:"Measure length (meter)",children:[d.jsx(Fle,{}),d.jsx(zle,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsxs(Kt,{name:"Measure square meter (m2)",children:[d.jsx(Ble,{}),d.jsx(Hle,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"})]});case"VIEW":return d.jsxs("div",{className:"flex",children:[d.jsxs(Kt,{name:"Camera Projection",children:[d.jsx(cce,{}),d.jsx(uce,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsxs(Kt,{name:"Viewpoints  (should be used with clipping box only)",children:[d.jsx(gce,{}),d.jsx(dce,{}),d.jsx(hce,{}),d.jsx(fce,{}),d.jsx(pce,{}),d.jsx(mce,{})]}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsxs(Kt,{name:"Mouse behavior",children:[d.jsx(Hce,{}),d.jsx(Vce,{})]})]});case"TOOLS":return d.jsxs("div",{className:"flex",children:[d.jsx(Kt,{name:"External Data & Tools",children:d.jsx(Gle,{})}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"})]});case"DEV":return d.jsxs("div",{className:"flex",children:[d.jsx(Kt,{name:"new project helpers",children:d.jsx("div",{className:"flex flex-col place-content-evenly",children:d.jsx(Wle,{})})}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsx(Kt,{name:"new project helpers",children:d.jsx("div",{className:"flex flex-col place-content-evenly",children:d.jsx(lce,{})})}),d.jsx("div",{className:"m-1 border-r border-gray-600 min-h-[95px]"}),d.jsx(Kt,{name:"new project helpers",children:d.jsx("div",{className:"flex flex-col place-content-evenly",children:d.jsx(xce,{})})}),d.jsx(Kt,{name:"Culling tools clip box",children:d.jsxs("div",{className:"flex   place-content-evenly",children:[d.jsx(x3,{}),d.jsx(v3,{}),d.jsx(_3,{}),d.jsx(g3,{})]})}),d.jsxs(Kt,{name:"Culling Tools",children:[d.jsxs("div",{className:"flex  flex-col place-content-evenly",children:[d.jsx(Tce,{}),d.jsx(Mce,{}),d.jsx(Nce,{}),d.jsx(Ice,{})]}),d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(bce,{}),d.jsx(Ace,{})]}),d.jsxs("div",{className:"flex flex-col place-content-evenly",children:[d.jsx(Cce,{}),d.jsx(Rce,{}),d.jsx(Pce,{})]})]})]})}return null}function ko(n){const e=i6();function t(i){return e.activeTab===i?"text-gray-300 bg-gray-800  border-r border-gray-400 border-l border-t rounded-t mt-1 font-semibold cursor-pointer ":"text-gray-900 bg-gray-400 mt-1 rounded-t cursor-pointer "}function r(i){const s=i.toLowerCase();return s[0].toUpperCase()+s.substring(1,s.length)}return d.jsx("button",{className:t(n.name)+"w-28  mr-1 ml-1  text-xs border-gray-700 text-center ",onClick:()=>{e.setActiveTab(n.name),F().getSceneController().toolsController.setActive(null)},children:n.titleOverride||r(n.name)})}function Kce(){return d.jsxs("div",{className:"flex bg-gray-800 pointer-events-auto ",children:[d.jsx(ko,{name:"HOME"}),ZU?d.jsx(ko,{name:"DEV"}):null,d.jsx(ko,{name:"CLIPPING_PLANE",titleOverride:"Clipping Plane"}),d.jsx(ko,{name:"CLIPPING_BOX",titleOverride:"Clipping Box"}),d.jsx(ko,{name:"MEASURE",titleOverride:"Measure Tools"}),d.jsx(ko,{name:"SELECTION_TRANSFORM",titleOverride:"Selection Transform"}),d.jsx(ko,{name:"SELECTION_COLOR",titleOverride:"Selection Color"}),d.jsx(ko,{name:"VIEW",titleOverride:"Projection & View"}),d.jsx(ko,{name:"SET",titleOverride:"Sets"}),d.jsx(ko,{name:"TOOLS",titleOverride:"Data & Tools"})]})}function $ce(){return d.jsxs("div",{className:"flex bg-gray-800 flex-col",children:[d.jsx(Kce,{}),d.jsxs("div",{className:"flex bg-gray-800",children:[d.jsx(Yce,{}),d.jsxs("div",{className:"flex flex-1",children:[d.jsx("div",{className:"flex flex-1"}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("div",{className:"flex flex-1"}),d.jsxs("div",{className:"flex p-1 text-gray-600",children:["V:","1.12.2"]})]})]})]}),d.jsx("div",{className:"relative bg-yellow-300",children:d.jsxs("div",{className:"absolute w-full flex flex-col text-sm p-1",children:[d.jsx(Xce,{}),d.jsx(qce,{})]})})]})}function Xce(){return Qr().anyActiveTools?d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"m-auto bg-gray-900 text-yellow-500",children:"To start and end measurement use CONTROL KEY + LEFT MOUSE."}),d.jsx("span",{className:"m-auto bg-gray-900 text-yellow-500 mb-1",children:"To delete, activate tool, hover label and press DELETE key."})]}):null}function qce(){const n=De(),e=Xe();return!n.x_plane_enable&&!n.y_plane_enable&&!n.z_plane_enable&&!e.enabled?null:d.jsx(d.Fragment,{children:d.jsx("span",{className:"m-auto  bg-gray-900 text-yellow-500",children:"INFO Clipping is enabled"})})}function Zce(n){const e={height:"17px",display:"block",overflow:"hidden",width:"100%"};return d.jsx(d.Fragment,{children:n.items.map((t,r)=>d.jsx("div",{style:e,className:"border-b block border-gray-700 text-xs hover:bg-gray-700",onClick:async i=>{const s=await ae.get_ids_from_fullnames([i.target.textContent]);if(s.length){await ae.selection_clear(!1);let o=s;Array.isArray(s)?(o=s,ld(s[0],!1)):ld(s,!1);for(let a=0;a<o.length;a++){const l=o[a];await ae.treeview_expand_from_id(l);const c=await ae.getKeyChildrenFromItem(l);await ae.selection_add(s.concat([l]).concat(c));const u=ae.getRowOfKey(l);Mt.getState().updateToggel(u),await ae.selection_append()}}},children:d.jsx("div",{children:t})},r))})}function Qce(n){return n.active?d.jsx("div",{style:{height:"25px",display:"block",overflow:"hidden",width:"100%"},className:"relative border-b block border-gray-700 text-xs hover:bg-gray-700 p-1 animate-pulse",children:"waiting for result, please wait"}):n.results?null:d.jsx("div",{style:{height:"25px",display:"block",overflow:"hidden",width:"100%"},className:"relative border-b block border-gray-700 text-xs hover:bg-gray-700 p-1 animate-pulse",children:"found nothing"})}let y3,D_=0,w3="",hC=0;function L6(){const n=mn(),[e,t]=ee.useState([]),[r,i]=ee.useState(!1),s=10;if(!n.treeViewActive)return e.length&&t([]),null;if(!n.treeViewSearchActive)return e.length&&t([]),null;let o=e.length*17;e.length===s||e.length===0?o=o+60:o=o+40;async function a(l){D_=D_+1,clearTimeout(y3),li.flushSync(()=>{i(!0),t([])}),y3=setTimeout(async()=>{const c=D_;w3=l;const[u,h]=await ae.filterFullname(l,hC,s);hC=u.length===s?h:0,c===D_&&(i(!1),t(u))},350)}return d.jsxs("div",{className:"flex flex-col pointer-events-auto bg-gray-800 overflow-hidden",style:{width:n.treeViewWidth+"px",minHeight:o+"px"},children:[d.jsx("input",{className:"inline-block p-1 m-1 text-gray-300 bg-gray-700 outline-none ","data-tooltip":"Default is equal, you can use * for wildcard, only support wildcard in the start or end",placeholder:"Equal filter, wilcard is * (start/end)",onChange:async l=>{hC=0,a(l.target.value)}}),d.jsxs("div",{className:"ml-1 mr-1 w-full whitespace-nowrap text-xs mb-1",children:[d.jsx(Qce,{active:r,results:e.length}),d.jsx(Zce,{items:e})]}),e.length===s?d.jsxs("button",{className:"bg-indigo-700 m-auto w-full",onClick:()=>{a(w3)},children:["Next ",s]}):null]})}function zN(n){uy.add(n)}let O6=new et;function S3(){return O6}function Jce(){zN({handleEvent:async n=>{if(n){const e=await ae.getBoundingBoxFromKey(n.key);e&&e.X!==void 0&&(O6=new et(new N(e.x,e.y,e.z),new N(e.X,e.Y,e.Z)))}}})}let Ch=!1;function D6(){const n=mn(),[e,t]=ee.useState(!1);return n.treeViewActive?d.jsx("div",{className:"pointer-events-auto flex bg-gray-800",style:{width:n.treeViewWidth+"px"},children:d.jsxs("div",{className:"flex overflow-hidden",children:[d.jsx("div",{className:"m-1",onClick:()=>{n.treeViewSearchToggle()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 p-1 m-1 max-w-6 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Toggle Search",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),d.jsx("div",{className:"m-1",onClick:async()=>{await ae.treeview_collapse()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 p-1 m-1 max-w-6 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Collapse Tree",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 11l7-7 7 7M5 19l7-7 7 7"})})}),d.jsx("div",{className:"m-1",onClick:()=>{if(S3()){const r=new N;S3().getCenter(r),F().getActiveControls().smoothTime=.5,F().getActiveControls().saveState(),F().getActiveControls().setLookAt(r.x+2,r.y+2,r.z+2,r.x,r.y,r.z,!0).then(()=>{F().getActiveControls().smoothTime=1,F().getActiveControls().saveState()})}},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 p-1 m-1 max-w-6 hover:bg-gray-500 rotate-45",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Fly to selected",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}),d.jsx("div",{className:"m-1",onClick:async()=>{if(Ch)await ae.selection_show_only_selected(!Ch);else{const r=await ae.get_bounding_box_from_selection(),i=new et(new N(r.x,r.y,r.z),new N(r.X,r.Y,r.Z)),s=new N;i.getCenter(s),await F().setOrbitOn(s),await ae.selection_show_only_selected(!Ch)}Ch=!Ch,t(!e),F().forceRenderNextFrame()},children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:Ch?"text-yellow-500 h-6 w-6 p-1 m-1 max-w-6 hover:bg-gray-500":"h-6 w-6 p-1 m-1 max-w-6 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":["Forcus orbit point to selected and hides everything except selected.","Only for quick on/off to find item if you are unable to see it.","Atm this is a quick visual mode only"].join(`
`),strokeWidth:2,children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),d.jsx("div",{className:"m-1",onClick:()=>{F().getActiveControls().smoothTime=.5,F().getActiveControls().saveState(),F().setOrbitOn().then(()=>{F().getActiveControls().smoothTime=1,F().getActiveControls().saveState()})},children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 p-1 m-1 max-w-6 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":`Set last clicked point in model as focus point for rotation.
Shortcut for this is O`,strokeWidth:2,children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M18.816 13.58c2.292 2.138 3.546 4 3.092 4.9c-.745 1.46 -5.783 -.259 -11.255 -3.838c-5.47 -3.579 -9.304 -7.664 -8.56 -9.123c.464 -.91 2.926 -.444 5.803 .805"}),d.jsx("path",{d:"M12 12m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"})]})})]})}):null}function eue(){const n=ee.useRef(null);return ee.useEffect(()=>{const e=n.current;let t,r,i;const s=new ResizeObserver(o=>{for(const a of o)clearTimeout(t),t=setTimeout(()=>{const l=Array.isArray(a.contentRect)?a.contentRect[0]:a.contentRect,c=l.width+(e==null?void 0:e.offsetLeft)||0,u=l.height;F()&&(r!==c||i!==u)&&F().setSize(window.innerWidth,window.innerHeight,0,(e==null?void 0:e.offsetTop)||0)},100)});return e&&s.observe(e),()=>{e&&s.unobserve(e)}}),d.jsx("div",{className:"fixed flex z-40 h-full w-full pointer-events-none",children:d.jsxs("div",{className:"flex flex-col  select-none w-full h-full pointer-events-none",children:[d.jsx($ce,{}),d.jsxs("div",{className:"flex flex-grow",style:{minHeight:"0px"},children:[d.jsxs("div",{className:"flex flex-col flex-grow border-b-4 border-gray-900",style:{minHeight:"0px"},children:[d.jsx(D6,{}),d.jsx(L6,{}),d.jsx(r6,{})]}),d.jsx("div",{ref:n,id:"canvas-tracker",className:"w-full h-full"})]})]})})}function fC(){const n=it();return n.loadingData?d.jsx("div",{className:"fixed grid w-full h-full items-center justify-center fadeIn z-[9000] bg-gray-600/70",children:d.jsxs("div",{className:"block w-96 h-80 bg-gray-800 shadow-2xl",children:[d.jsx("span",{className:"m-auto block text-center text-2xl  p-2 bg-gray-700 text-white",children:"Please wait"}),d.jsx("div",{className:"block m-2 mt-10",children:d.jsx("span",{className:"m-auto block text-center loader text-white"})}),d.jsx("span",{className:"m-auto block text-center underline font-semibold text-white",children:n.dialogHeader}),d.jsx("span",{className:"m-auto block text-center mt-4 whitespace-pre-line text-white",children:n.dialogContent||""})]})}):null}const E3={};function Dg(n,e,t,r,i){function s(){const o=window.innerWidth,a=window.innerHeight;let l=r().bottom,c=r().right,u=r().height,h=r().width;const f=r().closed;clearTimeout(E3[e]),E3[e]=setTimeout(()=>{l+u>a?(l=a-u,l<0&&(l=0,u=a)):l<0&&(l=0,l+u>a&&(l=0,u=a)),c+h>o?(c=o-h,c<0&&(c=0,h=o)):c<0&&(c=0,c+h>o&&(c=0,h=o)),li.flushSync(()=>{i({height:u,width:h,right:c,bottom:l,initLoaded:!0,closed:f})})},250)}if(t==="open"&&(window.addEventListener("resize",s),!r().initLoaded)){let o=r().bottom,a=r().right,l=r().height,c=r().width;o+l>innerHeight?(o=innerHeight-l,o<0&&(o=0,l=innerHeight)):o<0&&(o=0,o+l>innerHeight&&(o=0,l=innerHeight)),a+c>innerWidth?(a=innerWidth-c,a<0&&(a=0,c=innerWidth)):a<0&&(a=0,a+c>innerWidth&&(a=0,c=innerWidth)),i({height:l,width:c,right:a,bottom:o,initLoaded:!0,closed})}t==="close"&&window.removeEventListener("resize",s)}function br(n,e,t,r,i=350,s=o=>{}){let o=n==null?void 0:n.clientX,a=n==null?void 0:n.clientY,l=t.bottom,c=t.right,u=t.height,h=t.width;function f(y){var R;let g=y.clientX,m=y.clientY;(R=y.changedTouches)!=null&&R[0]&&(g=y.changedTouches[0].clientX,m=y.changedTouches[0].clientY);const v=window.innerHeight,x=Math.abs(Math.abs(g)-Math.abs(o)),w=Math.abs(Math.abs(m)-Math.abs(a));let E=null,S=null;o>g&&(E="left"),o<g&&(E="rigth"),a>m&&(S="up"),a<m&&(S="down"),o=g,a=m;function C(){S==="up"&&l+u<v&&(u=u+w),S==="down"&&(u=u-w,u<40&&(u=40))}function A(){S==="up"&&(u=u-w,u<40?u=40:l=l+w),S==="down"&&(l=l-w,l<0?l=0:u=u+w)}function k(){const $=window.innerWidth;E==="left"&&(h=h+x,c+h>$&&(h=$-c)),E==="rigth"&&h>i&&(h=h-x)}function T(){E==="left"&&h>i&&(c=c+x,h=h-x,c+h>innerWidth&&(c=innerWidth-h)),E==="rigth"&&(c=c-x,c<0?c=0:h=h+x)}switch(e){case"top":C();break;case"top-left":C(),k();break;case"top-right":C(),T();break;case"left":k();break;case"right":T();break;case"bottom-left":A(),k();break;case"bottom-right":A(),T();break;case"bottom":A();break;case"position":E==="left"&&(c=c+x,c+h>innerWidth&&(c=innerWidth-h)),E==="rigth"&&(c=c-x,c<0&&(c=0)),S==="up"&&(l=l+w,l+u>v&&(l=v-u)),S==="down"&&(l=l-w,l<0&&(l=0));break}li.flushSync(()=>{r({height:u,width:h,right:c,bottom:l,initLoaded:!0,closed})})}function p(){s(!1);const y=document.getElementsByTagName("iframe");for(let g=0;g<y.length;g++)y[g].style.pointerEvents="auto";window.removeEventListener("touchend",p),window.removeEventListener("touchmove",f),window.removeEventListener("mouseup",p),window.removeEventListener("mousemove",f)}s(!0);const _=document.getElementsByTagName("iframe");for(let y=0;y<_.length;y++)_[y].style.pointerEvents="none";window.addEventListener("touchend",p),window.addEventListener("touchmove",f),window.addEventListener("mouseup",p),window.addEventListener("mousemove",f)}function xv(n){const e=document.getElementsByClassName("floating-dialog");let t=0;for(let i=0;i<e.length;i++){const s=parseInt(e[i].style.zIndex||"0");t<s&&(t=s)}let r=n.target;for(;r;){if(r!=null&&r.classList.contains("floating-dialog"))for(let i=0;i<e.length;i++)e[i]===r&&(e[i].style.zIndex=(t+1).toString());r=r.parentElement}}function tue(){document.removeEventListener("mousedown",xv),document.addEventListener("mousedown",xv)}const T3=new Map;function U6(n){const[e,t]=ee.useState(n.state.height);return n.state.height===40?d.jsx("div",{className:" bg-gray-700 h-6 w-6  hover:bg-gray-600 focus:outline-none text-blue-600 font-semibold cursor-pointer",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",onClick:()=>{if(n.uniqueName){const r=T3.get(n.uniqueName)||150,i=n.state.bottom-r+40;n.setState({...n.state,bottom:i,height:r})}else{const r=n.state.bottom-e+40;n.setState({...n.state,bottom:r,height:e})}},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 5.25l-7.5 7.5-7.5-7.5m15 6l-7.5 7.5-7.5-7.5"})})}):d.jsx("div",{className:" bg-gray-700 h-6 w-6  hover:bg-gray-600 focus:outline-none text-blue-600 font-semibold cursor-pointer",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",onClick:()=>{n.uniqueName&&T3.set(n.uniqueName,n.state.height),t(n.state.height);const r=n.state.bottom+n.state.height-40;n.setState({...n.state,bottom:r,height:40})},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l7.5-7.5 7.5 7.5m-15 6l7.5-7.5 7.5 7.5"})})})}function OS(n){const e=ee.useRef(null),[t,r]=ee.useState(),[i,s]=ee.useState({height:100,width:100,bottom:0,right:0,initLoaded:!1,closed:!n.isOpen});ee.useEffect(()=>{n.isOpen&&xv({target:e==null?void 0:e.current})},[n.isOpen]),ee.useEffect(()=>{if(!t&&n.isOpen){r(1);let l={height:0,width:0,bottom:0,right:0,initLoaded:!1,closed:!n.isOpen};if(n.adjustOnLoad){if(n.width&&n.height){const c=window.innerWidth-n.width,u=window.innerHeight-n.height;l={height:n.height,width:n.width,bottom:Math.floor((u||100)/2),right:Math.floor((c||100)/2),initLoaded:!1,closed:!n.isOpen}}if(n.right&&n.bottom){const c=window.innerWidth-n.right*2;l={height:window.innerHeight-n.bottom*2,width:c,bottom:n.bottom,right:n.right,initLoaded:!1,closed:!n.isOpen}}}else l={height:n.height||i.height,width:n.width||i.width,bottom:n.bottom||i.bottom,right:n.right||i.right,initLoaded:!1,closed:!n.isOpen};s(l),Dg({},n.uniqueName,"open",()=>l,s)}else Dg({},n.uniqueName,"open",()=>i,s);return()=>{Dg({},n.uniqueName,"close",()=>i,s)}});const o={bottom:i.bottom,right:i.right,width:i.width,height:i.height,zIndex:110};if(!n.isOpen)return null;const a=n.isModal?"fixed bg-slate-500/70 top-0 bottom-0 left-0 right-0 z-[1000]":"";return d.jsx("div",{className:a,children:d.jsxs("div",{ref:e,style:o,className:"absolute flex select-none flex-col overflow-hidden border  p-1 shadow-2xl shadow-black border-gray-900 bg-gray-800 floating-dialog mb-2",children:[d.jsxs("div",{className:"z-50 flex cursor-move bg-gray-700",onPointerDown:l=>{xv({target:e.current}),br(l,"position",i,s)},children:[d.jsx("span",{className:"m-auto p-1 text-white",children:n.title}),d.jsxs("div",{className:"absolute right-1 flex gap-2",children:[d.jsx(U6,{uniqueName:n.uniqueName,state:i,setState:s}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:" h-6 w-6 font-semibold  hover:bg-gray-600 focus:outline-none bg-gray-700 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"close",strokeWidth:2,onClick:()=>{n.onClose({height:i.height,width:i.width,bottom:i.bottom,right:i.right}),r(0)},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})]})]}),d.jsx("div",{className:"absolute bottom-1 left-1 right-1 top-8 flex",children:n.children}),d.jsxs("div",{className:"absolute bottom-0 left-0 right-0 top-0 z-[-10]",children:[d.jsx("div",{className:"absolute right-0 top-0 z-50 h-3 w-3 cursor-ne-resize ",onPointerDown:l=>br(l,"top-right",i,s)}),d.jsx("div",{className:"absolute bottom-0 right-0 z-50 h-3 w-3 cursor-nw-resize ",onPointerDown:l=>br(l,"bottom-right",i,s)}),d.jsx("div",{className:"absolute left-0 top-0 z-50 h-3 w-3 cursor-nw-resize ",onPointerDown:l=>br(l,"top-left",i,s)}),d.jsx("div",{className:"absolute bottom-0 left-0 z-50 h-3 w-3 cursor-ne-resize ",onPointerDown:l=>br(l,"bottom-left",i,s)}),d.jsx("div",{className:" absolute bottom-0  left-5  right-5 z-50 h-2 cursor-n-resize ",onPointerDown:l=>br(l,"bottom",i,s)}),d.jsx("div",{className:" absolute left-5 right-5 top-0 z-5000 h-2 cursor-n-resize ",onPointerDown:l=>br(l,"top",i,s)}),d.jsx("div",{className:" absolute bottom-5 left-0 top-5 z-5000 w-2 cursor-e-resize",onPointerDown:l=>br(l,"left",i,s)}),d.jsx("div",{className:" absolute bottom-5 right-0 top-5 z-5000 w-2 cursor-e-resize",onPointerDown:l=>br(l,"right",i,s)})]})]})})}function nue(){const n=ke();return d.jsxs("div",{className:"flex-1 flex flex-col flex-grow",children:[d.jsxs("div",{className:"flex flex-col mt-2 mb-1 min-h-20 bg-gray-700 ",children:[d.jsx("span",{className:"m-auto mt-0 font-semibold underline",children:"All Projects:"}),d.jsx("input",{className:"p-1 m-2 outline-none text-black bg-gray-300",placeholder:"Filter projects",value:n.projectFilter,onInput:e=>{n.projectFilter=e.currentTarget.value,n.runFilter()}})]}),d.jsx("div",{className:"flex flex-grow h-full",children:d.jsx("div",{className:"relative w-full h-full",children:d.jsx("div",{className:"absolute top-0 left-0 right-0 bottom-0 overflow-y-auto scrollbar",children:d.jsx("div",{className:"flex flex-col",children:n.filteredProjects.map(e=>{const t=e.unique_key===n.projectSelectedKey;let r="p-1  text-center hover:bg-gray-700 flex  ml-2";return t&&(r="p-1 text-center bg-gray-600/50 hover:bg-gray-600 flex  ml-2"),d.jsx("div",{className:"w-full border-b border-b-gray-500  cursor-pointer",onClick:async()=>{const i=NR(e.container,e.config,e.unique_key,e.project_code,e.project_name),s=setTimeout(()=>{it.setState({loadingData:!0,dialogContent:`Hmm, looks like its going slow today.
If this never goes away then please check network/vpn or just reload page?`,dialogHeader:"Loading layers"})},750),o=await Promise.resolve(i);clearTimeout(s),it.setState({loadingData:!1,dialogContent:"Still waiting",dialogHeader:"Loading data"}),ke.setState({selectedProject:o,projectSelectedKey:e.unique_key,projectSelectedCode:e.project_code,projectSelectedName:e.project_name}),e6()},children:d.jsxs("div",{className:r,children:[d.jsx("div",{className:"font-semibold",children:e.project_code}),d.jsx("div",{className:"ml-2 mr-2",children:"-"}),d.jsx("div",{children:e.project_name||"-"})]})},e.unique_key)})})})})})]})}function rue(){const n=ke();if(it().loadingData)return null;if(!n.projectSelectedKey)return d.jsx("div",{className:"flex-1 flex flex-col flex-grow",children:d.jsx("div",{className:"relative h-full w-full",children:d.jsx("div",{className:"flex",children:d.jsx("span",{className:"m-auto mt-5",children:"No project is selected"})})})});const t=n.selectedProject;return t?d.jsxs("div",{className:"flex-1 flex flex-col flex-grow",children:[d.jsxs("div",{className:"flex flex-col min-h-20 mt-2 mb-1  bg-gray-700",children:[d.jsxs("div",{className:"flex m-auto",children:[d.jsx("div",{className:"font-semibold",children:n.projectSelectedCode}),d.jsx("div",{className:"ml-2 mr-2",children:"-"}),d.jsx("div",{children:n.projectSelectedName||"-"})]}),d.jsx("span",{className:"m-auto mt-0  underline",children:"Available Sub Models:"})]}),d.jsx("div",{className:"relative h-full w-full",children:d.jsx("div",{className:"absolute  top-0 left-0 right-0 bottom-0 overflow-y-auto scrollbar",children:d.jsx("div",{className:"flex flex-col",children:t.model_layer.map((r,i)=>d.jsx("div",{className:"w-full border-b border-b-gray-500 cursor-pointer",onClick:async s=>{var a;Ot.getState().clearSet(),li.flushSync(()=>{mn.setState({treeViewActive:!1})}),ke.setState({selectedLayer:r,selectedLayerTitle:`${n.projectSelectedCode} - ${n.projectSelectedName} - ${r.description}`});let o=location.href.split("?")[0];UC&&(o=o+"?skip-alias"),history.pushState(null,"",o),kS(t.project_code||"unknown"),await PS(t),!un.getState().unsyncedCount&&(li.flushSync(()=>{Xe.setState({enabled:!1}),De.setState({x_plane_enable:!1,y_plane_enable:!1,z_plane_enable:!1}),mn.setState({treeViewActive:!0})}),!((a=s.target)!=null&&a.dataset.loadModel)&&jN())},children:d.jsxs("div",{className:"p-1 ml-2 hover:bg-gray-700 flex",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"})}),d.jsx("div",{className:"ml-2",children:r.description}),d.jsx("div",{className:"flex-1"}),d.jsx("button",{"data-tooltip":["Opens project, but does not load 3d model after sync.","For users who want to load sites manually"].join(`
`),"data-load-model":!0,className:" bg-gray-600 hover:bg-gray-500 p-[0.1rem] ",onClick:()=>{console.log("wow")},children:"Skip load"})]})},i))})})})]}):d.jsx("div",{className:"flex-1 flex flex-col flex-grow",children:d.jsx("div",{className:"relative h-full w-full",children:d.jsx("div",{className:"flex",children:d.jsxs("span",{className:"m-auto mt-5 text-red-800 bg-yellow-300 p-2",children:["Missing access for: ",n.projectSelectedCode]})})})})}let C3=!1;function iue(){const n=ke();return ee.useEffect(()=>{async function e(){n.isOpen&&!C3&&(C3=!0,it.setState({loadingData:!0,dialogHeader:"Loading Projects",dialogContent:"Please wait"}),await ON(!0),it.setState({loadingData:!1,dialogHeader:"",dialogContent:""}))}e()}),n.isOpen?d.jsx("div",{style:{minHeight:0},className:"w-full flex flex-col flex-grow",children:d.jsxs("div",{className:"flex flex-1",children:[d.jsx("div",{className:"flex flex-1",children:d.jsx(nue,{})}),d.jsx("div",{className:"flex p-1",children:d.jsx("div",{className:"border border-gray-600"})}),d.jsx("div",{className:"flex flex-1",children:d.jsx(rue,{})})]})}):null}let bh={height:550,width:1e3,bottom:200,right:0,initLoaded:!1,adjustOnLoad:!0,closed:!0};function pC(){const n=ke();return d.jsx(OS,{uniqueName:"ProjectSelector",adjustOnLoad:bh.adjustOnLoad,isModal:!0,title:"Project Selector",isOpen:n.isOpen,width:bh.width,height:bh.height,bottom:bh.bottom,onClose:e=>{bh={...bh,...e,adjustOnLoad:!1},ke.setState({isOpen:!1})},children:d.jsx(iue,{})})}function sue(){var t;const n=un();ee.useEffect(()=>{bA()},[]);function e(){if(Array.isArray(n.modelGroups)){const r=n.modelGroups;if(Array.isArray(r))return r[0].source_checked_date}return"NA"}return d.jsxs("div",{className:"w-full h-full flex flex-col ",children:[n.unsyncedCount?d.jsxs("div",{className:"mt-2 text-center bg-red-500 text-gray-800 ",children:["You need to sync ",n.unsyncedCount]}):d.jsx("div",{className:"mt-2 text-center bg-green-500 text-gray-800",children:"All synced"}),d.jsx("div",{className:"flex-1 h-full  relative",children:d.jsx("div",{style:{minHeight:0},className:"absolute top-1 left-0 right-0 bottom-0 overflow-y-auto scrollbar",children:d.jsx("div",{className:"flex flex-col",children:(t=n.modelGroups)==null?void 0:t.sort((r,i)=>r.name<i.name?-1:1).map((r,i)=>{const s=r.$synced?"italic text-green-500":"italic text-red-500";return d.jsx("div",{className:"w-full border-b border-b-gray-500",children:d.jsxs("div",{className:"m-1 text-center ",children:[d.jsx("div",{className:"font-semibold",children:r.name}),d.jsx("div",{className:s,children:r.$synced?"Synced":"Not Synced"})]})},i)})})})}),d.jsxs("div",{className:"mt-2 text-center  text-gray-200  border-t border-gray-900 text-xs",children:["Model Checked: ",e()]}),d.jsxs("div",{className:"flex",children:[d.jsx("button",{className:" m-2 bg-indigo-600 w-28 hover:bg-indigo-700",onClick:async()=>{await Yf(!1)||(n.deactivateSyncDialog(),jN())},children:"Sync & load"}),d.jsx("button",{className:" m-2 bg-gray-600 w-28 hover:bg-gray-700",onClick:async()=>{await Yf(!1)||n.deactivateSyncDialog()},children:"Sync Missing"}),d.jsx("button",{className:" m-2 bg-gray-600 w-28 hover:bg-gray-700",onClick:async()=>{await Yf(!0)||n.deactivateSyncDialog()},children:"Resync all"}),d.jsx("button",{className:" m-2 bg-gray-600 w-28 hover:bg-gray-700",onClick:async()=>{bA(!0)},children:"Refresh List"})]})]})}let Ah={height:500,width:550,bottom:200,right:0,initLoaded:!1,adjustOnLoad:!0,closed:!0};function mC(){const n=un();return d.jsx(OS,{uniqueName:"SyncDialog",adjustOnLoad:Ah.adjustOnLoad,title:"Sync",isOpen:n.isOpen,width:Ah.width,height:Ah.height,bottom:Ah.bottom,onClose:e=>{Ah={...Ah,...e,adjustOnLoad:!1},un.setState({isOpen:!1})},children:d.jsx(sue,{})})}let gC=null;const b3=()=>{const[n,e]=ee.useState({x:0,y:0}),[t,r]=ee.useState({show:!1,msg:""});if(ee.useEffect(()=>{const i=function(o,a){var c,u;const l=((u=(c=a==null?void 0:a.dataset)==null?void 0:c.tooltip)==null?void 0:u.length)||0;return l&&o+l*2>innerWidth-2&&(o=o-l*2),o},s=o=>{gC&&clearTimeout(gC);const a=o.target;if(gC=setTimeout(()=>{var u;let l=a,c=0;for(;c<5&&l;){if((u=l==null?void 0:l.dataset)!=null&&u.tooltip){r({show:!0,msg:l.dataset.tooltip});const h=i(o.clientX,a);e({x:h,y:o.clientY});break}c++,l=l==null?void 0:l.parentElement}},300),t.show)r({show:!1,msg:""});else{const l=i(o.clientX,a);e({x:l,y:o.clientY})}};return window.addEventListener("pointermove",s),()=>{window.removeEventListener("pointermove",s)}}),t.show){const i={display:t.show?"block":"none",left:n.x+"px",top:n.y+"px"};return d.jsx("div",{id:"tooltip",style:i,className:"absolute z-[9999] p-1 m-5 text-xs whitespace-pre-wrap  border  drop-shadow-lg  focus:outline-none border-blue-400 bg-gray-800 text-white",children:t.msg})}else return null};function oue(n){const e=ke();return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"bg-gray-700 h-6 w-6  hover:bg-gray-600 focus:outline-none text-blue-600 font-semibold cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"close",strokeWidth:2,onClick:()=>{var t,r;if((t=e==null?void 0:e.selectedProject)!=null&&t.activeTools){const i=(r=e==null?void 0:e.selectedProject)==null?void 0:r.activeTools.indexOf(n.name+":"+n.id);i!==void 0&&i!==-1&&e.selectedProject.activeTools.splice(i,1),ke.setState({selectedProject:null}),ke.setState({selectedProject:e.selectedProject})}},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}function aue(n){const e=ke();return n.allowExternal?d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"bg-gray-700 h-6 w-6  hover:bg-gray-600 focus:outline-none text-blue-600 font-semibold cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"open as external",strokeWidth:2,onClick:()=>{var t,r;if((t=e==null?void 0:e.selectedProject)!=null&&t.activeTools){const i=(r=e==null?void 0:e.selectedProject)==null?void 0:r.activeTools.indexOf(n.name);i!==void 0&&i!==-1&&e.selectedProject.activeTools.splice(i,1),ke.setState({selectedProject:null}),ke.setState({selectedProject:e.selectedProject}),window.open(`${n.url}#external`,n.dialogHeader)}},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"})}):null}function lue(n){py.add(n)}function cue(n){py.delete(n)}function U_(n){return F6()?n.urlBeta:uue()?n.urlTest:n.urlProd}function uue(){return!!(location.origin.includes(".tapps.")&&!F6())}function F6(){return!!(location.origin.includes(".bapps.")||location.origin.includes("beta")||location.origin.includes("localhost")||location.origin.includes("127.0.0.1"))}const due=new Date().getTime().toString();function hue(n){var f,p;const e=ke(),[t,r]=ee.useState(!1),i=ee.useRef(null),s=ee.useRef(null),o=(f=e==null?void 0:e.selectedProject)==null?void 0:f.tools,a=o?o[n.name]:null,[l,c]=ee.useState((a==null?void 0:a.dialogHeader)||""),[u,h]=ee.useState({height:(a==null?void 0:a.height)||200,width:(a==null?void 0:a.width)||200,bottom:(a==null?void 0:a.bottom)||200,right:(a==null?void 0:a.right)||0,initLoaded:!1,closed:!0});if(ee.useEffect(()=>{const _={handleEvent:(y,g)=>(y===`${n.name}:${n.id}`&&c(g==="MANUAL INPUT"?rZ()||"":g||""),!0)};return lue(_),Dg({},n.name,"open",()=>u,h),()=>{cue(_),Dg({},n.name,"close",()=>u,h)}}),ee.useEffect(()=>{s.current&&u.closed&&(h({...u,closed:!1}),xv({target:s.current}))}),(p=e.selectedProject)!=null&&p.tools&&a){const _={bottom:u.bottom,right:u.right,width:u.width,height:u.height,zIndex:110},y=new URLSearchParams;y.append("url",U_(a)),y.append("url",U_(a)),y.append("project",e.selectedProject.project_code),y.append("timestamp",due),y.append("versionweb3d","1.12.2"),y.append("iframe","YES"),y.append("eventsupport","urlopen,fileopen"),y.append("dialogid",n.name+":"+n.id),y.append("web3dBroadcastChannel",rS);const g=t?"w-full h-full pointer-events-none":"w-full h-full pointer-events-auto",m=`${U_(a)}?${y.toString()}`;y.append("iframe","YES");const v=`${U_(a)}?${y.toString()}`,x=200;return d.jsxs("div",{ref:s,style:_,className:"absolute flex bg-gray-800 shadow-2xl border p-1 border-gray-900 flex-col select-none overflow-hidden floating-dialog",children:[d.jsxs("div",{className:"flex bg-gray-700 cursor-move z-50",onPointerDown:w=>br(w,"position",u,h,x,r),children:[d.jsx("span",{className:"p-1",children:l}),d.jsxs("div",{className:"absolute right-1 flex gap-2",children:[d.jsx(aue,{name:n.name,allowExternal:a.allowExternal,dialogHeader:l,url:m}),d.jsx(U6,{state:u,setState:h}),d.jsx(oue,{name:n.name,id:n.id})]})]}),d.jsx("div",{className:"flex flex-1 mt-1 overflow-auto z-50",children:d.jsx("iframe",{className:g,ref:i,src:v})}),d.jsxs("div",{className:"absolute bottom-0 right-0 left-0 top-0",children:[d.jsx("div",{className:"absolute w-3 h-3 z-50 top-0 right-0 cursor-ne-resize",onPointerDown:w=>br(w,"top-right",u,h,x,r)}),d.jsx("div",{className:"absolute w-3 h-3 z-50 bottom-0 right-0 cursor-nw-resize",onPointerDown:w=>br(w,"bottom-right",u,h,x,r)}),d.jsx("div",{className:"absolute w-3 h-3 z-50 top-0 left-0 cursor-nw-resize",onPointerDown:w=>br(w,"top-left",u,h,x,r)}),d.jsx("div",{className:"absolute w-3 h-3 z-50 bottom-0 left-0 cursor-ne-resize",onPointerDown:w=>br(w,"bottom-left",u,h,x,r)}),d.jsx("div",{className:" absolute z-50  h-2  left-5 right-5 cursor-n-resize bottom-0",onPointerDown:w=>br(w,"bottom",u,h,x,r)}),d.jsx("div",{className:" absolute z-50 h-2 left-5 right-5 cursor-n-resize top-0",onPointerDown:w=>br(w,"top",u,h,x,r)}),d.jsx("div",{className:" absolute z-50 w-2 left-0 bottom-5 top-5 cursor-e-resize",onPointerDown:w=>br(w,"left",u,h,x,r)}),d.jsx("div",{className:" absolute z-50 w-2 right-0 bottom-5 top-5 cursor-e-resize",onPointerDown:w=>br(w,"right",u,h,x,r)})]})]})}return null}function A3(){var e,t,r,i;const n=ke();return(t=(e=n.selectedProject)==null?void 0:e.activeTools)!=null&&t.length?d.jsx(d.Fragment,{children:(i=(r=n.selectedProject)==null?void 0:r.activeTools)==null?void 0:i.map(s=>{const[o,a]=s.split(":");return d.jsx(hue,{name:o,id:a},a)})}):null}async function fue(){var n;try{const e=await MR(),t=await e.acquireTokenSilent({scopes:e2.scopes,forceRefresh:bF()}).catch(()=>e.loginPopup(e2));return(n=t==null?void 0:t.account)==null?void 0:n.username}catch(e){console.error(e),Kn.setState({header:"login",message:e==null?void 0:e.errorMessage})}return""}const Ol=Ir(n=>({isActivated:!1,activate:()=>n(()=>({isActivated:!0})),deactivate:()=>n(()=>({isActivated:!1})),url:""}));function pue(n){return`U${window.btoa(encodeURIComponent(n))}`}async function mue(n,e){var l;const t=await Ed(),r=await Td(),i=((l=ke.getState().selectedProject)==null?void 0:l.project_key)||"unknown",s=await fue()||"unknown",o=`${pue(s)}-${n}`,a=t.ENV__AZURE_STORAGE_SHARE_CONTAINER_NAME;try{const c=await fetch(`${t.ENV__AZURE_STORAGE_URL}/${a}/${i}/${o}.Web3DVP`,{method:"PUT",body:JSON.stringify(e),headers:{"cache-control":"no-cache",pragma:"no-cache","Content-Type":"application/json","x-ms-version":"2021-04-10","x-ms-blob-type":"BlockBlob","x-ms-date":new Date().toUTCString(),authorization:`Bearer ${r}`}});if(c.ok){const u=new URLSearchParams;u.set("load-set",o),u.set("project-key",i),Ol.setState({isActivated:!0,url:location.origin+location.pathname+"?"+u.toString()})}else throw c.statusText}catch{Kn.setState({activated:!0,header:"bookmark error",message:"unable to create bookmark"})}}function gue(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500 hover:text-indigo-400 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Generate Bookmark",strokeWidth:2,onClick:async()=>{var e,t;const n=structuredClone(Ot.getState().currentSet);n.projectKey=((e=ke.getState().selectedProject)==null?void 0:e.project_key)||"unknown",wi.groupNamesUsed.size&&(n.setFilter={name:"set generated",description:"generated by modelgroups loaded by set",groups:Array.from(wi.groupNamesUsed)}),((t=ke.getState().selectedLayer)==null?void 0:t.name)!=="set generated"&&(n.layerFilter=ke.getState().selectedLayer),mue(n.UUID,JSON.parse(JSON.stringify(n)))},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})}async function vue(){if(typeof showOpenFilePicker!="function"){Kn.setState({header:"Error",message:"Your browser does not support filesystem Access Api, use newest Chrome/Edge "});return}const n={types:[{description:"WEB 3d Viewpoint",accept:{"web3d/web3d":[".Web3DVP"]}}],excludeAcceptAllOption:!0,multiple:!1},e=await showOpenFilePicker(n);if((e==null?void 0:e.length)>0)return await(await e[0].getFile()).text()}function _ue(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500 hover:text-indigo-400 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Open set from file",strokeWidth:2,onClick:async()=>{var e,t,r,i;const n=await vue();if(n)try{const s=JSON.parse(n);s.UUID||(s.UUID=gr()),Array.isArray(s.filter)||(s.filter=[]),Array.isArray(s.siteFilter)&&(delete s.lvl3Filter,delete s.lvl3Filter,delete s.lvl3Filter,delete s.siteFilter,delete s.zoneFilter,delete s.itemFilter),(e=s.colorOverride)==null||e.forEach(a=>{a.uuid||(a.uuid=gr())}),(t=s.viewPoints)==null||t.forEach(a=>{a.uuid||(a.uuid=gr())}),(r=s.filter)==null||r.forEach(a=>{a.forEach(l=>{l.uuid||(l.uuid=gr())})});const o=((i=ke.getState().selectedProject)==null?void 0:i.project_key)||"unknown";s.projectKey=o,Ot.setState({currentSet:s})}catch(s){console.error(s),Kn.setState({header:"Error",message:"Unable to read file"})}},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})})}async function xue(n){if(typeof showSaveFilePicker!="function"){Kn.setState({header:"Error",message:"Your browser does not support filesystem Access Api, use newest Chrome/Edge "});return}const e=`Web_3D_viewpoint_${new Date().toLocaleDateString("no-NO").replace(".","-")}.Web3DVP`,t={types:[{description:"WEB 3d Viewpoint",accept:{"web3d/web3d":[".Web3DVP"]}}],suggestedName:e},i=await(await showSaveFilePicker(t)).createWritable();await i.write(n),await i.close()}function yue(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500 hover:text-indigo-400 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Save set as file",strokeWidth:2,onClick:async()=>{var n,e;try{const t=structuredClone(Ot.getState().currentSet);t.projectKey=((n=ke.getState().selectedProject)==null?void 0:n.project_key)||"unknown",(e=ke.getState().selectedProject)!=null&&e.project_code,wi.groupNamesUsed.size&&(t.setFilter={name:"set generated",description:"generated by modelgroups loaded by set",groups:Array.from(wi.groupNamesUsed)}),t.layerFilter=ke.getState().selectedLayer,await xue(JSON.stringify(t))}catch(t){console.error(t),Kn.setState({header:"Error",message:"Unable to save file"})}},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-7a2 2 0 012-2h2m3-4H9a2 2 0 00-2 2v7a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-1m-1 4l-3 3m0 0l-3-3m3 3V3"})})}function wue(){const n=Ot(),e="flex-1 text-center  hover:bg-gray-700 hover:text-gray-200 cursor-pointer ",t="bg-gray-800  text-gray-200 border-r hover:text-gray-200 border-gray-400 border-l border-t rounded-t mt-1 font-semibold w-28  mr-1 ml-1  text-xs border-gray-700 text-center",r="text-gray-900 bg-gray-400 mt-1 text-gray-800 rounded-t w-28 hover:text-gray-200  mr-1 ml-1  text-xs border-gray-700 text-center",i=e+(n.activeTab==="FILTER"?t:r),s=e+(n.activeTab==="VIEWPOINT"?t:r),o=e+(n.activeTab==="COLOR"?t:r);return d.jsxs("div",{className:"flex  mt-1 ",children:[d.jsx("div",{className:i,onClick:()=>Ot.setState({activeTab:"FILTER"}),children:"Filter"}),d.jsx("div",{className:s,onClick:()=>Ot.setState({activeTab:"VIEWPOINT"}),children:"ViewPoint"}),d.jsx("div",{className:o,onClick:()=>Ot.setState({activeTab:"COLOR"}),children:"Colors"})]})}const M3=["antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","White","whitesmoke","yellow","yellowgreen"];/**
 * react-virtual
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Cw(){return Cw=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Cw.apply(this,arguments)}/**
 * virtual-core
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bw(){return bw=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},bw.apply(this,arguments)}/**
 * virtual-core
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Mh(n,e,t){var r,i=(r=t.initialDeps)!=null?r:[],s;return function(){var o;t.key&&t.debug!=null&&t.debug()&&(o=Date.now());var a=n(),l=a.length!==i.length||a.some(function(_,y){return i[y]!==_});if(!l)return s;i=a;var c;if(t.key&&t.debug!=null&&t.debug()&&(c=Date.now()),s=e.apply(void 0,a),t.key&&t.debug!=null&&t.debug()){var u=Math.round((Date.now()-o)*100)/100,h=Math.round((Date.now()-c)*100)/100,f=h/16,p=function(y,g){for(y=String(y);y.length<g;)y=" "+y;return y};console.info("%c "+p(h,5)+" /"+p(u,5)+" ms",`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(`+Math.max(0,Math.min(120-120*f,120))+"deg 100% 31%);",t==null?void 0:t.key)}return t==null||t.onChange==null||t.onChange(s),s}}function vC(n,e){if(n===void 0)throw new Error("Unexpected undefined"+(e?": "+e:""));return n}var Sue=function(e,t){return Math.abs(e-t)<1};/**
 * virtual-core
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Eue=function(e){return e},Tue=function(e){for(var t=Math.max(e.startIndex-e.overscan,0),r=Math.min(e.endIndex+e.overscan,e.count-1),i=[],s=t;s<=r;s++)i.push(s);return i},Cue=function(e,t){var r=e.scrollElement;if(r){var i=function(a){var l=a.width,c=a.height;t({width:Math.round(l),height:Math.round(c)})};i(r.getBoundingClientRect());var s=new ResizeObserver(function(o){var a=o[0];if(a!=null&&a.borderBoxSize){var l=a.borderBoxSize[0];if(l){i({width:l.inlineSize,height:l.blockSize});return}}i(r.getBoundingClientRect())});return s.observe(r,{box:"border-box"}),function(){s.unobserve(r)}}},bue=function(e,t){var r=e.scrollElement;if(r){var i=function(){t(r[e.options.horizontal?"scrollLeft":"scrollTop"])};return i(),r.addEventListener("scroll",i,{passive:!0}),function(){r.removeEventListener("scroll",i)}}},Aue=function(e,t,r){if(t!=null&&t.borderBoxSize){var i=t.borderBoxSize[0];if(i){var s=Math.round(i[r.options.horizontal?"inlineSize":"blockSize"]);return s}}return Math.round(e.getBoundingClientRect()[r.options.horizontal?"width":"height"])},Mue=function(e,t,r){var i,s,o=t.adjustments,a=o===void 0?0:o,l=t.behavior,c=e+a;(i=r.scrollElement)==null||i.scrollTo==null||i.scrollTo((s={},s[r.options.horizontal?"left":"top"]=c,s.behavior=l,s))},Rue=function(e){var t=this;this.unsubs=[],this.scrollElement=null,this.isScrolling=!1,this.isScrollingTimeoutId=null,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollDirection=null,this.scrollAdjustments=0,this.measureElementCache=new Map,this.observer=function(){var r=null,i=function(){return r||(typeof ResizeObserver<"u"?r=new ResizeObserver(function(o){o.forEach(function(a){t._measureElement(a.target,a)})}):null)};return{disconnect:function(){var o;return(o=i())==null?void 0:o.disconnect()},observe:function(o){var a;return(a=i())==null?void 0:a.observe(o,{box:"border-box"})},unobserve:function(o){var a;return(a=i())==null?void 0:a.unobserve(o)}}}(),this.range=null,this.setOptions=function(r){Object.entries(r).forEach(function(i){var s=i[0],o=i[1];typeof o>"u"&&delete r[s]}),t.options=bw({debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Eue,rangeExtractor:Tue,onChange:function(){},measureElement:Aue,initialRect:{width:0,height:0},scrollMargin:0,scrollingDelay:150,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1},r)},this.notify=function(r){t.options.onChange==null||t.options.onChange(t,r)},this.maybeNotify=Mh(function(){return t.calculateRange(),[t.isScrolling,t.range?t.range.startIndex:null,t.range?t.range.endIndex:null]},function(r){t.notify(r)},{key:!1,debug:function(){return t.options.debug},initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=function(){t.unsubs.filter(Boolean).forEach(function(r){return r()}),t.unsubs=[],t.scrollElement=null},this._didMount=function(){return t.measureElementCache.forEach(t.observer.observe),function(){t.observer.disconnect(),t.cleanup()}},this._willUpdate=function(){var r=t.options.getScrollElement();t.scrollElement!==r&&(t.cleanup(),t.scrollElement=r,t._scrollToOffset(t.scrollOffset,{adjustments:void 0,behavior:void 0}),t.unsubs.push(t.options.observeElementRect(t,function(i){t.scrollRect=i,t.maybeNotify()})),t.unsubs.push(t.options.observeElementOffset(t,function(i){t.scrollAdjustments=0,t.scrollOffset!==i&&(t.isScrollingTimeoutId!==null&&(clearTimeout(t.isScrollingTimeoutId),t.isScrollingTimeoutId=null),t.isScrolling=!0,t.scrollDirection=t.scrollOffset<i?"forward":"backward",t.scrollOffset=i,t.maybeNotify(),t.isScrollingTimeoutId=setTimeout(function(){t.isScrollingTimeoutId=null,t.isScrolling=!1,t.scrollDirection=null,t.maybeNotify()},t.options.scrollingDelay))})))},this.getSize=function(){return t.scrollRect[t.options.horizontal?"width":"height"]},this.memoOptions=Mh(function(){return[t.options.count,t.options.paddingStart,t.options.scrollMargin,t.options.getItemKey]},function(r,i,s,o){return t.pendingMeasuredCacheIndexes=[],{count:r,paddingStart:i,scrollMargin:s,getItemKey:o}},{key:!1}),this.getFurthestMeasurement=function(r,i){for(var s=new Map,o=new Map,a=i-1;a>=0;a--){var l=r[a];if(!s.has(l.lane)){var c=o.get(l.lane);if(c==null||l.end>c.end?o.set(l.lane,l):l.end<c.end&&s.set(l.lane,!0),s.size===t.options.lanes)break}}return o.size===t.options.lanes?Array.from(o.values()).sort(function(u,h){return u.end-h.end})[0]:void 0},this.getMeasurements=Mh(function(){return[t.memoOptions(),t.itemSizeCache]},function(r,i){var s=r.count,o=r.paddingStart,a=r.scrollMargin,l=r.getItemKey,c=t.pendingMeasuredCacheIndexes.length>0?Math.min.apply(Math,t.pendingMeasuredCacheIndexes):0;t.pendingMeasuredCacheIndexes=[];for(var u=t.measurementsCache.slice(0,c),h=c;h<s;h++){var f=l(h),p=t.options.lanes===1?u[h-1]:t.getFurthestMeasurement(u,h),_=p?p.end:o+a,y=i.get(f),g=typeof y=="number"?y:t.options.estimateSize(h),m=_+g,v=p?p.lane:h%t.options.lanes;u[h]={index:h,start:_,size:g,end:m,key:f,lane:v}}return t.measurementsCache=u,u},{key:!1,debug:function(){return t.options.debug}}),this.calculateRange=Mh(function(){return[t.getMeasurements(),t.getSize(),t.scrollOffset]},function(r,i,s){return t.range=r.length>0&&i>0?Nue({measurements:r,outerSize:i,scrollOffset:s}):null},{key:!1,debug:function(){return t.options.debug}}),this.getIndexes=Mh(function(){return[t.options.rangeExtractor,t.calculateRange(),t.options.overscan,t.options.count]},function(r,i,s,o){return i===null?[]:r(bw({},i,{overscan:s,count:o}))},{key:!1,debug:function(){return t.options.debug}}),this.indexFromElement=function(r){var i=t.options.indexAttribute,s=r.getAttribute(i);return s?parseInt(s,10):(console.warn("Missing attribute name '"+i+"={index}' on measured element."),-1)},this._measureElement=function(r,i){var s=t.measurementsCache[t.indexFromElement(r)];if(!s||!r.isConnected){t.measureElementCache.forEach(function(l,c){l===r&&(t.observer.unobserve(r),t.measureElementCache.delete(c))});return}var o=t.measureElementCache.get(s.key);o!==r&&(o&&t.observer.unobserve(o),t.observer.observe(r),t.measureElementCache.set(s.key,r));var a=t.options.measureElement(r,i,t);t.resizeItem(s,a)},this.resizeItem=function(r,i){var s,o=(s=t.itemSizeCache.get(r.key))!=null?s:r.size,a=i-o;a!==0&&(r.start<t.scrollOffset&&t._scrollToOffset(t.scrollOffset,{adjustments:t.scrollAdjustments+=a,behavior:void 0}),t.pendingMeasuredCacheIndexes.push(r.index),t.itemSizeCache=new Map(t.itemSizeCache.set(r.key,i)),t.notify(!1))},this.measureElement=function(r){r&&t._measureElement(r,void 0)},this.getVirtualItems=Mh(function(){return[t.getIndexes(),t.getMeasurements()]},function(r,i){for(var s=[],o=0,a=r.length;o<a;o++){var l=r[o],c=i[l];s.push(c)}return s},{key:!1,debug:function(){return t.options.debug}}),this.getVirtualItemForOffset=function(r){var i=t.getMeasurements();return vC(i[j6(0,i.length-1,function(s){return vC(i[s]).start},r)])},this.getOffsetForAlignment=function(r,i){var s=t.getSize();i==="auto"&&(r<=t.scrollOffset?i="start":r>=t.scrollOffset+s?i="end":i="start"),i==="start"?r=r:i==="end"?r=r-s:i==="center"&&(r=r-s/2);var o=t.options.horizontal?"scrollWidth":"scrollHeight",a=t.scrollElement?"document"in t.scrollElement?t.scrollElement.document.documentElement[o]:t.scrollElement[o]:0,l=a-t.getSize();return Math.max(Math.min(l,r),0)},this.getOffsetForIndex=function(r,i){i===void 0&&(i="auto"),r=Math.max(0,Math.min(r,t.options.count-1));var s=vC(t.getMeasurements()[r]);if(i==="auto")if(s.end>=t.scrollOffset+t.getSize()-t.options.scrollPaddingEnd)i="end";else if(s.start<=t.scrollOffset+t.options.scrollPaddingStart)i="start";else return[t.scrollOffset,i];var o=i==="end"?s.end+t.options.scrollPaddingEnd:s.start-t.options.scrollPaddingStart;return[t.getOffsetForAlignment(o,i),i]},this.isDynamicMode=function(){return t.measureElementCache.size>0},this.cancelScrollToIndex=function(){t.scrollToIndexTimeoutId!==null&&(clearTimeout(t.scrollToIndexTimeoutId),t.scrollToIndexTimeoutId=null)},this.scrollToOffset=function(r,i){var s=i===void 0?{}:i,o=s.align,a=o===void 0?"start":o,l=s.behavior;t.cancelScrollToIndex(),l==="smooth"&&t.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t._scrollToOffset(t.getOffsetForAlignment(r,a),{adjustments:void 0,behavior:l})},this.scrollToIndex=function(r,i){var s=i===void 0?{}:i,o=s.align,a=o===void 0?"auto":o,l=s.behavior;r=Math.max(0,Math.min(r,t.options.count-1)),t.cancelScrollToIndex(),l==="smooth"&&t.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");var c=t.getOffsetForIndex(r,a),u=c[0],h=c[1];t._scrollToOffset(u,{adjustments:void 0,behavior:l}),l!=="smooth"&&t.isDynamicMode()&&(t.scrollToIndexTimeoutId=setTimeout(function(){t.scrollToIndexTimeoutId=null;var f=t.measureElementCache.has(t.options.getItemKey(r));if(f){var p=t.getOffsetForIndex(r,h),_=p[0];Sue(_,t.scrollOffset)||t.scrollToIndex(r,{align:h,behavior:l})}else t.scrollToIndex(r,{align:h,behavior:l})}))},this.scrollBy=function(r,i){var s=i===void 0?{}:i,o=s.behavior;t.cancelScrollToIndex(),o==="smooth"&&t.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),t._scrollToOffset(t.scrollOffset+r,{adjustments:void 0,behavior:o})},this.getTotalSize=function(){var r;return(((r=t.getMeasurements()[t.options.count-1])==null?void 0:r.end)||t.options.paddingStart)-t.options.scrollMargin+t.options.paddingEnd},this._scrollToOffset=function(r,i){var s=i.adjustments,o=i.behavior;t.options.scrollToFn(r,{behavior:o,adjustments:s},t)},this.measure=function(){t.itemSizeCache=new Map,t.notify(!1)},this.setOptions(e),this.scrollRect=this.options.initialRect,this.scrollOffset=this.options.initialOffset,this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(function(r){t.itemSizeCache.set(r.key,r.size)}),this.maybeNotify()},j6=function(e,t,r,i){for(;e<=t;){var s=(e+t)/2|0,o=r(s);if(o<i)e=s+1;else if(o>i)t=s-1;else return s}return e>0?e-1:0};function Nue(n){for(var e=n.measurements,t=n.outerSize,r=n.scrollOffset,i=e.length-1,s=function(c){return e[c].start},o=j6(0,i,s,r),a=o;a<i&&e[a].end<r+t;)a++;return{startIndex:o,endIndex:a}}/**
 * react-virtual
 *
 * Copyright (c) TanStack
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Iue=typeof document<"u"?ee.useLayoutEffect:ee.useEffect;function Pue(n){var e=ee.useReducer(function(){return{}},{})[1],t=Cw({},n,{onChange:function(o,a){a?li.flushSync(e):e(),n.onChange==null||n.onChange(o,a)}}),r=ee.useState(function(){return new Rue(t)}),i=r[0];return i.setOptions(t),ee.useEffect(function(){return i._didMount()},[]),Iue(function(){return i._willUpdate()}),i}function kue(n){return Pue(Cw({observeElementRect:Cue,observeElementOffset:bue,scrollToFn:Mue},n))}var Lue=Object.defineProperty,Oue=(n,e,t)=>e in n?Lue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,_C=(n,e,t)=>(Oue(n,typeof e!="symbol"?e+"":e,t),t);let Due=class{constructor(){_C(this,"current",this.detect()),_C(this,"handoffState","pending"),_C(this,"currentId",0)}set(e){this.current!==e&&(this.handoffState="pending",this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}handoff(){this.handoffState==="pending"&&(this.handoffState="complete")}get isHandoffComplete(){return this.handoffState==="complete"}},Ju=new Due,xr=(n,e)=>{Ju.isServer?ee.useEffect(n,e):ee.useLayoutEffect(n,e)};function na(n){let e=ee.useRef(n);return xr(()=>{e.current=n},[n]),e}function BN(n,e){let[t,r]=ee.useState(n),i=na(n);return xr(()=>r(i.current),[i,r,...e]),t}let It=function(n){let e=na(n);return Mn.useCallback((...t)=>e.current(...t),[e])};function Uue(n,e,t){let[r,i]=ee.useState(t),s=n!==void 0,o=ee.useRef(s),a=ee.useRef(!1),l=ee.useRef(!1);return s&&!o.current&&!a.current?(a.current=!0,o.current=s,console.error("A component is changing from uncontrolled to controlled. This may be caused by the value changing from undefined to a defined value, which should not happen.")):!s&&o.current&&!l.current&&(l.current=!0,o.current=s,console.error("A component is changing from controlled to uncontrolled. This may be caused by the value changing from a defined value to undefined, which should not happen.")),[s?n:r,It(c=>(s||i(c),e==null?void 0:e(c)))]}function Fue(n){typeof queueMicrotask=="function"?queueMicrotask(n):Promise.resolve().then(n).catch(e=>setTimeout(()=>{throw e}))}function _d(){let n=[],e={addEventListener(t,r,i,s){return t.addEventListener(r,i,s),e.add(()=>t.removeEventListener(r,i,s))},requestAnimationFrame(...t){let r=requestAnimationFrame(...t);return e.add(()=>cancelAnimationFrame(r))},nextFrame(...t){return e.requestAnimationFrame(()=>e.requestAnimationFrame(...t))},setTimeout(...t){let r=setTimeout(...t);return e.add(()=>clearTimeout(r))},microTask(...t){let r={current:!0};return Fue(()=>{r.current&&t[0]()}),e.add(()=>{r.current=!1})},style(t,r,i){let s=t.style.getPropertyValue(r);return Object.assign(t.style,{[r]:i}),this.add(()=>{Object.assign(t.style,{[r]:s})})},group(t){let r=_d();return t(r),this.add(()=>r.dispose())},add(t){return n.push(t),()=>{let r=n.indexOf(t);if(r>=0)for(let i of n.splice(r,1))i()}},dispose(){for(let t of n.splice(0))t()}};return e}function Wv(){let[n]=ee.useState(_d);return ee.useEffect(()=>()=>n.dispose(),[n]),n}function jue(){let n=typeof document>"u";return"useSyncExternalStore"in sI?(e=>e.useSyncExternalStore)(sI)(()=>()=>{},()=>!1,()=>!n):!1}function HN(){let n=jue(),[e,t]=ee.useState(Ju.isHandoffComplete);return e&&Ju.isHandoffComplete===!1&&t(!1),ee.useEffect(()=>{e!==!0&&t(!0)},[e]),ee.useEffect(()=>Ju.handoff(),[]),n?!1:e}var R3;let Yv=(R3=Mn.useId)!=null?R3:function(){let n=HN(),[e,t]=Mn.useState(n?()=>Ju.nextId():null);return xr(()=>{e===null&&t(Ju.nextId())},[e]),e!=null?""+e:void 0};function Fr(n,e,...t){if(n in e){let i=e[n];return typeof i=="function"?i(...t):i}let r=new Error(`Tried to handle "${n}" but there is no handler defined. Only defined handlers are: ${Object.keys(e).map(i=>`"${i}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,Fr),r}function VN(n){return Ju.isServer?null:n instanceof Node?n.ownerDocument:n!=null&&n.hasOwnProperty("current")&&n.current instanceof Node?n.current.ownerDocument:document}let N3=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(n=>`${n}:not([tabindex='-1'])`).join(",");var zue=(n=>(n[n.First=1]="First",n[n.Previous=2]="Previous",n[n.Next=4]="Next",n[n.Last=8]="Last",n[n.WrapAround=16]="WrapAround",n[n.NoScroll=32]="NoScroll",n))(zue||{}),Bue=(n=>(n[n.Error=0]="Error",n[n.Overflow=1]="Overflow",n[n.Success=2]="Success",n[n.Underflow=3]="Underflow",n))(Bue||{}),Hue=(n=>(n[n.Previous=-1]="Previous",n[n.Next=1]="Next",n))(Hue||{}),z6=(n=>(n[n.Strict=0]="Strict",n[n.Loose=1]="Loose",n))(z6||{});function Vue(n,e=0){var t;return n===((t=VN(n))==null?void 0:t.body)?!1:Fr(e,{0(){return n.matches(N3)},1(){let r=n;for(;r!==null;){if(r.matches(N3))return!0;r=r.parentElement}return!1}})}var Gue=(n=>(n[n.Keyboard=0]="Keyboard",n[n.Mouse=1]="Mouse",n))(Gue||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",n=>{n.metaKey||n.altKey||n.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",n=>{n.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:n.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));function Wue(n,e=t=>t){return n.slice().sort((t,r)=>{let i=e(t),s=e(r);if(i===null||s===null)return 0;let o=i.compareDocumentPosition(s);return o&Node.DOCUMENT_POSITION_FOLLOWING?-1:o&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function Yue(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function Kue(){return/Android/gi.test(window.navigator.userAgent)}function B6(){return Yue()||Kue()}function F_(n,e,t){let r=na(e);ee.useEffect(()=>{function i(s){r.current(s)}return document.addEventListener(n,i,t),()=>document.removeEventListener(n,i,t)},[n,t])}function $ue(n,e,t){let r=na(e);ee.useEffect(()=>{function i(s){r.current(s)}return window.addEventListener(n,i,t),()=>window.removeEventListener(n,i,t)},[n,t])}function Xue(n,e,t=!0){let r=ee.useRef(!1);ee.useEffect(()=>{requestAnimationFrame(()=>{r.current=t})},[t]);function i(o,a){if(!r.current||o.defaultPrevented)return;let l=a(o);if(l===null||!l.getRootNode().contains(l)||!l.isConnected)return;let c=function u(h){return typeof h=="function"?u(h()):Array.isArray(h)||h instanceof Set?h:[h]}(n);for(let u of c){if(u===null)continue;let h=u instanceof HTMLElement?u:u.current;if(h!=null&&h.contains(l)||o.composed&&o.composedPath().includes(h))return}return!Vue(l,z6.Loose)&&l.tabIndex!==-1&&o.preventDefault(),e(o,l)}let s=ee.useRef(null);F_("pointerdown",o=>{var a,l;r.current&&(s.current=((l=(a=o.composedPath)==null?void 0:a.call(o))==null?void 0:l[0])||o.target)},!0),F_("mousedown",o=>{var a,l;r.current&&(s.current=((l=(a=o.composedPath)==null?void 0:a.call(o))==null?void 0:l[0])||o.target)},!0),F_("click",o=>{B6()||s.current&&(i(o,()=>s.current),s.current=null)},!0),F_("touchend",o=>i(o,()=>o.target instanceof HTMLElement?o.target:null),!0),$ue("blur",o=>i(o,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}function que(...n){return ee.useMemo(()=>VN(...n),[...n])}function I3(n){var e;if(n.type)return n.type;let t=(e=n.as)!=null?e:"button";if(typeof t=="string"&&t.toLowerCase()==="button")return"button"}function Zue(n,e){let[t,r]=ee.useState(()=>I3(n));return xr(()=>{r(I3(n))},[n.type,n.as]),xr(()=>{t||e.current&&e.current instanceof HTMLButtonElement&&!e.current.hasAttribute("type")&&r("button")},[t,e]),t}let Que=Symbol();function Dd(...n){let e=ee.useRef(n);ee.useEffect(()=>{e.current=n},[n]);let t=It(r=>{for(let i of e.current)i!=null&&(typeof i=="function"?i(r):i.current=r)});return n.every(r=>r==null||(r==null?void 0:r[Que]))?void 0:t}function P3(n){return[n.screenX,n.screenY]}function Jue(){let n=ee.useRef([-1,-1]);return{wasMoved(e){let t=P3(e);return n.current[0]===t[0]&&n.current[1]===t[1]?!1:(n.current=t,!0)},update(e){n.current=P3(e)}}}function ede({container:n,accept:e,walk:t,enabled:r=!0}){let i=ee.useRef(e),s=ee.useRef(t);ee.useEffect(()=>{i.current=e,s.current=t},[e,t]),xr(()=>{if(!n||!r)return;let o=VN(n);if(!o)return;let a=i.current,l=s.current,c=Object.assign(h=>a(h),{acceptNode:a}),u=o.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,c,!1);for(;u.nextNode();)l(u.currentNode)},[n,r,i,s])}function k3(n,e){let t=ee.useRef([]),r=It(n);ee.useEffect(()=>{let i=[...t.current];for(let[s,o]of e.entries())if(t.current[s]!==o){let a=r(e,i);return t.current=e,a}},[r,...e])}function Aw(...n){return Array.from(new Set(n.flatMap(e=>typeof e=="string"?e.split(" "):[]))).filter(Boolean).join(" ")}var Mw=(n=>(n[n.None=0]="None",n[n.RenderStrategy=1]="RenderStrategy",n[n.Static=2]="Static",n))(Mw||{}),ic=(n=>(n[n.Unmount=0]="Unmount",n[n.Hidden=1]="Hidden",n))(ic||{});function dl({ourProps:n,theirProps:e,slot:t,defaultTag:r,features:i,visible:s=!0,name:o,mergeRefs:a}){a=a??tde;let l=H6(e,n);if(s)return j_(l,t,r,o,a);let c=i??0;if(c&2){let{static:u=!1,...h}=l;if(u)return j_(h,t,r,o,a)}if(c&1){let{unmount:u=!0,...h}=l;return Fr(u?0:1,{0(){return null},1(){return j_({...h,hidden:!0,style:{display:"none"}},t,r,o,a)}})}return j_(l,t,r,o,a)}function j_(n,e={},t,r,i){let{as:s=t,children:o,refName:a="ref",...l}=xC(n,["unmount","static"]),c=n.ref!==void 0?{[a]:n.ref}:{},u=typeof o=="function"?o(e):o;"className"in l&&l.className&&typeof l.className=="function"&&(l.className=l.className(e));let h={};if(e){let f=!1,p=[];for(let[_,y]of Object.entries(e))typeof y=="boolean"&&(f=!0),y===!0&&p.push(_);f&&(h["data-headlessui-state"]=p.join(" "))}if(s===ee.Fragment&&Object.keys(AA(l)).length>0){if(!ee.isValidElement(u)||Array.isArray(u)&&u.length>1)throw new Error(['Passing props on "Fragment"!',"",`The current component <${r} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(l).map(y=>`  - ${y}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(y=>`  - ${y}`).join(`
`)].join(`
`));let f=u.props,p=typeof(f==null?void 0:f.className)=="function"?(...y)=>Aw(f==null?void 0:f.className(...y),l.className):Aw(f==null?void 0:f.className,l.className),_=p?{className:p}:{};return ee.cloneElement(u,Object.assign({},H6(u.props,AA(xC(l,["ref"]))),h,c,{ref:i(u.ref,c.ref)},_))}return ee.createElement(s,Object.assign({},xC(l,["ref"]),s!==ee.Fragment&&c,s!==ee.Fragment&&h),u)}function tde(...n){return n.every(e=>e==null)?void 0:e=>{for(let t of n)t!=null&&(typeof t=="function"?t(e):t.current=e)}}function H6(...n){if(n.length===0)return{};if(n.length===1)return n[0];let e={},t={};for(let r of n)for(let i in r)i.startsWith("on")&&typeof r[i]=="function"?(t[i]!=null||(t[i]=[]),t[i].push(r[i])):e[i]=r[i];if(e.disabled||e["aria-disabled"])return Object.assign(e,Object.fromEntries(Object.keys(t).map(r=>[r,void 0])));for(let r in t)Object.assign(e,{[r](i,...s){let o=t[r];for(let a of o){if((i instanceof Event||(i==null?void 0:i.nativeEvent)instanceof Event)&&i.defaultPrevented)return;a(i,...s)}}});return e}function ua(n){var e;return Object.assign(ee.forwardRef(n),{displayName:(e=n.displayName)!=null?e:n.name})}function AA(n){let e=Object.assign({},n);for(let t in e)e[t]===void 0&&delete e[t];return e}function xC(n,e=[]){let t=Object.assign({},n);for(let r of e)r in t&&delete t[r];return t}let nde="div";var V6=(n=>(n[n.None=1]="None",n[n.Focusable=2]="Focusable",n[n.Hidden=4]="Hidden",n))(V6||{});function rde(n,e){var t;let{features:r=1,...i}=n,s={ref:e,"aria-hidden":(r&2)===2?!0:(t=i["aria-hidden"])!=null?t:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(r&4)===4&&(r&2)!==2&&{display:"none"}}};return dl({ourProps:s,theirProps:i,slot:{},defaultTag:nde,name:"Hidden"})}let ide=ua(rde),GN=ee.createContext(null);GN.displayName="OpenClosedContext";var os=(n=>(n[n.Open=1]="Open",n[n.Closed=2]="Closed",n[n.Closing=4]="Closing",n[n.Opening=8]="Opening",n))(os||{});function WN(){return ee.useContext(GN)}function G6({value:n,children:e}){return Mn.createElement(GN.Provider,{value:n},e)}function sde(n){function e(){document.readyState!=="loading"&&(n(),document.removeEventListener("DOMContentLoaded",e))}typeof window<"u"&&typeof document<"u"&&(document.addEventListener("DOMContentLoaded",e),e())}let bu=[];sde(()=>{function n(e){e.target instanceof HTMLElement&&e.target!==document.body&&bu[0]!==e.target&&(bu.unshift(e.target),bu=bu.filter(t=>t!=null&&t.isConnected),bu.splice(10))}window.addEventListener("click",n,{capture:!0}),window.addEventListener("mousedown",n,{capture:!0}),window.addEventListener("focus",n,{capture:!0}),document.body.addEventListener("click",n,{capture:!0}),document.body.addEventListener("mousedown",n,{capture:!0}),document.body.addEventListener("focus",n,{capture:!0})});function ode(n){let e=n.parentElement,t=null;for(;e&&!(e instanceof HTMLFieldSetElement);)e instanceof HTMLLegendElement&&(t=e),e=e.parentElement;let r=(e==null?void 0:e.getAttribute("disabled"))==="";return r&&ade(t)?!1:r}function ade(n){if(!n)return!1;let e=n.previousElementSibling;for(;e!==null;){if(e instanceof HTMLLegendElement)return!1;e=e.previousElementSibling}return!0}function lde(n){throw new Error("Unexpected object: "+n)}var fr=(n=>(n[n.First=0]="First",n[n.Previous=1]="Previous",n[n.Next=2]="Next",n[n.Last=3]="Last",n[n.Specific=4]="Specific",n[n.Nothing=5]="Nothing",n))(fr||{});function L3(n,e){let t=e.resolveItems();if(t.length<=0)return null;let r=e.resolveActiveIndex(),i=r??-1;switch(n.focus){case 0:{for(let s=0;s<t.length;++s)if(!e.resolveDisabled(t[s],s,t))return s;return r}case 1:{for(let s=i-1;s>=0;--s)if(!e.resolveDisabled(t[s],s,t))return s;return r}case 2:{for(let s=i+1;s<t.length;++s)if(!e.resolveDisabled(t[s],s,t))return s;return r}case 3:{for(let s=t.length-1;s>=0;--s)if(!e.resolveDisabled(t[s],s,t))return s;return r}case 4:{for(let s=0;s<t.length;++s)if(e.resolveId(t[s],s,t)===n.id)return s;return r}case 5:return null;default:lde(n)}}function W6(n={},e=null,t=[]){for(let[r,i]of Object.entries(n))K6(t,Y6(e,r),i);return t}function Y6(n,e){return n?n+"["+e+"]":e}function K6(n,e,t){if(Array.isArray(t))for(let[r,i]of t.entries())K6(n,Y6(e,r.toString()),i);else t instanceof Date?n.push([e,t.toISOString()]):typeof t=="boolean"?n.push([e,t?"1":"0"]):typeof t=="string"?n.push([e,t]):typeof t=="number"?n.push([e,`${t}`]):t==null?n.push([e,""]):W6(t,e,n)}var is=(n=>(n.Space=" ",n.Enter="Enter",n.Escape="Escape",n.Backspace="Backspace",n.Delete="Delete",n.ArrowLeft="ArrowLeft",n.ArrowUp="ArrowUp",n.ArrowRight="ArrowRight",n.ArrowDown="ArrowDown",n.Home="Home",n.End="End",n.PageUp="PageUp",n.PageDown="PageDown",n.Tab="Tab",n))(is||{}),cde={},ude=(n=>(n[n.Open=0]="Open",n[n.Closed=1]="Closed",n))(ude||{}),dde=(n=>(n[n.Single=0]="Single",n[n.Multi=1]="Multi",n))(dde||{}),hde=(n=>(n[n.Pointer=0]="Pointer",n[n.Focus=1]="Focus",n[n.Other=2]="Other",n))(hde||{}),fde=(n=>(n[n.OpenCombobox=0]="OpenCombobox",n[n.CloseCombobox=1]="CloseCombobox",n[n.GoToOption=2]="GoToOption",n[n.RegisterOption=3]="RegisterOption",n[n.UnregisterOption=4]="UnregisterOption",n[n.RegisterLabel=5]="RegisterLabel",n[n.SetActivationTrigger=6]="SetActivationTrigger",n[n.UpdateVirtualOptions=7]="UpdateVirtualOptions",n))(fde||{});function yC(n,e=t=>t){let t=n.activeOptionIndex!==null?n.options[n.activeOptionIndex]:null,r=e(n.options.slice()),i=r.length>0&&r[0].dataRef.current.order!==null?r.sort((o,a)=>o.dataRef.current.order-a.dataRef.current.order):Wue(r,o=>o.dataRef.current.domRef.current),s=t?i.indexOf(t):null;return s===-1&&(s=null),{options:i,activeOptionIndex:s}}let pde={1(n){var e;return(e=n.dataRef.current)!=null&&e.disabled||n.comboboxState===1?n:{...n,activeOptionIndex:null,comboboxState:1}},0(n){var e,t;if((e=n.dataRef.current)!=null&&e.disabled||n.comboboxState===0)return n;if((t=n.dataRef.current)!=null&&t.value){let r=n.dataRef.current.calculateIndex(n.dataRef.current.value);if(r!==-1)return{...n,activeOptionIndex:r,comboboxState:0}}return{...n,comboboxState:0}},2(n,e){var t,r,i,s,o;if((t=n.dataRef.current)!=null&&t.disabled||(r=n.dataRef.current)!=null&&r.optionsRef.current&&!((i=n.dataRef.current)!=null&&i.optionsPropsRef.current.static)&&n.comboboxState===1)return n;if(n.virtual){let u=e.focus===fr.Specific?e.idx:L3(e,{resolveItems:()=>n.virtual.options,resolveActiveIndex:()=>{var f,p;return(p=(f=n.activeOptionIndex)!=null?f:n.virtual.options.findIndex(_=>!n.virtual.disabled(_)))!=null?p:null},resolveDisabled:n.virtual.disabled,resolveId(){throw new Error("Function not implemented.")}}),h=(s=e.trigger)!=null?s:2;return n.activeOptionIndex===u&&n.activationTrigger===h?n:{...n,activeOptionIndex:u,activationTrigger:h}}let a=yC(n);if(a.activeOptionIndex===null){let u=a.options.findIndex(h=>!h.dataRef.current.disabled);u!==-1&&(a.activeOptionIndex=u)}let l=e.focus===fr.Specific?e.idx:L3(e,{resolveItems:()=>a.options,resolveActiveIndex:()=>a.activeOptionIndex,resolveId:u=>u.id,resolveDisabled:u=>u.dataRef.current.disabled}),c=(o=e.trigger)!=null?o:2;return n.activeOptionIndex===l&&n.activationTrigger===c?n:{...n,...a,activeOptionIndex:l,activationTrigger:c}},3:(n,e)=>{var t,r,i;if((t=n.dataRef.current)!=null&&t.virtual)return{...n,options:[...n.options,e.payload]};let s=e.payload,o=yC(n,l=>(l.push(s),l));n.activeOptionIndex===null&&(r=n.dataRef.current)!=null&&r.isSelected(e.payload.dataRef.current.value)&&(o.activeOptionIndex=o.options.indexOf(s));let a={...n,...o,activationTrigger:2};return(i=n.dataRef.current)!=null&&i.__demoMode&&n.dataRef.current.value===void 0&&(a.activeOptionIndex=0),a},4:(n,e)=>{var t;if((t=n.dataRef.current)!=null&&t.virtual)return{...n,options:n.options.filter(i=>i.id!==e.id)};let r=yC(n,i=>{let s=i.findIndex(o=>o.id===e.id);return s!==-1&&i.splice(s,1),i});return{...n,...r,activationTrigger:2}},5:(n,e)=>n.labelId===e.id?n:{...n,labelId:e.id},6:(n,e)=>n.activationTrigger===e.trigger?n:{...n,activationTrigger:e.trigger},7:(n,e)=>{var t;if(((t=n.virtual)==null?void 0:t.options)===e.options)return n;let r=n.activeOptionIndex;if(n.activeOptionIndex!==null){let i=e.options.indexOf(n.virtual.options[n.activeOptionIndex]);i!==-1?r=i:r=null}return{...n,activeOptionIndex:r,virtual:Object.assign({},n.virtual,{options:e.options})}}},YN=ee.createContext(null);YN.displayName="ComboboxActionsContext";function Kv(n){let e=ee.useContext(YN);if(e===null){let t=new Error(`<${n} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,Kv),t}return e}let $6=ee.createContext(null);function mde(n){var e;let t=Ud("VirtualProvider"),[r,i]=ee.useMemo(()=>{let l=t.optionsRef.current;if(!l)return[0,0];let c=window.getComputedStyle(l);return[parseFloat(c.paddingBlockStart||c.paddingTop),parseFloat(c.paddingBlockEnd||c.paddingBottom)]},[t.optionsRef.current]),s=kue({scrollPaddingStart:r,scrollPaddingEnd:i,count:t.virtual.options.length,estimateSize(){return 40},getScrollElement(){var l;return(l=t.optionsRef.current)!=null?l:null},overscan:12}),[o,a]=ee.useState(0);return xr(()=>{a(l=>l+1)},[(e=t.virtual)==null?void 0:e.options]),Mn.createElement($6.Provider,{value:s},Mn.createElement("div",{style:{position:"relative",width:"100%",height:`${s.getTotalSize()}px`},ref:l=>{if(l){if(typeof process<"u"&&cde.JEST_WORKER_ID!==void 0||t.activationTrigger===0)return;t.activeOptionIndex!==null&&t.virtual.options.length>t.activeOptionIndex&&s.scrollToIndex(t.activeOptionIndex)}}},s.getVirtualItems().map(l=>{var c;return Mn.createElement(ee.Fragment,{key:l.key},Mn.cloneElement((c=n.children)==null?void 0:c.call(n,{option:t.virtual.options[l.index],open:t.comboboxState===0}),{key:`${o}-${l.key}`,"data-index":l.index,"aria-setsize":t.virtual.options.length,"aria-posinset":l.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${l.start}px)`,overflowAnchor:"none"}}))})))}let KN=ee.createContext(null);KN.displayName="ComboboxDataContext";function Ud(n){let e=ee.useContext(KN);if(e===null){let t=new Error(`<${n} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,Ud),t}return e}function gde(n,e){return Fr(e.type,pde,n,e)}let vde=ee.Fragment;function _de(n,e){let{value:t,defaultValue:r,onChange:i,form:s,name:o,by:a=null,disabled:l=!1,__demoMode:c=!1,nullable:u=!1,multiple:h=!1,immediate:f=!1,virtual:p=null,..._}=n,y=!1,g=null,[m=h?[]:void 0,v]=Uue(t,i,r),[x,w]=ee.useReducer(gde,{dataRef:ee.createRef(),comboboxState:c?0:1,options:[],virtual:null,activeOptionIndex:null,activationTrigger:2,labelId:null}),E=ee.useRef(!1),S=ee.useRef({static:!1,hold:!1}),C=ee.useRef(null),A=ee.useRef(null),k=ee.useRef(null),T=ee.useRef(null),R=It(typeof a=="string"?(G,he)=>{let ve=a;return(G==null?void 0:G[ve])===(he==null?void 0:he[ve])}:a??((G,he)=>G===he)),$=It(G=>x.options.findIndex(he=>R(he.dataRef.current.value,G))),P=ee.useCallback(G=>Fr(I.mode,{1:()=>m.some(he=>R(he,G)),0:()=>R(m,G)}),[m]),M=It(G=>x.activeOptionIndex===$(G)),I=ee.useMemo(()=>({...x,immediate:y,optionsPropsRef:S,labelRef:C,inputRef:A,buttonRef:k,optionsRef:T,value:m,defaultValue:r,disabled:l,mode:h?1:0,virtual:x.virtual,get activeOptionIndex(){if(E.current&&x.activeOptionIndex===null&&x.options.length>0){let G=x.options.findIndex(he=>!he.dataRef.current.disabled);if(G!==-1)return G}return x.activeOptionIndex},calculateIndex:$,compare:R,isSelected:P,isActive:M,nullable:u,__demoMode:c}),[m,r,l,h,u,c,x,g]);xr(()=>{},[g,void 0]),xr(()=>{x.dataRef.current=I},[I]),Xue([I.buttonRef,I.inputRef,I.optionsRef],()=>oe.closeCombobox(),I.comboboxState===0);let j=ee.useMemo(()=>{var G,he,ve;return{open:I.comboboxState===0,disabled:l,activeIndex:I.activeOptionIndex,activeOption:I.activeOptionIndex===null?null:I.virtual?I.virtual.options[(G=I.activeOptionIndex)!=null?G:0]:(ve=(he=I.options[I.activeOptionIndex])==null?void 0:he.dataRef.current.value)!=null?ve:null,value:m}},[I,l,m]),O=It(()=>{if(I.activeOptionIndex!==null){if(I.virtual)H(I.virtual.options[I.activeOptionIndex]);else{let{dataRef:G}=I.options[I.activeOptionIndex];H(G.current.value)}oe.goToOption(fr.Specific,I.activeOptionIndex)}}),z=It(()=>{w({type:0}),E.current=!0}),B=It(()=>{w({type:1}),E.current=!1}),L=It((G,he,ve)=>(E.current=!1,G===fr.Specific?w({type:2,focus:fr.Specific,idx:he,trigger:ve}):w({type:2,focus:G,trigger:ve}))),D=It((G,he)=>(w({type:3,payload:{id:G,dataRef:he}}),()=>{I.isActive(he.current.value)&&(E.current=!0),w({type:4,id:G})})),W=It(G=>(w({type:5,id:G}),()=>w({type:5,id:null}))),H=It(G=>Fr(I.mode,{0(){return v==null?void 0:v(G)},1(){let he=I.value.slice(),ve=he.findIndex(Y=>R(Y,G));return ve===-1?he.push(G):he.splice(ve,1),v==null?void 0:v(he)}})),K=It(G=>{w({type:6,trigger:G})}),oe=ee.useMemo(()=>({onChange:H,registerOption:D,registerLabel:W,goToOption:L,closeCombobox:B,openCombobox:z,setActivationTrigger:K,selectActiveOption:O}),[]),me=e===null?{}:{ref:e},Se=ee.useRef(null),Te=Wv();return ee.useEffect(()=>{Se.current&&r!==void 0&&Te.addEventListener(Se.current,"reset",()=>{v==null||v(r)})},[Se,v]),Mn.createElement(YN.Provider,{value:oe},Mn.createElement(KN.Provider,{value:I},Mn.createElement(G6,{value:Fr(I.comboboxState,{0:os.Open,1:os.Closed})},o!=null&&m!=null&&W6({[o]:m}).map(([G,he],ve)=>Mn.createElement(ide,{features:V6.Hidden,ref:ve===0?Y=>{var Ne;Se.current=(Ne=Y==null?void 0:Y.closest("form"))!=null?Ne:null}:void 0,...AA({key:G,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:s,name:G,value:he})})),dl({ourProps:me,theirProps:_,slot:j,defaultTag:vde,name:"Combobox"}))))}let xde="input";function yde(n,e){var t,r,i,s,o;let a=Yv(),{id:l=`headlessui-combobox-input-${a}`,onChange:c,displayValue:u,type:h="text",...f}=n,p=Ud("Combobox.Input"),_=Kv("Combobox.Input"),y=Dd(p.inputRef,e),g=que(p.inputRef),m=ee.useRef(!1),v=Wv(),x=It(()=>{_.onChange(null),p.optionsRef.current&&(p.optionsRef.current.scrollTop=0),_.goToOption(fr.Nothing)}),w=function(){var I;return typeof u=="function"&&p.value!==void 0?(I=u(p.value))!=null?I:"":typeof p.value=="string"?p.value:""}();k3(([I,j],[O,z])=>{if(m.current)return;let B=p.inputRef.current;B&&((z===0&&j===1||I!==O)&&(B.value=I),requestAnimationFrame(()=>{if(m.current||!B||(g==null?void 0:g.activeElement)!==B)return;let{selectionStart:L,selectionEnd:D}=B;Math.abs((D??0)-(L??0))===0&&L===0&&B.setSelectionRange(B.value.length,B.value.length)}))},[w,p.comboboxState,g]),k3(([I],[j])=>{if(I===0&&j===1){if(m.current)return;let O=p.inputRef.current;if(!O)return;let z=O.value,{selectionStart:B,selectionEnd:L,selectionDirection:D}=O;O.value="",O.value=z,D!==null?O.setSelectionRange(B,L,D):O.setSelectionRange(B,L)}},[p.comboboxState]);let E=ee.useRef(!1),S=It(()=>{E.current=!0}),C=It(()=>{v.nextFrame(()=>{E.current=!1})}),A=It(I=>{switch(m.current=!0,I.key){case is.Enter:if(m.current=!1,p.comboboxState!==0||E.current)return;if(I.preventDefault(),I.stopPropagation(),p.activeOptionIndex===null){_.closeCombobox();return}_.selectActiveOption(),p.mode===0&&_.closeCombobox();break;case is.ArrowDown:return m.current=!1,I.preventDefault(),I.stopPropagation(),Fr(p.comboboxState,{0:()=>_.goToOption(fr.Next),1:()=>_.openCombobox()});case is.ArrowUp:return m.current=!1,I.preventDefault(),I.stopPropagation(),Fr(p.comboboxState,{0:()=>_.goToOption(fr.Previous),1:()=>{_.openCombobox(),v.nextFrame(()=>{p.value||_.goToOption(fr.Last)})}});case is.Home:if(I.shiftKey)break;return m.current=!1,I.preventDefault(),I.stopPropagation(),_.goToOption(fr.First);case is.PageUp:return m.current=!1,I.preventDefault(),I.stopPropagation(),_.goToOption(fr.First);case is.End:if(I.shiftKey)break;return m.current=!1,I.preventDefault(),I.stopPropagation(),_.goToOption(fr.Last);case is.PageDown:return m.current=!1,I.preventDefault(),I.stopPropagation(),_.goToOption(fr.Last);case is.Escape:return m.current=!1,p.comboboxState!==0?void 0:(I.preventDefault(),p.optionsRef.current&&!p.optionsPropsRef.current.static&&I.stopPropagation(),p.nullable&&p.mode===0&&p.value===null&&x(),_.closeCombobox());case is.Tab:if(m.current=!1,p.comboboxState!==0)return;p.mode===0&&p.activationTrigger!==1&&_.selectActiveOption(),_.closeCombobox();break}}),k=It(I=>{c==null||c(I),p.nullable&&p.mode===0&&I.target.value===""&&x(),_.openCombobox()}),T=It(I=>{var j,O,z;let B=(j=I.relatedTarget)!=null?j:bu.find(L=>L!==I.currentTarget);if(m.current=!1,!((O=p.optionsRef.current)!=null&&O.contains(B))&&!((z=p.buttonRef.current)!=null&&z.contains(B))&&p.comboboxState===0)return I.preventDefault(),p.mode===0&&(p.nullable&&p.value===null?x():p.activationTrigger!==1&&_.selectActiveOption()),_.closeCombobox()}),R=It(I=>{var j,O,z;let B=(j=I.relatedTarget)!=null?j:bu.find(L=>L!==I.currentTarget);(O=p.buttonRef.current)!=null&&O.contains(B)||(z=p.optionsRef.current)!=null&&z.contains(B)||p.disabled||p.immediate&&p.comboboxState!==0&&(_.openCombobox(),v.nextFrame(()=>{_.setActivationTrigger(1)}))}),$=BN(()=>{if(p.labelId)return[p.labelId].join(" ")},[p.labelId]),P=ee.useMemo(()=>({open:p.comboboxState===0,disabled:p.disabled}),[p]),M={ref:y,id:l,role:"combobox",type:h,"aria-controls":(t=p.optionsRef.current)==null?void 0:t.id,"aria-expanded":p.comboboxState===0,"aria-activedescendant":p.activeOptionIndex===null?void 0:p.virtual?(r=p.options.find(I=>{var j;return!((j=p.virtual)!=null&&j.disabled(I.dataRef.current.value))&&p.compare(I.dataRef.current.value,p.virtual.options[p.activeOptionIndex])}))==null?void 0:r.id:(i=p.options[p.activeOptionIndex])==null?void 0:i.id,"aria-labelledby":$,"aria-autocomplete":"list",defaultValue:(o=(s=n.defaultValue)!=null?s:p.defaultValue!==void 0?u==null?void 0:u(p.defaultValue):null)!=null?o:p.defaultValue,disabled:p.disabled,onCompositionStart:S,onCompositionEnd:C,onKeyDown:A,onChange:k,onFocus:R,onBlur:T};return dl({ourProps:M,theirProps:f,slot:P,defaultTag:xde,name:"Combobox.Input"})}let wde="button";function Sde(n,e){var t;let r=Ud("Combobox.Button"),i=Kv("Combobox.Button"),s=Dd(r.buttonRef,e),o=Yv(),{id:a=`headlessui-combobox-button-${o}`,...l}=n,c=Wv(),u=It(y=>{switch(y.key){case is.ArrowDown:return y.preventDefault(),y.stopPropagation(),r.comboboxState===1&&i.openCombobox(),c.nextFrame(()=>{var g;return(g=r.inputRef.current)==null?void 0:g.focus({preventScroll:!0})});case is.ArrowUp:return y.preventDefault(),y.stopPropagation(),r.comboboxState===1&&(i.openCombobox(),c.nextFrame(()=>{r.value||i.goToOption(fr.Last)})),c.nextFrame(()=>{var g;return(g=r.inputRef.current)==null?void 0:g.focus({preventScroll:!0})});case is.Escape:return r.comboboxState!==0?void 0:(y.preventDefault(),r.optionsRef.current&&!r.optionsPropsRef.current.static&&y.stopPropagation(),i.closeCombobox(),c.nextFrame(()=>{var g;return(g=r.inputRef.current)==null?void 0:g.focus({preventScroll:!0})}));default:return}}),h=It(y=>{if(ode(y.currentTarget))return y.preventDefault();r.comboboxState===0?i.closeCombobox():(y.preventDefault(),i.openCombobox()),c.nextFrame(()=>{var g;return(g=r.inputRef.current)==null?void 0:g.focus({preventScroll:!0})})}),f=BN(()=>{if(r.labelId)return[r.labelId,a].join(" ")},[r.labelId,a]),p=ee.useMemo(()=>({open:r.comboboxState===0,disabled:r.disabled,value:r.value}),[r]),_={ref:s,id:a,type:Zue(n,r.buttonRef),tabIndex:-1,"aria-haspopup":"listbox","aria-controls":(t=r.optionsRef.current)==null?void 0:t.id,"aria-expanded":r.comboboxState===0,"aria-labelledby":f,disabled:r.disabled,onClick:h,onKeyDown:u};return dl({ourProps:_,theirProps:l,slot:p,defaultTag:wde,name:"Combobox.Button"})}let Ede="label";function Tde(n,e){let t=Yv(),{id:r=`headlessui-combobox-label-${t}`,...i}=n,s=Ud("Combobox.Label"),o=Kv("Combobox.Label"),a=Dd(s.labelRef,e);xr(()=>o.registerLabel(r),[r]);let l=It(()=>{var u;return(u=s.inputRef.current)==null?void 0:u.focus({preventScroll:!0})}),c=ee.useMemo(()=>({open:s.comboboxState===0,disabled:s.disabled}),[s]);return dl({ourProps:{ref:a,id:r,onClick:l},theirProps:i,slot:c,defaultTag:Ede,name:"Combobox.Label"})}let Cde="ul",bde=Mw.RenderStrategy|Mw.Static;function Ade(n,e){let t=Yv(),{id:r=`headlessui-combobox-options-${t}`,hold:i=!1,...s}=n,o=Ud("Combobox.Options"),a=Dd(o.optionsRef,e),l=WN(),c=l!==null?(l&os.Open)===os.Open:o.comboboxState===0;xr(()=>{var p;o.optionsPropsRef.current.static=(p=n.static)!=null?p:!1},[o.optionsPropsRef,n.static]),xr(()=>{o.optionsPropsRef.current.hold=i},[o.optionsPropsRef,i]),ede({container:o.optionsRef.current,enabled:o.comboboxState===0,accept(p){return p.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:p.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(p){p.setAttribute("role","none")}});let u=BN(()=>{var p,_;return(_=o.labelId)!=null?_:(p=o.buttonRef.current)==null?void 0:p.id},[o.labelId,o.buttonRef.current]),h=ee.useMemo(()=>({open:o.comboboxState===0,option:void 0}),[o]),f={"aria-labelledby":u,role:"listbox","aria-multiselectable":o.mode===1?!0:void 0,id:r,ref:a};return o.virtual&&o.comboboxState===0&&Object.assign(s,{children:Mn.createElement(mde,null,s.children)}),dl({ourProps:f,theirProps:s,slot:h,defaultTag:Cde,features:bde,visible:c,name:"Combobox.Options"})}let Mde="li";function Rde(n,e){var t;let r=Yv(),{id:i=`headlessui-combobox-option-${r}`,disabled:s=!1,value:o,order:a=null,...l}=n,c=Ud("Combobox.Option"),u=Kv("Combobox.Option"),h=c.virtual?c.activeOptionIndex===c.calculateIndex(o):c.activeOptionIndex===null?!1:((t=c.options[c.activeOptionIndex])==null?void 0:t.id)===i,f=c.isSelected(o),p=ee.useRef(null),_=na({disabled:s,value:o,domRef:p,order:a}),y=ee.useContext($6),g=Dd(e,p,y?y.measureElement:null),m=It(()=>u.onChange(o));xr(()=>u.registerOption(i,_),[_,i]);let v=ee.useRef(!(c.virtual||c.__demoMode));xr(()=>{if(!c.virtual||!c.__demoMode)return;let T=_d();return T.requestAnimationFrame(()=>{v.current=!0}),T.dispose},[c.virtual,c.__demoMode]),xr(()=>{if(!v.current||c.comboboxState!==0||!h||c.activationTrigger===0)return;let T=_d();return T.requestAnimationFrame(()=>{var R,$;($=(R=p.current)==null?void 0:R.scrollIntoView)==null||$.call(R,{block:"nearest"})}),T.dispose},[p,h,c.comboboxState,c.activationTrigger,c.activeOptionIndex]);let x=It(T=>{var R;if(s||(R=c.virtual)!=null&&R.disabled(o))return T.preventDefault();m(),B6()||requestAnimationFrame(()=>{var $;return($=c.inputRef.current)==null?void 0:$.focus({preventScroll:!0})}),c.mode===0&&requestAnimationFrame(()=>u.closeCombobox())}),w=It(()=>{var T;if(s||(T=c.virtual)!=null&&T.disabled(o))return u.goToOption(fr.Nothing);let R=c.calculateIndex(o);u.goToOption(fr.Specific,R)}),E=Jue(),S=It(T=>E.update(T)),C=It(T=>{var R;if(!E.wasMoved(T)||s||(R=c.virtual)!=null&&R.disabled(o)||h)return;let $=c.calculateIndex(o);u.goToOption(fr.Specific,$,0)}),A=It(T=>{var R;E.wasMoved(T)&&(s||(R=c.virtual)!=null&&R.disabled(o)||h&&(c.optionsPropsRef.current.hold||u.goToOption(fr.Nothing)))}),k=ee.useMemo(()=>({active:h,selected:f,disabled:s}),[h,f,s]);return dl({ourProps:{id:i,ref:g,role:"option",tabIndex:s===!0?void 0:-1,"aria-disabled":s===!0?!0:void 0,"aria-selected":f,disabled:void 0,onClick:x,onFocus:w,onPointerEnter:S,onMouseEnter:S,onPointerMove:C,onMouseMove:C,onPointerLeave:A,onMouseLeave:A},theirProps:l,slot:k,defaultTag:Mde,name:"Combobox.Option"})}let Nde=ua(_de),Ide=ua(Sde),Pde=ua(yde),kde=ua(Tde),Lde=ua(Ade),Ode=ua(Rde),ra=Object.assign(Nde,{Input:Pde,Button:Ide,Label:kde,Options:Lde,Option:Ode});function $N(){let n=ee.useRef(!1);return xr(()=>(n.current=!0,()=>{n.current=!1}),[]),n}function Dde(n=0){let[e,t]=ee.useState(n),r=$N(),i=ee.useCallback(l=>{r.current&&t(c=>c|l)},[e,r]),s=ee.useCallback(l=>!!(e&l),[e]),o=ee.useCallback(l=>{r.current&&t(c=>c&~l)},[t,r]),a=ee.useCallback(l=>{r.current&&t(c=>c^l)},[t]);return{flags:e,addFlag:i,hasFlag:s,removeFlag:o,toggleFlag:a}}function Ude(n){let e={called:!1};return(...t)=>{if(!e.called)return e.called=!0,n(...t)}}function wC(n,...e){n&&e.length>0&&n.classList.add(...e)}function SC(n,...e){n&&e.length>0&&n.classList.remove(...e)}function Fde(n,e){let t=_d();if(!n)return t.dispose;let{transitionDuration:r,transitionDelay:i}=getComputedStyle(n),[s,o]=[r,i].map(l=>{let[c=0]=l.split(",").filter(Boolean).map(u=>u.includes("ms")?parseFloat(u):parseFloat(u)*1e3).sort((u,h)=>h-u);return c}),a=s+o;if(a!==0){t.group(c=>{c.setTimeout(()=>{e(),c.dispose()},a),c.addEventListener(n,"transitionrun",u=>{u.target===u.currentTarget&&c.dispose()})});let l=t.addEventListener(n,"transitionend",c=>{c.target===c.currentTarget&&(e(),l())})}else e();return t.add(()=>e()),t.dispose}function jde(n,e,t,r){let i=t?"enter":"leave",s=_d(),o=r!==void 0?Ude(r):()=>{};i==="enter"&&(n.removeAttribute("hidden"),n.style.display="");let a=Fr(i,{enter:()=>e.enter,leave:()=>e.leave}),l=Fr(i,{enter:()=>e.enterTo,leave:()=>e.leaveTo}),c=Fr(i,{enter:()=>e.enterFrom,leave:()=>e.leaveFrom});return SC(n,...e.base,...e.enter,...e.enterTo,...e.enterFrom,...e.leave,...e.leaveFrom,...e.leaveTo,...e.entered),wC(n,...e.base,...a,...c),s.nextFrame(()=>{SC(n,...e.base,...a,...c),wC(n,...e.base,...a,...l),Fde(n,()=>(SC(n,...e.base,...a),wC(n,...e.base,...e.entered),o()))}),s.dispose}function zde({immediate:n,container:e,direction:t,classes:r,onStart:i,onStop:s}){let o=$N(),a=Wv(),l=na(t);xr(()=>{n&&(l.current="enter")},[n]),xr(()=>{let c=_d();a.add(c.dispose);let u=e.current;if(u&&l.current!=="idle"&&o.current)return c.dispose(),i.current(l.current),c.add(jde(u,r.current,l.current==="enter",()=>{c.dispose(),s.current(l.current)})),c.dispose},[t])}function Nl(n=""){return n.split(/\s+/).filter(e=>e.length>1)}let DS=ee.createContext(null);DS.displayName="TransitionContext";var Bde=(n=>(n.Visible="visible",n.Hidden="hidden",n))(Bde||{});function Hde(){let n=ee.useContext(DS);if(n===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return n}function Vde(){let n=ee.useContext(US);if(n===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return n}let US=ee.createContext(null);US.displayName="NestingContext";function FS(n){return"children"in n?FS(n.children):n.current.filter(({el:e})=>e.current!==null).filter(({state:e})=>e==="visible").length>0}function X6(n,e){let t=na(n),r=ee.useRef([]),i=$N(),s=Wv(),o=It((p,_=ic.Hidden)=>{let y=r.current.findIndex(({el:g})=>g===p);y!==-1&&(Fr(_,{[ic.Unmount](){r.current.splice(y,1)},[ic.Hidden](){r.current[y].state="hidden"}}),s.microTask(()=>{var g;!FS(r)&&i.current&&((g=t.current)==null||g.call(t))}))}),a=It(p=>{let _=r.current.find(({el:y})=>y===p);return _?_.state!=="visible"&&(_.state="visible"):r.current.push({el:p,state:"visible"}),()=>o(p,ic.Unmount)}),l=ee.useRef([]),c=ee.useRef(Promise.resolve()),u=ee.useRef({enter:[],leave:[],idle:[]}),h=It((p,_,y)=>{l.current.splice(0),e&&(e.chains.current[_]=e.chains.current[_].filter(([g])=>g!==p)),e==null||e.chains.current[_].push([p,new Promise(g=>{l.current.push(g)})]),e==null||e.chains.current[_].push([p,new Promise(g=>{Promise.all(u.current[_].map(([m,v])=>v)).then(()=>g())})]),_==="enter"?c.current=c.current.then(()=>e==null?void 0:e.wait.current).then(()=>y(_)):y(_)}),f=It((p,_,y)=>{Promise.all(u.current[_].splice(0).map(([g,m])=>m)).then(()=>{var g;(g=l.current.shift())==null||g()}).then(()=>y(_))});return ee.useMemo(()=>({children:r,register:a,unregister:o,onStart:h,onStop:f,wait:c,chains:u}),[a,o,r,h,f,u,c])}function Gde(){}let Wde=["beforeEnter","afterEnter","beforeLeave","afterLeave"];function O3(n){var e;let t={};for(let r of Wde)t[r]=(e=n[r])!=null?e:Gde;return t}function Yde(n){let e=ee.useRef(O3(n));return ee.useEffect(()=>{e.current=O3(n)},[n]),e}let Kde="div",q6=Mw.RenderStrategy;function $de(n,e){var t,r;let{beforeEnter:i,afterEnter:s,beforeLeave:o,afterLeave:a,enter:l,enterFrom:c,enterTo:u,entered:h,leave:f,leaveFrom:p,leaveTo:_,...y}=n,g=ee.useRef(null),m=Dd(g,e),v=(t=y.unmount)==null||t?ic.Unmount:ic.Hidden,{show:x,appear:w,initial:E}=Hde(),[S,C]=ee.useState(x?"visible":"hidden"),A=Vde(),{register:k,unregister:T}=A;ee.useEffect(()=>k(g),[k,g]),ee.useEffect(()=>{if(v===ic.Hidden&&g.current){if(x&&S!=="visible"){C("visible");return}return Fr(S,{hidden:()=>T(g),visible:()=>k(g)})}},[S,g,k,T,x,v]);let R=na({base:Nl(y.className),enter:Nl(l),enterFrom:Nl(c),enterTo:Nl(u),entered:Nl(h),leave:Nl(f),leaveFrom:Nl(p),leaveTo:Nl(_)}),$=Yde({beforeEnter:i,afterEnter:s,beforeLeave:o,afterLeave:a}),P=HN();ee.useEffect(()=>{if(P&&S==="visible"&&g.current===null)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[g,S,P]);let M=E&&!w,I=w&&x&&E,j=!P||M?"idle":x?"enter":"leave",O=Dde(0),z=It(K=>Fr(K,{enter:()=>{O.addFlag(os.Opening),$.current.beforeEnter()},leave:()=>{O.addFlag(os.Closing),$.current.beforeLeave()},idle:()=>{}})),B=It(K=>Fr(K,{enter:()=>{O.removeFlag(os.Opening),$.current.afterEnter()},leave:()=>{O.removeFlag(os.Closing),$.current.afterLeave()},idle:()=>{}})),L=X6(()=>{C("hidden"),T(g)},A),D=ee.useRef(!1);zde({immediate:I,container:g,classes:R,direction:j,onStart:na(K=>{D.current=!0,L.onStart(g,K,z)}),onStop:na(K=>{D.current=!1,L.onStop(g,K,B),K==="leave"&&!FS(L)&&(C("hidden"),T(g))})});let W=y,H={ref:m};return I?W={...W,className:Aw(y.className,...R.current.enter,...R.current.enterFrom)}:D.current&&(W.className=Aw(y.className,(r=g.current)==null?void 0:r.className),W.className===""&&delete W.className),Mn.createElement(US.Provider,{value:L},Mn.createElement(G6,{value:Fr(S,{visible:os.Open,hidden:os.Closed})|O.flags},dl({ourProps:H,theirProps:W,defaultTag:Kde,features:q6,visible:S==="visible",name:"Transition.Child"})))}function Xde(n,e){let{show:t,appear:r=!1,unmount:i=!0,...s}=n,o=ee.useRef(null),a=Dd(o,e);HN();let l=WN();if(t===void 0&&l!==null&&(t=(l&os.Open)===os.Open),![!0,!1].includes(t))throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[c,u]=ee.useState(t?"visible":"hidden"),h=X6(()=>{u("hidden")}),[f,p]=ee.useState(!0),_=ee.useRef([t]);xr(()=>{f!==!1&&_.current[_.current.length-1]!==t&&(_.current.push(t),p(!1))},[_,t]);let y=ee.useMemo(()=>({show:t,appear:r,initial:f}),[t,r,f]);ee.useEffect(()=>{if(t)u("visible");else if(!FS(h))u("hidden");else{let x=o.current;if(!x)return;let w=x.getBoundingClientRect();w.x===0&&w.y===0&&w.width===0&&w.height===0&&u("hidden")}},[t,h]);let g={unmount:i},m=It(()=>{var x;f&&p(!1),(x=n.beforeEnter)==null||x.call(n)}),v=It(()=>{var x;f&&p(!1),(x=n.beforeLeave)==null||x.call(n)});return Mn.createElement(US.Provider,{value:h},Mn.createElement(DS.Provider,{value:y},dl({ourProps:{...g,as:ee.Fragment,children:Mn.createElement(Z6,{ref:a,...g,...s,beforeEnter:m,beforeLeave:v})},theirProps:{},defaultTag:ee.Fragment,features:q6,visible:c==="visible",name:"Transition"})))}function qde(n,e){let t=ee.useContext(DS)!==null,r=WN()!==null;return Mn.createElement(Mn.Fragment,null,!t&&r?Mn.createElement(MA,{ref:e,...n}):Mn.createElement(Z6,{ref:e,...n}))}let MA=ua(Xde),Z6=ua($de),Zde=ua(qde),Q6=Object.assign(MA,{Child:Zde,Root:MA});function D3(n){const[e,t]=ee.useState(n.selected),[r,i]=ee.useState(!1),[s,o]=ee.useState(""),a=ee.useRef(null);ee.useEffect(()=>{e!==n.selected&&t(n.selected)},[n.selected]);const l=s===""?n.list:n.list.filter(c=>c.label.toLowerCase().replace(/\s+/g,"").includes(s.toLowerCase().replace(/\s+/g,"")));return d.jsx(ra,{value:e||n.selected,onChange:c=>{n.onChange(c),t(c)},children:d.jsxs("div",{className:"relative",ref:a,onClick:()=>i(!r),children:[d.jsx("div",{className:"relative w-full overflow-hidden  text-left shadow-sm focus:outline-none  ",children:d.jsx(ra.Button,{as:"div",children:d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"h-3 w-3 m-auto",style:{backgroundColor:(e==null?void 0:e.label)=="NA"?"transparent":(e==null?void 0:e.label)||"white"}}),d.jsx(ra.Input,{className:"w-full border-none focus:outline-none bg-transparent text-orange-400 ml-1 hover:text-orange-300 cursor-pointer",displayValue:c=>n.onDisplayValue(c),onChange:c=>o(c.target.value)})]})})}),d.jsx(Qde,{setQuery:o,filteredList:l,query:s,refParent:a})]})})}function Qde(n){const[e,t]=ee.useState(0),[r,i]=ee.useState(0);return ee.useEffect(()=>{var s;if((s=n.refParent)!=null&&s.current){const o=n.refParent.current.getBoundingClientRect();o.bottom!==e&&t(o.bottom),o.left!==r&&i(o.left)}}),li.createPortal(d.jsx(Q6,{as:ee.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",afterLeave:()=>n.setQuery(""),children:d.jsx(ra.Options,{style:{top:e,left:r},className:"z-[1000] absolute mt-1 max-h-60  overflow-auto scrollbar bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none border border-gray-600",children:n.filteredList.length===0&&n.query!==""?d.jsx("div",{className:"relative cursor-default select-none  ml-1 text-xs text-red-500",children:"Nothing found."}):n.filteredList.map(s=>d.jsx(ra.Option,{className:({active:o})=>`relative cursor-pointer select-none pl-1 pr-2 ${o?"bg-gray-700 text-orange-400":"text-orange-400"}`,value:s,children:()=>d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"h-3 w-3 m-auto ml-1",style:{backgroundColor:s.label}}),d.jsx("span",{className:"block m-auto ml-1 text-xs flex-1",children:s.label})]})},s.id))})}),document.body)}function Jde(){return d.jsx("button",{className:"left-1 bg-green-700 p-1 text-xs max-w-[7rem] hover:bg-green-600",onClick:async()=>{it.setState({loadingData:!0,dialogHeader:"please wait",dialogContent:"searching for elements"}),await R6(),await ae.selection_clear(!1),Mt.getState().updateToggel(),it.setState({loadingData:!1,dialogHeader:"please wait",dialogContent:"searching for elements"})},children:"Update colors"})}function ed(n){const[e,t]=ee.useState(n.selected),[r,i]=ee.useState(!1),[s,o]=ee.useState(""),a=ee.useRef(null);ee.useEffect(()=>{e!==n.selected&&t(n.selected)},[n.selected]);const l=s===""?n.list:n.list.filter(c=>c.label.toLowerCase().replace(/\s+/g,"").includes(s.toLowerCase().replace(/\s+/g,"")));return d.jsx(ra,{value:e||n.selected,onChange:c=>{n.onChange(c),t(c)},children:d.jsxs("div",{className:"relative",ref:a,onClick:()=>i(!r),children:[d.jsx("div",{className:"relative w-full overflow-hidden focus:outline-none  ",children:d.jsx(ra.Button,{as:"div",children:d.jsx("div",{className:"flex",children:d.jsx(ra.Input,{className:"w-full border-none focus:outline-none bg-transparent text-orange-400  hover:text-orange-300 cursor-pointer text-xs ",displayValue:c=>n.onDisplayValue(c),onChange:c=>o(c.target.value)})})})}),d.jsx(ehe,{setQuery:o,filteredList:l,query:s,refParent:a})]})})}function ehe(n){const[e,t]=ee.useState(0),[r,i]=ee.useState(0);return ee.useEffect(()=>{var s;if((s=n.refParent)!=null&&s.current){const o=n.refParent.current.getBoundingClientRect();o.bottom!==e&&t(o.bottom),o.left!==r&&i(o.left)}}),li.createPortal(d.jsx(Q6,{as:ee.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",afterLeave:()=>n.setQuery(""),children:d.jsx(ra.Options,{style:{top:e,left:r},className:"z-[1000] absolute mt-1 max-h-60  overflow-auto scrollbar bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none border border-gray-600",children:n.filteredList.length===0&&n.query!==""?d.jsx("div",{className:"relative cursor-default select-none  ml-1 text-xs text-red-500",children:"Nothing found."}):n.filteredList.map(s=>d.jsx(ra.Option,{className:({active:o})=>`cursor-pointer select-none  ${o?"bg-gray-700 text-orange-400":"text-orange-400"}`,value:s,children:()=>d.jsx("span",{className:"block m-auto ml-1 text-xs flex-1",children:s.label})},s.id))})}),document.body)}function the(){const n=Ot();return d.jsxs("div",{style:{minHeight:"0px"},className:"flex flex-col flex-grow",children:[d.jsx(Jde,{}),d.jsxs("div",{className:"flex mt-5",children:[d.jsx("div",{className:"p-2 underline",children:"Color:"}),d.jsx("div",{className:"flex-1"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 m-1 text-indigo-500 hover:text-indigo-300 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:async()=>{n.addColor({name:"",color:"White",operator:"Contains",uuid:gr()}),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})})]}),d.jsx("div",{className:"flex flex-col flex-grow overflow-auto scrollbar border-t-2 border-gray-900/50 shadow-inner",children:n.currentSet.colorOverride.map((e,t)=>{const r=(e.color||"").split(":")[0],i=(e.color||"").split(":")[1]||"100",s=["100","75","50","25","10","05","02","00"];return d.jsxs("div",{className:"flex  flex-col p-2 border-b border-gray-900 mb-2",children:[d.jsxs("div",{className:"flex",children:[d.jsxs("div",{className:"flex flex-col flex-1 text-xs",children:[d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-14 ",children:"Name:"}),e.operator==="In"?d.jsx("textarea",{autoComplete:"off",value:e.name,onChange:o=>{var l;const a=(l=o==null?void 0:o.target)==null?void 0:l.value;n.updateColorItemName(t,a),n.updateUUID()},className:"flex-1 ml-1 outline-none text-gray-200 p-[2px] scrollbar bg-gray-800 border-b border-dashed border-gray-700 placeholder-gray-600",placeholder:"paste in name and color column from excel"}):d.jsx("input",{autoComplete:"off",value:e.name,onChange:o=>{var l;const a=(l=o==null?void 0:o.target)==null?void 0:l.value;n.updateColorItemName(t,a),n.updateUUID()},className:"flex-1 ml-1 outline-none text-gray-200 p-[2px] max-h-5 bg-gray-800 border-b border-dashed border-gray-700 placeholder-gray-600",placeholder:"item you want colored"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-14",children:"Operator:"}),d.jsx("div",{className:"ml-1 font-semibold",children:d.jsx(ed,{selected:{id:e.operator,label:e.operator},list:["Equal","Contains","In"].map(o=>({id:o,label:o})),onChange:o=>{const a=(o==null?void 0:o.label)||"Equal";n.updateColorOperator(t,a),a==="In"&&n.updateColorColorName(t,"NA:100"),n.updateUUID()},onDisplayValue:o=>(o==null?void 0:o.label)||""})})]}),e.operator==="In"?d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-14",children:"Color:"}),d.jsx("div",{className:"ml-1 font-semibold",children:d.jsx(D3,{selected:{id:r,label:r},list:["NA"].concat(M3).map(o=>({id:o,label:o})),onChange:o=>{const a=(o==null?void 0:o.label)||"transparent";n.updateColorColorName(t,`${a}:100`),n.updateUUID()},onDisplayValue:o=>(o==null?void 0:o.label)||""})})]}):d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-14",children:"Color:"}),d.jsx("div",{className:"ml-1 font-semibold",children:d.jsx(D3,{selected:{id:r,label:r},list:M3.map(o=>({id:o,label:o})),onChange:o=>{const a=(o==null?void 0:o.label)||"white";n.updateColorColorName(t,`${a}:${i}`),n.updateUUID()},onDisplayValue:o=>(o==null?void 0:o.label)||""})})]}),e.operator==="In"?null:d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-14",children:"Opacity:"}),d.jsx("div",{className:"ml-1 font-semibold",children:d.jsx(ed,{selected:{id:i,label:i=="00"?"00 (hide)":i},list:s.map(o=>({id:o,label:o=="00"?"00 (hide)":o})),onChange:o=>{const a=(o==null?void 0:o.id)||"100";n.updateColorColorName(t,`${r}:${a}`),n.updateUUID()},onDisplayValue:o=>(o==null?void 0:o.label)||""})})]})]}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-600 hover:text-red-400 m-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Delete color",strokeWidth:2,onClick:()=>{n.deleteColor(t),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})]}),d.jsxs("div",{className:"flex items-center mt-2 justify-center ",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500 hover:text-indigo-300 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{n.pushDownColor(t),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500 hover:text-indigo-300 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{n.pushUpColor(t),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]})]},e.uuid)})})]})}function mu(n,e){const t=Ot.getState();F().getSceneController().clearModelGroup("BBOX"+n);const r=structuredClone(t.currentSet.filter[n][e].max),i=structuredClone(t.currentSet.filter[n][e].min),s=new et(new N(i.x,i.y,i.z),new N(r.x,r.y,r.z)),o=new OC(s,new at("yellow"));F().getSceneController().addMeshToScene(o,"BBOX"+n),F().forceRenderNextFrame()}let sg=!1,Fl="up";function RA(n,e,t){const r=Ot.getState(),i=structuredClone(r.currentSet.filter[t][e].max),s=structuredClone(r.currentSet.filter[t][e].min);let o=0;function a(l,c){return c==="up"?l=l+.1:l=l-.1}switch(n){case"maxX":o=a(i.x,Fl),o>s.x&&(i.x=o);break;case"maxY":o=a(i.y,Fl),o>s.y&&(i.y=o);break;case"maxZ":o=a(i.z,Fl),o>s.z&&(i.z=o);break;case"minX":o=a(s.x,Fl),o<i.x&&(s.x=o);break;case"minY":o=a(s.y,Fl),o<i.y&&(s.y=o);break;case"minZ":o=a(s.z,Fl),o<i.z&&(s.z=o);break}r.updateBoundingFilter(t,e,{max:i,min:s}),mu(t,e),sg&&setTimeout(()=>RA(n,e,t),50)}function Rh(n){return d.jsxs("div",{className:"flex",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-orange-500 hover:text-orange-400 ml-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onMouseDown:()=>{sg=!0,Fl="down",RA(n.type,n.index,n.filterIndex)},onMouseUp:()=>{sg=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-orange-500 hover:text-orange-400 ml-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onMouseDown:()=>{sg=!0,Fl="up",RA(n.type,n.index,n.filterIndex)},onMouseUp:()=>{sg=!1},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]})}function nhe(n){const e=Ot(),t=n.row,r=n.rowNo,i=n.filterIndex,s={display:r===0?"none":""};return d.jsxs("div",{className:"flex flex-col m-1 border border-gray-900/50 ",children:[d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{className:"flex flex-col text-xs w-full",children:[d.jsxs("div",{className:"flex w-full",children:[d.jsx("span",{className:"text-gray-300 w-14 ml-1 mt-1",children:"Type:"}),d.jsx("div",{className:"ml-1 mt-1 font-semibold",children:d.jsx(ed,{selected:{id:n.row.type,label:n.row.type},list:["Standard"].map(o=>({id:o,label:o})),onChange:o=>{switch((o==null?void 0:o.label)||"Standard"){case"Standard":e.setAsStandardFilter(i,r);break;case"Boundingbox":e.setAsBoundingboxFilter(i,r);break}e.updateUUID()},onDisplayValue:o=>(o==null?void 0:o.label)||"Standard"})})]}),d.jsxs("div",{className:"flex w-full",style:s,children:[d.jsx("span",{className:"text-gray-300 w-14 ml-1 mt-1",children:"Action:"}),d.jsx("div",{className:"ml-1 mt-1 font-semibold",children:d.jsx(ed,{selected:{id:t.filtertype,label:t.filtertype},list:["Append","Remove","Keep"].map(o=>({id:o,label:o})),onChange:o=>{const a=(o==null?void 0:o.label)||"Append";e.setFilterType(i,r,a),e.updateUUID()},onDisplayValue:o=>(o==null?void 0:o.label)||"Append"})})]})]}),d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"flex items-center",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-orange-500 hover:text-orange-400 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"get coordinates from selection",strokeWidth:2,onClick:async()=>{F().getSceneController().clearModelGroup("BBOX"+i);const o=await ae.get_bounding_box_from_selection();if(!o.X===void 0)return;const a=new et(new N(o.x,o.y,o.z),new N(o.X,o.Y,o.Z)),l=new OC(a,new at("yellow"));l.geometry.computeBoundingBox(),F().getSceneController().addMeshToScene(l,"BBOX"+i),F().forceRenderNextFrame();const c=structuredClone(e.currentSet.filter[i][r].max);c.x=a.max.x,c.y=a.max.y,c.z=a.max.z;const u=structuredClone(e.currentSet.filter[i][r].min);u.x=a.min.x,u.y=a.min.y,u.z=a.min.z,e.updateBoundingFilter(i,r,{max:c,min:u}),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),d.jsx("div",{className:"flex items-center",children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-orange-500 hover:text-orange-400 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"show bounding box",strokeWidth:2,onClick:()=>{F().getSceneController().clearModelGroup("BBOX"+i);const o=structuredClone(e.currentSet.filter[i][r].max),a=structuredClone(e.currentSet.filter[i][r].min),l=new et(new N(a.x,a.y,a.z),new N(o.x,o.y,o.z)),c=new OC(l,new at("yellow"));c.geometry.computeBoundingBox(),F().getSceneController().addMeshToScene(c,"BBOX"+i),F().forceRenderNextFrame()},children:[d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),d.jsx("div",{className:"flex items-center",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-orange-500 hover:text-orange-400 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"hide bounding box",strokeWidth:2,onClick:()=>{F().getSceneController().clearModelGroup("BBOX"+i),F().forceRenderNextFrame()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})}),d.jsx("div",{className:"flex flex-1"}),d.jsx("div",{className:"flex items-center",children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-red-500 hover:text-red-400 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.removeBoundingFilter(i,r),F().getSceneController().clearModelGroup("BBOX"+i),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),d.jsxs("div",{className:"flex text-xs",children:[d.jsxs("div",{className:"p-1 ml-1 flex-1 ",children:[d.jsx("div",{className:"underline",children:"Min"}),d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"flex text-gray-300 w-5 font-semibold",children:"W:"}),d.jsx("input",{value:t.min.x,onChange:o=>{var u,h;const a=(h=(u=o==null?void 0:o.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);c.x=a,e.updateBoundingFilter(i,r,{max:l,min:c}),mu(i,r),e.updateUUID()},className:"ml-1 outline-none text-gray-200 text-xs p-[2px] max-h-5 bg-gray-800 border-b border-dashed border-gray-700 placeholder-gray-600 w-16",placeholder:"you need to add filter text"}),d.jsx(Rh,{type:"minX",index:r,filterIndex:i})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"flex text-gray-300 w-5 font-semibold",children:"S:"}),d.jsx("input",{value:t.min.y,onChange:o=>{var u,h;const a=(h=(u=o==null?void 0:o.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);c.y=a,e.updateBoundingFilter(i,r,{max:l,min:c}),mu(i,r),e.updateUUID()},className:"ml-1 outline-none text-gray-200 text-xs p-[2px] max-h-5 bg-gray-800 border-b border-dashed border-gray-700 placeholder-gray-600 w-16",placeholder:"you need to add filter text"}),d.jsx(Rh,{type:"minY",index:r,filterIndex:i})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"flex text-gray-300 w-5  font-semibold",children:"D:"}),d.jsx("input",{value:t.min.z,onChange:o=>{var u,h;const a=(h=(u=o==null?void 0:o.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);c.z=a,e.updateBoundingFilter(i,r,{max:l,min:c}),mu(i,r),e.updateUUID()},className:"ml-1 outline-none text-gray-200 text-xs p-[2px] max-h-5 bg-gray-800 border-b border-dashed border-gray-700 placeholder-gray-600 w-16",placeholder:"you need to add filter text"}),d.jsx(Rh,{type:"minZ",index:r,filterIndex:i})]})]})]}),d.jsxs("div",{className:"p-1 flex-1",children:[d.jsx("div",{className:"underline",children:"Max"}),d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("div",{className:"flex items-center ",children:[d.jsx("div",{className:"flex text-gray-300 w-5  font-semibold",children:"E:"}),d.jsx("input",{value:t.max.x,onChange:o=>{var u,h;const a=(h=(u=o==null?void 0:o.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);l.x=a,e.updateBoundingFilter(i,r,{max:l,min:c}),mu(i,r),e.updateUUID()},className:"ml-1 outline-none text-gray-200 text-xs p-[2px] max-h-5 bg-gray-800 border-b border-dashed border-gray-700 placeholder-gray-600 w-16",placeholder:"you need to add filter text"}),d.jsx(Rh,{type:"maxX",index:r,filterIndex:i})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"flex text-gray-300 w-5  font-semibold",children:"N:"}),d.jsx("input",{value:t.max.y,onChange:o=>{var u,h;const a=(h=(u=o==null?void 0:o.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);l.y=a,e.updateBoundingFilter(i,r,{max:l,min:c}),mu(i,r),e.updateUUID()},className:"ml-1 outline-none text-gray-200 text-xs p-[2px] max-h-5 bg-gray-800 border-b border-dashed border-gray-700 placeholder-gray-600 w-16",placeholder:"you need to add filter text"}),d.jsx(Rh,{type:"maxY",index:r,filterIndex:i})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("div",{className:"flex text-gray-300 w-5  font-semibold",children:"U:"}),d.jsx("input",{value:t.max.z,onChange:o=>{var u,h;const a=(h=(u=o==null?void 0:o.nativeEvent)==null?void 0:u.target)==null?void 0:h.value,l=structuredClone(e.currentSet.filter[i][r].max),c=structuredClone(e.currentSet.filter[i][r].min);l.z=a,e.updateBoundingFilter(i,r,{max:l,min:c}),mu(i,r),e.updateUUID()},className:"ml-1 outline-none text-gray-200 text-xs p-[2px] max-h-5 bg-gray-800 border-b border-dashed border-gray-700 placeholder-gray-600 w-16",placeholder:"you need to add filter text"}),d.jsx(Rh,{type:"maxZ",index:r,filterIndex:i})]})]})]})]}),d.jsxs("div",{className:"flex items-center mt-2 justify-center",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500 hover:text-indigo-300 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.filterPushDown(i,r),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500 hover:text-indigo-300 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.filterPushUp(i,r),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]})]},r)}function rhe(n){const e=Ot(),t=n.rowNo,r=n.filterIndex,i=n.row,s={display:t===0?"none":""};return d.jsxs("div",{className:"flex flex-col m-1 border border-gray-900/50 ",children:[d.jsx("div",{className:"flex mb-2",children:d.jsxs("div",{className:"flex flex-col text-xs",children:[d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-14 ml-1 mt-1",children:"Type:"}),d.jsx("div",{className:"ml-1 mt-1 font-semibold",children:d.jsx(ed,{selected:{id:n.row.type,label:n.row.type},list:["Standard"].map(o=>({id:o,label:o})),onChange:o=>{switch((o==null?void 0:o.label)||"Standard"){case"Standard":e.setAsStandardFilter(r,t);break;case"Boundingbox":e.setAsBoundingboxFilter(r,t);break}e.updateUUID()},onDisplayValue:o=>(o==null?void 0:o.label)||"Standard"})})]}),d.jsxs("div",{className:"flex",style:s,children:[d.jsx("span",{className:"text-gray-300 w-14 ml-1 mt-1",children:"Action:"}),d.jsx("div",{className:"ml-1 mt-1 font-semibold",children:d.jsx(ed,{selected:{id:i.filtertype,label:i.filtertype},list:["Append","Remove","Keep"].map(o=>({id:o,label:o})),onChange:o=>{const a=(o==null?void 0:o.label)||"Append";e.setFilterType(r,t,a),e.updateUUID()},onDisplayValue:o=>(o==null?void 0:o.label)||"Append"})})]})]})}),d.jsx("span",{className:"text-gray-300 w-14 m-1 text-xs",children:"Expressions:"}),i.expression.map((o,a)=>d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"ml-1 mt-1 font-semibold max-w-[3rem]",children:d.jsx(ed,{selected:{id:o.operator,label:o.operator},list:["Equal","Contains","In"].map(l=>({id:l,label:l})),onChange:l=>{const c=(l==null?void 0:l.label)||"Equal";e.setExpressionOperator(r,t,a,c),e.updateUUID()},onDisplayValue:l=>(l==null?void 0:l.label)||"Equal"})}),o.operator==="In"?d.jsx("textarea",{value:o.input,onChange:l=>{var u,h;const c=(h=(u=l==null?void 0:l.nativeEvent)==null?void 0:u.target)==null?void 0:h.value;e.setExpressionValue(r,t,a,c),e.updateUUID()},className:"flex-1 ml-1 outline-none text-gray-200 scrollbar text-xs p-[2px] bg-gray-800 border-b border-dashed border-gray-700 placeholder-gray-600",placeholder:"you can paste rows from excel here"}):d.jsx("input",{value:o.input,onChange:l=>{var u,h;const c=(h=(u=l==null?void 0:l.nativeEvent)==null?void 0:u.target)==null?void 0:h.value;e.setExpressionValue(r,t,a,c),e.updateUUID()},className:"flex-1 ml-1 outline-none text-gray-200 text-xs p-[2px] max-h-5 bg-gray-800 border-b border-dashed border-gray-700 placeholder-gray-600",placeholder:"you need to add filter text"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-red-500 m-auto ml-5 mr-2  hover:text-red-400 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.removeExpression(r,t,a),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})]},`${t}-${a}`)),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute bottom-1 left-1 text-gray-700"}),d.jsxs("div",{className:"flex items-center mt-2 justify-center",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500 hover:text-indigo-300 cursor-pointer  ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.filterPushDown(r,t),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5  text-indigo-500 hover:text-indigo-300 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{const o={input:"",operator:"Contains"};e.addExpression(r,t,o),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-indigo-500 hover:text-indigo-300 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{e.filterPushUp(r,t),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})})]})]})]},t)}function ihe(n){const e=Ot();return d.jsxs("div",{className:"flex flex-col m-2",children:[d.jsxs("div",{className:"flex p-2 text-gray-400 sticky top-0 bg-gray-700 z-10 shadow",children:[d.jsxs("div",{className:"underline flex-1",children:["Filter no: ",n.index+1]}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 m-1 text-red-500 hover:text-red-400 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:()=>{e.removeFilter(n.index)},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 m-1 text-indigo-500 hover:text-indigo-300 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:()=>{const t={filtertype:"Append",max:{x:1,y:1,z:1},min:{x:1,y:1,z:1},type:"Standard",grouptype:"Or",expression:[{input:"",operator:"Contains"}],uuid:gr()};e.addSubFilter(n.index,t),e.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})})]}),d.jsx("div",{className:"flex flex-col ml-3",children:e.currentSet.filter[n.index].map((t,r)=>t.type==="Boundingbox"?d.jsx(nhe,{row:t,filterIndex:n.index,rowNo:r},r):d.jsx(rhe,{row:t,filterIndex:n.index,rowNo:r},r))})]})}function she(){return d.jsx("button",{className:"left-1 bg-green-700 p-1 text-xs max-w-[7rem] hover:bg-green-600",onClick:async()=>{var e;const n=Ot.getState();if(n.currentSet.filter.length){Gv(),it.setState({loadingData:!0,dialogHeader:"please wait",dialogContent:"searching for elements"});const t=((e=ke.getState().selectedProject)==null?void 0:e.project_key)||"unknown";n.setProjectKey(t);const r=wi.getkeys().length>0,i=await ae.filter_geometry(n.currentSet.filter,[]);await ae.selection_clear(!0),wi.clear(),wi.add(i),await wi.load(!1,r),await ae.filter_geometry([],n.currentSet.colorOverride),await ae.selection_append(),F().getSceneController().updateBB(),F().forceRenderNextFrame()}else Kn.setState({activated:!0,message:"no filters set"})},children:"Generate"})}function ohe(){const n=Ot();return d.jsxs("div",{style:{minHeight:"0px"},className:"flex flex-col flex-grow",children:[d.jsx("div",{className:"m-2 flex",children:d.jsx(she,{})}),d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"p-2 underline",children:"Filters:"}),d.jsx("div",{className:"flex-1"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 m-1 text-red-500 hover:text-red-400 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:()=>{n.removeAllFilters()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 m-1 text-indigo-500 hover:text-indigo-300 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:()=>{n.addFilter(),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})})]}),d.jsx("div",{className:"flex flex-col overflow-auto scrollbar border-t-2 border-b border-gray-900/50 shadow-inner",children:n.currentSet.filter.map((e,t)=>d.jsx(ihe,{index:t},e[0].uuid))})]})}function ahe(){const n=Ot(),e=async()=>{const i=new N,s=new N;F().getActiveControls().getPosition(i),F().getActiveControls().getTarget(s);const o=F().getActiveCamera().type,a=F().getActiveCamera().zoom,l={uuid:gr(),name:`${n.currentSet.viewPoints.length+1}`,z_plane_visible:De.getState().z_plane_visible,y_plane_visible:De.getState().y_plane_visible,x_plane_visible:De.getState().x_plane_visible,z_plane_enable:De.getState().z_plane_enable,y_plane_enable:De.getState().y_plane_enable,x_plane_enable:De.getState().x_plane_enable,z_plane_neg:De.getState().z_plane_neg,y_plane_neg:De.getState().y_plane_neg,x_plane_neg:De.getState().x_plane_neg,z_plane_offset:De.getState().z_plane_offset,y_plane_offset:De.getState().y_plane_offset,x_plane_offset:De.getState().x_plane_offset,boxClippingEnabled:Xe.getState().enabled,boxClippingMaxX:Xe.getState().maxX,boxClippingMaxY:Xe.getState().maxY,boxClippingMaxZ:Xe.getState().maxZ,boxClippingMinX:Xe.getState().minX,boxClippingMinY:Xe.getState().minY,boxClippingMinZ:Xe.getState().minZ,selectedFullName:"",comment:"",links:[],controllerPosition:[i.x,i.y,i.z],controllerTarget:[s.x,s.y,s.z],cameraType:o,zoom:a};n.addViewPoint(l),n.updateUUID()},t=async i=>{const s=n.currentSet.viewPoints[i];F().setCameraMode(s.cameraType==="PerspectiveCamera"?"3D":"2D"),De.setState({z_plane_visible:s.z_plane_visible,y_plane_visible:s.y_plane_visible,x_plane_visible:s.x_plane_visible,z_plane_enable:s.z_plane_enable,y_plane_enable:s.y_plane_enable,x_plane_enable:s.x_plane_enable,z_plane_neg:s.z_plane_neg,y_plane_neg:s.y_plane_neg,x_plane_neg:s.x_plane_neg,z_plane_offset:s.z_plane_offset,y_plane_offset:s.y_plane_offset,x_plane_offset:s.x_plane_offset}),s.boxClippingEnabled?Xe.setState({enabled:!0,transformHelperEnabled:!1,minX:s.boxClippingMinX,minY:s.boxClippingMinY,minZ:s.boxClippingMinZ,maxX:s.boxClippingMaxX,maxY:s.boxClippingMaxY,maxZ:s.boxClippingMaxZ}):Xe.setState({enabled:!1,transformHelperEnabled:!1}),Bt.updateClipShader(),Bt.updateClippingHelper(),F().getActiveControls().smoothTime=.5,F().getActiveControls().saveState(),s.cameraType!=="PerspectiveCamera"&&s.zoom!==void 0&&(F().getActiveControls()._zoomEnd=s.zoom);const o=F().getActiveControls().setLookAt(s.controllerPosition[0],s.controllerPosition[1],s.controllerPosition[2],s.controllerTarget[0],s.controllerTarget[1],s.controllerTarget[2],!0);let a=null;s.selectedFullName&&(a=ae.get_ids_from_fullnames([s.selectedFullName]).then(async l=>{if(l.length){await ae.selection_clear(!1),await ae.treeview_collapse(),await ae.selection_add(l),await ae.treeview_expand_from_id(l[0]),await ae.selection_append();const c=ae.getRowOfKey(l[0]);Mt.getState().updateToggel(c),ld(l[0],!1)}})),await Promise.all([o,a]),F().getActiveControls().smoothTime=1,F().getActiveControls().saveState()},r=i=>{const s=new N,o=new N;F().getActiveControls().getPosition(s),F().getActiveControls().getTarget(o);const a=F().getActiveCamera().type,l=F().getActiveCamera().zoom,c={uuid:gr(),z_plane_visible:De.getState().z_plane_visible,y_plane_visible:De.getState().y_plane_visible,x_plane_visible:De.getState().x_plane_visible,z_plane_enable:De.getState().z_plane_enable,y_plane_enable:De.getState().y_plane_enable,x_plane_enable:De.getState().x_plane_enable,z_plane_neg:De.getState().z_plane_neg,y_plane_neg:De.getState().y_plane_neg,x_plane_neg:De.getState().x_plane_neg,z_plane_offset:De.getState().z_plane_offset,y_plane_offset:De.getState().y_plane_offset,x_plane_offset:De.getState().x_plane_offset,boxClippingEnabled:Xe.getState().enabled,boxClippingMaxX:Xe.getState().maxX,boxClippingMaxY:Xe.getState().maxY,boxClippingMaxZ:Xe.getState().maxZ,boxClippingMinX:Xe.getState().minX,boxClippingMinY:Xe.getState().minY,boxClippingMinZ:Xe.getState().minZ,controllerPosition:[s.x,s.y,s.z],controllerTarget:[o.x,o.y,o.z],cameraType:a,zoom:l,links:[]};n.updateViewpoint(i,c),n.updateUUID()};return d.jsxs("div",{style:{minHeight:"0px"},className:"flex flex-col flex-grow",children:[d.jsxs("div",{className:"flex mt-5",children:[d.jsx("div",{className:"p-2 underline",children:"ViewPoints:"}),d.jsx("div",{className:"flex-1"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 m-1 text-indigo-500 hover:text-indigo-300 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Add group",strokeWidth:2,onClick:()=>e(),children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})})]}),d.jsx("div",{className:"flex flex-col flex-grow overflow-y-auto scrollbar border-t-2 border-gray-900/50 shadow-inner",children:n.currentSet.viewPoints.map((i,s)=>{let o="flex flex-col border-b border-gray-900";return s%2===1&&(o="flex flex-col border-b border-gray-900 bg-gray-700/20"),d.jsxs("div",{className:o,children:[d.jsxs("div",{className:"flex mb-2 border-b border-gray-700/50",children:[d.jsxs("div",{className:"flex  ",children:[d.jsxs("div",{className:"m-2 text-lg text-gray-500",children:["(",s+1,")"]}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-orange-700 rotate-45 m-2 hover:text-orange-500 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Load viewpoint",strokeWidth:2,onClick:()=>t(s),children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 ml-10 m-2 text-orange-500 hover:text-orange-300 cursor-pointer  ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,"data-tooltip":"Push up",onClick:()=>{n.pushUpViewpoint(s),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6  m-2 text-orange-500 hover:text-orange-300 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,"data-tooltip":"Push down",onClick:()=>{n.pushDownViewpoint(s),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),d.jsx("div",{className:"flex-1"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-orange-600 hover:text-orange-400 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Update controller position/rotation center",strokeWidth:2,onClick:()=>r(s),children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-600 hover:text-red-400 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Delete viewpoint",strokeWidth:2,onClick:()=>{n.deleteViewpoint(s),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})]}),d.jsxs("div",{className:"flex flex-col flex-1 text-xs ml-2",children:[d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-16 font-semibold ",children:"Name:"}),d.jsx("input",{value:i.name,onChange:a=>{var c;const l=(c=a==null?void 0:a.target)==null?void 0:c.value;n.updateViewpointName(s,l),n.updateUUID()},className:"flex-1 ml-1 outline-none text-gray-200 p-[2px] max-h-5 bg-transparent border-b border-dashed border-gray-700 placeholder-gray-600",placeholder:"you need to add filter text"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-16  font-semibold",children:"Item:"}),d.jsx("input",{value:i.selectedFullName,onChange:a=>{var c;const l=(c=a==null?void 0:a.target)==null?void 0:c.value;n.updateViewpointSelect(s,l),n.updateUUID()},className:"flex-1 ml-1 outline-none text-gray-200  p-[2px] max-h-5 bg-transparent border-b border-dashed border-gray-700 placeholder-gray-600",placeholder:"add name of item to select"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-16  mt-2 font-semibold",children:"Comment:"}),d.jsx("textarea",{value:i.comment,onChange:a=>{var c;const l=(c=a==null?void 0:a.target)==null?void 0:c.value;n.updateViewpointComment(s,l),n.updateUUID()},className:"mt-1 scrollbar min-h-[5rem] resize-none flex-1 ml-1 outline-none text-gray-200 text-xs p-[2px] max-h-5 bg-transparent border-b border-dashed border-gray-700 placeholder-gray-600",placeholder:"your comment"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 mt-2 font-semibold",children:"Links:"}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4  text-indigo-500 hover:text-indigo-300 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{const a={label:"",url:""};n.addLink(a,s),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),d.jsx("div",{className:"flex flex-col",children:i.links.length===0?null:i.links.map((a,l)=>d.jsx("div",{className:"flex flex-col mt-2",children:d.jsxs("div",{className:"flex ",children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-red-500 hover:text-red-400 mt-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,onClick:()=>{n.deleteLink(s,l),n.updateUUID()},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),d.jsxs("div",{className:"flex flex-col ml-2 flex-1",children:[d.jsxs("label",{className:"flex",children:[d.jsx("div",{className:"text-gray-300 w-16 text-xs ",children:"Label:"}),d.jsx("input",{value:a.label,onChange:c=>{var h;const u=(h=c==null?void 0:c.target)==null?void 0:h.value;n.updateLinkLabel(s,l,u),n.updateUUID()},className:"flex-1 ml-1 outline-none text-gray-200  p-[2px] max-h-5 bg-transparent border-b border-dashed border-gray-700 placeholder-gray-600",placeholder:"link label"})]}),d.jsxs("label",{className:"flex",children:[d.jsx("div",{className:"text-gray-300 w-16 text-xs ",children:"Url:"}),d.jsx("input",{value:a.url,onChange:c=>{var h;const u=(h=c==null?void 0:c.target)==null?void 0:h.value;n.updateLinkUrl(s,l,u),n.updateUUID()},className:"flex-1 ml-1 outline-none text-gray-200  p-[2px] max-h-5 bg-transparent border-b border-dashed border-gray-700 placeholder-gray-600 mb-2",placeholder:"link url"})]})]})]})},l))})]})]},i.uuid)})})]})}function lhe(){const n=Ot();return n.activeTab==="FILTER"?d.jsx(ohe,{}):n.activeTab==="COLOR"?d.jsx("div",{className:"flex flex-col overflow-auto scrollbar",children:d.jsx(the,{})}):n.activeTab==="VIEWPOINT"?d.jsx(ahe,{}):null}function NA(){return Ot().editMode?d.jsx("svg",{onClick:async()=>{Ot.setState({editMode:!1})},xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500 hover:text-indigo-300 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Goto View Mode",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}):d.jsx("svg",{onClick:async()=>{Ot.setState({editMode:!0})},xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500 hover:text-indigo-300 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Goto Edit Mode",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}function U3(){return Ot().viewModeListMode?d.jsx("svg",{onClick:async()=>{Ot.setState({viewModeListMode:!1})},xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500 hover:text-indigo-300 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Goto View Mode",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"})}):d.jsx("svg",{onClick:async()=>{Ot.setState({viewModeListMode:!0})},xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-indigo-500 hover:text-indigo-300 m-2 cursor-pointer ",fill:"none",viewBox:"0 0 24 24","data-tooltip":"Goto Edit Mode",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})}function F3(n){return n.view?d.jsx(d.Fragment,{children:d.jsxs("div",{className:"flex flex-col flex-1 text-xs ml-2",children:[d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-16 ",children:"Name:"}),d.jsx("input",{value:n.view.name,readOnly:!0,className:"flex-1 ml-1 outline-none text-gray-200 p-[2px] max-h-5 bg-transparent border-b border-dashed border-gray-700 placeholder-gray-600",placeholder:"you need to add filter text"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-16 s",children:"Item:"}),d.jsx("input",{value:n.view.selectedFullName,readOnly:!0,className:"flex-1 ml-1 outline-none text-gray-200  p-[2px] max-h-5 bg-transparent border-b border-dashed border-gray-700 placeholder-gray-600",placeholder:"add name of item to select"})]}),d.jsxs("div",{className:"flex",children:[d.jsx("span",{className:"text-gray-300 w-16  mt-2",children:"Comment:"}),d.jsx("textarea",{value:n.view.comment,readOnly:!0,className:"mt-1 scrollbar min-h-[5rem] resize-none flex-1 ml-1 outline-none text-gray-200 text-xs p-[2px] max-h-5 bg-transparent border-b border-dashed border-gray-700 placeholder-gray-600",placeholder:"your comment"})]}),d.jsx("div",{className:"flex",children:d.jsx("span",{className:"text-gray-300  mt-2",children:n.view.links.length===0?null:"Links:"})}),d.jsx("div",{className:"flex flex-col",children:n.view.links.length===0?null:n.view.links.map((e,t)=>d.jsx("div",{className:"flex flex-col",children:d.jsx("div",{className:"flex items-center mr-3",children:d.jsxs("div",{className:"flex  m-2 ",children:[d.jsxs("span",{className:"mr-2",children:[t+1,":"]}),d.jsx("a",{target:"_blank",rel:"noreferrer",href:e.url,onClick:r=>{r.preventDefault();const i=e.url.replace("web3dBroadcastChannel","oldBC").split("/"),s="web-report.apps.aibel.net",o="web-report.tapps.aibel.net",a=i[2]&&i[2].toLowerCase();if(location.host.includes("localhost")||a===s||a===o){i.shift(),i.shift(),i[0]=`${location.origin}/tool-webreport`;const c=new URLSearchParams;c.append("web3dBroadcastChannel",rS),e.url.includes("?")?i[i.length-1]=i[i.length-1]+`&${c.toString()}`:i[i.length-1]=i[i.length-1]+`#?${c.toString()}`}const l=i.join("/");window.open(l)},className:"visited:bg-indigo-200 text-indigo-400 hover:visited:bg-orange-500",children:e.label})]})})},t))})]})}):null}function J6(n){var s,o;const e=Ot(),[t,r]=ee.useState(0);async function i(a){r(a);const l=e.currentSet.viewPoints[a];F().setCameraMode(l.cameraType==="PerspectiveCamera"?"3D":"2D"),F().fitModelToCanvas(),F().forceRenderNextFrame(),De.setState({z_plane_visible:l.z_plane_visible,y_plane_visible:l.y_plane_visible,x_plane_visible:l.x_plane_visible,z_plane_enable:l.z_plane_enable,y_plane_enable:l.y_plane_enable,x_plane_enable:l.x_plane_enable,z_plane_neg:l.z_plane_neg,y_plane_neg:l.y_plane_neg,x_plane_neg:l.x_plane_neg,z_plane_offset:l.z_plane_offset,y_plane_offset:l.y_plane_offset,x_plane_offset:l.x_plane_offset}),l.boxClippingEnabled?Xe.setState({enabled:!0,transformHelperEnabled:!1,minX:l.boxClippingMinX,minY:l.boxClippingMinY,minZ:l.boxClippingMinZ,maxX:l.boxClippingMaxX,maxY:l.boxClippingMaxY,maxZ:l.boxClippingMaxZ}):Xe.setState({enabled:!1,transformHelperEnabled:!1}),Bt.updateClipShader(),Bt.updateClippingHelper(),F().getActiveControls().smoothTime=.25,F().getActiveControls().saveState(),l.cameraType!=="PerspectiveCamera"&&l.zoom!==void 0&&(F().getActiveControls()._zoomEnd=l.zoom);const c=F().getActiveControls().setLookAt(l.controllerPosition[0],l.controllerPosition[1],l.controllerPosition[2],l.controllerTarget[0],l.controllerTarget[1],l.controllerTarget[2],!0);let u=null;l.selectedFullName&&(u=ae.get_ids_from_fullnames([l.selectedFullName]).then(async h=>{if(h.length){await ae.selection_clear(!1),await ae.treeview_collapse(),await ae.selection_add(h),await ae.treeview_expand_from_id(h[0]),await ae.selection_append();const f=ae.getRowOfKey(h[0]);Mt.getState().updateToggel(f),ld(h[0],!1)}})),await Promise.all([c,u]),F().getActiveControls().smoothTime=0,F().getActiveControls().saveState()}return e.viewModeListMode?d.jsxs("div",{style:{minHeight:"0px"},className:"flex flex-col flex-grow",children:[d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"p-2 underline",children:"ViewPoints:"}),d.jsx("div",{className:"flex-1"}),d.jsx(U3,{}),d.jsx(NA,{})]}),d.jsx("div",{className:"flex flex-col flex-grow overflow-y-auto  scrollbar border-t-2 border-gray-900/50 shadow-inner",children:e.currentSet.viewPoints.map((a,l)=>{let c="flex flex-col border-b border-gray-900";return l%2===1&&(c="flex flex-col border-b border-gray-900 bg-gray-700/20"),d.jsxs("div",{className:c,children:[d.jsxs("div",{className:"flex border-b mb-2 border-gray-700/50",children:[d.jsxs("div",{className:"m-2 text-lg text-gray-500",children:["(",l+1,")"]}),d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-orange-700 rotate-45 m-2 ml-2 hover:text-orange-500 cursor-pointer ",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Load viewpoint",strokeWidth:2,onClick:async()=>{i(l)},children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})]}),d.jsx(F3,{view:a})]},a.uuid)})})]}):d.jsxs("div",{style:{minHeight:"0px"},className:"flex flex-col flex-grow",children:[d.jsxs("div",{className:"flex",children:[d.jsx("div",{className:"p-2 underline",children:"ViewPoints:"}),d.jsx("div",{className:"flex-1"}),n.simplified?null:d.jsx(U3,{}),n.simplified?null:d.jsx(NA,{})]}),d.jsxs("div",{className:"flex flex-col flex-grow overflow-y-auto  scrollbar border-t-2 border-gray-900/50 shadow-inner",children:[d.jsxs("div",{className:"flex m-2",children:[d.jsx("button",{className:"p-1 bg-indigo-500 m-2 flex-1",onClick:()=>{var l,c,u;if(!((c=(l=e.currentSet)==null?void 0:l.viewPoints)!=null&&c.length))return;const a=((u=e.currentSet)==null?void 0:u.viewPoints.length)-1;i(t===0?a:t-1)},children:"Prev"}),d.jsx("div",{className:"p-1 m-2 flex-1 text-gray-200 text-center",children:d.jsxs("span",{className:"font-semibold text-xl",children:[t+1," / ",((s=e.currentSet)==null?void 0:s.viewPoints.length)||""]})}),d.jsx("button",{className:"p-1 bg-indigo-500 m-2 flex-1",onClick:()=>{var l,c,u;if(!((c=(l=e.currentSet)==null?void 0:l.viewPoints)!=null&&c.length))return;const a=((u=e.currentSet)==null?void 0:u.viewPoints.length)-1;i(t===a?0:t+1)},children:"Next"})]}),d.jsx(F3,{view:(o=e.currentSet)==null?void 0:o.viewPoints[t]})]})]})}const che=Mn.memo(function(){return Ot().editMode?d.jsxs("div",{className:"w-full h-full flex flex-col flex-grow",children:[d.jsx(wue,{}),d.jsxs("div",{className:"flex mt-3",children:[d.jsx("div",{className:"flex-1 m-2"}),d.jsx(NA,{}),AR()?d.jsx(gue,{}):null,d.jsx(yue,{}),d.jsx(_ue,{})]}),d.jsx(lhe,{})]}):d.jsx("div",{className:"w-full h-full flex flex-col flex-grow z-50",children:d.jsx(J6,{})})});let Om={height:500,width:350,bottom:200,right:0,initLoaded:!1,closed:!0};function j3(){const n=Ot();return d.jsx(OS,{uniqueName:"SetEditor",adjustOnLoad:!1,title:"Set Editor",isOpen:n.isOpen,width:Om.width,height:Om.height,bottom:Om.bottom,onClose:e=>{Om={...Om,...e},Ot.setState({isOpen:!1}),Mt.getState().updateToggel()},children:d.jsx(che,{})})}function uhe(){const n=We();return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"text-yellow-500 flex ml-1 mt-1 mb-1 sticky top-0 bg-gray-800 border-b border-gray-700",children:["Scene",d.jsx("svg",{"data-tooltip":["Basic scene settings"].join(`
`),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:.5,stroke:"currentColor",className:"w-3 h-3 m-auto ml-2",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})})]}),d.jsxs("label",{className:"p-1 mt-2 ml-2 flex flex-col",children:[d.jsx("span",{className:"flex",children:"Background Color:"}),d.jsx("div",{className:"flex p-1",children:d.jsx("input",{value:n.backgroundColor,type:"color",onChange:e=>{li.flushSync(()=>{We.setState({backgroundColor:e.currentTarget.value})}),tn();const t=F().getSceneController().currentScene();t.background=new at(We.getState().backgroundColor),F().forceRenderNextFrame()}})})]}),d.jsxs("div",{className:"p-1 flex flex-col ml-2",children:[d.jsx("span",{className:"flex",children:"AmbientLight:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"text-black p-1 mr-2 ml-2 w-12",type:"number",step:.1,value:n.lightAmbient,onChange:e=>{if(e.currentTarget.valueAsNumber>=.1){We.setState({lightAmbient:e.currentTarget.valueAsNumber});const t=F().getSceneController();t.__ambientLight.intensity=We.getState().lightAmbient,tn(),F().forceRenderNextFrame()}}}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:()=>{if(n.lightAmbient>=.2){We.setState({lightAmbient:parseFloat((n.lightAmbient-.1).toFixed(1))});const e=F().getSceneController();e.__ambientLight.intensity=We.getState().lightAmbient,tn(),F().forceRenderNextFrame()}},children:"- 0.1"}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:()=>{We.setState({lightAmbient:parseFloat((n.lightAmbient+.1).toFixed(1))});const e=F().getSceneController();e.__ambientLight.intensity=We.getState().lightAmbient,tn(),F().forceRenderNextFrame()},children:"+ 0.1"})]})]}),d.jsxs("div",{className:"p-1 flex flex-col ml-2",children:[d.jsx("span",{className:"flex",children:"PointLight:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"text-black p-1 mr-2 ml-2 w-12",type:"number",step:.1,value:n.lightPoint,onChange:e=>{if(e.currentTarget.valueAsNumber>=.1){We.setState({lightPoint:e.currentTarget.valueAsNumber});const t=F().getSceneController();t.__pointLight.intensity=We.getState().lightPoint,tn(),F().forceRenderNextFrame()}}}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:()=>{if(n.lightPoint>=.2){We.setState({lightPoint:parseFloat((n.lightPoint-.1).toFixed(1))});const e=F().getSceneController();e.__pointLight.intensity=We.getState().lightPoint,tn(),F().forceRenderNextFrame()}},children:"- 0.1"}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:()=>{We.setState({lightPoint:parseFloat((n.lightPoint+.1).toFixed(1))});const e=F().getSceneController();e.__pointLight.intensity=We.getState().lightPoint,tn(),F().forceRenderNextFrame()},children:"+ 0.1"})]})]})]})}function dhe(){const n=We();return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"text-yellow-500 flex ml-1 mt-1 mb-1 sticky top-0 bg-gray-800 border-b border-gray-700",children:["Info Controller",d.jsx("svg",{"data-tooltip":["Controller - Forward speed","How fast you move forward, default = 0.7","Forward min distance:","When this is to low, it will feel like controller is hanging when trying to move past/over a orbit point, default is 5"].join(`
`),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:.5,stroke:"currentColor",className:"w-3 h-3 m-auto ml-2",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})})]}),d.jsxs("div",{className:"p-1 flex flex-col ml-2",children:[d.jsx("span",{className:"flex",children:"Controller - Forward speed:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"text-black p-1 mr-2 ml-2 w-12",type:"number",step:.1,value:n.controllerDollySpeed,onChange:e=>{e.currentTarget.valueAsNumber>=.1&&(We.setState({controllerDollySpeed:e.currentTarget.valueAsNumber}),F().__controls3d.dollySpeed=e.currentTarget.valueAsNumber,F().__controls3d.saveState(),tn())}}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:()=>{n.controllerDollySpeed>=.2&&(We.setState({controllerDollySpeed:parseFloat((n.controllerDollySpeed-.1).toFixed(1))}),F().__controls3d.dollySpeed=n.controllerDollySpeed-.1,F().__controls3d.saveState(),tn())},children:"- 0.1"}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:()=>{We.setState({controllerDollySpeed:parseFloat((n.controllerDollySpeed+.1).toFixed(1))}),F().__controls3d.dollySpeed=n.controllerDollySpeed+.1,F().__controls3d.saveState(),tn()},children:"+ 0.1"})]})]}),d.jsxs("div",{className:"p-1 flex flex-col ml-2",children:[d.jsx("span",{className:"flex",children:"Controller - Forward min distance:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"text-black p-1 mr-2 ml-2 w-12",type:"number",step:.1,value:n.controllerDollyMinDistance,onChange:e=>{e.currentTarget.valueAsNumber>=.1&&(We.setState({controllerDollyMinDistance:e.currentTarget.valueAsNumber}),F().__controls3d.minDistance=e.currentTarget.valueAsNumber,F().__controls3d.saveState(),tn())}}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:()=>{n.controllerDollyMinDistance>=.2&&(We.setState({controllerDollyMinDistance:parseFloat((n.controllerDollyMinDistance-.1).toFixed(1))}),F().__controls3d.minDistance=n.controllerDollyMinDistance-.1,F().__controls3d.saveState(),tn())},children:"- 0.1"}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:()=>{We.setState({controllerDollyMinDistance:parseFloat((n.controllerDollyMinDistance+.1).toFixed(1))}),F().__controls3d.minDistance=n.controllerDollyMinDistance+.1,F().__controls3d.saveState(),tn()},children:"+ 0.1"})]})]})]})}function hhe(){const n=We();return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"text-yellow-500 flex ml-1 mt-1 mb-1 sticky top-0 bg-gray-800 border-b border-gray-700",children:["Info Alpahash",d.jsx("svg",{"data-tooltip":["Alphahash is a different type of tranparency","It will give a performance boost, but does not look as good as default with low opacity (<10%)","You can enable antialiasing to make alphahash look better.","Antialiasing can give performance issues on weak hardware. default value is 6","If you plan to use opacity over 10% and on many items you should use alphahash"].join(`
`),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:.5,stroke:"currentColor",className:"w-3 h-3 m-auto ml-2",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})})]}),d.jsxs("label",{className:"p-1 mt-2 ml-2",children:[d.jsx("input",{checked:n.enableAlphaHash,type:"checkbox",onChange:()=>{const e=!n.enableAlphaHash;li.flushSync(()=>{We.setState({enableAlphaHash:e})}),tn();const t=F().getSceneController();t.getMeshGroups().forEach(i=>{t.getMeshes(i).forEach(o=>{o.children.forEach(a=>{const l=a;l.material.opacity<1&&(l.material=lp(l.material.color,l.material.opacity,!1),l.$backupMaterial=l.material)})})}),F().forceRenderNextFrame()}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Enable Alphahash"})]}),d.jsxs("label",{className:"p-1 mt-2 ml-2",children:[d.jsx("input",{checked:n.enableAntiAliasing,type:"checkbox",onChange:()=>{We.setState({enableAntiAliasing:!n.enableAntiAliasing}),F().forceRenderNextFrame(),tn()}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Enable Antialiasing (if Alphahash enabled)"})]}),d.jsxs("div",{className:"p-1 flex flex-col ml-2",children:[d.jsx("span",{className:"flex",children:"Antialiasing sampling:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"text-black p-1 mr-2 ml-2 w-12",type:"number",step:1,value:n.enableAntiAliasingSamples,onChange:e=>{e.currentTarget.valueAsNumber>=1&&(We.setState({enableAntiAliasingSamples:e.currentTarget.valueAsNumber}),tn())}}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:()=>{n.enableAntiAliasingSamples>=1&&(We.setState({enableAntiAliasingSamples:parseFloat((n.enableAntiAliasingSamples-1).toFixed(1))}),tn())},children:"- 1"}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:()=>{We.setState({enableAntiAliasingSamples:parseFloat((n.enableAntiAliasingSamples+1).toFixed(1))}),tn()},children:"+ 1"})]})]})]})}function fhe(){const n=We();return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"text-yellow-500 flex ml-1 mt-1 mb-1 sticky top-0 bg-gray-800 border-b border-gray-700",children:["Geometry Culling (preview feature)",d.jsx("svg",{"data-tooltip":["Preview feature!","Atm transformations support is limited, like occlusion culling","Tries to render less triangles. Geometry will pop inn/out more.","It can give a performance boost in many cases if its not a cad pc.","You can set distance to keep everything","You can adjust level, only affect parts outside keep distance","Occlusion culling can make it worse","You should enable alpha hash and not Antialiasing when using this.","As additional option, you can add ?skip-alias for more performance, you need to reload page when this is added to url."].join(`
`),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:.5,stroke:"currentColor",className:"w-3 h-3 m-auto ml-2",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})})]}),d.jsxs("label",{className:"p-1 mt-2 ml-2",children:[d.jsx("input",{checked:n.enableItemCulling,type:"checkbox",onChange:async()=>{We.setState({enableItemCulling:!n.enableItemCulling}),tn(),await Ts(!0)}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Enable culling"})]}),d.jsxs("label",{className:"p-1 mt-2 ml-2",children:[d.jsx("input",{checked:n.occlusionCulling,type:"checkbox",onChange:async()=>{We.setState({occlusionCulling:!n.occlusionCulling}),F().forceRenderNextFrame(),tn(),await Ts(!0)}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Use occlusion culling"})]}),d.jsxs("label",{className:"p-1 mt-2 ml-2",children:[d.jsx("input",{checked:n.skipFustrumCulling,type:"checkbox",onChange:async()=>{We.setState({skipFustrumCulling:!n.skipFustrumCulling}),F().forceRenderNextFrame(),tn(),await Ts(!0)}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Skip frustum Culling"})]}),d.jsxs("div",{className:"p-1 flex flex-col ml-2",children:[d.jsx("span",{className:"flex",children:"Distance to keep:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"text-black p-1 mr-2 ml-2 w-12",type:"number",step:1,value:n.cullingDistance,onChange:async e=>{e.currentTarget.valueAsNumber>=1&&(We.setState({cullingDistance:e.currentTarget.valueAsNumber}),tn(),await Ts(!0))}}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:async()=>{n.cullingDistance>=1&&(We.setState({cullingDistance:parseInt((n.cullingDistance-1).toFixed(1))}),tn(),await Ts(!0))},children:"- 1"}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:async()=>{We.setState({cullingDistance:parseFloat((n.cullingDistance+1).toFixed(1))}),tn(),await Ts(!0)},children:"+ 1"})]})]}),d.jsxs("div",{className:"p-1 flex flex-col ml-2",children:[d.jsx("span",{className:"flex",children:"Size level:"}),d.jsxs("div",{className:"flex p-1",children:[d.jsx("input",{className:"text-black p-1 mr-2 ml-2 w-12",type:"number",step:1,value:n.cullingSize,onChange:async e=>{e.currentTarget.valueAsNumber>=1&&(We.setState({cullingSize:e.currentTarget.valueAsNumber}),tn(),await Ts(!0))}}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:async()=>{n.cullingSize>=1&&(We.setState({cullingSize:parseInt((n.cullingSize-1).toFixed(1))}),tn(),await Ts(!0))},children:"- 1"}),d.jsx("button",{className:"p-1 mr-2 ml-2 bg-indigo-600 hover:bg-indigo-700 w-12",onClick:async()=>{We.setState({cullingSize:parseFloat((n.cullingSize+1).toFixed(1))}),tn(),await Ts(!0)},children:"+ 1"})]})]})]})}function phe(){return d.jsxs("div",{className:"flex flex-1",children:[d.jsx("button",{className:"bg-indigo-600 m-auto p-1 hover:bg-indigo-700",onClick:()=>{We.setState({isOpen:!1})},children:"Close"}),d.jsx("div",{className:"flex-1"}),d.jsx("button",{className:"p-1 bg-gray-600 hover:bg-gray-700",onClick:async()=>{RZ()},children:"Reset all to default"})]})}function mhe(){const n=We();return d.jsxs(d.Fragment,{children:[d.jsxs("label",{className:"p-1 ","data-tooltip":["Dev tool only."].join(`
`),children:[d.jsx("input",{checked:n.isWebGlStatsActive,type:"checkbox",onChange:()=>{const e=!n.isWebGlStatsActive;We.setState({isWebGlStatsActive:!n.isWebGlStatsActive}),e?F().addStats():F().removeStats(),F().forceRenderNextFrame(),tn()}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Show debugging info"})]}),d.jsxs("label",{className:"p-1 ","data-tooltip":["Dev tool only."].join(`
`),children:[d.jsx("input",{checked:n.freezeCurrentCulling,type:"checkbox",onChange:()=>{const e=!n.freezeCurrentCulling;We.setState({freezeCurrentCulling:!n.freezeCurrentCulling}),e?F().addStats():F().removeStats(),F().forceRenderNextFrame(),tn()}}),d.jsx("span",{className:"m-auto ml-2 p-1",children:"Freeze current culling"})]})]})}let Nh={height:550,width:350,bottom:200,right:0,initLoaded:!1,adjustOnLoad:!0,closed:!0};function z3(){const n=We();return d.jsx(OS,{uniqueName:"SettingsDialog",adjustOnLoad:Nh.adjustOnLoad,title:"Settings",isOpen:n.isOpen,width:Nh.width,height:Nh.height,bottom:Nh.bottom,onClose:e=>{Nh={...Nh,...e,adjustOnLoad:!1},We.setState({isOpen:!1})},children:d.jsxs("div",{className:"grid w-full h-full",children:[d.jsxs("div",{className:"flex flex-col overflow-auto scrollbar border-b border-gray-500",children:[d.jsx(uhe,{}),d.jsx(dhe,{}),d.jsx(hhe,{}),d.jsx(fhe,{})]}),d.jsx(mhe,{}),d.jsx(phe,{})]})})}function ghe(){return d.jsx("iframe",{id:"externalFrame",className:"w-full h-full",src:window.useUrl})}function EC(){var t,r;const n=Kn();if(!n.activated)return null;let e=n.message;return typeof n.message!="string"&&(e=(t=n.message)==null?void 0:t.message,typeof((r=n.message)==null?void 0:r.message)!="string"&&(e="unknown, see console",console.log(n.message))),d.jsx("div",{className:"fixed grid w-full h-full items-center justify-center fadeIn z-[8010] bg-gray-50/50",children:d.jsxs("div",{className:"relative block w-96 h-80 bg-gray-800",children:[d.jsx("span",{className:"m-auto block text-center text-2xl  p-2 bg-gray-700 text-white",children:"Error"}),d.jsx("span",{className:"mt-2 m-auto block text-center underline font-semibold text-white",children:n.header||"Error"}),d.jsx("span",{className:"flex-1 m-auto block text-center mt-4 whitespace-pre-line text-white p-1",children:e}),d.jsx("div",{className:"absolute bottom-2 left-0 right-0",children:d.jsx("button",{className:"block m-auto p-2  bg-gray-600 w-28 hover:bg-gray-700",onClick:()=>n.deactivate(),children:"Close"})})]})})}const vhe=localStorage.getItem("web3d-hide-mouse-and-keyboard-page")||"1",_he=!!localStorage.getItem("web3d-hide-mouse-and-keyboard-keys"),$v=Ir(n=>({currentPage:parseInt(vhe),isVisible:!_he,toggleVisibility:()=>{n(e=>{const t=!e.isVisible;return localStorage.setItem("web3d-hide-mouse-and-keyboard-keys",t?"0":"1"),{isVisible:t}})},gotoPrevPage:()=>{n(e=>({currentPage:e.currentPage-1}))},gotoNextPage:()=>{n(e=>({currentPage:e.currentPage+1}))}}));function Dm(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12","data-tooltip":"Show navigation and shortcuts",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})})}let ho=null,B3=[],yv=[],Rw=[];const H3={handleEvent:async n=>{if(Array.isArray(n==null?void 0:n.parentKeys)&&Array.isArray(n==null?void 0:n.parents)){const e=structuredClone(n.parents),t=structuredClone(n.parentKeys);e.shift(),t.shift(),Rw=[],B3=e,B3.reverse(),yv=t,yv.reverse(),ho=n.key}return!0}};async function jS(){if(yv.length&&(ho&&Rw.push(ho),ho=yv.pop(),ho)){const n=ho;await ae.treeview_expand_from_id(n),await ae.selection_add([n]);const e=await ae.getKeyChildrenFromItem(n);await ae.selection_add(e),await ae.selection_append();const t=await ae.getRowOfKey(n);Mt.getState().updateToggel(t)}}async function zS(){if(Rw.length&&(ho&&yv.push(ho),ho=Rw.pop(),ho)){const n=ho;await ae.selection_clear(!1),await ae.treeview_expand_from_id(n),await ae.selection_add([n]);const e=await ae.getKeyChildrenFromItem(n);await ae.selection_add(e),await ae.selection_append();const t=await ae.getRowOfKey(n);Mt.getState().updateToggel(t)}}function on(n){return d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:n.classOveride?n.classOveride:"h-10 w-10 m-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[d.jsx("path",{x:"4.8929076",y:"3.2340963",width:"14.940843",height:"13.955923",d:"m6.4804 3.2341h11.766a1.5875 1.5875 45 0 1 1.5875 1.5875v10.781a1.5875 1.5875 135 0 1-1.5875 1.5875h-11.766a1.5875 1.5875 45 0 1-1.5875-1.5875v-10.781a1.5875 1.5875 135 0 1 1.5875-1.5875z",fillOpacity:"0",strokeWidth:".78334"}),d.jsx("path",{x:"2.2201288",y:"3.2309675",width:"20.079046",height:"16.709587",d:"m4.9999 3.231h14.364a2.9353 2.9353 45 0 1 2.9353 2.9353v12.187a1.5875 1.5875 135 0 1-1.5875 1.5875h-16.904a1.5875 1.5875 45 0 1-1.5875-1.5875v-12.342a2.7798 2.7798 135 0 1 2.7798-2.7798z",fillOpacity:"0",strokeWidth:".78334"}),d.jsxs("g",{fill:"none",children:[d.jsx("path",{d:"m2.3535 18.798s2.5503-2.8137 2.5503-2.8137",strokeWidth:".67939"}),d.jsx("path",{d:"m4.0104 19.787 1.7106-2.6956",strokeWidth:".62362"}),d.jsx("path",{d:"m20.967 19.866s-1.9155-2.978-1.9155-2.978",strokeWidth:".69575"}),d.jsx("path",{d:"m22.496 18.647s-2.5894-2.7447-2.5894-2.7447",strokeWidth:".69575"})]}),d.jsx("text",{transform:n.scale?n.scale:"scale(1.0338 .96735)",x:"6.8110447",y:"15.365105",fill:"#000000",fontFamily:"sans-serif",fontSize:n.fontSize?n.fontSize:"13.986px",letterSpacing:"0px",strokeWidth:".75591",wordSpacing:"0px",style:{lineHeight:"1.25"},children:d.jsx("tspan",{x:n.positionX||"6.8110447",y:n.positionY||"15.365105",strokeWidth:".75591",children:n.letters})})]})}function z_(n){let e;switch(n.button){case"LEFT":e="m4.9505 10.791c0-0.77873 0.018619-1.0235 0.10293-1.3532 0.28209-1.103 1.1198-2.0034 2.4623-2.6465 1.0804-0.51761 2.2209-0.80166 3.746-0.93301l0.37582-0.032367v2.6935l-0.24623 0.08212c-0.33049 0.11022-0.72749 0.41811-0.93257 0.72325-0.28884 0.42975-0.37633 0.81819-0.37633 1.6707v0.74619h-5.1319z";break;case"MIDDLE":e="m11.728 15.521c-0.42319-0.0997-0.666-0.27645-0.84827-0.61749-0.08924-0.16698-0.09829-0.34746-0.11357-2.2654-0.01417-1.7784-0.0044-2.1314 0.06629-2.4075 0.16536-0.64548 0.61869-1.027 1.2203-1.027 0.52612 0 0.949 0.30146 1.1404 0.81292 0.09786 0.26156 0.10374 0.40371 0.10374 2.5064 0 2.1234-0.0049 2.2387-0.1032 2.4314-0.13827 0.27104-0.3812 0.44644-0.75208 0.54304-0.33882 0.08825-0.42668 0.09115-0.71362 0.02354z";break;case"RIGHT":e="m14.011 10.925c-0.018954-0.65138-0.045312-0.87585-0.13037-1.1103-0.26365-0.72659-0.74158-1.1345-1.5363-1.3111l-0.14881-0.033076 0.0212-1.2911c0.01166-0.71008 0.03796-1.3078 0.05845-1.3283 0.04987-0.049874 1.3389 0.059588 1.9545 0.16597 1.2629 0.21824 2.6644 0.78055 3.4472 1.3831 0.46706 0.3595 0.92155 0.90147 1.1409 1.3605 0.26048 0.54511 0.33648 1.0129 0.33648 2.0713v0.90935h-5.1196z"}return d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 m-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[d.jsx("path",{d:"m4.6667 10.221c0.040204-6.1879 14.812-6.2467 14.759 0l0.04556 9.5202c0.01204 4.996-14.778 4.9417-14.759 0z",strokeWidth:"1"}),d.jsx("path",{d:"m10.419 10.676c0.0088-2.4465 3.2566-2.4698 3.245 0l0.01007 3.764c0.0027 1.9753-3.2491 1.9538-3.245 0z",strokeWidth:"1"}),d.jsxs("g",{fill:"none",strokeWidth:"1",children:[d.jsx("path",{d:"m13.651 12.023h4.652 0.95459"}),d.jsx("path",{d:"m4.6043 12.049h4.652 0.95459"}),d.jsx("path",{d:"m11.931 8.7892c0-1.212 0-2.424 0.02857-3.2023s0.08571-1.1229 0.52147-1.4616c0.43576-0.33868 1.2501-0.67138 1.7001-1.2893 0.45-0.61787 0.53572-1.5209 0.62144-2.424"})]}),d.jsx("path",{d:"m14.043 10.224c-0.017761-0.48347-0.036822-0.61315-0.11574-0.78413-0.19741-0.42763-0.77375-0.79211-1.4064-0.88943l-0.26787-0.041187v-2.6966h0.2467c0.13568 0 0.49605 0.024401 0.8008 0.053903 2.4936 0.24262 4.4514 1.1749 5.2989 2.5234 0.37392 0.59495 0.51107 1.1001 0.51107 1.8826v0.53078h-5.0462z",strokeWidth:"0"}),d.jsx("g",{fill:"#6CF10A",strokeWidth:"0",children:d.jsx("path",{d:e})})]})}function xhe(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 m-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("text",{transform:"scale(1.0338 .96735)",x:"6.8110447",y:"15.365105",fill:"#000000",fontFamily:"sans-serif",fontSize:"13.986px",letterSpacing:"0px",strokeWidth:".75591",wordSpacing:"0px",style:{lineHeight:"1.25"},children:d.jsx("tspan",{x:"6.8110447",y:"15.365105",strokeWidth:".75591",children:"+"})})})}function yhe(){const n=$v();return d.jsx("div",{className:"fixed bottom-0 left-0 right-0 text-white-400 z-50 pointer-events-none select-none",children:d.jsx("div",{className:"flex",children:d.jsxs("div",{className:"flex flex-col m-auto pointer-events-auto",children:[d.jsxs("div",{className:"flex m-1",children:[d.jsx("div",{className:"flex-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.toggleVisibility()}}),d.jsx("div",{className:"flex-1 flex flex-col items-end",children:d.jsx("div",{className:"bg-gray-800/90 text-gray-200 hover:text-gray-300 cursor-pointer p-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.gotoNextPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062A1.125 1.125 0 013 16.81V8.688zM12.75 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062a1.125 1.125 0 01-1.683-.977V8.688z"})})})})]}),d.jsxs("div",{className:"flex bg-gray-800/90 mb-2 p-1",children:[d.jsxs("div",{className:"flex flex-1 flex-col w-48 mr-3 ml-3",children:[d.jsx(z_,{button:"LEFT"}),d.jsx("div",{className:"m-auto",children:"Rotate"})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-48 mr-3 ml-3",children:[d.jsx(z_,{button:"MIDDLE"}),d.jsx("div",{className:"m-auto",children:"Move to mousepointer"})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-48 mr-3 ml-3",children:[d.jsx(z_,{button:"RIGHT"}),d.jsx("div",{className:"m-auto",children:"Pan"})]})]}),d.jsxs("div",{className:"flex bg-gray-800/90 mb-2 p-1",children:[d.jsxs("div",{className:"flex flex-1 flex-col w-42 mr-2 ml-2","data-tooltip":"Sets focus point for rotation",children:[d.jsxs("div",{className:"flex ",children:[d.jsx(on,{letters:"ALT",positionY:"12.5",positionX:"6.2",fontSize:"6px"}),d.jsx(xhe,{}),d.jsx(z_,{button:"LEFT"})]}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Set focus point"})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-48 mr-3 ml-3",onClick:e=>{e.preventDefault(),e.stopPropagation(),jS()},"data-tooltip":"Sets selection in treeview to parent element",children:[d.jsx(on,{letters:"U"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Up lvl (tree)"})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-48 mr-3 ml-3",onClick:e=>{e.preventDefault(),e.stopPropagation(),zS()},"data-tooltip":"Sets selection in treeview back to previous",children:[d.jsx(on,{letters:"P"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Prev lvl (tree)"})})})]})]}),d.jsx("div",{className:"flex bg-gray-800/90 mb-2 p-1 text-yellow-500",children:d.jsx("div",{className:"m-auto",children:"When you close this helper you can open it again with icon in top right cornor."})})]})})})}function whe(){const n=$v();return d.jsx("div",{className:"fixed bottom-0 left-0 right-0 text-white-400 z-50 pointer-events-none select-none",children:d.jsx("div",{className:"flex",children:d.jsxs("div",{className:"flex flex-col m-auto pointer-events-auto",children:[d.jsxs("div",{className:"flex m-1",children:[d.jsx("div",{className:"flex-1 flex flex-col items-start",children:d.jsx("div",{className:"bg-gray-800/90 text-gray-200 hover:text-gray-300 cursor-pointer p-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.gotoPrevPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953l7.108-4.062A1.125 1.125 0 0121 8.688v8.123zM11.25 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953L9.567 7.71a1.125 1.125 0 011.683.977v8.123z"})})})}),d.jsx("div",{className:"flex-1 flex flex-col items-end",children:d.jsx("div",{className:"bg-gray-800/90 text-gray-200 hover:text-gray-300 cursor-pointer p-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.gotoNextPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062A1.125 1.125 0 013 16.81V8.688zM12.75 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062a1.125 1.125 0 01-1.683-.977V8.688z"})})})})]}),d.jsxs("div",{className:"flex bg-gray-800/90 mb-2 p-1",children:[d.jsxs("div",{className:"flex flex-1 flex-col w-48 mr-3 ml-3",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(on,{letters:"Q"}),d.jsx("div",{className:"m-auto whitespace-nowrap",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:"Move up"})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-48 mr-3 ml-3",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(on,{letters:"W",positionX:"5.3"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move forward"})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-48 mr-3 ml-3",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(on,{letters:"E"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move down"})]})]}),d.jsxs("div",{className:"flex bg-gray-800/90 mb-2 p-1",children:[d.jsxs("div",{className:"flex flex-1 flex-col w-48 mr-3 ml-3",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(on,{letters:"A"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move left"})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-48 mr-3 ml-3",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(on,{letters:"S"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move backwards"})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-48 mr-3 ml-3",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[d.jsx(on,{letters:"D"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move right"})]})]}),d.jsx("div",{className:"flex bg-gray-800/90 mb-2 p-1 text-yellow-500",children:d.jsx("div",{className:"m-auto",children:"User mouse wheel to exit firstperson view, holding space will set it into FLY mode"})})]})})})}function XN(){F().getActiveControls().smoothTime=.5,F().getActiveControls().saveState(),F().setOrbitOn().then(()=>{F().getActiveControls().smoothTime=1,F().getActiveControls().saveState()})}function BS(){const n=F().__lastClick;if(F().__lastClick){const e=new N,t=F().getActiveControls();t.getPosition(e);const r=e.distanceTo(F().__lastClick);t.smoothTime=.5,t.saveState(),t.setTarget(n.x,n.y,n.z);const i=r-5;t.dolly(i,!0).then(()=>{t.smoothTime=1,t.saveState()})}}function She(){const n=$v();return d.jsx("div",{className:"fixed bottom-0 left-0 right-0 text-white-400 z-50 pointer-events-none select-none",children:d.jsx("div",{className:"flex",children:d.jsxs("div",{className:"flex flex-col m-auto pointer-events-auto",children:[d.jsxs("div",{className:"flex m-1",children:[d.jsx("div",{className:"flex-1 flex flex-col items-start",children:d.jsx("div",{className:"bg-gray-800/90 text-gray-200 hover:text-gray-300 cursor-pointer p-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.gotoPrevPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953l7.108-4.062A1.125 1.125 0 0121 8.688v8.123zM11.25 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953L9.567 7.71a1.125 1.125 0 011.683.977v8.123z"})})})}),d.jsx("div",{className:"flex-1 flex flex-col items-end",children:d.jsx("div",{className:"bg-gray-800/90 text-gray-200 hover:text-gray-300 cursor-pointer p-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),n.gotoNextPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062A1.125 1.125 0 013 16.81V8.688zM12.75 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062a1.125 1.125 0 01-1.683-.977V8.688z"})})})})]}),d.jsxs("div",{className:"flex bg-gray-800/90 mb-2 p-1",children:[d.jsxs("div",{className:"flex flex-1 flex-col w-42 mr-1 ",onClick:e=>{e.preventDefault(),e.stopPropagation(),LS()},"data-tooltip":"Hides selected",children:[d.jsx(on,{letters:"H",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Hide"})})]}),d.jsxs("div",{className:"flex flex-1 flex-col  w-42  ml-1",onPointerUp:()=>{},onPointerDown:e=>{e.preventDefault(),e.stopPropagation(),UN()},"data-tooltip":"Unhides selected",children:[d.jsx(on,{letters:"R",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Unhide"})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col  w-42  ml-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),DN()},"data-tooltip":"Unhides all",children:[d.jsx(on,{letters:"K",positionX:"7",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Unhide all "})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-42  ",onClick:e=>{e.preventDefault(),e.stopPropagation(),FN()},"data-tooltip":"Inverts selection",children:[d.jsx(on,{letters:"I",positionX:"10",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Invert"})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-1 ml-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),jS()},"data-tooltip":"Move up to parent in treeview",children:[d.jsx(on,{letters:"U",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Up Lvl (tree)"})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-1 ml-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),zS()},"data-tooltip":"Move down to previous selected",children:[d.jsx(on,{letters:"P",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Prev Lvl (tree)"})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-1 ml-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),BS()},"data-tooltip":"Go to last clicked point in model",children:[d.jsx(on,{letters:"G",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Go to point"})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-1 ml-1",onClick:e=>{e.preventDefault(),e.stopPropagation(),XN()},"data-tooltip":"Set last clicked point in model as focus point for rotation",children:[d.jsx(on,{letters:"O",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Orbit point"})})})]})]}),d.jsx("div",{className:"flex bg-gray-800/90 mb-2 p-1 text-yellow-500",children:d.jsx("div",{className:"m-auto",children:"Selection actions"})})]})})})}function Ehe(){const[n,e]=ee.useState(!1),[t,r]=ee.useState(!1),i=$v(),s=ee.useRef(null),o=ee.useRef(null),a=ee.useRef(null),l=ee.useRef(null),c=ee.useRef(null),u=ee.useRef(null),h=` flex flex-1 flex-col w-42 mr-2 ml-2 pointer-events-auto ${n?" text-yellow-400 ":""}`;return ee.useEffect(()=>{const f=new rh(s.current),p=new rh(o.current),_=new rh(a.current),y=new rh(l.current),g=new rh(c.current),m=new rh(u.current),v=()=>{uu()},x=k=>{const T=F();if(n){const R=.02*k.deltaTime;T.__controls3d.dollyInFixed(R,!1)}else{const R=.002*k.deltaTime;T.__controls3d.dollyInFixed(R,!1)}T.forceRenderNextFrame()},w=k=>{const T=F(),R=.002*k.deltaTime;T.__controls3d.dollyInFixed(-R,!1),T.forceRenderNextFrame()},E=k=>{const T=F(),R=.002*k.deltaTime;T.__controls3d.truck(-R,0,!1)},S=k=>{const T=F(),R=.002*k.deltaTime;T.__controls3d.truck(R,0,!1)},C=k=>{const T=F(),R=.002*k.deltaTime;T.__controls3d.elevate(+R,!1)},A=k=>{const T=F(),R=.002*k.deltaTime;T.__controls3d.elevate(-R,!1)};return f.addEventListener(St.HOLD_START,v),f.addEventListener(St.HOLDING,x),p.addEventListener(St.HOLD_START,v),p.addEventListener(St.HOLDING,w),_.addEventListener(St.HOLD_START,v),_.addEventListener(St.HOLDING,E),y.addEventListener(St.HOLD_START,v),y.addEventListener(St.HOLDING,S),g.addEventListener(St.HOLD_START,v),g.addEventListener(St.HOLDING,C),m.addEventListener(St.HOLD_START,v),m.addEventListener(St.HOLDING,A),()=>{f.removeEventListener(St.HOLD_START,v),f.removeEventListener(St.HOLDING,x),p.removeEventListener(St.HOLD_START,v),p.removeEventListener(St.HOLDING,w),_.removeEventListener(St.HOLD_START,v),_.removeEventListener(St.HOLDING,E),y.removeEventListener(St.HOLD_START,v),y.removeEventListener(St.HOLDING,S),g.removeEventListener(St.HOLD_START,v),g.removeEventListener(St.HOLDING,C),m.removeEventListener(St.HOLD_START,v),m.removeEventListener(St.HOLDING,A)}},[t,s,o,a,l,c,u,n]),d.jsx("div",{className:"fixed bottom-0 left-0 right-0 text-white-400 z-50 pointer-events-none select-none",children:d.jsx("div",{className:"flex pointer-events-none select-none",children:d.jsxs("div",{className:"flex flex-col w-full pointer-events-none",children:[d.jsxs("div",{className:"flex m-1 pointer-events-none",children:[d.jsx("div",{className:"flex-1 flex flex-col items-start pointer-events-auto",children:d.jsx("div",{className:"bg-gray-800/90 text-gray-200 hover:text-gray-300 cursor-pointer p-1",onClick:f=>{f.preventDefault(),f.stopPropagation(),i.gotoPrevPage()},children:d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953l7.108-4.062A1.125 1.125 0 0121 8.688v8.123zM11.25 16.811c0 .864-.933 1.405-1.683.977l-7.108-4.062a1.125 1.125 0 010-1.953L9.567 7.71a1.125 1.125 0 011.683.977v8.123z"})})})}),d.jsx("div",{className:"flex-1 pointer-events-none select-none"})]}),d.jsxs("div",{className:"flex pointer-events-none",children:[d.jsxs("div",{children:[d.jsxs("div",{className:"flex bg-gray-800/90 mb-2 ",children:[d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-2 ml-2 pointer-events-auto",ref:c,onPointerCancel:()=>{r(!t)},onClick:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(on,{letters:"Q"}),d.jsx("div",{className:"m-auto whitespace-nowrap",onClick:f=>{f.preventDefault(),f.stopPropagation()},children:"Move up"})]}),d.jsxs("div",{className:"flex flex-col w-32 mr-2 ml-2 pointer-events-auto",ref:s,onPointerCancel:()=>{r(!t)},onPointerDown:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(on,{letters:"W",positionX:"5.3"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Forward"})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-2 ml-2 pointer-events-auto",ref:u,onPointerCancel:()=>{r(!t)},onClick:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(on,{letters:"E"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move down"})]})]}),d.jsxs("div",{className:"flex bg-gray-800/90 mb-2",children:[d.jsxs("div",{className:"flex flex-col w-32 mr-2 ml-2 pointer-events-auto",ref:a,onPointerCancel:()=>{r(!t)},onClick:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(on,{letters:"A"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move left"})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-2 ml-2 pointer-events-auto",ref:o,onPointerCancel:()=>{r(!t)},onClick:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(on,{letters:"S"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move backwards"})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-2 ml-2 pointer-events-auto",ref:l,onPointerCancel:()=>{r(!t)},onClick:f=>{f.preventDefault(),f.stopPropagation()},children:[d.jsx(on,{letters:"D"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:"Move right"})]})]})]}),d.jsx("div",{className:"flex-1  pointer-events-none"}),d.jsxs("div",{children:[d.jsxs("div",{className:"flex bg-gray-800/90 mb-2 pointer-events-auto",children:[d.jsxs("div",{className:h,onClick:f=>{f.preventDefault(),f.stopPropagation(),e(!n)},"data-tooltip":"Turbo mode forward",children:[d.jsx(on,{letters:"T",positionX:"7",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Turbo mode"})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-2 ml-2 pointer-events-auto",onClick:f=>{f.preventDefault(),f.stopPropagation(),BS()},"data-tooltip":"Go to last clicked point in model",children:[d.jsx(on,{letters:"G",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Go to point"})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-2 ml-2 pointer-events-auto",onClick:f=>{f.preventDefault(),f.stopPropagation(),jS()},"data-tooltip":"Move up to parent in treeview",children:[d.jsx(on,{letters:"U",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Up Lvl (tree)"})})})]})]}),d.jsxs("div",{className:"flex bg-gray-800/90 mb-2 flex-row-reverse",children:[d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-2 ml-2 pointer-events-auto",onClick:f=>{f.preventDefault(),f.stopPropagation(),zS()},"data-tooltip":"Move down to previous selected",children:[d.jsx(on,{letters:"P",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Prev Lvl (tree)"})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-2 ml-2 pointer-events-auto",onClick:f=>{f.preventDefault(),f.stopPropagation(),XN()},"data-tooltip":"Set last clicked point in model as focus point for rotation",children:[d.jsx(on,{letters:"O",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Orbit point"})})})]}),d.jsxs("div",{className:"flex flex-1 flex-col w-32 mr-2 ml-2 pointer-events-auto",onClick:f=>{f.preventDefault(),f.stopPropagation(),LS()},"data-tooltip":`Sets selected to 10% opacity. Opacity 10% or lower is not selectable by default.
To select transparent 10% or less HOLD shift key down.`,children:[d.jsx(on,{letters:"H",positionX:"7",classOveride:"h-10 w-10 m-auto"}),d.jsx("div",{className:"m-auto whitespace-nowrap",children:d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"m-auto",children:" Hide "})})})]})]})]})]}),d.jsx("div",{className:"flex bg-gray-800/90 mb-2 p-1 text-yellow-500",children:d.jsx("div",{className:"m-auto",children:"Helpers for touch screen"})})]})})})}function The(){const n=$v();return n.isVisible?n.currentPage===2?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed top-0 right-0  z-50 ",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"flex m-1",children:d.jsx("div",{className:"  text-gray-200 hover:text-gray-300 cursor-pointer p-1",onClick:()=>{n.toggleVisibility()},children:d.jsx(Dm,{})})})})}),d.jsx(whe,{})]}):n.currentPage===3?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed top-0 right-0  z-50 ",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"flex m-1",children:d.jsx("div",{className:"  text-gray-200 hover:text-gray-300 cursor-pointer p-1",onClick:()=>{n.toggleVisibility()},children:d.jsx(Dm,{})})})})}),d.jsx(She,{})]}):n.currentPage===4?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed top-0 right-0  z-50 ",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"flex m-1",children:d.jsx("div",{className:"  text-gray-200 hover:text-gray-300 cursor-pointer p-1",onClick:()=>{n.toggleVisibility()},children:d.jsx(Dm,{})})})})}),d.jsx(Ehe,{})]}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed top-0 right-0 z-50 ",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"flex m-1",children:d.jsx("div",{className:"  text-gray-200 hover:text-gray-300 cursor-pointer p-1",onClick:()=>{n.toggleVisibility()},children:d.jsx(Dm,{})})})})}),d.jsx(yhe,{})]}):d.jsx("div",{className:"fixed top-0 right-0 z-50",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"flex m-1",children:d.jsx("div",{className:"  text-gray-200 hover:text-gray-300 cursor-pointer p-1",onClick:()=>{n.toggleVisibility()},children:d.jsx(Dm,{})})})})})}const V3=()=>{const[n,e]=ee.useState({x:0,y:0}),[t,r]=ee.useState({show:!1,text:""});if(ee.useEffect(()=>{const i=()=>{r({show:!1,text:""}),window.removeEventListener("click",i)},s=o=>{var u,h,f;o.preventDefault();let l=o.target,c=0;for(;c<5&&l;){if((u=l==null?void 0:l.dataset)!=null&&u.copyvalue&&((h=l==null?void 0:l.dataset)!=null&&h.rawValue)){r({show:!0,text:(f=l==null?void 0:l.dataset)==null?void 0:f.rawValue});break}c++,l=l==null?void 0:l.parentElement}e({x:o.clientX,y:o.clientY}),window.addEventListener("click",i)};return window.addEventListener("contextmenu",s),()=>{window.removeEventListener("contextmenu",s)}}),t.show){const i={display:t.show?"block":"none",left:n.x+"px",top:n.y+"px"};return d.jsx("div",{onClick:()=>{function s(o){var a;(a=o.clipboardData)==null||a.setData("text/plain",t.text),o.preventDefault()}document.addEventListener("copy",s),document.execCommand("copy"),document.removeEventListener("copy",s)},style:i,className:"absolute z-[9999] p-1  text-xs bg-gray-700 whitespace-pre-wrap  focus:outline-none text-white drop-shadow-lg border border-gray-900 hover:bg-gray-500",children:"Copy value"})}else return null};function G3(){const[n,e]=ee.useState(""),[t,r]=ee.useState(!1),[i,s]=ee.useState(!1),[o,a]=ee.useState(!1),l=Ol();return l.isActivated?d.jsx("div",{className:"fixed grid w-full h-full items-center justify-center fadeIn z-[8010] bg-gray-50/50",children:d.jsxs("div",{className:"relative block w-96 h-[25rem] bg-gray-800",children:[d.jsx("span",{className:"m-auto block text-center text-2xl  p-2 bg-gray-700 text-white",children:"Bookmark URL"}),d.jsx("span",{className:"mt-2 m-auto block text-center underline font-semibold text-white",children:"Copy link below"}),d.jsx("span",{className:"flex-1 m-auto block text-center mt-4 text-gray-900 bg-gray-200 p-1 ml-2 mr-2 overflow-clip",children:l.url}),d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("label",{className:"m-auto p-1","data-tooltip":"Displays page with simpler user interface",children:["Add Presentation Mode (pad)",d.jsx("input",{type:"checkbox",checked:t,className:"m-1",onChange:()=>{if(t){const c=l.url.replace("&presentation-mode","");Ol.setState({url:c}),r(!1)}else{const c=l.url+"&presentation-mode";Ol.setState({url:c}),r(!0)}}})]}),d.jsxs("label",{className:"m-auto p-1","data-tooltip":"Anti-aliasing makes 3d more clear, but at the cost of performance",children:["Add Skip Anti-aliasing",d.jsx("input",{type:"checkbox",className:"m-1",checked:i,onChange:()=>{if(i){const c=l.url.replace("&skip-alias","");Ol.setState({url:c}),s(!1)}else{const c=l.url+"&skip-alias";Ol.setState({url:c}),s(!0)}}})]}),d.jsxs("label",{className:"m-auto p-1","data-tooltip":"This will try and just load sites on filter, less to load, useful when very large models",children:["Use filtered sites",d.jsx("input",{type:"checkbox",className:"m-1",checked:o,onChange:()=>{if(o){const c=l.url.replaceAll("&use-set-layer","");Ol.setState({url:c}),a(!1)}else{const c=l.url+"&use-set-layer";Ol.setState({url:c}),a(!0)}}})]})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("button",{className:"bg-green-800 m-auto mt-2 p-2 hover:bg-green-700  ",onClick:()=>{function c(u){var h;(h=u.clipboardData)==null||h.setData("text/plain",l.url),u.preventDefault(),e("URL Copied "),setTimeout(()=>{e("")},3500)}document.addEventListener("copy",c),document.execCommand("copy"),document.removeEventListener("copy",c)},children:"Copy to clipboard"}),n?d.jsx("span",{className:"text-center p-2 animate-pulse",children:n}):""]}),d.jsx("div",{className:"absolute bottom-2 left-0 right-0",children:d.jsx("button",{className:"block m-auto p-2  bg-gray-600 w-28 hover:bg-gray-700",onClick:()=>l.deactivate(),children:"Close"})})]})}):null}function e8(n){uy.delete(n)}function Che(){const[n,e]=ee.useState([]);return ee.useEffect(()=>{const t={handleEvent:r=>(e(r.parents.reverse()),!0)};return zN(t),()=>e8(t)},[]),d.jsx("div",{className:" flex flex-col pointer-events-none",children:n.map((t,r)=>{const i=`${(r+1)*5}px`;return d.jsx("span",{className:"m-1 text-yellow-400 block-inline",style:{marginLeft:i},children:d.jsx("span",{className:"bg-gray-800/50",children:t})},t)})})}function bhe(){const n=mn();return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{n.hideViewPointInPresentationMode?mn.setState({hideViewPointInPresentationMode:!1}):mn.setState({hideViewPointInPresentationMode:!0})},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"min-h-[30px] h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-2m-4-1v8m0 0l3-3m-3 3L9 8m-5 5h2.586a1 1 0 01.707.293l2.414 2.414a1 1 0 00.707.293h3.172a1 1 0 00.707-.293l2.414-2.414a1 1 0 01.707-.293H20"})}),d.jsx("span",{className:"text-center text-xs",children:"Viewpoints"})]})}function Ahe(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{F().getActiveControls().smoothTime=.5,F().getActiveControls().saveState(),F().setOrbitOn().then(()=>{F().getActiveControls().smoothTime=1,F().getActiveControls().saveState()})},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 p-1 m-1 max-w-6 hover:bg-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Set last clicked point in model as focus point for rotation",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})}),d.jsx("span",{className:"text-center text-xs",children:"Focus"})]})}function Mhe(){return d.jsxs("div",{className:"w-20 flex flex-col m-2 hover:bg-gray-500 text-gray-300 p-2 items-center hover:text-gray-900 rounded pointer-events-auto cursor-pointer",onClick:()=>{BS()},children:[d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 p-1 m-1 max-w-6 hover:bg-gray-500 rotate-45",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","data-tooltip":"Fly to selected",strokeWidth:2,children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),d.jsx("span",{className:"text-center text-xs",children:"Fly/Focus"})]})}function Rhe(){const n=ee.useRef(null),e=mn(),t=ke();return ee.useEffect(()=>{const r=n.current;let i,s,o;const a=new ResizeObserver(l=>{for(const c of l)clearTimeout(i),i=setTimeout(()=>{const u=Array.isArray(c.contentRect)?c.contentRect[0]:c.contentRect,h=u.width+(r==null?void 0:r.offsetLeft)||0,f=u.height;F()&&(s!==h||o!==f)&&F().setSize(window.innerWidth,window.innerHeight,0,(r==null?void 0:r.offsetTop)||0)},100)});return r&&a.observe(r),()=>{r&&a.unobserve(r)}}),d.jsx("div",{className:"fixed flex z-40 h-full w-full pointer-events-none",children:d.jsxs("div",{className:"flex flex-col  select-none w-full h-full pointer-events-none",children:[d.jsxs(Kt,{name:t.selectedLayerTitle||"No project/layer selected",children:[d.jsx(s6,{}),d.jsx(bhe,{}),d.jsx(Ahe,{}),d.jsx(Mhe,{})]}),d.jsxs("div",{className:"flex flex-grow",style:{minHeight:"0px"},children:[d.jsx("div",{ref:n,id:"canvas-tracker",className:"w-full h-full"}),d.jsx("div",{className:"flex flex-col flex-grow border-gray-900",style:{minHeight:"0px"},children:d.jsx("div",{className:"flex bg-gray-800 pointer-events-auto",style:{minHeight:"50%"},children:e.hideViewPointInPresentationMode?null:d.jsx(J6,{simplified:!0})})})]}),d.jsx(Che,{})]})})}function Nhe(){return d.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})}function TC(){const n=CA();return n.modelIssues?d.jsx("div",{className:"fixed top-1 right-28 z-50",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"flex m-1",children:d.jsx("div",{className:"  text-yellow-500 hover:text-gray-300 cursor-pointer p-1",onClick:()=>{Kn.setState({activated:!0,message:n.modelIssuesMessages.join(`
`),header:"Model Issues"})},children:d.jsx(Nhe,{})})})})}):null}async function Ihe(n,e=!1){if(n){await ON(!0);const t=ke.getState().selectedProject;if(t&&(t==null?void 0:t.project_key)===n){if(kS(t.project_code),await PS(t,!1,!1,!0),await Yf(!1),e){const r=ke.getState().selectedProject;if(r!=null&&r.controllerPosition&&(r!=null&&r.controllerTarget)){const i=ke.getState().selectedLayer,s=(i==null?void 0:i.controllerTarget)||(r==null?void 0:r.controllerTarget),o=(i==null?void 0:i.controllerPosition)||(r==null?void 0:r.controllerPosition);await F().getActiveControls().setLookAt(o[0],o[1],o[2],s[0],s[1],s[2],!1),await _v()}else await _v(),F().fitModelToCanvas(!0);F().getSceneController().updateBB()}mn.setState({treeViewActive:!QU})}}}async function W3(n){var e,t;((e=n.target)==null?void 0:e.tagName)==="INPUT"||((t=n.target)==null?void 0:t.tagName)==="TEXTAREA"||(n.key.toLocaleUpperCase()==="H"&&LS(),n.key.toLocaleUpperCase()==="J"&&I6(),n.key.toLocaleUpperCase()==="K"&&DN(),n.key.toLocaleUpperCase()==="G"&&BS(),n.key.toLocaleUpperCase()==="I"&&FN(),n.key.toLocaleUpperCase()==="V"&&k6(),n.key.toLocaleUpperCase()==="R"&&UN(),n.key.toLocaleUpperCase()==="T"&&P6(),n.key.toLocaleUpperCase()==="O"&&XN(),n.key.toLocaleUpperCase()==="U"&&jS(),n.key.toLocaleUpperCase()==="P"&&zS(),n.key.toLocaleUpperCase()==="M"&&Bt.toggleMode(),n.key.toLocaleUpperCase()==="X"&&Bt.toggleTransformHelper(),n.key.toLocaleUpperCase()==="F"&&Bt.resizeToSelected(),n.key.toLocaleUpperCase()==="B"&&Bt.toggleClipping())}function Phe(){e8(H3),document.removeEventListener("keyup",W3),zN(H3),document.addEventListener("keyup",W3)}function khe(){const n=ee.useRef(null);return ee.useEffect(()=>{const e=n.current;let t,r,i;const s=new ResizeObserver(o=>{for(const a of o)clearTimeout(t),t=setTimeout(()=>{const l=Array.isArray(a.contentRect)?a.contentRect[0]:a.contentRect,c=l.width+(e==null?void 0:e.offsetLeft)||0,u=l.height;F()&&(r!==c||i!==u)&&F().setSize(window.innerWidth,window.innerHeight,0,(e==null?void 0:e.offsetTop)||0)},100)});return e&&s.observe(e),()=>{e&&s.unobserve(e)}}),d.jsx("div",{className:"fixed flex z-40 h-full w-full pointer-events-none",children:d.jsx("div",{className:"flex flex-col  select-none w-full h-full pointer-events-none",children:d.jsxs("div",{className:"flex flex-grow",style:{minHeight:"0px"},children:[d.jsxs("div",{className:"flex flex-col flex-grow border-b-4 border-gray-900",style:{minHeight:"0px"},children:[d.jsx(D6,{}),d.jsx(L6,{}),d.jsx(r6,{})]}),d.jsx("div",{ref:n,id:"canvas-tracker",className:"w-full h-full"})]})})})}function Lhe(){const[n,e]=ee.useState("");return ee.useEffect(()=>{Ed().then(t=>{e(t.ENV__CONFIG_WIKI_LINK)})},[]),n?d.jsx("a",{target:"_blank",rel:"noreferrer",href:n,children:d.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12","data-tooltip":"Opens wiki page for web-3d",children:[d.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),d.jsx("path",{d:"M3 4.984h2"}),d.jsx("path",{d:"M8 4.984h2.5"}),d.jsx("path",{d:"M14.5 4.984h2.5"}),d.jsx("path",{d:"M22 4.984h-2"}),d.jsx("path",{d:"M4 4.984l5.455 14.516l6.545 -14.516"}),d.jsx("path",{d:"M9 4.984l6 14.516l6 -14.516"})]})}):null}function Ohe(){return d.jsx("div",{className:"fixed top-0 right-14 z-50",children:d.jsx("div",{className:"flex",children:d.jsx("div",{className:"flex m-1",children:d.jsx("div",{className:"  text-gray-200 hover:text-gray-300 cursor-pointer p-1",children:d.jsx(Lhe,{})})})})})}kS("No project selected");function Dhe(){const n=mn();if(ee.useEffect(()=>{WP||(MZ("3dview"),Jce(),Phe(),tue(),PE&&GP&&N6(PE,GP,!0).catch(t=>{it.setState({loadingData:!1,dialogContent:"",dialogHeader:""}),Kn.setState({activated:!0,header:"Loading error",message:t}),console.error(t)}).then(()=>{Mt.getState().updateToggel(),Ts(!0)}),IE&&Ihe(IE,GK).catch(t=>{it.setState({loadingData:!1,dialogContent:"",dialogHeader:""}),Kn.setState({activated:!0,header:"Loading error",message:t}),console.error(t)}),!IE&&!PE&&AR()&&ke.setState({isOpen:!0}))},[]),WP)return document.title="Web-3d external",d.jsx("div",{className:"app bg-gray-800 text-gray-200 items-center overflow-auto",children:d.jsx(ghe,{})});if(n.isPresentationMode)return d.jsxs("div",{className:"app bg-gray-800 text-gray-200 items-center",children:[d.jsx(EC,{}),d.jsx(pC,{}),d.jsx(TC,{}),d.jsx(mC,{}),d.jsx(fC,{}),d.jsx(Rhe,{}),d.jsx("canvas",{className:"cursor-default fixed",id:"3dview"})]});if(qK){const t=n.canvasMode==="NORMAL"?"cursor-default fixed":"cursor-crosshair fixed";return d.jsxs("div",{className:"app bg-gray-800 text-gray-200 items-center",children:[d.jsx(b3,{}),d.jsx(V3,{}),d.jsx(G3,{}),d.jsx(TC,{}),d.jsx(EC,{}),d.jsx(j3,{}),d.jsx(A3,{}),d.jsx(pC,{}),d.jsx(mC,{}),d.jsx(fC,{}),d.jsx(z3,{}),d.jsx(khe,{}),d.jsx(TL,{}),d.jsx("div",{className:"fixed pointer-events-none text-red-600 bottom-0  text-1xl z-[10] w-full flex",children:d.jsx("span",{className:"absolute bottom-0 right-3 bg-gray-800",children:"You are using beta verison - Please report bugs to vegar.ringdal@aibel.com on teams or mail"})}),d.jsx("canvas",{className:t,id:"3dview"})]})}const e=n.canvasMode==="NORMAL"?"cursor-default fixed":"cursor-crosshair fixed";return d.jsxs("div",{className:"app bg-gray-800 text-gray-200 items-center",children:[d.jsx(b3,{}),d.jsx(V3,{}),d.jsx(G3,{}),d.jsx(TC,{}),d.jsx(The,{}),d.jsx(Ohe,{}),d.jsx(EC,{}),d.jsx(j3,{}),d.jsx(A3,{}),d.jsx(pC,{}),d.jsx(mC,{}),d.jsx(fC,{}),d.jsx(z3,{}),d.jsx(eue,{}),d.jsx(TL,{}),d.jsx("div",{className:"fixed pointer-events-none text-red-600 bottom-0  text-1xl z-[1000000] w-full flex",children:d.jsx("span",{className:"absolute bottom-0 right-3 bg-gray-800",children:"Please report bugs to vegar.ringdal@aibel.com on teams or mail"})}),d.jsx("canvas",{className:e,id:"3dview"})]})}var t8,Y3=li;t8=Y3.createRoot,Y3.hydrateRoot;const K3=2;async function Uhe(){it.setState({loadingData:!0,dialogHeader:"Version check",dialogContent:"Checking version"}),localStorage.getItem("Wb3dVersion")!==K3.toString()?(it.setState({loadingData:!0,dialogHeader:"Version check",dialogContent:"Cleaning cache will autoreload page"}),localStorage.setItem("Wb3dVersion",K3.toString()),(await indexedDB.databases()).forEach(t=>{t.name&&indexedDB.deleteDatabase(t.name)}),Iq(1e3).then(()=>{location.reload()})):it.setState({loadingData:!1})}Boe().then(()=>{Uhe();const n=document.getElementById("root");t8(n).render(d.jsx(Dhe,{}))});
