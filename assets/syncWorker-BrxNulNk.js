var en=Object.defineProperty;var tn=(D,J,ue)=>J in D?en(D,J,{enumerable:!0,configurable:!0,writable:!0,value:ue}):D[J]=ue;var me=(D,J,ue)=>tn(D,typeof J!="symbol"?J+"":J,ue);(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const D=Symbol("Comlink.proxy"),J=Symbol("Comlink.endpoint"),ue=Symbol("Comlink.releaseProxy"),He=Symbol("Comlink.finalizer"),be=Symbol("Comlink.thrown"),ot=i=>typeof i=="object"&&i!==null||typeof i=="function",kt={canHandle:i=>ot(i)&&i[D],serialize(i){const{port1:e,port2:t}=new MessageChannel;return qe(i,e),[t,[t]]},deserialize(i){return i.start(),Ht(i)}},Gt={canHandle:i=>ot(i)&&be in i,serialize({value:i}){let e;return i instanceof Error?e={isError:!0,value:{message:i.message,name:i.name,stack:i.stack}}:e={isError:!1,value:i},[e,[]]},deserialize(i){throw i.isError?Object.assign(new Error(i.value.message),i.value):i.value}},at=new Map([["proxy",kt],["throw",Gt]]);function Kt(i,e){for(const t of i)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function qe(i,e=globalThis,t=["*"]){e.addEventListener("message",function s(n){if(!n||!n.data)return;if(!Kt(t,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}const{id:r,type:o,path:a}=Object.assign({path:[]},n.data),c=(n.data.argumentList||[]).map(se);let h;try{const u=a.slice(0,-1).reduce((g,p)=>g[p],i),d=a.reduce((g,p)=>g[p],i);switch(o){case"GET":h=d;break;case"SET":u[a.slice(-1)[0]]=se(n.data.value),h=!0;break;case"APPLY":h=d.apply(u,c);break;case"CONSTRUCT":{const g=new d(...c);h=Xt(g)}break;case"ENDPOINT":{const{port1:g,port2:p}=new MessageChannel;qe(i,p),h=Jt(g,[g])}break;case"RELEASE":h=void 0;break;default:return}}catch(u){h={value:u,[be]:0}}Promise.resolve(h).catch(u=>({value:u,[be]:0})).then(u=>{const[d,g]=ze(u);e.postMessage(Object.assign(Object.assign({},d),{id:r}),g),o==="RELEASE"&&(e.removeEventListener("message",s),ct(e),He in i&&typeof i[He]=="function"&&i[He]())}).catch(u=>{const[d,g]=ze({value:new TypeError("Unserializable return value"),[be]:0});e.postMessage(Object.assign(Object.assign({},d),{id:r}),g)})}),e.start&&e.start()}function Yt(i){return i.constructor.name==="MessagePort"}function ct(i){Yt(i)&&i.close()}function Ht(i,e){return We(i,[],e)}function Ae(i){if(i)throw new Error("Proxy has been released and is not useable")}function ht(i){return le(i,{type:"RELEASE"}).then(()=>{ct(i)})}const Se=new WeakMap,Ie="FinalizationRegistry"in globalThis&&new FinalizationRegistry(i=>{const e=(Se.get(i)||0)-1;Se.set(i,e),e===0&&ht(i)});function qt(i,e){const t=(Se.get(e)||0)+1;Se.set(e,t),Ie&&Ie.register(i,e,i)}function Wt(i){Ie&&Ie.unregister(i)}function We(i,e=[],t=function(){}){let s=!1;const n=new Proxy(t,{get(r,o){if(Ae(s),o===ue)return()=>{Wt(n),ht(i),s=!0};if(o==="then"){if(e.length===0)return{then:()=>n};const a=le(i,{type:"GET",path:e.map(c=>c.toString())}).then(se);return a.then.bind(a)}return We(i,[...e,o])},set(r,o,a){Ae(s);const[c,h]=ze(a);return le(i,{type:"SET",path:[...e,o].map(u=>u.toString()),value:c},h).then(se)},apply(r,o,a){Ae(s);const c=e[e.length-1];if(c===J)return le(i,{type:"ENDPOINT"}).then(se);if(c==="bind")return We(i,e.slice(0,-1));const[h,u]=ut(a);return le(i,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:h},u).then(se)},construct(r,o){Ae(s);const[a,c]=ut(o);return le(i,{type:"CONSTRUCT",path:e.map(h=>h.toString()),argumentList:a},c).then(se)}});return qt(n,i),n}function $t(i){return Array.prototype.concat.apply([],i)}function ut(i){const e=i.map(ze);return[e.map(t=>t[0]),$t(e.map(t=>t[1]))]}const lt=new WeakMap;function Jt(i,e){return lt.set(i,e),i}function Xt(i){return Object.assign(i,{[D]:!0})}function ze(i){for(const[e,t]of at)if(t.canHandle(i)){const[s,n]=t.serialize(i);return[{type:"HANDLER",name:e,value:s},n]}return[{type:"RAW",value:i},lt.get(i)||[]]}function se(i){switch(i.type){case"HANDLER":return at.get(i.name).deserialize(i.value);case"RAW":return i.value}}function le(i,e,t){return new Promise(s=>{const n=Zt();i.addEventListener("message",function r(o){!o.data||!o.data.id||o.data.id!==n||(i.removeEventListener("message",r),s(o.data))}),i.start&&i.start(),i.postMessage(Object.assign({id:n},e),t)})}function Zt(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class Ne{constructor(e,t=1,s="DATA"){me(this,"__name");me(this,"__version");me(this,"__storeName");me(this,"__logEnabled");me(this,"__db");this.__name=e,this.__version=t,this.__storeName=s,this.__logEnabled=!1}enableLog(){this.__logEnabled=!0}__logStart(e){this.__logEnabled&&console.time(`ModelStoreLog_${this.__name}_${this.__storeName}_${e}`)}__logEnd(e){this.__logEnabled&&console.timeEnd(`ModelStoreLog_${this.__name}_${this.__storeName}_${e}`)}close(){return new Promise(e=>{this.__db&&(this.__db.close(),e(!0))})}__open(){return new Promise((e,t)=>{if(this.__db)e(this.__db);else{const s=indexedDB.open(this.__name,this.__version);s.onupgradeneeded=()=>{const n=s.result;n.objectStoreNames.contains(this.__name)||n.createObjectStore(this.__storeName)},s.onblocked=n=>{this.__logEnd("getKey"),t({type:"onblocked",event:n})},s.onerror=n=>{this.__logEnd("getKey"),t({type:"onblocked",event:n})},s.onsuccess=()=>{this.__db=s.result,e(s.result)}}})}getUUID(){return crypto.randomUUID()}getJsonKey(e){return new Promise(async(t,s)=>{this.__logStart("getKey");try{const r=(await this.__open()).transaction(this.__storeName);r.onerror=c=>{this.__logEnd("getKey"),s({type:"store tx error",event:c})};const a=r.objectStore(this.__storeName).get(e);a.onsuccess=()=>{this.__logEnd("getKey"),t(a.result)}}catch(n){this.__logEnd("getKey"),s(n)}})}getBufferKey(e){return new Promise(async(t,s)=>{this.__logStart("getKey");try{const r=(await this.__open()).transaction(this.__storeName);r.onerror=c=>{this.__logEnd("getKey"),s({type:"store tx error",event:c})};const a=r.objectStore(this.__storeName).get(e);a.onsuccess=()=>{this.__logEnd("getKey"),t(a.result)}}catch(n){this.__logEnd("getKey"),s(n)}})}setJsonKey(e,t){return new Promise(async(s,n)=>{var r;this.__logStart("setKey");try{const a=(await this.__open()).transaction(this.__storeName,"readwrite");a.onerror=u=>{this.__logEnd("setKey"),n({type:"store tx error",event:u})};const h=a.objectStore(this.__storeName).put(t,e);h.onsuccess=()=>{this.__logEnd("setKey"),s(h.result)},(r=h.transaction)==null||r.commit()}catch(o){this.__logEnd("setKey"),n(o)}})}setBufferKey(e,t){return new Promise(async(s,n)=>{var r;this.__logStart("setKey");try{const a=(await this.__open()).transaction(this.__storeName,"readwrite");a.onerror=u=>{this.__logEnd("setKey"),n({type:"store tx error",event:u})};const h=a.objectStore(this.__storeName).put(t,e);h.onsuccess=()=>{this.__logEnd("setKey"),s(h.result)},(r=h.transaction)==null||r.commit()}catch(o){this.__logEnd("setKey"),n(o)}})}deleteKey(e){return new Promise(async(t,s)=>{this.__logStart("deleteKey");try{const r=(await this.__open()).transaction(this.__storeName,"readwrite");r.onerror=c=>{this.__logEnd("deleteKey"),s({type:"store tx error",event:c})};const a=r.objectStore(this.__storeName).delete(e);a.onsuccess=()=>{this.__logEnd("deleteKey"),t(a.result)}}catch(n){this.__logEnd("deleteKey"),s(n)}})}deleteDB(){return new Promise((e,t)=>{this.__logStart("deleteDB");const s=indexedDB.deleteDatabase(this.__name);s.onsuccess=()=>{this.__logEnd("deleteDB"),e(!0)},s.onerror=n=>{this.__logEnd("deleteDB"),t({type:"onblocked",event:n})}})}}const $e="APP_CONFIG";async function Dt(i=!1){const e=new Ne($e);if(i){window||console.error("update storage can only be used on main tread"),window.__APP_DEV_ENV&&(window.__APP_ENV=window.__APP_DEV_ENV);const t=window.__APP_ENV||{};return await e.setJsonKey($e,t),t}return await e.getJsonKey($e)}async function Qt(i,e,t,s=!1){const n=await Dt();return await fetch(`${n.ENV__AZURE_STORAGE_URL}/${e}/${t}?${i}`,{headers:{"cache-control":"no-cache"},method:s?"HEAD":"GET"})}class Je{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t),this}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const s=this._listeners[e.type];if(s!==void 0){const n=s.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class fe extends Je{constructor(e,t,s,n={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=s,this._attributes=n,!t.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class es extends Je{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(t=>t.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(t=>t.getChild())}disconnectParents(e,t){let s=this.listParentEdges(e);return t&&(s=s.filter(n=>t(n.getParent()))),s.forEach(n=>n.dispose()),this}createEdge(e,t,s,n){return this._registerEdge(new fe(e,t,s,n))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const s=e.getChild();return this._childEdges.has(s)||this._childEdges.set(s,new Set),this._childEdges.get(s).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function xe(){return xe=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},xe.apply(this,arguments)}class ne{constructor(e){if(this.list=[],e)for(const t of e)this.list.push(t)}add(e){this.list.push(e)}remove(e){const t=this.list.indexOf(e);t>=0&&this.list.splice(t,1)}removeChild(e){const t=[];for(const s of this.list)s.getChild()===e&&t.push(s);for(const s of t)this.remove(s);return t}listRefsByChild(e){const t=[];for(const s of this.list)s.getChild()===e&&t.push(s);return t}values(){return this.list}}class L{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const t of e)this.add(t)}add(e){const t=e.getChild();this.removeChild(t),this.set.add(e),this.map.set(t,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const t=this.map.get(e)||null;return t&&this.remove(t),t}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class X{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,t){this.map[e]=t}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const F=Symbol("attributes"),de=Symbol("immutableKeys");class Xe extends Je{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[F]=void 0,this[de]=void 0,this.graph=e,this[de]=new Set,this[F]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const s in e){const n=e[s];if(n instanceof Xe){const r=this.graph.createEdge(s,this,n);r.addEventListener("dispose",()=>n.dispose()),this[de].add(s),t[s]=r}else t[s]=n}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const s in this[F]){const n=this[F][s];if(n instanceof fe){const r=n;r.getChild()===e&&this.setRef(s,t,r.getAttributes())}else if(n instanceof ne)for(const r of n.listRefsByChild(e)){const o=r.getAttributes();this.removeRef(s,e),this.addRef(s,t,o)}else if(n instanceof L){const r=n.getRefByChild(e);if(r){const o=r.getAttributes();this.removeRef(s,e),this.addRef(s,t,o)}}else if(n instanceof X)for(const r of n.keys()){const o=n.get(r);o.getChild()===e&&this.setRefMap(s,r,t,o.getAttributes())}}return this}get(e){return this[F][e]}set(e,t){return this[F][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[F][e];return t?t.getChild():null}setRef(e,t,s){if(this[de].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const n=this[F][e];if(n&&n.dispose(),!t)return this;const r=this.graph.createEdge(e,this,t,s);return r.addEventListener("dispose",()=>{delete this[F][e],this.dispatchEvent({type:"change",attribute:e})}),this[F][e]=r,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(s=>s.getChild())}addRef(e,t,s){const n=this.graph.createEdge(e,this,t,s),r=this.assertRefList(e);return r.add(n),n.addEventListener("dispose",()=>{r.remove(n),this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){const s=this.assertRefList(e);if(s instanceof ne)for(const n of s.removeChild(t))n.dispose();else{const n=s.removeChild(t);n&&n.dispose()}return this}assertRefList(e){const t=this[F][e];if(t instanceof ne||t instanceof L)return t;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(t=>t.getChild())}getRefMap(e,t){const n=this.assertRefMap(e).get(t);return n?n.getChild():null}setRefMap(e,t,s,n){const r=this.assertRefMap(e),o=r.get(t);if(o&&o.dispose(),!s)return this;n=Object.assign(n||{},{key:t});const a=this.graph.createEdge(e,this,s,xe({},n,{key:t}));return a.addEventListener("dispose",()=>{r.delete(t),this.dispatchEvent({type:"change",attribute:e,key:t})}),r.set(t,a),this.dispatchEvent({type:"change",attribute:e,key:t})}assertRefMap(e){const t=this[F][e];if(t instanceof X)return t;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(xe({},e,{target:this})),this.graph.dispatchEvent(xe({},e,{target:this,type:`node:${e.type}`})),this}}const ft="v4.0.8",Ce="@glb.bin";var N;(function(i){i.ACCESSOR="Accessor",i.ANIMATION="Animation",i.ANIMATION_CHANNEL="AnimationChannel",i.ANIMATION_SAMPLER="AnimationSampler",i.BUFFER="Buffer",i.CAMERA="Camera",i.MATERIAL="Material",i.MESH="Mesh",i.PRIMITIVE="Primitive",i.PRIMITIVE_TARGET="PrimitiveTarget",i.NODE="Node",i.ROOT="Root",i.SCENE="Scene",i.SKIN="Skin",i.TEXTURE="Texture",i.TEXTURE_INFO="TextureInfo"})(N||(N={}));var Oe;(function(i){i.INTERLEAVED="interleaved",i.SEPARATE="separate"})(Oe||(Oe={}));var Y;(function(i){i.ARRAY_BUFFER="ARRAY_BUFFER",i.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",i.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",i.OTHER="OTHER",i.SPARSE="SPARSE"})(Y||(Y={}));var Ze;(function(i){i[i.R=4096]="R",i[i.G=256]="G",i[i.B=16]="B",i[i.A=1]="A"})(Ze||(Ze={}));var re;(function(i){i.GLTF="GLTF",i.GLB="GLB"})(re||(re={}));const ve={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var De=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function ts(){var i=new De(3);return De!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Qe(i){var e=i[0],t=i[1],s=i[2];return Math.hypot(e,t,s)}(function(){var i=ts();return function(e,t,s,n,r,o){var a,c;for(t||(t=3),s||(s=0),n?c=Math.min(n*t+s,e.length):c=e.length,a=s;a<c;a+=t)i[0]=e[a],i[1]=e[a+1],i[2]=e[a+2],r(i,i,o),e[a]=i[0],e[a+1]=i[1],e[a+2]=i[2];return e}})();class U{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),s=new Uint8Array(t.length);for(let n=0;n<t.length;n++)s[n]=t.charCodeAt(n);return s}else{const t=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(t,s?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const r of e)t+=r.byteLength;const s=new Uint8Array(t);let n=0;for(const r of e)s.set(r,n),n+=r.byteLength;return s}static pad(e,t=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const n=new Uint8Array(s);if(n.set(e),t!==0)for(let r=e.byteLength;r<s;r++)n[r]=t;return n}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==t[s])return!1;return!0}static toView(e,t=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class ss{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let t=new DataView(e.buffer,e.byteOffset+4),s,n;for(;t.byteLength;){if(s=t.getUint16(0,!1),ns(t,s),n=t.getUint8(s+1),n===192||n===193||n===194)return[t.getUint16(s+7,!1),t.getUint16(s+5,!1)];t=new DataView(e.buffer,t.byteOffset+s+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class Be{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return U.decodeText(e.slice(12,16))===Be.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}Be.PNG_FRIED_CHUNK_NAME="CgBI";class ie{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let s=0;const n=4,r=this.getSize(e,t);if(!r)return null;for(;r[0]>1||r[1]>1;)s+=r[0]*r[1]*n,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return s+=1*1*n,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}ie.impls={"image/jpeg":new ss,"image/png":new Be};function ns(i,e){if(e>i.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(i.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return i}class ge{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return ie.mimeTypeToExtension(t)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}function dt(i){return Object.prototype.toString.call(i)==="[object Object]"}function oe(i){if(dt(i)===!1)return!1;const e=i.constructor;if(e===void 0)return!0;const t=e.prototype;return!(dt(t)===!1||Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")===!1)}var et,tt;(function(i){i[i.SILENT=4]="SILENT",i[i.ERROR=3]="ERROR",i[i.WARN=2]="WARN",i[i.INFO=1]="INFO",i[i.DEBUG=0]="DEBUG"})(tt||(tt={}));class q{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=q.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=q.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=q.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=q.Verbosity.ERROR&&console.error(e)}}et=q,q.Verbosity=tt,q.DEFAULT_INSTANCE=new et(et.Verbosity.INFO);function rs(i){var e=i[0],t=i[1],s=i[2],n=i[3],r=i[4],o=i[5],a=i[6],c=i[7],h=i[8],u=i[9],d=i[10],g=i[11],p=i[12],E=i[13],R=i[14],b=i[15],l=e*o-t*r,S=e*a-s*r,w=e*c-n*r,M=t*a-s*o,m=t*c-n*o,x=s*c-n*a,f=h*E-u*p,y=h*R-d*p,T=h*b-g*p,_=u*R-d*E,A=u*b-g*E,I=d*b-g*R;return l*I-S*A+w*_+M*T-m*y+x*f}function is(i,e,t){var s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],c=e[5],h=e[6],u=e[7],d=e[8],g=e[9],p=e[10],E=e[11],R=e[12],b=e[13],l=e[14],S=e[15],w=t[0],M=t[1],m=t[2],x=t[3];return i[0]=w*s+M*a+m*d+x*R,i[1]=w*n+M*c+m*g+x*b,i[2]=w*r+M*h+m*p+x*l,i[3]=w*o+M*u+m*E+x*S,w=t[4],M=t[5],m=t[6],x=t[7],i[4]=w*s+M*a+m*d+x*R,i[5]=w*n+M*c+m*g+x*b,i[6]=w*r+M*h+m*p+x*l,i[7]=w*o+M*u+m*E+x*S,w=t[8],M=t[9],m=t[10],x=t[11],i[8]=w*s+M*a+m*d+x*R,i[9]=w*n+M*c+m*g+x*b,i[10]=w*r+M*h+m*p+x*l,i[11]=w*o+M*u+m*E+x*S,w=t[12],M=t[13],m=t[14],x=t[15],i[12]=w*s+M*a+m*d+x*R,i[13]=w*n+M*c+m*g+x*b,i[14]=w*r+M*h+m*p+x*l,i[15]=w*o+M*u+m*E+x*S,i}function os(i,e){var t=e[0],s=e[1],n=e[2],r=e[4],o=e[5],a=e[6],c=e[8],h=e[9],u=e[10];return i[0]=Math.hypot(t,s,n),i[1]=Math.hypot(r,o,a),i[2]=Math.hypot(c,h,u),i}function as(i,e){var t=new De(3);os(t,e);var s=1/t[0],n=1/t[1],r=1/t[2],o=e[0]*s,a=e[1]*n,c=e[2]*r,h=e[4]*s,u=e[5]*n,d=e[6]*r,g=e[8]*s,p=e[9]*n,E=e[10]*r,R=o+u+E,b=0;return R>0?(b=Math.sqrt(R+1)*2,i[3]=.25*b,i[0]=(d-p)/b,i[1]=(g-c)/b,i[2]=(a-h)/b):o>u&&o>E?(b=Math.sqrt(1+o-u-E)*2,i[3]=(d-p)/b,i[0]=.25*b,i[1]=(a+h)/b,i[2]=(g+c)/b):u>E?(b=Math.sqrt(1+u-o-E)*2,i[3]=(g-c)/b,i[0]=(a+h)/b,i[1]=.25*b,i[2]=(d+p)/b):(b=Math.sqrt(1+E-o-u)*2,i[3]=(a-h)/b,i[0]=(g+c)/b,i[1]=(d+p)/b,i[2]=.25*b),i}class V{static identity(e){return e}static eq(e,t,s=1e-5){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>s)return!1;return!0}static clamp(e,t,s){return e<t?t:e>s?s:e}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(V.clamp(e,0,1)*65535);case 5121:return Math.round(V.clamp(e,0,1)*255);case 5122:return Math.round(V.clamp(e,-1,1)*32767);case 5120:return Math.round(V.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,t,s,n){let r=Qe([e[0],e[1],e[2]]);const o=Qe([e[4],e[5],e[6]]),a=Qe([e[8],e[9],e[10]]);rs(e)<0&&(r=-r),t[0]=e[12],t[1]=e[13],t[2]=e[14];const h=e.slice(),u=1/r,d=1/o,g=1/a;h[0]*=u,h[1]*=u,h[2]*=u,h[4]*=d,h[5]*=d,h[6]*=d,h[8]*=g,h[9]*=g,h[10]*=g,as(s,h),n[0]=r,n[1]=o,n[2]=a}static compose(e,t,s,n){const r=n,o=t[0],a=t[1],c=t[2],h=t[3],u=o+o,d=a+a,g=c+c,p=o*u,E=o*d,R=o*g,b=a*d,l=a*g,S=c*g,w=h*u,M=h*d,m=h*g,x=s[0],f=s[1],y=s[2];return r[0]=(1-(b+S))*x,r[1]=(E+m)*x,r[2]=(R-M)*x,r[3]=0,r[4]=(E-m)*f,r[5]=(1-(p+S))*f,r[6]=(l+w)*f,r[7]=0,r[8]=(R+M)*y,r[9]=(l-w)*y,r[10]=(1-(p+b))*y,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}}function cs(i,e){if(!!i!=!!e)return!1;const t=i.getChild(),s=e.getChild();return t===s||t.equals(s)}function hs(i,e){if(!!i!=!!e)return!1;const t=i.values(),s=e.values();if(t.length!==s.length)return!1;for(let n=0;n<t.length;n++){const r=t[n],o=s[n];if(r.getChild()!==o.getChild()&&!r.getChild().equals(o.getChild()))return!1}return!0}function us(i,e){if(!!i!=!!e)return!1;const t=i.keys(),s=e.keys();if(t.length!==s.length)return!1;for(const n of t){const r=i.get(n),o=e.get(n);if(!!r!=!!o)return!1;const a=r.getChild(),c=o.getChild();if(a!==c&&!a.equals(c))return!1}return!0}function gt(i,e){if(i===e)return!0;if(!!i!=!!e||!i||!e||i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}function pt(i,e){if(i===e)return!0;if(!!i!=!!e)return!1;if(!oe(i)||!oe(e))return i===e;const t=i,s=e;let n=0,r=0,o;for(o in t)n++;for(o in s)r++;if(n!==r)return!1;for(o in t){const a=t[o],c=s[o];if(Ue(a)&&Ue(c)){if(!gt(a,c))return!1}else if(oe(a)&&oe(c)){if(!pt(a,c))return!1}else if(a!==c)return!1}return!0}function Ue(i){return Array.isArray(i)||ArrayBuffer.isView(i)}const yt="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",ls=999,fs=6,mt=new Set,ds=function(){let e="";for(let t=0;t<fs;t++)e+=yt.charAt(Math.floor(Math.random()*yt.length));return e},gs=function(){for(let e=0;e<ls;e++){const t=ds();if(!mt.has(t))return mt.add(t),t}return""},xt="https://null.example";class Ee{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return ge.basename(new URL(e,xt).pathname)}static extension(e){return ge.extension(new URL(e,xt).pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const s=e.split("/"),n=t.split("/");s.pop();for(let r=0;r<n.length;r++)n[r]!=="."&&(n[r]===".."?s.pop():s.push(n[r]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Ee.DEFAULT_INIT={},Ee.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Q=i=>i,ps=new Set;class st extends Xe{constructor(e,t=""){super(e),this[F].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,Q)}copy(e,t=Q){for(const s in this[F]){const n=this[F][s];if(n instanceof fe)this[de].has(s)||n.dispose();else if(n instanceof ne||n instanceof L)for(const r of n.values())r.dispose();else if(n instanceof X)for(const r of n.values())r.dispose()}for(const s in e[F]){const n=this[F][s],r=e[F][s];if(r instanceof fe)this[de].has(s)?n.getChild().copy(t(r.getChild()),t):this.setRef(s,t(r.getChild()),r.getAttributes());else if(r instanceof L||r instanceof ne)for(const o of r.values())this.addRef(s,t(o.getChild()),o.getAttributes());else if(r instanceof X)for(const o of r.keys()){const a=r.get(o);this.setRefMap(s,o,t(a.getChild()),a.getAttributes())}else oe(r)?this[F][s]=JSON.parse(JSON.stringify(r)):Array.isArray(r)||r instanceof ArrayBuffer||ArrayBuffer.isView(r)?this[F][s]=r.slice():this[F][s]=r}return this}equals(e,t=ps){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[F]){if(t.has(s))continue;const n=this[F][s],r=e[F][s];if(n instanceof fe||r instanceof fe){if(!cs(n,r))return!1}else if(n instanceof L||r instanceof L||n instanceof ne||r instanceof ne){if(!hs(n,r))return!1}else if(n instanceof X||r instanceof X){if(!us(n,r))return!1}else if(oe(n)||oe(r)){if(!pt(n,r))return!1}else if(Ue(n)||Ue(r)){if(!gt(n,r))return!1}else if(n!==r)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class G extends st{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new X})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t._validateParent(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class O extends G{init(){this.propertyType=N.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:O.Type.SCALAR,componentType:O.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case O.Type.SCALAR:return 1;case O.Type.VEC2:return 2;case O.Type.VEC3:return 3;case O.Type.VEC4:return 4;case O.Type.MAT2:return 4;case O.Type.MAT3:return 9;case O.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case O.ComponentType.BYTE:return 1;case O.ComponentType.UNSIGNED_BYTE:return 1;case O.ComponentType.SHORT:return 2;case O.ComponentType.UNSIGNED_SHORT:return 2;case O.ComponentType.UNSIGNED_INT:return 4;case O.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getNormalized(),s=this.getElementSize(),n=this.getComponentType();if(this.getMin(e),t)for(let r=0;r<s;r++)e[r]=V.decodeNormalizedInt(e[r],n);return e}getMin(e){const t=this.getArray(),s=this.getCount(),n=this.getElementSize();for(let r=0;r<n;r++)e[r]=1/0;for(let r=0;r<s*n;r+=n)for(let o=0;o<n;o++){const a=t[r+o];Number.isFinite(a)&&(e[o]=Math.min(e[o],a))}return e}getMaxNormalized(e){const t=this.getNormalized(),s=this.getElementSize(),n=this.getComponentType();if(this.getMax(e),t)for(let r=0;r<s;r++)e[r]=V.decodeNormalizedInt(e[r],n);return e}getMax(e){const t=this.get("array"),s=this.getCount(),n=this.getElementSize();for(let r=0;r<n;r++)e[r]=-1/0;for(let r=0;r<s*n;r+=n)for(let o=0;o<n;o++){const a=t[r+o];Number.isFinite(a)&&(e[o]=Math.max(e[o],a))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return O.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const t=this.getElementSize(),s=this.getComponentType(),n=this.getArray();return this.getNormalized()?V.decodeNormalizedInt(n[e*t],s):n[e*t]}setScalar(e,t){const s=this.getElementSize(),n=this.getComponentType(),r=this.getArray();return this.getNormalized()?r[e*s]=V.encodeNormalizedInt(t,n):r[e*s]=t,this}getElement(e,t){const s=this.getNormalized(),n=this.getElementSize(),r=this.getComponentType(),o=this.getArray();for(let a=0;a<n;a++)s?t[a]=V.decodeNormalizedInt(o[e*n+a],r):t[a]=o[e*n+a];return t}setElement(e,t){const s=this.getNormalized(),n=this.getElementSize(),r=this.getComponentType(),o=this.getArray();for(let a=0;a<n;a++)s?o[e*n+a]=V.encodeNormalizedInt(t[a],r):o[e*n+a]=t[a];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?ys(e):O.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}O.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},O.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function ys(i){switch(i.constructor){case Float32Array:return O.ComponentType.FLOAT;case Uint32Array:return O.ComponentType.UNSIGNED_INT;case Uint16Array:return O.ComponentType.UNSIGNED_SHORT;case Uint8Array:return O.ComponentType.UNSIGNED_BYTE;case Int16Array:return O.ComponentType.SHORT;case Int8Array:return O.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class Et extends G{init(){this.propertyType=N.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new L,samplers:new L})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class _t extends G{init(){this.propertyType=N.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}_t.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class _e extends G{init(){this.propertyType=N.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:_e.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Y.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Y.OTHER})}}_e.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class wt extends G{init(){this.propertyType=N.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class ae extends G{init(){this.propertyType=N.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:ae.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}ae.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class ms extends st{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}ms.EXTENSION_NAME=void 0;class W extends G{init(){this.propertyType=N.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:W.WrapMode.REPEAT,wrapT:W.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}W.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},W.MagFilter={NEAREST:9728,LINEAR:9729},W.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Fe,G:Pe,B:Le,A:xs}=Ze;class ce extends G{init(){this.propertyType=N.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:ce.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new W(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new W(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new W(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new W(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new W(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Fe|Pe|Le|xs,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Fe|Pe|Le,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Fe|Pe|Le})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Fe})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Pe|Le})}}ce.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class Tt extends G{init(){this.propertyType=N.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new L})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class Mt extends G{init(){this.propertyType=N.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new L})}copy(e,t=Q){if(t===Q)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return V.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),s=this.get("rotation").slice(),n=this.get("scale").slice();return V.decompose(e,t,s,n),this.set("translation",t).set("rotation",s).set("scale",n)}getWorldTranslation(){const e=[0,0,0];return V.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return V.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return V.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let n=this;n!=null;n=n.getParentNode())e.push(n);let t;const s=e.pop().getMatrix();for(;t=e.pop();)is(s,s,t.getMatrix());return s}addChild(e){const t=e.getParentNode();t&&t.removeChild(e);for(const s of e.listParents())s.propertyType===N.SCENE&&s.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===N.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class Ve extends G{init(){this.propertyType=N.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Ve.Mode.TRIANGLES,material:null,indices:null,attributes:new X,targets:new L})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Y.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Y.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}Ve.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Es extends st{init(){this.propertyType=N.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new X})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Y.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function K(){return K=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},K.apply(this,arguments)}class Rt extends G{init(){this.propertyType=N.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new L})}copy(e,t=Q){if(t===Q)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){const t=e.getParentNode();return t&&t.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class bt extends G{init(){this.propertyType=N.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new L})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Y.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class At extends G{init(){this.propertyType=N.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||ie.extensionToMimeType(ge.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=ie.extensionToMimeType(ge.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",U.assertView(e))}getSize(){const e=this.get("image");return e?ie.getSize(e,this.getMimeType()):null}}class _s extends G{init(){this.propertyType=N.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${ft}`,version:"2.0"},defaultScene:null,accessors:new L,animations:new L,buffers:new L,cameras:new L,materials:new L,meshes:new L,nodes:new L,scenes:new L,skins:new L,textures:new L})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",t=>{this._addChildOfRoot(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=Q){if(t===Q)throw new Error("Root cannot be copied.");this.set("asset",K({},e.get("asset"))),this.setName(e.getName()),this.setExtras(K({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const n=e.getExtension(s);this.setExtension(s,t(n))}return this}_addChildOfRoot(e){return e instanceof Rt?this.addRef("scenes",e):e instanceof Mt?this.addRef("nodes",e):e instanceof ae?this.addRef("cameras",e):e instanceof bt?this.addRef("skins",e):e instanceof Tt?this.addRef("meshes",e):e instanceof ce?this.addRef("materials",e):e instanceof At?this.addRef("textures",e):e instanceof Et?this.addRef("animations",e):e instanceof O?this.addRef("accessors",e):e instanceof wt&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class we{static fromGraph(e){return we._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new es,this._root=new _s(this._graph),this._logger=q.DEFAULT_INSTANCE,we._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const t=e.map(s=>s.name);for(const s of e)await s(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===t)||new e(this)}createScene(e=""){return new Rt(this._graph,e)}createNode(e=""){return new Mt(this._graph,e)}createCamera(e=""){return new ae(this._graph,e)}createSkin(e=""){return new bt(this._graph,e)}createMesh(e=""){return new Tt(this._graph,e)}createPrimitive(){return new Ve(this._graph)}createPrimitiveTarget(e=""){return new Es(this._graph,e)}createMaterial(e=""){return new ce(this._graph,e)}createTexture(e=""){return new At(this._graph,e)}createAnimation(e=""){return new Et(this._graph,e)}createAnimationChannel(e=""){return new _t(this._graph,e)}createAnimationSampler(e=""){return new _e(this._graph,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new O(this._graph,e).setBuffer(t)}createBuffer(e=""){return new wt(this._graph,e)}}we._GRAPH_DOCUMENTS=new WeakMap;class ws{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const s=this.jsonDoc.json.textures[t.index];if(s.sampler===void 0)return;const n=this.jsonDoc.json.samplers[s.sampler];n.magFilter!==void 0&&e.setMagFilter(n.magFilter),n.minFilter!==void 0&&e.setMinFilter(n.minFilter),n.wrapS!==void 0&&e.setWrapS(n.wrapS),n.wrapT!==void 0&&e.setWrapT(n.wrapT)}}const St={logger:q.DEFAULT_INSTANCE,extensions:[],dependencies:{}},Ts=new Set([N.BUFFER,N.TEXTURE,N.MATERIAL,N.MESH,N.PRIMITIVE,N.NODE,N.SCENE]);class Ms{static read(e,t=St){const s=K({},St,t),{json:n}=e,r=new we().setLogger(s.logger);this.validate(e,s);const o=new ws(e),a=n.asset,c=r.getRoot().getAsset();a.copyright&&(c.copyright=a.copyright),a.extras&&(c.extras=a.extras),n.extras!==void 0&&r.getRoot().setExtras(K({},n.extras));const h=n.extensionsUsed||[],u=n.extensionsRequired||[];s.extensions.sort((f,y)=>f.EXTENSION_NAME>y.EXTENSION_NAME?1:-1);for(const f of s.extensions)if(h.includes(f.EXTENSION_NAME)){const y=r.createExtension(f).setRequired(u.includes(f.EXTENSION_NAME)),T=y.prereadTypes.filter(_=>!Ts.has(_));T.length&&s.logger.warn(`Preread hooks for some types (${T.join()}), requested by extension ${y.extensionName}, are unsupported. Please file an issue or a PR.`);for(const _ of y.readDependencies)y.install(_,s.dependencies[_])}const d=n.buffers||[];r.getRoot().listExtensionsUsed().filter(f=>f.prereadTypes.includes(N.BUFFER)).forEach(f=>f.preread(o,N.BUFFER)),o.buffers=d.map(f=>{const y=r.createBuffer(f.name);return f.extras&&y.setExtras(f.extras),f.uri&&f.uri.indexOf("__")!==0&&y.setURI(f.uri),y});const g=n.bufferViews||[];o.bufferViewBuffers=g.map((f,y)=>{if(!o.bufferViews[y]){const T=e.json.buffers[f.buffer],_=T.uri?e.resources[T.uri]:e.resources[Ce],A=f.byteOffset||0;o.bufferViews[y]=U.toView(_,A,f.byteLength)}return o.buffers[f.buffer]});const p=n.accessors||[];o.accessors=p.map(f=>{const y=o.bufferViewBuffers[f.bufferView],T=r.createAccessor(f.name,y).setType(f.type);return f.extras&&T.setExtras(f.extras),f.normalized!==void 0&&T.setNormalized(f.normalized),f.bufferView===void 0||T.setArray(je(f,o)),T});const E=n.images||[],R=n.textures||[];r.getRoot().listExtensionsUsed().filter(f=>f.prereadTypes.includes(N.TEXTURE)).forEach(f=>f.preread(o,N.TEXTURE)),o.textures=E.map(f=>{const y=r.createTexture(f.name);if(f.extras&&y.setExtras(f.extras),f.bufferView!==void 0){const T=n.bufferViews[f.bufferView],_=e.json.buffers[T.buffer],A=_.uri?e.resources[_.uri]:e.resources[Ce],I=T.byteOffset||0,z=T.byteLength,v=A.slice(I,I+z);y.setImage(v)}else f.uri!==void 0&&(y.setImage(e.resources[f.uri]),f.uri.indexOf("__")!==0&&y.setURI(f.uri));if(f.mimeType!==void 0)y.setMimeType(f.mimeType);else if(f.uri){const T=ge.extension(f.uri);y.setMimeType(ie.extensionToMimeType(T))}return y}),r.getRoot().listExtensionsUsed().filter(f=>f.prereadTypes.includes(N.MATERIAL)).forEach(f=>f.preread(o,N.MATERIAL));const b=n.materials||[];o.materials=b.map(f=>{const y=r.createMaterial(f.name);f.extras&&y.setExtras(f.extras),f.alphaMode!==void 0&&y.setAlphaMode(f.alphaMode),f.alphaCutoff!==void 0&&y.setAlphaCutoff(f.alphaCutoff),f.doubleSided!==void 0&&y.setDoubleSided(f.doubleSided);const T=f.pbrMetallicRoughness||{};if(T.baseColorFactor!==void 0&&y.setBaseColorFactor(T.baseColorFactor),f.emissiveFactor!==void 0&&y.setEmissiveFactor(f.emissiveFactor),T.metallicFactor!==void 0&&y.setMetallicFactor(T.metallicFactor),T.roughnessFactor!==void 0&&y.setRoughnessFactor(T.roughnessFactor),T.baseColorTexture!==void 0){const _=T.baseColorTexture,A=o.textures[R[_.index].source];y.setBaseColorTexture(A),o.setTextureInfo(y.getBaseColorTextureInfo(),_)}if(f.emissiveTexture!==void 0){const _=f.emissiveTexture,A=o.textures[R[_.index].source];y.setEmissiveTexture(A),o.setTextureInfo(y.getEmissiveTextureInfo(),_)}if(f.normalTexture!==void 0){const _=f.normalTexture,A=o.textures[R[_.index].source];y.setNormalTexture(A),o.setTextureInfo(y.getNormalTextureInfo(),_),f.normalTexture.scale!==void 0&&y.setNormalScale(f.normalTexture.scale)}if(f.occlusionTexture!==void 0){const _=f.occlusionTexture,A=o.textures[R[_.index].source];y.setOcclusionTexture(A),o.setTextureInfo(y.getOcclusionTextureInfo(),_),f.occlusionTexture.strength!==void 0&&y.setOcclusionStrength(f.occlusionTexture.strength)}if(T.metallicRoughnessTexture!==void 0){const _=T.metallicRoughnessTexture,A=o.textures[R[_.index].source];y.setMetallicRoughnessTexture(A),o.setTextureInfo(y.getMetallicRoughnessTextureInfo(),_)}return y}),r.getRoot().listExtensionsUsed().filter(f=>f.prereadTypes.includes(N.MESH)).forEach(f=>f.preread(o,N.MESH));const l=n.meshes||[];r.getRoot().listExtensionsUsed().filter(f=>f.prereadTypes.includes(N.PRIMITIVE)).forEach(f=>f.preread(o,N.PRIMITIVE)),o.meshes=l.map(f=>{const y=r.createMesh(f.name);return f.extras&&y.setExtras(f.extras),f.weights!==void 0&&y.setWeights(f.weights),(f.primitives||[]).forEach(_=>{const A=r.createPrimitive();_.extras&&A.setExtras(_.extras),_.material!==void 0&&A.setMaterial(o.materials[_.material]),_.mode!==void 0&&A.setMode(_.mode);for(const[v,C]of Object.entries(_.attributes||{}))A.setAttribute(v,o.accessors[C]);_.indices!==void 0&&A.setIndices(o.accessors[_.indices]);const I=f.extras&&f.extras.targetNames||[];(_.targets||[]).forEach((v,C)=>{const B=I[C]||C.toString(),P=r.createPrimitiveTarget(B);for(const[k,j]of Object.entries(v))P.setAttribute(k,o.accessors[j]);A.addTarget(P)}),y.addPrimitive(A)}),y});const S=n.cameras||[];o.cameras=S.map(f=>{const y=r.createCamera(f.name).setType(f.type);if(f.extras&&y.setExtras(f.extras),f.type===ae.Type.PERSPECTIVE){const T=f.perspective;y.setYFov(T.yfov),y.setZNear(T.znear),T.zfar!==void 0&&y.setZFar(T.zfar),T.aspectRatio!==void 0&&y.setAspectRatio(T.aspectRatio)}else{const T=f.orthographic;y.setZNear(T.znear).setZFar(T.zfar).setXMag(T.xmag).setYMag(T.ymag)}return y});const w=n.nodes||[];r.getRoot().listExtensionsUsed().filter(f=>f.prereadTypes.includes(N.NODE)).forEach(f=>f.preread(o,N.NODE)),o.nodes=w.map(f=>{const y=r.createNode(f.name);if(f.extras&&y.setExtras(f.extras),f.translation!==void 0&&y.setTranslation(f.translation),f.rotation!==void 0&&y.setRotation(f.rotation),f.scale!==void 0&&y.setScale(f.scale),f.matrix!==void 0){const T=[0,0,0],_=[0,0,0,1],A=[1,1,1];V.decompose(f.matrix,T,_,A),y.setTranslation(T),y.setRotation(_),y.setScale(A)}return f.weights!==void 0&&y.setWeights(f.weights),y});const M=n.skins||[];o.skins=M.map(f=>{const y=r.createSkin(f.name);f.extras&&y.setExtras(f.extras),f.inverseBindMatrices!==void 0&&y.setInverseBindMatrices(o.accessors[f.inverseBindMatrices]),f.skeleton!==void 0&&y.setSkeleton(o.nodes[f.skeleton]);for(const T of f.joints)y.addJoint(o.nodes[T]);return y}),w.map((f,y)=>{const T=o.nodes[y];(f.children||[]).forEach(A=>T.addChild(o.nodes[A])),f.mesh!==void 0&&T.setMesh(o.meshes[f.mesh]),f.camera!==void 0&&T.setCamera(o.cameras[f.camera]),f.skin!==void 0&&T.setSkin(o.skins[f.skin])});const m=n.animations||[];o.animations=m.map(f=>{const y=r.createAnimation(f.name);f.extras&&y.setExtras(f.extras);const _=(f.samplers||[]).map(I=>{const z=r.createAnimationSampler().setInput(o.accessors[I.input]).setOutput(o.accessors[I.output]).setInterpolation(I.interpolation||_e.Interpolation.LINEAR);return I.extras&&z.setExtras(I.extras),y.addSampler(z),z});return(f.channels||[]).forEach(I=>{const z=r.createAnimationChannel().setSampler(_[I.sampler]).setTargetPath(I.target.path);I.target.node!==void 0&&z.setTargetNode(o.nodes[I.target.node]),I.extras&&z.setExtras(I.extras),y.addChannel(z)}),y});const x=n.scenes||[];return r.getRoot().listExtensionsUsed().filter(f=>f.prereadTypes.includes(N.SCENE)).forEach(f=>f.preread(o,N.SCENE)),o.scenes=x.map(f=>{const y=r.createScene(f.name);return f.extras&&y.setExtras(f.extras),(f.nodes||[]).map(_=>o.nodes[_]).forEach(_=>y.addChild(_)),y}),n.scene!==void 0&&r.getRoot().setDefaultScene(o.scenes[n.scene]),r.getRoot().listExtensionsUsed().forEach(f=>f.read(o)),p.forEach((f,y)=>{const T=o.accessors[y],_=!!f.sparse,A=!f.bufferView&&!T.getArray();(_||A)&&T.setSparse(!0).setArray(bs(f,o))}),r}static validate(e,t){const s=e.json;if(s.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${s.asset.version}".`);if(s.extensionsRequired){for(const n of s.extensionsRequired)if(!t.extensions.find(r=>r.EXTENSION_NAME===n))throw new Error(`Missing required extension, "${n}".`)}if(s.extensionsUsed)for(const n of s.extensionsUsed)t.extensions.find(r=>r.EXTENSION_NAME===n)||t.logger.warn(`Missing optional extension, "${n}".`)}}function Rs(i,e){const t=e.jsonDoc,s=e.bufferViews[i.bufferView],n=t.json.bufferViews[i.bufferView],r=ve[i.componentType],o=O.getElementSize(i.type),a=r.BYTES_PER_ELEMENT,c=i.byteOffset||0,h=new r(i.count*o),u=new DataView(s.buffer,s.byteOffset,s.byteLength),d=n.byteStride;for(let g=0;g<i.count;g++)for(let p=0;p<o;p++){const E=c+g*d+p*a;let R;switch(i.componentType){case O.ComponentType.FLOAT:R=u.getFloat32(E,!0);break;case O.ComponentType.UNSIGNED_INT:R=u.getUint32(E,!0);break;case O.ComponentType.UNSIGNED_SHORT:R=u.getUint16(E,!0);break;case O.ComponentType.UNSIGNED_BYTE:R=u.getUint8(E);break;case O.ComponentType.SHORT:R=u.getInt16(E,!0);break;case O.ComponentType.BYTE:R=u.getInt8(E);break;default:throw new Error(`Unexpected componentType "${i.componentType}".`)}h[g*o+p]=R}return h}function je(i,e){const t=e.jsonDoc,s=e.bufferViews[i.bufferView],n=t.json.bufferViews[i.bufferView],r=ve[i.componentType],o=O.getElementSize(i.type),a=r.BYTES_PER_ELEMENT,c=o*a;if(n.byteStride!==void 0&&n.byteStride!==c)return Rs(i,e);const h=s.byteOffset+(i.byteOffset||0),u=i.count*o*a;return new r(s.buffer.slice(h,h+u))}function bs(i,e){const t=ve[i.componentType],s=O.getElementSize(i.type);let n;i.bufferView!==void 0?n=je(i,e):n=new t(i.count*s);const r=i.sparse;if(!r)return n;const o=r.count,a=K({},i,r.indices,{count:o,type:"SCALAR"}),c=K({},i,r.values,{count:o}),h=je(a,e),u=je(c,e);for(let d=0;d<a.count;d++)for(let g=0;g<s;g++)n[h[d]*s+g]=u[d*s+g];return n}var Te;(function(i){i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Te||(Te={}));class he{constructor(e,t,s){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=t,this.options=s;const n=e.getRoot(),r=n.listBuffers().length,o=n.listTextures().length;this.bufferURIGenerator=new It(r>1,()=>s.basename||"buffer"),this.imageURIGenerator=new It(o>1,a=>As(e,a)||s.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const s={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},n=JSON.stringify(s);this.samplerDefIndexMap.has(n)||(this.samplerDefIndexMap.set(n,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const r={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(n)},o=JSON.stringify(r);this.textureDefIndexMap.has(o)||(this.textureDefIndexMap.set(o,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(r));const a={index:this.textureDefIndexMap.get(o)};return t.getTexCoord()!==0&&(a.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(a.extras=t.getExtras()),this.textureInfoDefMap.set(t,a),a}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,s){if(this.options.format===re.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const n=ie.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,n),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this._accessorUsageMap.get(e);if(t)return t;if(e.getSparse())return Y.SPARSE;for(const s of this._doc.getGraph().listParentEdges(e)){const{usage:n}=s.getAttributes();if(n)return n;s.getParent().propertyType!==N.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return Y.OTHER}addAccessorToUsageGroup(e,t){const s=this._accessorUsageMap.get(e);if(s&&s!==t)throw new Error(`Accessor with usage "${s}" cannot be reused as "${t}".`);return this._accessorUsageMap.set(e,t),this}}he.BufferViewTarget=Te,he.BufferViewUsage=Y,he.USAGE_TO_TARGET={[Y.ARRAY_BUFFER]:Te.ARRAY_BUFFER,[Y.ELEMENT_ARRAY_BUFFER]:Te.ELEMENT_ARRAY_BUFFER};class It{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const s=this.basename(e);return this.counter[s]=this.counter[s]||1,`${s}_${this.counter[s]++}.${t}`}else return`${this.basename(e)}.${t}`}}function As(i,e){const t=i.getGraph().listParentEdges(e).find(s=>s.getParent()!==i.getRoot());return t?t.getName().replace(/texture$/i,""):""}const{BufferViewUsage:ke}=he,{UNSIGNED_INT:Ss,UNSIGNED_SHORT:Is,UNSIGNED_BYTE:zs}=O.ComponentType,Ns=new Set([N.ACCESSOR,N.BUFFER,N.MATERIAL,N.MESH]);class Cs{static write(e,t){const s=e.getGraph(),n=e.getRoot(),r={asset:K({generator:`glTF-Transform ${ft}`},n.getAsset()),extras:K({},n.getExtras())},o={json:r,resources:{}},a=new he(e,o,t),c=t.logger||q.DEFAULT_INSTANCE,h=new Set(t.extensions.map(l=>l.EXTENSION_NAME)),u=e.getRoot().listExtensionsUsed().filter(l=>h.has(l.extensionName)).sort((l,S)=>l.extensionName>S.extensionName?1:-1),d=e.getRoot().listExtensionsRequired().filter(l=>h.has(l.extensionName)).sort((l,S)=>l.extensionName>S.extensionName?1:-1);u.length<e.getRoot().listExtensionsUsed().length&&c.warn("Some extensions were not registered for I/O, and will not be written.");for(const l of u){const S=l.prewriteTypes.filter(w=>!Ns.has(w));S.length&&c.warn(`Prewrite hooks for some types (${S.join()}), requested by extension ${l.extensionName}, are unsupported. Please file an issue or a PR.`);for(const w of l.writeDependencies)l.install(w,t.dependencies[w])}function g(l,S,w,M){const m=[];let x=0;for(const T of l){const _=a.createAccessorDef(T);_.bufferView=r.bufferViews.length;const A=T.getArray(),I=U.pad(U.toView(A));_.byteOffset=x,x+=I.byteLength,m.push(I),a.accessorIndexMap.set(T,r.accessors.length),r.accessors.push(_)}const f=U.concat(m),y={buffer:S,byteOffset:w,byteLength:f.byteLength};return M&&(y.target=M),r.bufferViews.push(y),{buffers:m,byteLength:x}}function p(l,S,w){const M=l[0].getCount();let m=0;for(const _ of l){const A=a.createAccessorDef(_);A.bufferView=r.bufferViews.length,A.byteOffset=m;const I=_.getElementSize(),z=_.getComponentSize();m+=U.padNumber(I*z),a.accessorIndexMap.set(_,r.accessors.length),r.accessors.push(A)}const x=M*m,f=new ArrayBuffer(x),y=new DataView(f);for(let _=0;_<M;_++){let A=0;for(const I of l){const z=I.getElementSize(),v=I.getComponentSize(),C=I.getComponentType(),B=I.getArray();for(let P=0;P<z;P++){const k=_*m+A+P*v,j=B[_*z+P];switch(C){case O.ComponentType.FLOAT:y.setFloat32(k,j,!0);break;case O.ComponentType.BYTE:y.setInt8(k,j);break;case O.ComponentType.SHORT:y.setInt16(k,j,!0);break;case O.ComponentType.UNSIGNED_BYTE:y.setUint8(k,j);break;case O.ComponentType.UNSIGNED_SHORT:y.setUint16(k,j,!0);break;case O.ComponentType.UNSIGNED_INT:y.setUint32(k,j,!0);break;default:throw new Error("Unexpected component type: "+C)}}A+=U.padNumber(z*v)}}const T={buffer:S,byteOffset:w,byteLength:x,byteStride:m,target:he.BufferViewTarget.ARRAY_BUFFER};return r.bufferViews.push(T),{byteLength:x,buffers:[new Uint8Array(f)]}}function E(l,S,w){const M=[];let m=0;const x=new Map;let f=-1/0,y=!1;for(const C of l){const B=a.createAccessorDef(C);r.accessors.push(B),a.accessorIndexMap.set(C,r.accessors.length-1);const P=[],k=[],j=[],ye=new Array(C.getElementSize()).fill(0);for(let Re=0,Qs=C.getCount();Re<Qs;Re++)if(C.getElement(Re,j),!V.eq(j,ye,0)){f=Math.max(Re,f),P.push(Re);for(let it=0;it<j.length;it++)k.push(j[it])}const te=P.length,rt={accessorDef:B,count:te};if(x.set(C,rt),te===0)continue;te>C.getCount()/2&&(y=!0);const Ds=ve[C.getComponentType()];rt.indices=P,rt.values=new Ds(k)}if(!Number.isFinite(f))return{buffers:M,byteLength:m};y&&c.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const T=f<255?Uint8Array:f<65535?Uint16Array:Uint32Array,_=f<255?zs:f<65535?Is:Ss,A={buffer:S,byteOffset:w+m,byteLength:0};for(const C of l){const B=x.get(C);if(B.count===0)continue;B.indicesByteOffset=A.byteLength;const P=U.pad(U.toView(new T(B.indices)));M.push(P),m+=P.byteLength,A.byteLength+=P.byteLength}r.bufferViews.push(A);const I=r.bufferViews.length-1,z={buffer:S,byteOffset:w+m,byteLength:0};for(const C of l){const B=x.get(C);if(B.count===0)continue;B.valuesByteOffset=z.byteLength;const P=U.pad(U.toView(B.values));M.push(P),m+=P.byteLength,z.byteLength+=P.byteLength}r.bufferViews.push(z);const v=r.bufferViews.length-1;for(const C of l){const B=x.get(C);B.count!==0&&(B.accessorDef.sparse={count:B.count,indices:{bufferView:I,byteOffset:B.indicesByteOffset,componentType:_},values:{bufferView:v,byteOffset:B.valuesByteOffset}})}return{buffers:M,byteLength:m}}if(r.accessors=[],r.bufferViews=[],r.samplers=[],r.textures=[],r.images=n.listTextures().map((l,S)=>{const w=a.createPropertyDef(l);l.getMimeType()&&(w.mimeType=l.getMimeType());const M=l.getImage();return M&&a.createImageData(w,M,l),a.imageIndexMap.set(l,S),w}),u.filter(l=>l.prewriteTypes.includes(N.ACCESSOR)).forEach(l=>l.prewrite(a,N.ACCESSOR)),n.listAccessors().forEach(l=>{const S=a.accessorUsageGroupedByParent,w=a.accessorParents;if(a.accessorIndexMap.has(l))return;const M=a.getAccessorUsage(l);if(a.addAccessorToUsageGroup(l,M),S.has(M)){const m=s.listParents(l).find(x=>x.propertyType!==N.ROOT);w.set(l,m)}}),u.filter(l=>l.prewriteTypes.includes(N.BUFFER)).forEach(l=>l.prewrite(a,N.BUFFER)),(n.listAccessors().length>0||n.listTextures().length>0||a.otherBufferViews.size>0)&&n.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");r.buffers=[],n.listBuffers().forEach((l,S)=>{const w=a.createPropertyDef(l),M=a.accessorUsageGroupedByParent,m=l.listParents().filter(z=>z instanceof O),x=new Set(m.map(z=>a.accessorParents.get(z))),f=new Map(Array.from(x).map((z,v)=>[z,v])),y={};for(const z of m){var T;if(a.accessorIndexMap.has(z))continue;const v=a.getAccessorUsage(z);let C=v;if(M.has(v)){const B=a.accessorParents.get(z);C+=`:${f.get(B)}`}y[T=C]||(y[T]={usage:v,accessors:[]}),y[C].accessors.push(z)}const _=[],A=r.buffers.length;let I=0;for(const{usage:z,accessors:v}of Object.values(y))if(z===ke.ARRAY_BUFFER&&t.vertexLayout===Oe.INTERLEAVED){const C=p(v,A,I);I+=C.byteLength,_.push(...C.buffers)}else if(z===ke.ARRAY_BUFFER)for(const C of v){const B=p([C],A,I);I+=B.byteLength,_.push(...B.buffers)}else if(z===ke.SPARSE){const C=E(v,A,I);I+=C.byteLength,_.push(...C.buffers)}else if(z===ke.ELEMENT_ARRAY_BUFFER){const C=he.BufferViewTarget.ELEMENT_ARRAY_BUFFER,B=g(v,A,I,C);I+=B.byteLength,_.push(...B.buffers)}else{const C=g(v,A,I);I+=C.byteLength,_.push(...C.buffers)}if(a.imageBufferViews.length&&S===0){for(let z=0;z<a.imageBufferViews.length;z++)if(r.bufferViews[r.images[z].bufferView].byteOffset=I,I+=a.imageBufferViews[z].byteLength,_.push(a.imageBufferViews[z]),I%8){const v=8-I%8;I+=v,_.push(new Uint8Array(v))}}if(a.otherBufferViews.has(l))for(const z of a.otherBufferViews.get(l))r.bufferViews.push({buffer:A,byteOffset:I,byteLength:z.byteLength}),a.otherBufferViewsIndexMap.set(z,r.bufferViews.length-1),I+=z.byteLength,_.push(z);if(I){let z;t.format===re.GLB?z=Ce:(z=a.bufferURIGenerator.createURI(l,"bin"),w.uri=z),w.byteLength=I,o.resources[z]=U.concat(_)}r.buffers.push(w),a.bufferIndexMap.set(l,S)}),n.listAccessors().find(l=>!l.getBuffer())&&c.warn("Skipped writing one or more Accessors: no Buffer assigned."),u.filter(l=>l.prewriteTypes.includes(N.MATERIAL)).forEach(l=>l.prewrite(a,N.MATERIAL)),r.materials=n.listMaterials().map((l,S)=>{const w=a.createPropertyDef(l);if(l.getAlphaMode()!==ce.AlphaMode.OPAQUE&&(w.alphaMode=l.getAlphaMode()),l.getAlphaMode()===ce.AlphaMode.MASK&&(w.alphaCutoff=l.getAlphaCutoff()),l.getDoubleSided()&&(w.doubleSided=!0),w.pbrMetallicRoughness={},V.eq(l.getBaseColorFactor(),[1,1,1,1])||(w.pbrMetallicRoughness.baseColorFactor=l.getBaseColorFactor()),V.eq(l.getEmissiveFactor(),[0,0,0])||(w.emissiveFactor=l.getEmissiveFactor()),l.getRoughnessFactor()!==1&&(w.pbrMetallicRoughness.roughnessFactor=l.getRoughnessFactor()),l.getMetallicFactor()!==1&&(w.pbrMetallicRoughness.metallicFactor=l.getMetallicFactor()),l.getBaseColorTexture()){const M=l.getBaseColorTexture(),m=l.getBaseColorTextureInfo();w.pbrMetallicRoughness.baseColorTexture=a.createTextureInfoDef(M,m)}if(l.getEmissiveTexture()){const M=l.getEmissiveTexture(),m=l.getEmissiveTextureInfo();w.emissiveTexture=a.createTextureInfoDef(M,m)}if(l.getNormalTexture()){const M=l.getNormalTexture(),m=l.getNormalTextureInfo(),x=a.createTextureInfoDef(M,m);l.getNormalScale()!==1&&(x.scale=l.getNormalScale()),w.normalTexture=x}if(l.getOcclusionTexture()){const M=l.getOcclusionTexture(),m=l.getOcclusionTextureInfo(),x=a.createTextureInfoDef(M,m);l.getOcclusionStrength()!==1&&(x.strength=l.getOcclusionStrength()),w.occlusionTexture=x}if(l.getMetallicRoughnessTexture()){const M=l.getMetallicRoughnessTexture(),m=l.getMetallicRoughnessTextureInfo();w.pbrMetallicRoughness.metallicRoughnessTexture=a.createTextureInfoDef(M,m)}return a.materialIndexMap.set(l,S),w}),u.filter(l=>l.prewriteTypes.includes(N.MESH)).forEach(l=>l.prewrite(a,N.MESH)),r.meshes=n.listMeshes().map((l,S)=>{const w=a.createPropertyDef(l);let M=null;return w.primitives=l.listPrimitives().map(m=>{const x={attributes:{}};x.mode=m.getMode();const f=m.getMaterial();f&&(x.material=a.materialIndexMap.get(f)),Object.keys(m.getExtras()).length&&(x.extras=m.getExtras());const y=m.getIndices();y&&(x.indices=a.accessorIndexMap.get(y));for(const T of m.listSemantics())x.attributes[T]=a.accessorIndexMap.get(m.getAttribute(T));for(const T of m.listTargets()){const _={};for(const A of T.listSemantics())_[A]=a.accessorIndexMap.get(T.getAttribute(A));x.targets=x.targets||[],x.targets.push(_)}return m.listTargets().length&&!M&&(M=m.listTargets().map(T=>T.getName())),x}),l.getWeights().length&&(w.weights=l.getWeights()),M&&(w.extras=w.extras||{},w.extras.targetNames=M),a.meshIndexMap.set(l,S),w}),r.cameras=n.listCameras().map((l,S)=>{const w=a.createPropertyDef(l);if(w.type=l.getType(),w.type===ae.Type.PERSPECTIVE){w.perspective={znear:l.getZNear(),zfar:l.getZFar(),yfov:l.getYFov()};const M=l.getAspectRatio();M!==null&&(w.perspective.aspectRatio=M)}else w.orthographic={znear:l.getZNear(),zfar:l.getZFar(),xmag:l.getXMag(),ymag:l.getYMag()};return a.cameraIndexMap.set(l,S),w}),r.nodes=n.listNodes().map((l,S)=>{const w=a.createPropertyDef(l);return V.eq(l.getTranslation(),[0,0,0])||(w.translation=l.getTranslation()),V.eq(l.getRotation(),[0,0,0,1])||(w.rotation=l.getRotation()),V.eq(l.getScale(),[1,1,1])||(w.scale=l.getScale()),l.getWeights().length&&(w.weights=l.getWeights()),a.nodeIndexMap.set(l,S),w}),r.skins=n.listSkins().map((l,S)=>{const w=a.createPropertyDef(l),M=l.getInverseBindMatrices();M&&(w.inverseBindMatrices=a.accessorIndexMap.get(M));const m=l.getSkeleton();return m&&(w.skeleton=a.nodeIndexMap.get(m)),w.joints=l.listJoints().map(x=>a.nodeIndexMap.get(x)),a.skinIndexMap.set(l,S),w}),n.listNodes().forEach((l,S)=>{const w=r.nodes[S],M=l.getMesh();M&&(w.mesh=a.meshIndexMap.get(M));const m=l.getCamera();m&&(w.camera=a.cameraIndexMap.get(m));const x=l.getSkin();x&&(w.skin=a.skinIndexMap.get(x)),l.listChildren().length>0&&(w.children=l.listChildren().map(f=>a.nodeIndexMap.get(f)))}),r.animations=n.listAnimations().map((l,S)=>{const w=a.createPropertyDef(l),M=new Map;return w.samplers=l.listSamplers().map((m,x)=>{const f=a.createPropertyDef(m);return f.input=a.accessorIndexMap.get(m.getInput()),f.output=a.accessorIndexMap.get(m.getOutput()),f.interpolation=m.getInterpolation(),M.set(m,x),f}),w.channels=l.listChannels().map(m=>{const x=a.createPropertyDef(m);return x.sampler=M.get(m.getSampler()),x.target={node:a.nodeIndexMap.get(m.getTargetNode()),path:m.getTargetPath()},x}),a.animationIndexMap.set(l,S),w}),r.scenes=n.listScenes().map((l,S)=>{const w=a.createPropertyDef(l);return w.nodes=l.listChildren().map(M=>a.nodeIndexMap.get(M)),a.sceneIndexMap.set(l,S),w});const b=n.getDefaultScene();return b&&(r.scene=n.listScenes().indexOf(b)),r.extensionsUsed=u.map(l=>l.extensionName),r.extensionsRequired=d.map(l=>l.extensionName),u.forEach(l=>l.write(a)),Os(r),o}}function Os(i){const e=[];for(const t in i){const s=i[t];(Array.isArray(s)&&s.length===0||s===null||s===""||s&&typeof s=="object"&&Object.keys(s).length===0)&&e.push(t)}for(const t of e)delete i[t]}var Ge;(function(i){i[i.JSON=1313821514]="JSON",i[i.BIN=5130562]="BIN"})(Ge||(Ge={}));class vs{constructor(){this._logger=q.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=Oe.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const t of e)this._extensions.add(t),t.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const s=zt(t)?this._binaryToJSON(t):{json:JSON.parse(U.decodeText(t)),resources:{}};return await this._readResourcesExternal(s,this.dirname(e)),this._readResourcesInternal(s),s}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),Ms.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const t=this._binaryToJSON(U.assertView(e));this._readResourcesInternal(t);const s=t.json;if(s.buffers&&s.buffers.some(n=>Bs(t,n)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(n=>Us(t,n)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(U.assertView(e)))}async writeJSON(e,t={}){if(t.format===re.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return Cs.write(e,{format:t.format||re.GLTF,basename:t.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:K({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:t,resources:s}=await this.writeJSON(e,{format:re.GLB}),n=new Uint32Array([1179937895,2,12]),r=JSON.stringify(t),o=U.pad(U.encodeText(r),32),a=U.toView(new Uint32Array([o.byteLength,1313821514])),c=U.concat([a,o]);n[n.length-1]+=c.byteLength;const h=Object.values(s)[0];if(!h||!h.byteLength)return U.concat([U.toView(n),c]);const u=U.pad(h,0),d=U.toView(new Uint32Array([u.byteLength,5130562])),g=U.concat([d,u]);return n[n.length-1]+=g.byteLength,U.concat([U.toView(n),c,g])}async _readResourcesExternal(e,t){var s=this;const n=e.json.images||[],r=e.json.buffers||[],o=[...n,...r].map(async function(a){const c=a.uri;if(!c||c.match(/data:/))return Promise.resolve();e.resources[c]=await s.readURI(s.resolve(t,c),"view"),s.lastReadBytes+=e.resources[c].byteLength});await Promise.all(o)}_readResourcesInternal(e){function t(r){if(r.uri){if(r.uri in e.resources){U.assertView(e.resources[r.uri]);return}if(r.uri.match(/data:/)){const o=`__${gs()}.${ge.extension(r.uri)}`;e.resources[o]=U.createBufferFromDataURI(r.uri),r.uri=o}}}(e.json.images||[]).forEach(r=>{if(r.bufferView===void 0&&r.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(r)}),(e.json.buffers||[]).forEach(t)}_copyJSON(e){const{images:t,buffers:s}=e.json;return e={json:K({},e.json),resources:K({},e.resources)},t&&(e.json.images=t.map(n=>K({},n))),s&&(e.json.buffers=s.map(n=>K({},n))),e}_binaryToJSON(e){if(!zt(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==Ge.JSON)throw new Error("Missing required GLB JSON chunk.");const s=20,n=t[0],r=U.decodeText(U.toView(e,s,n)),o=JSON.parse(r),a=s+n;if(e.byteLength<=a)return{json:o,resources:{}};const c=new Uint32Array(e.buffer,e.byteOffset+a,2);if(c[1]!==Ge.BIN)return{json:o,resources:{}};const h=c[0],u=U.toView(e,a+8,h);return{json:o,resources:{[Ce]:u}}}}function Bs(i,e){return e.uri!==void 0&&!(e.uri in i.resources)}function Us(i,e){return e.uri!==void 0&&!(e.uri in i.resources)&&e.bufferView===void 0}function zt(i){if(i.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(i.buffer,i.byteOffset,3);return e[0]===1179937895&&e[1]===2}class Fs extends vs{constructor(e=Ee.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=e}async readURI(e,t){const s=await fetch(e,this._fetchConfig);switch(t){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(e,t){return Ee.resolve(e,t)}dirname(e){return Ee.dirname(e)}}async function Ps(i){const e=new FileReader;return new Promise((t,s)=>{e.onloadend=n=>{var r;n.target?t((r=n.target)==null?void 0:r.result):t(null)},e.onerror=s,e.readAsArrayBuffer(i)})}async function Ls(i,e,t){try{const s=await Qt(i,e,t);if(s.ok){const n=await s.blob(),r=await Ps(n);if(r)return await new Fs({credentials:"include"}).binaryToJSON(new Uint8Array(r))}}catch(s){console.log(s)}return null}function Nt(i){return`META_${i}`}function Vs(i){var t,s;const e=(t=i==null?void 0:i.json)==null?void 0:t.scenes;return Array.isArray(e)&&e.length>0?(s=e[0].extras)==null?void 0:s.meta:null}function Ct(){return crypto.randomUUID()}function Ot(i,e,t){const s=e.byteOffset||0,n=t.byteOffset||0,r=s+n,o=t.componentType===5125?4:2,a=o*t.count;if(o===2){const c=new Uint16Array(i.slice(r,r+a).buffer),h=new Uint32Array(c.length);for(let u=0;u<c.length;u++)h[u]=c[u];return h}else return new Uint32Array(i.slice(r,r+a).buffer)}function vt(i,e,t){const s=e.byteOffset||0,n=t.byteOffset||0,r=s+n,a=4*(t.count*3);return new Float32Array(i.slice(r,r+a).buffer)}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Bt="169",Ke=2e3,Ut=2001;function Ft(i,e,t){return Math.max(e,Math.min(t,i))}class js{constructor(e=0,t=0,s=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=s,this._w=n}static slerpFlat(e,t,s,n,r,o,a){let c=s[n+0],h=s[n+1],u=s[n+2],d=s[n+3];const g=r[o+0],p=r[o+1],E=r[o+2],R=r[o+3];if(a===0){e[t+0]=c,e[t+1]=h,e[t+2]=u,e[t+3]=d;return}if(a===1){e[t+0]=g,e[t+1]=p,e[t+2]=E,e[t+3]=R;return}if(d!==R||c!==g||h!==p||u!==E){let b=1-a;const l=c*g+h*p+u*E+d*R,S=l>=0?1:-1,w=1-l*l;if(w>Number.EPSILON){const m=Math.sqrt(w),x=Math.atan2(m,l*S);b=Math.sin(b*x)/m,a=Math.sin(a*x)/m}const M=a*S;if(c=c*b+g*M,h=h*b+p*M,u=u*b+E*M,d=d*b+R*M,b===1-a){const m=1/Math.sqrt(c*c+h*h+u*u+d*d);c*=m,h*=m,u*=m,d*=m}}e[t]=c,e[t+1]=h,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,s,n,r,o){const a=s[n],c=s[n+1],h=s[n+2],u=s[n+3],d=r[o],g=r[o+1],p=r[o+2],E=r[o+3];return e[t]=a*E+u*d+c*p-h*g,e[t+1]=c*E+u*g+h*d-a*p,e[t+2]=h*E+u*p+a*g-c*d,e[t+3]=u*E-a*d-c*g-h*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,s,n){return this._x=e,this._y=t,this._z=s,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const s=e._x,n=e._y,r=e._z,o=e._order,a=Math.cos,c=Math.sin,h=a(s/2),u=a(n/2),d=a(r/2),g=c(s/2),p=c(n/2),E=c(r/2);switch(o){case"XYZ":this._x=g*u*d+h*p*E,this._y=h*p*d-g*u*E,this._z=h*u*E+g*p*d,this._w=h*u*d-g*p*E;break;case"YXZ":this._x=g*u*d+h*p*E,this._y=h*p*d-g*u*E,this._z=h*u*E-g*p*d,this._w=h*u*d+g*p*E;break;case"ZXY":this._x=g*u*d-h*p*E,this._y=h*p*d+g*u*E,this._z=h*u*E+g*p*d,this._w=h*u*d-g*p*E;break;case"ZYX":this._x=g*u*d-h*p*E,this._y=h*p*d+g*u*E,this._z=h*u*E-g*p*d,this._w=h*u*d+g*p*E;break;case"YZX":this._x=g*u*d+h*p*E,this._y=h*p*d+g*u*E,this._z=h*u*E-g*p*d,this._w=h*u*d-g*p*E;break;case"XZY":this._x=g*u*d-h*p*E,this._y=h*p*d-g*u*E,this._z=h*u*E+g*p*d,this._w=h*u*d+g*p*E;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const s=t/2,n=Math.sin(s);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,s=t[0],n=t[4],r=t[8],o=t[1],a=t[5],c=t[9],h=t[2],u=t[6],d=t[10],g=s+a+d;if(g>0){const p=.5/Math.sqrt(g+1);this._w=.25/p,this._x=(u-c)*p,this._y=(r-h)*p,this._z=(o-n)*p}else if(s>a&&s>d){const p=2*Math.sqrt(1+s-a-d);this._w=(u-c)/p,this._x=.25*p,this._y=(n+o)/p,this._z=(r+h)/p}else if(a>d){const p=2*Math.sqrt(1+a-s-d);this._w=(r-h)/p,this._x=(n+o)/p,this._y=.25*p,this._z=(c+u)/p}else{const p=2*Math.sqrt(1+d-s-a);this._w=(o-n)/p,this._x=(r+h)/p,this._y=(c+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ft(this.dot(e),-1,1)))}rotateTowards(e,t){const s=this.angleTo(e);if(s===0)return this;const n=Math.min(1,t/s);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const s=e._x,n=e._y,r=e._z,o=e._w,a=t._x,c=t._y,h=t._z,u=t._w;return this._x=s*u+o*a+n*h-r*c,this._y=n*u+o*c+r*a-s*h,this._z=r*u+o*h+s*c-n*a,this._w=o*u-s*a-n*c-r*h,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const s=this._x,n=this._y,r=this._z,o=this._w;let a=o*e._w+s*e._x+n*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=s,this._y=n,this._z=r,this;const c=1-a*a;if(c<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*s+t*this._x,this._y=p*n+t*this._y,this._z=p*r+t*this._z,this.normalize(),this}const h=Math.sqrt(c),u=Math.atan2(h,a),d=Math.sin((1-t)*u)/h,g=Math.sin(t*u)/h;return this._w=o*d+this._w*g,this._x=s*d+this._x*g,this._y=n*d+this._y*g,this._z=r*d+this._z*g,this._onChangeCallback(),this}slerpQuaternions(e,t,s){return this.copy(e).slerp(t,s)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),s=Math.random(),n=Math.sqrt(1-s),r=Math.sqrt(s);return this.set(n*Math.sin(e),n*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Z{constructor(e=0,t=0,s=0){Z.prototype.isVector3=!0,this.x=e,this.y=t,this.z=s}set(e,t,s){return s===void 0&&(s=this.z),this.x=e,this.y=t,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Pt.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Pt.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,s=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*s+r[6]*n,this.y=r[1]*t+r[4]*s+r[7]*n,this.z=r[2]*t+r[5]*s+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,s=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*s+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*s+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*s+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*s+r[10]*n+r[14])*o,this}applyQuaternion(e){const t=this.x,s=this.y,n=this.z,r=e.x,o=e.y,a=e.z,c=e.w,h=2*(o*n-a*s),u=2*(a*t-r*n),d=2*(r*s-o*t);return this.x=t+c*h+o*d-a*u,this.y=s+c*u+a*h-r*d,this.z=n+c*d+r*u-o*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,s=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*s+r[8]*n,this.y=r[1]*t+r[5]*s+r[9]*n,this.z=r[2]*t+r[6]*s+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const s=e.x,n=e.y,r=e.z,o=t.x,a=t.y,c=t.z;return this.x=n*c-r*a,this.y=r*o-s*c,this.z=s*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const s=e.dot(this)/t;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return nt.copy(this).projectOnVector(e),this.sub(nt)}reflect(e){return this.sub(nt.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(Ft(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y,n=this.z-e.z;return t*t+s*s+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,s){const n=Math.sin(t)*e;return this.x=n*Math.sin(s),this.y=Math.cos(t)*e,this.z=n*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,s){return this.x=e*Math.sin(t),this.y=s,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=s,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,s=Math.sqrt(1-t*t);return this.x=s*Math.cos(e),this.y=t,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const nt=new Z,Pt=new js;class Me{constructor(e,t,s,n,r,o,a,c,h,u,d,g,p,E,R,b){Me.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,s,n,r,o,a,c,h,u,d,g,p,E,R,b)}set(e,t,s,n,r,o,a,c,h,u,d,g,p,E,R,b){const l=this.elements;return l[0]=e,l[4]=t,l[8]=s,l[12]=n,l[1]=r,l[5]=o,l[9]=a,l[13]=c,l[2]=h,l[6]=u,l[10]=d,l[14]=g,l[3]=p,l[7]=E,l[11]=R,l[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Me().fromArray(this.elements)}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],this}copyPosition(e){const t=this.elements,s=e.elements;return t[12]=s[12],t[13]=s[13],t[14]=s[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,s){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,t,s){return this.set(e.x,t.x,s.x,0,e.y,t.y,s.y,0,e.z,t.z,s.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,s=e.elements,n=1/pe.setFromMatrixColumn(e,0).length(),r=1/pe.setFromMatrixColumn(e,1).length(),o=1/pe.setFromMatrixColumn(e,2).length();return t[0]=s[0]*n,t[1]=s[1]*n,t[2]=s[2]*n,t[3]=0,t[4]=s[4]*r,t[5]=s[5]*r,t[6]=s[6]*r,t[7]=0,t[8]=s[8]*o,t[9]=s[9]*o,t[10]=s[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,s=e.x,n=e.y,r=e.z,o=Math.cos(s),a=Math.sin(s),c=Math.cos(n),h=Math.sin(n),u=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const g=o*u,p=o*d,E=a*u,R=a*d;t[0]=c*u,t[4]=-c*d,t[8]=h,t[1]=p+E*h,t[5]=g-R*h,t[9]=-a*c,t[2]=R-g*h,t[6]=E+p*h,t[10]=o*c}else if(e.order==="YXZ"){const g=c*u,p=c*d,E=h*u,R=h*d;t[0]=g+R*a,t[4]=E*a-p,t[8]=o*h,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=p*a-E,t[6]=R+g*a,t[10]=o*c}else if(e.order==="ZXY"){const g=c*u,p=c*d,E=h*u,R=h*d;t[0]=g-R*a,t[4]=-o*d,t[8]=E+p*a,t[1]=p+E*a,t[5]=o*u,t[9]=R-g*a,t[2]=-o*h,t[6]=a,t[10]=o*c}else if(e.order==="ZYX"){const g=o*u,p=o*d,E=a*u,R=a*d;t[0]=c*u,t[4]=E*h-p,t[8]=g*h+R,t[1]=c*d,t[5]=R*h+g,t[9]=p*h-E,t[2]=-h,t[6]=a*c,t[10]=o*c}else if(e.order==="YZX"){const g=o*c,p=o*h,E=a*c,R=a*h;t[0]=c*u,t[4]=R-g*d,t[8]=E*d+p,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-h*u,t[6]=p*d+E,t[10]=g-R*d}else if(e.order==="XZY"){const g=o*c,p=o*h,E=a*c,R=a*h;t[0]=c*u,t[4]=-d,t[8]=h*u,t[1]=g*d+R,t[5]=o*u,t[9]=p*d-E,t[2]=E*d-p,t[6]=a*u,t[10]=R*d+g}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ks,e,Gs)}lookAt(e,t,s){const n=this.elements;return H.subVectors(e,t),H.lengthSq()===0&&(H.z=1),H.normalize(),ee.crossVectors(s,H),ee.lengthSq()===0&&(Math.abs(s.z)===1?H.x+=1e-4:H.z+=1e-4,H.normalize(),ee.crossVectors(s,H)),ee.normalize(),Ye.crossVectors(H,ee),n[0]=ee.x,n[4]=Ye.x,n[8]=H.x,n[1]=ee.y,n[5]=Ye.y,n[9]=H.y,n[2]=ee.z,n[6]=Ye.z,n[10]=H.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,n=t.elements,r=this.elements,o=s[0],a=s[4],c=s[8],h=s[12],u=s[1],d=s[5],g=s[9],p=s[13],E=s[2],R=s[6],b=s[10],l=s[14],S=s[3],w=s[7],M=s[11],m=s[15],x=n[0],f=n[4],y=n[8],T=n[12],_=n[1],A=n[5],I=n[9],z=n[13],v=n[2],C=n[6],B=n[10],P=n[14],k=n[3],j=n[7],ye=n[11],te=n[15];return r[0]=o*x+a*_+c*v+h*k,r[4]=o*f+a*A+c*C+h*j,r[8]=o*y+a*I+c*B+h*ye,r[12]=o*T+a*z+c*P+h*te,r[1]=u*x+d*_+g*v+p*k,r[5]=u*f+d*A+g*C+p*j,r[9]=u*y+d*I+g*B+p*ye,r[13]=u*T+d*z+g*P+p*te,r[2]=E*x+R*_+b*v+l*k,r[6]=E*f+R*A+b*C+l*j,r[10]=E*y+R*I+b*B+l*ye,r[14]=E*T+R*z+b*P+l*te,r[3]=S*x+w*_+M*v+m*k,r[7]=S*f+w*A+M*C+m*j,r[11]=S*y+w*I+M*B+m*ye,r[15]=S*T+w*z+M*P+m*te,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[4],n=e[8],r=e[12],o=e[1],a=e[5],c=e[9],h=e[13],u=e[2],d=e[6],g=e[10],p=e[14],E=e[3],R=e[7],b=e[11],l=e[15];return E*(+r*c*d-n*h*d-r*a*g+s*h*g+n*a*p-s*c*p)+R*(+t*c*p-t*h*g+r*o*g-n*o*p+n*h*u-r*c*u)+b*(+t*h*d-t*a*p-r*o*d+s*o*p+r*a*u-s*h*u)+l*(-n*a*u-t*c*d+t*a*g+n*o*d-s*o*g+s*c*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,s){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=s),this}invert(){const e=this.elements,t=e[0],s=e[1],n=e[2],r=e[3],o=e[4],a=e[5],c=e[6],h=e[7],u=e[8],d=e[9],g=e[10],p=e[11],E=e[12],R=e[13],b=e[14],l=e[15],S=d*b*h-R*g*h+R*c*p-a*b*p-d*c*l+a*g*l,w=E*g*h-u*b*h-E*c*p+o*b*p+u*c*l-o*g*l,M=u*R*h-E*d*h+E*a*p-o*R*p-u*a*l+o*d*l,m=E*d*c-u*R*c-E*a*g+o*R*g+u*a*b-o*d*b,x=t*S+s*w+n*M+r*m;if(x===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const f=1/x;return e[0]=S*f,e[1]=(R*g*r-d*b*r-R*n*p+s*b*p+d*n*l-s*g*l)*f,e[2]=(a*b*r-R*c*r+R*n*h-s*b*h-a*n*l+s*c*l)*f,e[3]=(d*c*r-a*g*r-d*n*h+s*g*h+a*n*p-s*c*p)*f,e[4]=w*f,e[5]=(u*b*r-E*g*r+E*n*p-t*b*p-u*n*l+t*g*l)*f,e[6]=(E*c*r-o*b*r-E*n*h+t*b*h+o*n*l-t*c*l)*f,e[7]=(o*g*r-u*c*r+u*n*h-t*g*h-o*n*p+t*c*p)*f,e[8]=M*f,e[9]=(E*d*r-u*R*r-E*s*p+t*R*p+u*s*l-t*d*l)*f,e[10]=(o*R*r-E*a*r+E*s*h-t*R*h-o*s*l+t*a*l)*f,e[11]=(u*a*r-o*d*r-u*s*h+t*d*h+o*s*p-t*a*p)*f,e[12]=m*f,e[13]=(u*R*n-E*d*n+E*s*g-t*R*g-u*s*b+t*d*b)*f,e[14]=(E*a*n-o*R*n-E*s*c+t*R*c+o*s*b-t*a*b)*f,e[15]=(o*d*n-u*a*n+u*s*c-t*d*c-o*s*g+t*a*g)*f,this}scale(e){const t=this.elements,s=e.x,n=e.y,r=e.z;return t[0]*=s,t[4]*=n,t[8]*=r,t[1]*=s,t[5]*=n,t[9]*=r,t[2]*=s,t[6]*=n,t[10]*=r,t[3]*=s,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,s,n))}makeTranslation(e,t,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,s,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const s=Math.cos(t),n=Math.sin(t),r=1-s,o=e.x,a=e.y,c=e.z,h=r*o,u=r*a;return this.set(h*o+s,h*a-n*c,h*c+n*a,0,h*a+n*c,u*a+s,u*c-n*o,0,h*c-n*a,u*c+n*o,r*c*c+s,0,0,0,0,1),this}makeScale(e,t,s){return this.set(e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,t,s,n,r,o){return this.set(1,s,r,0,e,1,o,0,t,n,1,0,0,0,0,1),this}compose(e,t,s){const n=this.elements,r=t._x,o=t._y,a=t._z,c=t._w,h=r+r,u=o+o,d=a+a,g=r*h,p=r*u,E=r*d,R=o*u,b=o*d,l=a*d,S=c*h,w=c*u,M=c*d,m=s.x,x=s.y,f=s.z;return n[0]=(1-(R+l))*m,n[1]=(p+M)*m,n[2]=(E-w)*m,n[3]=0,n[4]=(p-M)*x,n[5]=(1-(g+l))*x,n[6]=(b+S)*x,n[7]=0,n[8]=(E+w)*f,n[9]=(b-S)*f,n[10]=(1-(g+R))*f,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,s){const n=this.elements;let r=pe.set(n[0],n[1],n[2]).length();const o=pe.set(n[4],n[5],n[6]).length(),a=pe.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],$.copy(this);const h=1/r,u=1/o,d=1/a;return $.elements[0]*=h,$.elements[1]*=h,$.elements[2]*=h,$.elements[4]*=u,$.elements[5]*=u,$.elements[6]*=u,$.elements[8]*=d,$.elements[9]*=d,$.elements[10]*=d,t.setFromRotationMatrix($),s.x=r,s.y=o,s.z=a,this}makePerspective(e,t,s,n,r,o,a=Ke){const c=this.elements,h=2*r/(t-e),u=2*r/(s-n),d=(t+e)/(t-e),g=(s+n)/(s-n);let p,E;if(a===Ke)p=-(o+r)/(o-r),E=-2*o*r/(o-r);else if(a===Ut)p=-o/(o-r),E=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=h,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=u,c[9]=g,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=E,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,s,n,r,o,a=Ke){const c=this.elements,h=1/(t-e),u=1/(s-n),d=1/(o-r),g=(t+e)*h,p=(s+n)*u;let E,R;if(a===Ke)E=(o+r)*d,R=-2*d;else if(a===Ut)E=r*d,R=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-g,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-p,c[2]=0,c[6]=0,c[10]=R,c[14]=-E,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,s=e.elements;for(let n=0;n<16;n++)if(t[n]!==s[n])return!1;return!0}fromArray(e,t=0){for(let s=0;s<16;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e[t+9]=s[9],e[t+10]=s[10],e[t+11]=s[11],e[t+12]=s[12],e[t+13]=s[13],e[t+14]=s[14],e[t+15]=s[15],e}}const pe=new Z,$=new Me,ks=new Z(0,0,0),Gs=new Z(1,1,1),ee=new Z,Ye=new Z,H=new Z;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Bt}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Bt);function Lt(i,e){const t=new Set,s=new Me().makeRotationX(Math.PI/2).toArray();for(let n=0;n<i.length;n++){const r=i[n]*3;if(t.has(r))continue;const o=e[r],a=e[r+1],c=e[r+2],h=1/(s[3]*o+s[7]*a+s[11]*c+s[15]),u=(s[0]*o+s[4]*a+s[8]*c+s[12])/h,d=(s[1]*o+s[5]*a+s[9]*c+s[13])/h,g=(s[2]*o+s[6]*a+s[10]*c+s[14])/h;e[r]=u,e[r+1]=d,e[r+2]=g,t.add(r)}}function Ks(i,e,t){const s=[];function n(o){var c,h,u,d,g,p;let a=o.json.scene||0;return(c=o.json.scenes)!=null&&c.length&&o.json.scenes[0]&&((h=o.json.scenes[0].nodes)!=null&&h.length)&&o.json.scenes[0].nodes[0]&&(a=o.json.scenes[0].nodes[0]),(d=(u=o==null?void 0:o.json)==null?void 0:u.nodes)!=null&&d.length&&((g=o==null?void 0:o.json)!=null&&g.nodes[a])?(p=o==null?void 0:o.json)==null?void 0:p.nodes[a]:(console.error("no main node found"),{})}const r=n(i);return Array.isArray(r.children)&&r.children.forEach(o=>{var y,T,_,A,I;const a=i.json.nodes&&i.json.nodes[o];if(!a||a.mesh===void 0)return;const c=i.json.meshes&&i.json.meshes[a.mesh];if(!c)return;const h=((y=a.name)==null?void 0:y.replace("node",""))||"";if(h==="")return;const u=parseInt(h);u===void 0&&console.warn("unexpected reult for nodename");const d=c.primitives[0].material;if(u!==d&&console.warn("test",u,d),d===void 0)return;const g=c.primitives[0].indices;if(g===void 0)return;const p=c.primitives[0].attributes.POSITION,E=i.json.accessors&&i.json.accessors[g];if(E===void 0||E.bufferView===void 0)return;const R=i.json.accessors&&i.json.accessors[p];if(R===void 0||R.bufferView===void 0)return;const b=i.json.bufferViews&&i.json.bufferViews[E.bufferView];if(!b)return;const l=i.json.bufferViews&&i.json.bufferViews[R.bufferView];if(!l)return;const w=((A=(((T=i==null?void 0:i.json)==null?void 0:T.materials)&&((_=i==null?void 0:i.json)==null?void 0:_.materials[d])||{}).pbrMetallicRoughness)==null?void 0:A.baseColorFactor)||[1,1,1,1],M=i.resources["@glb.bin"],m=Ot(M,b,E),x=vt(M,l,R);if(!m.length){console.log("missing index",e,t,o);return}if(!x.length){console.log("missing position",e,t,o);return}Lt(m,x);const f=((I=i.json.scenes)==null?void 0:I.length)&&i.json.scenes[0].extras&&i.json.scenes[0].extras[`id_sequence${u}`];if(!f){console.log("missing id sequence",e,t,`id_sequence${u}`,o);return}s.push({position:x,index:m,color:w,id_sequence:f,indexdbKey:Ct()})}),s}function Vt(i){const e={x:null,y:null,z:null},t={x:null,y:null,z:null};let s=0;for(;s<i.length;)for(let n=0;n<3;n++,s++){const r=i[s]||0;n===0&&(e.x===null&&(e.x=r),t.x===null&&(t.x=r),e.x<r&&(e.x=r),t.x>r&&(t.x=r)),n===1&&(e.y===null&&(e.y=r),t.y===null&&(t.y=r),e.y<r&&(e.y=r),t.y>r&&(t.y=r)),n===2&&(e.z===null&&(e.z=r),t.z===null&&(t.z=r),e.z<r&&(e.z=r),t.z>r&&(t.z=r))}return{X:e.x||0,Y:e.y||0,Z:e.z||0,x:t.x||0,y:t.y||0,z:t.z||0}}function Ys(i,e,t,s,n){Object.keys(n).forEach(o=>{const a=[],[c,h]=n[o];for(let u=c;u<h+1;u++){const d=t[u]*3;a.push(s[d]),a.push(s[d+1]),a.push(s[d+2])}i.add(o),e[o]=Vt(a)})}function Hs(i,e){let t=!0;for(;t&&i;){const s=new Set;Object.keys(i).forEach(r=>{const o=i[r];s.add(o[1])});let n=0;Object.keys(i).forEach(r=>{!s.has(r)&&!e.has(r)&&(n++,delete i[r])}),n===0&&(t=!1)}}function jt(i){return`${i}_ALL_KEYS`}async function qs(i,e,t,s,n=null){try{const r=new Ne(i),o=[],a=[],c=new Set,h={},u=jt(t);r.getJsonKey(u).then(m=>{Array.isArray(m)&&m.forEach(x=>{r.deleteKey(x)})});const d=Vs(s);if(!d)return console.log("Missing expected glb meta",e,t),null;const g=Ks(s,e,t),p={};for(let m=0;m<g.length;m++){const x=g[m];Ys(c,h,x.index,x.position,x.id_sequence);const f=x.index,y=r.getUUID();await r.setBufferKey(y,f.buffer),x.index=y,a.push(y);const T=x.position,_=r.getUUID();await r.setBufferKey(_,T.buffer),x.position=_,a.push(_),o.push(x.indexdbKey),a.push(x.indexdbKey),p[y]={indexdb_key:x.indexdbKey,index:y,color:x.color,position:_,id_sequence:structuredClone(x.id_sequence)},x.id_sequence=null,await r.setJsonKey(x.indexdbKey,x)}Hs(d,c);const E=Object.keys(d),R=[],b=new Map;let l=0;n?(b.set("*",1),l++):b.set("*",0),E.forEach(m=>{const x=h[m],f=d[m];let y,T;const _=f[0],A=f[1];b.has(m)?y=b.get(m):(l++,y=l,b.set(m,l)),b.has(A)?T=b.get(A):(l++,T=l,b.set(A,l)),R.push([y,_,T,x==null?void 0:x.x,x==null?void 0:x.y,x==null?void 0:x.z,x==null?void 0:x.X,x==null?void 0:x.Y,x==null?void 0:x.Z])}),n&&R.unshift([1,n,0,void 0,void 0,void 0,void 0,void 0,void 0]);const S={group_name:t,meshes:p,group_ref:R};Object.keys(S.meshes).forEach(m=>{const x=S.meshes[m];Object.keys(x.id_sequence).forEach(y=>{let T;b.has(y)?T=b.get(y):(l++,T=l,b.set(y,l)),x.id_sequence[T]=x.id_sequence[y],delete x.id_sequence[y]})});const M=new TextEncoder().encode(JSON.stringify(S));return await r.setBufferKey(Nt(t),M),await r.setJsonKey(t,o),await r.setJsonKey(u,a),await r.close(),t}catch(r){return console.error("error",t,r),null}}function Ws(i,e,t){var r;const s=[];return(((r=i==null?void 0:i.json)==null?void 0:r.nodes)||[]).forEach(o=>{var f,y,T,_,A;if(!o||o.mesh===void 0)return;const a=i.json.meshes&&i.json.meshes[o.mesh];if(!a)return;const c=((f=o.name)==null?void 0:f.replace("node",""))||"";if(c==="")return;const h=parseInt(c);h===void 0&&console.warn("unexpected reult for nodename");const u=a.primitives[0].material;if(h!==u&&console.warn("test",h,u),u===void 0)return;const d=a.primitives[0].indices;if(d===void 0)return;const g=a.primitives[0].attributes.POSITION,p=i.json.accessors&&i.json.accessors[d];if(p===void 0||p.bufferView===void 0)return;const E=i.json.accessors&&i.json.accessors[g];if(E===void 0||E.bufferView===void 0)return;const R=i.json.bufferViews&&i.json.bufferViews[p.bufferView];if(!R)return;const b=i.json.bufferViews&&i.json.bufferViews[E.bufferView];if(!b)return;const S=((_=(((y=i==null?void 0:i.json)==null?void 0:y.materials)&&((T=i==null?void 0:i.json)==null?void 0:T.materials[u])||{}).pbrMetallicRoughness)==null?void 0:_.baseColorFactor)||[1,1,1,1],w=i.resources["@glb.bin"],M=Ot(w,R,p),m=vt(w,b,E);if(!M.length){console.log("missing index",e,t,o);return}if(!m.length){console.log("missing position",e,t,o);return}Lt(M,m);const x=((A=i.json.scenes)==null?void 0:A.length)&&i.json.scenes[0].extras&&i.json.scenes[0].extras[`draw_ranges_node${h}`];if(!x){console.log("missing draw_ranges",e,t,`draw_ranges_node${h}`,o);return}s.push({position:m,index:M,color:S,draw_ranges:x,indexdbKey:Ct()})}),s}function $s(i,e,t,s,n){const r=Object.keys(n),o=[];r.forEach(a=>{const c=[],[h,u]=n[a];if(!u){o.push(a);return}for(let d=h;d<h+u;d++){const g=t[d]*3;c.push(s[g]),c.push(s[g+1]),c.push(s[g+2])}i.add(a),e[a]=Vt(c)}),o.forEach(a=>{delete n[a]}),o.length&&console.warn("Removed empty nodes/count 0, on :",o.length)}async function Js(i,e,t,s,n=null){var r,o,a,c;try{const h=new Ne(i),u=[],d=[],g=new Set,p={},E=jt(t);if(h.getJsonKey(E).then(T=>{Array.isArray(T)&&T.forEach(_=>{h.deleteKey(_)})}),!((o=(r=s==null?void 0:s.json)==null?void 0:r.scenes)!=null&&o.length))return console.log("Missing expected glb meta",e,t),null;const R=(c=(a=s==null?void 0:s.json)==null?void 0:a.scenes[0].extras)==null?void 0:c.id_hierarchy;if(!R)return console.log("Missing expected glb meta",e,t),null;const b=Ws(s,e,t),l={};for(let T=0;T<b.length;T++){const _=b[T];$s(g,p,_.index,_.position,_.draw_ranges);const A=_.index,I=h.getUUID();await h.setBufferKey(I,A.buffer),_.index=I,d.push(I);const z=_.position,v=h.getUUID();await h.setBufferKey(v,z.buffer),_.position=v,d.push(v),u.push(_.indexdbKey),d.push(_.indexdbKey),l[I]={indexdb_key:_.indexdbKey,index:I,color:_.color,position:v,id_sequence:structuredClone(_.draw_ranges)},_.draw_ranges=null,await h.setJsonKey(_.indexdbKey,_)}const S=Object.keys(R),w=[],M=new Map;let m=0;n?(M.set("*",1),m++):M.set("*",0),S.forEach(T=>{const _=p[T],A=R[T];let I,z;const v=A[0],C=A[1];M.has(T)?I=M.get(T):(m++,I=m,M.set(T,m)),M.has(C)?z=M.get(C):(m++,z=m,M.set(C,m)),w.push([I,v,z,_==null?void 0:_.x,_==null?void 0:_.y,_==null?void 0:_.z,_==null?void 0:_.X,_==null?void 0:_.Y,_==null?void 0:_.Z])}),n&&w.unshift([1,n,0,void 0,void 0,void 0,void 0,void 0,void 0]);const x={group_name:t,meshes:l,group_ref:w,version:2};Object.keys(x.meshes).forEach(T=>{const _={},A=x.meshes[T];Object.keys(A.id_sequence).forEach(z=>{let v;M.has(z)?v=M.get(z):(m++,v=m,M.set(z,m)),_[v]=A.id_sequence[z]}),A.id_sequence=_});const y=new TextEncoder().encode(JSON.stringify(x));return await h.setBufferKey(Nt(t),y),await h.setJsonKey(t,u),await h.setJsonKey(E,d),await h.close(),t}catch(h){return console.error("error",t,h),null}}async function Xs(i,e){const t=new Ne(i),s=await t.getJsonKey(e);if(s&&s.length)for(let n=0;n<s.length;n++){const r=await t.getJsonKey(s[n]);r!=null&&r.position&&await t.deleteKey(r.position),r!=null&&r.index&&await t.deleteKey(r.index),r!=null&&r.vertexColor&&await t.deleteKey(r.vertexColor)}}class Zs{async downloadFromAzure(e,t,s,n,r){var u,d;const o=Xs(t,n),a=await Ls(e,s,r);if(await Promise.resolve(o),!a)return console.log("Missing expected glbDoc",s,r),null;const c=(d=(u=a.json.asset)==null?void 0:u.extras)==null?void 0:d.web3dversion;let h;return c==2?h=Js(t,s,n,a):h=qs(t,s,n,a),h}}qe(Zs)})();
