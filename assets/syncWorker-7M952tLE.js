var qr=Object.defineProperty;var Yr=(ot,et,lt)=>et in ot?qr(ot,et,{enumerable:!0,configurable:!0,writable:!0,value:lt}):ot[et]=lt;var Ct=(ot,et,lt)=>(Yr(ot,typeof et!="symbol"?et+"":et,lt),lt);(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ot=Symbol("Comlink.proxy"),et=Symbol("Comlink.endpoint"),lt=Symbol("Comlink.releaseProxy"),fe=Symbol("Comlink.finalizer"),kt=Symbol("Comlink.thrown"),ve=o=>typeof o=="object"&&o!==null||typeof o=="function",Ms={canHandle:o=>ve(o)&&o[ot],serialize(o){const{port1:t,port2:e}=new MessageChannel;return de(o,t),[e,[e]]},deserialize(o){return o.start(),Rs(o)}},ws={canHandle:o=>ve(o)&&kt in o,serialize({value:o}){let t;return o instanceof Error?t={isError:!0,value:{message:o.message,name:o.name,stack:o.stack}}:t={isError:!1,value:o},[t,[]]},deserialize(o){throw o.isError?Object.assign(new Error(o.value.message),o.value):o.value}},Ue=new Map([["proxy",Ms],["throw",ws]]);function Ts(o,t){for(const e of o)if(t===e||e==="*"||e instanceof RegExp&&e.test(t))return!0;return!1}function de(o,t=globalThis,e=["*"]){t.addEventListener("message",function s(r){if(!r||!r.data)return;if(!Ts(e,r.origin)){console.warn(`Invalid origin '${r.origin}' for comlink proxy`);return}const{id:i,type:n,path:a}=Object.assign({path:[]},r.data),h=(r.data.argumentList||[]).map(ft);let u;try{const l=a.slice(0,-1).reduce((y,m)=>y[m],o),d=a.reduce((y,m)=>y[m],o);switch(n){case"GET":u=d;break;case"SET":l[a.slice(-1)[0]]=ft(r.data.value),u=!0;break;case"APPLY":u=d.apply(l,h);break;case"CONSTRUCT":{const y=new d(...h);u=zs(y)}break;case"ENDPOINT":{const{port1:y,port2:m}=new MessageChannel;de(o,m),u=Cs(y,[y])}break;case"RELEASE":u=void 0;break;default:return}}catch(l){u={value:l,[kt]:0}}Promise.resolve(u).catch(l=>({value:l,[kt]:0})).then(l=>{const[d,y]=Gt(l);t.postMessage(Object.assign(Object.assign({},d),{id:i}),y),n==="RELEASE"&&(t.removeEventListener("message",s),Le(t),fe in o&&typeof o[fe]=="function"&&o[fe]())}).catch(l=>{const[d,y]=Gt({value:new TypeError("Unserializable return value"),[kt]:0});t.postMessage(Object.assign(Object.assign({},d),{id:i}),y)})}),t.start&&t.start()}function bs(o){return o.constructor.name==="MessagePort"}function Le(o){bs(o)&&o.close()}function Rs(o,t){return pe(o,[],t)}function Vt(o){if(o)throw new Error("Proxy has been released and is not useable")}function Pe(o){return _t(o,{type:"RELEASE"}).then(()=>{Le(o)})}const jt=new WeakMap,Wt="FinalizationRegistry"in globalThis&&new FinalizationRegistry(o=>{const t=(jt.get(o)||0)-1;jt.set(o,t),t===0&&Pe(o)});function As(o,t){const e=(jt.get(t)||0)+1;jt.set(t,e),Wt&&Wt.register(o,t,o)}function Ss(o){Wt&&Wt.unregister(o)}function pe(o,t=[],e=function(){}){let s=!1;const r=new Proxy(e,{get(i,n){if(Vt(s),n===lt)return()=>{Ss(r),Pe(o),s=!0};if(n==="then"){if(t.length===0)return{then:()=>r};const a=_t(o,{type:"GET",path:t.map(h=>h.toString())}).then(ft);return a.then.bind(a)}return pe(o,[...t,n])},set(i,n,a){Vt(s);const[h,u]=Gt(a);return _t(o,{type:"SET",path:[...t,n].map(l=>l.toString()),value:h},u).then(ft)},apply(i,n,a){Vt(s);const h=t[t.length-1];if(h===et)return _t(o,{type:"ENDPOINT"}).then(ft);if(h==="bind")return pe(o,t.slice(0,-1));const[u,l]=Be(a);return _t(o,{type:"APPLY",path:t.map(d=>d.toString()),argumentList:u},l).then(ft)},construct(i,n){Vt(s);const[a,h]=Be(n);return _t(o,{type:"CONSTRUCT",path:t.map(u=>u.toString()),argumentList:a},h).then(ft)}});return As(r,o),r}function Is(o){return Array.prototype.concat.apply([],o)}function Be(o){const t=o.map(Gt);return[t.map(e=>e[0]),Is(t.map(e=>e[1]))]}const De=new WeakMap;function Cs(o,t){return De.set(o,t),o}function zs(o){return Object.assign(o,{[ot]:!0})}function Gt(o){for(const[t,e]of Ue)if(e.canHandle(o)){const[s,r]=e.serialize(o);return[{type:"HANDLER",name:t,value:s},r]}return[{type:"RAW",value:o},De.get(o)||[]]}function ft(o){switch(o.type){case"HANDLER":return Ue.get(o.name).deserialize(o.value);case"RAW":return o.value}}function _t(o,t,e){return new Promise(s=>{const r=Ns();o.addEventListener("message",function i(n){!n.data||!n.data.id||n.data.id!==r||(o.removeEventListener("message",i),s(n.data))}),o.start&&o.start(),o.postMessage(Object.assign({id:r},t),e)})}function Ns(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class ke{constructor(t,e=1,s="DATA"){Ct(this,"__name");Ct(this,"__version");Ct(this,"__storeName");Ct(this,"__logEnabled");Ct(this,"__db");this.__name=t,this.__version=e,this.__storeName=s,this.__logEnabled=!1}enableLog(){this.__logEnabled=!0}__logStart(t){this.__logEnabled&&console.time(`ModelStoreLog_${this.__name}_${this.__storeName}_${t}`)}__logEnd(t){this.__logEnabled&&console.timeEnd(`ModelStoreLog_${this.__name}_${this.__storeName}_${t}`)}close(){return new Promise(t=>{this.__db&&(this.__db.close(),t(!0))})}__open(){return new Promise((t,e)=>{if(this.__db)t(this.__db);else{const s=indexedDB.open(this.__name,this.__version);s.onupgradeneeded=()=>{const r=s.result;r.objectStoreNames.contains(this.__name)||r.createObjectStore(this.__storeName)},s.onblocked=r=>{this.__logEnd("getKey"),e({type:"onblocked",event:r})},s.onerror=r=>{this.__logEnd("getKey"),e({type:"onblocked",event:r})},s.onsuccess=()=>{this.__db=s.result,t(s.result)}}})}getUUID(){return crypto.randomUUID()}getKey(t){return new Promise(async(e,s)=>{this.__logStart("getKey");try{const i=(await this.__open()).transaction(this.__storeName);i.onerror=h=>{this.__logEnd("getKey"),s({type:"store tx error",event:h})};const a=i.objectStore(this.__storeName).get(t);a.onsuccess=()=>{this.__logEnd("getKey"),e(a.result)}}catch(r){this.__logEnd("getKey"),s(r)}})}setKey(t,e){return new Promise(async(s,r)=>{var i;this.__logStart("setKey");try{const a=(await this.__open()).transaction(this.__storeName,"readwrite");a.onerror=l=>{this.__logEnd("setKey"),r({type:"store tx error",event:l})};const u=a.objectStore(this.__storeName).put(e,t);u.onsuccess=()=>{this.__logEnd("setKey"),s(u.result)},(i=u.transaction)==null||i.commit()}catch(n){this.__logEnd("setKey"),r(n)}})}getAllKeys(){return new Promise(async(t,e)=>{this.__logStart("getAllKeys");try{const r=(await this.__open()).transaction(this.__storeName,"readwrite");r.onerror=a=>{this.__logEnd("getAllKeys"),e({type:"store tx error",event:a})};const n=r.objectStore(this.__storeName).getAllKeys();n.onsuccess=()=>{this.__logEnd("getAllKeys"),t(n.result)}}catch(s){this.__logEnd("getAllKeys"),e(s)}})}deleteKey(t){return new Promise(async(e,s)=>{this.__logStart("deleteKey");try{const i=(await this.__open()).transaction(this.__storeName,"readwrite");i.onerror=h=>{this.__logEnd("deleteKey"),s({type:"store tx error",event:h})};const a=i.objectStore(this.__storeName).delete(t);a.onsuccess=()=>{this.__logEnd("deleteKey"),e(a.result)}}catch(r){this.__logEnd("deleteKey"),s(r)}})}deleteDB(){return new Promise((t,e)=>{this.__logStart("deleteDB");const s=indexedDB.deleteDatabase(this.__name);s.onsuccess=()=>{this.__logEnd("deleteDB"),t(!0)},s.onerror=r=>{this.__logEnd("deleteDB"),e({type:"onblocked",event:r})}})}}const ge="APP_CONFIG";async function Os(o=!1){const t=new ke(ge);if(o){window||console.error("update storage can only be used on main tread"),window.__APP_DEV_ENV&&(window.__APP_ENV=window.__APP_DEV_ENV);const e=window.__APP_ENV||{};return await t.setKey(ge,e),e}return await t.getKey(ge)}async function Fs(o,t,e){const s=await Os();return await fetch(`${s.ENV__AZURE_STORAGE_URL}/${t}/${e}`,{headers:{"cache-control":"no-cache",pragma:"no-cache","x-ms-version":"2021-04-10","x-ms-date":new Date().toUTCString(),authorization:`Bearer ${o}`}})}let me=class{constructor(){this._listeners={}}addEventListener(t,e){const s=this._listeners;return s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e),this}removeEventListener(t,e){if(this._listeners===void 0)return this;const r=this._listeners[t];if(r!==void 0){const i=r.indexOf(e);i!==-1&&r.splice(i,1)}return this}dispatchEvent(t){if(this._listeners===void 0)return this;const s=this._listeners[t.type];if(s!==void 0){const r=s.slice(0);for(let i=0,n=r.length;i<n;i++)r[i].call(this,t)}return this}dispose(){for(const t in this._listeners)delete this._listeners[t]}};class Mt extends me{constructor(t,e,s,r={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=t,this._parent=e,this._child=s,this._attributes=r,!e.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(t){return this._child=t,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class vs extends me{constructor(...t){super(...t),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(t){return Array.from(this._childEdges.get(t)||this._emptySet)}listParents(t){return this.listParentEdges(t).map(e=>e.getParent())}listChildEdges(t){return Array.from(this._parentEdges.get(t)||this._emptySet)}listChildren(t){return this.listChildEdges(t).map(e=>e.getChild())}disconnectParents(t,e){let s=this.listParentEdges(t);return e&&(s=s.filter(r=>e(r.getParent()))),s.forEach(r=>r.dispose()),this}createEdge(t,e,s,r){return this._registerEdge(new Mt(t,e,s,r))}_registerEdge(t){this._edges.add(t);const e=t.getParent();this._parentEdges.has(e)||this._parentEdges.set(e,new Set),this._parentEdges.get(e).add(t);const s=t.getChild();return this._childEdges.has(s)||this._childEdges.set(s,new Set),this._childEdges.get(s).add(t),t.addEventListener("dispose",()=>this._removeEdge(t)),t}_removeEdge(t){return this._edges.delete(t),this._parentEdges.get(t.getParent()).delete(t),this._childEdges.get(t.getChild()).delete(t),this}}function zt(){return zt=Object.assign||function(o){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(o[s]=e[s])}return o},zt.apply(this,arguments)}function ye(o){return o instanceof Mt}function Nt(o){return Array.isArray(o)&&o[0]instanceof Mt}function Ot(o){return!!(Ls(o)&&Us(o)instanceof Mt)}function Us(o){for(const t in o)return o[t]}function Ls(o){return!!o&&Object.getPrototypeOf(o)===Object.prototype}const U=Symbol("attributes"),wt=Symbol("immutableKeys");class xe extends me{constructor(t){super(),this._disposed=!1,this.graph=void 0,this[U]=void 0,this[wt]=void 0,this.graph=t,this[wt]=new Set,this[U]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const t=this.getDefaults(),e={};for(const s in t){const r=t[s];if(r instanceof xe){const i=this.graph.createEdge(s,this,r);i.addEventListener("dispose",()=>r.dispose()),this[wt].add(s),e[s]=i}else e[s]=r}return e}isOnGraph(t){return this.graph===t.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(t=>t.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(t,e){for(const s in this[U]){const r=this[U][s];if(ye(r)){const i=r;i.getChild()===t&&this.setRef(s,e,i.getAttributes())}else if(Nt(r)){const n=r.find(a=>a.getChild()===t);if(n){const a=n.getAttributes();this.removeRef(s,t).addRef(s,e,a)}}else if(Ot(r)){const i=r;for(const n in i){const a=i[n];a.getChild()===t&&this.setRefMap(s,n,e,a.getAttributes())}}}return this}get(t){return this[U][t]}set(t,e){return this[U][t]=e,this.dispatchEvent({type:"change",attribute:t})}getRef(t){const e=this[U][t];return e?e.getChild():null}setRef(t,e,s){if(this[wt].has(t))throw new Error(`Cannot overwrite immutable attribute, "${t}".`);const r=this[U][t];if(r&&r.dispose(),!e)return this;const i=this.graph.createEdge(t,this,e,s);return i.addEventListener("dispose",()=>{delete this[U][t],this.dispatchEvent({type:"change",attribute:t})}),this[U][t]=i,this.dispatchEvent({type:"change",attribute:t})}listRefs(t){return this[U][t].map(s=>s.getChild())}addRef(t,e,s){const r=this.graph.createEdge(t,this,e,s),i=this[U][t];return i.push(r),r.addEventListener("dispose",()=>{let n;for(;(n=i.indexOf(r))!==-1;)i.splice(n,1);this.dispatchEvent({type:"change",attribute:t})}),this.dispatchEvent({type:"change",attribute:t})}removeRef(t,e){return this[U][t].filter(i=>i.getChild()===e).forEach(i=>i.dispose()),this}listRefMapKeys(t){return Object.keys(this[U][t])}listRefMapValues(t){return Object.values(this[U][t]).map(e=>e.getChild())}getRefMap(t,e){const s=this[U][t];return s[e]?s[e].getChild():null}setRefMap(t,e,s,r){const i=this[U][t],n=i[e];if(n&&n.dispose(),!s)return this;r=Object.assign(r||{},{key:e});const a=this.graph.createEdge(t,this,s,zt({},r,{key:e}));return a.addEventListener("dispose",()=>{delete i[e],this.dispatchEvent({type:"change",attribute:t,key:e})}),i[e]=a,this.dispatchEvent({type:"change",attribute:t,key:e})}dispatchEvent(t){return super.dispatchEvent(zt({},t,{target:this})),this.graph.dispatchEvent(zt({},t,{target:this,type:`node:${t.type}`})),this}}const Ve="v3.10.1",qt="@glb.bin";var N,Yt,Y,Ee,dt;(function(o){o.ACCESSOR="Accessor",o.ANIMATION="Animation",o.ANIMATION_CHANNEL="AnimationChannel",o.ANIMATION_SAMPLER="AnimationSampler",o.BUFFER="Buffer",o.CAMERA="Camera",o.MATERIAL="Material",o.MESH="Mesh",o.PRIMITIVE="Primitive",o.PRIMITIVE_TARGET="PrimitiveTarget",o.NODE="Node",o.ROOT="Root",o.SCENE="Scene",o.SKIN="Skin",o.TEXTURE="Texture",o.TEXTURE_INFO="TextureInfo"})(N||(N={})),function(o){o.INTERLEAVED="interleaved",o.SEPARATE="separate"}(Yt||(Yt={})),function(o){o.ARRAY_BUFFER="ARRAY_BUFFER",o.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",o.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",o.OTHER="OTHER",o.SPARSE="SPARSE"}(Y||(Y={})),function(o){o[o.R=4096]="R",o[o.G=256]="G",o[o.B=16]="B",o[o.A=1]="A"}(Ee||(Ee={})),function(o){o.GLTF="GLTF",o.GLB="GLB"}(dt||(dt={}));const Ht={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var Kt,_e=typeof Float32Array<"u"?Float32Array:Array;function Me(o){return Math.hypot(o[0],o[1],o[2])}Math.hypot||(Math.hypot=function(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)}),Kt=new _e(3),_e!=Float32Array&&(Kt[0]=0,Kt[1]=0,Kt[2]=0);class F{static createBufferFromDataURI(t){if(typeof Buffer>"u"){const e=atob(t.split(",")[1]),s=new Uint8Array(e.length);for(let r=0;r<e.length;r++)s[r]=e.charCodeAt(r);return s}{const e=t.split(",")[1],s=t.indexOf("base64")>=0;return Buffer.from(e,s?"base64":"utf8")}}static encodeText(t){return typeof TextEncoder<"u"?new TextEncoder().encode(t):Buffer.from(t)}static decodeText(t){return typeof TextDecoder<"u"?new TextDecoder().decode(t):Buffer.from(t).toString("utf8")}static concat(t){let e=0;for(const i of t)e+=i.byteLength;const s=new Uint8Array(e);let r=0;for(const i of t)s.set(i,r),r+=i.byteLength;return s}static pad(t,e=0){const s=this.padNumber(t.byteLength);if(s===t.byteLength)return t;const r=new Uint8Array(s);if(r.set(t),e!==0)for(let i=t.byteLength;i<s;i++)r[i]=e;return r}static padNumber(t){return 4*Math.ceil(t/4)}static equals(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;let s=t.byteLength;for(;s--;)if(t[s]!==e[s])return!1;return!0}static toView(t,e=0,s=1/0){return new Uint8Array(t.buffer,t.byteOffset+e,Math.min(t.byteLength,s))}static assertView(t){if(t&&!ArrayBuffer.isView(t))throw new Error(`Method requires Uint8Array parameter; received "${typeof t}".`);return t}}class Xt{static hexToFactor(t,e){t=Math.floor(t);const s=e;return s[0]=(t>>16&255)/255,s[1]=(t>>8&255)/255,s[2]=(255&t)/255,this.convertSRGBToLinear(e,e)}static factorToHex(t){const e=[...t],[s,r,i]=this.convertLinearToSRGB(t,e);return 255*s<<16^255*r<<8^255*i<<0}static convertSRGBToLinear(t,e){const s=t,r=e;for(let i=0;i<3;i++)r[i]=s[i]<.04045?.0773993808*s[i]:Math.pow(.9478672986*s[i]+.0521327014,2.4);return e}static convertLinearToSRGB(t,e){const s=t,r=e;for(let i=0;i<3;i++)r[i]=s[i]<.0031308?12.92*s[i]:1.055*Math.pow(s[i],.41666)-.055;return e}}class Jt{match(t){return t.length>=8&&t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71&&t[4]===13&&t[5]===10&&t[6]===26&&t[7]===10}getSize(t){const e=new DataView(t.buffer,t.byteOffset);return F.decodeText(t.slice(12,16))===Jt.PNG_FRIED_CHUNK_NAME?[e.getUint32(32,!1),e.getUint32(36,!1)]:[e.getUint32(16,!1),e.getUint32(20,!1)]}getChannels(t){return 4}}Jt.PNG_FRIED_CHUNK_NAME="CgBI";class pt{static registerFormat(t,e){this.impls[t]=e}static getMimeType(t){for(const e in this.impls)if(this.impls[e].match(t))return e;return null}static getSize(t,e){return this.impls[e]?this.impls[e].getSize(t):null}static getChannels(t,e){return this.impls[e]?this.impls[e].getChannels(t):null}static getVRAMByteLength(t,e){if(!this.impls[e])return null;if(this.impls[e].getVRAMByteLength)return this.impls[e].getVRAMByteLength(t);let s=0;const r=this.getSize(t,e);if(!r)return null;for(;r[0]>1||r[1]>1;)s+=r[0]*r[1]*4,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return s+=4,s}static mimeTypeToExtension(t){return t==="image/jpeg"?"jpg":t.split("/").pop()}static extensionToMimeType(t){return t==="jpg"?"image/jpeg":t?`image/${t}`:""}}function Ps(o,t){if(t>o.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(o.getUint8(t)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return o}pt.impls={"image/jpeg":new class{match(o){return o.length>=3&&o[0]===255&&o[1]===216&&o[2]===255}getSize(o){let t,e,s=new DataView(o.buffer,o.byteOffset+4);for(;s.byteLength;){if(t=s.getUint16(0,!1),Ps(s,t),e=s.getUint8(t+1),e===192||e===193||e===194)return[s.getUint16(t+7,!1),s.getUint16(t+5,!1)];s=new DataView(o.buffer,s.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(o){return 3}},"image/png":new Jt};class Tt{static basename(t){const e=t.split(/[\\/]/).pop();return e.substring(0,e.lastIndexOf("."))}static extension(t){if(t.startsWith("data:image/")){const e=t.match(/data:(image\/\w+)/)[1];return pt.mimeTypeToExtension(e)}return t.startsWith("data:model/gltf+json")?"gltf":t.startsWith("data:model/gltf-binary")?"glb":t.startsWith("data:application/")?"bin":t.split(/[\\/]/).pop().split(/[.]/).pop()}}function je(o){return Object.prototype.toString.call(o)==="[object Object]"}function gt(o){if(je(o)===!1)return!1;const t=o.constructor;if(t===void 0)return!0;const e=t.prototype;return je(e)!==!1&&Object.prototype.hasOwnProperty.call(e,"isPrototypeOf")!==!1}var we,Te;(function(o){o[o.SILENT=4]="SILENT",o[o.ERROR=3]="ERROR",o[o.WARN=2]="WARN",o[o.INFO=1]="INFO",o[o.DEBUG=0]="DEBUG"})(Te||(Te={}));class X{constructor(t){this.verbosity=void 0,this.verbosity=t}debug(t){this.verbosity<=X.Verbosity.DEBUG&&console.debug(t)}info(t){this.verbosity<=X.Verbosity.INFO&&console.info(t)}warn(t){this.verbosity<=X.Verbosity.WARN&&console.warn(t)}error(t){this.verbosity<=X.Verbosity.ERROR&&console.error(t)}}function Bs(o,t,e){var s=t[0],r=t[1],i=t[2],n=t[3],a=t[4],h=t[5],u=t[6],l=t[7],d=t[8],y=t[9],m=t[10],_=t[11],w=t[12],f=t[13],M=t[14],c=t[15],p=e[0],g=e[1],x=e[2],E=e[3];return o[0]=p*s+g*a+x*d+E*w,o[1]=p*r+g*h+x*y+E*f,o[2]=p*i+g*u+x*m+E*M,o[3]=p*n+g*l+x*_+E*c,o[4]=(p=e[4])*s+(g=e[5])*a+(x=e[6])*d+(E=e[7])*w,o[5]=p*r+g*h+x*y+E*f,o[6]=p*i+g*u+x*m+E*M,o[7]=p*n+g*l+x*_+E*c,o[8]=(p=e[8])*s+(g=e[9])*a+(x=e[10])*d+(E=e[11])*w,o[9]=p*r+g*h+x*y+E*f,o[10]=p*i+g*u+x*m+E*M,o[11]=p*n+g*l+x*_+E*c,o[12]=(p=e[12])*s+(g=e[13])*a+(x=e[14])*d+(E=e[15])*w,o[13]=p*r+g*h+x*y+E*f,o[14]=p*i+g*u+x*m+E*M,o[15]=p*n+g*l+x*_+E*c,o}we=X,X.Verbosity=Te,X.DEFAULT_INSTANCE=new we(we.Verbosity.INFO);class P{static identity(t){return t}static eq(t,e,s=1e-5){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(Math.abs(t[r]-e[r])>s)return!1;return!0}static decodeNormalizedInt(t,e){switch(e){case 5126:return t;case 5123:return t/65535;case 5121:return t/255;case 5122:return Math.max(t/32767,-1);case 5120:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(t,e){return P.decodeNormalizedInt(t,e)}static encodeNormalizedInt(t,e){switch(e){case 5126:return t;case 5123:return Math.round(65535*t);case 5121:return Math.round(255*t);case 5122:return Math.round(32767*t);case 5120:return Math.round(127*t);default:throw new Error("Invalid component type.")}}static normalize(t,e){return P.encodeNormalizedInt(t,e)}static decompose(t,e,s,r){let i=Me([t[0],t[1],t[2]]);const n=Me([t[4],t[5],t[6]]),a=Me([t[8],t[9],t[10]]);var h,u,l,d,y,m,_,w,f,M,c,p,g,x,E,T,b;((u=(h=t)[0])*(_=h[5])-(l=h[1])*(m=h[4]))*((p=h[10])*(b=h[15])-(g=h[11])*(T=h[14]))-(u*(w=h[6])-(d=h[2])*m)*((c=h[9])*b-g*(E=h[13]))+(u*(f=h[7])-(y=h[3])*m)*(c*T-p*E)+(l*w-d*_)*((M=h[8])*b-g*(x=h[12]))-(l*f-y*_)*(M*T-p*x)+(d*f-y*w)*(M*E-c*x)<0&&(i=-i),e[0]=t[12],e[1]=t[13],e[2]=t[14];const R=t.slice(),z=1/i,A=1/n,v=1/a;R[0]*=z,R[1]*=z,R[2]*=z,R[4]*=A,R[5]*=A,R[6]*=A,R[8]*=v,R[9]*=v,R[10]*=v,function(S,I){var O=new _e(3);(function(Fe,nt){var Dr=nt[4],kr=nt[5],Vr=nt[6],jr=nt[8],Wr=nt[9],Gr=nt[10];Fe[0]=Math.hypot(nt[0],nt[1],nt[2]),Fe[1]=Math.hypot(Dr,kr,Vr),Fe[2]=Math.hypot(jr,Wr,Gr)})(O,I);var B=1/O[0],L=1/O[1],q=1/O[2],D=I[0]*B,K=I[1]*L,Q=I[2]*q,J=I[4]*B,ct=I[5]*L,ut=I[6]*q,ue=I[8]*B,le=I[9]*L,It=I[10]*q,_s=D+ct+It,k=0;_s>0?(k=2*Math.sqrt(_s+1),S[3]=.25*k,S[0]=(ut-le)/k,S[1]=(ue-Q)/k,S[2]=(K-J)/k):D>ct&&D>It?(k=2*Math.sqrt(1+D-ct-It),S[3]=(ut-le)/k,S[0]=.25*k,S[1]=(K+J)/k,S[2]=(ue+Q)/k):ct>It?(k=2*Math.sqrt(1+ct-D-It),S[3]=(ue-Q)/k,S[0]=(K+J)/k,S[1]=.25*k,S[2]=(ut+le)/k):(k=2*Math.sqrt(1+It-D-ct),S[3]=(K-J)/k,S[0]=(ue+Q)/k,S[1]=(ut+le)/k,S[2]=.25*k)}(s,R),r[0]=i,r[1]=n,r[2]=a}static compose(t,e,s,r){const i=r,n=e[0],a=e[1],h=e[2],u=e[3],l=n+n,d=a+a,y=h+h,m=n*l,_=n*d,w=n*y,f=a*d,M=a*y,c=h*y,p=u*l,g=u*d,x=u*y,E=s[0],T=s[1],b=s[2];return i[0]=(1-(f+c))*E,i[1]=(_+x)*E,i[2]=(w-g)*E,i[3]=0,i[4]=(_-x)*T,i[5]=(1-(m+c))*T,i[6]=(M+p)*T,i[7]=0,i[8]=(w+g)*b,i[9]=(M-p)*b,i[10]=(1-(m+f))*b,i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i}}function Ds(o,t){if(!!o!=!!t)return!1;const e=o.getChild(),s=t.getChild();return e===s||e.equals(s)}function ks(o,t){if(!!o!=!!t||o.length!==t.length)return!1;for(let e=0;e<o.length;e++){const s=o[e],r=t[e];if(s.getChild()!==r.getChild()&&!s.getChild().equals(r.getChild()))return!1}return!0}function Vs(o,t){if(!!o!=!!t)return!1;const e=Object.keys(o),s=Object.keys(t);if(e.length!==s.length)return!1;for(const r in o){const i=o[r],n=t[r];if(!!i!=!!n)return!1;const a=i.getChild(),h=n.getChild();if(a!==h&&!a.equals(h))return!1}return!0}function We(o,t){if(o===t)return!0;if(!!o!=!!t||!o||!t||o.length!==t.length)return!1;for(let e=0;e<o.length;e++)if(o[e]!==t[e])return!1;return!0}function Ge(o,t){if(o===t)return!0;if(!!o!=!!t)return!1;if(!gt(o)||!gt(t))return o===t;const e=o,s=t;let r,i=0,n=0;for(r in e)i++;for(r in s)n++;if(i!==n)return!1;for(r in e){const a=e[r],h=s[r];if($t(a)&&$t(h)){if(!We(a,h))return!1}else if(gt(a)&&gt(h)){if(!Ge(a,h))return!1}else if(a!==h)return!1}return!0}function $t(o){return Array.isArray(o)||ArrayBuffer.isView(o)}const qe=new Set,js=function(){let o="";for(let t=0;t<6;t++)o+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return o},Ws=function(){for(let o=0;o<999;o++){const t=js();if(!qe.has(t))return qe.add(t),t}return""},Ye="https://null.example";class Ft{static dirname(t){const e=t.lastIndexOf("/");return e===-1?"./":t.substring(0,e+1)}static basename(t){return Tt.basename(new URL(t,Ye).pathname)}static extension(t){return Tt.extension(new URL(t,Ye).pathname)}static resolve(t,e){if(!this.isRelativePath(e))return e;const s=t.split("/"),r=e.split("/");s.pop();for(let i=0;i<r.length;i++)r[i]!=="."&&(r[i]===".."?s.pop():s.push(r[i]));return s.join("/")}static isAbsoluteURL(t){return this.PROTOCOL_REGEXP.test(t)}static isRelativePath(t){return!/^(?:[a-zA-Z]+:)?\//.test(t)}}Ft.DEFAULT_INIT={},Ft.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const st=o=>o,Gs=new Set;class be extends xe{constructor(t,e=""){super(t),this[U].name=e,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(t,e){return Array.isArray(e)&&(e=e.slice()),super.set(t,e)}getName(){return this.get("name")}setName(t){return this.set("name",t)}getExtras(){return this.get("extras")}setExtras(t){return this.set("extras",t)}clone(){return new this.constructor(this.graph).copy(this,st)}copy(t,e=st){for(const s in this[U]){const r=this[U][s];if(r instanceof Mt)this[wt].has(s)||r.dispose();else if(Nt(r))for(const i of r)i.dispose();else if(Ot(r))for(const i in r)r[i].dispose()}for(const s in t[U]){const r=this[U][s],i=t[U][s];if(i instanceof Mt)this[wt].has(s)?r.getChild().copy(e(i.getChild()),e):this.setRef(s,e(i.getChild()),i.getAttributes());else if(Nt(i))for(const n of i)this.addRef(s,e(n.getChild()),n.getAttributes());else if(Ot(i))for(const n in i){const a=i[n];this.setRefMap(s,n,e(a.getChild()),a.getAttributes())}else this[U][s]=gt(i)?JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.slice():i}return this}equals(t,e=Gs){if(this===t)return!0;if(this.propertyType!==t.propertyType)return!1;for(const s in this[U]){if(e.has(s))continue;const r=this[U][s],i=t[U][s];if(ye(r)||ye(i)){if(!Ds(r,i))return!1}else if(Nt(r)||Nt(i)){if(!ks(r,i))return!1}else if(Ot(r)||Ot(i)){if(!Vs(r,i))return!1}else if(gt(r)||gt(i)){if(!Ge(r,i))return!1}else if($t(r)||$t(i)){if(!We(r,i))return!1}else if(r!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,t=>t.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class W extends be{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(t){return this.getRefMap("extensions",t)}setExtension(t,e){return e&&e.t(this),this.setRefMap("extensions",t,e)}listExtensions(){return this.listRefMapValues("extensions")}}class C extends W{constructor(...t){super(...t),this.i=P.identity,this.o=P.identity}init(){this.propertyType=N.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:C.Type.SCALAR,componentType:C.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(t,e=st){return super.copy(t,e),this.i=t.i,this.o=t.o,this}static getElementSize(t){switch(t){case C.Type.SCALAR:return 1;case C.Type.VEC2:return 2;case C.Type.VEC3:return 3;case C.Type.VEC4:case C.Type.MAT2:return 4;case C.Type.MAT3:return 9;case C.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+t)}}static getComponentSize(t){switch(t){case C.ComponentType.BYTE:case C.ComponentType.UNSIGNED_BYTE:return 1;case C.ComponentType.SHORT:case C.ComponentType.UNSIGNED_SHORT:return 2;case C.ComponentType.UNSIGNED_INT:case C.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+t)}}getMinNormalized(t){const e=this.getElementSize();this.getMin(t);for(let s=0;s<e;s++)t[s]=this.o(t[s]);return t}getMin(t){const e=this.get("array"),s=this.getCount(),r=this.getElementSize();for(let i=0;i<r;i++)t[i]=1/0;for(let i=0;i<s*r;i+=r)for(let n=0;n<r;n++){const a=e[i+n];Number.isFinite(a)&&(t[n]=Math.min(t[n],a))}return t}getMaxNormalized(t){const e=this.getElementSize();this.getMax(t);for(let s=0;s<e;s++)t[s]=this.o(t[s]);return t}getMax(t){const e=this.get("array"),s=this.getCount(),r=this.getElementSize();for(let i=0;i<r;i++)t[i]=-1/0;for(let i=0;i<s*r;i+=r)for(let n=0;n<r;n++){const a=e[i+n];Number.isFinite(a)&&(t[n]=Math.max(t[n],a))}return t}getCount(){const t=this.get("array");return t?t.length/this.getElementSize():0}getType(){return this.get("type")}setType(t){return this.set("type",t)}getElementSize(){return C.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(t){return this.set("normalized",t),t?(this.o=e=>P.decodeNormalizedInt(e,this.get("componentType")),this.i=e=>P.encodeNormalizedInt(e,this.get("componentType"))):(this.o=P.identity,this.i=P.identity),this}getScalar(t){const e=this.getElementSize();return this.o(this.get("array")[t*e])}setScalar(t,e){return this.get("array")[t*this.getElementSize()]=this.i(e),this}getElement(t,e){const s=this.getElementSize(),r=this.get("array");for(let i=0;i<s;i++)e[i]=this.o(r[t*s+i]);return e}setElement(t,e){const s=this.getElementSize(),r=this.get("array");for(let i=0;i<s;i++)r[t*s+i]=this.i(e[i]);return this}getSparse(){return this.get("sparse")}setSparse(t){return this.set("sparse",t)}getBuffer(){return this.getRef("buffer")}setBuffer(t){return this.setRef("buffer",t)}getArray(){return this.get("array")}setArray(t){return this.set("componentType",t?function(e){switch(e.constructor){case Float32Array:return C.ComponentType.FLOAT;case Uint32Array:return C.ComponentType.UNSIGNED_INT;case Uint16Array:return C.ComponentType.UNSIGNED_SHORT;case Uint8Array:return C.ComponentType.UNSIGNED_BYTE;case Int16Array:return C.ComponentType.SHORT;case Int8Array:return C.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(t):C.ComponentType.FLOAT),this.set("array",t),this}getByteLength(){const t=this.get("array");return t?t.byteLength:0}}C.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},C.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class He extends W{init(){this.propertyType=N.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(t){return this.addRef("channels",t)}removeChannel(t){return this.removeRef("channels",t)}listChannels(){return this.listRefs("channels")}addSampler(t){return this.addRef("samplers",t)}removeSampler(t){return this.removeRef("samplers",t)}listSamplers(){return this.listRefs("samplers")}}class Ke extends W{init(){this.propertyType=N.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(t){return this.set("targetPath",t)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(t){return this.setRef("targetNode",t)}getSampler(){return this.getRef("sampler")}setSampler(t){return this.setRef("sampler",t)}}Ke.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class vt extends W{init(){this.propertyType=N.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:vt.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(t){return this.set("interpolation",t)}getInput(){return this.getRef("input")}setInput(t){return this.setRef("input",t,{usage:Y.OTHER})}getOutput(){return this.getRef("output")}setOutput(t){return this.setRef("output",t,{usage:Y.OTHER})}}vt.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Xe extends W{init(){this.propertyType=N.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(t){return this.set("uri",t)}}class mt extends W{init(){this.propertyType=N.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:mt.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(t){return this.set("type",t)}getZNear(){return this.get("znear")}setZNear(t){return this.set("znear",t)}getZFar(){return this.get("zfar")}setZFar(t){return this.set("zfar",t)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(t){return this.set("aspectRatio",t)}getYFov(){return this.get("yfov")}setYFov(t){return this.set("yfov",t)}getXMag(){return this.get("xmag")}setXMag(t){return this.set("xmag",t)}getYMag(){return this.get("ymag")}setYMag(t){return this.set("ymag",t)}}mt.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class qs extends be{t(t){if(!this.parentTypes.includes(t.propertyType))throw new Error(`Parent "${t.propertyType}" invalid for child "${this.propertyType}".`)}}qs.EXTENSION_NAME=void 0;class $ extends W{init(){this.propertyType=N.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:$.WrapMode.REPEAT,wrapT:$.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(t){return this.set("texCoord",t)}getMagFilter(){return this.get("magFilter")}setMagFilter(t){return this.set("magFilter",t)}getMinFilter(){return this.get("minFilter")}setMinFilter(t){return this.set("minFilter",t)}getWrapS(){return this.get("wrapS")}setWrapS(t){return this.set("wrapS",t)}getWrapT(){return this.get("wrapT")}setWrapT(t){return this.set("wrapT",t)}}$.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},$.MagFilter={NEAREST:9728,LINEAR:9729},$.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Zt,G:Qt,B:te,A:Ys}=Ee;class yt extends W{init(){this.propertyType=N.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:yt.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new $(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new $(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new $(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new $(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new $(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(t){return this.set("doubleSided",t)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(t){const e=this.get("baseColorFactor").slice();return e[3]=t,this.set("baseColorFactor",e)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(t){return this.set("alphaMode",t)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(t){return this.set("alphaCutoff",t)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(t){return this.set("baseColorFactor",t)}getBaseColorHex(){return Xt.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(t){const e=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Xt.hexToFactor(t,e))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(t){return this.setRef("baseColorTexture",t,{channels:Zt|Qt|te|Ys,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(t){return this.set("emissiveFactor",t)}getEmissiveHex(){return Xt.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(t){const e=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Xt.hexToFactor(t,e))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(t){return this.setRef("emissiveTexture",t,{channels:Zt|Qt|te,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(t){return this.set("normalScale",t)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(t){return this.setRef("normalTexture",t,{channels:Zt|Qt|te})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(t){return this.set("occlusionStrength",t)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(t){return this.setRef("occlusionTexture",t,{channels:Zt})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(t){return this.set("roughnessFactor",t)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(t){return this.set("metallicFactor",t)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(t){return this.setRef("metallicRoughnessTexture",t,{channels:Qt|te})}}yt.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class Je extends W{init(){this.propertyType=N.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(t){return this.addRef("primitives",t)}removePrimitive(t){return this.removeRef("primitives",t)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(t){return this.set("weights",t)}}class $e extends W{constructor(...t){super(...t),this.u=null,this.h=new Set}init(){this.propertyType=N.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(t,e=st){if(e===st)throw new Error("Node cannot be copied.");return super.copy(t,e)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(t){return this.set("translation",t)}setRotation(t){return this.set("rotation",t)}setScale(t){return this.set("scale",t)}getMatrix(){return P.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(t){const e=this.get("translation").slice(),s=this.get("rotation").slice(),r=this.get("scale").slice();return P.decompose(t,e,s,r),this.set("translation",e).set("rotation",s).set("scale",r)}getWorldTranslation(){const t=[0,0,0];return P.decompose(this.getWorldMatrix(),t,[0,0,0,1],[1,1,1]),t}getWorldRotation(){const t=[0,0,0,1];return P.decompose(this.getWorldMatrix(),[0,0,0],t,[1,1,1]),t}getWorldScale(){const t=[1,1,1];return P.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],t),t}getWorldMatrix(){const t=[];for(let r=this;r!=null;r=r.u)t.push(r);let e;const s=t.pop().getMatrix();for(;e=t.pop();)Bs(s,s,e.getMatrix());return s}addChild(t){if(t.u&&t.u.removeChild(t),t.h.size)for(const s of t.h)s.removeChild(t);this.addRef("children",t),t.u=this;const e=this[U].children;return e[e.length-1].addEventListener("dispose",()=>t.u=null),this}removeChild(t){return this.removeRef("children",t)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(t=>t.propertyType===N.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(t){return this.setRef("mesh",t)}getCamera(){return this.getRef("camera")}setCamera(t){return this.setRef("camera",t)}getSkin(){return this.getRef("skin")}setSkin(t){return this.setRef("skin",t)}getWeights(){return this.get("weights")}setWeights(t){return this.set("weights",t)}traverse(t){t(this);for(const e of this.listChildren())e.traverse(t);return this}}class ee extends W{init(){this.propertyType=N.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:ee.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(t){return this.setRef("indices",t,{usage:Y.ELEMENT_ARRAY_BUFFER})}getAttribute(t){return this.getRefMap("attributes",t)}setAttribute(t,e){return this.setRefMap("attributes",t,e,{usage:Y.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(t){return this.setRef("material",t)}getMode(){return this.get("mode")}setMode(t){return this.set("mode",t)}listTargets(){return this.listRefs("targets")}addTarget(t){return this.addRef("targets",t)}removeTarget(t){return this.removeRef("targets",t)}}ee.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Hs extends be{init(){this.propertyType=N.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(t){return this.getRefMap("attributes",t)}setAttribute(t,e){return this.setRefMap("attributes",t,e,{usage:Y.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function G(){return G=Object.assign?Object.assign.bind():function(o){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(o[s]=e[s])}return o},G.apply(this,arguments)}class Ze extends W{init(){this.propertyType=N.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(t,e=st){if(e===st)throw new Error("Scene cannot be copied.");return super.copy(t,e)}addChild(t){t.u&&t.u.removeChild(t),this.addRef("children",t),t.h.add(this);const e=this[U].children;return e[e.length-1].addEventListener("dispose",()=>t.h.delete(this)),this}removeChild(t){return this.removeRef("children",t)}listChildren(){return this.listRefs("children")}traverse(t){for(const e of this.listChildren())e.traverse(t);return this}}class Qe extends W{init(){this.propertyType=N.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(t){return this.setRef("skeleton",t)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(t){return this.setRef("inverseBindMatrices",t,{usage:Y.INVERSE_BIND_MATRICES})}addJoint(t){return this.addRef("joints",t)}removeJoint(t){return this.removeRef("joints",t)}listJoints(){return this.listRefs("joints")}}class ts extends W{init(){this.propertyType=N.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||pt.extensionToMimeType(Tt.extension(this.get("uri")))}setMimeType(t){return this.set("mimeType",t)}getURI(){return this.get("uri")}setURI(t){this.set("uri",t);const e=pt.extensionToMimeType(Tt.extension(t));return e&&this.set("mimeType",e),this}getImage(){return this.get("image")}setImage(t){return this.set("image",F.assertView(t))}getSize(){const t=this.get("image");return t?pt.getSize(t,this.getMimeType()):null}}class Ks extends W{init(){this.propertyType=N.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${Ve}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(t){super(t),this.l=new Set,t.addEventListener("node:create",e=>{this.g(e.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(t,e=st){if(e===st)throw new Error("Root cannot be copied.");this.set("asset",G({},t.get("asset"))),this.setName(t.getName()),this.setExtras(G({},t.getExtras())),this.setDefaultScene(t.getDefaultScene()?e(t.getDefaultScene()):null);for(const s of t.listRefMapKeys("extensions")){const r=t.getExtension(s);this.setExtension(s,e(r))}return this}g(t){return t instanceof Ze?this.addRef("scenes",t):t instanceof $e?this.addRef("nodes",t):t instanceof mt?this.addRef("cameras",t):t instanceof Qe?this.addRef("skins",t):t instanceof Je?this.addRef("meshes",t):t instanceof yt?this.addRef("materials",t):t instanceof ts?this.addRef("textures",t):t instanceof He?this.addRef("animations",t):t instanceof C?this.addRef("accessors",t):t instanceof Xe&&this.addRef("buffers",t),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.l)}listExtensionsRequired(){return this.listExtensionsUsed().filter(t=>t.isRequired())}p(t){return this.l.add(t),this}m(t){return this.l.delete(t),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(t){return this.setRef("defaultScene",t)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class bt{static fromGraph(t){return bt.v.get(t)||null}constructor(){this.T=new vs,this.S=new Ks(this.T),this.M=X.DEFAULT_INSTANCE,bt.v.set(this.T,this)}getRoot(){return this.S}getGraph(){return this.T}getLogger(){return this.M}setLogger(t){return this.M=t,this}clone(){return new bt().setLogger(this.M).merge(this)}merge(t){for(const i of t.getRoot().listExtensionsUsed()){const n=this.createExtension(i.constructor);i.isRequired()&&n.setRequired(!0)}const e=new Set,s=new Map;e.add(t.S),s.set(t.S,this.S);for(const i of t.T.listEdges())for(const n of[i.getParent(),i.getChild()]){if(e.has(n))continue;let a;a=n.propertyType===N.TEXTURE_INFO?n:new n.constructor(this.T),s.set(n,a),e.add(n)}const r=i=>{const n=s.get(i);if(!n)throw new Error("Could resolve property.");return n};for(const i of e){const n=s.get(i);if(!n)throw new Error("Could resolve property.");n.propertyType!==N.TEXTURE_INFO&&n.copy(i,r)}return this}async transform(...t){const e=t.map(s=>s.name);for(const s of t)await s(this,{stack:e});return this}createExtension(t){const e=t.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===e)||new t(this)}createScene(t=""){return new Ze(this.T,t)}createNode(t=""){return new $e(this.T,t)}createCamera(t=""){return new mt(this.T,t)}createSkin(t=""){return new Qe(this.T,t)}createMesh(t=""){return new Je(this.T,t)}createPrimitive(){return new ee(this.T)}createPrimitiveTarget(t=""){return new Hs(this.T,t)}createMaterial(t=""){return new yt(this.T,t)}createTexture(t=""){return new ts(this.T,t)}createAnimation(t=""){return new He(this.T,t)}createAnimationChannel(t=""){return new Ke(this.T,t)}createAnimationSampler(t=""){return new vt(this.T,t)}createAccessor(t="",e=null){return e||(e=this.getRoot().listBuffers()[0]),new C(this.T,t).setBuffer(e)}createBuffer(t=""){return new Xe(this.T,t)}}bt.v=new WeakMap;class Xs{constructor(t){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=t}setTextureInfo(t,e){this.textureInfos.set(t,e),e.texCoord!==void 0&&t.setTexCoord(e.texCoord),e.extras!==void 0&&t.setExtras(e.extras);const s=this.jsonDoc.json.textures[e.index];if(s.sampler===void 0)return;const r=this.jsonDoc.json.samplers[s.sampler];r.magFilter!==void 0&&t.setMagFilter(r.magFilter),r.minFilter!==void 0&&t.setMinFilter(r.minFilter),r.wrapS!==void 0&&t.setWrapS(r.wrapS),r.wrapT!==void 0&&t.setWrapT(r.wrapT)}}const es={logger:X.DEFAULT_INSTANCE,extensions:[],dependencies:{}};class Js{static read(t,e=es){const s=G({},es,e),{json:r}=t,i=new bt().setLogger(s.logger);this.validate(t,s);const n=new Xs(t),a=r.asset,h=i.getRoot().getAsset();a.copyright&&(h.copyright=a.copyright),a.extras&&(h.extras=a.extras),r.extras!==void 0&&i.getRoot().setExtras(G({},r.extras));const u=r.extensionsUsed||[],l=r.extensionsRequired||[];for(const c of s.extensions)if(u.includes(c.EXTENSION_NAME)){const p=i.createExtension(c).setRequired(l.includes(c.EXTENSION_NAME));for(const g of p.readDependencies)p.install(g,s.dependencies[g])}const d=r.buffers||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(N.BUFFER)).forEach(c=>c.preread(n,N.BUFFER)),n.buffers=d.map(c=>{const p=i.createBuffer(c.name);return c.extras&&p.setExtras(c.extras),c.uri&&c.uri.indexOf("__")!==0&&p.setURI(c.uri),p}),n.bufferViewBuffers=(r.bufferViews||[]).map((c,p)=>{if(!n.bufferViews[p]){const g=t.json.buffers[c.buffer];n.bufferViews[p]=F.toView(g.uri?t.resources[g.uri]:t.resources[qt],c.byteOffset||0,c.byteLength)}return n.buffers[c.buffer]});const y=r.accessors||[];n.accessors=y.map(c=>{const p=i.createAccessor(c.name,n.bufferViewBuffers[c.bufferView]).setType(c.type);return c.extras&&p.setExtras(c.extras),c.normalized!==void 0&&p.setNormalized(c.normalized),c.bufferView===void 0||p.setArray(se(c,n)),p});const m=r.images||[],_=r.textures||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(N.TEXTURE)).forEach(c=>c.preread(n,N.TEXTURE)),n.textures=m.map(c=>{const p=i.createTexture(c.name);if(c.extras&&p.setExtras(c.extras),c.bufferView!==void 0){const g=r.bufferViews[c.bufferView],x=t.json.buffers[g.buffer],E=g.byteOffset||0,T=(x.uri?t.resources[x.uri]:t.resources[qt]).slice(E,E+g.byteLength);p.setImage(T)}else c.uri!==void 0&&(p.setImage(t.resources[c.uri]),c.uri.indexOf("__")!==0&&p.setURI(c.uri));if(c.mimeType!==void 0)p.setMimeType(c.mimeType);else if(c.uri){const g=Tt.extension(c.uri);p.setMimeType(pt.extensionToMimeType(g))}return p}),n.materials=(r.materials||[]).map(c=>{const p=i.createMaterial(c.name);c.extras&&p.setExtras(c.extras),c.alphaMode!==void 0&&p.setAlphaMode(c.alphaMode),c.alphaCutoff!==void 0&&p.setAlphaCutoff(c.alphaCutoff),c.doubleSided!==void 0&&p.setDoubleSided(c.doubleSided);const g=c.pbrMetallicRoughness||{};if(g.baseColorFactor!==void 0&&p.setBaseColorFactor(g.baseColorFactor),c.emissiveFactor!==void 0&&p.setEmissiveFactor(c.emissiveFactor),g.metallicFactor!==void 0&&p.setMetallicFactor(g.metallicFactor),g.roughnessFactor!==void 0&&p.setRoughnessFactor(g.roughnessFactor),g.baseColorTexture!==void 0){const x=g.baseColorTexture;p.setBaseColorTexture(n.textures[_[x.index].source]),n.setTextureInfo(p.getBaseColorTextureInfo(),x)}if(c.emissiveTexture!==void 0){const x=c.emissiveTexture;p.setEmissiveTexture(n.textures[_[x.index].source]),n.setTextureInfo(p.getEmissiveTextureInfo(),x)}if(c.normalTexture!==void 0){const x=c.normalTexture;p.setNormalTexture(n.textures[_[x.index].source]),n.setTextureInfo(p.getNormalTextureInfo(),x),c.normalTexture.scale!==void 0&&p.setNormalScale(c.normalTexture.scale)}if(c.occlusionTexture!==void 0){const x=c.occlusionTexture;p.setOcclusionTexture(n.textures[_[x.index].source]),n.setTextureInfo(p.getOcclusionTextureInfo(),x),c.occlusionTexture.strength!==void 0&&p.setOcclusionStrength(c.occlusionTexture.strength)}if(g.metallicRoughnessTexture!==void 0){const x=g.metallicRoughnessTexture;p.setMetallicRoughnessTexture(n.textures[_[x.index].source]),n.setTextureInfo(p.getMetallicRoughnessTextureInfo(),x)}return p});const w=r.meshes||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(N.PRIMITIVE)).forEach(c=>c.preread(n,N.PRIMITIVE)),n.meshes=w.map(c=>{const p=i.createMesh(c.name);return c.extras&&p.setExtras(c.extras),c.weights!==void 0&&p.setWeights(c.weights),(c.primitives||[]).forEach(g=>{const x=i.createPrimitive();g.extras&&x.setExtras(g.extras),g.material!==void 0&&x.setMaterial(n.materials[g.material]),g.mode!==void 0&&x.setMode(g.mode);for(const[T,b]of Object.entries(g.attributes||{}))x.setAttribute(T,n.accessors[b]);g.indices!==void 0&&x.setIndices(n.accessors[g.indices]);const E=c.extras&&c.extras.targetNames||[];(g.targets||[]).forEach((T,b)=>{const R=E[b]||b.toString(),z=i.createPrimitiveTarget(R);for(const[A,v]of Object.entries(T))z.setAttribute(A,n.accessors[v]);x.addTarget(z)}),p.addPrimitive(x)}),p}),n.cameras=(r.cameras||[]).map(c=>{const p=i.createCamera(c.name).setType(c.type);if(c.extras&&p.setExtras(c.extras),c.type===mt.Type.PERSPECTIVE){const g=c.perspective;p.setYFov(g.yfov),p.setZNear(g.znear),g.zfar!==void 0&&p.setZFar(g.zfar),g.aspectRatio!==void 0&&p.setAspectRatio(g.aspectRatio)}else{const g=c.orthographic;p.setZNear(g.znear).setZFar(g.zfar).setXMag(g.xmag).setYMag(g.ymag)}return p});const f=r.nodes||[];i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(N.NODE)).forEach(c=>c.preread(n,N.NODE)),n.nodes=f.map(c=>{const p=i.createNode(c.name);if(c.extras&&p.setExtras(c.extras),c.translation!==void 0&&p.setTranslation(c.translation),c.rotation!==void 0&&p.setRotation(c.rotation),c.scale!==void 0&&p.setScale(c.scale),c.matrix!==void 0){const g=[0,0,0],x=[0,0,0,1],E=[1,1,1];P.decompose(c.matrix,g,x,E),p.setTranslation(g),p.setRotation(x),p.setScale(E)}return c.weights!==void 0&&p.setWeights(c.weights),p}),n.skins=(r.skins||[]).map(c=>{const p=i.createSkin(c.name);c.extras&&p.setExtras(c.extras),c.inverseBindMatrices!==void 0&&p.setInverseBindMatrices(n.accessors[c.inverseBindMatrices]),c.skeleton!==void 0&&p.setSkeleton(n.nodes[c.skeleton]);for(const g of c.joints)p.addJoint(n.nodes[g]);return p}),f.map((c,p)=>{const g=n.nodes[p];(c.children||[]).forEach(x=>g.addChild(n.nodes[x])),c.mesh!==void 0&&g.setMesh(n.meshes[c.mesh]),c.camera!==void 0&&g.setCamera(n.cameras[c.camera]),c.skin!==void 0&&g.setSkin(n.skins[c.skin])}),n.animations=(r.animations||[]).map(c=>{const p=i.createAnimation(c.name);c.extras&&p.setExtras(c.extras);const g=(c.samplers||[]).map(x=>{const E=i.createAnimationSampler().setInput(n.accessors[x.input]).setOutput(n.accessors[x.output]).setInterpolation(x.interpolation||vt.Interpolation.LINEAR);return x.extras&&E.setExtras(x.extras),p.addSampler(E),E});return(c.channels||[]).forEach(x=>{const E=i.createAnimationChannel().setSampler(g[x.sampler]).setTargetPath(x.target.path);x.target.node!==void 0&&E.setTargetNode(n.nodes[x.target.node]),x.extras&&E.setExtras(x.extras),p.addChannel(E)}),p});const M=r.scenes||[];return i.getRoot().listExtensionsUsed().filter(c=>c.prereadTypes.includes(N.SCENE)).forEach(c=>c.preread(n,N.SCENE)),n.scenes=M.map(c=>{const p=i.createScene(c.name);return c.extras&&p.setExtras(c.extras),(c.nodes||[]).map(g=>n.nodes[g]).forEach(g=>p.addChild(g)),p}),r.scene!==void 0&&i.getRoot().setDefaultScene(n.scenes[r.scene]),i.getRoot().listExtensionsUsed().forEach(c=>c.read(n)),y.forEach((c,p)=>{const g=n.accessors[p],x=!!c.sparse,E=!c.bufferView&&!g.getArray();(x||E)&&g.setSparse(!0).setArray(function(T,b){const R=Ht[T.componentType],z=C.getElementSize(T.type);let A;A=T.bufferView!==void 0?se(T,b):new R(T.count*z);const v=T.sparse;if(!v)return A;const S=v.count,I=G({},T,v.indices,{count:S,type:"SCALAR"}),O=G({},T,v.values,{count:S}),B=se(I,b),L=se(O,b);for(let q=0;q<I.count;q++)for(let D=0;D<z;D++)A[B[q]*z+D]=L[q*z+D];return A}(c,n))}),i}static validate(t,e){const s=t.json;if(s.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${s.asset.version}".`);if(s.extensionsRequired){for(const r of s.extensionsRequired)if(!e.extensions.find(i=>i.EXTENSION_NAME===r))throw new Error(`Missing required extension, "${r}".`)}if(s.extensionsUsed)for(const r of s.extensionsUsed)e.extensions.find(i=>i.EXTENSION_NAME===r)||e.logger.warn(`Missing optional extension, "${r}".`)}}function se(o,t){const e=t.bufferViews[o.bufferView],s=t.jsonDoc.json.bufferViews[o.bufferView],r=Ht[o.componentType],i=C.getElementSize(o.type),n=r.BYTES_PER_ELEMENT;if(s.byteStride!==void 0&&s.byteStride!==i*n)return function(h,u){const l=u.bufferViews[h.bufferView],d=u.jsonDoc.json.bufferViews[h.bufferView],y=Ht[h.componentType],m=C.getElementSize(h.type),_=y.BYTES_PER_ELEMENT,w=h.byteOffset||0,f=new y(h.count*m),M=new DataView(l.buffer,l.byteOffset,l.byteLength),c=d.byteStride;for(let p=0;p<h.count;p++)for(let g=0;g<m;g++){const x=w+p*c+g*_;let E;switch(h.componentType){case C.ComponentType.FLOAT:E=M.getFloat32(x,!0);break;case C.ComponentType.UNSIGNED_INT:E=M.getUint32(x,!0);break;case C.ComponentType.UNSIGNED_SHORT:E=M.getUint16(x,!0);break;case C.ComponentType.UNSIGNED_BYTE:E=M.getUint8(x);break;case C.ComponentType.SHORT:E=M.getInt16(x,!0);break;case C.ComponentType.BYTE:E=M.getInt8(x);break;default:throw new Error(`Unexpected componentType "${h.componentType}".`)}f[p*m+g]=E}return f}(o,t);const a=e.byteOffset+(o.byteOffset||0);return new r(e.buffer.slice(a,a+o.count*i*n))}var Ut;(function(o){o[o.ARRAY_BUFFER=34962]="ARRAY_BUFFER",o[o.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Ut||(Ut={}));class xt{constructor(t,e,s){this.C=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.F=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.C=t,this.jsonDoc=e,this.options=s;const r=t.getRoot(),i=r.listBuffers().length,n=r.listTextures().length;this.bufferURIGenerator=new ss(i>1,()=>s.basename||"buffer"),this.imageURIGenerator=new ss(n>1,a=>function(h,u){const l=h.getGraph().listParentEdges(u).find(d=>d.getParent()!==h.getRoot());return l?l.getName().replace(/texture$/i,""):""}(t,a)||s.basename||"texture"),this.logger=t.getLogger()}createTextureInfoDef(t,e){const s={magFilter:e.getMagFilter()||void 0,minFilter:e.getMinFilter()||void 0,wrapS:e.getWrapS(),wrapT:e.getWrapT()},r=JSON.stringify(s);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const i={source:this.imageIndexMap.get(t),sampler:this.samplerDefIndexMap.get(r)},n=JSON.stringify(i);this.textureDefIndexMap.has(n)||(this.textureDefIndexMap.set(n,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const a={index:this.textureDefIndexMap.get(n)};return e.getTexCoord()!==0&&(a.texCoord=e.getTexCoord()),Object.keys(e.getExtras()).length>0&&(a.extras=e.getExtras()),this.textureInfoDefMap.set(e,a),a}createPropertyDef(t){const e={};return t.getName()&&(e.name=t.getName()),Object.keys(t.getExtras()).length>0&&(e.extras=t.getExtras()),e}createAccessorDef(t){const e=this.createPropertyDef(t);return e.type=t.getType(),e.componentType=t.getComponentType(),e.count=t.getCount(),this.C.getGraph().listParentEdges(t).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(e.max=t.getMax([]).map(Math.fround),e.min=t.getMin([]).map(Math.fround)),t.getNormalized()&&(e.normalized=t.getNormalized()),e}createImageData(t,e,s){if(this.options.format===dt.GLB)this.imageBufferViews.push(e),t.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:e.byteLength});else{const r=pt.mimeTypeToExtension(s.getMimeType());t.uri=this.imageURIGenerator.createURI(s,r),this.jsonDoc.resources[t.uri]=e}}getAccessorUsage(t){const e=this.F.get(t);if(e)return e;if(t.getSparse())return Y.SPARSE;for(const s of this.C.getGraph().listParentEdges(t)){const{usage:r}=s.getAttributes();if(r)return r;s.getParent().propertyType!==N.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return Y.OTHER}addAccessorToUsageGroup(t,e){const s=this.F.get(t);if(s&&s!==e)throw new Error(`Accessor with usage "${s}" cannot be reused as "${e}".`);return this.F.set(t,e),this}listAccessorUsageGroups(){const t={};for(const[e,s]of Array.from(this.F.entries()))t[s]=t[s]||[],t[s].push(e);return t}}xt.BufferViewTarget=Ut,xt.BufferViewUsage=Y,xt.USAGE_TO_TARGET={[Y.ARRAY_BUFFER]:Ut.ARRAY_BUFFER,[Y.ELEMENT_ARRAY_BUFFER]:Ut.ELEMENT_ARRAY_BUFFER};class ss{constructor(t,e){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=t,this.basename=e}createURI(t,e){if(t.getURI())return t.getURI();if(this.multiple){const s=this.basename(t);return this.counter[s]=this.counter[s]||1,`${s}_${this.counter[s]++}.${e}`}return`${this.basename(t)}.${e}`}}const{BufferViewUsage:re}=xt,{UNSIGNED_INT:$s,UNSIGNED_SHORT:Zs,UNSIGNED_BYTE:Qs}=C.ComponentType;class tr{static write(t,e){const s=t.getRoot(),r={asset:G({generator:`glTF-Transform ${Ve}`},s.getAsset()),extras:G({},s.getExtras())},i={json:r,resources:{}},n=new xt(t,i,e),a=e.logger||X.DEFAULT_INSTANCE,h=new Set(e.extensions.map(f=>f.EXTENSION_NAME)),u=t.getRoot().listExtensionsUsed().filter(f=>h.has(f.extensionName)),l=t.getRoot().listExtensionsRequired().filter(f=>h.has(f.extensionName));u.length<t.getRoot().listExtensionsUsed().length&&a.warn("Some extensions were not registered for I/O, and will not be written.");for(const f of u)for(const M of f.writeDependencies)f.install(M,e.dependencies[M]);function d(f,M,c,p){const g=[];let x=0;for(const T of f){const b=n.createAccessorDef(T);b.bufferView=r.bufferViews.length;const R=T.getArray(),z=F.pad(F.toView(R));b.byteOffset=x,x+=z.byteLength,g.push(z),n.accessorIndexMap.set(T,r.accessors.length),r.accessors.push(b)}const E={buffer:M,byteOffset:c,byteLength:F.concat(g).byteLength};return p&&(E.target=p),r.bufferViews.push(E),{buffers:g,byteLength:x}}function y(f,M,c){const p=f[0].getCount();let g=0;for(const b of f){const R=n.createAccessorDef(b);R.bufferView=r.bufferViews.length,R.byteOffset=g;const z=b.getElementSize(),A=b.getComponentSize();g+=F.padNumber(z*A),n.accessorIndexMap.set(b,r.accessors.length),r.accessors.push(R)}const x=p*g,E=new ArrayBuffer(x),T=new DataView(E);for(let b=0;b<p;b++){let R=0;for(const z of f){const A=z.getElementSize(),v=z.getComponentSize(),S=z.getComponentType(),I=z.getArray();for(let O=0;O<A;O++){const B=b*g+R+O*v,L=I[b*A+O];switch(S){case C.ComponentType.FLOAT:T.setFloat32(B,L,!0);break;case C.ComponentType.BYTE:T.setInt8(B,L);break;case C.ComponentType.SHORT:T.setInt16(B,L,!0);break;case C.ComponentType.UNSIGNED_BYTE:T.setUint8(B,L);break;case C.ComponentType.UNSIGNED_SHORT:T.setUint16(B,L,!0);break;case C.ComponentType.UNSIGNED_INT:T.setUint32(B,L,!0);break;default:throw new Error("Unexpected component type: "+S)}}R+=F.padNumber(A*v)}}return r.bufferViews.push({buffer:M,byteOffset:c,byteLength:x,byteStride:g,target:xt.BufferViewTarget.ARRAY_BUFFER}),{byteLength:x,buffers:[new Uint8Array(E)]}}function m(f,M,c){const p=[];let g=0;const x=new Map;let E=-1/0;for(const S of f){const I=n.createAccessorDef(S);r.accessors.push(I),n.accessorIndexMap.set(S,r.accessors.length-1);const O=[],B=[],L=[],q=new Array(S.getElementSize()).fill(0);for(let J=0,ct=S.getCount();J<ct;J++)if(S.getElement(J,L),!P.eq(L,q,0)){E=Math.max(J,E),O.push(J);for(let ut=0;ut<L.length;ut++)B.push(L[ut])}const D=O.length,K={accessorDef:I,count:D};if(x.set(S,K),D===0)continue;if(D>S.getCount()/3){const J=(100*O.length/S.getCount()).toFixed(1);a.warn(`Sparse accessor with many non-zero elements (${J}%) may increase file size.`)}const Q=Ht[S.getComponentType()];K.indices=O,K.values=new Q(B)}if(!Number.isFinite(E))return{buffers:p,byteLength:g};const T=E<255?Uint8Array:E<65535?Uint16Array:Uint32Array,b=E<255?Qs:E<65535?Zs:$s,R={buffer:M,byteOffset:c+g,byteLength:0};for(const S of f){const I=x.get(S);if(I.count===0)continue;I.indicesByteOffset=R.byteLength;const O=F.pad(F.toView(new T(I.indices)));p.push(O),g+=O.byteLength,R.byteLength+=O.byteLength}r.bufferViews.push(R);const z=r.bufferViews.length-1,A={buffer:M,byteOffset:c+g,byteLength:0};for(const S of f){const I=x.get(S);if(I.count===0)continue;I.valuesByteOffset=A.byteLength;const O=F.pad(F.toView(I.values));p.push(O),g+=O.byteLength,A.byteLength+=O.byteLength}r.bufferViews.push(A);const v=r.bufferViews.length-1;for(const S of f){const I=x.get(S);I.count!==0&&(I.accessorDef.sparse={count:I.count,indices:{bufferView:z,byteOffset:I.indicesByteOffset,componentType:b},values:{bufferView:v,byteOffset:I.valuesByteOffset}})}return{buffers:p,byteLength:g}}const _=new Map;for(const f of t.getGraph().listEdges()){if(f.getParent()===s)continue;const M=f.getChild();if(M instanceof C){const c=_.get(M)||[];c.push(f),_.set(M,c)}}if(r.accessors=[],r.bufferViews=[],r.samplers=[],r.textures=[],r.images=s.listTextures().map((f,M)=>{const c=n.createPropertyDef(f);f.getMimeType()&&(c.mimeType=f.getMimeType());const p=f.getImage();return p&&n.createImageData(c,p,f),n.imageIndexMap.set(f,M),c}),u.filter(f=>f.prewriteTypes.includes(N.ACCESSOR)).forEach(f=>f.prewrite(n,N.ACCESSOR)),s.listAccessors().forEach(f=>{const M=n.accessorUsageGroupedByParent,c=n.accessorParents;if(n.accessorIndexMap.has(f))return;const p=_.get(f)||[],g=n.getAccessorUsage(f);if(n.addAccessorToUsageGroup(f,g),M.has(g)){const x=p[0].getParent(),E=c.get(x)||new Set;E.add(f),c.set(x,E)}}),u.filter(f=>f.prewriteTypes.includes(N.BUFFER)).forEach(f=>f.prewrite(n,N.BUFFER)),(s.listAccessors().length>0||s.listTextures().length>0||n.otherBufferViews.size>0)&&s.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");r.buffers=[],s.listBuffers().forEach((f,M)=>{const c=n.createPropertyDef(f),p=n.accessorUsageGroupedByParent,g=n.accessorParents,x=f.listParents().filter(A=>A instanceof C),E=new Set(x),T=[],b=r.buffers.length;let R=0;const z=n.listAccessorUsageGroups();for(const A in z)if(p.has(A))for(const v of Array.from(g.values())){const S=Array.from(v).filter(I=>E.has(I)).filter(I=>n.getAccessorUsage(I)===A);if(S.length)if(A!==re.ARRAY_BUFFER||e.vertexLayout===Yt.INTERLEAVED){const I=A===re.ARRAY_BUFFER?y(S,b,R):d(S,b,R);R+=I.byteLength,T.push(...I.buffers)}else for(const I of S){const O=y([I],b,R);R+=O.byteLength,T.push(...O.buffers)}}else{const v=z[A].filter(O=>E.has(O));if(!v.length)continue;const S=A===re.ELEMENT_ARRAY_BUFFER?xt.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,I=A===re.SPARSE?m(v,b,R):d(v,b,R,S);R+=I.byteLength,T.push(...I.buffers)}if(n.imageBufferViews.length&&M===0){for(let A=0;A<n.imageBufferViews.length;A++)if(r.bufferViews[r.images[A].bufferView].byteOffset=R,R+=n.imageBufferViews[A].byteLength,T.push(n.imageBufferViews[A]),R%8){const v=8-R%8;R+=v,T.push(new Uint8Array(v))}}if(n.otherBufferViews.has(f))for(const A of n.otherBufferViews.get(f))r.bufferViews.push({buffer:b,byteOffset:R,byteLength:A.byteLength}),n.otherBufferViewsIndexMap.set(A,r.bufferViews.length-1),R+=A.byteLength,T.push(A);if(R){let A;e.format===dt.GLB?A=qt:(A=n.bufferURIGenerator.createURI(f,"bin"),c.uri=A),c.byteLength=R,i.resources[A]=F.concat(T)}r.buffers.push(c),n.bufferIndexMap.set(f,M)}),s.listAccessors().find(f=>!f.getBuffer())&&a.warn("Skipped writing one or more Accessors: no Buffer assigned."),r.materials=s.listMaterials().map((f,M)=>{const c=n.createPropertyDef(f);if(f.getAlphaMode()!==yt.AlphaMode.OPAQUE&&(c.alphaMode=f.getAlphaMode()),f.getAlphaMode()===yt.AlphaMode.MASK&&(c.alphaCutoff=f.getAlphaCutoff()),f.getDoubleSided()&&(c.doubleSided=!0),c.pbrMetallicRoughness={},P.eq(f.getBaseColorFactor(),[1,1,1,1])||(c.pbrMetallicRoughness.baseColorFactor=f.getBaseColorFactor()),P.eq(f.getEmissiveFactor(),[0,0,0])||(c.emissiveFactor=f.getEmissiveFactor()),f.getRoughnessFactor()!==1&&(c.pbrMetallicRoughness.roughnessFactor=f.getRoughnessFactor()),f.getMetallicFactor()!==1&&(c.pbrMetallicRoughness.metallicFactor=f.getMetallicFactor()),f.getBaseColorTexture()){const p=f.getBaseColorTexture(),g=f.getBaseColorTextureInfo();c.pbrMetallicRoughness.baseColorTexture=n.createTextureInfoDef(p,g)}if(f.getEmissiveTexture()){const p=f.getEmissiveTexture(),g=f.getEmissiveTextureInfo();c.emissiveTexture=n.createTextureInfoDef(p,g)}if(f.getNormalTexture()){const p=f.getNormalTexture(),g=f.getNormalTextureInfo(),x=n.createTextureInfoDef(p,g);f.getNormalScale()!==1&&(x.scale=f.getNormalScale()),c.normalTexture=x}if(f.getOcclusionTexture()){const p=f.getOcclusionTexture(),g=f.getOcclusionTextureInfo(),x=n.createTextureInfoDef(p,g);f.getOcclusionStrength()!==1&&(x.strength=f.getOcclusionStrength()),c.occlusionTexture=x}if(f.getMetallicRoughnessTexture()){const p=f.getMetallicRoughnessTexture(),g=f.getMetallicRoughnessTextureInfo();c.pbrMetallicRoughness.metallicRoughnessTexture=n.createTextureInfoDef(p,g)}return n.materialIndexMap.set(f,M),c}),r.meshes=s.listMeshes().map((f,M)=>{const c=n.createPropertyDef(f);let p=null;return c.primitives=f.listPrimitives().map(g=>{const x={attributes:{}};x.mode=g.getMode();const E=g.getMaterial();E&&(x.material=n.materialIndexMap.get(E)),Object.keys(g.getExtras()).length&&(x.extras=g.getExtras());const T=g.getIndices();T&&(x.indices=n.accessorIndexMap.get(T));for(const b of g.listSemantics())x.attributes[b]=n.accessorIndexMap.get(g.getAttribute(b));for(const b of g.listTargets()){const R={};for(const z of b.listSemantics())R[z]=n.accessorIndexMap.get(b.getAttribute(z));x.targets=x.targets||[],x.targets.push(R)}return g.listTargets().length&&!p&&(p=g.listTargets().map(b=>b.getName())),x}),f.getWeights().length&&(c.weights=f.getWeights()),p&&(c.extras=c.extras||{},c.extras.targetNames=p),n.meshIndexMap.set(f,M),c}),r.cameras=s.listCameras().map((f,M)=>{const c=n.createPropertyDef(f);if(c.type=f.getType(),c.type===mt.Type.PERSPECTIVE){c.perspective={znear:f.getZNear(),zfar:f.getZFar(),yfov:f.getYFov()};const p=f.getAspectRatio();p!==null&&(c.perspective.aspectRatio=p)}else c.orthographic={znear:f.getZNear(),zfar:f.getZFar(),xmag:f.getXMag(),ymag:f.getYMag()};return n.cameraIndexMap.set(f,M),c}),r.nodes=s.listNodes().map((f,M)=>{const c=n.createPropertyDef(f);return P.eq(f.getTranslation(),[0,0,0])||(c.translation=f.getTranslation()),P.eq(f.getRotation(),[0,0,0,1])||(c.rotation=f.getRotation()),P.eq(f.getScale(),[1,1,1])||(c.scale=f.getScale()),f.getWeights().length&&(c.weights=f.getWeights()),n.nodeIndexMap.set(f,M),c}),r.skins=s.listSkins().map((f,M)=>{const c=n.createPropertyDef(f),p=f.getInverseBindMatrices();p&&(c.inverseBindMatrices=n.accessorIndexMap.get(p));const g=f.getSkeleton();return g&&(c.skeleton=n.nodeIndexMap.get(g)),c.joints=f.listJoints().map(x=>n.nodeIndexMap.get(x)),n.skinIndexMap.set(f,M),c}),s.listNodes().forEach((f,M)=>{const c=r.nodes[M],p=f.getMesh();p&&(c.mesh=n.meshIndexMap.get(p));const g=f.getCamera();g&&(c.camera=n.cameraIndexMap.get(g));const x=f.getSkin();x&&(c.skin=n.skinIndexMap.get(x)),f.listChildren().length>0&&(c.children=f.listChildren().map(E=>n.nodeIndexMap.get(E)))}),r.animations=s.listAnimations().map((f,M)=>{const c=n.createPropertyDef(f),p=new Map;return c.samplers=f.listSamplers().map((g,x)=>{const E=n.createPropertyDef(g);return E.input=n.accessorIndexMap.get(g.getInput()),E.output=n.accessorIndexMap.get(g.getOutput()),E.interpolation=g.getInterpolation(),p.set(g,x),E}),c.channels=f.listChannels().map(g=>{const x=n.createPropertyDef(g);return x.sampler=p.get(g.getSampler()),x.target={node:n.nodeIndexMap.get(g.getTargetNode()),path:g.getTargetPath()},x}),n.animationIndexMap.set(f,M),c}),r.scenes=s.listScenes().map((f,M)=>{const c=n.createPropertyDef(f);return c.nodes=f.listChildren().map(p=>n.nodeIndexMap.get(p)),n.sceneIndexMap.set(f,M),c});const w=s.getDefaultScene();return w&&(r.scene=s.listScenes().indexOf(w)),r.extensionsUsed=u.map(f=>f.extensionName),r.extensionsRequired=l.map(f=>f.extensionName),u.forEach(f=>f.write(n)),function(f){const M=[];for(const c in f){const p=f[c];(Array.isArray(p)&&p.length===0||p===null||p===""||p&&typeof p=="object"&&Object.keys(p).length===0)&&M.push(c)}for(const c of M)delete f[c]}(r),i}}var ie;(function(o){o[o.JSON=1313821514]="JSON",o[o.BIN=5130562]="BIN"})(ie||(ie={}));class er{constructor(){this.M=X.DEFAULT_INSTANCE,this.l=new Set,this.U={},this.P=Yt.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(t){return this.M=t,this}registerExtensions(t){for(const e of t)this.l.add(e),e.register();return this}registerDependencies(t){return Object.assign(this.U,t),this}setVertexLayout(t){return this.P=t,this}async read(t){return await this.readJSON(await this.readAsJSON(t))}async readAsJSON(t){const e=await this.readURI(t,"view");this.lastReadBytes=e.byteLength;const s=rs(e)?this.L(e):{json:JSON.parse(F.decodeText(e)),resources:{}};return await this.j(s,this.dirname(t)),this.D(s),s}async readJSON(t){return t=this._(t),this.D(t),Js.read(t,{extensions:Array.from(this.l),dependencies:this.U,logger:this.M})}async binaryToJSON(t){const e=this.L(F.assertView(t));this.D(e);const s=e.json;if(s.buffers&&s.buffers.some(r=>function(i,n){return n.uri!==void 0&&!(n.uri in i.resources)}(e,r)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(r=>function(i,n){return n.uri!==void 0&&!(n.uri in i.resources)&&n.bufferView===void 0}(e,r)))throw new Error("Cannot resolve external images with binaryToJSON().");return e}async readBinary(t){return this.readJSON(await this.binaryToJSON(F.assertView(t)))}async writeJSON(t,e={}){if(e.format===dt.GLB&&t.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return tr.write(t,{format:e.format||dt.GLTF,basename:e.basename||"",logger:this.M,vertexLayout:this.P,dependencies:G({},this.U),extensions:Array.from(this.l)})}async writeBinary(t){const{json:e,resources:s}=await this.writeJSON(t,{format:dt.GLB}),r=new Uint32Array([1179937895,2,12]),i=JSON.stringify(e),n=F.pad(F.encodeText(i),32),a=F.toView(new Uint32Array([n.byteLength,1313821514])),h=F.concat([a,n]);r[r.length-1]+=h.byteLength;const u=Object.values(s)[0];if(!u||!u.byteLength)return F.concat([F.toView(r),h]);const l=F.pad(u,0),d=F.toView(new Uint32Array([l.byteLength,5130562])),y=F.concat([d,l]);return r[r.length-1]+=y.byteLength,F.concat([F.toView(r),h,y])}async j(t,e){var s=this;const r=[...t.json.images||[],...t.json.buffers||[]].map(async function(i){const n=i.uri;if(!n||n.match(/data:/))return Promise.resolve();t.resources[n]=await s.readURI(s.resolve(e,n),"view"),s.lastReadBytes+=t.resources[n].byteLength});await Promise.all(r)}D(t){function e(s){if(s.uri){if(s.uri in t.resources)F.assertView(t.resources[s.uri]);else if(s.uri.match(/data:/)){const r=`__${Ws()}.${Tt.extension(s.uri)}`;t.resources[r]=F.createBufferFromDataURI(s.uri),s.uri=r}}}(t.json.images||[]).forEach(s=>{if(s.bufferView===void 0&&s.uri===void 0)throw new Error("Missing resource URI or buffer view.");e(s)}),(t.json.buffers||[]).forEach(e)}_(t){const{images:e,buffers:s}=t.json;return t={json:G({},t.json),resources:G({},t.resources)},e&&(t.json.images=e.map(r=>G({},r))),s&&(t.json.buffers=s.map(r=>G({},r))),t}L(t){if(!rs(t))throw new Error("Invalid glTF 2.0 binary.");const e=new Uint32Array(t.buffer,t.byteOffset+12,2);if(e[1]!==ie.JSON)throw new Error("Missing required GLB JSON chunk.");const s=e[0],r=F.decodeText(F.toView(t,20,s)),i=JSON.parse(r),n=20+s;if(t.byteLength<=n)return{json:i,resources:{}};const a=new Uint32Array(t.buffer,t.byteOffset+n,2);if(a[1]!==ie.BIN)throw new Error("Expected GLB BIN in second chunk.");const h=F.toView(t,n+8,a[0]);return{json:i,resources:{[qt]:h}}}}function rs(o){if(o.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const t=new Uint32Array(o.buffer,o.byteOffset,3);return t[0]===1179937895&&t[1]===2}class sr extends er{constructor(t=Ft.DEFAULT_INIT){super(),this.J=void 0,this.J=t}async readURI(t,e){const s=await fetch(t,this.J);switch(e){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(t,e){return Ft.resolve(t,e)}dirname(t){return Ft.dirname(t)}}async function rr(o){const t=new FileReader;return new Promise((e,s)=>{t.onloadend=r=>{var i;r.target?e((i=r.target)==null?void 0:i.result):e(null)},t.onerror=s,t.readAsArrayBuffer(o)})}async function ir(o,t,e){try{const s=await Fs(o,t,e);if(s.ok){const r=await s.blob(),i=await rr(r);if(i)return await new sr({credentials:"include"}).binaryToJSON(new Uint8Array(i))}}catch(s){console.log(s)}return null}function nr(o){return`META_${o}`}function or(o){var e,s;const t=(e=o==null?void 0:o.json)==null?void 0:e.scenes;return Array.isArray(t)&&t.length>0?(s=t[0].extras)==null?void 0:s.meta:null}function ar(){return crypto.randomUUID()}function hr(o,t,e){const s=t.byteOffset||0,r=e.byteOffset||0,i=s+r,n=e.componentType===5125?4:2,a=n*e.count;if(n===2){const h=new Uint16Array(o.slice(i,i+a).buffer),u=new Uint32Array(h.length);for(let l=0;l<h.length;l++)u[l]=h[l];return u}else return new Uint32Array(o.slice(i,i+a).buffer)}function cr(o,t,e){const s=t.byteOffset||0,r=e.byteOffset||0,i=s+r,a=4*(e.count*3);return new Float32Array(o.slice(i,i+a).buffer)}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const is="162",ns=300,os=1e3,ne=1001,as=1002,hs=1003,ur=1006,lr=1008,fr=1009,dr=1014,pr=1020,gr=1023,Re=1026,cs=1027,mr="",yr=515,oe=2e3,us=2001;class ls{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const r=this._listeners[t];if(r!==void 0){const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const s=this._listeners[t.type];if(s!==void 0){t.target=this;const r=s.slice(0);for(let i=0,n=r.length;i<n;i++)r[i].call(this,t);t.target=null}}}const j=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Ae(){const o=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(j[o&255]+j[o>>8&255]+j[o>>16&255]+j[o>>24&255]+"-"+j[t&255]+j[t>>8&255]+"-"+j[t>>16&15|64]+j[t>>24&255]+"-"+j[e&63|128]+j[e>>8&255]+"-"+j[e>>16&255]+j[e>>24&255]+j[s&255]+j[s>>8&255]+j[s>>16&255]+j[s>>24&255]).toLowerCase()}function rt(o,t,e){return Math.max(t,Math.min(e,o))}class Lt{constructor(t=0,e=0){Lt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,r=t.elements;return this.x=r[0]*e+r[3]*s+r[6],this.y=r[1]*e+r[4]*s+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(rt(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),r=Math.sin(e),i=this.x-t.x,n=this.y-t.y;return this.x=i*s-n*r+t.x,this.y=i*r+n*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Pt{constructor(t,e,s,r,i,n,a,h,u){Pt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,s,r,i,n,a,h,u)}set(t,e,s,r,i,n,a,h,u){const l=this.elements;return l[0]=t,l[1]=r,l[2]=a,l[3]=e,l[4]=i,l[5]=h,l[6]=s,l[7]=n,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,r=e.elements,i=this.elements,n=s[0],a=s[3],h=s[6],u=s[1],l=s[4],d=s[7],y=s[2],m=s[5],_=s[8],w=r[0],f=r[3],M=r[6],c=r[1],p=r[4],g=r[7],x=r[2],E=r[5],T=r[8];return i[0]=n*w+a*c+h*x,i[3]=n*f+a*p+h*E,i[6]=n*M+a*g+h*T,i[1]=u*w+l*c+d*x,i[4]=u*f+l*p+d*E,i[7]=u*M+l*g+d*T,i[2]=y*w+m*c+_*x,i[5]=y*f+m*p+_*E,i[8]=y*M+m*g+_*T,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],r=t[2],i=t[3],n=t[4],a=t[5],h=t[6],u=t[7],l=t[8];return e*n*l-e*a*u-s*i*l+s*a*h+r*i*u-r*n*h}invert(){const t=this.elements,e=t[0],s=t[1],r=t[2],i=t[3],n=t[4],a=t[5],h=t[6],u=t[7],l=t[8],d=l*n-a*u,y=a*h-l*i,m=u*i-n*h,_=e*d+s*y+r*m;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);const w=1/_;return t[0]=d*w,t[1]=(r*u-l*s)*w,t[2]=(a*s-r*n)*w,t[3]=y*w,t[4]=(l*e-r*h)*w,t[5]=(r*i-a*e)*w,t[6]=m*w,t[7]=(s*h-u*e)*w,t[8]=(n*e-s*i)*w,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,r,i,n,a){const h=Math.cos(i),u=Math.sin(i);return this.set(s*h,s*u,-s*(h*n+u*a)+n+t,-r*u,r*h,-r*(-u*n+h*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Se.makeScale(t,e)),this}rotate(t){return this.premultiply(Se.makeRotation(-t)),this}translate(t,e){return this.premultiply(Se.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let r=0;r<9;r++)if(e[r]!==s[r])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Se=new Pt;function fs(o){return document.createElementNS("http://www.w3.org/1999/xhtml",o)}function Ie(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}let Rt;class xr{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Rt===void 0&&(Rt=fs("canvas")),Rt.width=t.width,Rt.height=t.height;const s=Rt.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=Rt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=fs("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const r=s.getImageData(0,0,t.width,t.height),i=r.data;for(let n=0;n<i.length;n++)i[n]=Ie(i[n]/255)*255;return s.putImageData(r,0,0),e}else if(t.data){const e=t.data.slice(0);for(let s=0;s<e.length;s++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[s]=Math.floor(Ie(e[s]/255)*255):e[s]=Ie(e[s]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Er=0;class _r{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Er++}),this.uuid=Ae(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const s={uuid:this.uuid,url:""},r=this.data;if(r!==null){let i;if(Array.isArray(r)){i=[];for(let n=0,a=r.length;n<a;n++)r[n].isDataTexture?i.push(Ce(r[n].image)):i.push(Ce(r[n]))}else i=Ce(r);s.url=i}return e||(t.images[this.uuid]=s),s}}function Ce(o){return typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap?xr.getDataURL(o):o.data?{data:Array.from(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Mr=0;class at extends ls{constructor(t=at.DEFAULT_IMAGE,e=at.DEFAULT_MAPPING,s=ne,r=ne,i=ur,n=lr,a=gr,h=fr,u=at.DEFAULT_ANISOTROPY,l=mr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Mr++}),this.uuid=Ae(),this.name="",this.source=new _r(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=r,this.magFilter=i,this.minFilter=n,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=h,this.offset=new Lt(0,0),this.repeat=new Lt(1,1),this.center=new Lt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Pt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==ns)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case os:t.x=t.x-Math.floor(t.x);break;case ne:t.x=t.x<0?0:1;break;case as:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case os:t.y=t.y-Math.floor(t.y);break;case ne:t.y=t.y<0?0:1;break;case as:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}at.DEFAULT_IMAGE=null,at.DEFAULT_MAPPING=ns,at.DEFAULT_ANISOTROPY=1;class Bt{constructor(t=0,e=0,s=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=r}static slerpFlat(t,e,s,r,i,n,a){let h=s[r+0],u=s[r+1],l=s[r+2],d=s[r+3];const y=i[n+0],m=i[n+1],_=i[n+2],w=i[n+3];if(a===0){t[e+0]=h,t[e+1]=u,t[e+2]=l,t[e+3]=d;return}if(a===1){t[e+0]=y,t[e+1]=m,t[e+2]=_,t[e+3]=w;return}if(d!==w||h!==y||u!==m||l!==_){let f=1-a;const M=h*y+u*m+l*_+d*w,c=M>=0?1:-1,p=1-M*M;if(p>Number.EPSILON){const x=Math.sqrt(p),E=Math.atan2(x,M*c);f=Math.sin(f*E)/x,a=Math.sin(a*E)/x}const g=a*c;if(h=h*f+y*g,u=u*f+m*g,l=l*f+_*g,d=d*f+w*g,f===1-a){const x=1/Math.sqrt(h*h+u*u+l*l+d*d);h*=x,u*=x,l*=x,d*=x}}t[e]=h,t[e+1]=u,t[e+2]=l,t[e+3]=d}static multiplyQuaternionsFlat(t,e,s,r,i,n){const a=s[r],h=s[r+1],u=s[r+2],l=s[r+3],d=i[n],y=i[n+1],m=i[n+2],_=i[n+3];return t[e]=a*_+l*d+h*m-u*y,t[e+1]=h*_+l*y+u*d-a*m,t[e+2]=u*_+l*m+a*y-h*d,t[e+3]=l*_-a*d-h*y-u*m,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,r){return this._x=t,this._y=e,this._z=s,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,r=t._y,i=t._z,n=t._order,a=Math.cos,h=Math.sin,u=a(s/2),l=a(r/2),d=a(i/2),y=h(s/2),m=h(r/2),_=h(i/2);switch(n){case"XYZ":this._x=y*l*d+u*m*_,this._y=u*m*d-y*l*_,this._z=u*l*_+y*m*d,this._w=u*l*d-y*m*_;break;case"YXZ":this._x=y*l*d+u*m*_,this._y=u*m*d-y*l*_,this._z=u*l*_-y*m*d,this._w=u*l*d+y*m*_;break;case"ZXY":this._x=y*l*d-u*m*_,this._y=u*m*d+y*l*_,this._z=u*l*_+y*m*d,this._w=u*l*d-y*m*_;break;case"ZYX":this._x=y*l*d-u*m*_,this._y=u*m*d+y*l*_,this._z=u*l*_-y*m*d,this._w=u*l*d+y*m*_;break;case"YZX":this._x=y*l*d+u*m*_,this._y=u*m*d+y*l*_,this._z=u*l*_-y*m*d,this._w=u*l*d-y*m*_;break;case"XZY":this._x=y*l*d-u*m*_,this._y=u*m*d-y*l*_,this._z=u*l*_+y*m*d,this._w=u*l*d+y*m*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,r=Math.sin(s);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],r=e[4],i=e[8],n=e[1],a=e[5],h=e[9],u=e[2],l=e[6],d=e[10],y=s+a+d;if(y>0){const m=.5/Math.sqrt(y+1);this._w=.25/m,this._x=(l-h)*m,this._y=(i-u)*m,this._z=(n-r)*m}else if(s>a&&s>d){const m=2*Math.sqrt(1+s-a-d);this._w=(l-h)/m,this._x=.25*m,this._y=(r+n)/m,this._z=(i+u)/m}else if(a>d){const m=2*Math.sqrt(1+a-s-d);this._w=(i-u)/m,this._x=(r+n)/m,this._y=.25*m,this._z=(h+l)/m}else{const m=2*Math.sqrt(1+d-s-a);this._w=(n-r)/m,this._x=(i+u)/m,this._y=(h+l)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(rt(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(s===0)return this;const r=Math.min(1,e/s);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,r=t._y,i=t._z,n=t._w,a=e._x,h=e._y,u=e._z,l=e._w;return this._x=s*l+n*a+r*u-i*h,this._y=r*l+n*h+i*a-s*u,this._z=i*l+n*u+s*h-r*a,this._w=n*l-s*a-r*h-i*u,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const s=this._x,r=this._y,i=this._z,n=this._w;let a=n*t._w+s*t._x+r*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=n,this._x=s,this._y=r,this._z=i,this;const h=1-a*a;if(h<=Number.EPSILON){const m=1-e;return this._w=m*n+e*this._w,this._x=m*s+e*this._x,this._y=m*r+e*this._y,this._z=m*i+e*this._z,this.normalize(),this}const u=Math.sqrt(h),l=Math.atan2(u,a),d=Math.sin((1-e)*l)/u,y=Math.sin(e*l)/u;return this._w=n*d+this._w*y,this._x=s*d+this._x*y,this._y=r*d+this._y*y,this._z=i*d+this._z*y,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),r=Math.sqrt(1-s),i=Math.sqrt(s);return this.set(r*Math.sin(t),r*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class V{constructor(t=0,e=0,s=0){V.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return s===void 0&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(ds.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ds.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6]*r,this.y=i[1]*e+i[4]*s+i[7]*r,this.z=i[2]*e+i[5]*s+i[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,r=this.z,i=t.elements,n=1/(i[3]*e+i[7]*s+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*s+i[8]*r+i[12])*n,this.y=(i[1]*e+i[5]*s+i[9]*r+i[13])*n,this.z=(i[2]*e+i[6]*s+i[10]*r+i[14])*n,this}applyQuaternion(t){const e=this.x,s=this.y,r=this.z,i=t.x,n=t.y,a=t.z,h=t.w,u=2*(n*r-a*s),l=2*(a*e-i*r),d=2*(i*s-n*e);return this.x=e+h*u+n*d-a*l,this.y=s+h*l+a*u-i*d,this.z=r+h*d+i*l-n*u,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*s+i[8]*r,this.y=i[1]*e+i[5]*s+i[9]*r,this.z=i[2]*e+i[6]*s+i[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,r=t.y,i=t.z,n=e.x,a=e.y,h=e.z;return this.x=r*h-i*a,this.y=i*n-s*h,this.z=s*a-r*n,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return ze.copy(this).projectOnVector(t),this.sub(ze)}reflect(t){return this.sub(ze.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(rt(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,r=this.z-t.z;return e*e+s*s+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const r=Math.sin(e)*t;return this.x=r*Math.sin(s),this.y=Math.cos(e)*t,this.z=r*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ze=new V,ds=new Bt;class tt{constructor(t,e,s,r,i,n,a,h,u,l,d,y,m,_,w,f){tt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,s,r,i,n,a,h,u,l,d,y,m,_,w,f)}set(t,e,s,r,i,n,a,h,u,l,d,y,m,_,w,f){const M=this.elements;return M[0]=t,M[4]=e,M[8]=s,M[12]=r,M[1]=i,M[5]=n,M[9]=a,M[13]=h,M[2]=u,M[6]=l,M[10]=d,M[14]=y,M[3]=m,M[7]=_,M[11]=w,M[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new tt().fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,r=1/At.setFromMatrixColumn(t,0).length(),i=1/At.setFromMatrixColumn(t,1).length(),n=1/At.setFromMatrixColumn(t,2).length();return e[0]=s[0]*r,e[1]=s[1]*r,e[2]=s[2]*r,e[3]=0,e[4]=s[4]*i,e[5]=s[5]*i,e[6]=s[6]*i,e[7]=0,e[8]=s[8]*n,e[9]=s[9]*n,e[10]=s[10]*n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,r=t.y,i=t.z,n=Math.cos(s),a=Math.sin(s),h=Math.cos(r),u=Math.sin(r),l=Math.cos(i),d=Math.sin(i);if(t.order==="XYZ"){const y=n*l,m=n*d,_=a*l,w=a*d;e[0]=h*l,e[4]=-h*d,e[8]=u,e[1]=m+_*u,e[5]=y-w*u,e[9]=-a*h,e[2]=w-y*u,e[6]=_+m*u,e[10]=n*h}else if(t.order==="YXZ"){const y=h*l,m=h*d,_=u*l,w=u*d;e[0]=y+w*a,e[4]=_*a-m,e[8]=n*u,e[1]=n*d,e[5]=n*l,e[9]=-a,e[2]=m*a-_,e[6]=w+y*a,e[10]=n*h}else if(t.order==="ZXY"){const y=h*l,m=h*d,_=u*l,w=u*d;e[0]=y-w*a,e[4]=-n*d,e[8]=_+m*a,e[1]=m+_*a,e[5]=n*l,e[9]=w-y*a,e[2]=-n*u,e[6]=a,e[10]=n*h}else if(t.order==="ZYX"){const y=n*l,m=n*d,_=a*l,w=a*d;e[0]=h*l,e[4]=_*u-m,e[8]=y*u+w,e[1]=h*d,e[5]=w*u+y,e[9]=m*u-_,e[2]=-u,e[6]=a*h,e[10]=n*h}else if(t.order==="YZX"){const y=n*h,m=n*u,_=a*h,w=a*u;e[0]=h*l,e[4]=w-y*d,e[8]=_*d+m,e[1]=d,e[5]=n*l,e[9]=-a*l,e[2]=-u*l,e[6]=m*d+_,e[10]=y-w*d}else if(t.order==="XZY"){const y=n*h,m=n*u,_=a*h,w=a*u;e[0]=h*l,e[4]=-d,e[8]=u*l,e[1]=y*d+w,e[5]=n*l,e[9]=m*d-_,e[2]=_*d-m,e[6]=a*l,e[10]=w*d+y}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(wr,t,Tr)}lookAt(t,e,s){const r=this.elements;return H.subVectors(t,e),H.lengthSq()===0&&(H.z=1),H.normalize(),ht.crossVectors(s,H),ht.lengthSq()===0&&(Math.abs(s.z)===1?H.x+=1e-4:H.z+=1e-4,H.normalize(),ht.crossVectors(s,H)),ht.normalize(),ae.crossVectors(H,ht),r[0]=ht.x,r[4]=ae.x,r[8]=H.x,r[1]=ht.y,r[5]=ae.y,r[9]=H.y,r[2]=ht.z,r[6]=ae.z,r[10]=H.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,r=e.elements,i=this.elements,n=s[0],a=s[4],h=s[8],u=s[12],l=s[1],d=s[5],y=s[9],m=s[13],_=s[2],w=s[6],f=s[10],M=s[14],c=s[3],p=s[7],g=s[11],x=s[15],E=r[0],T=r[4],b=r[8],R=r[12],z=r[1],A=r[5],v=r[9],S=r[13],I=r[2],O=r[6],B=r[10],L=r[14],q=r[3],D=r[7],K=r[11],Q=r[15];return i[0]=n*E+a*z+h*I+u*q,i[4]=n*T+a*A+h*O+u*D,i[8]=n*b+a*v+h*B+u*K,i[12]=n*R+a*S+h*L+u*Q,i[1]=l*E+d*z+y*I+m*q,i[5]=l*T+d*A+y*O+m*D,i[9]=l*b+d*v+y*B+m*K,i[13]=l*R+d*S+y*L+m*Q,i[2]=_*E+w*z+f*I+M*q,i[6]=_*T+w*A+f*O+M*D,i[10]=_*b+w*v+f*B+M*K,i[14]=_*R+w*S+f*L+M*Q,i[3]=c*E+p*z+g*I+x*q,i[7]=c*T+p*A+g*O+x*D,i[11]=c*b+p*v+g*B+x*K,i[15]=c*R+p*S+g*L+x*Q,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],r=t[8],i=t[12],n=t[1],a=t[5],h=t[9],u=t[13],l=t[2],d=t[6],y=t[10],m=t[14],_=t[3],w=t[7],f=t[11],M=t[15];return _*(+i*h*d-r*u*d-i*a*y+s*u*y+r*a*m-s*h*m)+w*(+e*h*m-e*u*y+i*n*y-r*n*m+r*u*l-i*h*l)+f*(+e*u*d-e*a*m-i*n*d+s*n*m+i*a*l-s*u*l)+M*(-r*a*l-e*h*d+e*a*y+r*n*d-s*n*y+s*h*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],r=t[2],i=t[3],n=t[4],a=t[5],h=t[6],u=t[7],l=t[8],d=t[9],y=t[10],m=t[11],_=t[12],w=t[13],f=t[14],M=t[15],c=d*f*u-w*y*u+w*h*m-a*f*m-d*h*M+a*y*M,p=_*y*u-l*f*u-_*h*m+n*f*m+l*h*M-n*y*M,g=l*w*u-_*d*u+_*a*m-n*w*m-l*a*M+n*d*M,x=_*d*h-l*w*h-_*a*y+n*w*y+l*a*f-n*d*f,E=e*c+s*p+r*g+i*x;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/E;return t[0]=c*T,t[1]=(w*y*i-d*f*i-w*r*m+s*f*m+d*r*M-s*y*M)*T,t[2]=(a*f*i-w*h*i+w*r*u-s*f*u-a*r*M+s*h*M)*T,t[3]=(d*h*i-a*y*i-d*r*u+s*y*u+a*r*m-s*h*m)*T,t[4]=p*T,t[5]=(l*f*i-_*y*i+_*r*m-e*f*m-l*r*M+e*y*M)*T,t[6]=(_*h*i-n*f*i-_*r*u+e*f*u+n*r*M-e*h*M)*T,t[7]=(n*y*i-l*h*i+l*r*u-e*y*u-n*r*m+e*h*m)*T,t[8]=g*T,t[9]=(_*d*i-l*w*i-_*s*m+e*w*m+l*s*M-e*d*M)*T,t[10]=(n*w*i-_*a*i+_*s*u-e*w*u-n*s*M+e*a*M)*T,t[11]=(l*a*i-n*d*i-l*s*u+e*d*u+n*s*m-e*a*m)*T,t[12]=x*T,t[13]=(l*w*r-_*d*r+_*s*y-e*w*y-l*s*f+e*d*f)*T,t[14]=(_*a*r-n*w*r-_*s*h+e*w*h+n*s*f-e*a*f)*T,t[15]=(n*d*r-l*a*r+l*s*h-e*d*h-n*s*y+e*a*y)*T,this}scale(t){const e=this.elements,s=t.x,r=t.y,i=t.z;return e[0]*=s,e[4]*=r,e[8]*=i,e[1]*=s,e[5]*=r,e[9]*=i,e[2]*=s,e[6]*=r,e[10]*=i,e[3]*=s,e[7]*=r,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,r))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),r=Math.sin(e),i=1-s,n=t.x,a=t.y,h=t.z,u=i*n,l=i*a;return this.set(u*n+s,u*a-r*h,u*h+r*a,0,u*a+r*h,l*a+s,l*h-r*n,0,u*h-r*a,l*h+r*n,i*h*h+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,r,i,n){return this.set(1,s,i,0,t,1,n,0,e,r,1,0,0,0,0,1),this}compose(t,e,s){const r=this.elements,i=e._x,n=e._y,a=e._z,h=e._w,u=i+i,l=n+n,d=a+a,y=i*u,m=i*l,_=i*d,w=n*l,f=n*d,M=a*d,c=h*u,p=h*l,g=h*d,x=s.x,E=s.y,T=s.z;return r[0]=(1-(w+M))*x,r[1]=(m+g)*x,r[2]=(_-p)*x,r[3]=0,r[4]=(m-g)*E,r[5]=(1-(y+M))*E,r[6]=(f+c)*E,r[7]=0,r[8]=(_+p)*T,r[9]=(f-c)*T,r[10]=(1-(y+w))*T,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,s){const r=this.elements;let i=At.set(r[0],r[1],r[2]).length();const n=At.set(r[4],r[5],r[6]).length(),a=At.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],Z.copy(this);const u=1/i,l=1/n,d=1/a;return Z.elements[0]*=u,Z.elements[1]*=u,Z.elements[2]*=u,Z.elements[4]*=l,Z.elements[5]*=l,Z.elements[6]*=l,Z.elements[8]*=d,Z.elements[9]*=d,Z.elements[10]*=d,e.setFromRotationMatrix(Z),s.x=i,s.y=n,s.z=a,this}makePerspective(t,e,s,r,i,n,a=oe){const h=this.elements,u=2*i/(e-t),l=2*i/(s-r),d=(e+t)/(e-t),y=(s+r)/(s-r);let m,_;if(a===oe)m=-(n+i)/(n-i),_=-2*n*i/(n-i);else if(a===us)m=-n/(n-i),_=-n*i/(n-i);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return h[0]=u,h[4]=0,h[8]=d,h[12]=0,h[1]=0,h[5]=l,h[9]=y,h[13]=0,h[2]=0,h[6]=0,h[10]=m,h[14]=_,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,s,r,i,n,a=oe){const h=this.elements,u=1/(e-t),l=1/(s-r),d=1/(n-i),y=(e+t)*u,m=(s+r)*l;let _,w;if(a===oe)_=(n+i)*d,w=-2*d;else if(a===us)_=i*d,w=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return h[0]=2*u,h[4]=0,h[8]=0,h[12]=-y,h[1]=0,h[5]=2*l,h[9]=0,h[13]=-m,h[2]=0,h[6]=0,h[10]=w,h[14]=-_,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let r=0;r<16;r++)if(e[r]!==s[r])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const At=new V,Z=new tt,wr=new V(0,0,0),Tr=new V(1,1,1),ht=new V,ae=new V,H=new V,ps=new tt,gs=new Bt;class he{constructor(t=0,e=0,s=0,r=he.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,r=this._order){return this._x=t,this._y=e,this._z=s,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const r=t.elements,i=r[0],n=r[4],a=r[8],h=r[1],u=r[5],l=r[9],d=r[2],y=r[6],m=r[10];switch(e){case"XYZ":this._y=Math.asin(rt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,m),this._z=Math.atan2(-n,i)):(this._x=Math.atan2(y,u),this._z=0);break;case"YXZ":this._x=Math.asin(-rt(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-d,i),this._z=0);break;case"ZXY":this._x=Math.asin(rt(y,-1,1)),Math.abs(y)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-n,u)):(this._y=0,this._z=Math.atan2(h,i));break;case"ZYX":this._y=Math.asin(-rt(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(y,m),this._z=Math.atan2(h,i)):(this._x=0,this._z=Math.atan2(-n,u));break;case"YZX":this._z=Math.asin(rt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-d,i)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-rt(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(y,u),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-l,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return ps.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ps,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return gs.setFromEuler(this),this.setFromQuaternion(gs,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}he.DEFAULT_ORDER="XYZ";class br{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Rr=0;const ms=new V,St=new Bt,it=new tt,ce=new V,Dt=new V,Ar=new V,Sr=new Bt,ys=new V(1,0,0),xs=new V(0,1,0),Es=new V(0,0,1),Ir={type:"added"},Cr={type:"removed"},Ne={type:"childadded",child:null},Oe={type:"childremoved",child:null};class Et extends ls{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Rr++}),this.uuid=Ae(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Et.DEFAULT_UP.clone();const t=new V,e=new he,s=new Bt,r=new V(1,1,1);function i(){s.setFromEuler(e,!1)}function n(){e.setFromQuaternion(s,void 0,!1)}e._onChange(i),s._onChange(n),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new tt},normalMatrix:{value:new Pt}}),this.matrix=new tt,this.matrixWorld=new tt,this.matrixAutoUpdate=Et.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Et.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new br,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return St.setFromAxisAngle(t,e),this.quaternion.multiply(St),this}rotateOnWorldAxis(t,e){return St.setFromAxisAngle(t,e),this.quaternion.premultiply(St),this}rotateX(t){return this.rotateOnAxis(ys,t)}rotateY(t){return this.rotateOnAxis(xs,t)}rotateZ(t){return this.rotateOnAxis(Es,t)}translateOnAxis(t,e){return ms.copy(t).applyQuaternion(this.quaternion),this.position.add(ms.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(ys,t)}translateY(t){return this.translateOnAxis(xs,t)}translateZ(t){return this.translateOnAxis(Es,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(it.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?ce.copy(t):ce.set(t,e,s);const r=this.parent;this.updateWorldMatrix(!0,!1),Dt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?it.lookAt(Dt,ce,this.up):it.lookAt(ce,Dt,this.up),this.quaternion.setFromRotationMatrix(it),r&&(it.extractRotation(r.matrixWorld),St.setFromRotationMatrix(it),this.quaternion.premultiply(St.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Ir),Ne.child=t,this.dispatchEvent(Ne),Ne.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Cr),Oe.child=t,this.dispatchEvent(Oe),Oe.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),it.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),it.multiply(t.parent.matrixWorld)),t.applyMatrix4(it),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,r=this.children.length;s<r;s++){const n=this.children[s].getObjectByProperty(t,e);if(n!==void 0)return n}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const r=this.children;for(let i=0,n=r.length;i<n;i++)r[i].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Dt,t,Ar),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Dt,Sr,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,r=e.length;s<r;s++)e[s].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let s=0,r=e.length;s<r;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,r=e.length;s<r;s++){const i=e[s];(i.matrixWorldAutoUpdate===!0||t===!0)&&i.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const s=this.parent;if(t===!0&&s!==null&&s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const r=this.children;for(let i=0,n=r.length;i<n;i++){const a=r[i];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function i(a,h){return a[h.uuid]===void 0&&(a[h.uuid]=h.toJSON(t)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const h=a.shapes;if(Array.isArray(h))for(let u=0,l=h.length;u<l;u++){const d=h[u];i(t.shapes,d)}else i(t.shapes,h)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let h=0,u=this.material.length;h<u;h++)a.push(i(t.materials,this.material[h]));r.material=a}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const h=this.animations[a];r.animations.push(i(t.animations,h))}}if(e){const a=n(t.geometries),h=n(t.materials),u=n(t.textures),l=n(t.images),d=n(t.shapes),y=n(t.skeletons),m=n(t.animations),_=n(t.nodes);a.length>0&&(s.geometries=a),h.length>0&&(s.materials=h),u.length>0&&(s.textures=u),l.length>0&&(s.images=l),d.length>0&&(s.shapes=d),y.length>0&&(s.skeletons=y),m.length>0&&(s.animations=m),_.length>0&&(s.nodes=_)}return s.object=r,s;function n(a){const h=[];for(const u in a){const l=a[u];delete l.metadata,h.push(l)}return h}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let s=0;s<t.children.length;s++){const r=t.children[s];this.add(r.clone())}return this}}Et.DEFAULT_UP=new V(0,1,0),Et.DEFAULT_MATRIX_AUTO_UPDATE=!0,Et.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class zr extends at{constructor(t,e,s,r,i,n,a,h,u,l){if(l=l!==void 0?l:Re,l!==Re&&l!==cs)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&l===Re&&(s=dr),s===void 0&&l===cs&&(s=pr),super(null,r,i,n,a,h,l,s,u),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:hs,this.minFilter=h!==void 0?h:hs,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const Nr=new zr(1,1);Nr.compareFunction=yr,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:is}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=is);function Or(o,t){const e=new Set,s=new tt().makeRotationX(Math.PI/2).toArray();for(let r=0;r<o.length;r++){const i=o[r]*3;if(e.has(i))continue;const n=t[i],a=t[i+1],h=t[i+2],u=1/(s[3]*n+s[7]*a+s[11]*h+s[15]),l=(s[0]*n+s[4]*a+s[8]*h+s[12])/u,d=(s[1]*n+s[5]*a+s[9]*h+s[13])/u,y=(s[2]*n+s[6]*a+s[10]*h+s[14])/u;t[i]=l,t[i+1]=d,t[i+2]=y,e.add(i)}}function Fr(o,t,e){const s=[];function r(n){var h,u,l,d,y,m;let a=n.json.scene||0;return(h=n.json.scenes)!=null&&h.length&&n.json.scenes[0]&&((u=n.json.scenes[0].nodes)!=null&&u.length)&&n.json.scenes[0].nodes[0]&&(a=n.json.scenes[0].nodes[0]),(d=(l=n==null?void 0:n.json)==null?void 0:l.nodes)!=null&&d.length&&((y=n==null?void 0:n.json)!=null&&y.nodes[a])?(m=n==null?void 0:n.json)==null?void 0:m.nodes[a]:(console.error("no main node found"),{})}const i=r(o);return Array.isArray(i.children)&&i.children.forEach(n=>{var b,R,z,A,v;const a=o.json.nodes&&o.json.nodes[n];if(!a||a.mesh===void 0)return;const h=o.json.meshes&&o.json.meshes[a.mesh];if(!h)return;const u=((b=a.name)==null?void 0:b.replace("node",""))||"";if(u==="")return;const l=parseInt(u);l===void 0&&console.warn("unexpected reult for nodename");const d=h.primitives[0].material;if(l!==d&&console.warn("test",l,d),d===void 0)return;const y=h.primitives[0].indices;if(y===void 0)return;const m=h.primitives[0].attributes.POSITION,_=o.json.accessors&&o.json.accessors[y];if(_===void 0||_.bufferView===void 0)return;const w=o.json.accessors&&o.json.accessors[m];if(w===void 0||w.bufferView===void 0)return;const f=o.json.bufferViews&&o.json.bufferViews[_.bufferView];if(!f)return;const M=o.json.bufferViews&&o.json.bufferViews[w.bufferView];if(!M)return;const p=((A=(((R=o==null?void 0:o.json)==null?void 0:R.materials)&&((z=o==null?void 0:o.json)==null?void 0:z.materials[d])||{}).pbrMetallicRoughness)==null?void 0:A.baseColorFactor)||[0,0,0,0],g=o.resources["@glb.bin"],x=hr(g,f,_),E=cr(g,M,w);if(!x.length){console.log("missing index",t,e,n);return}if(!E.length){console.log("missing position",t,e,n);return}Or(x,E);const T=((v=o.json.scenes)==null?void 0:v.length)&&o.json.scenes[0].extras&&o.json.scenes[0].extras[`id_sequence${l}`];if(!T){console.log("missing id sequence",t,e,`id_sequence${l}`,n);return}s.push({position:E,index:x,color:p,id_sequence:T,indexdbKey:ar()})}),s}function vr(o){const t={x:null,y:null,z:null},e={x:null,y:null,z:null};let s=0;for(;s<o.length;)for(let r=0;r<3;r++,s++){const i=o[s]||0;r===0&&(t.x===null&&(t.x=i),e.x===null&&(e.x=i),t.x<i&&(t.x=i),e.x>i&&(e.x=i)),r===1&&(t.y===null&&(t.y=i),e.y===null&&(e.y=i),t.y<i&&(t.y=i),e.y>i&&(e.y=i)),r===2&&(t.z===null&&(t.z=i),e.z===null&&(e.z=i),t.z<i&&(t.z=i),e.z>i&&(e.z=i))}return{X:t.x||0,Y:t.y||0,Z:t.z||0,x:e.x||0,y:e.y||0,z:e.z||0}}function Ur(o,t,e,s,r){Object.keys(r).forEach(n=>{const a=[],[h,u]=r[n];for(let l=h;l<u+1;l++){const d=e[l]*3;a.push(s[d]),a.push(s[d+1]),a.push(s[d+2])}o.add(n),t[n]=vr(a)})}function Lr(o,t){let e=!0;for(;e&&o;){const s=new Set;Object.keys(o).forEach(i=>{const n=o[i];s.add(n[1])});let r=0;Object.keys(o).forEach(i=>{!s.has(i)&&!t.has(i)&&(r++,delete o[i])}),r===0&&(e=!1)}}async function Pr(o,t,e,s,r=null){try{const i=new ke(o),n=[],a=[],h=new Set,u={},l=`${e}_ALL_KEYS`;i.getKey(l).then(x=>{Array.isArray(x)&&x.forEach(E=>{i.deleteKey(E)})});const d=or(s);if(!d)return console.log("Missing expected glb meta",t,e),null;const y=Fr(s,t,e),m={};for(let x=0;x<y.length;x++){const E=y[x];Ur(h,u,E.index,E.position,E.id_sequence);const T=E.index,b=i.getUUID();await i.setKey(b,T.buffer),E.index=b,a.push(b);const R=E.position,z=i.getUUID();await i.setKey(z,R.buffer),E.position=z,a.push(z),E.id_sequence,n.push(E.indexdbKey),a.push(E.indexdbKey),m[b]={indexdb_key:E.indexdbKey,index:b,color:E.color,position:z,id_sequence:structuredClone(E.id_sequence)},E.id_sequence=null,await i.setKey(E.indexdbKey,E)}Lr(d,h);const _=Object.keys(d),w=[],f=new Map;let M=0;r?(f.set("*",1),M++):f.set("*",0),_.forEach(x=>{const E=u[x],T=d[x];let b,R;const z=T[0],A=T[1];f.has(x)?b=f.get(x):(M++,b=M,f.set(x,M)),f.has(A)?R=f.get(A):(M++,R=M,f.set(A,M)),w.push([b,z,R,E==null?void 0:E.x,E==null?void 0:E.y,E==null?void 0:E.z,E==null?void 0:E.X,E==null?void 0:E.Y,E==null?void 0:E.Z])}),r&&w.unshift([1,r,0,void 0,void 0,void 0,void 0,void 0,void 0]);const c={group_name:e,meshes:m,group_ref:w};Object.keys(c.meshes).forEach(x=>{const E=c.meshes[x];Object.keys(E.id_sequence).forEach(b=>{let R;f.has(b)?R=f.get(b):(M++,R=M,f.set(b,M)),E.id_sequence[R]=E.id_sequence[b],delete E.id_sequence[b]})});const g=new TextEncoder().encode(JSON.stringify(c));return await i.setKey(nr(e),g),await i.setKey(e,n),await i.setKey(l,a),await i.close(),e}catch(i){return console.error("error",e,i),null}}class Br{async downloadFromAzure(t,e,s,r,i){const n=await ir(t,s,i);return n?Pr(e,s,r,n):(console.log("Missing expected glbDoc",s,i),null)}}de(Br)})();
