var Zs=Object.defineProperty;var Qs=(se,Z,de)=>Z in se?Zs(se,Z,{enumerable:!0,configurable:!0,writable:!0,value:de}):se[Z]=de;var _e=(se,Z,de)=>Qs(se,typeof Z!="symbol"?Z+"":Z,de);(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const se=Symbol("Comlink.proxy"),Z=Symbol("Comlink.endpoint"),de=Symbol("Comlink.releaseProxy"),Qe=Symbol("Comlink.finalizer"),Ce=Symbol("Comlink.thrown"),gt=o=>typeof o=="object"&&o!==null||typeof o=="function",Ht={canHandle:o=>gt(o)&&o[se],serialize(o){const{port1:e,port2:t}=new MessageChannel;return et(o,e),[t,[t]]},deserialize(o){return o.start(),Qt(o)}},$t={canHandle:o=>gt(o)&&Ce in o,serialize({value:o}){let e;return o instanceof Error?e={isError:!0,value:{message:o.message,name:o.name,stack:o.stack}}:e={isError:!1,value:o},[e,[]]},deserialize(o){throw o.isError?Object.assign(new Error(o.value.message),o.value):o.value}},pt=new Map([["proxy",Ht],["throw",$t]]);function Xt(o,e){for(const t of o)if(e===t||t==="*"||t instanceof RegExp&&t.test(e))return!0;return!1}function et(o,e=globalThis,t=["*"]){e.addEventListener("message",function s(r){if(!r||!r.data)return;if(!Xt(t,r.origin)){console.warn(`Invalid origin '${r.origin}' for comlink proxy`);return}const{id:n,type:i,path:a}=Object.assign({path:[]},r.data),c=(r.data.argumentList||[]).map(oe);let u;try{const f=a.slice(0,-1).reduce((x,y)=>x[y],o),d=a.reduce((x,y)=>x[y],o);switch(i){case"GET":u=d;break;case"SET":f[a.slice(-1)[0]]=oe(r.data.value),u=!0;break;case"APPLY":u=d.apply(f,c);break;case"CONSTRUCT":{const x=new d(...c);u=ns(x)}break;case"ENDPOINT":{const{port1:x,port2:y}=new MessageChannel;et(o,y),u=rs(x,[x])}break;case"RELEASE":u=void 0;break;default:return}}catch(f){u={value:f,[Ce]:0}}Promise.resolve(u).catch(f=>({value:f,[Ce]:0})).then(f=>{const[d,x]=Oe(f);e.postMessage(Object.assign(Object.assign({},d),{id:n}),x),i==="RELEASE"&&(e.removeEventListener("message",s),mt(e),Qe in o&&typeof o[Qe]=="function"&&o[Qe]())}).catch(f=>{const[d,x]=Oe({value:new TypeError("Unserializable return value"),[Ce]:0});e.postMessage(Object.assign(Object.assign({},d),{id:n}),x)})}),e.start&&e.start()}function Zt(o){return o.constructor.name==="MessagePort"}function mt(o){Zt(o)&&o.close()}function Qt(o,e){return tt(o,[],e)}function ze(o){if(o)throw new Error("Proxy has been released and is not useable")}function yt(o){return ge(o,{type:"RELEASE"}).then(()=>{mt(o)})}const Ne=new WeakMap,ve="FinalizationRegistry"in globalThis&&new FinalizationRegistry(o=>{const e=(Ne.get(o)||0)-1;Ne.set(o,e),e===0&&yt(o)});function es(o,e){const t=(Ne.get(e)||0)+1;Ne.set(e,t),ve&&ve.register(o,e,o)}function ts(o){ve&&ve.unregister(o)}function tt(o,e=[],t=function(){}){let s=!1;const r=new Proxy(t,{get(n,i){if(ze(s),i===de)return()=>{ts(r),yt(o),s=!0};if(i==="then"){if(e.length===0)return{then:()=>r};const a=ge(o,{type:"GET",path:e.map(c=>c.toString())}).then(oe);return a.then.bind(a)}return tt(o,[...e,i])},set(n,i,a){ze(s);const[c,u]=Oe(a);return ge(o,{type:"SET",path:[...e,i].map(f=>f.toString()),value:c},u).then(oe)},apply(n,i,a){ze(s);const c=e[e.length-1];if(c===Z)return ge(o,{type:"ENDPOINT"}).then(oe);if(c==="bind")return tt(o,e.slice(0,-1));const[u,f]=xt(a);return ge(o,{type:"APPLY",path:e.map(d=>d.toString()),argumentList:u},f).then(oe)},construct(n,i){ze(s);const[a,c]=xt(i);return ge(o,{type:"CONSTRUCT",path:e.map(u=>u.toString()),argumentList:a},c).then(oe)}});return es(r,o),r}function ss(o){return Array.prototype.concat.apply([],o)}function xt(o){const e=o.map(Oe);return[e.map(t=>t[0]),ss(e.map(t=>t[1]))]}const Et=new WeakMap;function rs(o,e){return Et.set(o,e),o}function ns(o){return Object.assign(o,{[se]:!0})}function Oe(o){for(const[e,t]of pt)if(t.canHandle(o)){const[s,r]=t.serialize(o);return[{type:"HANDLER",name:e,value:s},r]}return[{type:"RAW",value:o},Et.get(o)||[]]}function oe(o){switch(o.type){case"HANDLER":return pt.get(o.name).deserialize(o.value);case"RAW":return o.value}}function ge(o,e,t){return new Promise(s=>{const r=is();o.addEventListener("message",function n(i){!i.data||!i.data.id||i.data.id!==r||(o.removeEventListener("message",n),s(i.data))}),o.start&&o.start(),o.postMessage(Object.assign({id:r},e),t)})}function is(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class Fe{constructor(e,t=1,s="DATA"){_e(this,"__name");_e(this,"__version");_e(this,"__storeName");_e(this,"__logEnabled");_e(this,"__db");this.__name=e,this.__version=t,this.__storeName=s,this.__logEnabled=!1}enableLog(){this.__logEnabled=!0}__logStart(e){this.__logEnabled&&console.time(`ModelStoreLog_${this.__name}_${this.__storeName}_${e}`)}__logEnd(e){this.__logEnabled&&console.timeEnd(`ModelStoreLog_${this.__name}_${this.__storeName}_${e}`)}close(){return new Promise(e=>{this.__db&&(this.__db.close(),e(!0))})}__open(){return new Promise((e,t)=>{if(this.__db)e(this.__db);else{const s=indexedDB.open(this.__name,this.__version);s.onupgradeneeded=()=>{const r=s.result;r.objectStoreNames.contains(this.__name)||r.createObjectStore(this.__storeName)},s.onblocked=r=>{this.__logEnd("getKey"),t({type:"onblocked",event:r})},s.onerror=r=>{this.__logEnd("getKey"),t({type:"onblocked",event:r})},s.onsuccess=()=>{this.__db=s.result,e(s.result)}}})}getUUID(){return crypto.randomUUID()}getJsonKey(e){return new Promise(async(t,s)=>{this.__logStart("getKey");try{const n=(await this.__open()).transaction(this.__storeName);n.onerror=c=>{this.__logEnd("getKey"),s({type:"store tx error",event:c})};const a=n.objectStore(this.__storeName).get(e);a.onsuccess=()=>{this.__logEnd("getKey"),t(a.result)}}catch(r){this.__logEnd("getKey"),s(r)}})}getBufferKey(e){return new Promise(async(t,s)=>{this.__logStart("getKey");try{const n=(await this.__open()).transaction(this.__storeName);n.onerror=c=>{this.__logEnd("getKey"),s({type:"store tx error",event:c})};const a=n.objectStore(this.__storeName).get(e);a.onsuccess=()=>{this.__logEnd("getKey"),t(a.result)}}catch(r){this.__logEnd("getKey"),s(r)}})}setJsonKey(e,t){return new Promise(async(s,r)=>{var n;this.__logStart("setKey");try{const a=(await this.__open()).transaction(this.__storeName,"readwrite");a.onerror=f=>{this.__logEnd("setKey"),r({type:"store tx error",event:f})};const u=a.objectStore(this.__storeName).put(t,e);u.onsuccess=()=>{this.__logEnd("setKey"),s(u.result)},(n=u.transaction)==null||n.commit()}catch(i){this.__logEnd("setKey"),r(i)}})}setBufferKey(e,t){return new Promise(async(s,r)=>{var n;this.__logStart("setKey");try{const a=(await this.__open()).transaction(this.__storeName,"readwrite");a.onerror=f=>{this.__logEnd("setKey"),r({type:"store tx error",event:f})};const u=a.objectStore(this.__storeName).put(t,e);u.onsuccess=()=>{this.__logEnd("setKey"),s(u.result)},(n=u.transaction)==null||n.commit()}catch(i){this.__logEnd("setKey"),r(i)}})}deleteKey(e){return new Promise(async(t,s)=>{this.__logStart("deleteKey");try{const n=(await this.__open()).transaction(this.__storeName,"readwrite");n.onerror=c=>{this.__logEnd("deleteKey"),s({type:"store tx error",event:c})};const a=n.objectStore(this.__storeName).delete(e);a.onsuccess=()=>{this.__logEnd("deleteKey"),t(a.result)}}catch(r){this.__logEnd("deleteKey"),s(r)}})}deleteDB(){return new Promise((e,t)=>{this.__logStart("deleteDB");const s=indexedDB.deleteDatabase(this.__name);s.onsuccess=()=>{this.__logEnd("deleteDB"),e(!0)},s.onerror=r=>{this.__logEnd("deleteDB"),t({type:"onblocked",event:r})}})}}const st="APP_CONFIG";async function os(o=!1){const e=new Fe(st);if(o){window||console.error("update storage can only be used on main tread"),window.__APP_DEV_ENV&&(window.__APP_ENV=window.__APP_DEV_ENV);const t=window.__APP_ENV||{};return await e.setJsonKey(st,t),t}return await e.getJsonKey(st)}async function as(o,e,t,s=!1){const r=await os();return await fetch(`${r.ENV__AZURE_STORAGE_URL}/${e}/${t}?${o}`,{headers:{"cache-control":"no-cache"},method:s?"HEAD":"GET"})}class rt{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t),this}removeEventListener(e,t){if(this._listeners===void 0)return this;const r=this._listeners[e];if(r!==void 0){const n=r.indexOf(t);n!==-1&&r.splice(n,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const s=this._listeners[e.type];if(s!==void 0){const r=s.slice(0);for(let n=0,i=r.length;n<i;n++)r[n].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class pe extends rt{constructor(e,t,s,r={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=s,this._attributes=r,!t.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class hs extends rt{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(t=>t.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(t=>t.getChild())}disconnectParents(e,t){let s=this.listParentEdges(e);return t&&(s=s.filter(r=>t(r.getParent()))),s.forEach(r=>r.dispose()),this}createEdge(e,t,s,r){return this._registerEdge(new pe(e,t,s,r))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const s=e.getChild();return this._childEdges.has(s)||this._childEdges.set(s,new Set),this._childEdges.get(s).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function Te(){return Te=Object.assign||function(o){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(o[s]=t[s])}return o},Te.apply(this,arguments)}function nt(o){return o instanceof pe}function Me(o){return Array.isArray(o)&&o[0]instanceof pe}function be(o){return!!(us(o)&&cs(o)instanceof pe)}function cs(o){for(const e in o)return o[e]}function us(o){return!!o&&Object.getPrototypeOf(o)===Object.prototype}const U=Symbol("attributes"),me=Symbol("immutableKeys");class it extends rt{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[U]=void 0,this[me]=void 0,this.graph=e,this[me]=new Set,this[U]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const s in e){const r=e[s];if(r instanceof it){const n=this.graph.createEdge(s,this,r);n.addEventListener("dispose",()=>r.dispose()),this[me].add(s),t[s]=n}else t[s]=r}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const s in this[U]){const r=this[U][s];if(nt(r)){const n=r;n.getChild()===e&&this.setRef(s,t,n.getAttributes())}else if(Me(r)){const i=r.find(a=>a.getChild()===e);if(i){const a=i.getAttributes();this.removeRef(s,e).addRef(s,t,a)}}else if(be(r)){const n=r;for(const i in n){const a=n[i];a.getChild()===e&&this.setRefMap(s,i,t,a.getAttributes())}}}return this}get(e){return this[U][e]}set(e,t){return this[U][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[U][e];return t?t.getChild():null}setRef(e,t,s){if(this[me].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const r=this[U][e];if(r&&r.dispose(),!t)return this;const n=this.graph.createEdge(e,this,t,s);return n.addEventListener("dispose",()=>{delete this[U][e],this.dispatchEvent({type:"change",attribute:e})}),this[U][e]=n,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[U][e].map(s=>s.getChild())}addRef(e,t,s){const r=this.graph.createEdge(e,this,t,s),n=this[U][e];return n.push(r),r.addEventListener("dispose",()=>{let i;for(;(i=n.indexOf(r))!==-1;)n.splice(i,1);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[U][e].filter(n=>n.getChild()===t).forEach(n=>n.dispose()),this}listRefMapKeys(e){return Object.keys(this[U][e])}listRefMapValues(e){return Object.values(this[U][e]).map(t=>t.getChild())}getRefMap(e,t){const s=this[U][e];return s[t]?s[t].getChild():null}setRefMap(e,t,s,r){const n=this[U][e],i=n[t];if(i&&i.dispose(),!s)return this;r=Object.assign(r||{},{key:t});const a=this.graph.createEdge(e,this,s,Te({},r,{key:t}));return a.addEventListener("dispose",()=>{delete n[t],this.dispatchEvent({type:"change",attribute:e,key:t})}),n[t]=a,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(Te({},e,{target:this})),this.graph.dispatchEvent(Te({},e,{target:this,type:`node:${e.type}`})),this}}const wt="v3.10.1",Ue="@glb.bin";var O,Pe,K,ot,ae;(function(o){o.ACCESSOR="Accessor",o.ANIMATION="Animation",o.ANIMATION_CHANNEL="AnimationChannel",o.ANIMATION_SAMPLER="AnimationSampler",o.BUFFER="Buffer",o.CAMERA="Camera",o.MATERIAL="Material",o.MESH="Mesh",o.PRIMITIVE="Primitive",o.PRIMITIVE_TARGET="PrimitiveTarget",o.NODE="Node",o.ROOT="Root",o.SCENE="Scene",o.SKIN="Skin",o.TEXTURE="Texture",o.TEXTURE_INFO="TextureInfo"})(O||(O={})),function(o){o.INTERLEAVED="interleaved",o.SEPARATE="separate"}(Pe||(Pe={})),function(o){o.ARRAY_BUFFER="ARRAY_BUFFER",o.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",o.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",o.OTHER="OTHER",o.SPARSE="SPARSE"}(K||(K={})),function(o){o[o.R=4096]="R",o[o.G=256]="G",o[o.B=16]="B",o[o.A=1]="A"}(ot||(ot={})),function(o){o.GLTF="GLTF",o.GLB="GLB"}(ae||(ae={}));const Be={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var Le,at=typeof Float32Array<"u"?Float32Array:Array;function ht(o){return Math.hypot(o[0],o[1],o[2])}Math.hypot||(Math.hypot=function(){for(var o=0,e=arguments.length;e--;)o+=arguments[e]*arguments[e];return Math.sqrt(o)}),Le=new at(3),at!=Float32Array&&(Le[0]=0,Le[1]=0,Le[2]=0);class F{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s}{const t=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(t,s?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const n of e)t+=n.byteLength;const s=new Uint8Array(t);let r=0;for(const n of e)s.set(n,r),r+=n.byteLength;return s}static pad(e,t=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const r=new Uint8Array(s);if(r.set(e),t!==0)for(let n=e.byteLength;n<s;n++)r[n]=t;return r}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==t[s])return!1;return!0}static toView(e,t=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Ve{static hexToFactor(e,t){e=Math.floor(e);const s=t;return s[0]=(e>>16&255)/255,s[1]=(e>>8&255)/255,s[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[s,r,n]=this.convertLinearToSRGB(e,t);return 255*s<<16^255*r<<8^255*n<<0}static convertSRGBToLinear(e,t){const s=e,r=t;for(let n=0;n<3;n++)r[n]=s[n]<.04045?.0773993808*s[n]:Math.pow(.9478672986*s[n]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const s=e,r=t;for(let n=0;n<3;n++)r[n]=s[n]<.0031308?12.92*s[n]:1.055*Math.pow(s[n],.41666)-.055;return t}}class je{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return F.decodeText(e.slice(12,16))===je.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}je.PNG_FRIED_CHUNK_NAME="CgBI";class he{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getVRAMByteLength(e,t){if(!this.impls[t])return null;if(this.impls[t].getVRAMByteLength)return this.impls[t].getVRAMByteLength(e);let s=0;const r=this.getSize(e,t);if(!r)return null;for(;r[0]>1||r[1]>1;)s+=r[0]*r[1]*4,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return s+=4,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}function ls(o,e){if(e>o.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(o.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return o}he.impls={"image/jpeg":new class{match(o){return o.length>=3&&o[0]===255&&o[1]===216&&o[2]===255}getSize(o){let e,t,s=new DataView(o.buffer,o.byteOffset+4);for(;s.byteLength;){if(e=s.getUint16(0,!1),ls(s,e),t=s.getUint8(e+1),t===192||t===193||t===194)return[s.getUint16(e+7,!1),s.getUint16(e+5,!1)];s=new DataView(o.buffer,s.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(o){return 3}},"image/png":new je};class ye{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return he.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function _t(o){return Object.prototype.toString.call(o)==="[object Object]"}function ce(o){if(_t(o)===!1)return!1;const e=o.constructor;if(e===void 0)return!0;const t=e.prototype;return _t(t)!==!1&&Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")!==!1}var ct,ut;(function(o){o[o.SILENT=4]="SILENT",o[o.ERROR=3]="ERROR",o[o.WARN=2]="WARN",o[o.INFO=1]="INFO",o[o.DEBUG=0]="DEBUG"})(ut||(ut={}));class q{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=q.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=q.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=q.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=q.Verbosity.ERROR&&console.error(e)}}function fs(o,e,t){var s=e[0],r=e[1],n=e[2],i=e[3],a=e[4],c=e[5],u=e[6],f=e[7],d=e[8],x=e[9],y=e[10],w=e[11],T=e[12],l=e[13],_=e[14],h=e[15],g=t[0],p=t[1],m=t[2],E=t[3];return o[0]=g*s+p*a+m*d+E*T,o[1]=g*r+p*c+m*x+E*l,o[2]=g*n+p*u+m*y+E*_,o[3]=g*i+p*f+m*w+E*h,o[4]=(g=t[4])*s+(p=t[5])*a+(m=t[6])*d+(E=t[7])*T,o[5]=g*r+p*c+m*x+E*l,o[6]=g*n+p*u+m*y+E*_,o[7]=g*i+p*f+m*w+E*h,o[8]=(g=t[8])*s+(p=t[9])*a+(m=t[10])*d+(E=t[11])*T,o[9]=g*r+p*c+m*x+E*l,o[10]=g*n+p*u+m*y+E*_,o[11]=g*i+p*f+m*w+E*h,o[12]=(g=t[12])*s+(p=t[13])*a+(m=t[14])*d+(E=t[15])*T,o[13]=g*r+p*c+m*x+E*l,o[14]=g*n+p*u+m*y+E*_,o[15]=g*i+p*f+m*w+E*h,o}ct=q,q.Verbosity=ut,q.DEFAULT_INSTANCE=new ct(ct.Verbosity.INFO);class B{static identity(e){return e}static eq(e,t,s=1e-5){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(Math.abs(e[r]-t[r])>s)return!1;return!0}static decodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,t){return B.decodeNormalizedInt(e,t)}static encodeNormalizedInt(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,t){return B.encodeNormalizedInt(e,t)}static decompose(e,t,s,r){let n=ht([e[0],e[1],e[2]]);const i=ht([e[4],e[5],e[6]]),a=ht([e[8],e[9],e[10]]);var c,u,f,d,x,y,w,T,l,_,h,g,p,m,E,b,A;((u=(c=e)[0])*(w=c[5])-(f=c[1])*(y=c[4]))*((g=c[10])*(A=c[15])-(p=c[11])*(b=c[14]))-(u*(T=c[6])-(d=c[2])*y)*((h=c[9])*A-p*(E=c[13]))+(u*(l=c[7])-(x=c[3])*y)*(h*b-g*E)+(f*T-d*w)*((_=c[8])*A-p*(m=c[12]))-(f*l-x*w)*(_*b-g*m)+(d*l-x*T)*(_*E-h*m)<0&&(n=-n),t[0]=e[12],t[1]=e[13],t[2]=e[14];const R=e.slice(),M=1/n,S=1/i,z=1/a;R[0]*=M,R[1]*=M,R[2]*=M,R[4]*=S,R[5]*=S,R[6]*=S,R[8]*=z,R[9]*=z,R[10]*=z,function(I,C){var v=new at(3);(function(dt,te){var Ws=te[4],qs=te[5],Js=te[6],Hs=te[8],$s=te[9],Xs=te[10];dt[0]=Math.hypot(te[0],te[1],te[2]),dt[1]=Math.hypot(Ws,qs,Js),dt[2]=Math.hypot(Hs,$s,Xs)})(v,C);var L=1/v[0],P=1/v[1],G=1/v[2],V=C[0]*L,W=C[1]*P,X=C[2]*G,J=C[4]*L,ne=C[5]*P,ie=C[6]*G,Xe=C[8]*L,Ze=C[9]*P,we=C[10]*G,Jt=V+ne+we,j=0;Jt>0?(j=2*Math.sqrt(Jt+1),I[3]=.25*j,I[0]=(ie-Ze)/j,I[1]=(Xe-X)/j,I[2]=(W-J)/j):V>ne&&V>we?(j=2*Math.sqrt(1+V-ne-we),I[3]=(ie-Ze)/j,I[0]=.25*j,I[1]=(W+J)/j,I[2]=(Xe+X)/j):ne>we?(j=2*Math.sqrt(1+ne-V-we),I[3]=(Xe-X)/j,I[0]=(W+J)/j,I[1]=.25*j,I[2]=(ie+Ze)/j):(j=2*Math.sqrt(1+we-V-ne),I[3]=(W-J)/j,I[0]=(Xe+X)/j,I[1]=(ie+Ze)/j,I[2]=.25*j)}(s,R),r[0]=n,r[1]=i,r[2]=a}static compose(e,t,s,r){const n=r,i=t[0],a=t[1],c=t[2],u=t[3],f=i+i,d=a+a,x=c+c,y=i*f,w=i*d,T=i*x,l=a*d,_=a*x,h=c*x,g=u*f,p=u*d,m=u*x,E=s[0],b=s[1],A=s[2];return n[0]=(1-(l+h))*E,n[1]=(w+m)*E,n[2]=(T-p)*E,n[3]=0,n[4]=(w-m)*b,n[5]=(1-(y+h))*b,n[6]=(_+g)*b,n[7]=0,n[8]=(T+p)*A,n[9]=(_-g)*A,n[10]=(1-(y+l))*A,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}}function ds(o,e){if(!!o!=!!e)return!1;const t=o.getChild(),s=e.getChild();return t===s||t.equals(s)}function gs(o,e){if(!!o!=!!e||o.length!==e.length)return!1;for(let t=0;t<o.length;t++){const s=o[t],r=e[t];if(s.getChild()!==r.getChild()&&!s.getChild().equals(r.getChild()))return!1}return!0}function ps(o,e){if(!!o!=!!e)return!1;const t=Object.keys(o),s=Object.keys(e);if(t.length!==s.length)return!1;for(const r in o){const n=o[r],i=e[r];if(!!n!=!!i)return!1;const a=n.getChild(),c=i.getChild();if(a!==c&&!a.equals(c))return!1}return!0}function Tt(o,e){if(o===e)return!0;if(!!o!=!!e||!o||!e||o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;return!0}function Mt(o,e){if(o===e)return!0;if(!!o!=!!e)return!1;if(!ce(o)||!ce(e))return o===e;const t=o,s=e;let r,n=0,i=0;for(r in t)n++;for(r in s)i++;if(n!==i)return!1;for(r in t){const a=t[r],c=s[r];if(ke(a)&&ke(c)){if(!Tt(a,c))return!1}else if(ce(a)&&ce(c)){if(!Mt(a,c))return!1}else if(a!==c)return!1}return!0}function ke(o){return Array.isArray(o)||ArrayBuffer.isView(o)}const bt=new Set,ms=function(){let o="";for(let e=0;e<6;e++)o+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return o},ys=function(){for(let o=0;o<999;o++){const e=ms();if(!bt.has(e))return bt.add(e),e}return""},Rt="https://null.example";class Re{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return ye.basename(new URL(e,Rt).pathname)}static extension(e){return ye.extension(new URL(e,Rt).pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const s=e.split("/"),r=t.split("/");s.pop();for(let n=0;n<r.length;n++)r[n]!=="."&&(r[n]===".."?s.pop():s.push(r[n]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Re.DEFAULT_INIT={},Re.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const Q=o=>o,xs=new Set;class lt extends it{constructor(e,t=""){super(e),this[U].name=t,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,t){return Array.isArray(t)&&(t=t.slice()),super.set(e,t)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,Q)}copy(e,t=Q){for(const s in this[U]){const r=this[U][s];if(r instanceof pe)this[me].has(s)||r.dispose();else if(Me(r))for(const n of r)n.dispose();else if(be(r))for(const n in r)r[n].dispose()}for(const s in e[U]){const r=this[U][s],n=e[U][s];if(n instanceof pe)this[me].has(s)?r.getChild().copy(t(n.getChild()),t):this.setRef(s,t(n.getChild()),n.getAttributes());else if(Me(n))for(const i of n)this.addRef(s,t(i.getChild()),i.getAttributes());else if(be(n))for(const i in n){const a=n[i];this.setRefMap(s,i,t(a.getChild()),a.getAttributes())}else this[U][s]=ce(n)?JSON.parse(JSON.stringify(n)):Array.isArray(n)||n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.slice():n}return this}equals(e,t=xs){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[U]){if(t.has(s))continue;const r=this[U][s],n=e[U][s];if(nt(r)||nt(n)){if(!ds(r,n))return!1}else if(Me(r)||Me(n)){if(!gs(r,n))return!1}else if(be(r)||be(n)){if(!ps(r,n))return!1}else if(ce(r)||ce(n)){if(!Mt(r,n))return!1}else if(ke(r)||ke(n)){if(!Tt(r,n))return!1}else if(r!==n)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class k extends lt{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class N extends k{constructor(...e){super(...e),this.i=B.identity,this.o=B.identity}init(){this.propertyType=O.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:N.Type.SCALAR,componentType:N.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,t=Q){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case N.Type.SCALAR:return 1;case N.Type.VEC2:return 2;case N.Type.VEC3:return 3;case N.Type.VEC4:case N.Type.MAT2:return 4;case N.Type.MAT3:return 9;case N.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case N.ComponentType.BYTE:case N.ComponentType.UNSIGNED_BYTE:return 1;case N.ComponentType.SHORT:case N.ComponentType.UNSIGNED_SHORT:return 2;case N.ComponentType.UNSIGNED_INT:case N.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let s=0;s<t;s++)e[s]=this.o(e[s]);return e}getMin(e){const t=this.get("array"),s=this.getCount(),r=this.getElementSize();for(let n=0;n<r;n++)e[n]=1/0;for(let n=0;n<s*r;n+=r)for(let i=0;i<r;i++){const a=t[n+i];Number.isFinite(a)&&(e[i]=Math.min(e[i],a))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let s=0;s<t;s++)e[s]=this.o(e[s]);return e}getMax(e){const t=this.get("array"),s=this.getCount(),r=this.getElementSize();for(let n=0;n<r;n++)e[n]=-1/0;for(let n=0;n<s*r;n+=r)for(let i=0;i<r;i++){const a=t[n+i];Number.isFinite(a)&&(e[i]=Math.max(e[i],a))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return N.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=t=>B.decodeNormalizedInt(t,this.get("componentType")),this.i=t=>B.encodeNormalizedInt(t,this.get("componentType"))):(this.o=B.identity,this.i=B.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const s=this.getElementSize(),r=this.get("array");for(let n=0;n<s;n++)t[n]=this.o(r[e*s+n]);return t}setElement(e,t){const s=this.getElementSize(),r=this.get("array");for(let n=0;n<s;n++)r[e*s+n]=this.i(t[n]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(t){switch(t.constructor){case Float32Array:return N.ComponentType.FLOAT;case Uint32Array:return N.ComponentType.UNSIGNED_INT;case Uint16Array:return N.ComponentType.UNSIGNED_SHORT;case Uint8Array:return N.ComponentType.UNSIGNED_BYTE;case Int16Array:return N.ComponentType.SHORT;case Int8Array:return N.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):N.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}N.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},N.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class At extends k{init(){this.propertyType=O.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class St extends k{init(){this.propertyType=O.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}St.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class Ae extends k{init(){this.propertyType=O.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Ae.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:K.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:K.OTHER})}}Ae.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class It extends k{init(){this.propertyType=O.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class ue extends k{init(){this.propertyType=O.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:ue.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}ue.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Es extends lt{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}Es.EXTENSION_NAME=void 0;class H extends k{init(){this.propertyType=O.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:H.WrapMode.REPEAT,wrapT:H.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}H.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},H.MagFilter={NEAREST:9728,LINEAR:9729},H.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:De,G:Ge,B:Ke,A:ws}=ot;class le extends k{init(){this.propertyType=O.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:le.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new H(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new H(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new H(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new H(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new H(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Ve.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Ve.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:De|Ge|Ke|ws,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Ve.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Ve.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:De|Ge|Ke,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:De|Ge|Ke})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:De})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Ge|Ke})}}le.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class Ct extends k{init(){this.propertyType=O.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class zt extends k{constructor(...e){super(...e),this.u=null,this.h=new Set}init(){this.propertyType=O.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=Q){if(t===Q)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return B.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),s=this.get("rotation").slice(),r=this.get("scale").slice();return B.decompose(e,t,s,r),this.set("translation",t).set("rotation",s).set("scale",r)}getWorldTranslation(){const e=[0,0,0];return B.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return B.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return B.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let r=this;r!=null;r=r.u)e.push(r);let t;const s=e.pop().getMatrix();for(;t=e.pop();)fs(s,s,t.getMatrix());return s}addChild(e){if(e.u&&e.u.removeChild(e),e.h.size)for(const s of e.h)s.removeChild(e);this.addRef("children",e),e.u=this;const t=this[U].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===O.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class Ye extends k{init(){this.propertyType=O.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Ye.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:K.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:K.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}Ye.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class _s extends lt{init(){this.propertyType=O.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:K.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function D(){return D=Object.assign?Object.assign.bind():function(o){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(o[s]=t[s])}return o},D.apply(this,arguments)}class Nt extends k{init(){this.propertyType=O.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=Q){if(t===Q)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.h.add(this);const t=this[U].children;return t[t.length-1].addEventListener("dispose",()=>e.h.delete(this)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class vt extends k{init(){this.propertyType=O.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:K.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class Ot extends k{init(){this.propertyType=O.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||he.extensionToMimeType(ye.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const t=he.extensionToMimeType(ye.extension(e));return t&&this.set("mimeType",t),this}getImage(){return this.get("image")}setImage(e){return this.set("image",F.assertView(e))}getSize(){const e=this.get("image");return e?he.getSize(e,this.getMimeType()):null}}class Ts extends k{init(){this.propertyType=O.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${wt}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.l=new Set,e.addEventListener("node:create",t=>{this.g(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=Q){if(t===Q)throw new Error("Root cannot be copied.");this.set("asset",D({},e.get("asset"))),this.setName(e.getName()),this.setExtras(D({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const r=e.getExtension(s);this.setExtension(s,t(r))}return this}g(e){return e instanceof Nt?this.addRef("scenes",e):e instanceof zt?this.addRef("nodes",e):e instanceof ue?this.addRef("cameras",e):e instanceof vt?this.addRef("skins",e):e instanceof Ct?this.addRef("meshes",e):e instanceof le?this.addRef("materials",e):e instanceof Ot?this.addRef("textures",e):e instanceof At?this.addRef("animations",e):e instanceof N?this.addRef("accessors",e):e instanceof It&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.l)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}p(e){return this.l.add(e),this}m(e){return this.l.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class xe{static fromGraph(e){return xe.v.get(e)||null}constructor(){this.T=new hs,this.S=new Ts(this.T),this.M=q.DEFAULT_INSTANCE,xe.v.set(this.T,this)}getRoot(){return this.S}getGraph(){return this.T}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new xe().setLogger(this.M).merge(this)}merge(e){for(const n of e.getRoot().listExtensionsUsed()){const i=this.createExtension(n.constructor);n.isRequired()&&i.setRequired(!0)}const t=new Set,s=new Map;t.add(e.S),s.set(e.S,this.S);for(const n of e.T.listEdges())for(const i of[n.getParent(),n.getChild()]){if(t.has(i))continue;let a;a=i.propertyType===O.TEXTURE_INFO?i:new i.constructor(this.T),s.set(i,a),t.add(i)}const r=n=>{const i=s.get(n);if(!i)throw new Error("Could resolve property.");return i};for(const n of t){const i=s.get(n);if(!i)throw new Error("Could resolve property.");i.propertyType!==O.TEXTURE_INFO&&i.copy(n,r)}return this}async transform(...e){const t=e.map(s=>s.name);for(const s of e)await s(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===t)||new e(this)}createScene(e=""){return new Nt(this.T,e)}createNode(e=""){return new zt(this.T,e)}createCamera(e=""){return new ue(this.T,e)}createSkin(e=""){return new vt(this.T,e)}createMesh(e=""){return new Ct(this.T,e)}createPrimitive(){return new Ye(this.T)}createPrimitiveTarget(e=""){return new _s(this.T,e)}createMaterial(e=""){return new le(this.T,e)}createTexture(e=""){return new Ot(this.T,e)}createAnimation(e=""){return new At(this.T,e)}createAnimationChannel(e=""){return new St(this.T,e)}createAnimationSampler(e=""){return new Ae(this.T,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new N(this.T,e).setBuffer(t)}createBuffer(e=""){return new It(this.T,e)}}xe.v=new WeakMap;class Ms{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord),t.extras!==void 0&&e.setExtras(t.extras);const s=this.jsonDoc.json.textures[t.index];if(s.sampler===void 0)return;const r=this.jsonDoc.json.samplers[s.sampler];r.magFilter!==void 0&&e.setMagFilter(r.magFilter),r.minFilter!==void 0&&e.setMinFilter(r.minFilter),r.wrapS!==void 0&&e.setWrapS(r.wrapS),r.wrapT!==void 0&&e.setWrapT(r.wrapT)}}const Ft={logger:q.DEFAULT_INSTANCE,extensions:[],dependencies:{}};class bs{static read(e,t=Ft){const s=D({},Ft,t),{json:r}=e,n=new xe().setLogger(s.logger);this.validate(e,s);const i=new Ms(e),a=r.asset,c=n.getRoot().getAsset();a.copyright&&(c.copyright=a.copyright),a.extras&&(c.extras=a.extras),r.extras!==void 0&&n.getRoot().setExtras(D({},r.extras));const u=r.extensionsUsed||[],f=r.extensionsRequired||[];for(const h of s.extensions)if(u.includes(h.EXTENSION_NAME)){const g=n.createExtension(h).setRequired(f.includes(h.EXTENSION_NAME));for(const p of g.readDependencies)g.install(p,s.dependencies[p])}const d=r.buffers||[];n.getRoot().listExtensionsUsed().filter(h=>h.prereadTypes.includes(O.BUFFER)).forEach(h=>h.preread(i,O.BUFFER)),i.buffers=d.map(h=>{const g=n.createBuffer(h.name);return h.extras&&g.setExtras(h.extras),h.uri&&h.uri.indexOf("__")!==0&&g.setURI(h.uri),g}),i.bufferViewBuffers=(r.bufferViews||[]).map((h,g)=>{if(!i.bufferViews[g]){const p=e.json.buffers[h.buffer];i.bufferViews[g]=F.toView(p.uri?e.resources[p.uri]:e.resources[Ue],h.byteOffset||0,h.byteLength)}return i.buffers[h.buffer]});const x=r.accessors||[];i.accessors=x.map(h=>{const g=n.createAccessor(h.name,i.bufferViewBuffers[h.bufferView]).setType(h.type);return h.extras&&g.setExtras(h.extras),h.normalized!==void 0&&g.setNormalized(h.normalized),h.bufferView===void 0||g.setArray(We(h,i)),g});const y=r.images||[],w=r.textures||[];n.getRoot().listExtensionsUsed().filter(h=>h.prereadTypes.includes(O.TEXTURE)).forEach(h=>h.preread(i,O.TEXTURE)),i.textures=y.map(h=>{const g=n.createTexture(h.name);if(h.extras&&g.setExtras(h.extras),h.bufferView!==void 0){const p=r.bufferViews[h.bufferView],m=e.json.buffers[p.buffer],E=p.byteOffset||0,b=(m.uri?e.resources[m.uri]:e.resources[Ue]).slice(E,E+p.byteLength);g.setImage(b)}else h.uri!==void 0&&(g.setImage(e.resources[h.uri]),h.uri.indexOf("__")!==0&&g.setURI(h.uri));if(h.mimeType!==void 0)g.setMimeType(h.mimeType);else if(h.uri){const p=ye.extension(h.uri);g.setMimeType(he.extensionToMimeType(p))}return g}),i.materials=(r.materials||[]).map(h=>{const g=n.createMaterial(h.name);h.extras&&g.setExtras(h.extras),h.alphaMode!==void 0&&g.setAlphaMode(h.alphaMode),h.alphaCutoff!==void 0&&g.setAlphaCutoff(h.alphaCutoff),h.doubleSided!==void 0&&g.setDoubleSided(h.doubleSided);const p=h.pbrMetallicRoughness||{};if(p.baseColorFactor!==void 0&&g.setBaseColorFactor(p.baseColorFactor),h.emissiveFactor!==void 0&&g.setEmissiveFactor(h.emissiveFactor),p.metallicFactor!==void 0&&g.setMetallicFactor(p.metallicFactor),p.roughnessFactor!==void 0&&g.setRoughnessFactor(p.roughnessFactor),p.baseColorTexture!==void 0){const m=p.baseColorTexture;g.setBaseColorTexture(i.textures[w[m.index].source]),i.setTextureInfo(g.getBaseColorTextureInfo(),m)}if(h.emissiveTexture!==void 0){const m=h.emissiveTexture;g.setEmissiveTexture(i.textures[w[m.index].source]),i.setTextureInfo(g.getEmissiveTextureInfo(),m)}if(h.normalTexture!==void 0){const m=h.normalTexture;g.setNormalTexture(i.textures[w[m.index].source]),i.setTextureInfo(g.getNormalTextureInfo(),m),h.normalTexture.scale!==void 0&&g.setNormalScale(h.normalTexture.scale)}if(h.occlusionTexture!==void 0){const m=h.occlusionTexture;g.setOcclusionTexture(i.textures[w[m.index].source]),i.setTextureInfo(g.getOcclusionTextureInfo(),m),h.occlusionTexture.strength!==void 0&&g.setOcclusionStrength(h.occlusionTexture.strength)}if(p.metallicRoughnessTexture!==void 0){const m=p.metallicRoughnessTexture;g.setMetallicRoughnessTexture(i.textures[w[m.index].source]),i.setTextureInfo(g.getMetallicRoughnessTextureInfo(),m)}return g});const T=r.meshes||[];n.getRoot().listExtensionsUsed().filter(h=>h.prereadTypes.includes(O.PRIMITIVE)).forEach(h=>h.preread(i,O.PRIMITIVE)),i.meshes=T.map(h=>{const g=n.createMesh(h.name);return h.extras&&g.setExtras(h.extras),h.weights!==void 0&&g.setWeights(h.weights),(h.primitives||[]).forEach(p=>{const m=n.createPrimitive();p.extras&&m.setExtras(p.extras),p.material!==void 0&&m.setMaterial(i.materials[p.material]),p.mode!==void 0&&m.setMode(p.mode);for(const[b,A]of Object.entries(p.attributes||{}))m.setAttribute(b,i.accessors[A]);p.indices!==void 0&&m.setIndices(i.accessors[p.indices]);const E=h.extras&&h.extras.targetNames||[];(p.targets||[]).forEach((b,A)=>{const R=E[A]||A.toString(),M=n.createPrimitiveTarget(R);for(const[S,z]of Object.entries(b))M.setAttribute(S,i.accessors[z]);m.addTarget(M)}),g.addPrimitive(m)}),g}),i.cameras=(r.cameras||[]).map(h=>{const g=n.createCamera(h.name).setType(h.type);if(h.extras&&g.setExtras(h.extras),h.type===ue.Type.PERSPECTIVE){const p=h.perspective;g.setYFov(p.yfov),g.setZNear(p.znear),p.zfar!==void 0&&g.setZFar(p.zfar),p.aspectRatio!==void 0&&g.setAspectRatio(p.aspectRatio)}else{const p=h.orthographic;g.setZNear(p.znear).setZFar(p.zfar).setXMag(p.xmag).setYMag(p.ymag)}return g});const l=r.nodes||[];n.getRoot().listExtensionsUsed().filter(h=>h.prereadTypes.includes(O.NODE)).forEach(h=>h.preread(i,O.NODE)),i.nodes=l.map(h=>{const g=n.createNode(h.name);if(h.extras&&g.setExtras(h.extras),h.translation!==void 0&&g.setTranslation(h.translation),h.rotation!==void 0&&g.setRotation(h.rotation),h.scale!==void 0&&g.setScale(h.scale),h.matrix!==void 0){const p=[0,0,0],m=[0,0,0,1],E=[1,1,1];B.decompose(h.matrix,p,m,E),g.setTranslation(p),g.setRotation(m),g.setScale(E)}return h.weights!==void 0&&g.setWeights(h.weights),g}),i.skins=(r.skins||[]).map(h=>{const g=n.createSkin(h.name);h.extras&&g.setExtras(h.extras),h.inverseBindMatrices!==void 0&&g.setInverseBindMatrices(i.accessors[h.inverseBindMatrices]),h.skeleton!==void 0&&g.setSkeleton(i.nodes[h.skeleton]);for(const p of h.joints)g.addJoint(i.nodes[p]);return g}),l.map((h,g)=>{const p=i.nodes[g];(h.children||[]).forEach(m=>p.addChild(i.nodes[m])),h.mesh!==void 0&&p.setMesh(i.meshes[h.mesh]),h.camera!==void 0&&p.setCamera(i.cameras[h.camera]),h.skin!==void 0&&p.setSkin(i.skins[h.skin])}),i.animations=(r.animations||[]).map(h=>{const g=n.createAnimation(h.name);h.extras&&g.setExtras(h.extras);const p=(h.samplers||[]).map(m=>{const E=n.createAnimationSampler().setInput(i.accessors[m.input]).setOutput(i.accessors[m.output]).setInterpolation(m.interpolation||Ae.Interpolation.LINEAR);return m.extras&&E.setExtras(m.extras),g.addSampler(E),E});return(h.channels||[]).forEach(m=>{const E=n.createAnimationChannel().setSampler(p[m.sampler]).setTargetPath(m.target.path);m.target.node!==void 0&&E.setTargetNode(i.nodes[m.target.node]),m.extras&&E.setExtras(m.extras),g.addChannel(E)}),g});const _=r.scenes||[];return n.getRoot().listExtensionsUsed().filter(h=>h.prereadTypes.includes(O.SCENE)).forEach(h=>h.preread(i,O.SCENE)),i.scenes=_.map(h=>{const g=n.createScene(h.name);return h.extras&&g.setExtras(h.extras),(h.nodes||[]).map(p=>i.nodes[p]).forEach(p=>g.addChild(p)),g}),r.scene!==void 0&&n.getRoot().setDefaultScene(i.scenes[r.scene]),n.getRoot().listExtensionsUsed().forEach(h=>h.read(i)),x.forEach((h,g)=>{const p=i.accessors[g],m=!!h.sparse,E=!h.bufferView&&!p.getArray();(m||E)&&p.setSparse(!0).setArray(function(b,A){const R=Be[b.componentType],M=N.getElementSize(b.type);let S;S=b.bufferView!==void 0?We(b,A):new R(b.count*M);const z=b.sparse;if(!z)return S;const I=z.count,C=D({},b,z.indices,{count:I,type:"SCALAR"}),v=D({},b,z.values,{count:I}),L=We(C,A),P=We(v,A);for(let G=0;G<C.count;G++)for(let V=0;V<M;V++)S[L[G]*M+V]=P[G*M+V];return S}(h,i))}),n}static validate(e,t){const s=e.json;if(s.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${s.asset.version}".`);if(s.extensionsRequired){for(const r of s.extensionsRequired)if(!t.extensions.find(n=>n.EXTENSION_NAME===r))throw new Error(`Missing required extension, "${r}".`)}if(s.extensionsUsed)for(const r of s.extensionsUsed)t.extensions.find(n=>n.EXTENSION_NAME===r)||t.logger.warn(`Missing optional extension, "${r}".`)}}function We(o,e){const t=e.bufferViews[o.bufferView],s=e.jsonDoc.json.bufferViews[o.bufferView],r=Be[o.componentType],n=N.getElementSize(o.type),i=r.BYTES_PER_ELEMENT;if(s.byteStride!==void 0&&s.byteStride!==n*i)return function(c,u){const f=u.bufferViews[c.bufferView],d=u.jsonDoc.json.bufferViews[c.bufferView],x=Be[c.componentType],y=N.getElementSize(c.type),w=x.BYTES_PER_ELEMENT,T=c.byteOffset||0,l=new x(c.count*y),_=new DataView(f.buffer,f.byteOffset,f.byteLength),h=d.byteStride;for(let g=0;g<c.count;g++)for(let p=0;p<y;p++){const m=T+g*h+p*w;let E;switch(c.componentType){case N.ComponentType.FLOAT:E=_.getFloat32(m,!0);break;case N.ComponentType.UNSIGNED_INT:E=_.getUint32(m,!0);break;case N.ComponentType.UNSIGNED_SHORT:E=_.getUint16(m,!0);break;case N.ComponentType.UNSIGNED_BYTE:E=_.getUint8(m);break;case N.ComponentType.SHORT:E=_.getInt16(m,!0);break;case N.ComponentType.BYTE:E=_.getInt8(m);break;default:throw new Error(`Unexpected componentType "${c.componentType}".`)}l[g*y+p]=E}return l}(o,e);const a=t.byteOffset+(o.byteOffset||0);return new r(t.buffer.slice(a,a+o.count*n*i))}var Se;(function(o){o[o.ARRAY_BUFFER=34962]="ARRAY_BUFFER",o[o.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Se||(Se={}));class fe{constructor(e,t,s){this.C=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.F=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.C=e,this.jsonDoc=t,this.options=s;const r=e.getRoot(),n=r.listBuffers().length,i=r.listTextures().length;this.bufferURIGenerator=new Ut(n>1,()=>s.basename||"buffer"),this.imageURIGenerator=new Ut(i>1,a=>function(c,u){const f=c.getGraph().listParentEdges(u).find(d=>d.getParent()!==c.getRoot());return f?f.getName().replace(/texture$/i,""):""}(e,a)||s.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,t){const s={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},r=JSON.stringify(s);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const n={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(r)},i=JSON.stringify(n);this.textureDefIndexMap.has(i)||(this.textureDefIndexMap.set(i,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(n));const a={index:this.textureDefIndexMap.get(i)};return t.getTexCoord()!==0&&(a.texCoord=t.getTexCoord()),Object.keys(t.getExtras()).length>0&&(a.extras=t.getExtras()),this.textureInfoDefMap.set(t,a),a}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.C.getGraph().listParentEdges(e).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,s){if(this.options.format===ae.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const r=he.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,r),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.F.get(e);if(t)return t;if(e.getSparse())return K.SPARSE;for(const s of this.C.getGraph().listParentEdges(e)){const{usage:r}=s.getAttributes();if(r)return r;s.getParent().propertyType!==O.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return K.OTHER}addAccessorToUsageGroup(e,t){const s=this.F.get(e);if(s&&s!==t)throw new Error(`Accessor with usage "${s}" cannot be reused as "${t}".`);return this.F.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,s]of Array.from(this.F.entries()))e[s]=e[s]||[],e[s].push(t);return e}}fe.BufferViewTarget=Se,fe.BufferViewUsage=K,fe.USAGE_TO_TARGET={[K.ARRAY_BUFFER]:Se.ARRAY_BUFFER,[K.ELEMENT_ARRAY_BUFFER]:Se.ELEMENT_ARRAY_BUFFER};class Ut{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=t}createURI(e,t){if(e.getURI())return e.getURI();if(this.multiple){const s=this.basename(e);return this.counter[s]=this.counter[s]||1,`${s}_${this.counter[s]++}.${t}`}return`${this.basename(e)}.${t}`}}const{BufferViewUsage:qe}=fe,{UNSIGNED_INT:Rs,UNSIGNED_SHORT:As,UNSIGNED_BYTE:Ss}=N.ComponentType;class Is{static write(e,t){const s=e.getRoot(),r={asset:D({generator:`glTF-Transform ${wt}`},s.getAsset()),extras:D({},s.getExtras())},n={json:r,resources:{}},i=new fe(e,n,t),a=t.logger||q.DEFAULT_INSTANCE,c=new Set(t.extensions.map(l=>l.EXTENSION_NAME)),u=e.getRoot().listExtensionsUsed().filter(l=>c.has(l.extensionName)),f=e.getRoot().listExtensionsRequired().filter(l=>c.has(l.extensionName));u.length<e.getRoot().listExtensionsUsed().length&&a.warn("Some extensions were not registered for I/O, and will not be written.");for(const l of u)for(const _ of l.writeDependencies)l.install(_,t.dependencies[_]);function d(l,_,h,g){const p=[];let m=0;for(const b of l){const A=i.createAccessorDef(b);A.bufferView=r.bufferViews.length;const R=b.getArray(),M=F.pad(F.toView(R));A.byteOffset=m,m+=M.byteLength,p.push(M),i.accessorIndexMap.set(b,r.accessors.length),r.accessors.push(A)}const E={buffer:_,byteOffset:h,byteLength:F.concat(p).byteLength};return g&&(E.target=g),r.bufferViews.push(E),{buffers:p,byteLength:m}}function x(l,_,h){const g=l[0].getCount();let p=0;for(const A of l){const R=i.createAccessorDef(A);R.bufferView=r.bufferViews.length,R.byteOffset=p;const M=A.getElementSize(),S=A.getComponentSize();p+=F.padNumber(M*S),i.accessorIndexMap.set(A,r.accessors.length),r.accessors.push(R)}const m=g*p,E=new ArrayBuffer(m),b=new DataView(E);for(let A=0;A<g;A++){let R=0;for(const M of l){const S=M.getElementSize(),z=M.getComponentSize(),I=M.getComponentType(),C=M.getArray();for(let v=0;v<S;v++){const L=A*p+R+v*z,P=C[A*S+v];switch(I){case N.ComponentType.FLOAT:b.setFloat32(L,P,!0);break;case N.ComponentType.BYTE:b.setInt8(L,P);break;case N.ComponentType.SHORT:b.setInt16(L,P,!0);break;case N.ComponentType.UNSIGNED_BYTE:b.setUint8(L,P);break;case N.ComponentType.UNSIGNED_SHORT:b.setUint16(L,P,!0);break;case N.ComponentType.UNSIGNED_INT:b.setUint32(L,P,!0);break;default:throw new Error("Unexpected component type: "+I)}}R+=F.padNumber(S*z)}}return r.bufferViews.push({buffer:_,byteOffset:h,byteLength:m,byteStride:p,target:fe.BufferViewTarget.ARRAY_BUFFER}),{byteLength:m,buffers:[new Uint8Array(E)]}}function y(l,_,h){const g=[];let p=0;const m=new Map;let E=-1/0;for(const I of l){const C=i.createAccessorDef(I);r.accessors.push(C),i.accessorIndexMap.set(I,r.accessors.length-1);const v=[],L=[],P=[],G=new Array(I.getElementSize()).fill(0);for(let J=0,ne=I.getCount();J<ne;J++)if(I.getElement(J,P),!B.eq(P,G,0)){E=Math.max(J,E),v.push(J);for(let ie=0;ie<P.length;ie++)L.push(P[ie])}const V=v.length,W={accessorDef:C,count:V};if(m.set(I,W),V===0)continue;if(V>I.getCount()/3){const J=(100*v.length/I.getCount()).toFixed(1);a.warn(`Sparse accessor with many non-zero elements (${J}%) may increase file size.`)}const X=Be[I.getComponentType()];W.indices=v,W.values=new X(L)}if(!Number.isFinite(E))return{buffers:g,byteLength:p};const b=E<255?Uint8Array:E<65535?Uint16Array:Uint32Array,A=E<255?Ss:E<65535?As:Rs,R={buffer:_,byteOffset:h+p,byteLength:0};for(const I of l){const C=m.get(I);if(C.count===0)continue;C.indicesByteOffset=R.byteLength;const v=F.pad(F.toView(new b(C.indices)));g.push(v),p+=v.byteLength,R.byteLength+=v.byteLength}r.bufferViews.push(R);const M=r.bufferViews.length-1,S={buffer:_,byteOffset:h+p,byteLength:0};for(const I of l){const C=m.get(I);if(C.count===0)continue;C.valuesByteOffset=S.byteLength;const v=F.pad(F.toView(C.values));g.push(v),p+=v.byteLength,S.byteLength+=v.byteLength}r.bufferViews.push(S);const z=r.bufferViews.length-1;for(const I of l){const C=m.get(I);C.count!==0&&(C.accessorDef.sparse={count:C.count,indices:{bufferView:M,byteOffset:C.indicesByteOffset,componentType:A},values:{bufferView:z,byteOffset:C.valuesByteOffset}})}return{buffers:g,byteLength:p}}const w=new Map;for(const l of e.getGraph().listEdges()){if(l.getParent()===s)continue;const _=l.getChild();if(_ instanceof N){const h=w.get(_)||[];h.push(l),w.set(_,h)}}if(r.accessors=[],r.bufferViews=[],r.samplers=[],r.textures=[],r.images=s.listTextures().map((l,_)=>{const h=i.createPropertyDef(l);l.getMimeType()&&(h.mimeType=l.getMimeType());const g=l.getImage();return g&&i.createImageData(h,g,l),i.imageIndexMap.set(l,_),h}),u.filter(l=>l.prewriteTypes.includes(O.ACCESSOR)).forEach(l=>l.prewrite(i,O.ACCESSOR)),s.listAccessors().forEach(l=>{const _=i.accessorUsageGroupedByParent,h=i.accessorParents;if(i.accessorIndexMap.has(l))return;const g=w.get(l)||[],p=i.getAccessorUsage(l);if(i.addAccessorToUsageGroup(l,p),_.has(p)){const m=g[0].getParent(),E=h.get(m)||new Set;E.add(l),h.set(m,E)}}),u.filter(l=>l.prewriteTypes.includes(O.BUFFER)).forEach(l=>l.prewrite(i,O.BUFFER)),(s.listAccessors().length>0||s.listTextures().length>0||i.otherBufferViews.size>0)&&s.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");r.buffers=[],s.listBuffers().forEach((l,_)=>{const h=i.createPropertyDef(l),g=i.accessorUsageGroupedByParent,p=i.accessorParents,m=l.listParents().filter(S=>S instanceof N),E=new Set(m),b=[],A=r.buffers.length;let R=0;const M=i.listAccessorUsageGroups();for(const S in M)if(g.has(S))for(const z of Array.from(p.values())){const I=Array.from(z).filter(C=>E.has(C)).filter(C=>i.getAccessorUsage(C)===S);if(I.length)if(S!==qe.ARRAY_BUFFER||t.vertexLayout===Pe.INTERLEAVED){const C=S===qe.ARRAY_BUFFER?x(I,A,R):d(I,A,R);R+=C.byteLength,b.push(...C.buffers)}else for(const C of I){const v=x([C],A,R);R+=v.byteLength,b.push(...v.buffers)}}else{const z=M[S].filter(v=>E.has(v));if(!z.length)continue;const I=S===qe.ELEMENT_ARRAY_BUFFER?fe.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,C=S===qe.SPARSE?y(z,A,R):d(z,A,R,I);R+=C.byteLength,b.push(...C.buffers)}if(i.imageBufferViews.length&&_===0){for(let S=0;S<i.imageBufferViews.length;S++)if(r.bufferViews[r.images[S].bufferView].byteOffset=R,R+=i.imageBufferViews[S].byteLength,b.push(i.imageBufferViews[S]),R%8){const z=8-R%8;R+=z,b.push(new Uint8Array(z))}}if(i.otherBufferViews.has(l))for(const S of i.otherBufferViews.get(l))r.bufferViews.push({buffer:A,byteOffset:R,byteLength:S.byteLength}),i.otherBufferViewsIndexMap.set(S,r.bufferViews.length-1),R+=S.byteLength,b.push(S);if(R){let S;t.format===ae.GLB?S=Ue:(S=i.bufferURIGenerator.createURI(l,"bin"),h.uri=S),h.byteLength=R,n.resources[S]=F.concat(b)}r.buffers.push(h),i.bufferIndexMap.set(l,_)}),s.listAccessors().find(l=>!l.getBuffer())&&a.warn("Skipped writing one or more Accessors: no Buffer assigned."),r.materials=s.listMaterials().map((l,_)=>{const h=i.createPropertyDef(l);if(l.getAlphaMode()!==le.AlphaMode.OPAQUE&&(h.alphaMode=l.getAlphaMode()),l.getAlphaMode()===le.AlphaMode.MASK&&(h.alphaCutoff=l.getAlphaCutoff()),l.getDoubleSided()&&(h.doubleSided=!0),h.pbrMetallicRoughness={},B.eq(l.getBaseColorFactor(),[1,1,1,1])||(h.pbrMetallicRoughness.baseColorFactor=l.getBaseColorFactor()),B.eq(l.getEmissiveFactor(),[0,0,0])||(h.emissiveFactor=l.getEmissiveFactor()),l.getRoughnessFactor()!==1&&(h.pbrMetallicRoughness.roughnessFactor=l.getRoughnessFactor()),l.getMetallicFactor()!==1&&(h.pbrMetallicRoughness.metallicFactor=l.getMetallicFactor()),l.getBaseColorTexture()){const g=l.getBaseColorTexture(),p=l.getBaseColorTextureInfo();h.pbrMetallicRoughness.baseColorTexture=i.createTextureInfoDef(g,p)}if(l.getEmissiveTexture()){const g=l.getEmissiveTexture(),p=l.getEmissiveTextureInfo();h.emissiveTexture=i.createTextureInfoDef(g,p)}if(l.getNormalTexture()){const g=l.getNormalTexture(),p=l.getNormalTextureInfo(),m=i.createTextureInfoDef(g,p);l.getNormalScale()!==1&&(m.scale=l.getNormalScale()),h.normalTexture=m}if(l.getOcclusionTexture()){const g=l.getOcclusionTexture(),p=l.getOcclusionTextureInfo(),m=i.createTextureInfoDef(g,p);l.getOcclusionStrength()!==1&&(m.strength=l.getOcclusionStrength()),h.occlusionTexture=m}if(l.getMetallicRoughnessTexture()){const g=l.getMetallicRoughnessTexture(),p=l.getMetallicRoughnessTextureInfo();h.pbrMetallicRoughness.metallicRoughnessTexture=i.createTextureInfoDef(g,p)}return i.materialIndexMap.set(l,_),h}),r.meshes=s.listMeshes().map((l,_)=>{const h=i.createPropertyDef(l);let g=null;return h.primitives=l.listPrimitives().map(p=>{const m={attributes:{}};m.mode=p.getMode();const E=p.getMaterial();E&&(m.material=i.materialIndexMap.get(E)),Object.keys(p.getExtras()).length&&(m.extras=p.getExtras());const b=p.getIndices();b&&(m.indices=i.accessorIndexMap.get(b));for(const A of p.listSemantics())m.attributes[A]=i.accessorIndexMap.get(p.getAttribute(A));for(const A of p.listTargets()){const R={};for(const M of A.listSemantics())R[M]=i.accessorIndexMap.get(A.getAttribute(M));m.targets=m.targets||[],m.targets.push(R)}return p.listTargets().length&&!g&&(g=p.listTargets().map(A=>A.getName())),m}),l.getWeights().length&&(h.weights=l.getWeights()),g&&(h.extras=h.extras||{},h.extras.targetNames=g),i.meshIndexMap.set(l,_),h}),r.cameras=s.listCameras().map((l,_)=>{const h=i.createPropertyDef(l);if(h.type=l.getType(),h.type===ue.Type.PERSPECTIVE){h.perspective={znear:l.getZNear(),zfar:l.getZFar(),yfov:l.getYFov()};const g=l.getAspectRatio();g!==null&&(h.perspective.aspectRatio=g)}else h.orthographic={znear:l.getZNear(),zfar:l.getZFar(),xmag:l.getXMag(),ymag:l.getYMag()};return i.cameraIndexMap.set(l,_),h}),r.nodes=s.listNodes().map((l,_)=>{const h=i.createPropertyDef(l);return B.eq(l.getTranslation(),[0,0,0])||(h.translation=l.getTranslation()),B.eq(l.getRotation(),[0,0,0,1])||(h.rotation=l.getRotation()),B.eq(l.getScale(),[1,1,1])||(h.scale=l.getScale()),l.getWeights().length&&(h.weights=l.getWeights()),i.nodeIndexMap.set(l,_),h}),r.skins=s.listSkins().map((l,_)=>{const h=i.createPropertyDef(l),g=l.getInverseBindMatrices();g&&(h.inverseBindMatrices=i.accessorIndexMap.get(g));const p=l.getSkeleton();return p&&(h.skeleton=i.nodeIndexMap.get(p)),h.joints=l.listJoints().map(m=>i.nodeIndexMap.get(m)),i.skinIndexMap.set(l,_),h}),s.listNodes().forEach((l,_)=>{const h=r.nodes[_],g=l.getMesh();g&&(h.mesh=i.meshIndexMap.get(g));const p=l.getCamera();p&&(h.camera=i.cameraIndexMap.get(p));const m=l.getSkin();m&&(h.skin=i.skinIndexMap.get(m)),l.listChildren().length>0&&(h.children=l.listChildren().map(E=>i.nodeIndexMap.get(E)))}),r.animations=s.listAnimations().map((l,_)=>{const h=i.createPropertyDef(l),g=new Map;return h.samplers=l.listSamplers().map((p,m)=>{const E=i.createPropertyDef(p);return E.input=i.accessorIndexMap.get(p.getInput()),E.output=i.accessorIndexMap.get(p.getOutput()),E.interpolation=p.getInterpolation(),g.set(p,m),E}),h.channels=l.listChannels().map(p=>{const m=i.createPropertyDef(p);return m.sampler=g.get(p.getSampler()),m.target={node:i.nodeIndexMap.get(p.getTargetNode()),path:p.getTargetPath()},m}),i.animationIndexMap.set(l,_),h}),r.scenes=s.listScenes().map((l,_)=>{const h=i.createPropertyDef(l);return h.nodes=l.listChildren().map(g=>i.nodeIndexMap.get(g)),i.sceneIndexMap.set(l,_),h});const T=s.getDefaultScene();return T&&(r.scene=s.listScenes().indexOf(T)),r.extensionsUsed=u.map(l=>l.extensionName),r.extensionsRequired=f.map(l=>l.extensionName),u.forEach(l=>l.write(i)),function(l){const _=[];for(const h in l){const g=l[h];(Array.isArray(g)&&g.length===0||g===null||g===""||g&&typeof g=="object"&&Object.keys(g).length===0)&&_.push(h)}for(const h of _)delete l[h]}(r),n}}var Je;(function(o){o[o.JSON=1313821514]="JSON",o[o.BIN=5130562]="BIN"})(Je||(Je={}));class Cs{constructor(){this.M=q.DEFAULT_INSTANCE,this.l=new Set,this.U={},this.P=Pe.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const t of e)this.l.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.U,e),this}setVertexLayout(e){return this.P=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const s=Pt(t)?this.L(t):{json:JSON.parse(F.decodeText(t)),resources:{}};return await this.j(s,this.dirname(e)),this.D(s),s}async readJSON(e){return e=this._(e),this.D(e),bs.read(e,{extensions:Array.from(this.l),dependencies:this.U,logger:this.M})}async binaryToJSON(e){const t=this.L(F.assertView(e));this.D(t);const s=t.json;if(s.buffers&&s.buffers.some(r=>function(n,i){return i.uri!==void 0&&!(i.uri in n.resources)}(t,r)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(r=>function(n,i){return i.uri!==void 0&&!(i.uri in n.resources)&&i.bufferView===void 0}(t,r)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(F.assertView(e)))}async writeJSON(e,t={}){if(t.format===ae.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return Is.write(e,{format:t.format||ae.GLTF,basename:t.basename||"",logger:this.M,vertexLayout:this.P,dependencies:D({},this.U),extensions:Array.from(this.l)})}async writeBinary(e){const{json:t,resources:s}=await this.writeJSON(e,{format:ae.GLB}),r=new Uint32Array([1179937895,2,12]),n=JSON.stringify(t),i=F.pad(F.encodeText(n),32),a=F.toView(new Uint32Array([i.byteLength,1313821514])),c=F.concat([a,i]);r[r.length-1]+=c.byteLength;const u=Object.values(s)[0];if(!u||!u.byteLength)return F.concat([F.toView(r),c]);const f=F.pad(u,0),d=F.toView(new Uint32Array([f.byteLength,5130562])),x=F.concat([d,f]);return r[r.length-1]+=x.byteLength,F.concat([F.toView(r),c,x])}async j(e,t){var s=this;const r=[...e.json.images||[],...e.json.buffers||[]].map(async function(n){const i=n.uri;if(!i||i.match(/data:/))return Promise.resolve();e.resources[i]=await s.readURI(s.resolve(t,i),"view"),s.lastReadBytes+=e.resources[i].byteLength});await Promise.all(r)}D(e){function t(s){if(s.uri){if(s.uri in e.resources)F.assertView(e.resources[s.uri]);else if(s.uri.match(/data:/)){const r=`__${ys()}.${ye.extension(s.uri)}`;e.resources[r]=F.createBufferFromDataURI(s.uri),s.uri=r}}}(e.json.images||[]).forEach(s=>{if(s.bufferView===void 0&&s.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(s)}),(e.json.buffers||[]).forEach(t)}_(e){const{images:t,buffers:s}=e.json;return e={json:D({},e.json),resources:D({},e.resources)},t&&(e.json.images=t.map(r=>D({},r))),s&&(e.json.buffers=s.map(r=>D({},r))),e}L(e){if(!Pt(e))throw new Error("Invalid glTF 2.0 binary.");const t=new Uint32Array(e.buffer,e.byteOffset+12,2);if(t[1]!==Je.JSON)throw new Error("Missing required GLB JSON chunk.");const s=t[0],r=F.decodeText(F.toView(e,20,s)),n=JSON.parse(r),i=20+s;if(e.byteLength<=i)return{json:n,resources:{}};const a=new Uint32Array(e.buffer,e.byteOffset+i,2);if(a[1]!==Je.BIN)throw new Error("Expected GLB BIN in second chunk.");const c=F.toView(e,i+8,a[0]);return{json:n,resources:{[Ue]:c}}}}function Pt(o){if(o.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(o.buffer,o.byteOffset,3);return e[0]===1179937895&&e[1]===2}class zs extends Cs{constructor(e=Re.DEFAULT_INIT){super(),this.J=void 0,this.J=e}async readURI(e,t){const s=await fetch(e,this.J);switch(t){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(e,t){return Re.resolve(e,t)}dirname(e){return Re.dirname(e)}}async function Ns(o){const e=new FileReader;return new Promise((t,s)=>{e.onloadend=r=>{var n;r.target?t((n=r.target)==null?void 0:n.result):t(null)},e.onerror=s,e.readAsArrayBuffer(o)})}async function vs(o,e,t){try{const s=await as(o,e,t);if(s.ok){const r=await s.blob(),n=await Ns(r);if(n)return await new zs({credentials:"include"}).binaryToJSON(new Uint8Array(n))}}catch(s){console.log(s)}return null}function Bt(o){return`META_${o}`}function Os(o){var t,s;const e=(t=o==null?void 0:o.json)==null?void 0:t.scenes;return Array.isArray(e)&&e.length>0?(s=e[0].extras)==null?void 0:s.meta:null}function Lt(){return crypto.randomUUID()}function Vt(o,e,t){const s=e.byteOffset||0,r=t.byteOffset||0,n=s+r,i=t.componentType===5125?4:2,a=i*t.count;if(i===2){const c=new Uint16Array(o.slice(n,n+a).buffer),u=new Uint32Array(c.length);for(let f=0;f<c.length;f++)u[f]=c[f];return u}else return new Uint32Array(o.slice(n,n+a).buffer)}function jt(o,e,t){const s=e.byteOffset||0,r=t.byteOffset||0,n=s+r,a=4*(t.count*3);return new Float32Array(o.slice(n,n+a).buffer)}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const kt="166",He=2e3,Dt=2001;function Gt(o,e,t){return Math.max(e,Math.min(t,o))}class Fs{constructor(e=0,t=0,s=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=s,this._w=r}static slerpFlat(e,t,s,r,n,i,a){let c=s[r+0],u=s[r+1],f=s[r+2],d=s[r+3];const x=n[i+0],y=n[i+1],w=n[i+2],T=n[i+3];if(a===0){e[t+0]=c,e[t+1]=u,e[t+2]=f,e[t+3]=d;return}if(a===1){e[t+0]=x,e[t+1]=y,e[t+2]=w,e[t+3]=T;return}if(d!==T||c!==x||u!==y||f!==w){let l=1-a;const _=c*x+u*y+f*w+d*T,h=_>=0?1:-1,g=1-_*_;if(g>Number.EPSILON){const m=Math.sqrt(g),E=Math.atan2(m,_*h);l=Math.sin(l*E)/m,a=Math.sin(a*E)/m}const p=a*h;if(c=c*l+x*p,u=u*l+y*p,f=f*l+w*p,d=d*l+T*p,l===1-a){const m=1/Math.sqrt(c*c+u*u+f*f+d*d);c*=m,u*=m,f*=m,d*=m}}e[t]=c,e[t+1]=u,e[t+2]=f,e[t+3]=d}static multiplyQuaternionsFlat(e,t,s,r,n,i){const a=s[r],c=s[r+1],u=s[r+2],f=s[r+3],d=n[i],x=n[i+1],y=n[i+2],w=n[i+3];return e[t]=a*w+f*d+c*y-u*x,e[t+1]=c*w+f*x+u*d-a*y,e[t+2]=u*w+f*y+a*x-c*d,e[t+3]=f*w-a*d-c*x-u*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,s,r){return this._x=e,this._y=t,this._z=s,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const s=e._x,r=e._y,n=e._z,i=e._order,a=Math.cos,c=Math.sin,u=a(s/2),f=a(r/2),d=a(n/2),x=c(s/2),y=c(r/2),w=c(n/2);switch(i){case"XYZ":this._x=x*f*d+u*y*w,this._y=u*y*d-x*f*w,this._z=u*f*w+x*y*d,this._w=u*f*d-x*y*w;break;case"YXZ":this._x=x*f*d+u*y*w,this._y=u*y*d-x*f*w,this._z=u*f*w-x*y*d,this._w=u*f*d+x*y*w;break;case"ZXY":this._x=x*f*d-u*y*w,this._y=u*y*d+x*f*w,this._z=u*f*w+x*y*d,this._w=u*f*d-x*y*w;break;case"ZYX":this._x=x*f*d-u*y*w,this._y=u*y*d+x*f*w,this._z=u*f*w-x*y*d,this._w=u*f*d+x*y*w;break;case"YZX":this._x=x*f*d+u*y*w,this._y=u*y*d+x*f*w,this._z=u*f*w-x*y*d,this._w=u*f*d-x*y*w;break;case"XZY":this._x=x*f*d-u*y*w,this._y=u*y*d-x*f*w,this._z=u*f*w+x*y*d,this._w=u*f*d+x*y*w;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+i)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const s=t/2,r=Math.sin(s);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,s=t[0],r=t[4],n=t[8],i=t[1],a=t[5],c=t[9],u=t[2],f=t[6],d=t[10],x=s+a+d;if(x>0){const y=.5/Math.sqrt(x+1);this._w=.25/y,this._x=(f-c)*y,this._y=(n-u)*y,this._z=(i-r)*y}else if(s>a&&s>d){const y=2*Math.sqrt(1+s-a-d);this._w=(f-c)/y,this._x=.25*y,this._y=(r+i)/y,this._z=(n+u)/y}else if(a>d){const y=2*Math.sqrt(1+a-s-d);this._w=(n-u)/y,this._x=(r+i)/y,this._y=.25*y,this._z=(c+f)/y}else{const y=2*Math.sqrt(1+d-s-a);this._w=(i-r)/y,this._x=(n+u)/y,this._y=(c+f)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Gt(this.dot(e),-1,1)))}rotateTowards(e,t){const s=this.angleTo(e);if(s===0)return this;const r=Math.min(1,t/s);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const s=e._x,r=e._y,n=e._z,i=e._w,a=t._x,c=t._y,u=t._z,f=t._w;return this._x=s*f+i*a+r*u-n*c,this._y=r*f+i*c+n*a-s*u,this._z=n*f+i*u+s*c-r*a,this._w=i*f-s*a-r*c-n*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const s=this._x,r=this._y,n=this._z,i=this._w;let a=i*e._w+s*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=i,this._x=s,this._y=r,this._z=n,this;const c=1-a*a;if(c<=Number.EPSILON){const y=1-t;return this._w=y*i+t*this._w,this._x=y*s+t*this._x,this._y=y*r+t*this._y,this._z=y*n+t*this._z,this.normalize(),this}const u=Math.sqrt(c),f=Math.atan2(u,a),d=Math.sin((1-t)*f)/u,x=Math.sin(t*f)/u;return this._w=i*d+this._w*x,this._x=s*d+this._x*x,this._y=r*d+this._y*x,this._z=n*d+this._z*x,this._onChangeCallback(),this}slerpQuaternions(e,t,s){return this.copy(e).slerp(t,s)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),s=Math.random(),r=Math.sqrt(1-s),n=Math.sqrt(s);return this.set(r*Math.sin(e),r*Math.cos(e),n*Math.sin(t),n*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ee{constructor(e=0,t=0,s=0){ee.prototype.isVector3=!0,this.x=e,this.y=t,this.z=s}set(e,t,s){return s===void 0&&(s=this.z),this.x=e,this.y=t,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Kt.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Kt.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,s=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*s+n[6]*r,this.y=n[1]*t+n[4]*s+n[7]*r,this.z=n[2]*t+n[5]*s+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,s=this.y,r=this.z,n=e.elements,i=1/(n[3]*t+n[7]*s+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*s+n[8]*r+n[12])*i,this.y=(n[1]*t+n[5]*s+n[9]*r+n[13])*i,this.z=(n[2]*t+n[6]*s+n[10]*r+n[14])*i,this}applyQuaternion(e){const t=this.x,s=this.y,r=this.z,n=e.x,i=e.y,a=e.z,c=e.w,u=2*(i*r-a*s),f=2*(a*t-n*r),d=2*(n*s-i*t);return this.x=t+c*u+i*d-a*f,this.y=s+c*f+a*u-n*d,this.z=r+c*d+n*f-i*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,s=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*s+n[8]*r,this.y=n[1]*t+n[5]*s+n[9]*r,this.z=n[2]*t+n[6]*s+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const s=e.x,r=e.y,n=e.z,i=t.x,a=t.y,c=t.z;return this.x=r*c-n*a,this.y=n*i-s*c,this.z=s*a-r*i,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const s=e.dot(this)/t;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return ft.copy(this).projectOnVector(e),this.sub(ft)}reflect(e){return this.sub(ft.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(Gt(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y,r=this.z-e.z;return t*t+s*s+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,s){const r=Math.sin(t)*e;return this.x=r*Math.sin(s),this.y=Math.cos(t)*e,this.z=r*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,s){return this.x=e*Math.sin(t),this.y=s,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=s,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,s=Math.sqrt(1-t*t);return this.x=s*Math.cos(e),this.y=t,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ft=new ee,Kt=new Fs;class Ie{constructor(e,t,s,r,n,i,a,c,u,f,d,x,y,w,T,l){Ie.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,s,r,n,i,a,c,u,f,d,x,y,w,T,l)}set(e,t,s,r,n,i,a,c,u,f,d,x,y,w,T,l){const _=this.elements;return _[0]=e,_[4]=t,_[8]=s,_[12]=r,_[1]=n,_[5]=i,_[9]=a,_[13]=c,_[2]=u,_[6]=f,_[10]=d,_[14]=x,_[3]=y,_[7]=w,_[11]=T,_[15]=l,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ie().fromArray(this.elements)}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],this}copyPosition(e){const t=this.elements,s=e.elements;return t[12]=s[12],t[13]=s[13],t[14]=s[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,s){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,t,s){return this.set(e.x,t.x,s.x,0,e.y,t.y,s.y,0,e.z,t.z,s.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,s=e.elements,r=1/Ee.setFromMatrixColumn(e,0).length(),n=1/Ee.setFromMatrixColumn(e,1).length(),i=1/Ee.setFromMatrixColumn(e,2).length();return t[0]=s[0]*r,t[1]=s[1]*r,t[2]=s[2]*r,t[3]=0,t[4]=s[4]*n,t[5]=s[5]*n,t[6]=s[6]*n,t[7]=0,t[8]=s[8]*i,t[9]=s[9]*i,t[10]=s[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,s=e.x,r=e.y,n=e.z,i=Math.cos(s),a=Math.sin(s),c=Math.cos(r),u=Math.sin(r),f=Math.cos(n),d=Math.sin(n);if(e.order==="XYZ"){const x=i*f,y=i*d,w=a*f,T=a*d;t[0]=c*f,t[4]=-c*d,t[8]=u,t[1]=y+w*u,t[5]=x-T*u,t[9]=-a*c,t[2]=T-x*u,t[6]=w+y*u,t[10]=i*c}else if(e.order==="YXZ"){const x=c*f,y=c*d,w=u*f,T=u*d;t[0]=x+T*a,t[4]=w*a-y,t[8]=i*u,t[1]=i*d,t[5]=i*f,t[9]=-a,t[2]=y*a-w,t[6]=T+x*a,t[10]=i*c}else if(e.order==="ZXY"){const x=c*f,y=c*d,w=u*f,T=u*d;t[0]=x-T*a,t[4]=-i*d,t[8]=w+y*a,t[1]=y+w*a,t[5]=i*f,t[9]=T-x*a,t[2]=-i*u,t[6]=a,t[10]=i*c}else if(e.order==="ZYX"){const x=i*f,y=i*d,w=a*f,T=a*d;t[0]=c*f,t[4]=w*u-y,t[8]=x*u+T,t[1]=c*d,t[5]=T*u+x,t[9]=y*u-w,t[2]=-u,t[6]=a*c,t[10]=i*c}else if(e.order==="YZX"){const x=i*c,y=i*u,w=a*c,T=a*u;t[0]=c*f,t[4]=T-x*d,t[8]=w*d+y,t[1]=d,t[5]=i*f,t[9]=-a*f,t[2]=-u*f,t[6]=y*d+w,t[10]=x-T*d}else if(e.order==="XZY"){const x=i*c,y=i*u,w=a*c,T=a*u;t[0]=c*f,t[4]=-d,t[8]=u*f,t[1]=x*d+T,t[5]=i*f,t[9]=y*d-w,t[2]=w*d-y,t[6]=a*f,t[10]=T*d+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Us,e,Ps)}lookAt(e,t,s){const r=this.elements;return Y.subVectors(e,t),Y.lengthSq()===0&&(Y.z=1),Y.normalize(),re.crossVectors(s,Y),re.lengthSq()===0&&(Math.abs(s.z)===1?Y.x+=1e-4:Y.z+=1e-4,Y.normalize(),re.crossVectors(s,Y)),re.normalize(),$e.crossVectors(Y,re),r[0]=re.x,r[4]=$e.x,r[8]=Y.x,r[1]=re.y,r[5]=$e.y,r[9]=Y.y,r[2]=re.z,r[6]=$e.z,r[10]=Y.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,r=t.elements,n=this.elements,i=s[0],a=s[4],c=s[8],u=s[12],f=s[1],d=s[5],x=s[9],y=s[13],w=s[2],T=s[6],l=s[10],_=s[14],h=s[3],g=s[7],p=s[11],m=s[15],E=r[0],b=r[4],A=r[8],R=r[12],M=r[1],S=r[5],z=r[9],I=r[13],C=r[2],v=r[6],L=r[10],P=r[14],G=r[3],V=r[7],W=r[11],X=r[15];return n[0]=i*E+a*M+c*C+u*G,n[4]=i*b+a*S+c*v+u*V,n[8]=i*A+a*z+c*L+u*W,n[12]=i*R+a*I+c*P+u*X,n[1]=f*E+d*M+x*C+y*G,n[5]=f*b+d*S+x*v+y*V,n[9]=f*A+d*z+x*L+y*W,n[13]=f*R+d*I+x*P+y*X,n[2]=w*E+T*M+l*C+_*G,n[6]=w*b+T*S+l*v+_*V,n[10]=w*A+T*z+l*L+_*W,n[14]=w*R+T*I+l*P+_*X,n[3]=h*E+g*M+p*C+m*G,n[7]=h*b+g*S+p*v+m*V,n[11]=h*A+g*z+p*L+m*W,n[15]=h*R+g*I+p*P+m*X,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[4],r=e[8],n=e[12],i=e[1],a=e[5],c=e[9],u=e[13],f=e[2],d=e[6],x=e[10],y=e[14],w=e[3],T=e[7],l=e[11],_=e[15];return w*(+n*c*d-r*u*d-n*a*x+s*u*x+r*a*y-s*c*y)+T*(+t*c*y-t*u*x+n*i*x-r*i*y+r*u*f-n*c*f)+l*(+t*u*d-t*a*y-n*i*d+s*i*y+n*a*f-s*u*f)+_*(-r*a*f-t*c*d+t*a*x+r*i*d-s*i*x+s*c*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,s){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=s),this}invert(){const e=this.elements,t=e[0],s=e[1],r=e[2],n=e[3],i=e[4],a=e[5],c=e[6],u=e[7],f=e[8],d=e[9],x=e[10],y=e[11],w=e[12],T=e[13],l=e[14],_=e[15],h=d*l*u-T*x*u+T*c*y-a*l*y-d*c*_+a*x*_,g=w*x*u-f*l*u-w*c*y+i*l*y+f*c*_-i*x*_,p=f*T*u-w*d*u+w*a*y-i*T*y-f*a*_+i*d*_,m=w*d*c-f*T*c-w*a*x+i*T*x+f*a*l-i*d*l,E=t*h+s*g+r*p+n*m;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/E;return e[0]=h*b,e[1]=(T*x*n-d*l*n-T*r*y+s*l*y+d*r*_-s*x*_)*b,e[2]=(a*l*n-T*c*n+T*r*u-s*l*u-a*r*_+s*c*_)*b,e[3]=(d*c*n-a*x*n-d*r*u+s*x*u+a*r*y-s*c*y)*b,e[4]=g*b,e[5]=(f*l*n-w*x*n+w*r*y-t*l*y-f*r*_+t*x*_)*b,e[6]=(w*c*n-i*l*n-w*r*u+t*l*u+i*r*_-t*c*_)*b,e[7]=(i*x*n-f*c*n+f*r*u-t*x*u-i*r*y+t*c*y)*b,e[8]=p*b,e[9]=(w*d*n-f*T*n-w*s*y+t*T*y+f*s*_-t*d*_)*b,e[10]=(i*T*n-w*a*n+w*s*u-t*T*u-i*s*_+t*a*_)*b,e[11]=(f*a*n-i*d*n-f*s*u+t*d*u+i*s*y-t*a*y)*b,e[12]=m*b,e[13]=(f*T*r-w*d*r+w*s*x-t*T*x-f*s*l+t*d*l)*b,e[14]=(w*a*r-i*T*r-w*s*c+t*T*c+i*s*l-t*a*l)*b,e[15]=(i*d*r-f*a*r+f*s*c-t*d*c-i*s*x+t*a*x)*b,this}scale(e){const t=this.elements,s=e.x,r=e.y,n=e.z;return t[0]*=s,t[4]*=r,t[8]*=n,t[1]*=s,t[5]*=r,t[9]*=n,t[2]*=s,t[6]*=r,t[10]*=n,t[3]*=s,t[7]*=r,t[11]*=n,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,s,r))}makeTranslation(e,t,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,s,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const s=Math.cos(t),r=Math.sin(t),n=1-s,i=e.x,a=e.y,c=e.z,u=n*i,f=n*a;return this.set(u*i+s,u*a-r*c,u*c+r*a,0,u*a+r*c,f*a+s,f*c-r*i,0,u*c-r*a,f*c+r*i,n*c*c+s,0,0,0,0,1),this}makeScale(e,t,s){return this.set(e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,t,s,r,n,i){return this.set(1,s,n,0,e,1,i,0,t,r,1,0,0,0,0,1),this}compose(e,t,s){const r=this.elements,n=t._x,i=t._y,a=t._z,c=t._w,u=n+n,f=i+i,d=a+a,x=n*u,y=n*f,w=n*d,T=i*f,l=i*d,_=a*d,h=c*u,g=c*f,p=c*d,m=s.x,E=s.y,b=s.z;return r[0]=(1-(T+_))*m,r[1]=(y+p)*m,r[2]=(w-g)*m,r[3]=0,r[4]=(y-p)*E,r[5]=(1-(x+_))*E,r[6]=(l+h)*E,r[7]=0,r[8]=(w+g)*b,r[9]=(l-h)*b,r[10]=(1-(x+T))*b,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,s){const r=this.elements;let n=Ee.set(r[0],r[1],r[2]).length();const i=Ee.set(r[4],r[5],r[6]).length(),a=Ee.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],$.copy(this);const u=1/n,f=1/i,d=1/a;return $.elements[0]*=u,$.elements[1]*=u,$.elements[2]*=u,$.elements[4]*=f,$.elements[5]*=f,$.elements[6]*=f,$.elements[8]*=d,$.elements[9]*=d,$.elements[10]*=d,t.setFromRotationMatrix($),s.x=n,s.y=i,s.z=a,this}makePerspective(e,t,s,r,n,i,a=He){const c=this.elements,u=2*n/(t-e),f=2*n/(s-r),d=(t+e)/(t-e),x=(s+r)/(s-r);let y,w;if(a===He)y=-(i+n)/(i-n),w=-2*i*n/(i-n);else if(a===Dt)y=-i/(i-n),w=-i*n/(i-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=u,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=f,c[9]=x,c[13]=0,c[2]=0,c[6]=0,c[10]=y,c[14]=w,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,s,r,n,i,a=He){const c=this.elements,u=1/(t-e),f=1/(s-r),d=1/(i-n),x=(t+e)*u,y=(s+r)*f;let w,T;if(a===He)w=(i+n)*d,T=-2*d;else if(a===Dt)w=n*d,T=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*u,c[4]=0,c[8]=0,c[12]=-x,c[1]=0,c[5]=2*f,c[9]=0,c[13]=-y,c[2]=0,c[6]=0,c[10]=T,c[14]=-w,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,s=e.elements;for(let r=0;r<16;r++)if(t[r]!==s[r])return!1;return!0}fromArray(e,t=0){for(let s=0;s<16;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e[t+9]=s[9],e[t+10]=s[10],e[t+11]=s[11],e[t+12]=s[12],e[t+13]=s[13],e[t+14]=s[14],e[t+15]=s[15],e}}const Ee=new ee,$=new Ie,Us=new ee(0,0,0),Ps=new ee(1,1,1),re=new ee,$e=new ee,Y=new ee;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:kt}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=kt);function Yt(o,e){const t=new Set,s=new Ie().makeRotationX(Math.PI/2).toArray();for(let r=0;r<o.length;r++){const n=o[r]*3;if(t.has(n))continue;const i=e[n],a=e[n+1],c=e[n+2],u=1/(s[3]*i+s[7]*a+s[11]*c+s[15]),f=(s[0]*i+s[4]*a+s[8]*c+s[12])/u,d=(s[1]*i+s[5]*a+s[9]*c+s[13])/u,x=(s[2]*i+s[6]*a+s[10]*c+s[14])/u;e[n]=f,e[n+1]=d,e[n+2]=x,t.add(n)}}function Bs(o,e,t){const s=[];function r(i){var c,u,f,d,x,y;let a=i.json.scene||0;return(c=i.json.scenes)!=null&&c.length&&i.json.scenes[0]&&((u=i.json.scenes[0].nodes)!=null&&u.length)&&i.json.scenes[0].nodes[0]&&(a=i.json.scenes[0].nodes[0]),(d=(f=i==null?void 0:i.json)==null?void 0:f.nodes)!=null&&d.length&&((x=i==null?void 0:i.json)!=null&&x.nodes[a])?(y=i==null?void 0:i.json)==null?void 0:y.nodes[a]:(console.error("no main node found"),{})}const n=r(o);return Array.isArray(n.children)&&n.children.forEach(i=>{var A,R,M,S,z;const a=o.json.nodes&&o.json.nodes[i];if(!a||a.mesh===void 0)return;const c=o.json.meshes&&o.json.meshes[a.mesh];if(!c)return;const u=((A=a.name)==null?void 0:A.replace("node",""))||"";if(u==="")return;const f=parseInt(u);f===void 0&&console.warn("unexpected reult for nodename");const d=c.primitives[0].material;if(f!==d&&console.warn("test",f,d),d===void 0)return;const x=c.primitives[0].indices;if(x===void 0)return;const y=c.primitives[0].attributes.POSITION,w=o.json.accessors&&o.json.accessors[x];if(w===void 0||w.bufferView===void 0)return;const T=o.json.accessors&&o.json.accessors[y];if(T===void 0||T.bufferView===void 0)return;const l=o.json.bufferViews&&o.json.bufferViews[w.bufferView];if(!l)return;const _=o.json.bufferViews&&o.json.bufferViews[T.bufferView];if(!_)return;const g=((S=(((R=o==null?void 0:o.json)==null?void 0:R.materials)&&((M=o==null?void 0:o.json)==null?void 0:M.materials[d])||{}).pbrMetallicRoughness)==null?void 0:S.baseColorFactor)||[0,0,0,0],p=o.resources["@glb.bin"],m=Vt(p,l,w),E=jt(p,_,T);if(!m.length){console.log("missing index",e,t,i);return}if(!E.length){console.log("missing position",e,t,i);return}Yt(m,E);const b=((z=o.json.scenes)==null?void 0:z.length)&&o.json.scenes[0].extras&&o.json.scenes[0].extras[`id_sequence${f}`];if(!b){console.log("missing id sequence",e,t,`id_sequence${f}`,i);return}s.push({position:E,index:m,color:g,id_sequence:b,indexdbKey:Lt()})}),s}function Wt(o){const e={x:null,y:null,z:null},t={x:null,y:null,z:null};let s=0;for(;s<o.length;)for(let r=0;r<3;r++,s++){const n=o[s]||0;r===0&&(e.x===null&&(e.x=n),t.x===null&&(t.x=n),e.x<n&&(e.x=n),t.x>n&&(t.x=n)),r===1&&(e.y===null&&(e.y=n),t.y===null&&(t.y=n),e.y<n&&(e.y=n),t.y>n&&(t.y=n)),r===2&&(e.z===null&&(e.z=n),t.z===null&&(t.z=n),e.z<n&&(e.z=n),t.z>n&&(t.z=n))}return{X:e.x||0,Y:e.y||0,Z:e.z||0,x:t.x||0,y:t.y||0,z:t.z||0}}function Ls(o,e,t,s,r){Object.keys(r).forEach(i=>{const a=[],[c,u]=r[i];for(let f=c;f<u+1;f++){const d=t[f]*3;a.push(s[d]),a.push(s[d+1]),a.push(s[d+2])}o.add(i),e[i]=Wt(a)})}function Vs(o,e){let t=!0;for(;t&&o;){const s=new Set;Object.keys(o).forEach(n=>{const i=o[n];s.add(i[1])});let r=0;Object.keys(o).forEach(n=>{!s.has(n)&&!e.has(n)&&(r++,delete o[n])}),r===0&&(t=!1)}}function qt(o){return`${o}_ALL_KEYS`}async function js(o,e,t,s,r=null){try{const n=new Fe(o),i=[],a=[],c=new Set,u={},f=qt(t);n.getJsonKey(f).then(m=>{Array.isArray(m)&&m.forEach(E=>{n.deleteKey(E)})});const d=Os(s);if(!d)return console.log("Missing expected glb meta",e,t),null;const x=Bs(s,e,t),y={};for(let m=0;m<x.length;m++){const E=x[m];Ls(c,u,E.index,E.position,E.id_sequence);const b=E.index,A=n.getUUID();await n.setBufferKey(A,b.buffer),E.index=A,a.push(A);const R=E.position,M=n.getUUID();await n.setBufferKey(M,R.buffer),E.position=M,a.push(M),E.id_sequence,i.push(E.indexdbKey),a.push(E.indexdbKey),y[A]={indexdb_key:E.indexdbKey,index:A,color:E.color,position:M,id_sequence:structuredClone(E.id_sequence)},E.id_sequence=null,await n.setJsonKey(E.indexdbKey,E)}Vs(d,c);const w=Object.keys(d),T=[],l=new Map;let _=0;r?(l.set("*",1),_++):l.set("*",0),w.forEach(m=>{const E=u[m],b=d[m];let A,R;const M=b[0],S=b[1];l.has(m)?A=l.get(m):(_++,A=_,l.set(m,_)),l.has(S)?R=l.get(S):(_++,R=_,l.set(S,_)),T.push([A,M,R,E==null?void 0:E.x,E==null?void 0:E.y,E==null?void 0:E.z,E==null?void 0:E.X,E==null?void 0:E.Y,E==null?void 0:E.Z])}),r&&T.unshift([1,r,0,void 0,void 0,void 0,void 0,void 0,void 0]);const h={group_name:t,meshes:y,group_ref:T};Object.keys(h.meshes).forEach(m=>{const E=h.meshes[m];Object.keys(E.id_sequence).forEach(A=>{let R;l.has(A)?R=l.get(A):(_++,R=_,l.set(A,_)),E.id_sequence[R]=E.id_sequence[A],delete E.id_sequence[A]})});const p=new TextEncoder().encode(JSON.stringify(h));return await n.setBufferKey(Bt(t),p),await n.setJsonKey(t,i),await n.setJsonKey(f,a),await n.close(),t}catch(n){return console.error("error",t,n),null}}function ks(o,e,t){var n;const s=[];return(((n=o==null?void 0:o.json)==null?void 0:n.nodes)||[]).forEach(i=>{var b,A,R,M,S;if(!i||i.mesh===void 0)return;const a=o.json.meshes&&o.json.meshes[i.mesh];if(!a)return;const c=((b=i.name)==null?void 0:b.replace("node",""))||"";if(c==="")return;const u=parseInt(c);u===void 0&&console.warn("unexpected reult for nodename");const f=a.primitives[0].material;if(u!==f&&console.warn("test",u,f),f===void 0)return;const d=a.primitives[0].indices;if(d===void 0)return;const x=a.primitives[0].attributes.POSITION,y=o.json.accessors&&o.json.accessors[d];if(y===void 0||y.bufferView===void 0)return;const w=o.json.accessors&&o.json.accessors[x];if(w===void 0||w.bufferView===void 0)return;const T=o.json.bufferViews&&o.json.bufferViews[y.bufferView];if(!T)return;const l=o.json.bufferViews&&o.json.bufferViews[w.bufferView];if(!l)return;const h=((M=(((A=o==null?void 0:o.json)==null?void 0:A.materials)&&((R=o==null?void 0:o.json)==null?void 0:R.materials[f])||{}).pbrMetallicRoughness)==null?void 0:M.baseColorFactor)||[0,0,0,0],g=o.resources["@glb.bin"],p=Vt(g,T,y),m=jt(g,l,w);if(!p.length){console.log("missing index",e,t,i);return}if(!m.length){console.log("missing position",e,t,i);return}Yt(p,m);const E=((S=o.json.scenes)==null?void 0:S.length)&&o.json.scenes[0].extras&&o.json.scenes[0].extras[`draw_ranges_node${u}`];if(!E){console.log("missing draw_ranges",e,t,`draw_ranges_node${u}`,i);return}s.push({position:m,index:p,color:h,draw_ranges:E,indexdbKey:Lt()})}),s}function Ds(o,e,t,s,r){Object.keys(r).forEach(i=>{const a=[],[c,u]=r[i];for(let f=c;f<c+u;f++){const d=t[f]*3;a.push(s[d]),a.push(s[d+1]),a.push(s[d+2])}o.add(i),e[i]=Wt(a)})}async function Gs(o,e,t,s,r=null){var n,i,a,c;try{const u=new Fe(o),f=[],d=[],x=new Set,y={},w=qt(t);if(u.getJsonKey(w).then(R=>{Array.isArray(R)&&R.forEach(M=>{u.deleteKey(M)})}),!((i=(n=s==null?void 0:s.json)==null?void 0:n.scenes)!=null&&i.length))return console.log("Missing expected glb meta",e,t),null;const T=(c=(a=s==null?void 0:s.json)==null?void 0:a.scenes[0].extras)==null?void 0:c.id_hierarchy;if(!T)return console.log("Missing expected glb meta",e,t),null;const l=ks(s,e,t),_={};for(let R=0;R<l.length;R++){const M=l[R];Ds(x,y,M.index,M.position,M.draw_ranges);const S=M.index,z=u.getUUID();await u.setBufferKey(z,S.buffer),M.index=z,d.push(z);const I=M.position,C=u.getUUID();await u.setBufferKey(C,I.buffer),M.position=C,d.push(C),f.push(M.indexdbKey),d.push(M.indexdbKey),_[z]={indexdb_key:M.indexdbKey,index:z,color:M.color,position:C,id_sequence:structuredClone(M.draw_ranges)},M.draw_ranges=null,await u.setJsonKey(M.indexdbKey,M)}const h=Object.keys(T),g=[],p=new Map;let m=0;r?(p.set("*",1),m++):p.set("*",0),h.forEach(R=>{const M=y[R],S=T[R];let z,I;const C=S[0],v=S[1];p.has(R)?z=p.get(R):(m++,z=m,p.set(R,m)),p.has(v)?I=p.get(v):(m++,I=m,p.set(v,m)),g.push([z,C,I,M==null?void 0:M.x,M==null?void 0:M.y,M==null?void 0:M.z,M==null?void 0:M.X,M==null?void 0:M.Y,M==null?void 0:M.Z])}),r&&g.unshift([1,r,0,void 0,void 0,void 0,void 0,void 0,void 0]);const E={group_name:t,meshes:_,group_ref:g,version:2};Object.keys(E.meshes).forEach(R=>{const M=E.meshes[R];Object.keys(M.id_sequence).forEach(z=>{let I;p.has(z)?I=p.get(z):(m++,I=m,p.set(z,m)),M.id_sequence[I]=M.id_sequence[z],`${I}`!=`${z}`&&delete M.id_sequence[z]})});const A=new TextEncoder().encode(JSON.stringify(E));return await u.setBufferKey(Bt(t),A),await u.setJsonKey(t,f),await u.setJsonKey(w,d),await u.close(),t}catch(u){return console.error("error",t,u),null}}async function Ks(o,e){const t=new Fe(o),s=await t.getJsonKey(e);if(s&&s.length)for(let r=0;r<s.length;r++){const n=await t.getJsonKey(s[r]);n!=null&&n.position&&await t.deleteKey(n.position),n!=null&&n.index&&await t.deleteKey(n.index),n!=null&&n.vertexColor&&await t.deleteKey(n.vertexColor)}}class Ys{async downloadFromAzure(e,t,s,r,n){var f,d;const i=Ks(t,r),a=await vs(e,s,n);if(await Promise.resolve(i),!a)return console.log("Missing expected glbDoc",s,n),null;const c=(d=(f=a.json.asset)==null?void 0:f.extras)==null?void 0:d.web3dversion;let u;return c==2?u=Gs(t,s,r,a):u=js(t,s,r,a),u}}et(Ys)})();
